{"version":3,"sources":["redactor.js"],"names":["$","Function","prototype","bind","scope","fn","this","apply","uuid","Redactor","el","options","init","redactor","val","args","Array","slice","call","arguments","each","func","instance","data","search","split","isFunction","methodVal","undefined","push","error","length","VERSION","modules","settings","opts","animation","lang","direction","spellcheck","overrideStyles","scrollTarget","document","focus","focusEnd","clickToEdit","structure","tabindex","minHeight","maxHeight","maxWidth","plugins","callbacks","placeholder","linkify","enterKey","pastePlainText","pasteImages","pasteLinks","pasteBlockTags","pasteInlineTags","preClass","preSpaces","tabAsSpaces","tabKey","autosave","autosaveName","autosaveFields","imageUpload","imageUploadParam","imageUploadFields","imageUploadForms","imageTag","imageEditable","imageCaption","imagePosition","imageResizable","imageFloatMargin","imageInsertInline","imageMinResizeWidth","imageMinResizeHeight","dragImageUpload","multipleImageUpload","clipboardImageUpload","fileUpload","fileUploadParam","fileUploadFields","fileUploadForms","dragFileUpload","s3","linkNewTab","linkTooltip","linkNofollow","linkSize","pasteLinkTarget","videoContainerClass","toolbar","toolbarFixed","toolbarFixedTarget","toolbarFixedTopOffset","toolbarExternal","toolbarOverflow","air","airWidth","formatting","formattingAdd","buttons","buttonsTextLabeled","buttonsHide","buttonsHideOnMobile","script","removeNewlines","removeComments","replaceTags","b","i","strike","keepStyleAttr","shortcuts","ctrl+shift+m, meta+shift+m","ctrl+b, meta+b","params","ctrl+i, meta+i","ctrl+h, meta+h","ctrl+l, meta+l","ctrl+k, meta+k","ctrl+shift+7","ctrl+shift+8","shortcutsAdd","activeButtons","activeButtonsStates","strong","em","del","langs","en","format","image","file","link","bold","italic","deleted","underline","bold-abbr","italic-abbr","deleted-abbr","underline-abbr","lists","link-insert","link-edit","link-in-new-tab","unlink","cancel","close","insert","save","delete","text","edit","title","paragraph","quote","code","heading1","heading2","heading3","heading4","heading5","heading6","filename","optional","unorderedlist","orderedlist","outdent","indent","horizontalrule","upload-label","caption","bulletslist","numberslist","image-position","none","left","right","center","accessibility-help-label","type","inline","buffer","rebuffer","inlineTags","blockTags","paragraphize","paragraphizeBlocks","emptyHtml","invisibleSpace","emptyHtmlRendered","html","imageTypes","userAgent","navigator","toLowerCase","observe","dropdowns","regexps","linkyoutube","linkvimeo","linkimage","url","keyCode","BACKSPACE","DELETE","UP","DOWN","ENTER","SPACE","ESC","TAB","CTRL","META","SHIFT","ALT","RIGHT","LEFT","LEFT_WIN","$element","loadOptions","loadModules","hasClass","loadToEdit","removeClass","reIsBlock","RegExp","join","toUpperCase","reIsInline","load","extend","$editor","detectType","core","callback","start","build","isInline","isTag","on","proxy","initToEdit","addClass","startToEdit","node","marker","get","selection","restore","clickToCancelStorage","clickToCancel","off","show","e","preventDefault","destroy","events","syncFire","hide","clickToSave","namespace","getModuleMethods","object","Object","getOwnPropertyNames","filter","property","len","bindModuleMethods","module","methods","z","enabled","collapsed","collapseToStart","collapsedEnd","collapseToEnd","detect","isMobile","button","hideButtons","hideButtonsOnMobile","$air","createContainer","css","append","$toolbar","setFormatting","editor","appendTo","attr","id","role","saveInstant","leftFix","width","innerWidth","window","clientX","top","clientY","scrollTop","bindHide","dropdown","target","closest","remove","key","which","utils","isRedactorParent","sel","range","deleteContents","ctrlKey","metaKey","shiftKey","altKey","setInactiveAll","fadeOut","name","$textarea","is","send","source","getHiddenFields","ajax","done","success","k","v","toString","indexOf","json","JSON","parse","callbackName","disable","clearInterval","autosaveTimeout","block","tag","value","tags","inArray","set","isCollapsed","formatCollapsed","formatUncollapsed","currentTag","tagName","replaced","clearAllAttrs","removeAllClass","removeAllAttr","isEndOfElement","createElement","innerHTML","after","caret","$last","children","last","replaceToTag","setAttr","trim","removeInlineTags","blocks","find","first","s","index","splice","not","contents","unwrap","getBlocks","replaceClass","removeAttr","toggleClass","replaceAttr","toggleAttr","self","returned","addAttr","attributes","$el","clear","setUndo","setRedo","saved","current","add","undo","pop","restoreInstant","redo","startTextarea","setIn","setId","enableEditor","setOptions","callEditor","createContainerBox","$box","getName","loadFromTextarea","insertAfter","prepend","aria-labelledby","textarea","clean","onSync","contenteditable","toolbarMobile","box","max-width","margin","disableBrowsersEditing","setHelpers","toolbarsButtons","element","modal","templates","cleaned","storage","setTimeout","end","execCommand","RedactorPlugins","curLang","icon","p","blockquote","pre","h1","h2","h3","h4","h5","h6","label","out","class","aria-disabled","ul","ol","in","hideButtonsSlicer","btnName","buildButtonTooltip","$btn","$tooltip","btnObject","$button","aria-label","$icon","command","setEvent","$dropdown","getButtons","getButtonsKeys","toggle","isIe","isDesktop","freezeScroll","returnValue","clickCallback","hideAll","unfreezeScroll","all","isAdded","btn","addFirst","addAfter","afterkey","parent","addBefore","beforekey","before","setIcon","changeIcon","newIconClass","addCallback","addDropdown","setActive","setInactive","$btns","enable","disableAll","enableAll","node1","node2","cs","setStart","setEnd","update","prepare","isFirefox","$first","isInlineTag","setStartEmptyOrInline","getSelection","removeAllRanges","createRange","selectNodeContents","collapse","addRange","textNode","createTextNode","insertNode","setStartAfter","space","className","setStartBefore","setEndBefore","replaceWith","lastChild","nodeType","getRangeAt","rangeCount","isBlockTag","next","prev","$next","$prev","offset","onSet","savePreCode","saveFormTags","replace","$div","parseHTML","replacement","keys","stripTags","onGet","restoreFormTags","™","©","…","—","‐","onPaste","isHtmlMsWord","cleanMsWord","replaceBrToNl","removeTagsInsidePre","removeEmptyInlineTags","encode","convertTags","getPlainText","reconvertTags","replaceNbspToSpaces","encodeHtml","getCurrentType","line","isHtmlLine","isHtmlBlocked","links","images","isCurrentOrParent","match1","match","match2","matchBR","matchNL","$spans","$tags","tagHtml","isEmpty","lastList","lastLevel","listsIds","matches","currentList","parseInt","currentLevel","listType","$li","$list","data-level","data-list","$lastList","replaceNlToBr","$links","href","tmp","j","item","outerHTML","concat","spanMarker","cleanPre","str","textContent","innerText","savePreFormatting","saveCodeFormatting","restoreSelectionMarkers","attr1","attr2","arr","codeTag","encodeEntities","String","input","denied","$0","$1","removeMarkers","removeSpaces","removeSpacesHard","normalizeCurrentHeading","heading","isCurrentOrParentHeader","normalize","stopDetectChanges","startDetectChanges","sync","htmlCleaned","isSync","startSync","addEvent","event","getEvent","_data","handler","destroyed","progress","removeData","$modalBox","$modalOverlay","isWebkit","test","documentMode","ie","isNaN","isIpad","active","position","getDropdown","dropdownObject","buildFormatting","$item","buildItem","$itemContainer","classname","$itemSpan","buildClick","buildCommand","body","getButtonPosition","showIsFixedToolbar","showIsUnFixedToolbar","disableBodyScroll","enableBodyScroll","stopPropagation","innerHeight","redactorAnimation","duration","enableCallback","enableEvents","closeHandler","dropdownWidth","Math","max","$buttons","$elements","hideOut","focused","blured","dropImage","stopChanges","dragover","dragleave","drop","originalEvent","FormData","dataTransfer","files","onDrop","onDropUpload","click","disableSelectAll","rtePaste","isCallback","blur","touchImageEditing","scrollTimer","imageEditing","clearTimeout","paste","keydown","keyup","createObserver","setupObserver","observer","MutationObserver","mutations","forEach","iterateObserver","mutation","stop","attributeName","changeHandler","subtree","childList","characterData","characterDataOldValue","upload","directUpload","stopDetect","startDetect","direct","release","$link","nodeToPoint","lastNode","activeElement","$img","src","$figure","nextNode","nextSibling","$nextFigure","isNextEmpty","isNextFigureEmpty","setEditable","$image","resizer","loadEditableControls","hideResize","setResizable","showEdit","resizeHandle","x","pageX","y","pageY","ratio","height","h","targetTouches","startResize","moveResize","stopResize","round","handle","imageBox","marginTop","style","marginBottom","marginLeft","marginRight","loadResizableControls","imageResizer","display","editter","editerWidth","$container","buttonDelete","getDeleteButton","buttonSave","getActionButton","$ficaption","floatValue","prop","setFloating","pattern","re","re2","linkProtocol","a","getOuterHtml","addCaption","imageFloat","imageDisplay","imageMargin","textAlign","float","text-align","$target","$figcaption","restoreScroll","increase","list","$current","listTag","$newList","$ol","removeEmpty","decrease","repositionItem","parents","$parent","$lists","$items","removeItemEmpty","getParams","arrangeTag","newInline","insertBreakpoint","insertInline","setParams","nodes","getClearedNodes","setNodesStriked","$inside","$parentAround","cleanInsideOrParent","removeSpecificAttr","newNodes","started","isConvertableAttr","nodeAttrValue","rules","count","ruleName","ruleValue","rgb2hex","isConvertable","nodeTag","parentNode","parentTag","breakpoint","endTag","$code","cloneAttributes","getStyleParams","result","rule","$node","eachInline","inlines","removeEmptyAttr","hasParentStyle","addParentStyle","replaceStyle","toggleStyle","newVal","oldVal","isRgb","addStyle","removeStyle","removeAllStyle","removeStyleRule","removeStyleRuleAttr","removeFormat","endNode","appendLists","isSelectAll","breaked","breakBlockTag","placeHtml","$block","wrap","raw","frag","createDocumentFragment","firstChild","appendChild","cloneRange","deleteContent","gap","placeNode","isStartOfElement","endOfNode","extractEndOfNode","isBlock","caretPositionFromPoint","pos","offsetNode","caretRangeFromPoint","createTextRange","moveToPoint","endRange","duplicate","setEndPoint","select","nodeToCaretPositionFromPoint","arrow","ctrl","figcaption","figure","checkEvents","setupBuffer","addArrowsEvent","setupSelectAll","onArrowDown","onArrowUp","wrapToParagraph","lastShiftKey","onShiftSpace","onShiftEnter","onEnter","onTab","onBackspaceAndDeleteBefore","$nextList","removeOnBackspace","combineAfterAndBefore","removeInvisibleSpace","removeEmptyListInTable","onBackspaceAndDeleteAfter","insertNewLine","saveScroll","removeEmptyLists","formatEmpty","exitFromBlockquote","insertBreakLine","replaceToParagraph","insertParagraph","checkKeyEvents","insertAfterLastElement","insertBeforeFirstElement","isList","isListStart","enableSelectAll","insertBreakLineProcessing","insertDblBreakLine","dbl","br1","br2","clone","blockElem","blockHtml","setCaretToParagraph","td","removeIt","$newTag","setUnfixed","$marker","animate","isContainImage","isKey","getLineHtml","$hr","replaceLinksToText","closeAllTooltip","buildLinkFromObject","buildModal","buildLinkFromElement","removeSelfHostFromUrl","setModalValues","buildLinkFromModal","cleanUrl","cleanText","getText","truncateUrl","isUrl","re1","re3","re4","re5","substring","isMailto","buildTarget","location","$unlinked","isLink","nodeValue","isFiltered","convertVideoLinks","convertImages","convertLinks","addBack","$objects","$newBlock","iframeStart","iframeEnd","grep","decodeURIComponent","regexB","regexp","cmd","inBlocks","parentsUntil","$insertedList","$listParent","isEmptyBlock","isBlockWrapped","num","iterateRemove","image-edit","addTemplate","template","getTemplate","getModal","$modalBody","getCancelButton","templateName","setTitle","setDraggable","setContent","buildTabber","buildWidth","$modal","timing","setEnter","windowHeight","windowWidth","number","margin-bottom","outerHeight","tabs","$tabsBox","showTab","eq","$modalHeader","draggable","buildOverlay","$modalClose","disableEvents","bodyOveflow","isCurrent","parentEl","currentEl","toggleActive","finded","isRedactor","inValues","outValues","setDropdownProperties","addProperties","deleteProperties","setDropdownAttr","properties","isDelete","img","showTooltip","getTooltipPosition","tooltip","aLink","aEdit","aUnlink","lineHeight","lineClicked","ceil","closeTooltip","cloned","div","cloneContents","endContainer","endOffset","walker","createTreeWalker","NodeFilter","SHOW_TEXT","Infinity","safes","getSafes","convert","restoreSafes","detectClipboardUpload","clipboardUpload","createPasteBox","saveBodyScroll","getPasteBoxCode","$pasteBox","appendPasteBox","$visibleModals","clipboard","clipboardData","types","items","getAsFile","reader","FileReader","readAsDataURL","onload","insertFromClipboard","imgs","formData","blob","dataURItoBlob","isEditorEmpty","isEditorRelative","setEditorRelative","buildPosition","isAttr","$style","getPosition","states","$bar","startContainer","anchorNode","previousSibling","isArray","resultNodes","commonAncestorContainer","unshift","hasChildNodes","savedSel","ownerDocument","defaultView","selectionRange","startOffset","doc","win","charIndex","nodeStack","foundStart","nextCharIndex","childNodes","container","clonedRange","extractContents","markerHtml","hotkeysSpecialKeys","8","9","10","13","16","17","18","19","20","27","32","33","34","35","36","37","38","39","40","45","46","59","61","96","97","98","99","100","101","102","103","104","105","106","107","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","144","145","173","186","187","188","189","190","191","192","219","220","221","222","hotkeysShiftNums","`","1","2","3","4","5","6","7","0","-","=",";","'",",",".","/","\\","buildHandler","origHandler","special","character","fromCharCode","modif","possible","specialKey","status","decodeURI","_this","changes","setOverflow","setFixed","toolbarOffsetTop","late","observeScroll","observeScrollDisable","getBoxTop","tolerance","boxTop","observeScrollEnable","observeScrollResize","fullscreen","isOpened","setDropdownsFixed","visibility","unsetDropdownsFixed","setDropdownPosition","$droparea","$placeholdler","$input","onDrag","onDragLeave","traverseFile","setConfig","uploads3","getType","obj","fd","appendFields","appendForms","imageFields","fileFields","xhr","XMLHttpRequest","open","setRequestHeader","onreadystatechange","readyState","responseText","err","clearImageFields","addImageFields","removeImageFields","clearFileFields","addFileFields","removeFileFields","executeOnSignedUrl","signedURL","sendToS3","mark","overrideMimeType","that","createCORSRequest","method","XDomainRequest","s3file","onerror","onprogress","isElement","HTMLElement","strpos","haystack","needle","dataURI","byteString","atob","unescape","mimeString","ia","Uint8Array","charCodeAt","Blob","from","to","attrs","$nextPart","contains","inInlines","matched","isCurrentOrParentOne","getScrollTarget","$scrollTarget","freezeScrollTop","tmpScrollTop","selectAll","$body","documentElementRect","documentElement","getBoundingClientRect","abs","isOverflowing","clientWidth","scrollbarWidth","measureScrollbar","scrollDiv","offsetWidth","removeChild","overflow","padding-right","$fields","$forms","serializeArray","f","rgb","isPad","browser","webkit","ff","jQuery","iterate","delay","prefix","slide","prefixes","queue","_callback","complete","shift","make","one"],"mappings":"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","file":"redactor.min.js","sourcesContent":["/*\n\tRedactor II\n\tVersion 2.7\n\tUpdated: June 17, 2017\n\n\thttp://imperavi.com/redactor/\n\n\tCopyright (c) 2009-2017, Imperavi LLC.\n\tLicense: http://imperavi.com/redactor/license/\n\n\tUsage: $('#content').redactor();\n*/\n\n(function($)\n{\n\t'use strict';\n\n\tif (!Function.prototype.bind)\n\t{\n\t\tFunction.prototype.bind = function(scope)\n\t\t{\n\t\t\tvar fn = this;\n\t\t\treturn function()\n\t\t\t{\n\t\t\t\treturn fn.apply(scope);\n\t\t\t};\n\t\t};\n\t}\n\n\tvar uuid = 0;\n\n\t// Plugin\n\t$.fn.redactor = function(options)\n\t{\n\t\tvar val = [];\n\t\tvar args = Array.prototype.slice.call(arguments, 1);\n\n\t\tif (typeof options === 'string')\n\t\t{\n\t\t\tthis.each(function()\n\t\t\t{\n\t\t\t\tvar instance = $.data(this, 'redactor');\n\t\t\t\tvar func;\n\n\t\t\t\tif (options.search(/\\./) !== '-1')\n\t\t\t\t{\n\t\t\t\t\tfunc = options.split('.');\n\t\t\t\t\tif (typeof instance[func[0]] !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tfunc = instance[func[0]][func[1]];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tfunc = instance[options];\n\t\t\t\t}\n\n\t\t\t\tif (typeof instance !== 'undefined' && $.isFunction(func))\n\t\t\t\t{\n\t\t\t\t\tvar methodVal = func.apply(instance, args);\n\t\t\t\t\tif (methodVal !== undefined && methodVal !== instance)\n\t\t\t\t\t{\n\t\t\t\t\t\tval.push(methodVal);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$.error('No such method \"' + options + '\" for Redactor');\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.each(function()\n\t\t\t{\n\t\t\t\t$.data(this, 'redactor', {});\n\t\t\t\t$.data(this, 'redactor', Redactor(this, options));\n\t\t\t});\n\t\t}\n\n\t\tif (val.length === 0)\n\t\t{\n\t\t\treturn this;\n\t\t}\n\t\telse if (val.length === 1)\n\t\t{\n\t\t\treturn val[0];\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn val;\n\t\t}\n\n\t};\n\n\t// Initialization\n\tfunction Redactor(el, options)\n\t{\n\t\treturn new Redactor.prototype.init(el, options);\n\t}\n\n\t// Options\n\t$.Redactor = Redactor;\n\t$.Redactor.VERSION = '2.7';\n\t$.Redactor.modules = ['air', 'autosave', 'block', 'buffer', 'build', 'button', 'caret', 'clean', 'code', 'core', 'detect', 'dropdown',\n\t\t\t\t\t\t  'events', 'file', 'focus', 'image', 'indent', 'inline', 'insert', 'keydown', 'keyup',\n\t\t\t\t\t\t  'lang', 'line', 'link', 'linkify', 'list', 'marker', 'modal', 'observe', 'offset', 'paragraphize', 'paste', 'placeholder',\n\t\t\t\t\t\t  'progress', 'selection', 'shortcuts', 'storage', 'toolbar', 'upload', 'uploads3', 'utils',\n\n\t\t\t\t\t\t  'browser' // deprecated\n\t\t\t\t\t\t  ];\n\n\t$.Redactor.settings = {};\n\t$.Redactor.opts = {\n\n\t\t// settings\n\t\tanimation: false,\n\t\tlang: 'en',\n\t\tdirection: 'ltr',\n\t\tspellcheck: true,\n\t\toverrideStyles: true,\n\t\tscrollTarget: document,\n\n\t\tfocus: false,\n\t\tfocusEnd: false,\n\n\t\tclickToEdit: false,\n\t\tstructure: false,\n\n\t\ttabindex: false,\n\n\t\tminHeight: false, // string\n\t\tmaxHeight: false, // string\n\n\t\tmaxWidth: false, // string\n\n\t\tplugins: false, // array\n\t\tcallbacks: {},\n\n\t\tplaceholder: false,\n\n\t\tlinkify: true,\n\t\tenterKey: true,\n\n\t\tpastePlainText: false,\n\t\tpasteImages: true,\n\t\tpasteLinks: true,\n\t\tpasteBlockTags: ['pre', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'table', 'tbody', 'thead', 'tfoot', 'th', 'tr', 'td', 'ul', 'ol', 'li', 'blockquote', 'p', 'figure', 'figcaption'],\n\t\tpasteInlineTags: ['br', 'strong', 'ins', 'code', 'del', 'span', 'samp', 'kbd', 'sup', 'sub', 'mark', 'var', 'cite', 'small', 'b', 'u', 'em', 'i'],\n\n\t\tpreClass: false, // string\n\t\tpreSpaces: 4, // or false\n\t\ttabAsSpaces: false, // true or number of spaces\n\t\ttabKey: true,\n\n\t\tautosave: false, // false or url\n\t\tautosaveName: false,\n\t\tautosaveFields: false,\n\n\t\timageUpload: null,\n\t\timageUploadParam: 'file',\n\t\timageUploadFields: false,\n\t\timageUploadForms: false,\n        imageTag: 'figure',\n        imageEditable: true,\n\t\timageCaption: true,\n\n\t\timagePosition: false,\n\t\timageResizable: false,\n\t\timageFloatMargin: '10px',\n\t\timageInsertInline: false,\n\t\timageMinResizeWidth: 50,\n\t\timageMinResizeHeight: 100,\n\n\t\tdragImageUpload: true,\n\t\tmultipleImageUpload: true,\n\t\tclipboardImageUpload: true,\n\n\t\tfileUpload: null,\n\t\tfileUploadParam: 'file',\n\t\tfileUploadFields: false,\n\t\tfileUploadForms: false,\n\t\tdragFileUpload: true,\n\n\t\ts3: false,\n\n        linkNewTab: false,\n\t\tlinkTooltip: true,\n\t\tlinkNofollow: false,\n\t\tlinkSize: 30,\n\t\tpasteLinkTarget: false,\n\n\t\tvideoContainerClass: 'video-container',\n\n\t\ttoolbar: true,\n\t\ttoolbarFixed: true,\n\t\ttoolbarFixedTarget: document,\n\t\ttoolbarFixedTopOffset: 0, // pixels\n\t\ttoolbarExternal: false, // ID selector\n\t\ttoolbarOverflow: false,\n\n\t\tair: false,\n\t\tairWidth: false,\n\n\t\tformatting: ['p', 'blockquote', 'pre', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6'],\n\t\tformattingAdd: false,\n\n\t\tbuttons: ['format', 'bold', 'italic', 'deleted', 'lists', 'image', 'file', 'link', 'horizontalrule'], // + 'horizontalrule', 'underline', 'ol', 'ul', 'indent', 'outdent'\n        buttonsTextLabeled: false,\n\t\tbuttonsHide: [],\n\t\tbuttonsHideOnMobile: [],\n\n\t\tscript: true,\n\t\tremoveNewlines: false,\n\t\tremoveComments: true,\n\t\treplaceTags: {\n\t\t\t'b': 'strong',\n\t\t\t'i': 'em',\n\t\t\t'strike': 'del'\n\t\t},\n\n        keepStyleAttr: [], // tag name array\n\n\t\t// shortcuts\n\t\tshortcuts: {\n\t\t\t'ctrl+shift+m, meta+shift+m': { func: 'inline.removeFormat' },\n\t\t\t'ctrl+b, meta+b': { func: 'inline.format', params: ['bold'] },\n\t\t\t'ctrl+i, meta+i': { func: 'inline.format', params: ['italic'] },\n\t\t\t'ctrl+h, meta+h': { func: 'inline.format', params: ['superscript'] },\n\t\t\t'ctrl+l, meta+l': { func: 'inline.format', params: ['subscript'] },\n\t\t\t'ctrl+k, meta+k': { func: 'link.show' },\n\t\t\t'ctrl+shift+7':   { func: 'list.toggle', params: ['orderedlist'] },\n\t\t\t'ctrl+shift+8':   { func: 'list.toggle', params: ['unorderedlist'] }\n\t\t},\n\t\tshortcutsAdd: false,\n\n\t\tactiveButtons: ['deleted', 'italic', 'bold'],\n\t\tactiveButtonsStates: {\n\t\t\tb: 'bold',\n\t\t\tstrong: 'bold',\n\t\t\ti: 'italic',\n\t\t\tem: 'italic',\n\t\t\tdel: 'deleted',\n\t\t\tstrike: 'deleted'\n\t\t},\n\n\t\t// private lang\n\t\tlangs: {\n\t\t\ten: {\n\n\t\t\t\t\"format\": \"Format\",\n\t\t\t\t\"image\": \"Image\",\n\t\t\t\t\"file\": \"File\",\n\t\t\t\t\"link\": \"Link\",\n\t\t\t\t\"bold\": \"Bold\",\n\t\t\t\t\"italic\": \"Italic\",\n\t\t\t\t\"deleted\": \"Strikethrough\",\n\t\t\t\t\"underline\": \"Underline\",\n\t\t\t\t\"bold-abbr\": \"B\",\n\t\t\t\t\"italic-abbr\": \"I\",\n\t\t\t\t\"deleted-abbr\": \"S\",\n\t\t\t\t\"underline-abbr\": \"U\",\n\t\t\t\t\"lists\": \"Lists\",\n\t\t\t\t\"link-insert\": \"Insert link\",\n\t\t\t\t\"link-edit\": \"Edit link\",\n\t\t\t\t\"link-in-new-tab\": \"Open link in new tab\",\n\t\t\t\t\"unlink\": \"Unlink\",\n\t\t\t\t\"cancel\": \"Cancel\",\n\t\t\t\t\"close\": \"Close\",\n\t\t\t\t\"insert\": \"Insert\",\n\t\t\t\t\"save\": \"Save\",\n\t\t\t\t\"delete\": \"Delete\",\n\t\t\t\t\"text\": \"Text\",\n\t\t\t\t\"edit\": \"Edit\",\n\t\t\t\t\"title\": \"Title\",\n\t\t\t\t\"paragraph\": \"Normal text\",\n\t\t\t\t\"quote\": \"Quote\",\n\t\t\t\t\"code\": \"Code\",\n\t\t\t\t\"heading1\": \"Heading 1\",\n\t\t\t\t\"heading2\": \"Heading 2\",\n\t\t\t\t\"heading3\": \"Heading 3\",\n\t\t\t\t\"heading4\": \"Heading 4\",\n\t\t\t\t\"heading5\": \"Heading 5\",\n\t\t\t\t\"heading6\": \"Heading 6\",\n\t\t\t\t\"filename\": \"Name\",\n\t\t\t\t\"optional\": \"optional\",\n\t\t\t\t\"unorderedlist\": \"Unordered List\",\n\t\t\t\t\"orderedlist\": \"Ordered List\",\n\t\t\t\t\"outdent\": \"Outdent\",\n\t\t\t\t\"indent\": \"Indent\",\n\t\t\t\t\"horizontalrule\": \"Line\",\n\t\t\t\t\"upload-label\": \"Drop file here or \",\n\t\t\t\t\"caption\": \"Caption\",\n\n\t\t\t\t\"bulletslist\": \"Bullets\",\n\t\t\t\t\"numberslist\": \"Numbers\",\n\n\t\t\t\t\"image-position\": \"Position\",\n\t\t\t\t\"none\": \"None\",\n\t\t\t\t\"left\": \"Left\",\n\t\t\t\t\"right\": \"Right\",\n\t\t\t\t\"center\": \"Center\",\n\n\t\t\t\t\"accessibility-help-label\": \"Rich text editor\"\n\t\t\t}\n\t\t},\n\n\t\t// private\n\t\ttype: 'textarea', // textarea, div, inline, pre\n\t\tinline: false,\n\t\tbuffer: [],\n\t\trebuffer: [],\n\t\tinlineTags: ['a', 'span', 'strong', 'strike', 'b', 'u', 'em', 'i', 'code', 'del', 'ins', 'samp', 'kbd', 'sup', 'sub', 'mark', 'var', 'cite', 'small'],\n\t\tblockTags: ['pre', 'ul', 'ol', 'li', 'p', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6',  'dl', 'dt', 'dd', 'div', 'td', 'blockquote', 'output', 'figcaption', 'figure', 'address', 'section', 'header', 'footer', 'aside', 'article', 'iframe'],\n\t\tparagraphize: true,\n\t\tparagraphizeBlocks: ['table', 'div', 'pre', 'form', 'ul', 'ol', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'dl', 'blockquote', 'figcaption',\n\t\t\t\t\t\t\t'address', 'section', 'header', 'footer', 'aside', 'article', 'object', 'style', 'script', 'iframe', 'select', 'input', 'textarea',\n\t\t\t\t\t\t\t'button', 'option', 'map', 'area', 'math', 'hr', 'fieldset', 'legend', 'hgroup', 'nav', 'figure', 'details', 'menu', 'summary', 'p'],\n\t\temptyHtml: '<p>&#x200b;</p>',\n\t\tinvisibleSpace: '&#x200b;',\n\t\temptyHtmlRendered: $('').html('​').html(),\n\t\timageTypes: ['image/png', 'image/jpeg', 'image/gif'],\n\t\tuserAgent: navigator.userAgent.toLowerCase(),\n\t\tobserve: {\n\t\t\tdropdowns: []\n\t\t},\n\t\tregexps: {\n\t\t\tlinkyoutube: /https?:\\/\\/(?:[0-9A-Z-]+\\.)?(?:youtu\\.be\\/|youtube\\.com\\S*[^\\w\\-\\s])([\\w\\-]{11})(?=[^\\w\\-]|$)(?![?=&+%\\w.\\-]*(?:['\"][^<>]*>|<\\/a>))[?=&+%\\w.-]*/ig,\n\t\t\tlinkvimeo: /https?:\\/\\/(www\\.)?vimeo.com\\/(\\d+)($|\\/)/,\n\t\t\tlinkimage: /((https?|www)[^\\s]+\\.)(jpe?g|png|gif)(\\?[^\\s-]+)?/ig,\n\t\t\turl: /(https?:\\/\\/(?:www\\.|(?!www))[^\\s\\.]+\\.[^\\s]{2,}|www\\.[^\\s]+\\.[^\\s]{2,})/ig\n\t\t}\n\n\t};\n\n\t// Functionality\n\tRedactor.fn = $.Redactor.prototype = {\n\n\t\tkeyCode: {\n\t\t\tBACKSPACE: 8,\n\t\t\tDELETE: 46,\n\t\t\tUP: 38,\n\t\t\tDOWN: 40,\n\t\t\tENTER: 13,\n\t\t\tSPACE: 32,\n\t\t\tESC: 27,\n\t\t\tTAB: 9,\n\t\t\tCTRL: 17,\n\t\t\tMETA: 91,\n\t\t\tSHIFT: 16,\n\t\t\tALT: 18,\n\t\t\tRIGHT: 39,\n\t\t\tLEFT: 37,\n\t\t\tLEFT_WIN: 91\n\t\t},\n\n\t\t// =init\n\t\tinit: function(el, options)\n\t\t{\n\t\t\tthis.$element = $(el);\n\t\t\tthis.uuid = uuid++;\n\n\t\t\tthis.loadOptions(options);\n\t\t\tthis.loadModules();\n\n\t\t\t// click to edit\n\t\t\tif (this.opts.clickToEdit && !this.$element.hasClass('redactor-click-to-edit'))\n\t\t\t{\n\t\t\t\treturn this.loadToEdit(options);\n\t\t\t}\n\t\t\telse if (this.$element.hasClass('redactor-click-to-edit'))\n\t\t\t{\n\t\t\t\tthis.$element.removeClass('redactor-click-to-edit');\n\t\t\t}\n\n\t\t\t// block & inline test tag regexp\n\t\t\tthis.reIsBlock = new RegExp('^(' + this.opts.blockTags.join('|' ).toUpperCase() + ')$', 'i');\n\t\t\tthis.reIsInline = new RegExp('^(' + this.opts.inlineTags.join('|' ).toUpperCase() + ')$', 'i');\n\n\t\t\t// set up drag upload\n\t\t\tthis.opts.dragImageUpload = (this.opts.imageUpload === null) ? false : this.opts.dragImageUpload;\n\t\t\tthis.opts.dragFileUpload = (this.opts.fileUpload === null) ? false : this.opts.dragFileUpload;\n\n\t\t\t// formatting storage\n\t\t\tthis.formatting = {};\n\n\t\t\t// load lang\n\t\t\tthis.lang.load();\n\n\t\t\t// extend shortcuts\n\t\t\t$.extend(this.opts.shortcuts, this.opts.shortcutsAdd);\n\n\t\t\t// set editor\n\t\t\tthis.$editor = this.$element;\n\n\t\t\t// detect type of editor\n\t\t\tthis.detectType();\n\n\t\t\t// start callback\n\t\t\tthis.core.callback('start');\n\t\t\tthis.core.callback('startToEdit');\n\n\t\t\t// build\n\t\t\tthis.start = true;\n\t\t\tthis.build.start();\n\n\t\t},\n\t\tdetectType: function()\n\t\t{\n\t\t\tif (this.build.isInline() || this.opts.inline)\n\t\t\t{\n\t\t\t\tthis.opts.type = 'inline';\n\t\t\t}\n\t\t\telse if (this.build.isTag('DIV'))\n\t\t\t{\n\t\t\t\tthis.opts.type = 'div';\n\t\t\t}\n\t\t\telse if (this.build.isTag('PRE'))\n\t\t\t{\n\t\t\t\tthis.opts.type = 'pre';\n\t\t\t}\n\t\t},\n\t\tloadToEdit: function(options)\n\t\t{\n\n\t\t\tthis.$element.on('click.redactor-click-to-edit', $.proxy(function()\n\t\t\t{\n\t\t\t\tthis.initToEdit(options);\n\n\t\t\t}, this));\n\n\t\t\tthis.$element.addClass('redactor-click-to-edit');\n\n\t\t\treturn;\n\t\t},\n\t\tinitToEdit: function(options)\n\t\t{\n\t\t\t$.extend(options.callbacks,  {\n\t\t\t\tstartToEdit: function()\n\t\t\t\t{\n\t\t\t\t\tthis.insert.node(this.marker.get(), false);\n\t\t\t\t},\n\t\t\t\tinitToEdit: function()\n\t\t\t\t{\n\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\tthis.clickToCancelStorage = this.code.get();\n\n\t\t\t\t\t// cancel\n\t\t\t\t\t$(this.opts.clickToCancel).off('.redactor-click-to-edit');\n\t\t\t\t\t$(this.opts.clickToCancel).show().on('click.redactor-click-to-edit', $.proxy(function(e)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\tthis.core.destroy();\n\t\t\t\t\t\tthis.events.syncFire = false;\n\t\t\t\t\t\tthis.$element.html(this.clickToCancelStorage);\n\t\t\t\t\t\tthis.core.callback('cancel', this.clickToCancelStorage);\n\t\t\t\t\t\tthis.events.syncFire = true;\n\t\t\t\t\t\tthis.clickToCancelStorage = '';\n\t\t\t\t\t\t$(this.opts.clickToCancel).hide();\n\t\t\t\t\t\t$(this.opts.clickToSave).hide();\n\n\t\t\t\t\t\tthis.$element.on('click.redactor-click-to-edit', $.proxy(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.initToEdit(options);\n\t\t\t\t\t\t}, this));\n\n\t\t\t\t\t\tthis.$element.addClass('redactor-click-to-edit');\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\t// save\n\t\t\t\t\t$(this.opts.clickToSave).off('.redactor-click-to-edit');\n\t\t\t\t\t$(this.opts.clickToSave).show().on('click.redactor-click-to-edit', $.proxy(function(e)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\tthis.core.destroy();\n\t\t\t\t\t\tthis.core.callback('save', this.code.get());\n\t\t\t\t\t\t$(this.opts.clickToCancel).hide();\n\t\t\t\t\t\t$(this.opts.clickToSave).hide();\n\t\t\t\t\t\tthis.$element.on('click.redactor-click-to-edit', $.proxy(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.initToEdit(options);\n\t\t\t\t\t\t}, this));\n\t\t\t\t\t\tthis.$element.addClass('redactor-click-to-edit');\n\n\t\t\t\t\t}, this));\n\t\t\t\t}\n\n\t\t\t});\n\n\t\t\tthis.$element.redactor(options);\n\t\t\tthis.$element.off('.redactor-click-to-edit');\n\n\t\t},\n\t\tloadOptions: function(options)\n\t\t{\n\t\t\tvar settings = {};\n\n\t\t\t// check namespace\n\t\t\tif (typeof $.Redactor.settings.namespace !== 'undefined')\n\t\t\t{\n\t\t\t\t if (this.$element.hasClass($.Redactor.settings.namespace))\n\t\t\t\t {\n\t\t\t\t\t settings = $.Redactor.settings;\n\t\t\t\t }\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tsettings = $.Redactor.settings;\n\t\t\t}\n\n\t\t\tthis.opts = $.extend(\n\t\t\t\t{},\n\t\t\t\t$.Redactor.opts,\n\t\t\t\tthis.$element.data(),\n\t\t\t\toptions\n\t\t\t);\n\n\t\t\tthis.opts = $.extend(true, this.opts, settings);\n\n\t\t},\n\t\tgetModuleMethods: function(object)\n\t\t{\n\t\t\treturn Object.getOwnPropertyNames(object).filter(function(property)\n\t\t\t{\n\t\t\t\treturn typeof object[property] === 'function';\n\t\t\t});\n\t\t},\n\t\tloadModules: function()\n\t\t{\n\t\t\tvar len = $.Redactor.modules.length;\n\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t{\n\t\t\t\tthis.bindModuleMethods($.Redactor.modules[i]);\n\t\t\t}\n\t\t},\n\t\tbindModuleMethods: function(module)\n\t\t{\n\t\t\tif (typeof this[module] === 'undefined')\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// init module\n\t\t\tthis[module] = this[module]();\n\n\t\t\tvar methods = this.getModuleMethods(this[module]);\n\t\t\tvar len = methods.length;\n\n\t\t\t// bind methods\n\t\t\tfor (var z = 0; z < len; z++)\n\t\t\t{\n\t\t\t\tthis[module][methods[z]] = this[module][methods[z]].bind(this);\n\t\t\t}\n\t\t},\n\n\t\t// =air\n\t\tair: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tenabled: false,\n\t\t\t\tcollapsed: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.air)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.selection.get().collapseToStart();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tcollapsedEnd: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.air)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.selection.get().collapseToEnd();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tbuild: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.detect.isMobile())\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.button.hideButtons();\n\t\t\t\t\tthis.button.hideButtonsOnMobile();\n\n\t\t\t\t\tif (this.opts.buttons.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.$air = this.air.createContainer();\n\n\t\t\t\t\tif (this.opts.airWidth !== false)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$air.css('width', this.opts.airWidth);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.air.append();\n\t\t\t\t\tthis.button.$toolbar = this.$air;\n\t\t\t\t\tthis.button.setFormatting();\n\t\t\t\t\tthis.button.load(this.$air);\n\n\t\t\t\t\tthis.core.editor().on('mouseup.redactor', this, $.proxy(function(e)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.selection.text() !== '')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.air.show(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}, this));\n\n\t\t\t\t},\n\t\t\t\tappend: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$air.appendTo('body');\n\t\t\t\t},\n\t\t\t\tcreateContainer: function()\n\t\t\t\t{\n\t\t\t\t\treturn $('<ul>').addClass('redactor-air').attr({ 'id': 'redactor-air-' + this.uuid, 'role': 'toolbar' }).hide();\n\t\t\t\t},\n\t\t\t\tshow: function (e)\n\t\t\t\t{\n\t\t\t\t\t//this.marker.remove();\n\t\t\t\t\tthis.selection.saveInstant();\n\t\t\t\t\t//this.selection.restore(false);\n\n\t\t\t\t\t$('.redactor-air').hide();\n\n\t\t\t\t\tvar leftFix = 0;\n\t\t\t\t\tvar width = this.$air.innerWidth();\n\n\t\t\t\t\tif ($(window).width() < (e.clientX + width))\n\t\t\t\t\t{\n\t\t\t\t\t\tleftFix = 200;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.$air.css({\n\t\t\t\t\t\tleft: (e.clientX - leftFix) + 'px',\n\t\t\t\t\t\ttop: (e.clientY + 10 + $(document).scrollTop()) + 'px'\n\t\t\t\t\t}).show();\n\n\t\t\t\t\tthis.air.enabled = true;\n\t\t\t\t\tthis.air.bindHide();\n\t\t\t\t},\n\t\t\t\tbindHide: function()\n\t\t\t\t{\n\t\t\t\t\t$(document).on('mousedown.redactor-air.' + this.uuid, $.proxy(function(e)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar dropdown = $(e.target).closest('.redactor-dropdown').length;\n\n\t\t\t\t\t\tif ($(e.target).closest(this.$air).length === 0 && dropdown === 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar hide = this.air.hide(e);\n\t\t\t\t\t\t\tif (hide !== false)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.marker.remove();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}, this)).on('keydown.redactor-air.' + this.uuid, $.proxy(function(e)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar key = e.which;\n\t\t\t\t\t\tif ((!this.utils.isRedactorParent(e.target) && !$(e.target).hasClass('redactor-in')) || $(e.target).closest('#redactor-modal').length !== 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (key === this.keyCode.ESC)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.selection.get().collapseToStart();\n\t\t\t\t\t\t\t//this.marker.remove();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (key === this.keyCode.BACKSPACE || key === this.keyCode.DELETE)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\t\t\tvar range = this.selection.range(sel);\n\t\t\t\t\t\t\trange.deleteContents();\n\t\t\t\t\t\t\t//this.marker.remove();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (key === this.keyCode.ENTER)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.selection.get().collapseToEnd();\n\t\t\t\t\t\t\t//this.marker.remove();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.air.enabled)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.air.hide(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.selection.get().collapseToStart();\n\t\t\t\t\t\t\t//this.marker.remove();\n\t\t\t\t\t\t}\n\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\thide: function(e)\n\t\t\t\t{\n\t\t\t\t\tvar ctrl = e.ctrlKey || e.metaKey || (e.shiftKey && e.altKey);\n\t\t\t\t\tif (ctrl)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.button.setInactiveAll();\n\t\t\t\t\tthis.$air.fadeOut(100);\n\t\t\t\t\tthis.air.enabled = false;\n\t\t\t\t\t$(document).off('mousedown.redactor-air.' + this.uuid);\n\t\t\t\t\t$(document).off('keydown.redactor-air.' + this.uuid);\n\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =autosave\n\t\tautosave: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tenabled: false,\n\t\t\t\thtml: false,\n\t\t\t\tinit: function()\n\t\t\t\t{\n\t\t\t\t\tif (!this.opts.autosave)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.autosave.enabled = true;\n\t\t\t\t\tthis.autosave.name = (this.opts.autosaveName) ? this.opts.autosaveName : this.$textarea.attr('name');\n\n\t\t\t\t},\n\t\t\t\tis: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.autosave.enabled;\n\t\t\t\t},\n\t\t\t\tsend: function()\n\t\t\t\t{\n\t\t\t\t\tif (!this.opts.autosave)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.autosave.source = this.code.get();\n\n\t\t\t\t\tif (this.autosave.html === this.autosave.source)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// data\n\t\t\t\t\tvar data = {};\n\t\t\t\t\tdata.name = this.autosave.name;\n\t\t\t\t\tdata[this.autosave.name] = this.autosave.source;\n\t\t\t\t\tdata = this.autosave.getHiddenFields(data);\n\n\t\t\t\t\t// ajax\n\t\t\t\t\tvar jsxhr = $.ajax({\n\t\t\t\t\t\turl: this.opts.autosave,\n\t\t\t\t\t\ttype: 'post',\n\t\t\t\t\t\tdata: data\n\t\t\t\t\t});\n\n\t\t\t\t\tjsxhr.done(this.autosave.success);\n\t\t\t\t},\n\t\t\t\tgetHiddenFields: function(data)\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.autosaveFields === false || typeof this.opts.autosaveFields !== 'object')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn data;\n\t\t\t\t\t}\n\n\t\t\t\t\t$.each(this.opts.autosaveFields, $.proxy(function(k, v)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (v !== null && v.toString().indexOf('#') === 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tv = $(v).val();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tdata[k] = v;\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\treturn data;\n\n\t\t\t\t},\n\t\t\t\tsuccess: function(data)\n\t\t\t\t{\n\t\t\t\t\tvar json;\n\t\t\t\t\ttry\n\t\t\t\t\t{\n\t\t\t\t\t\tjson = JSON.parse(data);\n\t\t\t\t\t}\n\t\t\t\t\tcatch(e)\n\t\t\t\t\t{\n\t\t\t\t\t\t//data has already been parsed\n\t\t\t\t\t\tjson = data;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar callbackName = (typeof json.error === 'undefined') ? 'autosave' :  'autosaveError';\n\n\t\t\t\t\tthis.core.callback(callbackName, this.autosave.name, json);\n\t\t\t\t\tthis.autosave.html = this.autosave.source;\n\t\t\t\t},\n\t\t\t\tdisable: function()\n\t\t\t\t{\n\t\t\t\t\tthis.autosave.enabled = false;\n\n\t\t\t\t\tclearInterval(this.autosaveTimeout);\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =block\n\t\tblock: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tformat: function(tag, attr, value, type)\n\t\t\t\t{\n\t\t\t\t\ttag = (tag === 'quote') ? 'blockquote' : tag;\n\n\t\t\t\t\tthis.block.tags = ['p', 'blockquote', 'pre', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'div', 'figure'];\n\t\t\t\t\tif ($.inArray(tag, this.block.tags) === -1)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (tag === 'p' && typeof attr === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\t// remove all\n\t\t\t\t\t\tattr = 'class';\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.placeholder.hide();\n\t\t\t\t\tthis.buffer.set();\n\n\t\t\t\t\treturn (this.utils.isCollapsed()) ? this.block.formatCollapsed(tag, attr, value, type) : this.block.formatUncollapsed(tag, attr, value, type);\n\t\t\t\t},\n\t\t\t\tformatCollapsed: function(tag, attr, value, type)\n\t\t\t\t{\n\t\t\t\t\tthis.selection.save();\n\n\t\t\t\t\tvar block = this.selection.block();\n\t\t\t\t\tvar currentTag = block.tagName.toLowerCase();\n\t\t\t\t\tif ($.inArray(currentTag, this.block.tags) === -1)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n                    var clearAllAttrs = false;\n\t\t\t\t\tif (currentTag === tag && attr === undefined)\n\t\t\t\t\t{\n\t\t\t\t\t\ttag = 'p';\n\t\t\t\t\t\tclearAllAttrs = true;\n\t\t\t\t\t}\n\n\n                    if (clearAllAttrs)\n                    {\n                        this.block.removeAllClass();\n                        this.block.removeAllAttr();\n                    }\n\n\n                    var replaced;\n                    if (currentTag === 'blockquote' && this.utils.isEndOfElement(block))\n                    {\n                        this.marker.remove();\n\n                        replaced = document.createElement('p');\n                        replaced.innerHTML = this.opts.invisibleSpace;\n\n                        $(block).after(replaced);\n                        this.caret.start(replaced);\n                        var $last = $(block).children().last();\n\n                        if ($last.length !== 0 && $last[0].tagName === 'BR')\n                        {\n                            $last.remove();\n                        }\n                    }\n                    else\n                    {\n\t\t\t\t\t    replaced = this.utils.replaceToTag(block, tag);\n                    }\n\n\n\t\t\t\t\tif (typeof attr === 'object')\n\t\t\t\t\t{\n\t\t\t\t\t\ttype = value;\n\t\t\t\t\t\tfor (var key in attr)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treplaced = this.block.setAttr(replaced, key, attr[key], type);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\treplaced = this.block.setAttr(replaced, attr, value, type);\n\t\t\t\t\t}\n\n\n\t\t\t\t\t// trim pre\n\t\t\t\t\tif (tag === 'pre' && replaced.length === 1)\n\t\t\t\t\t{\n\t\t\t\t\t\t$(replaced).html($.trim($(replaced).html()));\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\tthis.block.removeInlineTags(replaced);\n\n\t\t\t\t\treturn replaced;\n\t\t\t\t},\n\t\t\t\tformatUncollapsed: function(tag, attr, value, type)\n\t\t\t\t{\n\t\t\t\t\tthis.selection.save();\n\n\t\t\t\t\tvar replaced = [];\n\t\t\t\t\tvar blocks = this.selection.blocks();\n\n                    if (blocks[0] && ($(blocks[0]).hasClass('redactor-in') || $(blocks[0]).hasClass('redactor-box')))\n                    {\n                        blocks = this.core.editor().find(this.opts.blockTags.join(', '));\n\t\t\t\t\t}\n\n\t\t\t\t\tvar len = blocks.length;\n\t\t\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar currentTag = blocks[i].tagName.toLowerCase();\n\t\t\t\t\t\tif ($.inArray(currentTag, this.block.tags) !== -1 && currentTag !== 'figure')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar block = this.utils.replaceToTag(blocks[i], tag);\n\n\t\t\t\t\t\t\tif (typeof attr === 'object')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttype = value;\n\t\t\t\t\t\t\t\tfor (var key in attr)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tblock = this.block.setAttr(block, key, attr[key], type);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tblock = this.block.setAttr(block, attr, value, type);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treplaced.push(block);\n\t\t\t\t\t\t\tthis.block.removeInlineTags(block);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.selection.restore();\n\n\t\t\t\t\t// combine pre\n\t\t\t\t\tif (tag === 'pre' && replaced.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar first = replaced[0];\n\t\t\t\t\t\t$.each(replaced, function(i,s)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (i !== 0)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$(first).append(\"\\n\" + $.trim(s.html()));\n\t\t\t\t\t\t\t\t$(s).remove();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treplaced = [];\n\t\t\t\t\t\treplaced.push(first);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn replaced;\n\t\t\t\t},\n\t\t\t\tremoveInlineTags: function(node)\n\t\t\t\t{\n\t\t\t\t\tnode = node[0] || node;\n\n\t\t\t\t\tvar tags = this.opts.inlineTags;\n\t\t\t\t\tvar blocks = ['PRE', 'H1', 'H2', 'H3', 'H4', 'H5', 'H6'];\n\n\t\t\t\t\tif ($.inArray(node.tagName, blocks) === - 1)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (node.tagName !== 'PRE')\n\t\t\t\t\t{\n\t\t\t\t\t\tvar index = tags.indexOf('a');\n\t\t\t\t\t\ttags.splice(index, 1);\n\t\t\t\t\t}\n\n\t\t\t\t\t$(node).find(tags.join(',')).not('.redactor-selection-marker').contents().unwrap();\n\t\t\t\t},\n\t\t\t\tsetAttr: function(block, attr, value, type)\n\t\t\t\t{\n\t\t\t\t\tif (typeof attr === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn block;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar func = (typeof type === 'undefined') ? 'replace' : type;\n\n\t\t\t\t\tif (attr === 'class')\n\t\t\t\t\t{\n\t\t\t\t\t\tblock = this.block[func + 'Class'](value, block);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tif (func === 'remove')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tblock = this.block[func + 'Attr'](attr, block);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (func === 'removeAll')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tblock = this.block[func + 'Attr'](attr, block);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tblock = this.block[func + 'Attr'](attr, value, block);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn block;\n\n\t\t\t\t},\n\t\t\t\tgetBlocks: function(block)\n\t\t\t\t{\n\t\t\t\t\treturn (typeof block === 'undefined') ? this.selection.blocks() : block;\n\t\t\t\t},\n\t\t\t\treplaceClass: function(value, block)\n\t\t\t\t{\n\t\t\t\t\treturn $(this.block.getBlocks(block)).removeAttr('class').addClass(value)[0];\n\t\t\t\t},\n\t\t\t\ttoggleClass: function(value, block)\n\t\t\t\t{\n\t\t\t\t\treturn $(this.block.getBlocks(block)).toggleClass(value)[0];\n\t\t\t\t},\n\t\t\t\taddClass: function(value, block)\n\t\t\t\t{\n\t\t\t\t\treturn $(this.block.getBlocks(block)).addClass(value)[0];\n\t\t\t\t},\n\t\t\t\tremoveClass: function(value, block)\n\t\t\t\t{\n\t\t\t\t\treturn $(this.block.getBlocks(block)).removeClass(value)[0];\n\t\t\t\t},\n\t\t\t\tremoveAllClass: function(block)\n\t\t\t\t{\n\t\t\t\t\treturn $(this.block.getBlocks(block)).removeAttr('class')[0];\n\t\t\t\t},\n\t\t\t\treplaceAttr: function(attr, value, block)\n\t\t\t\t{\n\t\t\t\t\tblock = this.block.removeAttr(attr, block);\n\n\t\t\t\t\treturn $(block).attr(attr, value)[0];\n\t\t\t\t},\n\t\t\t\ttoggleAttr: function(attr, value, block)\n\t\t\t\t{\n\t\t\t\t\tblock = this.block.getBlocks(block);\n\n\t\t\t\t\tvar self = this;\n\t\t\t\t\tvar returned = [];\n\t\t\t\t\t$.each(block, function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $el = $(s);\n\t\t\t\t\t\tif ($el.attr(attr))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturned.push(self.block.removeAttr(attr, s));\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturned.push(self.block.addAttr(attr, value, s));\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\treturn returned;\n\n\t\t\t\t},\n\t\t\t\taddAttr: function(attr, value, block)\n\t\t\t\t{\n\t\t\t\t\treturn $(this.block.getBlocks(block)).attr(attr, value)[0];\n\t\t\t\t},\n\t\t\t\tremoveAttr: function(attr, block)\n\t\t\t\t{\n\t\t\t\t\treturn $(this.block.getBlocks(block)).removeAttr(attr)[0];\n\t\t\t\t},\n\t\t\t\tremoveAllAttr: function(block)\n\t\t\t\t{\n\t\t\t\t\tblock = this.block.getBlocks(block);\n\n\t\t\t\t\tvar returned = [];\n\t\t\t\t\t$.each(block, function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (typeof s.attributes === 'undefined')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturned.push(s);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar $el = $(s);\n\t\t\t\t\t\tvar len = s.attributes.length;\n\t\t\t\t\t\tfor (var z = 0; z < len; z++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$el.removeAttr(s.attributes[z].name);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturned.push($el[0]);\n\t\t\t\t\t});\n\n\t\t\t\t\treturn returned;\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// buffer\n\t\tbuffer: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tset: function(type)\n\t\t\t\t{\n    \t\t\t\tif (typeof type === 'undefined')\n                    {\n                        this.buffer.clear();\n                    }\n\n\t\t\t\t\tif (typeof type === 'undefined' || type === 'undo')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buffer.setUndo();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buffer.setRedo();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsetUndo: function()\n\t\t\t\t{\n                    var saved = this.selection.saveInstant();\n\n\t\t\t\t\tvar last = this.opts.buffer[this.opts.buffer.length-1];\n\t\t\t\t\tvar current = this.core.editor().html();\n\n\t\t\t\t\tvar save = (typeof last !== 'undefined' && (last[0] === current)) ? false : true;\n    \t\t\t\tif (save)\n    \t\t\t\t{\n\t\t\t\t\t\tthis.opts.buffer.push([current, saved]);\n\t\t\t\t\t}\n\n\t\t\t\t\t//this.selection.restoreInstant();\n\t\t\t\t},\n\t\t\t\tsetRedo: function()\n\t\t\t\t{\n\t\t\t\t\tvar saved = this.selection.saveInstant();\n\t\t\t\t\tthis.opts.rebuffer.push([this.core.editor().html(), saved]);\n\t\t\t\t\t//this.selection.restoreInstant();\n\t\t\t\t},\n\t\t\t\tadd: function()\n\t\t\t\t{\n\t\t\t\t\tthis.opts.buffer.push([this.core.editor().html(), 0]);\n\t\t\t\t},\n\t\t\t\tundo: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.buffer.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar buffer = this.opts.buffer.pop();\n\n\t\t\t\t\tthis.buffer.set('redo');\n\t\t\t\t\tthis.core.editor().html(buffer[0]);\n\n\t\t\t\t\tthis.selection.restoreInstant(buffer[1]);\n\t\t\t\t\tthis.observe.load();\n\t\t\t\t},\n\t\t\t\tredo: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.rebuffer.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar buffer = this.opts.rebuffer.pop();\n\n\t\t\t\t\tthis.buffer.set('undo');\n\t\t\t\t\tthis.core.editor().html(buffer[0]);\n\n\t\t\t\t\tthis.selection.restoreInstant(buffer[1]);\n\t\t\t\t\tthis.observe.load();\n\t\t\t\t},\n\t\t\t\tclear: function()\n\t\t\t\t{\n    \t\t\t\tthis.opts.rebuffer = [];\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =build\n\t\tbuild: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tstart: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.type === 'inline')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.opts.type = 'inline';\n\t\t\t\t\t}\n\t\t\t\t\telse if (this.opts.type === 'div')\n\t\t\t\t\t{\n\t\t\t\t\t\t// empty\n\t\t\t\t\t\tvar html = $.trim(this.$editor.html());\n\t\t\t\t\t\tif (html === '')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.$editor.html(this.opts.emptyHtml);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (this.opts.type === 'textarea')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.build.startTextarea();\n\t\t\t\t\t}\n\n\t\t\t\t\t// set in\n\t\t\t\t\tthis.build.setIn();\n\n\t\t\t\t\t// set id\n\t\t\t\t\tthis.build.setId();\n\n\t\t\t\t\t// enable\n\t\t\t\t\tthis.build.enableEditor();\n\n\t\t\t\t\t// options\n\t\t\t\t\tthis.build.setOptions();\n\n\t\t\t\t\t// call\n\t\t\t\t\tthis.build.callEditor();\n\n\n\t\t\t\t},\n\t\t\t\tcreateContainerBox: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$box = $('<div class=\"redactor-box\" role=\"application\" />');\n\t\t\t\t},\n\t\t\t\tsetIn: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().addClass('redactor-in');\n\t\t\t\t},\n\t\t\t\tsetId: function()\n\t\t\t\t{\n\t\t\t\t\tvar id = (this.opts.type === 'textarea') ? 'redactor-uuid-' + this.uuid : this.$element.attr('id');\n\n\t\t\t\t\tthis.core.editor().attr('id', (typeof id === 'undefined') ? 'redactor-uuid-' + this.uuid : id);\n\t\t\t\t},\n\t\t\t\tgetName: function()\n\t\t\t\t{\n\t\t\t\t\tvar name = this.$element.attr('name');\n\n\t\t\t\t\treturn (typeof name === 'undefined') ? 'content-' + this.uuid : name;\n\t\t\t\t},\n\t\t\t\tloadFromTextarea: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$editor = $('<div />');\n\n\t\t\t\t\t// textarea\n\t\t\t\t\tthis.$textarea = this.$element;\n\t\t\t\t\tthis.$element.attr('name', this.build.getName());\n\n\t\t\t\t\t// place\n\t\t\t\t\tthis.$box.insertAfter(this.$element).append(this.$editor).append(this.$element);\n                    this.$editor.addClass('redactor-layer');\n\n\t\t\t\t\tif (this.opts.overrideStyles)\n\t\t\t\t\t{\n\t\t\t\t\t    this.$editor.addClass('redactor-styles');\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.$element.hide();\n\n\t\t\t\t\tthis.$box.prepend('<span class=\"redactor-voice-label\" id=\"redactor-voice-' + this.uuid +'\" aria-hidden=\"false\">' + this.lang.get('accessibility-help-label') + '</span>');\n\t\t\t\t\tthis.$editor.attr({ 'aria-labelledby': 'redactor-voice-' + this.uuid, 'role': 'presentation' });\n\t\t\t\t},\n\t\t\t\tstartTextarea: function()\n\t\t\t\t{\n\t\t\t\t\tthis.build.createContainerBox();\n\n\t\t\t\t\t// load\n\t\t\t\t\tthis.build.loadFromTextarea();\n\n\t\t\t\t\t// set code\n\t\t\t\t\tthis.code.start(this.core.textarea().val());\n\n\t\t\t\t\t// set value\n\t\t\t\t\tthis.core.textarea().val(this.clean.onSync(this.$editor.html()));\n\t\t\t\t},\n\t\t\t\tisTag: function(tag)\n\t\t\t\t{\n\t\t\t\t\treturn (this.$element[0].tagName === tag);\n\t\t\t\t},\n\t\t\t\tisInline: function()\n\t\t\t\t{\n\t\t\t\t\treturn (!this.build.isTag('TEXTAREA') && !this.build.isTag('DIV') && !this.build.isTag('PRE'));\n\t\t\t\t},\n\t\t\t\tenableEditor: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().attr({ 'contenteditable': true });\n\t\t\t\t},\n\t\t\t\tsetOptions: function()\n\t\t\t\t{\n\t\t\t\t\t// inline\n\t\t\t\t\tif (this.opts.type === 'inline')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.opts.enterKey = false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// inline & pre\n\t\t\t\t\tif (this.opts.type === 'inline' || this.opts.type === 'pre')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.opts.toolbarMobile = false;\n\t\t\t\t\t\tthis.opts.toolbar = false;\n\t\t\t\t\t\tthis.opts.air = false;\n\t\t\t\t\t\tthis.opts.linkify = false;\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// spellcheck\n\t\t\t\t\tthis.core.editor().attr('spellcheck', this.opts.spellcheck);\n\n\t\t\t\t\t// structure\n\t\t\t\t\tif (this.opts.structure)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().addClass('redactor-structure');\n\t\t\t\t\t}\n\n\t\t\t\t\t// options sets only in textarea mode\n\t\t\t\t\tif (this.opts.type !== 'textarea')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// direction\n\t\t\t\t\tthis.core.box().attr('dir', this.opts.direction);\n\t\t\t\t\tthis.core.editor().attr('dir', this.opts.direction);\n\n\t\t\t\t\t// tabindex\n\t\t\t\t\tif (this.opts.tabindex)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().attr('tabindex', this.opts.tabindex);\n\t\t\t\t\t}\n\n\t\t\t\t\t// min height\n\t\t\t\t\tif (this.opts.minHeight)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().css('min-height', this.opts.minHeight);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().css('min-height', '40px');\n\t\t\t\t\t}\n\n\t\t\t\t\t// max height\n\t\t\t\t\tif (this.opts.maxHeight)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().css('max-height', this.opts.maxHeight);\n\t\t\t\t\t}\n\n\t\t\t\t\t// max width\n\t\t\t\t\tif (this.opts.maxWidth)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().css({ 'max-width': this.opts.maxWidth, 'margin': 'auto' });\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tcallEditor: function()\n\t\t\t\t{\n\t\t\t\t\tthis.build.disableBrowsersEditing();\n\n\t\t\t\t\tthis.events.init();\n\t\t\t\t\tthis.build.setHelpers();\n\n\t\t\t\t\t// init buttons\n\t\t\t\t\tif (this.opts.toolbar || this.opts.air)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.toolbarsButtons = this.button.init();\n\t\t\t\t\t}\n\n\t\t\t\t\t// load toolbar\n\t\t\t\t\tif (this.opts.air)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.air.build();\n\t\t\t\t\t}\n\t\t\t\t\telse if (this.opts.toolbar)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.toolbar.build();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.detect.isMobile() && this.opts.toolbarMobile && this.opts.air)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.opts.toolbar = true;\n\t\t\t\t\t\tthis.toolbar.build();\n\t\t\t\t\t}\n\n\t\t\t\t\t// observe dropdowns\n\t\t\t\t\tif (this.opts.air || this.opts.toolbar)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().on('mouseup.redactor-observe.' + this.uuid + ' keyup.redactor-observe.' + this.uuid + ' focus.redactor-observe.' + this.uuid + ' touchstart.redactor-observe.' + this.uuid, $.proxy(this.observe.toolbar, this));\n\t\t\t\t\t\tthis.core.element().on('blur.callback.redactor', $.proxy(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.button.setInactiveAll();\n\n\t\t\t\t\t\t}, this));\n\t\t\t\t\t}\n\n\t\t\t\t\t// modal templates init\n\t\t\t\t\tthis.modal.templates();\n\n\t\t\t\t\t// plugins\n\t\t\t\t\tthis.build.plugins();\n\n\t\t\t\t\t// autosave\n\t\t\t\t\tthis.autosave.init();\n\n\t\t\t\t\t// sync code\n\t\t\t\t\tthis.code.html = this.code.cleaned(this.core.editor().html());\n\n\t\t\t\t\t// init callback\n\t\t\t\t\tthis.core.callback('init');\n\t\t\t\t\tthis.core.callback('initToEdit');\n\n\t\t\t\t\t// get images & files list\n\t\t\t\t\tthis.storage.observe();\n\n\t\t\t\t\t// started\n\t\t\t\t\tthis.start = false;\n\n\t\t\t\t},\n\t\t\t\tsetHelpers: function()\n\t\t\t\t{\n\t\t\t\t\t// linkify\n\t\t\t\t\tif (this.opts.linkify)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.linkify.format();\n\t\t\t\t\t}\n\n\t\t\t\t\t// placeholder\n\t\t\t\t\tthis.placeholder.init();\n\n\t\t\t\t\t// focus\n\t\t\t\t\tif (this.opts.focus)\n\t\t\t\t\t{\n\t\t\t\t\t\tsetTimeout(this.focus.start, 100);\n\t\t\t\t\t}\n\t\t\t\t\telse if (this.opts.focusEnd)\n\t\t\t\t\t{\n\t\t\t\t\t\tsetTimeout(this.focus.end, 100);\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tdisableBrowsersEditing: function()\n\t\t\t\t{\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// FF fix\n\t\t\t\t\t\tdocument.execCommand('enableObjectResizing', false, false);\n\t\t\t\t\t\tdocument.execCommand('enableInlineTableEditing', false, false);\n\t\t\t\t\t\t// IE prevent converting links\n\t\t\t\t\t\tdocument.execCommand(\"AutoUrlDetect\", false, false);\n\t\t\t\t\t} catch (e) {}\n\t\t\t\t},\n\t\t\t\tplugins: function()\n\t\t\t\t{\n\t\t\t\t\tif (!this.opts.plugins)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t$.each(this.opts.plugins, $.proxy(function(i, s)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar func = (typeof RedactorPlugins !== 'undefined' && typeof RedactorPlugins[s] !== 'undefined') ? RedactorPlugins : Redactor.fn;\n\n\t\t\t\t\t\tif (!$.isFunction(func[s]))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis[s] = func[s]();\n\n\t\t\t\t\t\t// get methods\n\t\t\t\t\t\tvar methods = this.getModuleMethods(this[s]);\n\t\t\t\t\t\tvar len = methods.length;\n\n\t\t\t\t\t\t// bind methods\n\t\t\t\t\t\tfor (var z = 0; z < len; z++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis[s][methods[z]] = this[s][methods[z]].bind(this);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// append lang\n\t\t\t\t\t\tif (typeof this[s].langs !== 'undefined')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar lang = {};\n\t\t\t\t\t\t\tif (typeof this[s].langs[this.opts.lang] !== 'undefined')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlang = this[s].langs[this.opts.lang];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if (typeof this[s].langs[this.opts.lang] === 'undefined' && typeof this[s].langs.en !== 'undefined')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlang = this[s].langs.en;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// extend\n\t\t\t\t\t\t\tvar self = this;\n\t\t\t\t\t\t\t$.each(lang, function(i,s)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (typeof self.opts.curLang[i] === 'undefined')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tself.opts.curLang[i] = s;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// init\n\t\t\t\t\t\tif ($.isFunction(this[s].init))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis[s].init();\n\t\t\t\t\t\t}\n\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =button\n\t\tbutton: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\ttoolbar: function()\n\t\t\t\t{\n\t\t\t\t\treturn (typeof this.button.$toolbar === 'undefined' || !this.button.$toolbar) ? this.$toolbar : this.button.$toolbar;\n\t\t\t\t},\n\t\t\t\tinit: function()\n\t\t\t\t{\n\t\t\t\t\treturn {\n\t\t\t\t\t\tformat:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('format'),\n\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\tdropdown:\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tp:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('paragraph'),\n\t\t\t\t\t\t\t\t\tfunc: 'block.format'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tblockquote:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('quote'),\n\t\t\t\t\t\t\t\t\tfunc: 'block.format'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tpre:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('code'),\n\t\t\t\t\t\t\t\t\tfunc: 'block.format'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\th1:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('heading1'),\n\t\t\t\t\t\t\t\t\tfunc: 'block.format'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\th2:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('heading2'),\n\t\t\t\t\t\t\t\t\tfunc: 'block.format'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\th3:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('heading3'),\n\t\t\t\t\t\t\t\t\tfunc: 'block.format'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\th4:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('heading4'),\n\t\t\t\t\t\t\t\t\tfunc: 'block.format'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\th5:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('heading5'),\n\t\t\t\t\t\t\t\t\tfunc: 'block.format'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\th6:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('heading6'),\n\t\t\t\t\t\t\t\t\tfunc: 'block.format'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tbold:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('bold-abbr'),\n\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\tlabel: this.lang.get('bold'),\n\t\t\t\t\t\t\tfunc: 'inline.format'\n\t\t\t\t\t\t},\n\t\t\t\t\t\titalic:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('italic-abbr'),\n\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\tlabel: this.lang.get('italic'),\n\t\t\t\t\t\t\tfunc: 'inline.format'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdeleted:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('deleted-abbr'),\n\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\tlabel: this.lang.get('deleted'),\n\t\t\t\t\t\t\tfunc: 'inline.format'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tunderline:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('underline-abbr'),\n\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\tlabel: this.lang.get('underline'),\n\t\t\t\t\t\t\tfunc: 'inline.format'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tlists:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('lists'),\n\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\tdropdown:\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tunorderedlist:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: '&bull; ' + this.lang.get('unorderedlist'),\n\t\t\t\t\t\t\t\t\tfunc: 'list.toggle'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\torderedlist:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: '1. ' + this.lang.get('orderedlist'),\n\t\t\t\t\t\t\t\t\tfunc: 'list.toggle'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\toutdent:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: '< ' + this.lang.get('outdent'),\n\t\t\t\t\t\t\t\t\tfunc: 'indent.decrease',\n\t\t\t\t\t\t\t\t\tobserve: {\n\t\t\t\t\t\t\t\t\t\telement: 'li',\n\t\t\t\t\t\t\t\t\t\tout: {\n\t\t\t\t\t\t\t\t\t\t\tattr: {\n\t\t\t\t\t\t\t\t\t\t\t\t'class': 'redactor-dropdown-link-inactive',\n\t\t\t\t\t\t\t\t\t\t\t\t'aria-disabled': true\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tindent:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: '> ' + this.lang.get('indent'),\n\t\t\t\t\t\t\t\t\tfunc: 'indent.increase',\n\t\t\t\t\t\t\t\t\tobserve: {\n\t\t\t\t\t\t\t\t\t\telement: 'li',\n\t\t\t\t\t\t\t\t\t\tout: {\n\t\t\t\t\t\t\t\t\t\t\tattr: {\n\t\t\t\t\t\t\t\t\t\t\t\t'class': 'redactor-dropdown-link-inactive',\n\t\t\t\t\t\t\t\t\t\t\t\t'aria-disabled': true\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tul:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: '&bull; ' + this.lang.get('bulletslist'),\n\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\tfunc: 'list.toggle'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tol:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: '1. ' + this.lang.get('numberslist'),\n\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\tfunc: 'list.toggle'\n\t\t\t\t\t\t},\n\t\t\t\t\t\toutdent:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('outdent'),\n\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\tfunc: 'indent.decrease'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tindent:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('indent'),\n\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\tfunc: 'indent.increase'\n\t\t\t\t\t\t},\n\t\t\t\t\t\timage:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('image'),\n\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\tfunc: 'image.show'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfile:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('file'),\n\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\tfunc: 'file.show'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tlink:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('link'),\n\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\tdropdown:\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlink:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('link-insert'),\n\t\t\t\t\t\t\t\t\tfunc: 'link.show',\n\t\t\t\t\t\t\t\t\tobserve: {\n\t\t\t\t\t\t\t\t\t\telement: 'a',\n\t\t\t\t\t\t\t\t\t\t'in': {\n\t\t\t\t\t\t\t\t\t\t\ttitle: this.lang.get('link-edit')\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tout: {\n\t\t\t\t\t\t\t\t\t\t\ttitle: this.lang.get('link-insert')\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tunlink:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('unlink'),\n\t\t\t\t\t\t\t\t\tfunc: 'link.unlink',\n\t\t\t\t\t\t\t\t\tobserve: {\n\t\t\t\t\t\t\t\t\t\telement: 'a',\n\t\t\t\t\t\t\t\t\t\tout: {\n\t\t\t\t\t\t\t\t\t\t\tattr: {\n\t\t\t\t\t\t\t\t\t\t\t\t'class': 'redactor-dropdown-link-inactive',\n\t\t\t\t\t\t\t\t\t\t\t\t'aria-disabled': true\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\thorizontalrule:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('horizontalrule'),\n\t\t\t\t\t\t\ticon: true,\n\t\t\t\t\t\t\tfunc: 'line.insert'\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\tsetFormatting: function()\n\t\t\t\t{\n\t\t\t\t\t$.each(this.toolbarsButtons.format.dropdown, $.proxy(function (i, s)\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($.inArray(i, this.opts.formatting) === -1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdelete this.toolbarsButtons.format.dropdown[i];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t},\n\t\t\t\thideButtons: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.buttonsHide.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.button.hideButtonsSlicer(this.opts.buttonsHide);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\thideButtonsOnMobile: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.detect.isMobile() && this.opts.buttonsHideOnMobile.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.button.hideButtonsSlicer(this.opts.buttonsHideOnMobile);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\thideButtonsSlicer: function(buttons)\n\t\t\t\t{\n\t\t\t\t\t$.each(buttons, $.proxy(function(i, s)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar index = this.opts.buttons.indexOf(s);\n\t\t\t\t\t\tif (index !== -1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t    this.opts.buttons.splice(index, 1);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\tload: function($toolbar)\n\t\t\t\t{\n\t\t\t\t\tthis.button.buttons = [];\n\n\t\t\t\t\t$.each(this.opts.buttons, $.proxy(function(i, btnName)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!this.toolbarsButtons[btnName]\n\t\t\t\t\t\t\t|| (btnName === 'file' && !this.file.is())\n\t\t\t\t\t\t\t|| (btnName === 'image' && !this.image.is()))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$toolbar.append($('<li>').append(this.button.build(btnName, this.toolbarsButtons[btnName])));\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\tbuildButtonTooltip: function($btn, title)\n\t\t\t\t{\n    \t\t\t\tif (this.opts.air || this.detect.isMobile())\n    \t\t\t\t{\n        \t\t\t\treturn;\n    \t\t\t\t}\n\n                    var $tooltip = $('<span>');\n\t\t\t\t    $tooltip.addClass('re-button-tooltip');\n\t\t\t\t    $tooltip.html(title);\n\n                    $btn.append($tooltip);\n                    $btn.on('mouseover', function()\n                    {\n                        if ($(this).hasClass('redactor-button-disabled'))\n                        {\n                            return;\n                        }\n\n                        $tooltip.show();\n                        $tooltip.css('margin-left', -($tooltip.innerWidth()/2));\n\n                    }).on('mouseout', function()\n                    {\n                        $tooltip.hide();\n                    });\n\t\t\t\t},\n\t\t\t\tbuild: function(btnName, btnObject)\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.toolbar === false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n                    var title = (typeof btnObject.label !== 'undefined') ? btnObject.label : btnObject.title;\n\t\t\t\t\tvar $button = $('<a href=\"javascript:void(null);\" alt=\"' + title + '\" rel=\"' + btnName + '\" />')\n\n                    $button.addClass('re-button re-' + btnName);\n\t\t\t\t\t$button.attr({ 'role': 'button', 'aria-label': title, 'tabindex': '-1' });\n\n                    if (typeof btnObject.icon !== 'undefined' && !this.opts.buttonsTextLabeled)\n                    {\n    \t\t\t\t\tvar $icon = $('<i>');\n\t\t\t\t\t    $icon.addClass('re-icon-' + btnName);\n\n\t\t\t\t\t    $button.append($icon);\n\t\t\t\t\t    $button.addClass('re-button-icon');\n\n                        this.button.buildButtonTooltip($button, title);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n    \t\t\t\t\t$button.html(btnObject.title);\n\t\t\t\t\t}\n\n\t\t\t\t\t// click\n\t\t\t\t\tif (btnObject.func || btnObject.command || btnObject.dropdown)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.button.setEvent($button, btnName, btnObject);\n\t\t\t\t\t}\n\n\t\t\t\t\t// dropdown\n\t\t\t\t\tif (btnObject.dropdown)\n\t\t\t\t\t{\n\t\t\t\t\t\t$button.addClass('redactor-toolbar-link-dropdown').attr('aria-haspopup', true);\n\n\t\t\t\t\t\tvar $dropdown = $('<ul class=\"redactor-dropdown redactor-dropdown-' + this.uuid + ' redactor-dropdown-box-' + btnName + '\" style=\"display: none;\">');\n\t\t\t\t\t\t$button.data('dropdown', $dropdown);\n\t\t\t\t\t\tthis.dropdown.build(btnName, $dropdown, btnObject.dropdown);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.button.buttons.push($button);\n\n\t\t\t\t\treturn $button;\n\t\t\t\t},\n\t\t\t\tgetButtons: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.button.toolbar().find('a.re-button');\n\t\t\t\t},\n\t\t\t\tgetButtonsKeys: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.button.buttons;\n\t\t\t\t},\n\t\t\t\tsetEvent: function($button, btnName, btnObject)\n\t\t\t\t{\n\t\t\t\t\t$button.on('mousedown', $.proxy(function(e)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\tif ($button.hasClass('redactor-button-disabled'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar type = 'func';\n\t\t\t\t\t\tvar callback = btnObject.func;\n\n\t\t\t\t\t\tif (btnObject.command)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype = 'command';\n\t\t\t\t\t\t\tcallback = btnObject.command;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (btnObject.dropdown)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype = 'dropdown';\n\t\t\t\t\t\t\tcallback = false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.button.toggle(e, btnName, type, callback);\n\n\t\t\t\t\t\treturn false;\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\ttoggle: function(e, btnName, type, callback, args)\n\t\t\t\t{\n\n\t\t\t\t\tif (this.detect.isIe() || !this.detect.isDesktop())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.utils.freezeScroll();\n\t\t\t\t\t\te.returnValue = false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (type === 'command')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.inline.format(callback);\n\t\t\t\t\t}\n\t\t\t\t\telse if (type === 'dropdown')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.dropdown.show(e, btnName);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.button.clickCallback(e, callback, btnName, args);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (type !== 'dropdown')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.dropdown.hideAll(false);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.opts.air && type !== 'dropdown')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.air.hide(e);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.detect.isIe() || !this.detect.isDesktop())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.utils.unfreezeScroll();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tclickCallback: function(e, callback, btnName, args)\n\t\t\t\t{\n\t\t\t\t\tvar func;\n\n\t\t\t\t\targs = (typeof args === 'undefined') ? btnName : args;\n\n\t\t\t\t\tif ($.isFunction(callback))\n\t\t\t\t\t{\n\t\t\t\t\t\tcallback.call(this, btnName);\n\t\t\t\t\t}\n\t\t\t\t\telse if (callback.search(/\\./) !== '-1')\n\t\t\t\t\t{\n\t\t\t\t\t\tfunc = callback.split('.');\n\t\t\t\t\t\tif (typeof this[func[0]] === 'undefined')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (typeof args === 'object')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis[func[0]][func[1]].apply(this, args);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis[func[0]][func[1]].call(this, args);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\n\t\t\t\t\t\tif (typeof args === 'object')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis[callback].apply(this, args);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis[callback].call(this, args);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.observe.buttons(e, btnName);\n\n\t\t\t\t},\n\t\t\t\tall: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.button.buttons;\n\t\t\t\t},\n\t\t\t\tget: function(key)\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.toolbar === false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this.button.toolbar().find('a.re-' + key);\n\t\t\t\t},\n\t\t\t\tset: function(key, title)\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.toolbar === false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $btn = this.button.toolbar().find('a.re-' + key);\n\n\t\t\t\t\t$btn.html(title).attr('aria-label', title);\n\n\t\t\t\t\treturn $btn;\n\t\t\t\t},\n\t\t\t\tadd: function(key, title)\n\t\t\t\t{\n\t\t\t\t\tif (this.button.isAdded(key) !== true)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn $();\n\t\t\t\t\t}\n\n\t\t\t\t\tvar btn = this.button.build(key, { title: title });\n\n\t\t\t\t\tthis.button.toolbar().append($('<li>').append(btn));\n\n\t\t\t\t\treturn btn;\n\t\t\t\t},\n\t\t\t\taddFirst: function(key, title)\n\t\t\t\t{\n\t\t\t\t\tif (this.button.isAdded(key) !== true)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn $();\n\t\t\t\t\t}\n\n\t\t\t\t\tvar btn = this.button.build(key, { title: title });\n\n\t\t\t\t\tthis.button.toolbar().prepend($('<li>').append(btn));\n\n\t\t\t\t\treturn btn;\n\t\t\t\t},\n\t\t\t\taddAfter: function(afterkey, key, title)\n\t\t\t\t{\n\t\t\t\t\tif (this.button.isAdded(key) !== true)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn $();\n\t\t\t\t\t}\n\n\t\t\t\t\tvar btn = this.button.build(key, { title: title });\n\t\t\t\t\tvar $btn = this.button.get(afterkey);\n\n\t\t\t\t\tif ($btn.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t$btn.parent().after($('<li>').append(btn));\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.button.toolbar().append($('<li>').append(btn));\n\t\t\t\t\t}\n\n\t\t\t\t\treturn btn;\n\t\t\t\t},\n\t\t\t\taddBefore: function(beforekey, key, title)\n\t\t\t\t{\n\t\t\t\t\tif (this.button.isAdded(key) !== true)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn $();\n\t\t\t\t\t}\n\n\t\t\t\t\tvar btn = this.button.build(key, { title: title });\n\t\t\t\t\tvar $btn = this.button.get(beforekey);\n\n\t\t\t\t\tif ($btn.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t$btn.parent().before($('<li>').append(btn));\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.button.toolbar().append($('<li>').append(btn));\n\t\t\t\t\t}\n\n\t\t\t\t\treturn btn;\n\t\t\t\t},\n\t\t\t\tisAdded: function(key)\n\t\t\t\t{\n\t                var index = this.opts.buttonsHideOnMobile.indexOf(key);\n                    if (this.opts.toolbar === false || (index !== -1 && this.detect.isMobile()))\n                    {\n\t\t\t\t\t    return false;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t\tsetIcon: function($btn, icon)\n\t\t\t\t{\n    \t\t\t\tif (!this.opts.buttonsTextLabeled)\n    \t\t\t\t{\n    \t\t\t\t\t$btn.html(icon).addClass('re-button-icon');\n\t\t\t\t\t    this.button.buildButtonTooltip($btn, $btn.attr('alt'));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tchangeIcon: function(key, newIconClass)\n\t\t\t\t{\n                    var $btn = this.button.get(key);\n                    if ($btn.length !== 0)\n\t\t\t\t\t{\n    \t\t\t\t\t$btn.find('i').removeAttr('class').addClass('re-icon-' + newIconClass);\n    \t\t\t\t}\n\t\t\t\t},\n\t\t\t\taddCallback: function($btn, callback)\n\t\t\t\t{\n\t\t\t\t\tif (typeof $btn === 'undefined' || this.opts.toolbar === false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar type = (callback === 'dropdown') ? 'dropdown' : 'func';\n\t\t\t\t\tvar key = $btn.attr('rel');\n\t\t\t\t\t$btn.on('mousedown', $.proxy(function(e)\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($btn.hasClass('redactor-button-disabled'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.button.toggle(e, key, type, callback);\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\taddDropdown: function($btn, dropdown)\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.toolbar === false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t$btn.addClass('redactor-toolbar-link-dropdown').attr('aria-haspopup', true);\n\n\t\t\t\t\tvar key = $btn.attr('rel');\n\t\t\t\t\tthis.button.addCallback($btn, 'dropdown');\n\n\t\t\t\t\tvar $dropdown = $('<div class=\"redactor-dropdown redactor-dropdown-' + this.uuid + ' redactor-dropdown-box-' + key + '\" style=\"display: none;\">');\n\t\t\t\t\t$btn.data('dropdown', $dropdown);\n\n\t\t\t\t\t// build dropdown\n\t\t\t\t\tif (dropdown)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.dropdown.build(key, $dropdown, dropdown);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn $dropdown;\n\t\t\t\t},\n\t\t\t\tsetActive: function(key)\n\t\t\t\t{\n\t\t\t\t\tthis.button.get(key).addClass('redactor-act');\n\t\t\t\t},\n\t\t\t\tsetInactive: function(key)\n\t\t\t\t{\n\t\t\t\t\tthis.button.get(key).removeClass('redactor-act');\n\t\t\t\t},\n\t\t\t\tsetInactiveAll: function(key)\n\t\t\t\t{\n\t\t\t\t\tvar $btns = this.button.toolbar().find('a.re-button');\n\n\t\t\t\t\tif (typeof key !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\t$btns = $btns.not('.re-' + key);\n\t\t\t\t\t}\n\n\t\t\t\t\t$btns.removeClass('redactor-act');\n\t\t\t\t},\n\t\t\t\tdisable: function(key)\n\t\t\t\t{\n\t\t\t\t\tthis.button.get(key).addClass('redactor-button-disabled');\n\t\t\t\t},\n\t\t\t\tenable: function(key)\n\t\t\t\t{\n\t\t\t\t\tthis.button.get(key).removeClass('redactor-button-disabled');\n\t\t\t\t},\n\t\t\t\tdisableAll: function(key)\n\t\t\t\t{\n\t\t\t\t\tvar $btns = this.button.toolbar().find('a.re-button');\n\t\t\t\t\tif (typeof key !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\t$btns = $btns.not('.re-' + key);\n\t\t\t\t\t}\n\n\t\t\t\t\t$btns.addClass('redactor-button-disabled');\n\t\t\t\t},\n\t\t\t\tenableAll: function()\n\t\t\t\t{\n\t\t\t\t\tthis.button.toolbar().find('a.re-button').removeClass('redactor-button-disabled');\n\t\t\t\t},\n\t\t\t\tremove: function(key)\n\t\t\t\t{\n\t\t\t\t\tthis.button.get(key).remove();\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =caret\n\t\tcaret: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tset: function(node1, node2, end)\n\t\t\t\t{\n                    var cs = this.core.editor().scrollTop();\n                    this.core.editor().focus();\n                    this.core.editor().scrollTop(cs);\n\n\t\t\t\t\tend = (typeof end === 'undefined') ? 0 : 1;\n\n\t\t\t\t\tnode1 = node1[0] || node1;\n\t\t\t\t\tnode2 = node2[0] || node2;\n\n\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\tvar range = this.selection.range(sel);\n\n\t\t\t\t\ttry\n\t\t\t\t\t{\n\t\t\t\t\t\trange.setStart(node1, 0);\n\t\t\t\t\t\trange.setEnd(node2, end);\n\t\t\t\t\t}\n\t\t\t\t\tcatch (e) {}\n\n\t\t\t\t\tthis.selection.update(sel, range);\n\t\t\t\t},\n\t\t\t\tprepare: function(node)\n\t\t\t\t{\n\t\t\t\t\t// firefox focus\n\t\t\t\t\tif (this.detect.isFirefox() && typeof this.start !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().focus();\n\t\t\t\t\t}\n\n\t\t\t\t\treturn node[0] || node;\n\t\t\t\t},\n\t\t\t\tstart: function(node)\n\t\t\t\t{\n\t\t\t\t\tvar sel, range;\n\t\t\t\t\tnode = this.caret.prepare(node);\n\n\t\t\t\t\tif (!node)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (node.tagName === 'BR')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.caret.before(node);\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $first = $(node).children().first();\n\n\t\t\t\t\t// empty or inline tag\n\t\t\t\t\tvar inline = this.utils.isInlineTag(node.tagName);\n\t\t\t\t\tif (node.innerHTML === '' || inline)\n\t\t\t\t\t{\n                        this.caret.setStartEmptyOrInline(node, inline);\n\t\t\t\t\t}\n\t\t\t\t\t// empty inline inside\n                    else if ($first && $first.length !== 0 && this.utils.isInlineTag($first[0].tagName) && $first.text() === '')\n                    {\n                       this.caret.setStartEmptyOrInline($first[0], true);\n                    }\n                    // block tag\n\t\t\t\t\telse\n\t\t\t\t\t{\n                        sel = window.getSelection();\n                        sel.removeAllRanges();\n\n                        range = document.createRange();\n                        range.selectNodeContents(node);\n                        range.collapse(true);\n                        sel.addRange(range);\n\t\t\t\t\t}\n\n\n\t\t\t\t},\n\t\t\t\tsetStartEmptyOrInline: function(node, inline)\n\t\t\t\t{\n                    var sel = window.getSelection();\n\t\t\t\t    var range = document.createRange();\n\t\t\t\t\tvar textNode = document.createTextNode('\\u200B');\n\n\t\t\t\t\trange.setStart(node, 0);\n\t\t\t\t\trange.insertNode(textNode);\n\t\t\t\t\trange.setStartAfter(textNode);\n\t\t\t\t\trange.collapse(true);\n\n\t\t\t\t\tsel.removeAllRanges();\n\t\t\t\t\tsel.addRange(range);\n\n\t\t\t\t\t// remove invisible text node\n\t\t\t\t\tif (!inline)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().on('keydown.redactor-remove-textnode', function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$(textNode).remove();\n\t\t\t\t\t\t\t$(this).off('keydown.redactor-remove-textnode');\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tend: function(node)\n\t\t\t\t{\n\t\t\t\t\tvar sel, range;\n\t\t\t\t\tnode = this.caret.prepare(node);\n\n\t\t\t\t\tif (!node)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// empty node\n\t\t\t\t\tif (node.tagName !== 'BR' && node.innerHTML === '')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.caret.start(node);\n\t\t\t\t\t}\n\n\t\t\t\t\t// br\n\t\t\t\t\tif (node.tagName === 'BR')\n\t\t\t\t\t{\n\t\t\t\t\t\tvar space = document.createElement('span');\n\t\t\t\t\t\tspace.className = 'redactor-invisible-space';\n\t\t\t\t\t\tspace.innerHTML = '&#x200b;';\n\n\t\t\t\t\t\t$(node).after(space);\n\n\t\t\t\t\t\tsel = window.getSelection();\n\t\t\t\t\t\tsel.removeAllRanges();\n\n\t\t\t\t\t\trange = document.createRange();\n\n\t\t\t\t\t\trange.setStartBefore(space);\n\t\t\t\t\t\trange.setEndBefore(space);\n\t\t\t\t\t\tsel.addRange(range);\n\n\t\t\t\t\t\t$(space).replaceWith(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn $(this).contents();\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (node.lastChild && node.lastChild.nodeType === 1)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.caret.after(node.lastChild);\n\t\t\t\t\t}\n\n                    var sel = window.getSelection();\n                    if (sel.getRangeAt || sel.rangeCount)\n                    {\n                        try {\n                            var range = sel.getRangeAt(0);\n                            range.selectNodeContents(node);\n                            range.collapse(false);\n\n                            sel.removeAllRanges();\n                            sel.addRange(range);\n                        }\n                        catch(e) {}\n                    }\n\t\t\t\t},\n\t\t\t\tafter: function(node)\n\t\t\t\t{\n\t\t\t\t\tvar sel, range;\n\t\t\t\t\tnode = this.caret.prepare(node);\n\n\n\t\t\t\t\tif (!node)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (node.tagName === 'BR')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.caret.end(node);\n\t\t\t\t\t}\n\n\t\t\t\t\t// block tag\n\t\t\t\t\tif (this.utils.isBlockTag(node.tagName))\n\t\t\t\t\t{\n\t\t\t\t\t\tvar next = this.caret.next(node);\n\n\t\t\t\t\t\tif (typeof next === 'undefined')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.caret.end(node);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t// table\n\t\t\t\t\t\t\tif (next.tagName === 'TABLE')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tnext = $(next).find('th, td').first()[0];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// list\n\t\t\t\t\t\t\telse if (next.tagName === 'UL' || next.tagName === 'OL')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tnext = $(next).find('li').first()[0];\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.caret.start(next);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// inline tag\n\t\t\t\t\tvar textNode = document.createTextNode('\\u200B');\n\n\t\t\t\t\tsel = window.getSelection();\n\t\t\t\t\tsel.removeAllRanges();\n\n\t\t\t\t\trange = document.createRange();\n\t\t\t\t\trange.setStartAfter(node);\n\t\t\t\t\trange.insertNode(textNode);\n\t\t\t\t\trange.setStartAfter(textNode);\n\t\t\t\t\trange.collapse(true);\n\n\t\t\t\t\tsel.addRange(range);\n\n\t\t\t\t},\n\t\t\t\tbefore: function(node)\n\t\t\t\t{\n\t\t\t\t\tvar sel, range;\n\t\t\t\t\tnode = this.caret.prepare(node);\n\n\n\t\t\t\t\tif (!node)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// block tag\n\t\t\t\t\tif (this.utils.isBlockTag(node.tagName))\n\t\t\t\t\t{\n\t\t\t\t\t\tvar prev = this.caret.prev(node);\n\n\t\t\t\t\t\tif (typeof prev === 'undefined')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.caret.start(node);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t// table\n\t\t\t\t\t\t\tif (prev.tagName === 'TABLE')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tprev = $(prev).find('th, td').last()[0];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// list\n\t\t\t\t\t\t\telse if (prev.tagName === 'UL' || prev.tagName === 'OL')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tprev = $(prev).find('li').last()[0];\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.caret.end(prev);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// inline tag\n\t\t\t\t\tsel = window.getSelection();\n\t\t\t\t\tsel.removeAllRanges();\n\n\t\t\t\t\trange = document.createRange();\n\n\t\t\t        range.setStartBefore(node);\n\t\t\t        range.collapse(true);\n\n\t\t\t        sel.addRange(range);\n\t\t\t\t},\n\t\t\t\tnext: function(node)\n\t\t\t\t{\n\t\t\t\t\tvar $next = $(node).next();\n\t\t\t\t\tif ($next.hasClass('redactor-script-tag, redactor-selection-marker'))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn $next.next()[0];\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\treturn $next[0];\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tprev: function(node)\n\t\t\t\t{\n\t\t\t\t\tvar $prev = $(node).prev();\n\t\t\t\t\tif ($prev.hasClass('redactor-script-tag, redactor-selection-marker'))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn $prev.prev()[0];\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\treturn $prev[0];\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\t// #backward\n\t\t\t\toffset: function(node)\n\t\t\t\t{\n\t\t\t\t\treturn this.offset.get(node);\n\t\t\t\t}\n\n\t\t\t};\n\t\t},\n\n\t\t// =clean\n\t\tclean: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tonSet: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = this.clean.savePreCode(html);\n\t\t\t\t\thtml = this.clean.saveFormTags(html);\n\n\t\t\t\t\t// convert script tag\n\t\t\t\t\tif (this.opts.script)\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(/<script(.*?[^>]?)>([\\w\\W]*?)<\\/script>/gi, '<pre class=\"redactor-script-tag\" $1>$2</pre>');\n\t\t\t\t\t}\n\n\t\t\t\t\t// converting entity\n\t\t\t\t\thtml = html.replace(/\\$/g, '&#36;');\n\t\t\t\t\thtml = html.replace(/&amp;/g, '&');\n\n\t\t\t\t\t// replace special characters in links\n\t\t\t\t\thtml = html.replace(/<a href=\"(.*?[^>]?)®(.*?[^>]?)\">/gi, '<a href=\"$1&reg$2\">');\n\n\t\t\t\t\t// save markers\n\t\t\t\t\thtml = html.replace(/<span id=\"selection-marker-1\"(.*?[^>]?)>​<\\/span>/gi, '###marker1###');\n\t\t\t\t\thtml = html.replace(/<span id=\"selection-marker-2\"(.*?[^>]?)>​<\\/span>/gi, '###marker2###');\n\n\t\t\t\t\t// replace tags\n\t\t\t\t\tvar self = this;\n\t\t\t\t\tvar $div = $(\"<div/>\").html($.parseHTML(html, document, true));\n\n\t\t\t\t\tvar replacement = this.opts.replaceTags;\n\t\t\t\t\tif (replacement)\n\t\t\t\t\t{\n                        var keys = Object.keys(this.opts.replaceTags);\n    \t\t\t\t\t$div.find(keys.join(',')).each(function(i,s)\n    \t\t\t\t\t{\n    \t\t\t\t\t\tself.utils.replaceToTag(s, replacement[s.tagName.toLowerCase()]);\n    \t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\t// add span marker\n\t\t\t\t\t$div.find('span, a').attr('data-redactor-span', true);\n\n\t\t\t\t\t// add style cache\n\t\t\t\t\t$div.find(this.opts.inlineTags.join(',')).each(function()\n\t\t\t\t\t{\n    \t\t\t\t\t// add style cache\n    \t\t\t\t\tvar $el = $(this);\n\n    \t\t\t\t\tif ($el.attr('style'))\n    \t\t\t\t\t{\n        \t\t\t\t\t$el.attr('data-redactor-style-cache', $el.attr('style'));\n    \t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\thtml = $div.html();\n\n\t\t\t\t\t// remove tags\n\t\t\t\t\tvar tags = ['font', 'html', 'head', 'link', 'body', 'meta', 'applet'];\n\t\t\t\t\tif (!this.opts.script)\n\t\t\t\t\t{\n\t\t\t\t\t\ttags.push('script');\n\t\t\t\t\t}\n\n\t\t\t\t\thtml = this.clean.stripTags(html, tags);\n\n\t\t\t\t\t// remove html comments\n\t\t\t\t\tif (this.opts.removeComments)\n\t\t\t\t\t{\n\t\t\t\t\t    html = html.replace(/<!--[\\s\\S]*?-->/gi, '');\n\t\t\t\t\t}\n\n\t\t\t\t\t// paragraphize\n\t\t\t\t\thtml = this.paragraphize.load(html);\n\n\t\t\t\t\t// restore markers\n\t\t\t\t\thtml = html.replace('###marker1###', '<span id=\"selection-marker-1\" class=\"redactor-selection-marker\">​</span>');\n\t\t\t\t\thtml = html.replace('###marker2###', '<span id=\"selection-marker-2\" class=\"redactor-selection-marker\">​</span>');\n\n\t\t\t\t\t// empty\n\t\t\t\t\tif (html.search(/^(||\\s||<br\\s?\\/?>||&nbsp;)$/i) !== -1)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.opts.emptyHtml;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tonGet: function(html)\n\t\t\t\t{\n\t\t\t\t\treturn this.clean.onSync(html);\n\t\t\t\t},\n\t\t\t\tonSync: function(html)\n\t\t\t\t{\n\t\t\t\t\t// remove invisible spaces\n\t\t\t\t\thtml = html.replace(/\\u200B/g, '');\n\t\t\t\t\thtml = html.replace(/&#x200b;/gi, '');\n\t\t\t\t\t//html = html.replace(/&nbsp;&nbsp;/gi, '&nbsp;');\n\n\t\t\t\t\tif (html.search(/^<p>(||\\s||<br\\s?\\/?>||&nbsp;)<\\/p>$/i) !== -1)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn '';\n\t\t\t\t\t}\n\n\t\t\t\t\t// remove image resize\n\t\t\t\t\thtml = html.replace(/<span(.*?)id=\"redactor-image-box\"(.*?[^>])>([\\w\\W]*?)<img(.*?)><\\/span>/gi, '$3<img$4>');\n\t\t\t\t\thtml = html.replace(/<span(.*?)id=\"redactor-image-resizer\"(.*?[^>])>(.*?)<\\/span>/gi, '');\n\t\t\t\t\thtml = html.replace(/<span(.*?)id=\"redactor-image-editter\"(.*?[^>])>(.*?)<\\/span>/gi, '');\n\t\t\t\t\thtml = html.replace(/<img(.*?)style=\"(.*?)opacity: 0\\.5;(.*?)\"(.*?)>/gi, '<img$1style=\"$2$3\"$4>');\n\n\t\t\t\t\tvar $div = $(\"<div/>\").html($.parseHTML(html, document, true));\n\n\t\t\t\t\t// remove empty atributes\n\t\t\t\t\t$div.find('*[style=\"\"]').removeAttr('style');\n\t\t\t\t\t$div.find('*[class=\"\"]').removeAttr('class');\n\t\t\t\t\t$div.find('*[rel=\"\"]').removeAttr('rel');\n\t\t\t\t\t$div.find('*[data-image=\"\"]').removeAttr('data-image');\n\t\t\t\t\t$div.find('*[alt=\"\"]').removeAttr('alt');\n\t\t\t\t\t$div.find('*[title=\"\"]').removeAttr('title');\n\t\t\t\t\t$div.find('*[data-redactor-style-cache]').removeAttr('data-redactor-style-cache');\n\n\t\t\t\t\t// remove markers\n\t\t\t\t\t$div.find('.redactor-invisible-space, .redactor-unlink').each(function()\n\t\t\t\t\t{\n\t\t\t\t\t\t$(this).contents().unwrap();\n\t\t\t\t\t});\n\n\t\t\t\t\t// remove span without attributes & span marker\n\t\t\t\t    $div.find('span, a').removeAttr('data-redactor-span data-redactor-style-cache').each(function()\n\t\t\t\t\t{\n    \t\t\t\t\tif (this.attributes.length === 0)\n    \t\t\t\t\t{\n\t\t\t\t\t\t    $(this).contents().unwrap();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t// remove rel attribute from img\n\t\t\t\t\t$div.find('img').removeAttr('rel');\n\n\t\t\t\t\t$div.find('.redactor-selection-marker, #redactor-insert-marker').remove();\n\n\t\t\t\t\thtml = $div.html();\n\n\t\t\t\t\t// reconvert script tag\n\t\t\t\t\tif (this.opts.script)\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(/<pre class=\"redactor-script-tag\"(.*?[^>]?)>([\\w\\W]*?)<\\/pre>/gi, '<script$1>$2</script>');\n\t\t\t\t\t}\n\n\t\t\t\t\t// restore form tag\n\t\t\t\t\thtml = this.clean.restoreFormTags(html);\n\n\t\t\t\t\t// remove br in|of li/header tags\n\t\t\t\t\thtml = html.replace(new RegExp('<br\\\\s?/?></h', 'gi'), '</h');\n\t\t\t\t\thtml = html.replace(new RegExp('<br\\\\s?/?></li>', 'gi'), '</li>');\n\t\t\t\t\thtml = html.replace(new RegExp('</li><br\\\\s?/?>', 'gi'), '</li>');\n\n\t\t\t\t\t// pre class\n\t\t\t\t\thtml = html.replace(/<pre>/gi, \"<pre>\\n\");\n\t\t\t\t\tif (this.opts.preClass)\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(/<pre>/gi, '<pre class=\"' + this.opts.preClass + '\">');\n\t\t\t\t\t}\n\n\t\t\t\t\t// link nofollow\n\t\t\t\t\tif (this.opts.linkNofollow)\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(/<a(.*?)rel=\"nofollow\"(.*?[^>])>/gi, '<a$1$2>');\n\t\t\t\t\t\thtml = html.replace(/<a(.*?[^>])>/gi, '<a$1 rel=\"nofollow\">');\n\t\t\t\t\t}\n\n\t\t\t\t\t// replace special characters\n\t\t\t\t\tvar chars = {\n\t\t\t\t\t\t'\\u2122': '&trade;',\n\t\t\t\t\t\t'\\u00a9': '&copy;',\n\t\t\t\t\t\t'\\u2026': '&hellip;',\n\t\t\t\t\t\t'\\u2014': '&mdash;',\n\t\t\t\t\t\t'\\u2010': '&dash;'\n\t\t\t\t\t};\n\n\t\t\t\t\t$.each(chars, function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(new RegExp(i, 'g'), s);\n\t\t\t\t\t});\n\n\t\t\t\t\thtml = html.replace(/&amp;/g, '&');\n\n\t\t\t\t\t// remove empty paragpraphs\n\t\t\t\t\t//html = html.replace(/<p><\\/p>/gi, \"\");\n\n\t\t\t\t\t// remove new lines\n                    html = html.replace(/\\n{2,}/g, \"\\n\");\n\n                    // remove all newlines\n                    if (this.opts.removeNewlines)\n                    {\n                        html = html.replace(/\\r?\\n/g, \"\");\n                    }\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tonPaste: function(html, data, insert)\n\t\t\t\t{\n\t\t\t\t\t// if paste event\n\t\t\t\t\tif (insert !== true)\n\t\t\t\t\t{\n    \t\t\t\t\t// remove google docs markers\n                        html = html.replace(/<b\\sid=\"internal-source-marker(.*?)\">([\\w\\W]*?)<\\/b>/gi, \"$2\");\n    \t\t\t\t\thtml = html.replace(/<b(.*?)id=\"docs-internal-guid(.*?)\">([\\w\\W]*?)<\\/b>/gi, \"$3\");\n\n                        // google docs styles\n                        html = html.replace(/<span[^>]*(font-style: italic; font-weight: bold|font-weight: bold; font-style: italic)[^>]*>([\\w\\W]*?)<\\/span>/gi, '<b><i>$2</i></b>');\n                        html = html.replace(/<span[^>]*(font-style: italic; font-weight: 700|font-weight: 700; font-style: italic)[^>]*>([\\w\\W]*?)<\\/span>/gi, '<b><i>$2</i></b>');\n                        html = html.replace(/<span[^>]*font-style: italic[^>]*>([\\w\\W]*?)<\\/span>/gi, '<i>$1</i>');\n                        html = html.replace(/<span[^>]*font-weight: bold[^>]*>([\\w\\W]*?)<\\/span>/gi, '<b>$1</b>');\n                        html = html.replace(/<span[^>]*font-weight: 700[^>]*>([\\w\\W]*?)<\\/span>/gi, '<b>$1</b>');\n\n                        // op tag\n                        html = html.replace(/<o:p[^>]*>/gi, '');\n                        html = html.replace(/<\\/o:p>/gi, '');\n\n\t\t\t\t\t\tvar msword = this.clean.isHtmlMsWord(html);\n\t\t\t\t\t\tif (msword)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\thtml = this.clean.cleanMsWord(html);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\thtml = $.trim(html);\n\n\t\t\t\t\tif (data.pre)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.opts.preSpaces)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\thtml = html.replace(/\\t/g, new Array(this.opts.preSpaces + 1).join(' '));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\n\t\t\t\t\t\thtml = this.clean.replaceBrToNl(html);\n\t\t\t\t\t\thtml = this.clean.removeTagsInsidePre(html);\n\t\t\t\t\t}\n\n\t\t\t\t\t// if paste event\n\t\t\t\t\tif (insert !== true)\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = this.clean.removeEmptyInlineTags(html);\n\n\t\t\t\t\t\tif (data.encode === false)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\thtml = html.replace(/&/g, '&amp;');\n\t\t\t\t\t\t\thtml = this.clean.convertTags(html, data);\n\t\t\t\t\t\t\thtml = this.clean.getPlainText(html);\n\t\t\t\t\t\t\thtml = this.clean.reconvertTags(html, data);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif (data.text)\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = this.clean.replaceNbspToSpaces(html);\n\t\t\t\t\t\thtml = this.clean.getPlainText(html);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (data.lists)\n\t\t\t\t\t{\n    \t\t\t\t\thtml = html.replace(\"\\n\", '<br>');\n    \t\t\t\t}\n\n\t\t\t\t\tif (data.encode)\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = this.clean.encodeHtml(html);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (data.paragraphize)\n\t\t\t\t\t{\n    \t\t\t\t\t// ff bugfix\n                        html = html.replace(/ \\n/g, ' ');\n                        html = html.replace(/\\n /g, ' ');\n\n\t\t\t\t\t\thtml = this.paragraphize.load(html);\n\n\t\t\t\t\t\t// remove empty p\n\t\t\t\t\t\thtml = html.replace(/<p><\\/p>/g, '');\n\t\t\t\t\t}\n\n\t\t\t\t\treturn html;\n\n\t\t\t\t},\n\t\t\t\tgetCurrentType: function(html, insert)\n\t\t\t\t{\n\t\t\t\t\tvar blocks = this.selection.blocks();\n\n\t\t\t\t\tvar data = {\n\t\t\t\t\t\ttext: false,\n\t\t\t\t\t\tencode: false,\n\t\t\t\t\t\tparagraphize: true,\n\t\t\t\t\t\tline: this.clean.isHtmlLine(html),\n\t\t\t\t\t\tblocks: this.clean.isHtmlBlocked(html),\n\t\t\t\t\t\tpre: false,\n\t\t\t\t\t\tlists: false,\n\t\t\t\t\t\tblock: true,\n\t\t\t\t\t\tinline: true,\n\t\t\t\t\t\tlinks: true,\n\t\t\t\t\t\timages: true\n\t\t\t\t\t};\n\n\t\t\t\t\tif (blocks.length === 1 && this.utils.isCurrentOrParent(['h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'a', 'figcaption']))\n\t\t\t\t\t{\n\t\t\t\t\t\tdata.text = true;\n\t\t\t\t\t\tdata.paragraphize = false;\n\t\t\t\t\t\tdata.inline = false;\n\t\t\t\t\t\tdata.images = false;\n\t\t\t\t\t\tdata.links = false;\n\t\t\t\t\t\tdata.line = true;\n\t\t\t\t\t}\n\t\t\t\t\telse if (this.opts.type === 'inline' || this.opts.enterKey === false)\n\t\t\t\t\t{\n\t\t\t\t\t\tdata.paragraphize = false;\n\t\t\t\t\t\tdata.block = false;\n\t\t\t\t\t\tdata.line = true;\n\t\t\t\t\t}\n\t\t\t\t\telse if (blocks.length === 1 && this.utils.isCurrentOrParent(['li']))\n\t\t\t\t\t{\n\t\t\t\t\t\tdata.lists = true;\n\t\t\t\t\t\tdata.block = false;\n\t\t\t\t\t\tdata.paragraphize = false;\n\t\t\t\t\t\tdata.images = false;\n\t\t\t\t\t}\n\t\t\t\t\telse if (blocks.length === 1 && this.utils.isCurrentOrParent(['th', 'td', 'blockquote']))\n\t\t\t\t\t{\n\t\t\t\t\t\tdata.block = false;\n\t\t\t\t\t\tdata.paragraphize = false;\n\n\t\t\t\t\t}\n\t\t\t\t\telse if (this.opts.type === 'pre' || (blocks.length === 1 && this.utils.isCurrentOrParent('pre')))\n\t\t\t\t\t{\n\t\t\t\t\t\tdata.inline = false;\n\t\t\t\t\t\tdata.block = false;\n\t\t\t\t\t\tdata.encode = true;\n\t\t\t\t\t\tdata.pre = true;\n\t\t\t\t\t\tdata.paragraphize = false;\n\t\t\t\t\t\tdata.images = false;\n\t\t\t\t\t\tdata.links = false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (data.line === true)\n\t\t\t\t\t{\n\t\t\t\t\t\tdata.paragraphize = false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (insert === true)\n\t\t\t\t\t{\n\t\t\t\t\t\tdata.text = false;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn data;\n\n\t\t\t\t},\n\t\t\t\tisHtmlBlocked: function(html)\n\t\t\t\t{\n\t\t\t\t\tvar match1 = html.match(new RegExp('</(' + this.opts.blockTags.join('|' ).toUpperCase() + ')>', 'gi'));\n\t\t\t\t\tvar match2 = html.match(new RegExp('<hr(.*?[^>])>', 'gi'));\n\n\t\t\t\t\treturn (match1 === null && match2 === null) ? false : true;\n\t\t\t\t},\n\t\t\t\tisHtmlLine: function(html)\n\t\t\t\t{\n\t\t\t\t\tif (this.clean.isHtmlBlocked(html))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar matchBR = html.match(/<br\\s?\\/?>/gi);\n\t\t\t\t\tvar matchNL = html.match(/\\n/gi);\n\n\t\t\t\t\treturn (!matchBR && !matchNL) ? true : false;\n\t\t\t\t},\n\t\t\t\tisHtmlMsWord: function(html)\n\t\t\t\t{\n\t\t\t\t\treturn html.match(/class=\"?Mso|style=\"[^\"]*\\bmso-|style='[^'']*\\bmso-|w:WordDocument/i);\n\t\t\t\t},\n\t\t\t\tremoveEmptyInlineTags: function(html)\n\t\t\t\t{\n\t\t\t\t\tvar tags = this.opts.inlineTags;\n    \t\t\t\tvar $div = $(\"<div/>\").html($.parseHTML(html, document, true));\n                    var self = this;\n\n\t\t\t\t\tvar $spans = $div.find('span');\n\t\t\t\t\tvar $tags = $div.find(tags.join(','));\n\n\t\t\t\t\t$tags.removeAttr('style');\n\n\t\t\t\t\t$tags.each(function()\n\t\t\t\t\t{\n    \t\t\t\t\tvar tagHtml = $(this).html();\n    \t\t\t\t\tif (this.attributes.length === 0 && self.utils.isEmpty(tagHtml))\n    \t\t\t\t\t{\n        \t\t\t\t\t$(this).replaceWith(function()\n        \t\t\t\t\t{\n        \t\t\t\t\t\treturn $(this).contents();\n        \t\t\t\t\t});\n    \t\t\t\t\t}\n\t\t\t\t\t});\n\n                    $spans.each(function()\n\t\t\t\t\t{\n    \t\t\t\t\tvar tagHtml = $(this).html();\n    \t\t\t\t\tif (this.attributes.length === 0)\n    \t\t\t\t\t{\n        \t\t\t\t\t$(this).replaceWith(function()\n        \t\t\t\t\t{\n        \t\t\t\t\t\treturn $(this).contents();\n        \t\t\t\t\t});\n    \t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\thtml = $div.html();\n\n\t\t\t\t\t// convert php tags\n\t\t\t\t\thtml = html.replace('<!--?php', '<?php');\n\t\t\t\t\thtml = html.replace('<!--?', '<?');\n\t\t\t\t\thtml = html.replace('?-->', '?>');\n\n\t\t\t\t\t$div.remove();\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tcleanMsWord: function(html)\n\t\t\t\t{\n    \t\t\t\thtml = html.replace(/<!--[\\s\\S]*?-->/g, \"\");\n    \t\t\t\thtml = html.replace(/<o:p>[\\s\\S]*?<\\/o:p>/gi, '');\n\t\t\t\t\thtml = html.replace(/\\n/g, \" \");\n\t\t\t\t\thtml = html.replace(/<br\\s?\\/?>|<\\/p>|<\\/div>|<\\/li>|<\\/td>/gi, '\\n\\n');\n\n\t\t\t\t\t// lists\n\t\t\t\t\tvar $div = $(\"<div/>\").html(html);\n\n\t\t\t\t\tvar lastList = false;\n\t\t\t\t\tvar lastLevel = 1;\n\t\t\t\t\tvar listsIds = [];\n\n\t\t\t\t\t$div.find(\"p[style]\").each(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tvar matches = $(this).attr('style').match(/mso\\-list\\:l([0-9]+)\\slevel([0-9]+)/);\n\n\t\t\t\t\t\tif (matches)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar currentList = parseInt(matches[1]);\n\t\t\t\t\t\t\tvar currentLevel = parseInt(matches[2]);\n\t\t\t\t\t\t\tvar listType = $(this).html().match(/^[\\w]+\\./) ? \"ol\" : \"ul\";\n\n\t\t\t\t\t\t\tvar $li = $(\"<li/>\").html($(this).html());\n\n\t\t\t\t\t\t\t$li.html($li.html().replace(/^([\\w\\.]+)</, '<'));\n\t\t\t\t\t\t\t$li.find(\"span:first\").remove();\n\n\t\t\t\t\t\t\tif (currentLevel == 1 && $.inArray(currentList, listsIds) == -1)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvar $list = $(\"<\" + listType + \"/>\").attr({\"data-level\": currentLevel, \"data-list\": currentList}).html($li);\n\t\t\t\t\t\t\t\t$(this).replaceWith($list);\n\n\t\t\t\t\t\t\t\tlastList = currentList;\n\t\t\t\t\t\t\t\tlistsIds.push(currentList);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (currentLevel > lastLevel)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tvar $prevList = $div.find('[data-level=\"' + lastLevel + '\"][data-list=\"' + lastList + '\"]');\n\t\t\t\t\t\t\t\t\tvar $lastList = $prevList;\n\n\t\t\t\t\t\t\t\t\tfor(var i = lastLevel; i < currentLevel; i++)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t$list = $(\"<\" + listType + \"/>\");\n\t\t\t\t\t\t\t\t\t\t$list.appendTo($lastList.find(\"li\").last());\n\n\t\t\t\t\t\t\t\t\t\t$lastList = $list;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t$lastList.attr({\"data-level\": currentLevel, \"data-list\": currentList}).html($li);\n\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tvar $prevList = $div.find('[data-level=\"' + currentLevel + '\"][data-list=\"' + currentList + '\"]').last();\n\n\t\t\t\t\t\t\t\t\t$prevList.append($li);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tlastLevel = currentLevel;\n\t\t\t\t\t\t\t\tlastList = currentList;\n\n\t\t\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t$div.find('[data-level][data-list]').removeAttr('data-level data-list');\n\t\t\t\t\thtml = $div.html();\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\treplaceNbspToSpaces: function(html)\n\t\t\t\t{\n\t\t\t\t\treturn html.replace('&nbsp;', ' ');\n\t\t\t\t},\n\t\t\t\treplaceBrToNl: function(html)\n\t\t\t\t{\n\t\t\t\t\treturn html.replace(/<br\\s?\\/?>/gi, '\\n');\n\t\t\t\t},\n\t\t\t\treplaceNlToBr: function(html)\n\t\t\t\t{\n\t\t\t\t\treturn html.replace(/\\n/g, '<br />');\n\t\t\t\t},\n\t\t\t\tconvertTags: function(html, data)\n\t\t\t\t{\n                    var $div = $('<div>').html(html);\n\n                    // remove iframe\n\t\t\t\t\t$div.find('iframe').remove();\n\n\t\t\t\t\t// link target & attrs\n\t\t\t\t\tvar $links = $div.find('a');\n\t\t\t\t\t$links.removeAttr('style');\n\t\t\t\t\tif (this.opts.pasteLinkTarget !== false)\n\t\t\t\t\t{\n    \t\t\t\t\t$links.attr('target', this.opts.pasteLinkTarget);\n\t\t\t\t\t}\n\n                    // links\n                    if (data.links && this.opts.pasteLinks)\n                    {\n                    \t$div.find('a').each(function(i, link)\n                    \t{\n                    \t\tif (link.href)\n                    \t\t{\n                    \t\t\tvar tmp = '##%a href=\"' + link.href + '\"';\n                    \t\t\tvar attr;\n                    \t\t\tfor (var j = 0, length = link.attributes.length; j < length; j++)\n                    \t\t\t{\n                    \t\t\t\tattr = link.attributes.item(j);\n                    \t\t\t\tif (attr.name !== 'href')\n                    \t\t\t\t{\n                    \t\t\t\t\ttmp += ' ' + attr.name + '=\"' + attr.value + '\"';\n                    \t\t\t\t}\n                    \t\t\t}\n\n                    \t\t\tlink.outerHTML = tmp + '%##' + link.innerHTML + '##%/a%##';\n                    \t\t}\n                    \t});\n                    }\n\n                    html = $div.html();\n\n                    // images\n\t\t\t\t\tif (data.images && this.opts.pasteImages)\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(/<img(.*?)src=\"(.*?)\"(.*?[^>])>/gi, '##%img$1src=\"$2\"$3%##');\n\t\t\t\t\t}\n\n\t\t\t\t\t// plain text\n\t\t\t\t\tif (this.opts.pastePlainText)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn html;\n\t\t\t\t\t}\n\n\t\t\t\t\t// all tags\n\t\t\t\t\tvar blockTags = (data.lists) ? ['ul', 'ol', 'li'] : this.opts.pasteBlockTags;\n\n\t\t\t\t\tvar tags;\n\t\t\t\t\tif (data.block || data.lists)\n\t\t\t\t\t{\n\t\t\t\t\t\ttags = (data.inline) ? blockTags.concat(this.opts.pasteInlineTags) : blockTags;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\ttags = (data.inline) ? this.opts.pasteInlineTags : [];\n\t\t\t\t\t}\n\n\t\t\t\t\tvar len = tags.length;\n\t\t\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(new RegExp('<\\/' + tags[i] + '>', 'gi'), '###/' + tags[i] + '###');\n\n\t\t\t\t\t\tif (tags[i] === 'td' || tags[i] === 'th')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\thtml = html.replace(new RegExp('<' + tags[i] + '(.*?[^>])((colspan|rowspan)=\"(.*?[^>])\")?(.*?[^>])>', 'gi'), '###' + tags[i] + ' $2###');\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (this.utils.isInlineTag(tags[i]))\n\t\t\t\t\t\t{\n    \t\t\t\t\t\thtml = html.replace(new RegExp('<' + tags[i] + '([^>]*)class=\"([^>]*)\"[^>]*>', 'gi'), '###' + tags[i] + ' class=\"$2\"###');\n                            html = html.replace(new RegExp('<' + tags[i] + '([^>]*)data-redactor-style-cache=\"([^>]*)\"[^>]*>', 'gi'), '###' + tags[i] + ' cache=\"$2\"###');\n                            html = html.replace(new RegExp('<' + tags[i] + '[^>]*>', 'gi'), '###' + tags[i] + '###');\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\thtml = html.replace(new RegExp('<' + tags[i] + '[^>]*>', 'gi'), '###' + tags[i] + '###');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn html;\n\n\t\t\t\t},\n\t\t\t\treconvertTags: function(html, data)\n\t\t\t\t{\n\t\t\t\t\t// links & images\n\t\t\t\t\tif ((data.links && this.opts.pasteLinks) || (data.images && this.opts.pasteImages))\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(new RegExp('##%', 'gi'), '<');\n\t\t\t\t\t\thtml = html.replace(new RegExp('%##', 'gi'), '>');\n                    }\n\n\t\t\t\t\t// plain text\n\t\t\t\t\tif (this.opts.pastePlainText)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn html;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar blockTags = (data.lists) ? ['ul', 'ol', 'li'] : this.opts.pasteBlockTags;\n\n\t\t\t\t\tvar tags;\n\t\t\t\t\tif (data.block || data.lists)\n\t\t\t\t\t{\n\t\t\t\t\t\ttags = (data.inline) ? blockTags.concat(this.opts.pasteInlineTags) : blockTags;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\ttags = (data.inline) ? this.opts.pasteInlineTags : [];\n\t\t\t\t\t}\n\n\t\t\t\t\tvar len = tags.length;\n\t\t\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(new RegExp('###\\/' + tags[i] + '###', 'gi'), '</' + tags[i] + '>');\n                    }\n\n                    for (var i = 0; i < len; i++)\n\t\t\t\t\t{\n    \t\t\t\t\thtml = html.replace(new RegExp('###' + tags[i] + '###', 'gi'), '<' + tags[i] + '>');\n    \t\t\t\t}\n\n\t\t\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t\t\t{\n                        if (tags[i] === 'td' || tags[i] === 'th')\n                        {\n\t\t\t\t\t\t    html = html.replace(new RegExp('###' + tags[i] + '\\s?(.*?[^#])###', 'gi'), '<' + tags[i] + '$1>');\n                        }\n                        else if (this.utils.isInlineTag(tags[i]))\n                        {\n\n                            var spanMarker = (tags[i] === 'span') ? ' data-redactor-span=\"true\"' : '';\n\n                            html = html.replace(new RegExp('###' + tags[i] + ' cache=\"(.*?[^#])\"###', 'gi'), '<' + tags[i] + ' style=\"$1\"' + spanMarker + ' data-redactor-style-cache=\"$1\">');\n                            html = html.replace(new RegExp('###' + tags[i] + '\\s?(.*?[^#])###', 'gi'), '<' + tags[i] + '$1>');\n                        }\n                    }\n\n\t\t\t\t\treturn html;\n\n\t\t\t\t},\n\t\t\t\tcleanPre: function(block)\n\t\t\t\t{\n\t\t\t\t\tblock = (typeof block === 'undefined') ? $(this.selection.block()).closest('pre', this.core.editor()[0]) : block;\n\n\t\t\t\t\t$(block).find('br').replaceWith(function()\n\t\t\t\t\t{\n\t\t\t\t\t\treturn document.createTextNode('\\n');\n\t\t\t\t\t});\n\n\t\t\t\t\t$(block).find('p').replaceWith(function()\n\t\t\t\t\t{\n\t\t\t\t\t\treturn $(this).contents();\n\t\t\t\t\t});\n\n\t\t\t\t},\n\t\t\t\tremoveTagsInsidePre: function(html)\n\t\t\t\t{\n\t\t\t\t\tvar $div = $('<div />').append(html);\n\t\t\t\t\t$div.find('pre').replaceWith(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tvar str = $(this).html();\n\t\t\t\t\t\tstr = str.replace(/<br\\s?\\/?>|<\\/p>|<\\/div>|<\\/li>|<\\/td>/gi, '\\n');\n\t\t\t\t\t\tstr = str.replace(/(<([^>]+)>)/gi, '');\n\n\t\t\t\t\t\treturn $('<pre />').append(str);\n\t\t\t\t\t});\n\n\t\t\t\t\thtml = $div.html();\n\t\t\t\t\t$div.remove();\n\n\t\t\t\t\treturn html;\n\n\t\t\t\t},\n\t\t\t\tgetPlainText: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = html.replace(/<!--[\\s\\S]*?-->/gi, '');\n\t\t\t\t\thtml = html.replace(/<style[\\s\\S]*?style>/gi, '');\n                    html = html.replace(/<p><\\/p>/g, '');\n\t\t\t\t\thtml = html.replace(/<\\/div>|<\\/li>|<\\/td>/gi, '\\n');\n\t\t\t\t\thtml = html.replace(/<\\/p>/gi, '\\n\\n');\n\t\t\t\t\thtml = html.replace(/<\\/H[1-6]>/gi, '\\n\\n');\n\n\t\t\t\t\tvar tmp = document.createElement('div');\n\t\t\t\t\ttmp.innerHTML = html;\n\t\t\t\t\thtml = tmp.textContent || tmp.innerText;\n\n\t\t\t\t\treturn $.trim(html);\n\t\t\t\t},\n\t\t\t\tsavePreCode: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = this.clean.savePreFormatting(html);\n\t\t\t\t\thtml = this.clean.saveCodeFormatting(html);\n\t\t\t\t\thtml = this.clean.restoreSelectionMarkers(html);\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tsavePreFormatting: function(html)\n\t\t\t\t{\n\t\t\t\t\tvar pre = html.match(/<pre(.*?)>([\\w\\W]*?)<\\/pre>/gi);\n\t\t\t\t\tif (pre === null)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn html;\n\t\t\t\t\t}\n\n\t\t\t\t\t$.each(pre, $.proxy(function(i,s)\n\t\t\t\t\t{\n    \t\t\t\t\tvar arr = [];\n    \t\t\t\t\tvar codeTag = false;\n    \t\t\t\t\tvar contents, attr1, attr2;\n\n    \t\t\t\t\tif (s.match(/<pre(.*?)>(([\\n\\r\\s]+)?)<code(.*?)>/i))\n    \t\t\t\t\t{\n        \t\t\t\t\tarr = s.match(/<pre(.*?)>(([\\n\\r\\s]+)?)<code(.*?)>([\\w\\W]*?)<\\/code>(([\\n\\r\\s]+)?)<\\/pre>/i);\n        \t\t\t\t\tcodeTag = true;\n\n                            contents = arr[5];\n                            attr1 = arr[1];\n                            attr2 = arr[4];\n    \t\t\t\t\t}\n                        else\n\t\t\t\t\t\t{\n    \t\t\t\t\t\tarr = s.match(/<pre(.*?)>([\\w\\W]*?)<\\/pre>/i);\n\n                            contents = arr[2];\n                            attr1 = arr[1];\n                        }\n\n\t\t\t\t\t\tcontents = contents.replace(/<br\\s?\\/?>/g, '\\n');\n\t\t\t\t\t\tcontents = contents.replace(/&nbsp;/g, ' ');\n\n\t\t\t\t\t\tif (this.opts.preSpaces)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcontents = contents.replace(/\\t/g, new Array(this.opts.preSpaces + 1).join(' '));\n\t\t\t\t\t\t}\n\n                        contents = this.clean.encodeEntities(contents);\n\n\t\t\t\t\t\t// $ fix\n\t\t\t\t\t\tcontents = contents.replace(/\\$/g, '&#36;');\n\n                        if (codeTag)\n                        {\n                            html = html.replace(s, '<pre' + attr1 + '><code' + attr2 + '>' + contents + '</code></pre>');\n                        }\n                        else\n                        {\n                            html = html.replace(s, '<pre' + attr1 + '>' + contents + '</pre>');\n                        }\n\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tsaveCodeFormatting: function(html)\n\t\t\t\t{\n\t\t\t\t\tvar code = html.match(/<code(.*?)>([\\w\\W]*?)<\\/code>/gi);\n\t\t\t\t\tif (code === null)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn html;\n\t\t\t\t\t}\n\n\t\t\t\t\t$.each(code, $.proxy(function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar arr = s.match(/<code(.*?)>([\\w\\W]*?)<\\/code>/i);\n\n\t\t\t\t\t\tarr[2] = arr[2].replace(/&nbsp;/g, ' ');\n\t\t\t\t\t\tarr[2] = this.clean.encodeEntities(arr[2]);\n\t\t\t\t\t\tarr[2] = arr[2].replace(/\\$/g, '&#36;');\n\n\t\t\t\t\t\thtml = html.replace(s, '<code' + arr[1] + '>' + arr[2] + '</code>');\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\trestoreSelectionMarkers: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = html.replace(/&lt;span id=&quot;selection-marker-([0-9])&quot; class=&quot;redactor-selection-marker&quot;&gt;​&lt;\\/span&gt;/g, '<span id=\"selection-marker-$1\" class=\"redactor-selection-marker\">​</span>');\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tsaveFormTags: function(html)\n\t\t\t\t{\n\t\t\t\t\treturn html.replace(/<form(.*?)>([\\w\\W]*?)<\\/form>/gi, '<section$1 rel=\"redactor-form-tag\">$2</section>');\n\t\t\t\t},\n\t\t\t\trestoreFormTags: function(html)\n\t\t\t\t{\n\t\t\t\t\treturn html.replace(/<section(.*?) rel=\"redactor-form-tag\"(.*?)>([\\w\\W]*?)<\\/section>/gi, '<form$1$2>$3</form>');\n\t\t\t\t},\n\t\t\t\tencodeHtml: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = html.replace(/”/g, '\"');\n\t\t\t\t\thtml = html.replace(/“/g, '\"');\n\t\t\t\t\thtml = html.replace(/‘/g, '\\'');\n\t\t\t\t\thtml = html.replace(/’/g, '\\'');\n\t\t\t\t\thtml = this.clean.encodeEntities(html);\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tencodeEntities: function(str)\n\t\t\t\t{\n\t\t\t\t\tstr = String(str).replace(/&amp;/g, '&').replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&quot;/g, '\"');\n\t\t\t\t\tstr = str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;');\n\n\t\t\t\t\treturn str;\n\t\t\t\t},\n\t\t\t\tstripTags: function(input, denied)\n\t\t\t\t{\n\t\t\t\t\tif (typeof denied === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn input.replace(/(<([^>]+)>)/gi, '');\n\t\t\t\t\t}\n\n\t\t\t\t    var tags = /<\\/?([a-z][a-z0-9]*)\\b[^>]*>/gi;\n\n\t\t\t\t    return input.replace(tags, function ($0, $1)\n\t\t\t\t    {\n\t\t\t\t        return denied.indexOf($1.toLowerCase()) === -1 ? $0 : '';\n\t\t\t\t    });\n\t\t\t\t},\n\t\t\t\tremoveMarkers: function(html)\n\t\t\t\t{\n\t\t\t\t\treturn html.replace(/<span(.*?[^>]?)class=\"redactor-selection-marker\"(.*?[^>]?)>([\\w\\W]*?)<\\/span>/gi, '');\n\t\t\t\t},\n\t\t\t\tremoveSpaces: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = $.trim(html);\n\t\t\t\t\thtml = html.replace(/\\n/g, '');\n\t\t\t\t\thtml = html.replace(/[\\t]*/g, '');\n\t\t\t\t\thtml = html.replace(/\\n\\s*\\n/g, \"\\n\");\n\t\t\t\t\thtml = html.replace(/^[\\s\\n]*/g, ' ');\n\t\t\t\t\thtml = html.replace(/[\\s\\n]*$/g, ' ');\n\t\t\t\t\thtml = html.replace( />\\s{2,}</g, '> <'); // between inline tags can be only one space\n\t\t\t\t\thtml = html.replace(/\\n\\n/g, \"\\n\");\n\t\t\t\t\thtml = html.replace(/\\u200B/g, '');\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tremoveSpacesHard: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = $.trim(html);\n\t\t\t\t\thtml = html.replace(/\\n/g, '');\n\t\t\t\t\thtml = html.replace(/[\\t]*/g, '');\n\t\t\t\t\thtml = html.replace(/\\n\\s*\\n/g, \"\\n\");\n\t\t\t\t\thtml = html.replace(/^[\\s\\n]*/g, '');\n\t\t\t\t\thtml = html.replace(/[\\s\\n]*$/g, '');\n\t\t\t\t\thtml = html.replace( />\\s{2,}</g, '><');\n\t\t\t\t\thtml = html.replace(/\\n\\n/g, \"\\n\");\n\t\t\t\t\thtml = html.replace(/\\u200B/g, '');\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tnormalizeCurrentHeading: function()\n\t\t\t\t{\n\t\t\t\t\tvar heading = this.selection.block();\n\t\t\t\t\tif (this.utils.isCurrentOrParentHeader() && heading)\n\t\t\t\t\t{\n\t\t\t\t\t\theading.normalize();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =code\n\t\tcode: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tsyncFire: true,\n\t\t\t\thtml: false,\n\t\t\t\tstart: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = $.trim(html);\n\t\t\t\t\thtml = html.replace(/^(<span id=\"selection-marker-1\" class=\"redactor-selection-marker\">​<\\/span>)/, '');\n\n\t\t\t\t\t// clean\n\t\t\t\t\tif (this.opts.type === 'textarea')\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = this.clean.onSet(html);\n\t\t\t\t\t}\n\t\t\t\t\telse if (this.opts.type === 'div' && html === '')\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = this.opts.emptyHtml;\n\t\t\t\t\t}\n\n\t\t\t\t\thtml = html.replace(/<p><span id=\"selection-marker-1\" class=\"redactor-selection-marker\">​<\\/span><\\/p>/, '');\n\n\t\t\t\t\tthis.events.stopDetectChanges();\n\t\t\t\t\tthis.core.editor().html(html);\n\t\t\t\t\tthis.observe.load();\n\t\t\t\t\tthis.events.startDetectChanges();\n\t\t\t\t},\n\t\t\t\tset: function(html, options)\n\t\t\t\t{\n\t\t\t\t\thtml = $.trim(html);\n\n                    options = options || {};\n\n                    // start\n                    if (options.start)\n                    {\n                        this.start = options.start;\n                    }\n\n\t\t\t\t\t// clean\n\t\t\t\t\tif (this.opts.type === 'textarea')\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = this.clean.onSet(html);\n\t\t\t\t\t}\n\t\t\t\t\telse if (this.opts.type === 'div' && html === '')\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = this.opts.emptyHtml;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.core.editor().html(html);\n\n\t\t\t\t\tif (this.opts.type === 'textarea')\n\t\t\t\t\t{\n    \t\t\t\t\tthis.code.sync();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.placeholder.enable();\n\t\t\t\t},\n\t\t\t\tget: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.type === 'textarea')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.core.textarea().val();\n                    }\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tvar html = this.core.editor().html();\n\n\t\t\t\t\t\t// clean\n\t\t\t\t\t\thtml = this.clean.onGet(html);\n\n\t\t\t\t\t\treturn html;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsync: function()\n\t\t\t\t{\n\t\t\t\t\tif (!this.code.syncFire)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar html = this.core.editor().html();\n\t\t\t\t\tvar htmlCleaned = this.code.cleaned(html);\n\n\t\t\t\t\t// is there a need to synchronize\n\t\t\t\t\tif (this.code.isSync(htmlCleaned))\n\t\t\t\t\t{\n\t\t\t\t\t\t// do not sync\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// save code\n\t\t\t\t\tthis.code.html = htmlCleaned;\n\n\t\t\t\t\tif (this.opts.type !== 'textarea')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.callback('sync', html);\n\t\t\t\t\t\tthis.core.callback('change', html);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.opts.type === 'textarea')\n\t\t\t\t\t{\n\t\t\t\t\t\tsetTimeout($.proxy(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.code.startSync(html);\n\n\t\t\t\t\t\t}, this), 10);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tstartSync: function(html)\n\t\t\t\t{\n\t\t\t\t\t// before clean callback\n\t\t\t\t\thtml = this.core.callback('syncBefore', html);\n\n\t\t\t\t\t// clean\n\t\t\t\t\thtml = this.clean.onSync(html);\n\n\t\t\t\t\t// set code\n\t\t\t\t\tthis.core.textarea().val(html);\n\n\t\t\t\t\t// after sync callback\n\t\t\t\t\tthis.core.callback('sync', html);\n\n\t\t\t\t\t// change callback\n\t\t\t\t\tif (this.start === false)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.callback('change', html);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.start = false;\n\t\t\t\t},\n\t\t\t\tisSync: function(htmlCleaned)\n\t\t\t\t{\n\t\t\t\t\tvar html = (this.code.html !== false) ? this.code.html : false;\n\n\t\t\t\t\treturn (html !== false && html === htmlCleaned);\n\t\t\t\t},\n\t\t\t\tcleaned: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = html.replace(/\\u200B/g, '');\n\t\t\t\t\treturn this.clean.removeMarkers(html);\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =core\n\t\tcore: function()\n\t\t{\n\t\t\treturn {\n\n\t\t\t\tid: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.$editor.attr('id');\n\t\t\t\t},\n\t\t\t\telement: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.$element;\n\t\t\t\t},\n\t\t\t\teditor: function()\n\t\t\t\t{\n\t\t\t\t\treturn (typeof this.$editor === 'undefined') ? $() : this.$editor;\n\t\t\t\t},\n\t\t\t\ttextarea: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.$textarea;\n\t\t\t\t},\n\t\t\t\tbox: function()\n\t\t\t\t{\n\t\t\t\t\treturn (this.opts.type === 'textarea') ? this.$box : this.$element;\n\t\t\t\t},\n\t\t\t\ttoolbar: function()\n\t\t\t\t{\n\t\t\t\t\treturn (this.$toolbar) ? this.$toolbar : false;\n\t\t\t\t},\n\t\t\t\tair: function()\n\t\t\t\t{\n\t\t\t\t\treturn (this.$air) ? this.$air : false;\n\t\t\t\t},\n\t\t\t\tobject: function()\n\t\t\t\t{\n\t\t\t\t\treturn $.extend({}, this);\n\t\t\t\t},\n\t\t\t\tstructure: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().toggleClass('redactor-structure');\n\t\t\t\t},\n\t\t\t\taddEvent: function(name)\n\t\t\t\t{\n\t\t\t\t\tthis.core.event = name;\n\t\t\t\t},\n\t\t\t\tgetEvent: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.core.event;\n\t\t\t\t},\n\t\t\t\tcallback: function(type, e, data)\n\t\t\t\t{\n\t\t\t\t\tvar eventNamespace = 'redactor';\n\t\t\t\t\tvar returnValue = false;\n\t\t\t\t\tvar events = $._data(this.core.element()[0], 'events');\n\n\t\t\t\t\t// on callback\n\t\t\t\t\tif (typeof events !== 'undefined' && typeof events[type] !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tvar len = events[type].length;\n\t\t\t\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar namespace = events[type][i].namespace;\n\t\t\t\t\t\t\tif (namespace === 'callback.' + eventNamespace)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvar handler = events[type][i].handler;\n\t\t\t\t\t\t\t\tvar args = (typeof data === 'undefined') ? [e] : [e, data];\n\t\t\t\t\t\t\t\treturnValue = (typeof args === 'undefined') ? handler.call(this, e) : handler.call(this, e, args);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (returnValue)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn returnValue;\n\t\t\t\t\t}\n\n\t\t\t\t\t// no callback\n\t\t\t\t\tif (typeof this.opts.callbacks[type] === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn (typeof data === 'undefined') ? e : data;\n\t\t\t\t\t}\n\n\t\t\t\t\t// callback\n\t\t\t\t\tvar callback = this.opts.callbacks[type];\n\n\t\t\t\t\tif ($.isFunction(callback))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn (typeof data === 'undefined') ? callback.call(this, e) : callback.call(this, e, data);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\treturn (typeof data === 'undefined') ? e : data;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tdestroy: function()\n\t\t\t\t{\n\t\t\t\t\tthis.opts.destroyed = true;\n\n\t\t\t\t\tthis.core.callback('destroy');\n\n\t\t\t\t\t// placeholder\n\t\t\t\t\tthis.placeholder.destroy();\n\n\t\t\t\t\t// progress\n\t\t\t\t\tthis.progress.destroy();\n\n\t\t\t\t\t// help label\n\t\t\t\t\t$('#redactor-voice-' + this.uuid).remove();\n\n\t\t\t\t\tthis.core.editor().removeClass('redactor-in redactor-styles redactor-structure redactor-layer-img-edit');\n\n\t\t\t\t\t// caret service\n\t\t\t\t\tthis.core.editor().off('keydown.redactor-remove-textnode');\n\n\t\t\t\t\t// observer\n\t\t\t\t\tthis.core.editor().off('.redactor-observe.' + this.uuid);\n\n\t\t\t\t\t// off events and remove data\n\t\t\t\t\tthis.$element.off('.redactor').removeData('redactor');\n\t\t\t\t\tthis.core.editor().off('.redactor');\n\n\t\t\t\t\t$(document).off('.redactor-dropdown');\n\t\t\t\t\t$(document).off('.redactor-air.' + this.uuid);\n\t\t\t\t\t$(document).off('mousedown.redactor-blur.' + this.uuid);\n\t\t\t\t\t$(document).off('mousedown.redactor.' + this.uuid);\n\t\t\t\t\t$(document).off('touchstart.redactor.' + this.uuid + ' click.redactor.' + this.uuid);\n\t\t\t\t\t$(window).off('.redactor-toolbar.' + this.uuid);\n\t\t\t\t\t$(window).off('touchmove.redactor.' + this.uuid);\n\t\t\t\t\t$(\"body\").off('scroll.redactor.' + this.uuid);\n\n\t\t\t\t\t$(this.opts.toolbarFixedTarget).off('scroll.redactor.' + this.uuid);\n\n\t\t\t\t\t// plugins events\n\t\t\t\t\tvar self = this;\n\t\t\t\t\tif (this.opts.plugins !== false)\n\t\t\t\t\t{\n\t\t\t\t\t\t$.each(this.opts.plugins, function(i,s)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$(window).off('.redactor-plugin-' + s);\n\t\t\t\t\t\t\t$(document).off('.redactor-plugin-' + s);\n\t\t\t\t\t\t\t$(\"body\").off('.redactor-plugin-' + s);\n\t\t\t\t\t\t\tself.core.editor().off('.redactor-plugin-' + s);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\t// click to edit\n\t\t\t\t\tthis.$element.off('click.redactor-click-to-edit');\n\t\t\t\t\tthis.$element.removeClass('redactor-click-to-edit');\n\n\t\t\t\t\t// common\n\t\t\t\t\tthis.core.editor().removeClass('redactor-layer');\n\t\t\t\t\tthis.core.editor().removeAttr('contenteditable');\n\n\t\t\t\t\tvar html = this.code.get();\n\n\t\t\t\t\tif (this.opts.toolbar && this.$toolbar)\n\t\t\t\t\t{\n\t\t\t\t\t\t// dropdowns off\n\t\t\t\t\t\tthis.$toolbar.find('a').each(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar $el = $(this);\n\t\t\t\t\t\t\tif ($el.data('dropdown'))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$el.data('dropdown').remove();\n\t\t\t\t\t\t\t\t$el.data('dropdown', {});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.opts.type === 'textarea')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$box.after(this.$element);\n\t\t\t\t\t\tthis.$box.remove();\n\t\t\t\t\t\tthis.$element.val(html).show();\n\t\t\t\t\t}\n\n\t\t\t\t\t// air\n\t\t\t\t\tif (this.opts.air)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$air.remove();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.opts.toolbar && this.$toolbar)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$toolbar.remove();\n\t\t\t\t\t}\n\n\t\t\t\t\t// modal\n\t\t\t\t\tif (this.$modalBox)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$modalBox.remove();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.$modalOverlay)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$modalOverlay.remove();\n\t\t\t\t\t}\n\n\t\t\t\t\t// hide link's tooltip\n\t\t\t\t\t$('.redactor-link-tooltip').remove();\n\n\t\t\t\t\t// autosave\n\t\t\t\t\tclearInterval(this.autosaveTimeout);\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =detect\n\t\tdetect: function()\n\t\t{\n\t\t\treturn {\n\n\t\t\t\t// public\n\t\t\t\tisWebkit: function()\n\t\t\t\t{\n\t\t\t\t\treturn /webkit/.test(this.opts.userAgent);\n\t\t\t\t},\n\t\t\t\tisFirefox: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.opts.userAgent.indexOf('firefox') > -1;\n\t\t\t\t},\n\t\t\t\tisIe: function(v)\n\t\t\t\t{\n                    if (document.documentMode || /Edge/.test(navigator.userAgent))\n                    {\n                        return 'edge';\n                    }\n\n\t\t\t\t\tvar ie;\n\t\t\t\t\tie = RegExp('msie' + (!isNaN(v)?('\\\\s'+v):''), 'i').test(navigator.userAgent);\n\n\t\t\t\t\tif (!ie)\n\t\t\t\t\t{\n\t\t\t\t\t\tie = !!navigator.userAgent.match(/Trident.*rv[ :]*11\\./);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn ie;\n\t\t\t\t},\n\t\t\t\tisMobile: function()\n\t\t\t\t{\n\t\t\t\t\treturn /(iPhone|iPod|BlackBerry|Android)/.test(navigator.userAgent);\n\t\t\t\t},\n\t\t\t\tisDesktop: function()\n\t\t\t\t{\n\t\t\t\t\treturn !/(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent);\n\t\t\t\t},\n\t\t\t\tisIpad: function()\n\t\t\t\t{\n\t\t\t\t\treturn /iPad/.test(navigator.userAgent);\n\t\t\t\t}\n\n\t\t\t};\n\t\t},\n\n\t\t// =dropdown\n\t\tdropdown: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tactive: false,\n\t\t\t\tbutton: false,\n\t\t\t\tkey: false,\n\t\t\t\tposition: [],\n\t\t\t\tgetDropdown: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.dropdown.active;\n\t\t\t\t},\n\t\t\t\tbuild: function(name, $dropdown, dropdownObject)\n\t\t\t\t{\n\t\t\t\t\tdropdownObject = this.dropdown.buildFormatting(name, dropdownObject);\n\n\t\t\t\t\t$.each(dropdownObject, $.proxy(function(btnName, btnObject)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $item = this.dropdown.buildItem(btnName, btnObject);\n\n\t\t\t\t\t\tthis.observe.addDropdown($item, btnName, btnObject);\n\t\t\t\t\t\t$dropdown.attr('rel', name).append($item);\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\tbuildFormatting: function(name, dropdownObject)\n\t\t\t\t{\n\t\t\t\t\tif (name !== 'format' || this.opts.formattingAdd === false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn dropdownObject;\n\t\t\t\t\t}\n\n\t\t\t\t\t$.each(this.opts.formattingAdd, $.proxy(function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar type = (this.utils.isBlockTag(s.args[0])) ? 'block' : 'inline';\n\n\t\t\t\t\t\tdropdownObject[i] = {\n\t\t\t\t\t\t\tfunc: (type === 'block') ? 'block.format' : 'inline.format',\n\t\t\t\t\t\t\targs: s.args,\n\t\t\t\t\t\t\ttitle: s.title\n\t\t\t\t\t\t};\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\treturn dropdownObject;\n\t\t\t\t},\n\t\t\t\tbuildItem: function(btnName, btnObject)\n\t\t\t\t{\n\t\t\t\t\tvar $itemContainer = $('<li />');\n\t\t\t\t\tif (typeof btnObject.classname !== 'undefined')\n\t\t\t\t\t{\n    \t\t\t\t\t$itemContainer.addClass(btnObject.classname);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (btnName.search(/^divider/i) !== -1)\n\t\t\t\t\t{\n    \t\t\t\t\t$itemContainer.addClass('redactor-dropdown-divider');\n\n    \t\t\t\t\treturn $itemContainer;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $item = $('<a href=\"#\" class=\"redactor-dropdown-' + btnName + '\" role=\"button\" />');\n\t\t\t\t\tvar $itemSpan = $('<span />').html(btnObject.title);\n\n\t\t\t\t\t$item.append($itemSpan);\n\t\t\t\t\t$item.on('mousedown', $.proxy(function(e)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\tthis.dropdown.buildClick(e, btnName, btnObject);\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\t$itemContainer.append($item);\n\n\t\t\t\t\treturn $itemContainer;\n\n\t\t\t\t},\n\t\t\t\tbuildClick: function(e, btnName, btnObject)\n\t\t\t\t{\n\t\t\t\t\tif ($(e.target).hasClass('redactor-dropdown-link-inactive'))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar command = this.dropdown.buildCommand(btnObject);\n\n\t\t\t\t\tif (typeof btnObject.args !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.button.toggle(e, btnName, command.type, command.callback, btnObject.args);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.button.toggle(e, btnName, command.type, command.callback);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tbuildCommand: function(btnObject)\n\t\t\t\t{\n\t\t\t\t\tvar command = {};\n\t\t\t\t\tcommand.type = 'func';\n\t\t\t\t\tcommand.callback = btnObject.func;\n\n\t\t\t\t\tif (btnObject.command)\n\t\t\t\t\t{\n\t\t\t\t\t\tcommand.type = 'command';\n\t\t\t\t\t\tcommand.callback = btnObject.command;\n\t\t\t\t\t}\n\t\t\t\t\telse if (btnObject.dropdown)\n\t\t\t\t\t{\n\t\t\t\t\t\tcommand.type = 'dropdown';\n\t\t\t\t\t\tcommand.callback = btnObject.dropdown;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn command;\n\t\t\t\t},\n\t\t\t\tshow: function(e, key)\n\t\t\t\t{\n\t\t\t\t\tif (this.detect.isDesktop())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().focus();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.dropdown.hideAll(false, key);\n\n\t\t\t\t\tthis.dropdown.key = key;\n\t\t\t\t\tthis.dropdown.button = this.button.get(this.dropdown.key);\n\n\t\t\t\t\tif (this.dropdown.button.hasClass('dropact'))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.dropdown.hide();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// re append\n\t\t\t\t\tthis.dropdown.active = this.dropdown.button.data('dropdown').appendTo(document.body);\n\n\t\t\t\t\t// callback\n\t\t\t\t\tthis.core.callback('dropdownShow', { dropdown: this.dropdown.active, key: this.dropdown.key, button: this.dropdown.button });\n\n\t\t\t\t\t// set button\n\t\t\t\t\tthis.button.setActive(this.dropdown.key);\n\t\t\t\t\tthis.dropdown.button.addClass('dropact');\n\n\t\t\t\t\t// position\n\t\t\t\t\tthis.dropdown.getButtonPosition();\n\n\t\t\t\t\t// show\n\t\t\t\t\tif (this.button.toolbar().hasClass('toolbar-fixed-box') && this.detect.isDesktop())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.dropdown.showIsFixedToolbar();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.dropdown.showIsUnFixedToolbar();\n\t\t\t\t\t}\n\n\t\t\t\t\t// disable scroll whan dropdown scroll\n\t\t\t\t\tif (this.detect.isDesktop() && !this.detect.isFirefox())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.dropdown.active.on('mouseover.redactor-dropdown', $.proxy(this.utils.disableBodyScroll, this));\n\t\t\t\t\t\tthis.dropdown.active.on('mouseout.redactor-dropdown mousedown.redactor-dropdown', $.proxy(this.utils.enableBodyScroll, this));\n\t\t\t\t\t}\n\n\t\t\t\t\te.stopPropagation();\n\n\t\t\t\t},\n\t\t\t\tshowIsFixedToolbar: function()\n\t\t\t\t{\n\t\t\t\t\tvar top = this.dropdown.button.position().top + this.dropdown.button.innerHeight() + this.opts.toolbarFixedTopOffset;\n\n\t\t\t\t\tvar position = 'fixed';\n\t\t\t\t\tif (this.opts.toolbarFixedTarget !== document)\n\t\t\t\t\t{\n\t\t\t\t\t\ttop = (this.dropdown.button.innerHeight() + this.$toolbar.offset().top) + this.opts.toolbarFixedTopOffset;\n\t\t\t\t\t\tposition = 'absolute';\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.dropdown.active.css({\n\n\t\t\t\t\t\tposition: position,\n\t\t\t\t\t\tleft: this.dropdown.position.left + 'px',\n\t\t\t\t\t\ttop: top + 'px'\n\n\t\t\t\t\t}).show();\n\n\t\t\t\t\t// animate\n\t\t\t\t\tthis.dropdown.active.redactorAnimation('slideDown', { duration: 0.2 }, $.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.dropdown.enableCallback();\n\t\t\t\t\t\tthis.dropdown.enableEvents();\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\tshowIsUnFixedToolbar: function()\n\t\t\t\t{\n\t\t\t\t\tthis.dropdown.active.css({\n\n\t\t\t\t\t\tposition: 'absolute',\n\t\t\t\t\t\tleft: this.dropdown.position.left + 'px',\n\t\t\t\t\t\ttop: (this.dropdown.button.innerHeight() + this.dropdown.position.top) + 'px'\n\n\t\t\t\t\t}).show();\n\n\t\t\t\t\t// animate\n\t\t\t\t\tthis.dropdown.active.redactorAnimation(((this.opts.animation) ? 'slideDown' : 'show'), { duration: 0.2 }, $.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.dropdown.enableCallback();\n\t\t\t\t\t\tthis.dropdown.enableEvents();\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\tenableEvents: function()\n\t\t\t\t{\n\t\t\t\t\t$(document).on('mousedown.redactor-dropdown', $.proxy(this.dropdown.hideAll, this));\n\t\t\t\t\tthis.core.editor().on('touchstart.redactor-dropdown', $.proxy(this.dropdown.hideAll, this));\n\t\t\t\t\t$(document).on('keyup.redactor-dropdown', $.proxy(this.dropdown.closeHandler, this));\n\t\t\t\t},\n\t\t\t\tenableCallback: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.callback('dropdownShown', { dropdown: this.dropdown.active, key: this.dropdown.key, button: this.dropdown.button });\n\t\t\t\t},\n\t\t\t\tgetButtonPosition: function()\n\t\t\t\t{\n\t\t\t\t\tthis.dropdown.position = this.dropdown.button.offset();\n\n\t\t\t\t\t// fix right placement\n\t\t\t\t\tvar dropdownWidth = this.dropdown.active.width();\n\t\t\t\t\tif ((this.dropdown.position.left + dropdownWidth) > $(document).width())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.dropdown.position.left = Math.max(0, this.dropdown.position.left - dropdownWidth + parseInt(this.dropdown.button.innerWidth()));\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tcloseHandler: function(e)\n\t\t\t\t{\n\t\t\t\t\tif (e.which !== this.keyCode.ESC)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.dropdown.hideAll(e);\n\t\t\t\t\tthis.core.editor().focus();\n\t\t\t\t},\n\t\t\t\thideAll: function(e, key)\n\t\t\t\t{\n\t\t\t\t\tif (this.detect.isDesktop())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.utils.enableBodyScroll();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (e !== false && $(e.target).closest('.redactor-dropdown').length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $buttons = (typeof key === 'undefined') ? this.button.toolbar().find('a.dropact') : this.button.toolbar().find('a.dropact').not('.re-' + key);\n\t\t\t\t\tvar $elements = (typeof key === 'undefined') ? $('.redactor-dropdown-' + this.uuid) : $('.redactor-dropdown-' + this.uuid).not('.redactor-dropdown-box-' + key);\n\n\t\t\t\t\tif ($elements.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t$(document).off('.redactor-dropdown');\n\t\t\t\t\t\tthis.core.editor().off('.redactor-dropdown');\n\n\t\t\t\t\t\t$.each($elements, $.proxy(function(i,s)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar $el = $(s);\n\n\t\t\t\t\t\t\tthis.core.callback('dropdownHide', $el);\n\n\t\t\t\t\t\t\t$el.hide();\n\t\t\t\t\t\t\t$el.off('mouseover mouseout').off('.redactor-dropdown');\n\n\t\t\t\t\t\t}, this));\n\n\t\t\t\t\t\t$buttons .removeClass('redactor-act dropact');\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\thide: function ()\n\t\t\t\t{\n\t\t\t\t\tif (this.dropdown.active === false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.detect.isDesktop())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.utils.enableBodyScroll();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.dropdown.active.redactorAnimation(((this.opts.animation) ? 'slideUp' : 'hide'), { duration: 0.2 }, $.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\t$(document).off('.redactor-dropdown');\n\t\t\t\t\t\tthis.core.editor().off('.redactor-dropdown');\n\n\t\t\t\t\t\tthis.dropdown.hideOut();\n\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\thideOut: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.callback('dropdownHide', this.dropdown.active);\n\n\t\t\t\t\tthis.dropdown.button.removeClass('redactor-act dropact');\n\t\t\t\t\tthis.dropdown.active.off('mouseover mouseout').off('.redactor-dropdown');\n\t\t\t\t\tthis.dropdown.button = false;\n\t\t\t\t\tthis.dropdown.key = false;\n\t\t\t\t\tthis.dropdown.active = false;\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =events\n\t\tevents: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tfocused: false,\n\t\t\t\tblured: true,\n\t\t\t\tdropImage: false,\n\t\t\t\tstopChanges: false,\n\t\t\t\tstopDetectChanges: function()\n\t\t\t\t{\n\t\t\t\t\tthis.events.stopChanges = true;\n\t\t\t\t},\n\t\t\t\tstartDetectChanges: function()\n\t\t\t\t{\n\t\t\t\t\tvar self = this;\n\t\t\t\t\tsetTimeout(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tself.events.stopChanges = false;\n\t\t\t\t\t}, 1);\n\t\t\t\t},\n\t\t\t\tdragover: function(e)\n\t\t\t\t{\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopPropagation();\n\n\t\t\t\t\tif (e.target.tagName === 'IMG')\n\t\t\t\t\t{\n\t\t\t\t\t\t$(e.target).addClass('redactor-image-dragover');\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tdragleave: function(e)\n\t\t\t\t{\n\t\t\t\t\t// remove image dragover\n\t\t\t\t\tthis.core.editor().find('img').removeClass('redactor-image-dragover');\n\t\t\t\t},\n\t\t\t\tdrop: function(e)\n\t\t\t\t{\n\t\t\t\t\te = e.originalEvent || e;\n\n\t\t\t\t\t// remove image dragover\n\t\t\t\t\tthis.core.editor().find('img').removeClass('redactor-image-dragover');\n\n\t\t\t\t\tif (this.opts.type === 'inline' || this.opts.type === 'pre')\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (window.FormData === undefined || !e.dataTransfer)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (e.dataTransfer.files.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.events.onDrop(e);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.events.onDropUpload(e);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.core.callback('drop', e);\n\n\t\t\t\t},\n\t\t\t\tclick: function(e)\n\t\t\t\t{\n\t\t\t\t\tvar event = this.core.getEvent();\n\t\t\t\t\tvar type = (event === 'click' || event === 'arrow') ? false : 'click';\n\n                    this.core.addEvent(type);\n\t\t\t\t\tthis.utils.disableSelectAll();\n\t\t\t\t\tthis.core.callback('click', e);\n\t\t\t\t},\n\t\t\t\tfocus: function(e)\n\t\t\t\t{\n\t\t\t\t\tif (this.rtePaste)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.events.isCallback('focus'))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.callback('focus', e);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.events.focused = true;\n\t\t\t\t\tthis.events.blured = false;\n\n\t\t\t\t\t// tab\n\t\t\t\t\tif (this.selection.current() === false)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\t\tvar range = this.selection.range(sel);\n\n\t\t\t\t\t\trange.setStart(this.core.editor()[0], 0);\n\t\t\t\t\t\trange.setEnd(this.core.editor()[0], 0);\n\t\t\t\t\t\tthis.selection.update(sel, range);\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tblur: function(e)\n\t\t\t\t{\n\t\t\t\t\tif (this.start || this.rtePaste)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($(e.target).closest('#' + this.core.id() + ', .redactor-toolbar, .redactor-dropdown, #redactor-modal-box').length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!this.events.blured && this.events.isCallback('blur'))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.callback('blur', e);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.events.focused = false;\n\t\t\t\t\tthis.events.blured = true;\n\t\t\t\t},\n\t\t\t\ttouchImageEditing: function()\n\t\t\t\t{\n\t\t\t\t\tvar scrollTimer = -1;\n\t\t\t\t\tthis.events.imageEditing = false;\n\t\t\t\t\t$(window).on('touchmove.redactor.' + this.uuid, $.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.events.imageEditing = true;\n\t\t\t\t\t\tif (scrollTimer !== -1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tclearTimeout(scrollTimer);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tscrollTimer = setTimeout($.proxy(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.events.imageEditing = false;\n\n\t\t\t\t\t\t}, this), 500);\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\tinit: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().on('dragover.redactor dragenter.redactor', $.proxy(this.events.dragover, this));\n\t\t\t\t\tthis.core.editor().on('dragleave.redactor', $.proxy(this.events.dragleave, this));\n\t\t\t\t\tthis.core.editor().on('drop.redactor', $.proxy(this.events.drop, this));\n\t\t\t\t\tthis.core.editor().on('click.redactor', $.proxy(this.events.click, this));\n\t\t\t\t\tthis.core.editor().on('paste.redactor', $.proxy(this.paste.init, this));\n\t\t\t\t\tthis.core.editor().on('keydown.redactor', $.proxy(this.keydown.init, this));\n\t\t\t\t\tthis.core.editor().on('keyup.redactor', $.proxy(this.keyup.init, this));\n\t\t\t\t\tthis.core.editor().on('focus.redactor', $.proxy(this.events.focus, this));\n\n\t\t\t\t\t$(document).on('mousedown.redactor-blur.' + this.uuid, $.proxy(this.events.blur, this));\n\n\t\t\t\t\tthis.events.touchImageEditing();\n\n\t\t\t\t\tthis.events.createObserver();\n\t\t\t\t\tthis.events.setupObserver();\n\n\t\t\t\t},\n\t\t\t\tcreateObserver: function()\n\t\t\t\t{\n\t\t\t\t\tvar self = this;\n\t\t\t\t\tthis.events.observer = new MutationObserver(function(mutations)\n\t\t\t\t\t{\n\t\t\t\t\t\tmutations.forEach($.proxy(self.events.iterateObserver, self));\n\t\t\t\t\t});\n\n\t\t\t\t},\n\t\t\t\titerateObserver: function(mutation)\n\t\t\t\t{\n\n\t\t\t\t\tvar stop = false;\n\n\t\t\t\t\t// target\n\t\t\t\t\tif (((this.opts.type === 'textarea' || this.opts.type === 'div')\n\t\t\t\t\t    && (!this.detect.isFirefox() && mutation.target === this.core.editor()[0]))\n\t\t\t\t\t    || (mutation.attributeName === 'class' && mutation.target === this.core.editor()[0])\n                    )\n\t\t\t\t\t{\n\t\t\t\t\t\tstop = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!stop)\n\t\t\t\t\t{\n    \t\t\t\t\tthis.observe.load();\n\t\t\t\t\t\tthis.events.changeHandler();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsetupObserver: function()\n\t\t\t\t{\n\t\t\t\t\tthis.events.observer.observe(this.core.editor()[0], {\n\t\t\t\t\t\t attributes: true,\n\t\t\t\t\t\t subtree: true,\n\t\t\t\t\t\t childList: true,\n\t\t\t\t\t\t characterData: true,\n\t\t\t\t\t\t characterDataOldValue: true\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tchangeHandler: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.events.stopChanges)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.code.sync();\n\n\t\t\t\t\t// autosave\n\t\t\t\t\tif (this.autosave.is())\n\t\t\t\t\t{\n\t\t\t\t\t\tclearTimeout(this.autosaveTimeout);\n\t\t\t\t\t\tthis.autosaveTimeout = setTimeout($.proxy(this.autosave.send, this), 300);\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tonDropUpload: function(e)\n\t\t\t\t{\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\te.stopPropagation();\n\n\t\t\t\t\tif ((!this.opts.dragImageUpload && !this.opts.dragFileUpload) || (this.opts.imageUpload === null && this.opts.fileUpload === null))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (e.target.tagName === 'IMG')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.events.dropImage = e.target;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar files = e.dataTransfer.files;\n                    var len = files.length;\n\t\t\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t\t\t{\n    \t\t\t\t\tthis.upload.directUpload(files[i], e);\n    \t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonDrop: function(e)\n\t\t\t\t{\n\t\t\t\t\tthis.core.callback('drop', e);\n\t\t\t\t},\n\t\t\t\tisCallback: function(name)\n\t\t\t\t{\n\t\t\t\t\treturn (typeof this.opts.callbacks[name] !== 'undefined' && $.isFunction(this.opts.callbacks[name]));\n\t\t\t\t},\n\n\t\t\t\t// #backward\n\t\t\t\tstopDetect: function()\n\t\t\t\t{\n\t\t\t\t\tthis.events.stopDetectChanges();\n\t\t\t\t},\n\t\t\t\tstartDetect: function()\n\t\t\t\t{\n\t\t\t\t\tthis.events.startDetectChanges();\n\t\t\t\t}\n\n\t\t\t};\n\t\t},\n\n\t\t// =file\n\t\tfile: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tis: function()\n\t\t\t\t{\n\t\t\t\t\treturn !(!this.opts.fileUpload || !this.opts.fileUpload && !this.opts.s3);\n\t\t\t\t},\n\t\t\t\tshow: function()\n\t\t\t\t{\n\t\t\t\t\t// build modal\n\t\t\t\t\tthis.modal.load('file', this.lang.get('file'), 700);\n\n\t\t\t\t\t// build upload\n\t\t\t\t\tthis.upload.init('#redactor-modal-file-upload', this.opts.fileUpload, this.file.insert);\n\n\t\t\t\t\t// set selected text\n\t\t\t\t\t$('#redactor-filename').val(this.selection.get().toString());\n\n\t\t\t\t\t// show\n\t\t\t\t\tthis.modal.show();\n\t\t\t\t},\n\t\t\t\tinsert: function(json, direct, e)\n\t\t\t\t{\n\t\t\t\t\t// error callback\n\t\t\t\t\tif (typeof json.error !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.modal.close();\n\t\t\t\t\t\tthis.core.callback('fileUploadError', json);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.file.release(e, direct);\n\n\t\t\t\t\t// prepare\n\t\t\t\t\tthis.buffer.set();\n\t\t\t\t\tthis.air.collapsed();\n\n\t\t\t\t\t// get\n\t\t\t\t\tvar text = this.file.text(json);\n\t\t\t\t\tvar $link = $('<a />').attr('href', json.url).text(text);\n\t\t\t\t\tvar id = (typeof json.id === 'undefined') ? '' : json.id;\n\t\t\t\t\tvar type = (typeof json.s3 === 'undefined') ? 'file' : 's3';\n\n\t\t\t\t\t// set id\n\t\t\t\t\t$link.attr('data-' + type, id);\n\n\t\t\t\t\t// insert\n\t\t\t\t\t$link = $(this.insert.node($link));\n\n\t\t\t\t\t// focus\n\t\t\t\t\tthis.caret.after($link);\n\n\t\t\t\t\t// callback\n\t\t\t\t\tthis.storage.add({ type: type, node: $link[0], url: json.url, id: id });\n\n\t\t\t\t\tif (direct !== null)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.callback('fileUpload', $link, json);\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\trelease: function(e, direct)\n\t\t\t\t{\n\t\t\t\t\tif (direct)\n\t\t\t\t\t{\n\t\t\t\t\t\t// drag and drop upload\n\t\t\t\t\t\tthis.marker.remove();\n\t\t\t\t\t\tthis.insert.nodeToPoint(e, this.marker.get());\n\t\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t// upload from modal\n\t\t\t\t\t\tthis.modal.close();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\ttext: function(json)\n\t\t\t\t{\n\t\t\t\t\tvar text = $('#redactor-filename').val();\n\n\t\t\t\t\treturn (typeof text === 'undefined' || text === '') ? json.name : text;\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =focus\n\t\tfocus: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tstart: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().focus();\n\n\t\t\t\t\tif (this.opts.type === 'inline')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $first = this.focus.first();\n\t\t\t\t\tif ($first !== false)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.caret.start($first);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tend: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().focus();\n\n\t\t\t\t\tvar last = (this.opts.inline) ? this.core.editor() : this.focus.last();\n\t\t\t\t\tif (last.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// get inline last node\n\t\t\t\t\tvar lastNode = this.focus.lastChild(last);\n\t\t\t\t\tif (!this.detect.isWebkit() && lastNode !== false)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.caret.end(lastNode);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\t\tvar range = this.selection.range(sel);\n\n\t\t\t\t\t\tif (range !== null)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\trange.selectNodeContents(last[0]);\n\t\t\t\t\t\t\trange.collapse(false);\n\n\t\t\t\t\t\t\tthis.selection.update(sel, range);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.caret.end(last);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tfirst: function()\n\t\t\t\t{\n\t\t\t\t\tvar $first = this.core.editor().children().first();\n\t\t\t\t\tif ($first.length === 0 && ($first[0].length === 0 || $first[0].tagName === 'BR' || $first[0].tagName === 'HR' || $first[0].nodeType === 3))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($first[0].tagName === 'UL' || $first[0].tagName === 'OL')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn $first.find('li').first();\n\t\t\t\t\t}\n\n\t\t\t\t\treturn $first;\n\n\t\t\t\t},\n\t\t\t\tlast: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.core.editor().children().last();\n\t\t\t\t},\n\t\t\t\tlastChild: function(last)\n\t\t\t\t{\n\t\t\t\t\tvar lastNode = last[0].lastChild;\n\n\t\t\t\t\treturn (lastNode !== null && this.utils.isInlineTag(lastNode.tagName)) ? lastNode : false;\n\t\t\t\t},\n\t\t\t\tis: function()\n\t\t\t\t{\n\t\t\t\t\treturn (this.core.editor()[0] === document.activeElement);\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =image\n\t\timage: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tis: function()\n\t\t\t\t{\n\t\t\t\t\treturn !(!this.opts.imageUpload || !this.opts.imageUpload && !this.opts.s3);\n\t\t\t\t},\n\t\t\t\tshow: function()\n\t\t\t\t{\n\t\t\t\t\t// build modal\n\t\t\t\t\tthis.modal.load('image', this.lang.get('image'), 700);\n\n\t\t\t\t\t// build upload\n\t\t\t\t\tthis.upload.init('#redactor-modal-image-droparea', this.opts.imageUpload, this.image.insert);\n\t\t\t\t\tthis.modal.show();\n\n\t\t\t\t},\n\t\t\t\tinsert: function(json, direct, e)\n\t\t\t\t{\n\t\t\t\t\tvar $img;\n\n\t\t\t\t\t// error callback\n\t\t\t\t\tif (typeof json.error !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.modal.close();\n\t\t\t\t\t\tthis.events.dropImage = false;\n\t\t\t\t\t\tthis.core.callback('imageUploadError', json, e);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// change image\n\t\t\t\t\tif (this.events.dropImage !== false)\n\t\t\t\t\t{\n\t\t\t\t\t\t$img = $(this.events.dropImage);\n\n\t\t\t\t\t\tthis.core.callback('imageDelete', $img[0].src, $img);\n\n\t\t\t\t\t\t$img.attr('src', json.url);\n\n\t\t\t\t\t\tthis.events.dropImage = false;\n\t\t\t\t\t\tthis.core.callback('imageUpload', $img, json);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.placeholder.hide();\n\t\t\t\t\tvar $figure = $('<' + this.opts.imageTag + '>');\n\n\t\t\t\t\t$img = $('<img>');\n\t\t\t\t\t$img.attr('src', json.url);\n\n\t\t\t\t\t// set id\n\t\t\t\t\tvar id = (typeof json.id === 'undefined') ? '' : json.id;\n\t\t\t\t\tvar type = (typeof json.s3 === 'undefined') ? 'image' : 's3';\n\t\t\t\t\t$img.attr('data-' + type, id);\n\n\t\t\t\t\t$figure.append($img);\n\n\t\t\t\t\tvar pre = this.utils.isTag(this.selection.current(), 'pre');\n\n\t\t\t\t\tif (direct)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.air.collapsed();\n\t\t\t\t\t\tthis.marker.remove();\n\n\t\t\t\t\t\tvar node = this.insert.nodeToPoint(e, this.marker.get());\n\t\t\t\t\t\tvar $next = $(node).next();\n\n\t\t\t\t\t\tthis.selection.restore();\n\n\t\t\t\t\t\t// buffer\n\t\t\t\t\t\tthis.buffer.set();\n\n\t\t\t\t\t\t// insert\n\t\t\t\t\t\tif (typeof $next !== 'undefined' && $next.length !== 0 && $next[0].tagName === 'IMG')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t// delete callback\n\t\t\t\t\t\t\tthis.core.callback('imageDelete', $next[0].src, $next);\n\n\t\t\t\t\t\t\t// replace\n\t\t\t\t\t\t\t$next.closest('figure, p', this.core.editor()[0]).replaceWith($figure);\n\t\t\t\t\t\t\tthis.caret.after($figure);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (pre)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$(pre).after($figure);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.insert.node($figure);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.caret.after($figure);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.modal.close();\n\n\t\t\t\t\t\t// buffer\n\t\t\t\t\t\tthis.buffer.set();\n\n\t\t\t\t\t\t// insert\n\t\t\t\t\t\tthis.air.collapsed();\n\n\t\t\t\t\t\tif (pre)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$(pre).after($figure);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.insert.node($figure);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.caret.after($figure);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.events.dropImage = false;\n\t\t\t\t\tthis.storage.add({ type: type, node: $img[0], url: json.url, id: id });\n\n\t\t\t\t\tvar nextNode = $img[0].nextSibling;\n\t\t\t\t\tvar $nextFigure = $figure.next();\n\t\t\t\t\tvar isNextEmpty = $(nextNode).text().replace(/\\u200B/g, '');\n\t\t\t\t\tvar isNextFigureEmpty = $nextFigure.text().replace(/\\u200B/g, '');\n\n\t\t\t\t\tif (isNextEmpty === '')\n\t\t\t\t\t{\n    \t\t\t\t\t$(nextNode).remove();\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($nextFigure.length === 1 && $nextFigure[0].tagName === 'FIGURE' && isNextFigureEmpty === '')\n\t\t\t\t\t{\n    \t\t\t\t\t$nextFigure.remove();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (direct !== null)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.callback('imageUpload', $img, json);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n    \t\t\t\t\tthis.core.callback('imageInserted', $img, json);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsetEditable: function($image)\n\t\t\t\t{\n\t\t\t\t\t$image.on('dragstart', function(e)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t});\n\n                    if (this.opts.imageResizable)\n                    {\n    \t\t\t\t\tvar handler = $.proxy(function(e)\n    \t\t\t\t\t{\n    \t\t\t\t\t\tthis.observe.image = $image;\n    \t\t\t\t\t\tthis.image.resizer = this.image.loadEditableControls($image);\n\n    \t\t\t\t\t\t$(document).on('mousedown.redactor-image-resize-hide.' + this.uuid, $.proxy(this.image.hideResize, this));\n\n    \t\t\t\t\t\tif (this.image.resizer)\n    \t\t\t\t\t\t{\n                                this.image.resizer.on('mousedown.redactor touchstart.redactor', $.proxy(function(e)\n        \t\t\t\t\t\t{\n        \t\t\t\t\t\t\tthis.image.setResizable(e, $image);\n        \t\t\t\t\t\t}, this));\n    \t\t\t\t\t\t}\n\n    \t\t\t\t\t}, this);\n\n    \t\t\t\t\t$image.off('mousedown.redactor').on('mousedown.redactor', $.proxy(this.image.hideResize, this));\n    \t\t\t\t\t$image.off('click.redactor touchstart.redactor').on('click.redactor touchstart.redactor', handler);\n                    }\n                    else\n                    {\n    \t\t\t\t\t$image.off('click.redactor touchstart.redactor').on('click.redactor touchstart.redactor', $.proxy(function(e)\n    \t\t\t\t\t{\n    \t\t\t\t\t\tsetTimeout($.proxy(function()\n    \t\t\t\t\t\t{\n    \t\t\t\t\t\t\tthis.image.showEdit($image);\n\n    \t\t\t\t\t\t}, this), 200);\n\n    \t\t\t\t\t}, this));\n                    }\n\n\t\t\t\t},\n\t\t\t\tsetResizable: function(e, $image)\n\t\t\t\t{\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t    this.image.resizeHandle = {\n\t\t\t\t        x : e.pageX,\n\t\t\t\t        y : e.pageY,\n\t\t\t\t        el : $image,\n\t\t\t\t        ratio: $image.width() / $image.height(),\n\t\t\t\t        h: $image.height()\n\t\t\t\t    };\n\n\t\t\t\t    e = e.originalEvent || e;\n\n\t\t\t\t    if (e.targetTouches)\n\t\t\t\t    {\n\t\t\t\t         this.image.resizeHandle.x = e.targetTouches[0].pageX;\n\t\t\t\t         this.image.resizeHandle.y = e.targetTouches[0].pageY;\n\t\t\t\t    }\n\n\t\t\t\t\tthis.image.startResize();\n\t\t\t\t},\n\t\t\t\tstartResize: function()\n\t\t\t\t{\n\t\t\t\t\t$(document).on('mousemove.redactor-image-resize touchmove.redactor-image-resize', $.proxy(this.image.moveResize, this));\n\t\t\t\t\t$(document).on('mouseup.redactor-image-resize touchend.redactor-image-resize', $.proxy(this.image.stopResize, this));\n\t\t\t\t},\n\t\t\t\tmoveResize: function(e)\n\t\t\t\t{\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\te = e.originalEvent || e;\n\n\t\t\t\t\tvar height = this.image.resizeHandle.h;\n\n\t\t            if (e.targetTouches) height += (e.targetTouches[0].pageY -  this.image.resizeHandle.y);\n\t\t            else height += (e.pageY -  this.image.resizeHandle.y);\n\n\t\t\t\t\tvar width = Math.round(height * this.image.resizeHandle.ratio);\n\n\t\t\t\t\tif (height < this.opts.imageMinResizeHeight || width < this.opts.imageMinResizeWidth) return;\n\n\t\t\t\t\tthis.image.resizeHandle.el.attr({width: width, height: height});\n\t\t            this.image.resizeHandle.el.width(width);\n\t\t            this.image.resizeHandle.el.height(height);\n\n\t\t            this.code.sync();\n\t\t\t\t},\n\t\t\t\tstopResize: function()\n\t\t\t\t{\n\t\t\t\t\tthis.handle = false;\n\t\t\t\t\t$(document).off('.redactor-image-resize');\n\n\t\t\t\t\tthis.image.hideResize();\n\t\t\t\t},\n                hideResize: function(e)\n\t\t\t\t{\n\t\t\t\t\tif (e && $(e.target).closest('#redactor-image-box', this.$editor[0]).length !== 0) return;\n\t\t\t\t\tif (e && e.target.tagName == 'IMG')\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $image = $(e.target);\n\t\t\t\t\t}\n\n\t\t\t\t\tvar imageBox = this.$editor.find('#redactor-image-box');\n\t\t\t\t\tif (imageBox.length === 0) return;\n\n\t\t\t\t\t$('#redactor-image-editter').remove();\n\t\t\t\t\t$('#redactor-image-resizer').remove();\n\n\t\t\t\t\timageBox.find('img').css({\n\t\t\t\t\t\tmarginTop: imageBox[0].style.marginTop,\n\t\t\t\t\t\tmarginBottom: imageBox[0].style.marginBottom,\n\t\t\t\t\t\tmarginLeft: imageBox[0].style.marginLeft,\n\t\t\t\t\t\tmarginRight: imageBox[0].style.marginRight\n\t\t\t\t\t});\n\n\t\t\t\t\timageBox.css('margin', '');\n\t\t\t\t\timageBox.find('img').css('opacity', '');\n\t\t\t\t\timageBox.replaceWith(function()\n\t\t\t\t\t{\n\t\t\t\t\t\treturn $(this).contents();\n\t\t\t\t\t});\n\n\t\t\t\t\t$(document).off('mousedown.redactor-image-resize-hide.' + this.uuid);\n\n\t\t\t\t\tif (typeof this.image.resizeHandle !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.image.resizeHandle.el.attr('rel', this.image.resizeHandle.el.attr('style'));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tloadResizableControls: function($image, imageBox)\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.imageResizable && !this.detect.isMobile())\n\t\t\t\t\t{\n\t\t\t\t\t\tvar imageResizer = $('<span id=\"redactor-image-resizer\" data-redactor=\"verified\"></span>');\n\n\t\t\t\t\t\tif (!this.detect.isDesktop())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\timageResizer.css({ width: '15px', height: '15px' });\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\timageResizer.attr('contenteditable', false);\n\t\t\t\t\t\timageBox.append(imageResizer);\n\t\t\t\t\t\timageBox.append($image);\n\n\t\t\t\t\t\treturn imageResizer;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\timageBox.append($image);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tloadEditableControls: function($image)\n\t\t\t\t{\n    \t\t\t\tif ($('#redactor-image-box').length !== 0)\n    \t\t\t\t{\n        \t\t\t\treturn;\n    \t\t\t\t}\n\n\t\t\t\t\tvar imageBox = $('<span id=\"redactor-image-box\" data-redactor=\"verified\">');\n\t\t\t\t\timageBox.css('float', $image.css('float')).attr('contenteditable', false);\n\n\t\t\t\t\tif ($image[0].style.margin != 'auto')\n\t\t\t\t\t{\n\t\t\t\t\t\timageBox.css({\n\t\t\t\t\t\t\tmarginTop: $image[0].style.marginTop,\n\t\t\t\t\t\t\tmarginBottom: $image[0].style.marginBottom,\n\t\t\t\t\t\t\tmarginLeft: $image[0].style.marginLeft,\n\t\t\t\t\t\t\tmarginRight: $image[0].style.marginRight\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t$image.css('margin', '');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\timageBox.css({ 'display': 'block', 'margin': 'auto' });\n\t\t\t\t\t}\n\n\t\t\t\t\t$image.css('opacity', '.5').after(imageBox);\n\n\n\t\t\t\t\tif (this.opts.imageEditable)\n\t\t\t\t\t{\n\t\t\t\t\t\t// editter\n\t\t\t\t\t\tthis.image.editter = $('<span id=\"redactor-image-editter\" data-redactor=\"verified\">' + this.lang.get('edit') + '</span>');\n\t\t\t\t\t\tthis.image.editter.attr('contenteditable', false);\n\t\t\t\t\t\tthis.image.editter.on('click', $.proxy(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.image.showEdit($image);\n\t\t\t\t\t\t}, this));\n\n\t\t\t\t\t\timageBox.append(this.image.editter);\n\n\t\t\t\t\t\t// position correction\n\t\t\t\t\t\tvar editerWidth = this.image.editter.innerWidth();\n\t\t\t\t\t\tthis.image.editter.css('margin-left', '-' + editerWidth/2 + 'px');\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this.image.loadResizableControls($image, imageBox);\n\n\t\t\t\t},\n\t\t\t\tshowEdit: function($image)\n\t\t\t\t{\n\t\t\t\t\tif (this.events.imageEditing)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.observe.image = $image;\n\n\t\t\t\t\tvar $link = $image.closest('a', this.$editor[0]);\n    \t\t\t\tvar $figure = $image.closest('figure', this.$editor[0]);\n    \t\t\t\tvar $container = ($figure.length !== 0) ? $figure : $image;\n\n\t\t\t\t\tthis.modal.load('image-edit', this.lang.get('edit'), 705);\n\n\t\t\t\t\tthis.image.buttonDelete = this.modal.getDeleteButton().text(this.lang.get('delete'));\n\t\t\t\t\tthis.image.buttonSave = this.modal.getActionButton().text(this.lang.get('save'));\n\n\t\t\t\t\tthis.image.buttonDelete.on('click', $.proxy(this.image.remove, this));\n\t\t\t\t\tthis.image.buttonSave.on('click', $.proxy(this.image.update, this));\n\n\t\t\t\t\tif (this.opts.imageCaption === false)\n\t\t\t\t\t{\n\t\t\t\t\t\t$('#redactor-image-caption').val('').hide().prev().hide();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $parent = $image.closest(this.opts.imageTag, this.$editor[0]);\n\t\t\t\t\t\tvar $ficaption = $parent.find('figcaption');\n\t\t\t\t\t\tif ($ficaption !== 0)\n\t\t\t\t\t\t{\n\n\t\t\t\t\t\t\t$('#redactor-image-caption').val($ficaption.text()).show();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!this.opts.imagePosition)\n\t\t\t\t\t{\n    \t\t\t\t\t$('.redactor-image-position-option').hide();\n    \t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n    \t\t\t\t\tvar isCentered = ($figure.length !== 0) ? ($container.css('text-align') === 'center') : ($container.css('display') == 'block' && $container.css('float') == 'none');\n\t\t\t\t\t\tvar floatValue = (isCentered) ? 'center' : $container.css('float');\n\t\t\t\t\t\t$('#redactor-image-align').val(floatValue);\n\t\t\t\t\t}\n\n\t\t\t\t\t$('#redactor-image-preview').html($('<img src=\"' + $image.attr('src') + '\" style=\"max-width: 100%;\">'));\n\t\t\t\t\t$('#redactor-image-title').val($image.attr('alt'));\n\n\t\t\t\t\tif ($link.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t$('#redactor-image-link').val($link.attr('href'));\n\t\t\t\t\t\tif ($link.attr('target') === '_blank')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$('#redactor-image-link-blank').prop('checked', true);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// hide link's tooltip\n\t\t\t\t\t$('.redactor-link-tooltip').remove();\n\n\t\t\t\t\tthis.modal.show();\n\n\t\t\t\t\t// focus\n\t\t\t\t\tif (this.detect.isDesktop())\n\t\t\t\t\t{\n\t\t\t\t\t\t$('#redactor-image-title').focus();\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tupdate: function()\n\t\t\t\t{\n\t\t\t\t\tvar $image = this.observe.image;\n\t\t\t\t\tvar $link = $image.closest('a', this.core.editor()[0]);\n\n\t\t\t\t\tvar title = $('#redactor-image-title').val().replace(/(<([^>]+)>)/ig,\"\");\n\t\t\t\t\t$image.attr('alt', title).attr('title', title);\n\n                    this.image.setFloating($image);\n\n\t\t\t\t\t// as link\n\t\t\t\t\tvar link = $.trim($('#redactor-image-link').val()).replace(/(<([^>]+)>)/ig,\"\");\n\t\t\t\t\tif (link !== '')\n\t\t\t\t\t{\n\t\t\t\t\t\t// test url (add protocol)\n\t\t\t\t\t\tvar pattern = '((xn--)?[a-z0-9]+(-[a-z0-9]+)*\\\\.)+[a-z]{2,}';\n\t\t\t\t\t\tvar re = new RegExp('^(http|ftp|https)://' + pattern, 'i');\n\t\t\t\t\t\tvar re2 = new RegExp('^' + pattern, 'i');\n\n\t\t\t\t\t\tif (link.search(re) === -1 && link.search(re2) === 0 && this.opts.linkProtocol)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlink = this.opts.linkProtocol + '://' + link;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar target = ($('#redactor-image-link-blank').prop('checked')) ? true : false;\n\n\t\t\t\t\t\tif ($link.length === 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar a = $('<a href=\"' + link + '\" id=\"redactor-img-tmp\">' + this.utils.getOuterHtml($image) + '</a>');\n\t\t\t\t\t\t\tif (target)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ta.attr('target', '_blank');\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t$image = $image.replaceWith(a);\n\t\t\t\t\t\t\t$link = this.core.editor().find('#redactor-img-tmp');\n\t\t\t\t\t\t\t$link.removeAttr('id');\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$link.attr('href', link);\n\t\t\t\t\t\t\tif (target)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$link.attr('target', '_blank');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$link.removeAttr('target');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if ($link.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t$link.replaceWith(this.utils.getOuterHtml($image));\n\t\t\t\t\t}\n\n                    this.image.addCaption($image, $link);\n\t\t\t\t\tthis.modal.close();\n\n\t\t\t\t\t// buffer\n\t\t\t\t\tthis.buffer.set();\n\n\t\t\t\t},\n\t\t\t\tsetFloating: function($image)\n\t\t\t\t{\n    \t\t\t\tvar $figure = $image.closest('figure', this.$editor[0]);\n    \t\t\t\tvar $container = ($figure.length !== 0) ? $figure : $image;\n\t\t\t\t\tvar floating = $('#redactor-image-align').val();\n\n\t\t\t\t\tvar imageFloat = '';\n\t\t\t\t\tvar imageDisplay = '';\n\t\t\t\t\tvar imageMargin = '';\n\t\t\t\t\tvar textAlign = '';\n\n\t\t\t\t\tswitch (floating)\n\t\t\t\t\t{\n\t\t\t\t\t\tcase 'left':\n\t\t\t\t\t\t\timageFloat = 'left';\n\t\t\t\t\t\t\timageMargin = '0 ' + this.opts.imageFloatMargin + ' ' + this.opts.imageFloatMargin + ' 0';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'right':\n\t\t\t\t\t\t\timageFloat = 'right';\n\t\t\t\t\t\t\timageMargin = '0 0 ' + this.opts.imageFloatMargin + ' ' + this.opts.imageFloatMargin;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'center':\n\n                            if ($figure.length !== 0)\n                            {\n                                textAlign = 'center';\n                            }\n                            else\n                            {\n\t    \t\t\t\t\t\timageDisplay = 'block';\n    \t\t\t\t\t\t\timageMargin = 'auto';\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\t$container.css({ 'float': imageFloat, 'display': imageDisplay, 'margin': imageMargin, 'text-align': textAlign });\n\t\t\t\t\t$container.attr('rel', $image.attr('style'));\n\t\t\t\t},\n\t\t\t\taddCaption: function($image, $link)\n\t\t\t\t{\n                    var caption = $('#redactor-image-caption').val();\n\n                    var $target = ($link.length !== 0) ? $link : $image;\n\t\t\t\t\tvar $figcaption = $target.next();\n\n\t\t\t\t\tif ($figcaption.length === 0 || $figcaption[0].tagName !== 'FIGCAPTION')\n\t\t\t\t\t{\n\t\t\t\t\t\t$figcaption = false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (caption !== '')\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($figcaption === false)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$figcaption = $('<figcaption />').text(caption);\n\t\t\t\t\t\t\t$target.after($figcaption);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$figcaption.text(caption);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if ($figcaption !== false)\n\t\t\t\t\t{\n\t\t\t\t\t\t$figcaption.remove();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tremove: function(e, $image, index)\n\t\t\t\t{\n\t\t\t\t\t$image = (typeof $image === 'undefined') ? $(this.observe.image) : $image;\n\n\t\t\t\t\t// delete from modal\n\t\t\t\t\tif (typeof e !== 'boolean')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buffer.set();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.events.stopDetectChanges();\n\n\t\t\t\t\tvar $link = $image.closest('a', this.core.editor()[0]);\n\t\t\t\t\tvar $figure = $image.closest(this.opts.imageTag, this.core.editor()[0]);\n\t\t\t\t\tvar $parent = $image.parent();\n\n\t\t\t\t\t// callback\n                    var imageDeleteStop = this.core.callback('imageDelete', e, $image[0]);\n\t\t\t\t\tif (imageDeleteStop === false)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (e) e.preventDefault();\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($('#redactor-image-box').length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t$parent = $('#redactor-image-box').parent();\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $next, $prev;\n\t\t\t\t\tif ($figure.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t$prev = $figure.prev();\n\t\t\t\t\t\t$next = $figure.next();\n\t\t\t\t\t\t$figure.remove();\n\t\t\t\t\t}\n\t\t\t\t\telse if ($link.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t$parent = $link.parent();\n\t\t\t\t\t\t$link.remove();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t$image.remove();\n\t\t\t\t\t}\n\n\t\t\t\t\t$('#redactor-image-box').remove();\n\n\t\t\t\t\tif (e !== false)\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($next && $next.length !== 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.caret.start($next);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if ($prev && $prev.length !== 0)\n\t\t\t\t\t\t{\n                            this.caret.end($prev);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (typeof e !== 'boolean')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.modal.close();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.utils.restoreScroll();\n\t\t\t\t\tthis.observe.image = false;\n\t\t\t\t\tthis.events.startDetectChanges();\n\t\t\t\t\tthis.placeholder.enable();\n\t\t\t\t\tthis.code.sync();\n\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =indent\n\t\tindent: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tincrease: function()\n\t\t\t\t{\n\t\t\t\t\tif (!this.list.get())\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $current = $(this.selection.current()).closest('li');\n\t\t\t\t\tvar $list = $current.closest('ul, ol', this.core.editor()[0]);\n\n\t\t\t\t\tvar $li = $current.closest('li');\n\t\t\t\t\tvar $prev = $li.prev();\n\t\t\t\t\tif ($prev.length === 0 || $prev[0].tagName !== 'LI')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.buffer.set();\n\n\n\t\t\t\t\tif (this.utils.isCollapsed())\n\t\t\t\t\t{\n\t\t\t\t\t\tvar listTag = $list[0].tagName;\n\t\t\t\t\t\tvar $newList = $('<' + listTag + ' />');\n\n\t\t\t\t\t\tthis.selection.save();\n\n                        var $ol = $prev.find('ol').first();\n                        if ($ol.length === 1)\n                        {\n                            $ol.append($current);\n                        }\n                        else\n                        {\n                            var listTag = $list[0].tagName;\n                            var $newList = $('<' + listTag + ' />');\n                            $newList.append($current);\n                            $prev.append($newList);\n                        }\n\n\t\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tdocument.execCommand('indent');\n\n\t\t\t\t\t\t// normalize\n\t\t\t\t\t\tthis.selection.save();\n\t\t\t\t\t\tthis.indent.removeEmpty();\n\t\t\t\t\t\tthis.indent.normalize();\n\t\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tdecrease: function()\n\t\t\t\t{\n\t\t\t\t\tif (!this.list.get())\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $current = $(this.selection.current()).closest('li');\n\t\t\t\t\tvar $list = $current.closest('ul, ol', this.core.editor()[0]);\n\n\t\t\t\t\tthis.buffer.set();\n\n\t\t\t\t\tdocument.execCommand('outdent');\n\n\t\t\t\t\tvar $item = $(this.selection.current()).closest('li', this.core.editor()[0]);\n\n\t\t\t\t\tif (this.utils.isCollapsed())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.indent.repositionItem($item);\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($item.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tdocument.execCommand('formatblock', false, 'p');\n\t\t\t\t\t\t$item = $(this.selection.current());\n\t\t\t\t\t\tvar $next = $item.next();\n\t\t\t\t\t\tif ($next.length !== 0 && $next[0].tagName === 'BR')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$next.remove();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// normalize\n\t\t\t\t\tthis.selection.save();\n\t\t\t\t\tthis.indent.removeEmpty();\n\t\t\t\t\tthis.indent.normalize();\n\t\t\t\t\tthis.selection.restore();\n\n\t\t\t\t},\n\t\t\t\trepositionItem: function($item)\n\t\t\t\t{\n    \t\t\t\tvar $next = $item.next();\n    \t\t\t\tif ($next.length !== 0 && ($next[0].tagName !== 'UL' || $next[0].tagName !== 'OL'))\n    \t\t\t\t{\n        \t\t\t\t$item.append($next);\n    \t\t\t\t}\n\n\t\t\t\t\tvar $prev = $item.prev();\n\t\t\t\t\tif ($prev.length !== 0 && $prev[0].tagName !== 'LI')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.selection.save();\n\t\t\t\t\t\tvar $li = $item.parents('li', this.core.editor()[0]);\n\t\t\t\t\t\t$li.after($item);\n\t\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tnormalize: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().find('li').each($.proxy(function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $el = $(s);\n\n\t\t\t\t\t\t// remove style\n\t\t\t\t\t\t$el.find(this.opts.inlineTags.join(',')).each(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$(this).removeAttr('style');\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tvar $parent = $el.parent();\n\t\t\t\t\t\tif ($parent.length !== 0 && $parent[0].tagName === 'LI')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$parent.after($el);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar $next = $el.next();\n\t\t\t\t\t\tif ($next.length !== 0 && ($next[0].tagName === 'UL' || $next[0].tagName === 'OL'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$el.append($next);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t},\n\t\t\t\tremoveEmpty: function($list)\n\t\t\t\t{\n\t\t\t\t\tvar $lists = this.core.editor().find('ul, ol');\n\t\t\t\t\tvar $items = this.core.editor().find('li');\n\n\t\t\t\t\t$items.each($.proxy(function(i, s)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.indent.removeItemEmpty(s);\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\t$lists.each($.proxy(function(i, s)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.indent.removeItemEmpty(s);\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\t$items.each($.proxy(function(i, s)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.indent.removeItemEmpty(s);\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\tremoveItemEmpty: function(s)\n\t\t\t\t{\n\t\t\t\t\tvar html = s.innerHTML.replace(/[\\t\\s\\n]/g, '');\n\t\t\t\t\thtml = html.replace(/<span><\\/span>/g, '');\n\n\t\t\t\t\tif (html === '')\n\t\t\t\t\t{\n\t\t\t\t\t\t$(s).remove();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =inline\n\t\tinline: function()\n\t\t{\n\t\t\treturn {\n                format: function(tag, attr, value, type)\n\t\t\t\t{\n    \t\t\t\t// Stop formatting pre/code\n\t\t\t\t\tif (this.utils.isCurrentOrParent(['PRE', 'CODE'])) return;\n\n\t\t\t\t\t// Get params\n\t\t\t\t\tvar params = this.inline.getParams(attr, value, type);\n\n                    // Arrange tag\n                    tag = this.inline.arrangeTag(tag);\n\n                    this.placeholder.hide();\n\t\t\t\t\tthis.buffer.set();\n\n\t\t\t\t\t(this.utils.isCollapsed()) ? this.inline.formatCollapsed(tag, params) : this.inline.formatUncollapsed(tag, params);\n\t\t\t\t},\n\t\t\t\tformatCollapsed: function(tag, params)\n\t\t\t\t{\n    \t\t\t\tvar newInline;\n    \t\t\t\tvar inline = this.selection.inline();\n\n    \t\t\t\tif (inline)\n\t\t\t\t\t{\n                        var currentTag = inline.tagName.toLowerCase();\n                        if (currentTag === tag)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t// empty = remove\n\t\t\t\t\t\t\tif (this.utils.isEmpty(inline.innerHTML))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.caret.after(inline);\n\t\t\t\t\t\t\t\t$(inline).remove();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// not empty = break\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvar $first = this.inline.insertBreakpoint(inline, currentTag);\n\t\t\t\t\t\t\t\tthis.caret.after($first);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n                        else if ($(inline).closest(tag).length === 0)\n                        {\n\t\t\t\t\t\t\tnewInline = this.inline.insertInline(tag);\n\t\t\t\t\t\t\tnewInline = this.inline.setParams(newInline, params);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n    \t\t\t\t\t\tvar $first = this.inline.insertBreakpoint(inline, currentTag);\n                            this.caret.after($first);\n\t\t\t\t\t\t}\n    \t\t\t\t}\n    \t\t\t\telse\n    \t\t\t\t{\n                        newInline = this.inline.insertInline(tag);\n                        newInline = this.inline.setParams(newInline, params);\n    \t\t\t\t}\n\t\t\t\t},\n\t\t\t\tformatUncollapsed: function(tag, params)\n\t\t\t\t{\n    \t\t\t\tthis.selection.save();\n\n                    var nodes = this.inline.getClearedNodes();\n                    this.inline.setNodesStriked(nodes, tag, params);\n\n                    this.selection.restore();\n\n                    document.execCommand('strikethrough');\n\n                    this.selection.saveInstant();\n\n                    var self = this;\n                    this.core.editor().find('strike').each(function()\n    \t\t\t\t{\n                        var $el = self.utils.replaceToTag(this, tag);\n        \t\t\t\tself.inline.setParams($el[0], params);\n\n        \t\t\t\tvar $inside = $el.find(tag);\n        \t\t\t\tvar $parent = $el.parent();\n        \t\t\t\tvar $parentAround = $parent.parent();\n\n                        // revert formatting (safari bug)\n                        if ($parentAround.length !== 0 && $parentAround[0].tagName.toLowerCase() === tag && $parentAround.html() == $parent[0].outerHTML)\n                        {\n                            $el.replaceWith(function() { return $(this).contents(); });\n                            $parentAround.replaceWith(function() { return $(this).contents(); });\n\n                            return;\n                        }\n\n        \t\t\t\t// remove inside\n        \t\t\t\tif ($inside.length !== 0) self.inline.cleanInsideOrParent($inside, params);\n\n                        // same parent\n                        if ($parent.html() == $el[0].outerHTML) self.inline.cleanInsideOrParent($parent, params);\n\n                        // bugfix: remove empty inline tags after selection\n                        if (self.detect.isFirefox())\n                        {\n                            self.core.editor().find(tag + ':empty').remove();\n                        }\n    \t\t\t\t});\n\n    \t\t\t\tthis.selection.restoreInstant();\n\t\t\t\t},\n\t\t\t\tcleanInsideOrParent: function($el, params)\n\t\t\t\t{\n                    if (params)\n                    {\n                        for (var key in params.data)\n                        {\n        \t\t\t\t    this.inline.removeSpecificAttr($el, key, params.data[key]);\n        \t\t\t\t}\n    \t\t\t\t}\n\t\t\t\t},\n    \t\t\tgetClearedNodes: function()\n    \t\t\t{\n                    var nodes = this.selection.nodes();\n        \t\t\tvar newNodes = [];\n        \t\t\tvar len = nodes.length;\n                    var started = 0;\n\n                    // find array slice\n                    for (var i = 0; i < len; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($(nodes[i]).hasClass('redactor-selection-marker'))\n\t\t\t\t\t\t{\n    \t\t\t\t\t\tstarted = i + 2;\n    \t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n                    // find selected inline & text nodes\n                    for (var i = 0; i < len; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (i >= started && !this.utils.isBlockTag(nodes[i].tagName))\n\t\t\t\t\t\t{\n                            newNodes.push(nodes[i]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn newNodes;\n    \t\t\t},\n                isConvertableAttr: function(node, name, value)\n                {\n                    var nodeAttrValue = $(node).attr(name);\n                    if (nodeAttrValue)\n                    {\n                        if (name === 'style')\n                        {\n                            value = $.trim(value).replace(/;$/, '')\n\n                            var rules = value.split(';');\n                            var count = 0;\n                            for (var i = 0; i < rules.length; i++)\n                            {\n                                var arr = rules[i].split(':');\n                                var ruleName = $.trim(arr[0]);\n                                var ruleValue = $.trim(arr[1]);\n\n                                if (ruleName.search(/color/) !== -1)\n                                {\n                                    var val = $(node).css(ruleName);\n                                    if (val && (val === ruleValue || this.utils.rgb2hex(val) === ruleValue))\n                                    {\n                                        count++;\n                                    }\n                                }\n                                else if ($(node).css(ruleName) === ruleValue)\n                                {\n                                    count++;\n                                }\n                            }\n\n                            if (count === rules.length)\n                            {\n                                return 1;\n                            }\n                        }\n                        else if (nodeAttrValue === value)\n                        {\n                            return 1;\n                        }\n                    }\n\n                    return 0;\n\n                },\n    \t\t\tisConvertable: function(node, nodeTag, tag, params)\n    \t\t\t{\n                    if (nodeTag === tag)\n                    {\n                        if (params)\n                        {\n                            var count = 0;\n                            for (var key in params.data)\n                            {\n                                count += this.inline.isConvertableAttr(node, key, params.data[key]);\n                            }\n\n                            if (count === Object.keys(params.data).length)\n                            {\n                                return true;\n                            }\n                        }\n                        else\n                        {\n                            return true;\n                        }\n                    }\n\n                    return false;\n    \t\t\t},\n    \t\t\tsetNodesStriked: function(nodes, tag, params)\n    \t\t\t{\n                    for (var i = 0; i < nodes.length; i++)\n\t\t\t\t\t{\n                        var nodeTag = (nodes[i].tagName) ? nodes[i].tagName.toLowerCase() : undefined;\n\n                        var parent = nodes[i].parentNode;\n                        var parentTag = (parent && parent.tagName) ? parent.tagName.toLowerCase() : undefined;\n\n                        var convertable = this.inline.isConvertable(parent, parentTag, tag, params);\n                        if (convertable)\n                        {\n                            var $el = $(parent).replaceWith(function()\n                            {\n                                return $('<strike>').append($(this).contents());\n                            });\n\n                            $el.attr('data-redactor-inline-converted');\n                        }\n\n                        var convertable = this.inline.isConvertable(nodes[i], nodeTag, tag, params);\n                        if (convertable)\n                        {\n                            var $el = $(nodes[i]).replaceWith(function()\n                            {\n                                return $('<strike>').append($(this).contents());\n                            });\n                        }\n    \t\t\t\t}\n    \t\t\t},\n                insertBreakpoint: function(inline, currentTag)\n\t\t\t\t{\n\t\t\t\t\tvar breakpoint = document.createElement('span');\n\t\t\t\t\tbreakpoint.id = 'redactor-inline-breakpoint';\n\t\t\t\t\tbreakpoint = this.insert.node(breakpoint);\n\n\t\t\t\t\tvar end = this.utils.isEndOfElement(inline);\n\t\t\t\t\tvar code = this.utils.getOuterHtml(inline);\n\t\t\t\t\tvar endTag = (end) ? '' : '<' + currentTag + '>';\n\n                    code = code.replace(/<span id=\"redactor-inline-breakpoint\"><\\/span>/i, \"</\" + currentTag + \">\" + endTag);\n\n\t\t\t\t\tvar $code = $(code);\n\t\t\t\t\t$(inline).replaceWith($code);\n\n\t\t\t\t\tif (endTag !== '')\n\t\t\t\t\t{\n    \t\t\t\t\tthis.utils.cloneAttributes(inline, $code.last());\n\t\t\t\t\t}\n\n\t\t\t\t\treturn $code.first();\n\t\t\t\t},\n                insertInline: function(tag)\n\t\t\t\t{\n\t\t\t\t\tvar node = document.createElement(tag);\n\n\t\t\t\t\tthis.insert.node(node);\n\t\t\t\t\tthis.caret.start(node);\n\n\t\t\t\t\treturn node;\n\t\t\t\t},\n\t\t\t\tarrangeTag: function(tag)\n\t\t\t\t{\n                    var tags = ['b', 'bold', 'i', 'italic', 'underline', 'strikethrough', 'deleted', 'superscript', 'subscript'];\n\t\t\t\t\tvar replaced = ['strong', 'strong', 'em', 'em', 'u', 'del', 'del', 'sup', 'sub'];\n\n    \t\t\t\ttag = tag.toLowerCase();\n\n\t\t\t\t\tfor (var i = 0; i < tags.length; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (tag === tags[i])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttag = replaced[i];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn tag;\n\t\t\t\t},\n\t\t\t\tgetStyleParams: function(params)\n\t\t\t\t{\n                    var result = {};\n    \t\t\t\tvar rules = params.trim().replace(/;$/, '').split(';');\n    \t\t\t\tfor (var i = 0; i < rules.length; i++)\n    \t\t\t\t{\n        \t\t\t\tvar rule = rules[i].split(':');\n        \t\t\t\tif (rule)\n        \t\t\t\t{\n                            result[rule[0].trim()] = rule[1].trim();\n                        }\n    \t\t\t\t}\n\n    \t\t\t\treturn result;\n\t\t\t\t},\n\t\t\t\tgetParams: function(attr, value, type)\n\t\t\t\t{\n \t\t\t\t    var data = false;\n    \t\t\t\tvar func = 'toggle';\n    \t\t\t\tif (typeof attr === 'object')\n    \t\t\t\t{\n        \t\t\t\tdata = attr;\n        \t\t\t\tfunc = (value !== undefined) ? value : func;\n    \t\t\t\t}\n    \t\t\t\telse if (attr !== undefined && value !== undefined)\n    \t\t\t\t{\n        \t\t\t\tdata = {};\n        \t\t\t\tdata[attr] = value;\n        \t\t\t\tfunc = (type !== undefined) ? type : func;\n    \t\t\t\t}\n\n    \t\t\t\treturn (data) ? { 'func': func, 'data': data } : false;\n\t\t\t\t},\n\t\t\t\tsetParams: function(node, params)\n\t\t\t\t{\n                    if (params)\n                    {\n                        for (var key in params.data)\n                        {\n                            var $node = $(node);\n                            if (key === 'style')\n                            {\n                                node = this.inline[params.func + 'Style'](params.data[key], node);\n                                $node.attr('data-redactor-style-cache', $node.attr('style'));\n                            }\n                            else if (key === 'class')\n                            {\n                                node = this.inline[params.func + 'Class'](params.data[key], node);\n                            }\n                            // attr\n                            else\n                            {\n                                node = (params.func === 'remove') ? this.inline[params.func + 'Attr'](key, node) : this.inline[params.func + 'Attr'](key, params.data[key], node);\n                            }\n\n                            if (key === 'style' && node.tagName === 'SPAN')\n                            {\n                                $node.attr('data-redactor-span', true);\n                            }\n                        }\n                    }\n\n                    return node;\n\t\t\t\t},\n\n                // Each\n                eachInline: function(node, callback)\n                {\n                    var lastNode;\n                    var nodes = (node === undefined) ? this.selection.inlines() : [node];\n    \t\t\t\tif (nodes)\n    \t\t\t\t{\n        \t\t\t\tfor (var i = 0; i < nodes.length; i++)\n        \t\t\t\t{\n            \t\t\t\tlastNode = callback(nodes[i])[0];\n        \t\t\t\t}\n    \t\t\t\t}\n\n    \t\t\t\treturn lastNode;\n                },\n\n                // Class\n                replaceClass: function(value, node)\n\t\t\t\t{\n    \t\t\t\treturn this.inline.eachInline(node, function(el)\n    \t\t\t\t{\n                        return $(el).removeAttr('class').addClass(value);\n    \t\t\t\t});\n\t\t\t\t},\n\t\t\t\ttoggleClass: function(value, node)\n\t\t\t\t{\n    \t\t\t\treturn this.inline.eachInline(node, function(el)\n    \t\t\t\t{\n                        return $(el).toggleClass(value);\n    \t\t\t\t});\n\t\t\t\t},\n\t\t\t\taddClass: function(value, node)\n\t\t\t\t{\n    \t\t\t\treturn this.inline.eachInline(node, function(el)\n    \t\t\t\t{\n                        return $(el).addClass(value);\n    \t\t\t\t});\n\t\t\t\t},\n\t\t\t\tremoveClass: function(value, node)\n\t\t\t\t{\n    \t\t\t\treturn this.inline.eachInline(node, function(el)\n    \t\t\t\t{\n                        return $(el).removeClass(value);\n    \t\t\t\t});\n\t\t\t\t},\n\t\t\t\tremoveAllClass: function(node)\n\t\t\t\t{\n    \t\t\t\treturn this.inline.eachInline(node, function(el)\n    \t\t\t\t{\n                        return $(el).removeAttr('class');\n    \t\t\t\t});\n\t\t\t\t},\n\n\t\t\t\t// Attr\n\t\t\t\treplaceAttr: function(name, value, node)\n\t\t\t\t{\n    \t\t\t\treturn this.inline.eachInline(node, function(el)\n    \t\t\t\t{\n                        return $(el).removeAttr(name).attr(name. value);\n    \t\t\t\t});\n\t\t\t\t},\n\t\t\t\ttoggleAttr: function(name, value, node)\n\t\t\t\t{\n    \t\t\t\treturn this.inline.eachInline(node, function(el)\n    \t\t\t\t{\n        \t\t\t\tvar attr = $(el).attr(name);\n\n        \t\t\t\treturn (attr) ? $(el).removeAttr(name) : $(el).attr(name. value);\n    \t\t\t\t});\n\t\t\t\t},\n\t\t\t\taddAttr: function(name, value, node)\n\t\t\t\t{\n    \t\t\t\treturn this.inline.eachInline(node, function(el)\n    \t\t\t\t{\n                        return $(el).attr(name, value);\n    \t\t\t\t});\n\t\t\t\t},\n\t\t\t\tremoveAttr: function(name, node)\n\t\t\t\t{\n    \t\t\t\treturn this.inline.eachInline(node, function(el)\n    \t\t\t\t{\n        \t\t\t\tvar $el = $(el);\n\n                        $el.removeAttr(name);\n                        if (name === 'style')\n                        {\n        \t\t\t\t    $el.removeAttr('data-redactor-style-cache');\n        \t\t\t\t}\n\n                        return $el;\n    \t\t\t\t});\n\t\t\t\t},\n\t\t\t\tremoveAllAttr: function(node)\n\t\t\t\t{\n    \t\t\t\treturn this.inline.eachInline(node, function(el)\n    \t\t\t\t{\n        \t\t\t\tvar $el = $(el);\n                        var len = el.attributes.length;\n\t\t\t\t\t\tfor (var z = 0; z < len; z++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$el.removeAttr(el.attributes[z].name);\n\t\t\t\t\t\t}\n\n                        return $el;\n    \t\t\t\t});\n\t\t\t\t},\n\t\t\t\tremoveSpecificAttr: function(node, key, value)\n\t\t\t\t{\n    \t\t\t\tvar $el = $(node);\n    \t\t\t\tif (key === 'style')\n    \t\t\t\t{\n        \t\t\t\tvar arr = value.split(':');\n        \t\t\t\tvar name = arr[0].trim();\n                        $el.css(name, '');\n\n                        if (this.utils.removeEmptyAttr(node, 'style'))\n                        {\n                            $el.removeAttr('data-redactor-style-cache');\n                        }\n    \t\t\t\t}\n    \t\t\t\telse\n    \t\t\t\t{\n        \t\t\t\t$el.removeAttr(key)[0];\n    \t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\t// Style\n\t\t\t\thasParentStyle: function($el)\n\t\t\t\t{\n                    var $parent = $el.parent();\n\n                    return ($parent.length === 1 && $parent[0].tagName === $el[0].tagName && $parent.html() === $el[0].outerHTML) ? $parent : false;\n\t\t\t\t},\n\t\t\t\taddParentStyle: function($el)\n\t\t\t\t{\n                    var $parent = this.inline.hasParentStyle($el);\n                    if ($parent)\n                    {\n                        var style = this.inline.getStyleParams($el.attr('style'));\n                        $parent.css(style);\n                        $parent.attr('data-redactor-style-cache', $parent.attr('style'));\n\n                        $el.replaceWith(function()\n                        {\n                            return $(this).contents();\n                        });\n                    }\n                    else\n                    {\n                        $el.attr('data-redactor-style-cache', $el.attr('style'));\n                    }\n\n                    return $el;\n\t\t\t\t},\n\t\t\t\treplaceStyle: function(params, node)\n\t\t\t\t{\n    \t\t\t\tparams = this.inline.getStyleParams(params);\n\n                    var self = this;\n    \t\t\t\treturn this.inline.eachInline(node, function(el)\n    \t\t\t\t{\n        \t\t\t\tvar $el = $(el);\n                        $el.removeAttr('style').css(params);\n\n                        var style = $el.attr('style');\n                        if (style) $el.attr('style', style.replace(/\"/g, '\\''));\n\n                        $el = self.inline.addParentStyle($el);\n\n                        return $el;\n    \t\t\t\t});\n\t\t\t\t},\n\t\t\t\ttoggleStyle: function(params, node)\n\t\t\t\t{\n    \t\t\t\tparams = this.inline.getStyleParams(params);\n\n                    var self = this;\n    \t\t\t\treturn this.inline.eachInline(node, function(el)\n    \t\t\t\t{\n        \t\t\t\tvar $el = $(el);\n\n                        for (var key in params)\n                        {\n                            var newVal = params[key];\n                            var oldVal = $el.css(key);\n\n                            oldVal = (self.utils.isRgb(oldVal)) ? self.utils.rgb2hex(oldVal) : oldVal.replace(/\"/g, '');\n                            newVal = (self.utils.isRgb(newVal)) ? self.utils.rgb2hex(newVal) : newVal.replace(/\"/g, '');\n\n                            if (oldVal === newVal)\n                            {\n                                $el.css(key, '');\n                            }\n                            else\n                            {\n                                $el.css(key, newVal);\n                            }\n                        }\n\n                        var style = $el.attr('style');\n                        if (style) $el.attr('style', style.replace(/\"/g, '\\''));\n\n                        if (!self.utils.removeEmptyAttr(el, 'style'))\n                        {\n                            $el = self.inline.addParentStyle($el);\n                        }\n                        else\n                        {\n                            $el.removeAttr('data-redactor-style-cache');\n                        }\n\n\n                        return $el;\n    \t\t\t\t});\n\t\t\t\t},\n\t\t\t\taddStyle: function(params, node)\n\t\t\t\t{\n                    params = this.inline.getStyleParams(params);\n\n                    var self = this;\n    \t\t\t\treturn this.inline.eachInline(node, function(el)\n    \t\t\t\t{\n                        var $el = $(el);\n\n                        $el.css(params);\n\n                        var style = $el.attr('style');\n                        if (style) $el.attr('style', style.replace(/\"/g, '\\''));\n\n                        $el = self.inline.addParentStyle($el);\n\n                        return $el;\n    \t\t\t\t});\n\t\t\t\t},\n\t\t\t\tremoveStyle: function(params, node)\n\t\t\t\t{\n    \t\t\t\tparams = this.inline.getStyleParams(params);\n\n                    var self = this;\n    \t\t\t\treturn this.inline.eachInline(node, function(el)\n    \t\t\t\t{\n        \t\t\t\tvar $el = $(el);\n\n                        for (var key in params)\n                        {\n                            $el.css(key, '');\n                        }\n\n                        if (self.utils.removeEmptyAttr(el, 'style'))\n                        {\n                            $el.removeAttr('data-redactor-style-cache');\n                        }\n                        else\n                        {\n                            $el.attr('data-redactor-style-cache', $el.attr('style'));\n                        }\n\n                        return $el;\n    \t\t\t\t});\n\t\t\t\t},\n\t\t\t\tremoveAllStyle: function(node)\n\t\t\t\t{\n    \t\t\t\treturn this.inline.eachInline(node, function(el)\n    \t\t\t\t{\n                        return $(el).removeAttr('style').removeAttr('data-redactor-style-cache');\n    \t\t\t\t});\n\t\t\t\t},\n                removeStyleRule: function(name)\n\t\t\t\t{\n\t\t\t\t\tvar parent = this.selection.parent();\n\t\t\t\t\tvar nodes = this.selection.inlines();\n\n                    this.buffer.set();\n\n\t\t\t\t\tif (parent && parent.tagName === 'SPAN')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.inline.removeStyleRuleAttr($(parent), name);\n\t\t\t\t\t}\n\n                    for (var i = 0; i < nodes.length; i++)\n\t\t\t\t\t{\n    \t\t\t\t\tvar el = nodes[i];\n\t\t\t\t\t\tvar $el = $(el);\n\t\t\t\t\t\tif ($.inArray(el.tagName.toLowerCase(), this.opts.inlineTags) != -1 && !$el.hasClass('redactor-selection-marker'))\n\t\t\t\t\t\t{\n                            this.inline.removeStyleRuleAttr($el, name);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tremoveStyleRuleAttr: function($el, name)\n\t\t\t\t{\n                    $el.css(name, '');\n\t\t\t\t\tif (this.utils.removeEmptyAttr($el, 'style'))\n\t\t\t\t\t{\n\t\t\t\t\t\t$el.removeAttr('data-redactor-style-cache');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n    \t\t\t\t\t$el.attr('data-redactor-style-cache', $el.attr('style'));\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\t// Update\n\t\t\t\tupdate: function(tag, attr, value, type)\n\t\t\t\t{\n                    tag = this.inline.arrangeTag(tag);\n\n\t\t\t\t\tvar params = this.inline.getParams(attr, value, type);\n\t\t\t\t\tvar nodes = this.selection.inlines();\n\t\t\t\t\tvar result = [];\n\n                    if (nodes)\n                    {\n                        for (var i = 0; i < nodes.length; i++)\n                        {\n                            var el = nodes[i];\n                            if (tag === '*' || el.tagName.toLowerCase() === tag)\n                            {\n    \t\t\t\t\t\t    result.push(this.inline.setParams(el, params));\n    \t\t\t\t\t\t}\n                        }\n                    }\n\n                    return result;\n\t\t\t\t},\n\n                // All\n\t\t\t\tremoveFormat: function()\n\t\t\t\t{\n    \t\t\t\tthis.selection.save();\n\n    \t\t\t\tvar nodes = this.inline.getClearedNodes();\n    \t\t\t\tfor (var i = 0; i < nodes.length; i++)\n    \t\t\t\t{\n        \t\t\t\tif (nodes[i].nodeType === 1)\n        \t\t\t\t{\n            \t\t\t\t$(nodes[i]).replaceWith(function()\n                            {\n                                return $(this).contents();\n                            });\n        \t\t\t\t}\n    \t\t\t\t}\n\n    \t\t\t\tthis.selection.restore();\n\t\t\t\t}\n\n\t\t\t};\n\t\t},\n\n\t\t// =insert\n\t\tinsert: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tset: function(html)\n\t\t\t\t{\n\t\t\t\t\tthis.placeholder.hide();\n\n\t\t\t\t\tthis.code.set(html);\n\t\t\t\t\tthis.focus.end();\n\n\t\t\t\t\tthis.placeholder.enable();\n\t\t\t\t},\n\t\t\t\thtml: function(html, data)\n\t\t\t\t{\n\t\t\t\t\tthis.placeholder.hide();\n\t\t\t\t\tthis.core.editor().focus();\n\n\t\t\t\t\tvar block = this.selection.block();\n\t\t\t\t\tvar inline = this.selection.inline();\n\n\t\t\t\t\t// clean\n\t\t\t\t\tif (typeof data === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tdata = this.clean.getCurrentType(html, true);\n\t\t\t\t\t\thtml = this.clean.onPaste(html, data, true);\n\t\t\t\t\t}\n\n\t\t\t\t\thtml = $.parseHTML(html);\n\n                    // end node\n                    var endNode = $(html).last();\n\n\t\t\t\t\t// delete selected content\n\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\tvar range = this.selection.range(sel);\n\t\t\t\t\trange.deleteContents();\n\n\t\t\t\t\tthis.selection.update(sel, range);\n\n\t\t\t\t\t// insert list in list\n\t\t\t\t\tif (data.lists)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $list = $(html);\n\t\t\t\t\t\tif ($list.length !== 0 && ($list[0].tagName === 'UL' || $list[0].tagName === 'OL'))\n\t\t\t\t\t\t{\n\n\t\t\t\t\t\t\tthis.insert.appendLists(block, $list);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (data.blocks && block)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.utils.isSelectAll())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.core.editor().html(html);\n\t\t\t\t\t\t\tthis.focus.end();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar breaked = this.utils.breakBlockTag();\n\t\t\t\t\t\t\tif (breaked === false)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.insert.placeHtml(html);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n    \t\t\t\t\t\t\tvar $last = $(html).children().last();\n\t\t\t\t\t\t\t\t$last.append(this.marker.get());\n\n\t\t\t\t\t\t\t\tif (breaked.type === 'start')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tbreaked.$block.before(html);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tbreaked.$block.after(html);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\t\t\t\tthis.core.editor().find('p').each(function()\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tif ($.trim(this.innerHTML) === '')\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tif (inline)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t// remove same tag inside\n\t\t\t\t\t\t\tvar $div = $(\"<div/>\").html(html);\n\t\t\t\t\t\t\t$div.find(inline.tagName.toLowerCase()).each(function()\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$(this).contents().unwrap();\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\thtml = $div.html();\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.utils.isSelectAll())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar $node = $(this.opts.emptyHtml);\n\t\t\t\t\t\t\tthis.core.editor().html('').append($node);\n\t\t\t\t\t\t\t$node.html(html);\n\t\t\t\t\t\t\tthis.caret.end($node);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.insert.placeHtml(html);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.utils.disableSelectAll();\n\n\t\t\t\t\tif (data.pre) this.clean.cleanPre();\n\n                    this.caret.end(endNode);\n                    this.linkify.format();\n\t\t\t\t},\n\t\t\t\ttext: function(text)\n\t\t\t\t{\n\t\t\t\t\ttext = text.toString();\n\t\t\t\t\ttext = $.trim(text);\n\n\t\t\t\t\tvar tmp = document.createElement('div');\n\t\t\t\t\ttmp.innerHTML = text;\n\t\t\t\t\ttext = tmp.textContent || tmp.innerText;\n\n\t\t\t\t\tif (typeof text === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.placeholder.hide();\n\t\t\t\t\tthis.core.editor().focus();\n\n\t\t\t\t\t// blocks\n\t\t\t\t\tvar blocks = this.selection.blocks();\n\n\t\t\t\t\t// nl to spaces\n\t\t\t\t\ttext = text.replace(/\\n/g, ' ');\n\n\t\t\t\t\t// select all\n\t\t\t\t\tif (this.utils.isSelectAll())\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $node = $(this.opts.emptyHtml);\n\t\t\t\t\t\tthis.core.editor().html('').append($node);\n\t\t\t\t\t\t$node.html(text);\n\t\t\t\t\t\tthis.caret.end($node);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t// insert\n\t\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\t\tvar node = document.createTextNode(text);\n\n\t\t\t\t\t\tif (sel.getRangeAt && sel.rangeCount)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar range = sel.getRangeAt(0);\n\t\t\t\t\t\t\trange.deleteContents();\n\t\t\t\t\t\t\trange.insertNode(node);\n\t\t\t\t\t\t\trange.setStartAfter(node);\n\t\t\t\t\t\t\trange.collapse(true);\n\n\t\t\t\t\t\t\tthis.selection.update(sel, range);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// wrap node if selected two or more block tags\n\t\t\t\t\t\tif (blocks.length > 1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$(node).wrap('<p>');\n\t\t\t\t\t\t\tthis.caret.after(node);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.utils.disableSelectAll();\n\t\t\t\t\tthis.linkify.format();\n\t\t\t\t\tthis.clean.normalizeCurrentHeading();\n\n\t\t\t\t},\n\t\t\t\traw: function(html)\n\t\t\t\t{\n\t\t\t\t\tthis.placeholder.hide();\n\t\t\t\t\tthis.core.editor().focus();\n\n\t\t\t\t\tvar sel = this.selection.get();\n\n\t\t\t\t\tvar range = this.selection.range(sel);\n\t\t\t\t\trange.deleteContents();\n\n\t\t            var el = document.createElement(\"div\");\n\t\t            el.innerHTML = html;\n\n\t\t            var frag = document.createDocumentFragment(), node, lastNode;\n\t\t            while ((node = el.firstChild))\n\t\t            {\n\t\t                lastNode = frag.appendChild(node);\n\t\t            }\n\n\t\t            range.insertNode(frag);\n\n\t\t\t\t\tif (lastNode)\n\t\t\t\t\t{\n\t\t\t\t\t\trange = range.cloneRange();\n\t\t\t\t\t\trange.setStartAfter(lastNode);\n\t\t\t\t\t\trange.collapse(true);\n\t\t\t\t\t\tsel.removeAllRanges();\n\t\t\t\t\t\tsel.addRange(range);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tnode: function(node, deleteContent)\n\t\t\t\t{\n\t\t\t\t\tthis.placeholder.hide();\n\n\t\t\t\t\tif (typeof this.start !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().focus();\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = node[0] || node;\n\n\t\t\t\t\tvar block = this.selection.block();\n\t\t\t\t\tvar gap = this.utils.isBlockTag(node.tagName);\n\t\t\t\t\tvar result = true;\n\n\t\t\t\t\tif (this.utils.isSelectAll())\n\t\t\t\t\t{\n\t\t\t\t\t\tif (gap)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.core.editor().html(node);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.core.editor().html($('<p>').html(node));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.code.sync();\n\t\t\t\t\t}\n\t\t\t\t\telse if (gap && block)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar breaked = this.utils.breakBlockTag();\n\t\t\t\t\t\tif (breaked === false)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.insert.placeNode(node, deleteContent);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (breaked.type === 'start')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbreaked.$block.before(node);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tbreaked.$block.after(node);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.core.editor().find('p:empty').remove();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tresult = this.insert.placeNode(node, deleteContent);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.utils.disableSelectAll();\n\n\t\t\t\t\tif (result)\n\t\t\t\t\t{\n\t\t\t\t\t    this.caret.end(node);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn node;\n\n\t\t\t\t},\n\t\t\t\tappendLists: function(block, $list)\n\t\t\t\t{\n\t\t\t\t\tvar $block = $(block);\n\t\t\t\t\tvar last;\n\t\t\t\t\tvar isEmpty = this.utils.isEmpty(block.innerHTML);\n\n\t\t\t\t\tif (isEmpty || this.utils.isEndOfElement(block))\n\t\t\t\t\t{\n\t\t\t\t\t\tlast = $block;\n\t\t\t\t\t\t$list.find('li').each(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlast.after(this);\n\t\t\t\t\t\t\tlast = $(this);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif (isEmpty)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$block.remove();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (this.utils.isStartOfElement(block))\n\t\t\t\t\t{\n\t\t\t\t\t\t$list.find('li').each(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$block.before(this);\n\t\t\t\t\t\t\tlast = $(this);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t        var endOfNode = this.selection.extractEndOfNode(block);\n\n\t\t\t\t        $block.after($('<li>').append(endOfNode));\n\t\t\t\t        $block.append($list);\n\t\t\t\t\t\tlast = $list;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.marker.remove();\n\n\t\t\t\t\tif (last)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.caret.end(last);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.linkify.format();\n\t\t\t\t},\n\t\t\t\tplaceHtml: function(html)\n\t\t\t\t{\n\t\t\t\t\tvar marker = document.createElement('span');\n\t\t\t\t\tmarker.id = 'redactor-insert-marker';\n\t\t\t\t\tmarker = this.insert.node(marker);\n\n\t\t\t\t\t$(marker).before(html);\n\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\tthis.caret.after(marker);\n\t\t\t\t\t$(marker).remove();\n\t\t\t\t},\n\t\t\t\tplaceNode: function(node, deleteContent)\n\t\t\t\t{\n\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\tvar range = this.selection.range(sel);\n\t\t\t\t\tif (range == null)\n\t\t\t\t\t{\n    \t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (deleteContent !== false)\n\t\t\t\t\t{\n\t\t\t\t\t\trange.deleteContents();\n\t\t\t\t\t}\n\n\t\t\t\t\trange.insertNode(node);\n\t\t\t\t\trange.collapse(false);\n\n\t\t\t\t\tthis.selection.update(sel, range);\n\t\t\t\t},\n\t\t\t\tnodeToPoint: function(e, node)\n\t\t\t\t{\n\t\t\t\t\tthis.placeholder.hide();\n\n\t\t\t\t\tnode = node[0] || node;\n\n\t\t\t\t\tif (this.utils.isEmpty())\n\t\t\t\t\t{\n\t\t\t\t\t\tnode = (this.utils.isBlock(node)) ? node : $('<p />').append(node);\n\n\t\t\t\t\t\tthis.core.editor().html(node);\n\n\t\t\t\t\t\treturn node;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar range;\n\t\t\t\t\tvar x = e.clientX, y = e.clientY;\n\t\t\t\t\tif (document.caretPositionFromPoint)\n\t\t\t\t\t{\n\t\t\t\t\t    var pos = document.caretPositionFromPoint(x, y);\n\t\t\t\t\t    var sel = document.getSelection();\n\t\t\t\t\t    range = sel.getRangeAt(0);\n\t\t\t\t\t    range.setStart(pos.offsetNode, pos.offset);\n\t\t\t\t\t    range.collapse(true);\n\t\t\t\t\t    range.insertNode(node);\n\t\t\t\t\t}\n\t\t\t\t\telse if (document.caretRangeFromPoint)\n\t\t\t\t\t{\n\t\t\t\t\t    range = document.caretRangeFromPoint(x, y);\n\t\t\t\t\t    range.insertNode(node);\n\t\t\t\t\t}\n\t\t\t\t\telse if (typeof document.body.createTextRange !== \"undefined\")\n\t\t\t\t\t{\n\t\t\t\t        range = document.body.createTextRange();\n\t\t\t\t        range.moveToPoint(x, y);\n\t\t\t\t        var endRange = range.duplicate();\n\t\t\t\t        endRange.moveToPoint(x, y);\n\t\t\t\t        range.setEndPoint(\"EndToEnd\", endRange);\n\t\t\t\t        range.select();\n\t\t\t\t\t}\n\n\t\t\t\t\treturn node;\n\n\t\t\t\t},\n\n\t\t\t\t// #backward\n\t\t\t\tnodeToCaretPositionFromPoint: function(e, node)\n\t\t\t\t{\n\t\t\t\t\tthis.insert.nodeToPoint(e, node);\n\t\t\t\t},\n\t\t\t\tmarker: function()\n\t\t\t\t{\n\t\t\t\t\tthis.marker.insert();\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =keydown\n\t\tkeydown: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tinit: function(e)\n\t\t\t\t{\n\t\t\t\t\tif (this.rtePaste)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar key = e.which;\n\t\t\t\t\tvar arrow = (key >= 37 && key <= 40);\n\n\t\t\t\t\tthis.keydown.ctrl = e.ctrlKey || e.metaKey;\n\t\t\t\t\tthis.keydown.parent = this.selection.parent();\n\t\t\t\t\tthis.keydown.current = this.selection.current();\n\t\t\t\t\tthis.keydown.block = this.selection.block();\n\n\t\t\t        // detect tags\n\t\t\t\t\tthis.keydown.pre = this.utils.isTag(this.keydown.current, 'pre');\n\t\t\t\t\tthis.keydown.blockquote = this.utils.isTag(this.keydown.current, 'blockquote');\n\t\t\t\t\tthis.keydown.figcaption = this.utils.isTag(this.keydown.current, 'figcaption');\n\t\t\t\t\tthis.keydown.figure = this.utils.isTag(this.keydown.current, 'figure');\n\n\t\t\t\t\t// callback\n\t\t\t\t\tvar keydownStop = this.core.callback('keydown', e);\n\t\t\t\t\tif (keydownStop === false)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// shortcuts setup\n\t\t\t\t\tthis.shortcuts.init(e, key);\n\n\t\t\t\t\t// buffer\n\t\t\t\t\tthis.keydown.checkEvents(arrow, key);\n                    this.keydown.setupBuffer(e, key);\n\n\t\t\t\t\tif (this.utils.isSelectAll() && ( key === this.keyCode.ENTER || key === this.keyCode.BACKSPACE || key === this.keyCode.DELETE))\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\tthis.code.set(this.opts.emptyHtml);\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.keydown.addArrowsEvent(arrow);\n\t\t\t\t\tthis.keydown.setupSelectAll(e, key);\n\n\t\t\t\t\t// turn off enter key\n\t\t\t\t\tif (!this.opts.enterKey && key === this.keyCode.ENTER)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\t// remove selected\n\t\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\t\tvar range = this.selection.range(sel);\n\n\t\t\t\t\t\tif (!range.collapsed)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\trange.deleteContents();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// down\n\t\t\t\t\tif (this.opts.enterKey && key === this.keyCode.DOWN)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.keydown.onArrowDown();\n\t\t\t\t\t}\n\n\t\t\t\t\t// up\n\t\t\t\t\tif (this.opts.enterKey && key === this.keyCode.UP)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.keydown.onArrowUp();\n\t\t\t\t\t}\n\n\n\t\t\t\t\t// replace to p before / after the table or into body\n\t\t\t\t\tif ((this.opts.type === 'textarea' || this.opts.type === 'div') && this.keydown.current && this.keydown.current.nodeType === 3 && $(this.keydown.parent).hasClass('redactor-in'))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.keydown.wrapToParagraph();\n\t\t\t\t\t}\n\n\t\t\t\t\t// on Shift+Space or Ctrl+Space\n\t\t\t\t\tif (!this.keyup.lastShiftKey && key === this.keyCode.SPACE && (e.ctrlKey || e.shiftKey))\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\treturn this.keydown.onShiftSpace();\n\t\t\t\t\t}\n\n\t\t\t\t\t// on Shift+Enter or Ctrl+Enter\n\t\t\t\t\tif (key === this.keyCode.ENTER && (e.ctrlKey || e.shiftKey))\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\treturn this.keydown.onShiftEnter(e);\n\t\t\t\t\t}\n\n\t\t\t\t\t// on enter\n\t\t\t\t\tif (key === this.keyCode.ENTER && !e.shiftKey && !e.ctrlKey && !e.metaKey)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.keydown.onEnter(e);\n\t\t\t\t\t}\n\n\t\t\t\t\t// tab or cmd + [\n\t\t\t\t\tif (key === this.keyCode.TAB || e.metaKey && key === 221 || e.metaKey && key === 219)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.keydown.onTab(e, key);\n\t\t\t\t\t}\n\n                    // firefox bugfix\n\t\t\t\t\tif (this.detect.isFirefox() && key === this.keyCode.BACKSPACE && this.keydown.block && this.keydown.block.tagName === 'P' && this.utils.isStartOfElement(this.keydown.block))\n\t\t\t\t\t{\n    \t\t\t\t\tvar $prev = $(this.keydown.block).prev();\n    \t\t\t\t\tif ($prev.length !== 0)\n    \t\t\t\t\t{\n        \t\t\t\t\te.preventDefault();\n\n        \t\t\t\t\t$prev.append(this.marker.get());\n        \t\t\t\t\t$prev.append($(this.keydown.block).html());\n        \t\t\t\t\t$(this.keydown.block).remove();\n\n                            this.selection.restore();\n\n        \t\t\t\t\treturn;\n    \t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// backspace & delete\n\t\t\t\t\tif (key === this.keyCode.BACKSPACE || key === this.keyCode.DELETE)\n\t\t\t\t\t{\n    \t\t\t\t\tif (this.observe.image && typeof this.observe.image !== 'undefined' && $('#redactor-image-box').length !== 0)\n    \t\t\t\t\t{\n        \t\t\t\t\te.preventDefault();\n\n        \t\t\t\t\tvar $prev = this.observe.image.closest('figure, p').prev()\n        \t\t\t\t\tthis.image.remove(false);\n                            this.observe.image = false;\n\n        \t\t\t\t\tif ($prev && $prev.length !== 0)\n        \t\t\t\t\t{\n            \t\t\t\t\tthis.caret.end($prev);\n        \t\t\t\t\t}\n        \t\t\t\t\telse\n        \t\t\t\t\t{\n            \t\t\t\t\tthis.core.editor().focus();\n        \t\t\t\t\t}\n\n        \t\t\t\t\treturn;\n    \t\t\t\t\t}\n\n\t\t\t\t\t\tthis.keydown.onBackspaceAndDeleteBefore();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (key === this.keyCode.DELETE)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $next = $(this.keydown.block).next();\n\n\t\t\t\t\t\t// delete figure\n\t\t\t\t\t\tif (this.utils.isEndOfElement(this.keydown.block) && $next.length !== 0 && $next[0].tagName === 'FIGURE')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$next.remove();\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// append list (safari bug)\n\t\t\t\t\t\tvar tagLi = (this.keydown.block && this.keydown.block.tagName === 'LI') ? this.keydown.block : false;\n\t\t\t\t\t\tif (tagLi)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar $list = $(this.keydown.block).parents('ul, ol').last();\n\t\t\t\t\t\t\tvar $nextList = $list.next();\n\n\t\t\t\t\t\t\tif (this.utils.isRedactorParent($list) && this.utils.isEndOfElement($list) && $nextList.length !== 0\n\t\t\t\t\t\t\t\t&& ($nextList[0].tagName === 'UL' || $nextList[0].tagName === 'OL'))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\t\t\t$list.append($nextList.contents());\n\t\t\t\t\t\t\t\t$nextList.remove();\n\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// append pre\n\t\t\t\t\t\tif (this.utils.isEndOfElement(this.keydown.block) && $next.length !== 0 && $next[0].tagName === 'PRE')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$(this.keydown.block).append($next.text());\n\t\t\t\t\t\t\t$next.remove();\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// image delete\n\t\t\t\t\tif (key === this.keyCode.DELETE && $('#redactor-image-box').length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.image.remove();\n\t\t\t\t\t}\n\n\t\t\t\t\t// backspace\n\t\t\t\t\tif (key === this.keyCode.BACKSPACE)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.detect.isFirefox())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.line.removeOnBackspace(e);\n\t\t\t\t\t\t}\n\n                        // combine list after and before if paragraph is empty\n                        if (this.list.combineAfterAndBefore(this.keydown.block))\n                        {\n                            e.preventDefault();\n                            return;\n                        }\n\n\t\t\t\t\t\t// backspace as outdent\n\t\t\t\t\t\tvar block = this.selection.block();\n\t\t\t\t\t\tif (block && block.tagName === 'LI' && this.utils.isCollapsed() && this.utils.isStartOfElement())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.indent.decrease();\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.keydown.removeInvisibleSpace();\n\t\t\t\t\t\tthis.keydown.removeEmptyListInTable(e);\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif (key === this.keyCode.BACKSPACE || key === this.keyCode.DELETE)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.keydown.onBackspaceAndDeleteAfter(e);\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tonShiftSpace: function()\n\t\t\t\t{\n\t\t\t\t\tthis.buffer.set();\n\t\t\t\t\tthis.insert.raw('&nbsp;');\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\tonShiftEnter: function(e)\n\t\t\t\t{\n\t\t\t\t\tthis.buffer.set();\n\n\t\t\t\t\treturn (this.keydown.pre) ? this.keydown.insertNewLine(e) : this.insert.raw('<br>');\n\t\t\t\t},\n\t\t\t\tonBackspaceAndDeleteBefore: function()\n\t\t\t\t{\n\t\t\t\t\tthis.utils.saveScroll();\n\t\t\t\t},\n\t\t\t\tonBackspaceAndDeleteAfter: function(e)\n\t\t\t\t{\n\t\t\t\t\t// remove style tag\n\t\t\t\t\tsetTimeout($.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.code.syncFire = false;\n\t\t\t\t\t\tthis.keydown.removeEmptyLists();\n\n                        var filter = '';\n                        if (this.opts.keepStyleAttr.length !== 0)\n                        {\n                            filter = ',' + this.opts.keepStyleAttr.join(',');\n                        }\n\n\t\t\t\t\t\tvar $styleTags = this.core.editor().find('*[style]');\n\t\t\t\t\t\t$styleTags.not('img, figure, iframe, #redactor-image-box, #redactor-image-editter, [data-redactor-style-cache], [data-redactor-span]' + filter).removeAttr('style');\n\n\t\t\t\t\t\tthis.keydown.formatEmpty(e);\n\t\t\t\t\t\tthis.code.syncFire = true;\n\n\t\t\t\t\t}, this), 1);\n\t\t\t\t},\n\t\t\t\tonEnter: function(e)\n\t\t\t\t{\n\t\t\t\t\tvar stop = this.core.callback('enter', e);\n\t\t\t\t\tif (stop === false)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// blockquote exit\n\t\t\t\t\tif (this.keydown.blockquote && this.keydown.exitFromBlockquote(e) === true)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// pre\n\t\t\t\t\tif (this.keydown.pre)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.keydown.insertNewLine(e);\n\t\t\t\t\t}\n\t\t\t\t\t// blockquote & figcaption\n\t\t\t\t\telse if (this.keydown.blockquote || this.keydown.figcaption)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.keydown.insertBreakLine(e);\n\t\t\t\t\t}\n\t\t\t\t\t// figure\n\t\t\t\t\telse if (this.keydown.figure)\n\t\t\t\t\t{\n\t\t\t\t\t\tsetTimeout($.proxy(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.keydown.replaceToParagraph('FIGURE');\n\n\t\t\t\t\t\t}, this), 1);\n\t\t\t\t\t}\n\t\t\t\t\t// paragraphs\n\t\t\t\t\telse if (this.keydown.block)\n\t\t\t\t\t{\n\t\t\t\t\t\tsetTimeout($.proxy(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.keydown.replaceToParagraph('DIV');\n\n\t\t\t\t\t\t}, this), 1);\n\n\t\t\t\t\t\t// empty list exit\n\t\t\t\t\t\tif (this.keydown.block.tagName === 'LI')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar current = this.selection.current();\n\t\t\t\t\t\t\tvar $parent = $(current).closest('li', this.$editor[0]);\n\t\t\t\t\t\t\tvar $list = $parent.parents('ul,ol', this.$editor[0]).last();\n\n\t\t\t\t\t\t\tif ($parent.length !== 0 && this.utils.isEmpty($parent.html()) && $list.next().length === 0 && this.utils.isEmpty($list.find(\"li\").last().html()))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$list.find(\"li\").last().remove();\n\n\t\t\t\t\t\t\t\tvar node = $(this.opts.emptyHtml);\n\t\t\t\t\t\t\t\t$list.after(node);\n\t\t\t\t\t\t\t\tthis.caret.start(node);\n\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t\t// outside\n\t\t\t\t\telse if (!this.keydown.block)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.keydown.insertParagraph(e);\n\t\t\t\t\t}\n\n                    // firefox enter into inline element\n\t\t\t\t\tif (this.detect.isFirefox() && this.utils.isInline(this.keydown.parent))\n\t\t\t\t\t{\n                        this.keydown.insertBreakLine(e);\n                        return;\n                    }\n\n\n\t\t\t\t\t// remove inline tags in new-empty paragraph\n\t\t\t\t\tsetTimeout($.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tvar inline = this.selection.inline();\n\t\t\t\t\t\tif (inline && this.utils.isEmpty(inline.innerHTML))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar parent = this.selection.block();\n\t\t\t\t\t\t\t$(inline).remove();\n\t\t\t\t\t\t\t//this.caret.start(parent);\n\n                            var range = document.createRange();\n                            range.setStart(parent, 0);\n\n                            var textNode = document.createTextNode('\\u200B');\n\n                            range.insertNode(textNode);\n                            range.setStartAfter(textNode);\n                            range.collapse(true);\n\n                            var sel = window.getSelection();\n            \t\t\t\tsel.removeAllRanges();\n            \t\t\t\tsel.addRange(range);\n\t\t\t\t\t\t}\n\n\n\t\t\t\t\t}, this), 1);\n\t\t\t\t},\n\t\t\t\tcheckEvents: function(arrow, key)\n\t\t\t\t{\n\t\t\t\t\tif (!arrow && (this.core.getEvent() === 'click' || this.core.getEvent() === 'arrow'))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.addEvent(false);\n\n\t\t\t\t\t\tif (this.keydown.checkKeyEvents(key))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.buffer.set();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tcheckKeyEvents: function(key)\n\t\t\t\t{\n\t\t\t\t\tvar k = this.keyCode;\n\t\t\t\t\tvar keys = [k.BACKSPACE, k.DELETE, k.ENTER, k.ESC, k.TAB, k.CTRL, k.META, k.ALT, k.SHIFT];\n\n\t\t\t\t\treturn ($.inArray(key, keys) === -1) ? true : false;\n\n\t\t\t\t},\n\t\t\t\taddArrowsEvent: function(arrow)\n\t\t\t\t{\n\t\t\t\t\tif (!arrow)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ((this.core.getEvent() === 'click' || this.core.getEvent() === 'arrow'))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.addEvent(false);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t    this.core.addEvent('arrow');\n\t\t\t\t},\n\t\t\t\tsetupBuffer: function(e, key)\n\t\t\t\t{\n\t\t\t\t\tif (this.keydown.ctrl && key === 90 && !e.shiftKey && !e.altKey && this.opts.buffer.length) // z key\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tthis.buffer.undo();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t// redo\n\t\t\t\t\telse if (this.keydown.ctrl && key === 90 && e.shiftKey && !e.altKey && this.opts.rebuffer.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tthis.buffer.redo();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\telse if (!this.keydown.ctrl)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (key === this.keyCode.SPACE || key === this.keyCode.BACKSPACE || key === this.keyCode.DELETE || (key === this.keyCode.ENTER && !e.ctrlKey && !e.shiftKey))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.buffer.set();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\texitFromBlockquote: function(e)\n\t\t\t\t{\n\t\t\t\t\tif (!this.utils.isEndOfElement(this.keydown.blockquote))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar tmp = this.clean.removeSpacesHard($(this.keydown.blockquote).html());\n\t\t\t\t\tif (tmp.search(/(<br\\s?\\/?>){1}$/i) !== -1)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\tvar $last = $(this.keydown.blockquote).children().last();\n\n\t\t\t\t\t\t$last.filter('br').remove();\n\t\t\t\t\t\t$(this.keydown.blockquote).children().last().filter('span').remove();\n\n\t\t\t\t\t\tvar node = $(this.opts.emptyHtml);\n\t\t\t\t\t\t$(this.keydown.blockquote).after(node);\n\t\t\t\t\t\tthis.caret.start(node);\n\n\t\t\t\t\t\treturn true;\n\n\t\t\t\t\t}\n\n\t\t\t\t\treturn;\n\t\t\t\t},\n\t\t\t\tonArrowDown: function()\n\t\t\t\t{\n\t\t\t\t\tvar tags = [this.keydown.blockquote, this.keydown.pre, this.keydown.figcaption];\n\n\t\t\t\t\tfor (var i = 0; i < tags.length; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (tags[i])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.keydown.insertAfterLastElement(tags[i]);\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonArrowUp: function()\n\t\t\t\t{\n\t\t\t\t\tvar tags = [this.keydown.blockquote, this.keydown.pre, this.keydown.figcaption];\n\n\t\t\t\t\tfor (var i = 0; i < tags.length; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (tags[i])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.keydown.insertBeforeFirstElement(tags[i]);\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tinsertAfterLastElement: function(element)\n\t\t\t\t{\n\t\t\t\t\tif (!this.utils.isEndOfElement(element))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar last = this.core.editor().contents().last();\n\t\t\t\t\tvar $next = (element.tagName === 'FIGCAPTION') ? $(this.keydown.block).parent().next() : $(this.keydown.block).next();\n\n\t\t\t\t\tif ($next.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\telse if (last.length === 0 && last[0] !== element)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.caret.start(last);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tvar node = $(this.opts.emptyHtml);\n\n\t\t\t\t\t\tif (element.tagName === 'FIGCAPTION')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t    $(element).parent().after(node);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n    \t\t\t\t\t\t$(element).after(node);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.caret.start(node);\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tinsertBeforeFirstElement: function(element)\n\t\t\t\t{\n\t\t\t\t\tif (!this.utils.isStartOfElement())\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.core.editor().contents().length > 1 && this.core.editor().contents().first()[0] !== element)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar node = $(this.opts.emptyHtml);\n\t\t\t\t\t$(element).before(node);\n\t\t\t\t\tthis.caret.start(node);\n\n\t\t\t\t},\n\t\t\t\tonTab: function(e, key)\n\t\t\t\t{\n\t\t\t\t\tif (!this.opts.tabKey)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar isList = (this.keydown.block && this.keydown.block.tagName === 'LI')\n\t\t\t\t\tif (this.utils.isEmpty(this.code.get()) || (!isList && !this.keydown.pre && this.opts.tabAsSpaces === false))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tthis.buffer.set();\n\n                    var isListStart = (isList && this.utils.isStartOfElement(this.keydown.block));\n\t\t\t\t\tvar node;\n\n\t\t\t\t\tif (this.keydown.pre && !e.shiftKey)\n\t\t\t\t\t{\n\t\t\t\t\t\tnode = (this.opts.preSpaces) ? document.createTextNode(Array(this.opts.preSpaces + 1).join('\\u00a0')) : document.createTextNode('\\t');\n\t\t\t\t\t\tthis.insert.node(node);\n\t\t\t\t\t}\n\t\t\t\t\telse if (this.opts.tabAsSpaces !== false && !isListStart)\n\t\t\t\t\t{\n\t\t\t\t\t\tnode = document.createTextNode(Array(this.opts.tabAsSpaces + 1).join('\\u00a0'));\n\t\t\t\t\t\tthis.insert.node(node);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tif (e.metaKey && key === 219)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.indent.decrease();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (e.metaKey && key === 221)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.indent.increase();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (!e.shiftKey)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.indent.increase();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.indent.decrease();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\tsetupSelectAll: function(e, key)\n\t\t\t\t{\n\t\t\t\t\tif (this.keydown.ctrl && key === 65)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.utils.enableSelectAll();\n\t\t\t\t\t}\n\t\t\t\t\telse if (key !== this.keyCode.LEFT_WIN && !this.keydown.ctrl)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.utils.disableSelectAll();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tinsertNewLine: function(e)\n\t\t\t\t{\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\tvar node = document.createTextNode('\\n');\n\n\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\tvar range = this.selection.range(sel);\n\n\t\t\t\t\trange.deleteContents();\n\t\t\t\t\trange.insertNode(node);\n\n\t\t\t\t\tthis.caret.after(node);\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\tinsertParagraph: function(e)\n\t\t\t\t{\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\tvar p = document.createElement('p');\n\t\t\t\t\t//p.innerHTML = this.opts.invisibleSpace;\n\t\t\t\t\tp.innerHTML = '<br>';\n\n\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\tvar range = this.selection.range(sel);\n\n\t\t\t\t\trange.deleteContents();\n\t\t\t\t\trange.insertNode(p);\n\n\t\t\t\t\tthis.caret.start(p);\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\tinsertBreakLine: function(e)\n\t\t\t\t{\n\t\t\t\t\treturn this.keydown.insertBreakLineProcessing(e);\n\t\t\t\t},\n\t\t\t\tinsertDblBreakLine: function(e)\n\t\t\t\t{\n\t\t\t\t\treturn this.keydown.insertBreakLineProcessing(e, true);\n\t\t\t\t},\n\t\t\t\tinsertBreakLineProcessing: function(e, dbl)\n\t\t\t\t{\n\t\t\t\t\te.stopPropagation();\n\n\t\t\t\t\tvar br1 = document.createElement('br');\n\t\t\t\t\tthis.insert.node(br1);\n\n\t\t\t\t\tif (dbl === true)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar br2 = document.createElement('br');\n\t\t\t\t\t\tthis.insert.node(br2);\n\t\t\t\t\t\tthis.caret.after(br2);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n    \t\t\t\t\tthis.caret.after(br1);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\n\t\t\t\t},\n\t\t\t\twrapToParagraph: function()\n\t\t\t\t{\n\t\t\t\t\tvar $current = $(this.keydown.current);\n\t\t\t\t\tvar\tnode = $('<p>').append($current.clone());\n\t\t\t\t\t$current.replaceWith(node);\n\n\t\t\t\t\tvar next = $(node).next();\n\t\t\t\t\tif (typeof(next[0]) !== 'undefined' && next[0].tagName === 'BR')\n\t\t\t\t\t{\n\t\t\t\t\t\tnext.remove();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.caret.end(node);\n\n\t\t\t\t},\n\t\t\t\treplaceToParagraph: function(tag)\n\t\t\t\t{\n\t\t\t\t\tvar blockElem = this.selection.block();\n\t\t\t\t\tvar $prev = $(blockElem).prev();\n\n\t\t\t\t\tvar blockHtml = blockElem.innerHTML.replace(/<br\\s?\\/?>/gi, '');\n\t\t\t\t\tif (blockElem.tagName === tag && this.utils.isEmpty(blockHtml) && !$(blockElem).hasClass('redactor-in'))\n\t\t\t\t\t{\n\t\t\t\t\t\tvar p = document.createElement('p');\n\t\t\t\t\t\t$(blockElem).replaceWith(p);\n\n                        this.keydown.setCaretToParagraph(p);\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\telse if (blockElem.tagName === 'P')\n\t\t\t\t\t{\n\t\t\t\t\t\t$(blockElem).removeAttr('class').removeAttr('style');\n\n\t\t\t\t\t\t// fix #227\n\t\t\t\t\t\tif (this.detect.isIe() && this.utils.isEmpty(blockHtml) && this.utils.isInline(this.keydown.parent))\n                        {\n                            $(blockElem).on('input', $.proxy(function()\n                            {\n                                var parent = this.selection.parent();\n                                if (this.utils.isInline(parent))\n                                {\n                                    var html = $(parent).html();\n                                    $(blockElem).html(html);\n                                    this.caret.end(blockElem);\n                                }\n\n                                $(blockElem).off('keyup');\n\n                            }, this));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\telse if ($prev.hasClass(this.opts.videoContainerClass))\n\t\t\t\t\t{\n    \t\t\t\t\t$prev.removeAttr('class');\n\n    \t\t\t\t\tvar p = document.createElement('p');\n\t\t\t\t\t\t$prev.replaceWith(p);\n\n\t\t\t\t\t\tthis.keydown.setCaretToParagraph(p);\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsetCaretToParagraph: function(p)\n\t\t\t\t{\n                    var range = document.createRange();\n                    range.setStart(p, 0);\n\n                    var textNode = document.createTextNode('\\u200B');\n\n                    range.insertNode(textNode);\n                    range.setStartAfter(textNode);\n                    range.collapse(true);\n\n                    var sel = window.getSelection();\n    \t\t\t\tsel.removeAllRanges();\n    \t\t\t\tsel.addRange(range);\n\t\t\t\t},\n\t\t\t\tremoveInvisibleSpace: function()\n\t\t\t\t{\n\t\t\t\t\tvar $current = $(this.keydown.current);\n\t\t\t\t\tif ($current.text().search(/^\\u200B$/g) === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t$current.remove();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tremoveEmptyListInTable: function(e)\n\t\t\t\t{\n\t\t\t\t\tvar $current = $(this.keydown.current);\n\t\t\t\t\tvar $parent = $(this.keydown.parent);\n\t\t\t\t\tvar td = $current.closest('td', this.$editor[0]);\n\n\t\t\t\t\tif (td.length !== 0 && $current.closest('li', this.$editor[0]) && $parent.children('li').length === 1)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!this.utils.isEmpty($current.text()))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\t$current.remove();\n\t\t\t\t\t\t$parent.remove();\n\n\t\t\t\t\t\tthis.caret.start(td);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tremoveEmptyLists: function()\n\t\t\t\t{\n\t\t\t\t\tvar removeIt = function()\n\t\t\t\t\t{\n\t\t\t\t\t\tvar html = $.trim(this.innerHTML).replace(/\\/t\\/n/g, '');\n\t\t\t\t\t\tif (html === '')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.core.editor().find('li').each(removeIt);\n\t\t\t\t\tthis.core.editor().find('ul, ol').each(removeIt);\n\t\t\t\t},\n\t\t\t\tformatEmpty: function(e)\n\t\t\t\t{\n\t\t\t\t\tvar html = $.trim(this.core.editor().html());\n\n\t\t\t\t\tif (!this.utils.isEmpty(html))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\tif (this.opts.type === 'inline' || this.opts.type === 'pre')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().html(this.marker.html());\n\t\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().html(this.opts.emptyHtml);\n\t\t\t\t\t\tthis.focus.start();\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =keyup\n\t\tkeyup: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tinit: function(e)\n\t\t\t\t{\n\t\t\t\t\tif (this.rtePaste)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar key = e.which;\n\t\t\t\t\tthis.keyup.block = this.selection.block();\n\t\t\t\t\tthis.keyup.current = this.selection.current();\n\t\t\t\t\tthis.keyup.parent = this.selection.parent();\n\t\t\t\t\tthis.keyup.lastShiftKey = e.shiftKey;\n\n\n\t\t\t\t\t// callback\n\t\t\t\t\tvar stop = this.core.callback('keyup', e);\n\t\t\t\t\tif (stop === false)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n                    // replace a prev figure to paragraph if caret is before image\n                    if (key === this.keyCode.ENTER)\n                    {\n                        if (this.keyup.block && this.keyup.block.tagName === 'FIGURE')\n                        {\n                            var $prev = $(this.keyup.block).prev();\n                            if ($prev.length !== 0 && $prev[0].tagName === 'FIGURE')\n                            {\n                                var $newTag = this.utils.replaceToTag($prev, 'p');\n                                this.caret.start($newTag);\n                                return;\n                            }\n                        }\n                    }\n\n\t\t\t\t\t// replace figure to paragraph\n\t\t\t\t\tif (key === this.keyCode.BACKSPACE || key === this.keyCode.DELETE)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.utils.isSelectAll())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.focus.start();\n                            this.toolbar.setUnfixed();\n\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// if caret before figure - delete image\n\t\t\t\t\t\tif (this.keyup.block && this.keydown.block && this.keyup.block.tagName === 'FIGURE' && this.utils.isStartOfElement(this.keydown.block))\n\t\t\t\t\t\t{\n    \t\t\t\t\t\te.preventDefault();\n\n                            this.selection.save();\n                            $(this.keyup.block).find('figcaption').remove();\n    \t\t\t\t\t\t$(this.keyup.block).find('img').first().remove();\n    \t\t\t\t\t\tthis.utils.replaceToTag(this.keyup.block, 'p');\n\n    \t\t\t\t\t\tvar $marker = this.marker.find();\n    \t\t\t\t\t\t$('html, body').animate({ scrollTop: $marker.position().top + 20 }, 500);\n\n    \t\t\t\t\t\tthis.selection.restore();\n    \t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\n\t\t\t\t\t\t// if paragraph does contain only image replace to figure\n\t\t\t\t\t\tif (this.keyup.block && this.keyup.block.tagName === 'P')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar isContainImage = $(this.keyup.block).find('img').length;\n\t\t\t\t\t\t\tvar text = $(this.keyup.block).text().replace(/\\u200B/g, '');\n\t\t\t\t\t\t\tif (text === '' && isContainImage !== 0)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.utils.replaceToTag(this.keyup.block, 'figure');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// if figure does not contain image - replace to paragraph\n\t\t\t\t\t\tif (this.keyup.block && this.keyup.block.tagName === 'FIGURE' && $(this.keyup.block).find('img').length === 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.selection.save();\n\t\t\t\t\t\t\tthis.utils.replaceToTag(this.keyup.block, 'p');\n\t\t\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// linkify\n\t\t\t\t\tif (this.linkify.isKey(key))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.linkify.format();\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t};\n\t\t},\n\n\t\t// =lang\n\t\tlang: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tload: function()\n\t\t\t\t{\n\t\t\t\t\tthis.opts.curLang = this.opts.langs[this.opts.lang];\n\t\t\t\t},\n\t\t\t\tget: function(name)\n\t\t\t\t{\n\t\t\t\t\treturn (typeof this.opts.curLang[name] !== 'undefined') ? this.opts.curLang[name] : '';\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =line\n\t\tline: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tinsert: function()\n\t\t\t\t{\n\t\t\t\t\tthis.buffer.set();\n\n\t\t\t\t\t// insert\n\t\t\t\t\tthis.insert.html(this.line.getLineHtml());\n\n\t\t\t\t\t// find\n\t\t\t\t\tvar $hr = this.core.editor().find('#redactor-hr-tmp-id');\n\t\t\t\t\t$hr.removeAttr('id');\n\n\t\t\t\t\tthis.core.callback('insertedLine', $hr);\n\n\t\t\t\t\treturn $hr;\n\t\t\t\t},\n\t\t\t\tgetLineHtml: function()\n\t\t\t\t{\n\t\t\t\t\tvar html = '<hr id=\"redactor-hr-tmp-id\" />';\n\t\t\t\t\tif (!this.detect.isFirefox() && this.utils.isEmpty())\n\t\t\t\t\t{\n\t\t\t\t\t\thtml += '<p>' + this.opts.emptyHtml + '</p>';\n\t\t\t\t\t}\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\t// ff only\n\t\t\t\tremoveOnBackspace: function(e)\n\t\t\t\t{\n\t\t\t\t\tif (!this.utils.isCollapsed())\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $block = $(this.selection.block());\n\t\t\t\t\tif ($block.length === 0 || !this.utils.isStartOfElement($block))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// if hr is previous element\n\t\t\t\t\tvar $prev = $block.prev();\n\t\t\t\t\tif ($prev && $prev.length !== 0 && $prev[0].tagName === 'HR')\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t$prev.remove();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =link\n\t\tlink: function()\n\t\t{\n\t\t\treturn {\n\n\t\t\t\t// public\n\t\t\t\tget: function()\n\t\t\t\t{\n\t\t\t\t\treturn $(this.selection.inlines('a'));\n\t\t\t\t},\n\t\t\t\tis: function()\n\t\t\t\t{\n\t\t\t\t\tvar nodes = this.selection.nodes() ;\n\t\t\t\t\tvar $link = $(this.selection.current()).closest('a', this.core.editor()[0]);\n\n\t\t\t\t\treturn ($link.length === 0 || nodes.length > 1) ? false : $link;\n\t\t\t\t},\n\t\t\t\tunlink: function(e)\n\t\t\t\t{\n\t\t\t\t\t// if call from clickable element\n\t\t\t\t\tif (typeof e !== 'undefined' && e.preventDefault)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t}\n\n\t\t\t\t\t// buffer\n\t\t\t\t\tthis.buffer.set();\n\n\t\t\t\t\tvar links = this.selection.inlines('a');\n\t\t\t\t\tif (links.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $links = this.link.replaceLinksToText(links);\n\n\t\t\t\t\tthis.observe.closeAllTooltip();\n\t\t\t\t\tthis.core.callback('deletedLink', $links);\n\n\t\t\t\t},\n\t\t\t\tinsert: function(link, cleaned)\n\t\t\t\t{\n\t\t\t\t\tvar $el = this.link.is();\n\n\t\t\t\t\tif (cleaned !== true)\n\t\t\t\t\t{\n\t\t\t\t\t\tlink = this.link.buildLinkFromObject($el, link);\n\t\t\t\t\t\tif (link === false)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// buffer\n\t\t\t\t\tthis.buffer.set();\n\n\t\t\t\t\t// callback\n\t\t\t\t\tlink = this.core.callback('beforeInsertingLink', link);\n\n\t\t\t\t\tif ($el === false)\n\t\t\t\t\t{\n\t\t\t\t\t\t// insert\n\t\t\t\t\t\t$el = $('<a />');\n\t\t\t\t\t\t$el = this.link.update($el, link);\n\t\t\t\t\t\t$el = $(this.insert.node($el));\n\n\t\t\t\t\t\tvar $parent = $el.parent();\n\t\t\t\t\t\tif (this.utils.isRedactorParent($parent) === false)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$el.wrap('<p>');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// remove unlink wrapper\n\t\t\t\t\t\tif ($parent.hasClass('redactor-unlink'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$parent.replaceWith(function(){\n\t\t\t\t\t\t\t\treturn $(this).contents();\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.caret.after($el);\n\t\t\t\t\t\tthis.core.callback('insertedLink', $el);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t// update\n\t\t\t\t\t\t$el = this.link.update($el, link);\n\t\t\t\t\t\tthis.caret.after($el);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn $el;\n\n\t\t\t\t},\n\t\t\t\tupdate: function($el, link)\n\t\t\t\t{\n\t\t\t\t\t$el.text(link.text);\n\t\t\t\t\t$el.attr('href', link.url);\n\n\t\t\t\t\tthis.link.target($el, link.target);\n\n\t\t\t\t\treturn $el;\n\n\t\t\t\t},\n\t\t\t\ttarget: function($el, target)\n\t\t\t\t{\n\t\t\t\t\treturn (target) ? $el.attr('target', '_blank') : $el.removeAttr('target');\n\t\t\t\t},\n\t\t\t\tshow: function(e)\n\t\t\t\t{\n\t\t\t\t\t// if call from clickable element\n\t\t\t\t\tif (typeof e !== 'undefined' && e.preventDefault)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t}\n\n\t\t\t\t\t// close tooltip\n\t\t\t\t\tthis.observe.closeAllTooltip();\n\n\t\t\t\t\t// is link\n\t\t\t\t\tvar $el = this.link.is();\n\n\t\t\t\t\t// build modal\n\t\t\t\t\tthis.link.buildModal($el);\n\n\t\t\t\t\t// build link\n\t\t\t\t\tvar link = this.link.buildLinkFromElement($el);\n\n\t\t\t\t\t// if link cut & paste inside editor browser added self host to a link\n\t\t\t\t\tlink.url = this.link.removeSelfHostFromUrl(link.url);\n\n                    // new tab target\n\t\t\t\t\tif (this.opts.linkNewTab && !$el)\n\t\t\t\t\t{\n    \t\t\t\t\tlink.target = true;\n\t\t\t\t\t}\n\n\t\t\t\t\t// set modal values\n\t\t\t\t\tthis.link.setModalValues(link);\n\n\t\t\t\t\t// show modal\n\t\t\t\t\tthis.modal.show();\n\n\t\t\t\t\t// focus\n\t\t\t\t\tif (this.detect.isDesktop())\n\t\t\t\t\t{\n\t\t\t\t\t\t$('#redactor-link-url').focus();\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\t// private\n\t\t\t\tsetModalValues: function(link)\n\t\t\t\t{\n\t\t\t\t\t$('#redactor-link-blank').prop('checked', link.target);\n\t\t\t\t\t$('#redactor-link-url').val(link.url);\n\t\t\t\t\t$('#redactor-link-url-text').val(link.text);\n\t\t\t\t},\n\t\t\t\tbuildModal: function($el)\n\t\t\t\t{\n\t\t\t\t\tthis.modal.load('link', this.lang.get(($el === false) ? 'link-insert' : 'link-edit'), 600);\n\n\t\t\t\t\t// button insert\n\t\t\t\t\tvar $btn = this.modal.getActionButton();\n\t\t\t\t\t$btn.text(this.lang.get(($el === false) ? 'insert' : 'save')).on('click', $.proxy(this.link.callback, this));\n\n\t\t\t\t},\n\t\t\t\tcallback: function()\n\t\t\t\t{\n\t\t\t\t\t// build link\n\t\t\t\t\tvar link = this.link.buildLinkFromModal();\n\t\t\t\t\tif (link === false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// close\n\t\t\t\t\tthis.modal.close();\n\n\t\t\t\t\t// insert or update\n\t\t\t\t\tthis.link.insert(link, true);\n\t\t\t\t},\n\t\t\t\tcleanUrl: function(url)\n\t\t\t\t{\n\t\t\t\t\treturn (typeof url === 'undefined') ? '' : $.trim(url.replace(/[^\\W\\w\\D\\d+&\\'@#/%?=~_|!:,.;\\(\\)]/gi, ''));\n\t\t\t\t},\n\t\t\t\tcleanText: function(text)\n\t\t\t\t{\n\t\t\t\t\treturn (typeof text === 'undefined') ? '' :$.trim(text.replace(/(<([^>]+)>)/gi, ''));\n\t\t\t\t},\n\t\t\t\tgetText: function(link)\n\t\t\t\t{\n\t\t\t\t\treturn (link.text === '' && link.url !== '') ? this.link.truncateUrl(link.url.replace(/<|>/g, '')) : link.text;\n\t\t\t\t},\n\t\t\t\tisUrl: function(url)\n\t\t\t\t{\n\t\t\t\t\tvar pattern = '((xn--)?[\\\\W\\\\w\\\\D\\\\d]+(-[\\\\W\\\\w\\\\D\\\\d]+)*\\\\.)+[\\\\W\\\\w]{2,}';\n\n\t\t\t\t\tvar re1 = new RegExp('^(http|ftp|https)://' + pattern, 'i');\n\t\t\t\t\tvar re2 = new RegExp('^' + pattern, 'i');\n\t\t\t\t\tvar re3 = new RegExp('\\.(html|php)$', 'i');\n\t\t\t\t\tvar re4 = new RegExp('^/', 'i');\n\t\t\t\t\tvar re5 = new RegExp('^tel:(.*?)', 'i');\n\n\t\t\t\t\t// add protocol\n\t\t\t\t\tif (url.search(re1) === -1 && url.search(re2) !== -1 && url.search(re3) === -1 && url.substring(0, 1) !== '/')\n\t\t\t\t\t{\n\t\t\t\t\t\turl = 'http://' + url;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (url.search(re1) !== -1 || url.search(re3) !== -1 || url.search(re4) !== -1 || url.search(re5) !== -1)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn url;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\tisMailto: function(url)\n\t\t\t\t{\n\t\t\t\t\treturn (url.search('@') !== -1 && /(http|ftp|https):\\/\\//i.test(url) === false);\n\t\t\t\t},\n\t\t\t\tisEmpty: function(link)\n\t\t\t\t{\n\t\t\t\t\treturn (link.url === '' || (link.text === '' && link.url === ''));\n\t\t\t\t},\n\t\t\t\ttruncateUrl: function(url)\n\t\t\t\t{\n\t\t\t\t\treturn (url.length > this.opts.linkSize) ? url.substring(0, this.opts.linkSize) + '...' : url;\n\t\t\t\t},\n\t\t\t\tparse: function(link)\n\t\t\t\t{\n\t\t\t\t\t// mailto\n\t\t\t\t\tif (this.link.isMailto(link.url))\n\t\t\t\t\t{\n\t\t\t\t\t\tlink.url = 'mailto:' + link.url.replace('mailto:', '');\n\t\t\t\t\t}\n\t\t\t\t\t// url\n\t\t\t\t\telse if (link.url.search('#') !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tlink.url = this.link.isUrl(link.url);\n\t\t\t\t\t}\n\n\t\t\t\t\t// empty url or text or isn't url\n\t\t\t\t\treturn (this.link.isEmpty(link) || link.url === false) ? false : link;\n\n\t\t\t\t},\n\t\t\t\tbuildLinkFromModal: function()\n\t\t\t\t{\n\t\t\t\t\tvar link = {};\n\n\t\t\t\t\t// url\n\t\t\t\t\tlink.url = this.link.cleanUrl($('#redactor-link-url').val());\n\n\t\t\t\t\t// text\n\t\t\t\t\tlink.text = this.link.cleanText($('#redactor-link-url-text').val());\n\t\t\t\t\tlink.text = this.link.getText(link);\n\n\t\t\t\t\t// target\n\t\t\t\t\tlink.target = ($('#redactor-link-blank').prop('checked')) ? true : false;\n\n\t\t\t\t\t// parse\n\t\t\t\t\treturn this.link.parse(link);\n\n\t\t\t\t},\n\t\t\t\tbuildLinkFromObject: function($el, link)\n\t\t\t\t{\n\t\t\t\t\t// url\n\t\t\t\t\tlink.url = this.link.cleanUrl(link.url);\n\n\t\t\t\t\t// text\n\t\t\t\t\tlink.text = (typeof link.text === 'undefined' && this.selection.is()) ? this.selection.text() : this.link.cleanText(link.text);\n\t\t\t\t\tlink.text = this.link.getText(link);\n\n\t\t\t\t\t// target\n\t\t\t\t\tlink.target = ($el === false) ? link.target : this.link.buildTarget($el);\n\n\t\t\t\t\t// parse\n\t\t\t\t\treturn this.link.parse(link);\n\n\t\t\t\t},\n\t\t\t\tbuildLinkFromElement: function($el)\n\t\t\t\t{\n\t\t\t\t\tvar link = {\n\t\t\t\t\t\turl: '',\n\t\t\t\t\t\ttext: (this.selection.is()) ? this.selection.text() : '',\n\t\t\t\t\t\ttarget: false\n\t\t\t\t\t};\n\n\t\t\t\t\tif ($el !== false)\n\t\t\t\t\t{\n\t\t\t\t\t\tlink.url = $el.attr('href');\n\t\t\t\t\t\tlink.text = $el.text();\n\t\t\t\t\t\tlink.target = this.link.buildTarget($el);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn link;\n\t\t\t\t},\n\t\t\t\tbuildTarget: function($el)\n\t\t\t\t{\n\t\t\t\t\treturn (typeof $el.attr('target') !== 'undefined' && $el.attr('target') === '_blank') ? true : false;\n\t\t\t\t},\n\t\t\t\tremoveSelfHostFromUrl: function(url)\n\t\t\t\t{\n\t\t\t\t\tvar href = self.location.href.replace('#', '').replace(/\\/$/i, '');\n\t\t\t\t\treturn url.replace(/^\\/\\#/, '#').replace(href, '').replace('mailto:', '');\n\t\t\t\t},\n\t\t\t\treplaceLinksToText: function(links)\n\t\t\t\t{\n\t\t\t\t\tvar $first;\n\t\t\t\t\tvar $links = $.each(links, function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $el = $(s);\n\t\t\t\t\t\tvar $unlinked = $('<span class=\"redactor-unlink\" />').append($el.contents());\n\t\t\t\t\t\t$el.replaceWith($unlinked);\n\n\t\t\t\t\t\tif (i === 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$first = $unlinked;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn $el;\n\t\t\t\t\t});\n\n\t\t\t\t\t// set caret after unlinked node\n\t\t\t\t\tif (links.length === 1 && this.selection.isCollapsed())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.caret.after($first);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn $links;\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =linkify\n\t\tlinkify: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tisKey: function(key)\n\t\t\t\t{\n\t\t\t\t\treturn key === this.keyCode.ENTER || key === this.keyCode.SPACE;\n\t\t\t\t},\n\t\t\t\tisLink: function(node)\n\t\t\t\t{\n\t\t\t\t\treturn (node.nodeValue.match(this.opts.regexps.linkyoutube) || node.nodeValue.match(this.opts.regexps.linkvimeo) || node.nodeValue.match(this.opts.regexps.linkimage) || node.nodeValue.match(this.opts.regexps.url));\n\t\t\t\t},\n\t\t\t\tisFiltered: function(i, node)\n\t\t\t\t{\n\t\t\t\t\treturn node.nodeType === 3 && $.trim(node.nodeValue) !== \"\" && !$(node).parent().is(\"pre\") && (this.linkify.isLink(node));\n\t\t\t\t},\n\t\t\t\thandler: function(i, node)\n\t\t\t\t{\n\t\t\t\t\tvar $el = $(node);\n\t\t\t\t\tvar text = $el.text();\n\t\t\t\t\tvar html = text;\n\n\t\t\t\t\tif (html.match(this.opts.regexps.linkyoutube) || html.match(this.opts.regexps.linkvimeo))\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = this.linkify.convertVideoLinks(html);\n\t\t\t\t\t}\n\t\t\t\t\telse if (html.match(this.opts.regexps.linkimage))\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = this.linkify.convertImages(html);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = this.linkify.convertLinks(html);\n\t\t\t\t\t}\n\n\t\t\t\t\t$el.before(text.replace(text, html)).remove();\n\t\t\t\t},\n\t\t\t\tformat: function()\n\t\t\t\t{\n\t\t\t\t\tif (!this.opts.linkify || this.utils.isCurrentOrParent('pre'))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.core.editor().find(\":not(iframe,img,a,pre,code,.redactor-unlink)\").addBack().contents().filter($.proxy(this.linkify.isFiltered, this)).each($.proxy(this.linkify.handler, this));\n\n\t\t\t\t\t// collect\n\t\t\t\t\tvar $objects = this.core.editor().find('.redactor-linkify-object').each($.proxy(function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $el = $(s);\n\t\t\t\t\t\t$el.removeClass('redactor-linkify-object');\n\t\t\t\t\t\tif ($el.attr('class') === '')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$el.removeAttr('class');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (s.tagName === 'DIV') // video container\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.linkify.breakBlockTag($el, 'video');\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (s.tagName === 'IMG') // image\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.linkify.breakBlockTag($el, 'image');\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (s.tagName === 'A')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.core.callback('insertedLink', $el);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn $el;\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\t// callback\n\t\t\t\t\tsetTimeout($.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.code.sync();\n\t\t\t\t\t\tthis.core.callback('linkify', $objects);\n\n\t\t\t\t\t}, this), 100);\n\n\t\t\t\t},\n\t\t\t\tbreakBlockTag: function($el, type)\n\t\t\t\t{\n\t\t\t\t\tvar breaked = this.utils.breakBlockTag();\n\t\t\t\t\tif (breaked === false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $newBlock = $el;\n\t\t\t\t\tif (type === 'image')\n\t\t\t\t\t{\n\t\t\t\t\t\t$newBlock = $('<figure />').append($el);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (breaked.type === 'start')\n\t\t\t\t\t{\n\t\t\t\t\t\tbreaked.$block.before($newBlock);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tbreaked.$block.after($newBlock);\n\t\t\t\t\t}\n\n\n\t\t\t\t\tif (type === 'image')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.caret.after($newBlock);\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tconvertVideoLinks: function(html)\n\t\t\t\t{\n\t\t\t\t\tvar iframeStart = '<div class=\"' + this.opts.videoContainerClass + ' redactor-linkify-object\"><iframe class=\"redactor-linkify-object\" width=\"500\" height=\"281\" src=\"';\n\t\t\t\t\tvar iframeEnd = '\" frameborder=\"0\" allowfullscreen></iframe></div>';\n\n\t\t\t\t\tif (html.match(this.opts.regexps.linkyoutube))\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(this.opts.regexps.linkyoutube, iframeStart + '//www.youtube.com/embed/$1' + iframeEnd);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (html.match(this.opts.regexps.linkvimeo))\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(this.opts.regexps.linkvimeo, iframeStart + '//player.vimeo.com/video/$2' + iframeEnd);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tconvertImages: function(html)\n\t\t\t\t{\n\t\t\t\t\tvar matches = html.match(this.opts.regexps.linkimage);\n\t\t\t\t\tif (!matches)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn html;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn html.replace(html, '<img src=\"' + matches + '\" class=\"redactor-linkify-object\" />');\n\t\t\t\t},\n\t\t\t\tconvertLinks: function(html)\n\t\t\t\t{\n\t\t\t\t\tvar matches = html.match(this.opts.regexps.url);\n\t\t\t\t\tif (!matches)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn html;\n\t\t\t\t\t}\n\n\t\t\t\t\tmatches = $.grep(matches, function(v, k) { return $.inArray(v, matches) === k; });\n\n\t\t\t\t\tvar length = matches.length;\n\n\t\t\t\t\tfor (var i = 0; i < length; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar href = matches[i], text = href;\n\t\t\t\t\t\tvar linkProtocol = (href.match(/(https?|ftp):\\/\\//i) !== null) ? '' : 'http://';\n\n\t\t\t\t\t\tif (text.length > this.opts.linkSize)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext = text.substring(0, this.opts.linkSize) + '...';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (text.search('%') === -1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttext = decodeURIComponent(text);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar regexB = \"\\\\b\";\n\n\t\t\t\t\t\tif ($.inArray(href.slice(-1), [\"/\", \"&\", \"=\"]) !== -1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tregexB = \"\";\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// escaping url\n\t\t\t\t\t\tvar regexp = new RegExp('(' + href.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, \"\\\\$&\") + regexB + ')', 'g');\n\n\t\t\t\t\t\t// target\n\t\t\t\t\t\tvar target = '';\n\t\t\t\t\t\tif (this.opts.pasteLinkTarget !== false)\n                        {\n    \t\t\t\t\t    target = ' target=\"' + this.opts.pasteLinkTarget + '\"';\n                        }\n\n\t\t\t\t\t\thtml = html.replace(regexp, '<a href=\"' + linkProtocol + $.trim(href) + '\"' + target + ' class=\"redactor-linkify-object\">' + $.trim(text) + '</a>');\n\t\t\t\t\t}\n\n\t\t\t\t\treturn html;\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =list\n\t\tlist: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\ttoggle: function(cmd)\n\t\t\t\t{\n\t\t\t\t\tif (this.utils.inBlocks(['table', 'td', 'th', 'tr']))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar tag = (cmd === 'orderedlist' || cmd === 'ol') ? 'OL' : 'UL';\n\t\t\t\t\tcmd = (tag === 'OL') ? 'orderedlist' : 'unorderedlist'\n\n\t\t\t\t\tvar $list = $(this.selection.current()).parentsUntil('.redactor-in', 'ul, ol').first();\n\n\t\t\t\t\tthis.placeholder.hide();\n\t\t\t\t\tthis.buffer.set();\n\n\n\t\t\t\t\tif ($list.length !== 0 && $list[0].tagName === tag && this.utils.isRedactorParent($list))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.selection.save();\n\n\t\t\t\t\t\t// remove list\n\t\t\t\t\t\t$list.find('ul, ol').each(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar parent = $(this).closest('li');\n\t\t\t\t\t\t\t$(this).find('li').each(function()\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$(parent).after(this);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t$list.find('ul, ol').remove();\n\t\t\t\t\t\t$list.find('li').each(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn $(this).replaceWith(function()\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn $('<p />').append($(this).contents());\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\n\n\t\t\t\t\t\t$list.replaceWith(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn $(this).contents();\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\n\t\t\t\t\tthis.selection.save();\n\n\t\t\t\t\tif ($list.length !== 0 && $list[0].tagName !== tag)\n\t\t\t\t\t{\n                        $list.each($.proxy(function(i,s)\n                        {\n                            this.utils.replaceToTag(s, tag);\n\n                        }, this));\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t    document.execCommand('insert' + cmd);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.selection.restore();\n\n\t\t\t\t\tvar $insertedList = this.list.get();\n\t\t\t\t\tif (!$insertedList)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!this.selection.block())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdocument.execCommand('formatblock', false, 'p');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// clear span\n\t\t\t\t\t$insertedList.find('span').replaceWith(function()\n\t\t\t\t\t{\n\t\t\t\t\t\treturn $(this).contents();\n\t\t\t\t\t});\n\n\t\t\t\t\t// remove style\n\t\t\t\t\t$insertedList.find(this.opts.inlineTags.join(',')).each(function()\n\t\t\t\t\t{\n\t\t\t\t\t\t$(this).removeAttr('style');\n\t\t\t\t\t});\n\n\t\t\t\t\t// remove block-element list wrapper\n\t\t\t\t\tvar $listParent = $insertedList.parent();\n\t\t\t\t\tif (this.utils.isRedactorParent($listParent) && $listParent[0].tagName !== 'LI' && this.utils.isBlock($listParent))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.selection.save();\n\n\t\t\t\t\t\t$listParent.replaceWith($listParent.contents());\n\n\t\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tget: function()\n\t\t\t\t{\n\t\t\t\t\tvar current = this.selection.current();\n\t\t\t\t\tvar $list = $(current).closest('ul, ol', this.core.editor()[0]);\n\n\t\t\t\t\treturn ($list.length === 0) ? false : $list;\n\t\t\t\t},\n\t\t\t\tcombineAfterAndBefore: function(block)\n\t\t\t\t{\n    \t\t\t\tvar $prev = $(block).prev();\n    \t\t\t\tvar $next = $(block).next();\n                    var isEmptyBlock = (block && block.tagName === 'P' && (block.innerHTML === '<br>' || block.innerHTML === ''));\n                    var isBlockWrapped = ($prev.closest('ol, ul', this.core.editor()[0]).length === 1 && $next.closest('ol, ul', this.core.editor()[0]).length === 1);\n\n                    if (isEmptyBlock && isBlockWrapped)\n                    {\n                        $prev.children('li').last().append(this.marker.get());\n                        $prev.append($next.contents());\n                        this.selection.restore();\n\n                        return true;\n                    }\n\n                    return false;\n\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =marker\n\t\tmarker: function()\n\t\t{\n\t\t\treturn {\n\n\t\t\t\t// public\n\t\t\t\tget: function(num)\n\t\t\t\t{\n\t\t\t\t\tnum = (typeof num === 'undefined') ? 1 : num;\n\n\t\t\t\t\tvar marker = document.createElement('span');\n\n\t\t\t\t\tmarker.id = 'selection-marker-' + num;\n\t\t\t\t\tmarker.className = 'redactor-selection-marker';\n\t\t\t\t\tmarker.innerHTML = this.opts.invisibleSpace;\n\n\t\t\t\t\treturn marker;\n\t\t\t\t},\n\t\t\t\thtml: function(num)\n\t\t\t\t{\n\t\t\t\t\treturn this.utils.getOuterHtml(this.marker.get(num));\n\t\t\t\t},\n\t\t\t\tfind: function(num)\n\t\t\t\t{\n\t\t\t\t\tnum = (typeof num === 'undefined') ? 1 : num;\n\n\t\t\t\t\treturn this.core.editor().find('span#selection-marker-' + num);\n\t\t\t\t},\n\t\t\t\tinsert: function()\n\t\t\t\t{\n\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\tvar range = this.selection.range(sel);\n\n\t\t\t\t\tthis.marker.insertNode(range, this.marker.get(1), true);\n\t\t\t\t\tif (range && range.collapsed === false)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.marker.insertNode(range, this.marker.get(2), false);\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tremove: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().find('.redactor-selection-marker').each(this.marker.iterateRemove);\n\t\t\t\t},\n\n\t\t\t\t// private\n\t\t\t\tinsertNode: function(range, node, collapse)\n\t\t\t\t{\n\t\t\t\t\tvar parent = this.selection.parent();\n\t\t\t\t\tif (range === null || $(parent).closest('.redactor-in').length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\trange = range.cloneRange();\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\trange.collapse(collapse);\n\t\t\t\t\t\trange.insertNode(node);\n\t\t\t\t\t}\n\t\t\t\t\tcatch (e)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.focus.start();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\titerateRemove: function(i, el)\n\t\t\t\t{\n\t\t\t\t\tvar $el = $(el);\n\t\t\t\t\tvar text = $el.text().replace(/\\u200B/g, '');\n\n\t\t\t\t\treturn (text === '') ? $el.remove() : $el.replaceWith(function() { return $(this).contents(); });\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =modal\n\t\tmodal: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tcallbacks: {},\n\t\t\t\ttemplates: function()\n\t\t\t\t{\n\t\t\t\t\tthis.opts.modal = {\n\t\t\t\t\t\t'image-edit': String()\n\t\t\t\t\t\t+ '<div class=\"redactor-modal-tab redactor-group\" data-title=\"General\">'\n\t\t\t\t\t\t\t+ '<div id=\"redactor-image-preview\" class=\"redactor-modal-tab-side\">'\n\t\t\t\t\t\t\t+ '</div>'\n\t\t\t\t\t\t\t+ '<div class=\"redactor-modal-tab-area\">'\n\t\t\t\t\t\t\t\t+ '<section>'\n\t\t\t\t\t\t\t\t\t+ '<label>' + this.lang.get('title') + '</label>'\n\t\t\t\t\t\t\t\t\t+ '<input type=\"text\" id=\"redactor-image-title\" />'\n\t\t\t\t\t\t\t\t+ '</section>'\n\t\t\t\t\t\t\t\t+ '<section>'\n\t\t\t\t\t\t\t\t\t+ '<label>' + this.lang.get('caption') + '</label>'\n\t\t\t\t\t\t\t\t\t+ '<input type=\"text\" id=\"redactor-image-caption\" aria-label=\"' + this.lang.get('caption') + '\" />'\n\t\t\t\t\t\t\t\t+ '</section>'\n\t\t\t\t\t\t\t\t+ '<section>'\n\t\t\t\t\t\t\t\t\t+ '<label>' + this.lang.get('link') + '</label>'\n\t\t\t\t\t\t\t\t\t+ '<input type=\"text\" id=\"redactor-image-link\" aria-label=\"' + this.lang.get('link') + '\" />'\n\t\t\t\t\t\t\t\t+ '</section>'\n\t\t\t\t\t\t\t\t+ '<section>'\n        \t\t\t\t\t\t\t+ '<label class=\"redactor-image-position-option\">' + this.lang.get('image-position') + '</label>'\n        \t\t\t\t\t\t\t+ '<select class=\"redactor-image-position-option\" id=\"redactor-image-align\" aria-label=\"' + this.lang.get('image-position') + '\">'\n        \t\t\t\t\t\t\t\t+ '<option value=\"none\">' + this.lang.get('none') + '</option>'\n        \t\t\t\t\t\t\t\t+ '<option value=\"left\">' + this.lang.get('left') + '</option>'\n        \t\t\t\t\t\t\t\t+ '<option value=\"center\">' + this.lang.get('center') + '</option>'\n        \t\t\t\t\t\t\t\t+ '<option value=\"right\">' + this.lang.get('right') + '</option>'\n        \t\t\t\t\t\t\t+ '</select>'\n\t\t\t\t\t\t\t\t+ '</section>'\n\t\t\t\t\t\t\t\t+ '<section>'\n\t\t\t\t\t\t\t\t\t+ '<label class=\"checkbox\"><input type=\"checkbox\" id=\"redactor-image-link-blank\" aria-label=\"' + this.lang.get('link-in-new-tab') + '\"> ' + this.lang.get('link-in-new-tab') + '</label>'\n\t\t\t\t\t\t\t\t+ '</section>'\n\t\t\t\t\t\t\t\t+ '<section>'\n\t\t\t\t\t\t\t\t\t+ '<button id=\"redactor-modal-button-action\">' + this.lang.get('insert') + '</button>'\n\t\t\t\t\t\t\t\t\t+ '<button id=\"redactor-modal-button-cancel\">' + this.lang.get('cancel') + '</button>'\n\t\t\t\t\t\t\t\t\t+ '<button id=\"redactor-modal-button-delete\" class=\"redactor-modal-button-offset\">' + this.lang.get('delete') + '</button>'\n\t\t\t\t\t\t\t\t+ '</section>'\n\t\t\t\t\t\t\t+ '</div>'\n\t\t\t\t\t\t+ '</div>',\n\n\t\t\t\t\t\t'image': String()\n\t\t\t\t\t\t+ '<div class=\"redactor-modal-tab\" data-title=\"Upload\">'\n\t\t\t\t\t\t\t+ '<section>'\n\t\t\t\t\t\t\t\t+ '<div id=\"redactor-modal-image-droparea\"></div>'\n\t \t\t\t\t\t\t+ '</section>'\n \t\t\t\t\t\t+ '</div>',\n\n\t\t\t\t\t\t'file': String()\n\t\t\t\t\t\t+ '<div class=\"redactor-modal-tab\" data-title=\"Upload\">'\n\t\t\t\t\t\t\t+ '<section>'\n\t\t\t\t\t\t\t\t+ '<label>' + this.lang.get('filename') + ' <span class=\"desc\">(' + this.lang.get('optional') + ')</span></label>'\n\t\t\t\t\t\t\t\t+ '<input type=\"text\" id=\"redactor-filename\" aria-label=\"' + this.lang.get('filename') + '\" /><br><br>'\n\t\t\t\t\t\t\t+ '</section>'\n\t\t\t\t\t\t\t+ '<section>'\n\t\t\t\t\t\t\t\t+ '<div id=\"redactor-modal-file-upload\"></div>'\n\t\t\t\t\t\t\t+ '</section>'\n\t\t\t\t\t\t+ '</div>',\n\n\t\t\t\t\t\t'link': String()\n\t\t\t\t\t\t+ '<div class=\"redactor-modal-tab\" data-title=\"General\">'\n\t\t\t\t\t\t\t+ '<section>'\n\t\t\t\t\t\t\t\t+ '<label>URL</label>'\n\t\t\t\t\t\t\t\t+ '<input type=\"url\" id=\"redactor-link-url\" aria-label=\"URL\" />'\n\t\t\t\t\t\t\t+ '</section>'\n\t\t\t\t\t\t\t+ '<section>'\n\t\t\t\t\t\t\t\t+ '<label>' + this.lang.get('text') + '</label>'\n\t\t\t\t\t\t\t\t+ '<input type=\"text\" id=\"redactor-link-url-text\" aria-label=\"' + this.lang.get('text') + '\" />'\n\t\t\t\t\t\t\t+ '</section>'\n\t\t\t\t\t\t\t+ '<section>'\n\t\t\t\t\t\t\t\t+ '<label class=\"checkbox\"><input type=\"checkbox\" id=\"redactor-link-blank\"> ' + this.lang.get('link-in-new-tab') + '</label>'\n\t\t\t\t\t\t\t+ '</section>'\n\t\t\t\t\t\t\t+ '<section>'\n\t\t\t\t\t\t\t\t+ '<button id=\"redactor-modal-button-action\">' + this.lang.get('insert') + '</button>'\n\t\t\t\t\t\t\t\t+ '<button id=\"redactor-modal-button-cancel\">' + this.lang.get('cancel') + '</button>'\n\t\t\t\t\t\t\t+ '</section>'\n\t\t\t\t\t\t+ '</div>'\n\t\t\t\t\t};\n\n\t\t\t\t\t$.extend(this.opts, this.opts.modal);\n\n\t\t\t\t},\n\t\t\t\taddCallback: function(name, callback)\n\t\t\t\t{\n\t\t\t\t\tthis.modal.callbacks[name] = callback;\n\t\t\t\t},\n\t\t\t\taddTemplate: function(name, template)\n\t\t\t\t{\n\t\t\t\t\tthis.opts.modal[name] = template;\n\t\t\t\t},\n\t\t\t\tgetTemplate: function(name)\n\t\t\t\t{\n\t\t\t\t\treturn this.opts.modal[name];\n\t\t\t\t},\n\t\t\t\tgetModal: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.$modalBody;\n\t\t\t\t},\n\t\t\t\tgetActionButton: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.$modalBody.find('#redactor-modal-button-action');\n\t\t\t\t},\n\t\t\t\tgetCancelButton: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.$modalBody.find('#redactor-modal-button-cancel');\n\t\t\t\t},\n\t\t\t\tgetDeleteButton: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.$modalBody.find('#redactor-modal-button-delete');\n\t\t\t\t},\n\t\t\t\tload: function(templateName, title, width)\n\t\t\t\t{\n\t\t\t\t\tif (typeof this.$modalBox !== 'undefined' && this.$modalBox.hasClass('open'))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.modal.templateName = templateName;\n\t\t\t\t\tthis.modal.width = width;\n\n\t\t\t\t\tthis.modal.build();\n\t\t\t\t\tthis.modal.enableEvents();\n\t\t\t\t\tthis.modal.setTitle(title);\n\t\t\t\t\tthis.modal.setDraggable();\n\t\t\t\t\tthis.modal.setContent();\n\n\t\t\t\t\t// callbacks\n\t\t\t\t\tif (typeof this.modal.callbacks[templateName] !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.modal.callbacks[templateName].call(this);\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tshow: function()\n\t\t\t\t{\n\n\t\t\t\t\tif (!this.detect.isDesktop())\n\t\t\t\t\t{\n\t\t\t\t\t\tdocument.activeElement.blur();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.selection.save();\n\t\t\t\t\tthis.modal.buildTabber();\n\n\t\t\t\t\tif (this.detect.isMobile())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.modal.width = '96%';\n\t\t\t\t\t}\n\n\t\t\t\t\t// resize\n\t\t\t\t\tsetTimeout($.proxy(this.modal.buildWidth, this), 0);\n\t\t\t\t\t$(window).on('resize.redactor-modal', $.proxy(this.modal.buildWidth, this));\n\n\n\t\t\t\t\tthis.$modalOverlay.redactorAnimation('fadeIn', {\n\t\t\t\t\t\tduration: 0.25\n\t\t\t\t\t});\n\n\t\t\t\t\t/* BEGIN HACK */\n\t\t\t\t\t// make sure that the modal is at the end of the DOM\n\t\t\t\t\tthis.$modalBox.appendTo(document.body);\n\t\t\t\t\t/* END HACK */\n\n\t\t\t\t\tthis.$modalBox.addClass('open').show();\n\t\t\t\t\tthis.$modal.redactorAnimation('fadeIn', {\n\t\t\t\t\t\t\ttiming: 'cubic-bezier(0.175, 0.885, 0.320, 1.105)'\n\t\t\t\t\t\t},\n\t\t\t\t\t\t$.proxy(function()\n\t\t\t\t\t\t{\n\n\t\t\t\t\t\t\tthis.utils.saveScroll();\n\t\t\t\t\t\t\tthis.utils.disableBodyScroll();\n\n\t\t\t\t\t\t\t// modal shown callback\n\t\t\t\t\t\t\tthis.core.callback('modalOpened', this.modal.templateName, this.$modal);\n\n\t\t\t\t\t\t\t// fix bootstrap modal focus\n\t\t\t\t\t\t\t$(document).off('focusin.modal');\n\n\t\t\t\t\t\t\t// enter\n\t\t\t\t\t\t\tvar $elements = this.$modal.find('input[type=text],input[type=url],input[type=email]');\n\t\t\t\t\t\t\t$elements.on('keydown.redactor-modal', $.proxy(this.modal.setEnter, this));\n\n\t\t\t\t\t\t}, this)\n\t\t\t\t\t);\n\n\t\t\t\t},\n\t\t\t\tbuildWidth: function()\n\t\t\t\t{\n\t\t\t\t\tvar windowHeight = $(window).height();\n\t\t\t\t\tvar windowWidth = $(window).width();\n\n\t\t\t\t\tvar number = (typeof this.modal.width === 'number');\n\n\t\t\t\t\tif (!number && this.modal.width.match(/%$/))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$modal.css({ 'width': this.modal.width, 'margin-bottom': '16px' });\n\t\t\t\t\t}\n\t\t\t\t\telse if (parseInt(this.modal.width) > windowWidth)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$modal.css({ 'width': '96%', 'margin-bottom': '2%' });\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tif (number)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.modal.width += 'px';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.$modal.css({ 'width': this.modal.width, 'margin-bottom': '16px' });\n\t\t\t\t\t}\n\n\t\t\t\t\t// margin top\n\t\t\t\t\tvar height = this.$modal.outerHeight();\n\t\t\t\t\tvar top = (windowHeight/2 - height/2) + 'px';\n\n\t\t\t\t\tif (this.detect.isMobile())\n\t\t\t\t\t{\n\t\t\t\t\t\ttop = '2%';\n\t\t\t\t\t}\n\t\t\t\t\telse if (height > windowHeight)\n\t\t\t\t\t{\n\t\t\t\t\t\ttop = '16px';\n\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.$modal.css('margin-top', top);\n\t\t\t\t},\n\t\t\t\tbuildTabber: function()\n\t\t\t\t{\n\t\t\t\t\tthis.modal.tabs = this.$modal.find('.redactor-modal-tab');\n\n\t\t\t\t\tif (this.modal.tabs.length < 2)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.modal.$tabsBox = $('<div id=\"redactor-modal-tabber\" />');\n\t\t\t\t\t$.each(this.modal.tabs, $.proxy(function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar a = $('<a href=\"#\" rel=\"' + i + '\" />').text($(s).attr('data-title'));\n\n\t\t\t\t\t\ta.on('click', $.proxy(this.modal.showTab, this));\n\n\t\t\t\t\t\tif (i === 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ta.addClass('active');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.modal.$tabsBox.append(a);\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\tthis.$modalBody.prepend(this.modal.$tabsBox);\n\n\t\t\t\t},\n\t\t\t\tshowTab: function(e)\n\t\t\t\t{\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\tvar $el = $(e.target);\n\t\t\t\t\tvar index = $el.attr('rel');\n\n\t\t\t\t\tthis.modal.tabs.hide();\n\t\t\t\t\tthis.modal.tabs.eq(index).show();\n\n\t\t\t\t\t$('#redactor-modal-tabber').find('a').removeClass('active');\n\t\t\t\t\t$el.addClass('active');\n\n\t\t\t\t\treturn false;\n\n\t\t\t\t},\n\t\t\t\tsetTitle: function(title)\n\t\t\t\t{\n\t\t\t\t\tthis.$modalHeader.html(title);\n\t\t\t\t},\n\t\t\t\tsetContent: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$modalBody.html(this.modal.getTemplate(this.modal.templateName));\n\n\t\t\t\t\tthis.modal.getCancelButton().on('mousedown', $.proxy(this.modal.close, this));\n\t\t\t\t},\n\t\t\t\tsetDraggable: function()\n\t\t\t\t{\n\t\t\t\t\tif (typeof $.fn.draggable === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.$modal.draggable({ handle: this.$modalHeader });\n\t\t\t\t\tthis.$modalHeader.css('cursor', 'move');\n\t\t\t\t},\n\t\t\t\tsetEnter: function(e)\n\t\t\t\t{\n\t\t\t\t\tif (e.which !== 13)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tthis.modal.getActionButton().click();\n\t\t\t\t},\n\t\t\t\tbuild: function()\n\t\t\t\t{\n\t\t\t\t\tthis.modal.buildOverlay();\n\n\t\t\t\t\tthis.$modalBox = $('<div id=\"redactor-modal-box\"/>').hide();\n\t\t\t\t\tthis.$modal = $('<div id=\"redactor-modal\" role=\"dialog\" />');\n\t\t\t\t\tthis.$modalHeader = $('<div id=\"redactor-modal-header\" />');\n\t\t\t\t\tthis.$modalClose = $('<button type=\"button\" id=\"redactor-modal-close\" aria-label=\"' + this.lang.get('close') + '\" />').html('&times;');\n\t\t\t\t\tthis.$modalBody = $('<div id=\"redactor-modal-body\" />');\n\n\t\t\t\t\tthis.$modal.append(this.$modalHeader);\n\t\t\t\t\tthis.$modal.append(this.$modalBody);\n\t\t\t\t\tthis.$modal.append(this.$modalClose);\n\t\t\t\t\tthis.$modalBox.append(this.$modal);\n\t\t\t\t\tthis.$modalBox.appendTo(document.body);\n\n\t\t\t\t},\n\t\t\t\tbuildOverlay: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$modalOverlay = $('<div id=\"redactor-modal-overlay\">').hide();\n\t\t\t\t\t$('body').prepend(this.$modalOverlay);\n\t\t\t\t},\n\t\t\t\tenableEvents: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$modalClose.on('mousedown.redactor-modal', $.proxy(this.modal.close, this));\n\t\t\t\t\t$(document).on('keyup.redactor-modal', $.proxy(this.modal.closeHandler, this));\n\t\t\t\t\tthis.core.editor().on('keyup.redactor-modal', $.proxy(this.modal.closeHandler, this));\n\t\t\t\t\tthis.$modalBox.on('click.redactor-modal', $.proxy(this.modal.close, this));\n\t\t\t\t},\n\t\t\t\tdisableEvents: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$modalClose.off('mousedown.redactor-modal');\n\t\t\t\t\t$(document).off('keyup.redactor-modal');\n\t\t\t\t\tthis.core.editor().off('keyup.redactor-modal');\n\t\t\t\t\tthis.$modalBox.off('click§.redactor-modal');\n\t\t\t\t\t$(window).off('resize.redactor-modal');\n\t\t\t\t},\n\t\t\t\tcloseHandler: function(e)\n\t\t\t\t{\n\t\t\t\t\tif (e.which !== this.keyCode.ESC)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.modal.close(false);\n\t\t\t\t},\n\t\t\t\tclose: function(e)\n\t\t\t\t{\n\t\t\t\t\tif (e)\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($(e.target).attr('id') !== 'redactor-modal-button-cancel' && e.target !== this.$modalClose[0] && e.target !== this.$modalBox[0])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!this.$modalBox)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// restore selection\n\t\t\t\t\tthis.selection.restore();\n\n\t\t\t\t\tthis.modal.disableEvents();\n\t\t\t\t\tthis.utils.enableBodyScroll();\n\t\t\t\t\tthis.utils.restoreScroll();\n\n\t\t\t\t\tthis.$modalOverlay.redactorAnimation('fadeOut', { duration: 0.4 }, $.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$modalOverlay.remove();\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\tthis.$modal.redactorAnimation('fadeOut', {\n\n\t\t\t\t\t\tduration: 0.3,\n\t\t\t\t\t\ttiming: 'cubic-bezier(0.175, 0.885, 0.320, 1.175)'\n\n\t\t\t\t\t}, $.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tif (typeof this.$modalBox !== 'undefined')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.$modalBox.remove();\n\t\t\t\t\t\t\tthis.$modalBox = undefined;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$(document.body).css('overflow', this.modal.bodyOveflow);\n\t\t\t\t\t\tthis.core.callback('modalClosed', this.modal.templateName);\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =observe\n\t\tobserve: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tload: function()\n\t\t\t\t{\n\t\t\t\t\tif (typeof this.opts.destroyed !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.observe.links();\n\t\t\t\t\tthis.observe.images();\n\n\t\t\t\t},\n\t\t\t\tisCurrent: function($el, $current)\n\t\t\t\t{\n\t\t\t\t\tif (typeof $current === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\t$current = $(this.selection.current());\n\t\t\t\t\t}\n\n\t\t\t\t\treturn $current.is($el) || $current.parents($el).length > 0;\n\t\t\t\t},\n\t\t\t\ttoolbar: function()\n\t\t\t\t{\n    \t\t\t\tthis.observe.buttons();\n\t    \t\t\tthis.observe.dropdowns();\n\t\t\t\t},\n\t\t\t\tbuttons: function(e, btnName)\n\t\t\t\t{\n\t\t\t\t\tvar current = this.selection.current();\n\t\t\t\t\tvar parent = this.selection.parent();\n\n\t\t\t\t\tif (e !== false) this.button.setInactiveAll();\n\t\t\t\t\telse             this.button.setInactiveAll(btnName);\n\n\n\t\t\t\t\tif (e === false && btnName !== 'html')\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($.inArray(btnName, this.opts.activeButtons) !== -1) this.button.toggleActive(btnName);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!this.utils.isRedactorParent(current))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// disable line\n\t\t\t\t\tif (this.core.editor().css('display') !== 'none')\n\t\t\t\t\t{\n\t    \t\t\t\tif (this.utils.isCurrentOrParentHeader() || this.utils.isCurrentOrParent(['table', 'pre', 'blockquote', 'li'])) this.button.disable('horizontalrule');\n    \t\t\t\t\telse this.button.enable('horizontalrule');\n\t\t\t\t\t}\n\n\t\t\t\t\t$.each(this.opts.activeButtonsStates, $.proxy(function(key, value)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar parentEl = $(parent).closest(key, this.$editor[0]);\n\t\t\t\t\t\tvar currentEl = $(current).closest(key, this.$editor[0]);\n\n\t\t\t\t\t\tif (parentEl.length !== 0 && !this.utils.isRedactorParent(parentEl))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!this.utils.isRedactorParent(currentEl))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (parentEl.length !== 0 || currentEl.closest(key, this.$editor[0]).length !== 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.button.setActive(value);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t},\n\t\t\t\tdropdowns: function()\n\t\t\t\t{\n    \t\t\t\tvar finded = $('<div />').html(this.selection.html()).find('a').length;\n\t\t\t\t\tvar $current = $(this.selection.current());\n\t\t\t\t\tvar isRedactor = this.utils.isRedactorParent($current);\n\n\t\t\t\t\t$.each(this.opts.observe.dropdowns, $.proxy(function(key, value)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar observe = value.observe,\n\t\t\t\t\t\t\telement = observe.element,\n\t\t\t\t\t\t\t$item   = value.item,\n\t\t\t\t\t\t\tinValues = typeof observe['in'] !== 'undefined' ? observe['in'] : false,\n\t\t\t\t\t\t\toutValues = typeof observe.out !== 'undefined' ? observe.out : false;\n\n\t\t\t\t\t\tif (($current.closest(element).length > 0 && isRedactor) || (element === 'a' && finded !== 0))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.observe.setDropdownProperties($item, inValues, outValues);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.observe.setDropdownProperties($item, outValues, inValues);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\tsetDropdownProperties: function($item, addProperties, deleteProperties)\n\t\t\t\t{\n\t\t\t\t\tif (deleteProperties && typeof deleteProperties.attr !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.observe.setDropdownAttr($item, deleteProperties.attr, true);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (typeof addProperties.attr !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.observe.setDropdownAttr($item, addProperties.attr);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (typeof addProperties.title !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\t$item.find('span').text(addProperties.title);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsetDropdownAttr: function($item, properties, isDelete)\n\t\t\t\t{\n\t\t\t\t\t$.each(properties, function(key, value)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (key === 'class')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (!isDelete)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$item.addClass(value);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$item.removeClass(value);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (!isDelete)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$item.attr(key, value);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$item.removeAttr(key);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\taddDropdown: function($item, btnName, btnObject)\n\t\t\t\t{\n\t\t\t\t\tif (typeof btnObject.observe === \"undefined\")\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tbtnObject.item = $item;\n\n\t\t\t\t\tthis.opts.observe.dropdowns.push(btnObject);\n\t\t\t\t},\n\t\t\t\timages: function()\n\t\t\t\t{\n                    if (this.opts.imageEditable)\n                    {\n                        this.core.editor().addClass('redactor-layer-img-edit');\n    \t\t\t\t\tthis.core.editor().find('img').each($.proxy(function(i, img)\n    \t\t\t\t\t{\n    \t\t\t\t\t\tvar $img = $(img);\n\n    \t\t\t\t\t\t// IE fix (when we clicked on an image and then press backspace IE does goes to image's url)\n    \t\t\t\t\t\t$img.closest('a', this.$editor[0]).on('click', function(e) { e.preventDefault(); });\n\n    \t\t\t\t\t\tthis.image.setEditable($img);\n\n\n    \t\t\t\t\t}, this));\n                    }\n\t\t\t\t},\n\t\t\t\tlinks: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.linkTooltip)\n\t\t\t\t\t{\n    \t\t\t\t\tthis.core.editor().find('a').each($.proxy(function(i, s)\n    \t\t\t\t\t{\n        \t\t\t\t\tvar $link = $(s);\n        \t\t\t\t\tif ($link.data('cached') !== true)\n        \t\t\t\t\t{\n            \t\t\t\t\t$link.data('cached', true);\n            \t\t\t\t\t$link.on('touchstart.redactor.' + this.uuid + ' click.redactor.' + this.uuid, $.proxy(this.observe.showTooltip, this));\n        \t\t\t\t\t}\n\n    \t\t\t\t\t}, this));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tgetTooltipPosition: function($link)\n\t\t\t\t{\n\t\t\t\t\treturn $link.offset();\n\t\t\t\t},\n\t\t\t\tshowTooltip: function(e)\n\t\t\t\t{\n\t\t\t\t\tvar $el = $(e.target);\n\n\t\t\t\t\tif ($el[0].tagName === 'IMG')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($el[0].tagName !== 'A')\n\t\t\t\t\t{\n\t\t\t\t\t\t$el = $el.closest('a', this.$editor[0]);\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($el[0].tagName !== 'A')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $link = $el;\n\n\t\t\t\t\tvar pos = this.observe.getTooltipPosition($link);\n\t\t\t\t\tvar tooltip = $('<span class=\"redactor-link-tooltip\"></span>');\n\n\t\t\t\t\tvar href = $link.attr('href');\n\t\t\t\t\tif (href === undefined)\n\t\t\t\t\t{\n\t\t\t\t\t\thref = '';\n\t\t\t\t\t}\n\n\t\t\t\t\tif (href.length > 24)\n\t\t\t\t\t{\n\t\t\t\t\t\thref = href.substring(0, 24) + '...';\n\t\t\t\t\t}\n\n\t\t\t\t\tvar aLink = $('<a href=\"' + $link.attr('href') + '\" target=\"_blank\" />').html(href).addClass('redactor-link-tooltip-action');\n\t\t\t\t\tvar aEdit = $('<a href=\"#\" />').html(this.lang.get('edit')).on('click', $.proxy(this.link.show, this)).addClass('redactor-link-tooltip-action');\n\t\t\t\t\tvar aUnlink = $('<a href=\"#\" />').html(this.lang.get('unlink')).on('click', $.proxy(this.link.unlink, this)).addClass('redactor-link-tooltip-action');\n\n\t\t\t\t\ttooltip.append(aLink).append(' | ').append(aEdit).append(' | ').append(aUnlink);\n\n\t\t\t\t\tvar lineHeight = parseInt($link.css('line-height'), 10);\n                    var lineClicked = Math.ceil((e.pageY - pos.top)/lineHeight);\n                    var top = pos.top + lineClicked * lineHeight;\n\n\t\t\t\t\ttooltip.css({\n\t\t\t\t\t\ttop: top + 'px',\n\t\t\t\t\t\tleft: pos.left + 'px'\n\t\t\t\t\t});\n\n\t\t\t\t\t$('.redactor-link-tooltip').remove();\n\t\t\t\t\t$('body').append(tooltip);\n\n\t\t\t\t\tthis.core.editor().on('touchstart.redactor.' + this.uuid + ' click.redactor.' + this.uuid, $.proxy(this.observe.closeTooltip, this));\n\t\t\t\t\t$(document).on('touchstart.redactor.' + this.uuid + ' click.redactor.' + this.uuid, $.proxy(this.observe.closeTooltip, this));\n\t\t\t\t},\n\t\t\t\tcloseAllTooltip: function()\n\t\t\t\t{\n\t\t\t\t\t$('.redactor-link-tooltip').remove();\n\t\t\t\t},\n\t\t\t\tcloseTooltip: function(e)\n\t\t\t\t{\n\t\t\t\t\te = e.originalEvent || e;\n\n\t\t\t\t\tvar target = e.target;\n\t\t\t\t\tvar $parent = $(target).closest('a', this.$editor[0]);\n\t\t\t\t\tif ($parent.length !== 0 && $parent[0].tagName === 'A' && target.tagName !== 'A')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\telse if ((target.tagName === 'A' && this.utils.isRedactorParent(target)) || $(target).hasClass('redactor-link-tooltip-action'))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.observe.closeAllTooltip();\n\n\t\t\t\t\tthis.core.editor().off('touchstart.redactor.' + this.uuid + ' click.redactor.' + this.uuid, $.proxy(this.observe.closeTooltip, this));\n\t\t\t\t\t$(document).off('touchstart.redactor.' + this.uuid + ' click.redactor.' + this.uuid, $.proxy(this.observe.closeTooltip, this));\n\t\t\t\t}\n\n\t\t\t};\n\t\t},\n\n\t\t// =offset\n\t\toffset: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tget: function(node)\n\t\t\t\t{\n\t\t\t\t\tvar cloned = this.offset.clone(node);\n\t\t\t\t\tif (cloned === false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn 0;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar div = document.createElement('div');\n\t\t\t\t\tdiv.appendChild(cloned.cloneContents());\n\t\t\t\t\tdiv.innerHTML = div.innerHTML.replace(/<img(.*?[^>])>$/gi, 'i');\n\n\t\t\t        var text = $.trim($(div).text()).replace(/[\\t\\n\\r\\n]/g, '').replace(/\\u200B/g, '');\n\n\t\t\t\t\treturn text.length;\n\n\t\t\t\t},\n\t\t\t\tclone: function(node)\n\t\t\t\t{\n\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\tvar range = this.selection.range(sel);\n\n\t\t\t\t\tif (range === null && typeof node === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = (typeof node === 'undefined') ? this.$editor : node;\n\t\t\t\t\tif (node === false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tnode = node[0] || node;\n\n\t\t\t\t\tvar cloned = range.cloneRange();\n\t\t\t\t\tcloned.selectNodeContents(node);\n\t\t\t\t\tcloned.setEnd(range.endContainer, range.endOffset);\n\n\t\t\t\t\treturn cloned;\n\t\t\t\t},\n\t\t\t\tset: function(start, end)\n\t\t\t\t{\n\t\t\t\t\tend = (typeof end === 'undefined') ? start : end;\n\n\t\t\t\t\tif (!this.focus.is())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.focus.start();\n\t\t\t\t\t}\n\n\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\tvar range = this.selection.range(sel);\n\t\t\t\t\tvar node, offset = 0;\n\t\t\t\t\tvar walker = document.createTreeWalker(this.$editor[0], NodeFilter.SHOW_TEXT, null, null);\n\n\t\t\t\t\twhile ((node = walker.nextNode()) !== null)\n\t\t\t\t\t{\n\t\t\t\t\t\toffset += node.nodeValue.length;\n\t\t\t\t\t\tif (offset > start)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\trange.setStart(node, node.nodeValue.length + start - offset);\n\t\t\t\t\t\t\tstart = Infinity;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (offset >= end)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\trange.setEnd(node, node.nodeValue.length + end - offset);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\trange.collapse(false);\n\t\t\t\t\tthis.selection.update(sel, range);\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =paragraphize\n\t\tparagraphize: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tload: function(html)\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.paragraphize === false || this.opts.type === 'inline' || this.opts.type === 'pre')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn html;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (html === '' || html === '<p></p>')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.opts.emptyHtml;\n\t\t\t\t\t}\n\n\t\t\t\t\thtml = html + \"\\n\";\n\n\t\t\t\t\tthis.paragraphize.safes = [];\n\t\t\t\t\tthis.paragraphize.z = 0;\n\n\t\t\t\t\t// before\n\t\t\t\t\thtml = html.replace(/(<br\\s?\\/?>){1,}\\n?<\\/blockquote>/gi, '</blockquote>');\n\t\t\t\t\thtml = html.replace(/<\\/pre>/gi, \"</pre>\\n\\n\");\n\t\t\t\t\thtml = html.replace(/<p>\\s<br><\\/p>/gi, '<p></p>');\n\n\t\t\t\t\thtml = this.paragraphize.getSafes(html);\n\n\t\t\t\t\thtml = html.replace('<br>', \"\\n\");\n\t\t\t\t\thtml = this.paragraphize.convert(html);\n\n\t\t\t\t\thtml = this.paragraphize.clear(html);\n\t\t\t\t\thtml = this.paragraphize.restoreSafes(html);\n\n\t\t\t\t\t// after\n\t\t\t\t\thtml = html.replace(new RegExp('<br\\\\s?/?>\\n?<(' + this.opts.paragraphizeBlocks.join('|') + ')(.*?[^>])>', 'gi'), '<p><br /></p>\\n<$1$2>');\n\n\t\t\t\t\treturn $.trim(html);\n\t\t\t\t},\n\t\t\t\tgetSafes: function(html)\n\t\t\t\t{\n\t\t\t\t\tvar $div = $('<div />').append(html);\n\n\t\t\t\t\t// remove paragraphs in blockquotes\n\t\t\t\t\t$div.find('blockquote p').replaceWith(function()\n\t\t\t\t\t{\n\t\t\t\t\t\treturn $(this).append('<br />').contents();\n\t\t\t\t\t});\n\n                    $div.find(this.opts.paragraphizeBlocks.join(', ')).each($.proxy(function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.paragraphize.z++;\n\t\t\t\t\t\tthis.paragraphize.safes[this.paragraphize.z] = s.outerHTML;\n\n\t\t\t\t\t\treturn $(s).replaceWith(\"\\n#####replace\" + this.paragraphize.z + \"#####\\n\\n\");\n\n\n\t\t\t\t\t}, this));\n\n                    // deal with redactor selection markers\n                    $div.find('span.redactor-selection-marker').each($.proxy(function(i,s)\n                    {\n                        this.paragraphize.z++;\n                        this.paragraphize.safes[this.paragraphize.z] = s.outerHTML;\n\n                        return $(s).replaceWith(\"\\n#####replace\" + this.paragraphize.z + \"#####\\n\\n\");\n                    }, this));\n\n\t\t\t\t\treturn $div.html();\n\t\t\t\t},\n\t\t\t\trestoreSafes: function(html)\n\t\t\t\t{\n\t\t\t\t\t$.each(this.paragraphize.safes, function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\ts = (typeof s !== 'undefined') ? s.replace(/\\$/g, '&#36;') : s;\n\t\t\t\t\t\thtml = html.replace('#####replace' + i + '#####', s);\n\n\t\t\t\t\t});\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tconvert: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = html.replace(/\\r\\n/g, \"xparagraphmarkerz\");\n\t\t\t\t\thtml = html.replace(/\\n/g, \"xparagraphmarkerz\");\n\t\t\t\t\thtml = html.replace(/\\r/g, \"xparagraphmarkerz\");\n\n\t\t\t\t\tvar re1 = /\\s+/g;\n\t\t\t\t\thtml = html.replace(re1, \" \");\n\t\t\t\t\thtml = $.trim(html);\n\n\t\t\t\t\tvar re2 = /xparagraphmarkerzxparagraphmarkerz/gi;\n\t\t\t\t\thtml = html.replace(re2, \"</p><p>\");\n\n\t\t\t\t\tvar re3 = /xparagraphmarkerz/gi;\n\t\t\t\t\thtml = html.replace(re3, \"<br>\");\n\n\t\t\t\t\thtml = '<p>' + html + '</p>';\n\n\t\t\t\t\thtml = html.replace(\"<p></p>\", \"\");\n\t\t\t\t\thtml = html.replace(\"\\r\\n\\r\\n\", \"\");\n\t\t\t\t\thtml = html.replace(/<\\/p><p>/g, \"</p>\\r\\n\\r\\n<p>\");\n\t\t\t\t\thtml = html.replace(new RegExp(\"<br\\\\s?/?></p>\", \"g\"), \"</p>\");\n\t\t\t\t\thtml = html.replace(new RegExp(\"<p><br\\\\s?/?>\", \"g\"), \"<p>\");\n\t\t\t\t\thtml = html.replace(new RegExp(\"<p><br\\\\s?/?>\", \"g\"), \"<p>\");\n\t\t\t\t\thtml = html.replace(new RegExp(\"<br\\\\s?/?></p>\", \"g\"), \"</p>\");\n\t\t\t\t\thtml = html.replace(/<p>&nbsp;<\\/p>/gi, \"\");\n\t\t\t\t\thtml = html.replace(/<p>\\s?<br>&nbsp;<\\/p>/gi, '');\n\t\t\t\t\thtml = html.replace(/<p>\\s?<br>/gi, '<p>');\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tclear: function(html)\n\t\t\t\t{\n\n\t\t\t\t\thtml = html.replace(/<p>(.*?)#####replace(.*?)#####\\s?<\\/p>/gi, '<p>$1</p>#####replace$2#####');\n\t\t\t\t\thtml = html.replace(/(<br\\s?\\/?>){2,}<\\/p>/gi, '</p>');\n\n\t\t\t\t\thtml = html.replace(new RegExp('</blockquote></p>', 'gi'), '</blockquote>');\n\t\t\t\t\thtml = html.replace(new RegExp('<p></blockquote>', 'gi'), '</blockquote>');\n\t\t\t\t\thtml = html.replace(new RegExp('<p><blockquote>', 'gi'), '<blockquote>');\n\t\t\t\t\thtml = html.replace(new RegExp('<blockquote></p>', 'gi'), '<blockquote>');\n\n\t\t\t\t\thtml = html.replace(new RegExp('<p><p ', 'gi'), '<p ');\n\t\t\t\t\thtml = html.replace(new RegExp('<p><p>', 'gi'), '<p>');\n\t\t\t\t\thtml = html.replace(new RegExp('</p></p>', 'gi'), '</p>');\n\t\t\t\t\thtml = html.replace(new RegExp('<p>\\\\s?</p>', 'gi'), '');\n\t\t\t\t\thtml = html.replace(new RegExp(\"\\n</p>\", 'gi'), '</p>');\n\t\t\t\t\thtml = html.replace(new RegExp('<p>\\t?\\t?\\n?<p>', 'gi'), '<p>');\n\t\t\t\t\thtml = html.replace(new RegExp('<p>\\t*</p>', 'gi'), '');\n\n\t\t\t\t\treturn html;\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =paste\n\t\tpaste: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tinit: function(e)\n\t\t\t\t{\n\t\t\t\t\tthis.rtePaste = true;\n\t\t\t\t\tvar pre = (this.opts.type === 'pre' || this.utils.isCurrentOrParent('pre')) ? true : false;\n\n\t\t\t\t\t// clipboard event\n\t\t\t\t\tif (this.detect.isDesktop())\n\t\t\t\t\t{\n\n    \t\t\t\t\tif (!this.paste.pre && this.opts.clipboardImageUpload && this.opts.imageUpload && this.paste.detectClipboardUpload(e))\n    \t\t\t\t\t{\n    \t\t\t\t\t\tif (this.detect.isIe())\n    \t\t\t\t\t\t{\n    \t\t\t\t\t\t\tsetTimeout($.proxy(this.paste.clipboardUpload, this), 100);\n    \t\t\t\t\t\t}\n\n    \t\t\t\t\t\treturn;\n    \t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.utils.saveScroll();\n\t\t\t\t\tthis.selection.save();\n\t\t\t\t\tthis.paste.createPasteBox(pre);\n\n\t\t\t\t\t$(window).on('scroll.redactor-freeze', $.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\t$(window).scrollTop(this.saveBodyScroll);\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\tsetTimeout($.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tvar html = this.paste.getPasteBoxCode(pre);\n\n\t\t\t\t\t\t// buffer\n\t\t\t\t\t\tthis.buffer.set();\n\t\t\t\t\t\tthis.selection.restore();\n\n\t\t\t\t\t\tthis.utils.restoreScroll();\n\n\t\t\t\t\t\t// paste info\n\t\t\t\t\t\tvar data = this.clean.getCurrentType(html);\n\n\t\t\t\t\t\t// clean\n\t\t\t\t\t\thtml = this.clean.onPaste(html, data);\n\n\t\t\t\t\t\t// callback\n\t\t\t\t\t\tvar returned = this.core.callback('paste', html);\n\t\t\t\t\t\thtml = (typeof returned === 'undefined') ? html : returned;\n\n\t\t\t\t\t\tthis.paste.insert(html, data);\n\t\t\t\t\t\tthis.rtePaste = false;\n\n\t\t\t\t\t\t// clean pre breaklines\n\t\t\t\t\t\tif (pre)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.clean.cleanPre();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$(window).off('scroll.redactor-freeze');\n\n\t\t\t\t\t}, this), 1);\n\n\t\t\t\t},\n\t\t\t\tgetPasteBoxCode: function(pre)\n\t\t\t\t{\n\t\t\t\t\tvar html = (pre) ? this.$pasteBox.val() : this.$pasteBox.html();\n\t\t\t\t\tthis.$pasteBox.remove();\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tcreatePasteBox: function(pre)\n\t\t\t\t{\n\t\t\t\t\tvar css = { position: 'fixed', width: '1px', top: 0, left: '-9999px' };\n\n\t\t\t\t\tthis.$pasteBox = (pre) ? $('<textarea>').css(css) : $('<div>').attr('contenteditable', 'true').css(css);\n\t\t\t\t\tthis.paste.appendPasteBox();\n\t\t\t\t\tthis.$pasteBox.focus();\n\t\t\t\t},\n\t\t\t\tappendPasteBox: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.detect.isIe())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.box().append(this.$pasteBox);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t// bootstrap modal\n\t\t\t\t\t\tvar $visibleModals = $('.modal-body:visible');\n\t\t\t\t\t\tif ($visibleModals.length > 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$visibleModals.append(this.$pasteBox);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$('body').prepend(this.$pasteBox);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tdetectClipboardUpload: function(e)\n\t\t\t\t{\n\t\t\t\t\te = e.originalEvent || e;\n\n\t\t\t\t\tvar clipboard = e.clipboardData;\n\t\t\t\t\tif (this.detect.isIe() || this.detect.isFirefox())\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// prevent safari fake url\n\t\t\t\t\tvar types = clipboard.types;\n\t\t\t\t\tif (types.indexOf('public.tiff') !== -1)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!clipboard.items || !clipboard.items.length)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar file = clipboard.items[0].getAsFile();\n\t\t\t\t\tif (file === null)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar reader = new FileReader();\n\t\t\t\t\treader.readAsDataURL(file);\n\t\t\t\t\treader.onload = $.proxy(this.paste.insertFromClipboard, this);\n\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t\tclipboardUpload: function()\n\t\t\t\t{\n\t\t\t\t\tvar imgs = this.$editor.find('img');\n\t\t\t\t\t$.each(imgs, $.proxy(function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (s.src.search(/^data\\:image/i) === -1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar formData = !!window.FormData ? new FormData() : null;\n\t\t\t\t\t\tif (!window.FormData)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.upload.direct = true;\n\t\t\t\t\t\tthis.upload.type = 'image';\n\t\t\t\t\t\tthis.upload.url = this.opts.imageUpload;\n\t\t\t\t\t\tthis.upload.callback = $.proxy(function(data)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (this.detect.isIe())\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$(s).wrap($('<figure />'));\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvar $parent = $(s).parent();\n\t\t\t\t\t\t\t\tthis.utils.replaceToTag($parent, 'figure');\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\ts.src = data.url;\n\t\t\t\t\t\t\tthis.core.callback('imageUpload', $(s), data);\n\n\t\t\t\t\t\t}, this);\n\n\t\t\t\t\t\tvar blob = this.utils.dataURItoBlob(s.src);\n\n\t\t\t\t\t\tformData.append('clipboard', 1);\n\t\t\t\t\t\tformData.append(this.opts.imageUploadParam, blob);\n\n\t\t\t\t\t\tthis.progress.show();\n\t\t\t\t\t\tthis.upload.send(formData, false);\n\t\t\t\t\t\tthis.code.sync();\n\t\t\t\t\t\tthis.rtePaste = false;\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\tinsertFromClipboard: function(e)\n\t\t\t\t{\n\t\t\t\t\tvar formData = !!window.FormData ? new FormData() : null;\n\t\t\t\t\tif (!window.FormData)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.upload.direct = true;\n\t\t\t\t\tthis.upload.type = 'image';\n\t\t\t\t\tthis.upload.url = this.opts.imageUpload;\n\t\t\t\t\tthis.upload.callback = this.image.insert;\n\n\t\t\t\t\tvar blob = this.utils.dataURItoBlob(e.target.result);\n\n\t\t\t\t\tformData.append('clipboard', 1);\n\t\t\t\t\tformData.append(this.opts.imageUploadParam, blob);\n\n\t\t\t\t\tthis.progress.show();\n\t\t\t\t\tthis.upload.send(formData, e);\n\t\t\t\t\tthis.rtePaste = false;\n\t\t\t\t},\n\t\t\t\tinsert: function(html, data)\n\t\t\t\t{\n\t\t\t\t\tif (data.pre)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.insert.raw(html);\n\t\t\t\t\t}\n\t\t\t\t\telse if (data.text)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.insert.text(html);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.insert.html(html, data);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Firefox Clipboard Observe\n\t\t\t\t\tif (this.detect.isFirefox() && this.opts.clipboardImageUpload)\n\t\t\t\t\t{\n\t\t\t\t\t\tsetTimeout($.proxy(this.paste.clipboardUpload, this), 100);\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =placeholder\n\t\tplaceholder: function()\n\t\t{\n\t\t\treturn {\n\n\t\t\t\t// public\n\t\t\t\tenable: function()\n\t\t\t\t{\n\t\t\t\t\tsetTimeout($.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\treturn (this.placeholder.isEditorEmpty()) ? this.placeholder.show() : this.placeholder.hide();\n\n\t\t\t\t\t}, this), 5);\n\t\t\t\t},\n\t\t\t\tshow: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().addClass('redactor-placeholder');\n\t\t\t\t},\n\t\t\t\tupdate: function(text)\n\t\t\t\t{\n\t\t\t\t\tthis.opts.placeholder = text;\n\t\t\t\t\tthis.core.editor().attr('placeholder', text);\n\t\t\t\t},\n\t\t\t\thide: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().removeClass('redactor-placeholder');\n\t\t\t\t},\n\t\t\t\tis: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.core.editor().hasClass('redactor-placeholder');\n\t\t\t\t},\n\n\n\t\t\t\t// private\n\t\t\t\tinit: function()\n\t\t\t\t{\n\t\t\t\t\tif (!this.placeholder.enabled())\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!this.utils.isEditorRelative())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.utils.setEditorRelative();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.placeholder.build();\n\t\t\t\t\tthis.placeholder.buildPosition();\n\t\t\t\t\tthis.placeholder.enable();\n\t\t\t\t\tthis.placeholder.enableEvents();\n\n\t\t\t\t},\n\t\t\t\tenabled: function()\n\t\t\t\t{\n\t\t\t\t\treturn (this.opts.placeholder) ? this.core.element().attr('placeholder', this.opts.placeholder) : this.placeholder.isAttr();\n\t\t\t\t},\n\t\t\t\tenableEvents: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().on('keydown.redactor-placeholder.' + this.uuid, $.proxy(this.placeholder.enable, this));\n\t\t\t\t},\n\t\t\t\tdisableEvents: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().off('.redactor-placeholder.' + this.uuid);\n\t\t\t\t},\n\t\t\t\tbuild: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().attr('placeholder', this.core.element().attr('placeholder'));\n\t\t\t\t},\n\t\t\t\tbuildPosition: function()\n\t\t\t\t{\n\t\t\t\t\tvar $style = $('<style />');\n\t\t\t\t\t$style.addClass('redactor-placeholder-style-tag');\n\t\t\t\t\t$style.html('#' + this.core.id() + '.redactor-placeholder::after ' + this.placeholder.getPosition());\n\n\t\t\t\t\t$('head').append($style);\n\t\t\t\t},\n\t\t\t\tgetPosition: function()\n\t\t\t\t{\n\t\t\t\t\treturn '{ top: ' + this.core.editor().css('padding-top') + '; left: ' + this.core.editor().css('padding-left') + '; }';\n\t\t\t\t},\n\t\t\t\tisEditorEmpty: function()\n\t\t\t\t{\n\t\t\t\t\tvar html = $.trim(this.core.editor().html()).replace(/[\\t\\n]/g, '');\n\t\t\t\t\tvar states = ['', '<p>​</p>', '<p>​<br></p>', this.opts.emptyHtmlRendered];\n\n\t\t\t\t\treturn ($.inArray(html, states) !== -1);\n\t\t\t\t},\n\t\t\t\tisAttr: function()\n\t\t\t\t{\n\t\t\t\t\treturn (typeof this.core.element().attr('placeholder') !== 'undefined' && this.core.element().attr('placeholder') !== '');\n\t\t\t\t},\n\t\t\t\tdestroy: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().removeAttr('placeholder');\n\n\t\t\t\t\tthis.placeholder.hide();\n\t\t\t\t\tthis.placeholder.disableEvents();\n\n\t\t\t\t\t$('.redactor-placeholder-style-tag').remove();\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =progress\n\t\tprogress: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\t$box: null,\n\t\t\t\t$bar: null,\n\t\t\t\ttarget: document.body,  // or id selector\n\n\t\t\t\t// public\n\t\t\t\tshow: function()\n\t\t\t\t{\n\t\t\t\t\tif (!this.progress.is())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.progress.build();\n\t\t\t\t\t\tthis.progress.$box.redactorAnimation('fadeIn');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.progress.$box.show();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\thide: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.progress.is())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.progress.$box.redactorAnimation('fadeOut', { duration: 0.35 }, $.proxy(this.progress.destroy, this));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tupdate: function(value)\n\t\t\t\t{\n\t\t\t\t\tthis.progress.show();\n\t\t\t\t\tthis.progress.$bar.css('width', value + '%');\n\t\t\t\t},\n\t\t\t\tis: function()\n\t\t\t\t{\n\t\t\t\t\treturn (this.progress.$box === null) ? false : true;\n\t\t\t\t},\n\n\t\t\t\t// private\n\t\t\t\tbuild: function()\n\t\t\t\t{\n\t\t\t\t\tthis.progress.$bar = $('<span />');\n\t\t\t\t\tthis.progress.$box = $('<div id=\"redactor-progress\" />');\n\n\t\t\t\t\tthis.progress.$box.append(this.progress.$bar);\n\t\t\t\t\t$(this.progress.target).append(this.progress.$box);\n\t\t\t\t},\n\t\t\t\tdestroy: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.progress.is())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.progress.$box.remove();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.progress.$box = null;\n\t\t\t\t\tthis.progress.$bar = null;\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =selection\n\t\tselection: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tget: function()\n\t\t\t\t{\n\t\t\t\t\tif (window.getSelection)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn window.getSelection();\n\t\t\t\t\t}\n\t\t\t\t\telse if (document.selection && document.selection.type !== \"Control\")\n\t\t\t\t\t{\n\t\t\t\t\t\treturn document.selection;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn null;\n\t\t\t\t},\n\t\t\t\trange: function(sel)\n\t\t\t\t{\n\t\t\t\t\tif (typeof sel === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tsel = this.selection.get();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (sel.getRangeAt && sel.rangeCount)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn sel.getRangeAt(0);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn null;\n\t\t\t\t},\n\t\t\t\tis: function()\n\t\t\t\t{\n\t\t\t\t\treturn (this.selection.isCollapsed()) ? false : true;\n\t\t\t\t},\n\t\t\t\tisRedactor: function()\n\t\t\t\t{\n\t\t\t\t\tvar range = this.selection.range();\n\n\t\t\t\t\tif (range !== null)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar el = range.startContainer.parentNode;\n\n\t\t\t\t\t\tif ($(el).hasClass('redactor-in') || $(el).parents('.redactor-in').length !== 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\tisCollapsed: function()\n\t\t\t\t{\n\t\t\t\t\tvar sel = this.selection.get();\n\n\t\t\t\t\treturn (sel === null) ? false : sel.isCollapsed;\n\t\t\t\t},\n\t\t\t\tupdate: function(sel, range)\n\t\t\t\t{\n\t\t\t\t\tif (range === null)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tsel.removeAllRanges();\n\t\t\t\t\tsel.addRange(range);\n\t\t\t\t},\n\t\t\t\tcurrent: function()\n\t\t\t\t{\n\t\t\t\t\tvar sel = this.selection.get();\n\n\t\t\t\t\treturn (sel === null) ? false : sel.anchorNode;\n\t\t\t\t},\n\t\t\t\tparent: function()\n\t\t\t\t{\n\t\t\t\t\tvar current = this.selection.current();\n\n\t\t\t\t\treturn (current === null) ? false : current.parentNode;\n\t\t\t\t},\n\t\t\t\tblock: function(node)\n\t\t\t\t{\n\t\t\t\t\tnode = node || this.selection.current();\n\n\t\t\t\t\twhile (node)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.utils.isBlockTag(node.tagName))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn ($(node).hasClass('redactor-in')) ? false : node;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\tinline: function(node)\n\t\t\t\t{\n\t\t\t\t\tnode = node || this.selection.current();\n\n\t\t\t\t\twhile (node)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.utils.isInlineTag(node.tagName))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn ($(node).hasClass('redactor-in')) ? false : node;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\telement: function(node)\n\t\t\t\t{\n\t\t\t\t\tif (!node)\n\t\t\t\t\t{\n\t\t\t\t\t\tnode = this.selection.current();\n\t\t\t\t\t}\n\n\t\t\t\t\twhile (node)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (node.nodeType === 1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif ($(node).hasClass('redactor-in'))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn node;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\tprev: function()\n\t\t\t\t{\n\t\t\t\t\tvar current = this.selection.current();\n\n\t\t\t\t\treturn (current === null) ? false : this.selection.current().previousSibling;\n\t\t\t\t},\n\t\t\t\tnext: function()\n\t\t\t\t{\n\t\t\t\t\tvar current = this.selection.current();\n\n\t\t\t\t\treturn (current === null) ? false : this.selection.current().nextSibling;\n\t\t\t\t},\n\t\t\t\tblocks: function(tag)\n\t\t\t\t{\n\t\t\t\t\tvar blocks = [];\n\t\t\t\t\tvar nodes = this.selection.nodes(tag);\n\n\t\t\t\t\t$.each(nodes, $.proxy(function(i,node)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.utils.isBlock(node))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tblocks.push(node);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\tvar block = this.selection.block();\n\t\t\t\t\tif (blocks.length === 0 && block === false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn [];\n\t\t\t\t\t}\n\t\t\t\t\telse if (blocks.length === 0 && block !== false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn [block];\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\treturn blocks;\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tinlines: function(tag)\n\t\t\t\t{\n\t\t\t\t\tvar inlines = [];\n\t\t\t\t\tvar nodes = this.selection.nodes(tag);\n\n\t\t\t\t\t$.each(nodes, $.proxy(function(i,node)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.utils.isInline(node))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tinlines.push(node);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\tvar inline = this.selection.inline();\n\t\t\t\t\tif (inlines.length === 0 && inline === false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn [];\n\t\t\t\t\t}\n\t\t\t\t\telse if (inlines.length === 0 && inline !== false)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn [inline];\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\treturn inlines;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tnodes: function(tag)\n\t\t\t\t{\n                    var filter = (typeof tag === 'undefined') ? [] : (($.isArray(tag)) ? tag : [tag]);\n\n\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\tvar range = this.selection.range(sel);\n                    var nodes = [];\n                    var resultNodes = [];\n\n\t\t\t\t\tif (this.utils.isCollapsed())\n\t\t\t\t\t{\n\t\t\t\t\t\tnodes = [this.selection.current()];\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tvar node = range.startContainer;\n\t\t\t\t\t\tvar endNode = range.endContainer;\n\n\t\t\t\t\t\t// single node\n\t\t\t\t\t\tif (node === endNode)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn [this.selection.parent()];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// iterate\n\t\t\t\t\t\twhile (node && node !== endNode)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tnodes.push(node = this.selection.nextNode(node));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// partially selected nodes\n\t\t\t\t\t\tnode = range.startContainer;\n\t\t\t\t\t\twhile (node && node !== range.commonAncestorContainer)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tnodes.unshift(node);\n\t\t\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// remove service nodes\n\t\t\t\t\t$.each(nodes, function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (s)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar tagName = (s.nodeType !== 1) ? false : s.tagName.toLowerCase();\n\n\t\t\t\t\t\t\tif ($(s).hasClass('redactor-script-tag') || $(s).hasClass('redactor-selection-marker'))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if (tagName && filter.length !== 0 && $.inArray(tagName, filter) === -1)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tresultNodes.push(s);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\treturn (resultNodes.length === 0) ? [] : resultNodes;\n\t\t\t\t},\n\t\t\t\tnextNode: function(node)\n\t\t\t\t{\n\t\t\t\t\tif (node.hasChildNodes())\n\t\t\t\t\t{\n\t\t\t\t\t\treturn node.firstChild;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\twhile (node && !node.nextSibling)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!node)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn node.nextSibling;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsave: function()\n\t\t\t\t{\n \t\t\t\t\tthis.marker.insert();\n\t\t\t\t\tthis.savedSel = this.core.editor().html();\n\t\t\t\t},\n\t\t\t\trestore: function(removeMarkers)\n\t\t\t\t{\n                    var node1 = this.marker.find(1);\n\t\t\t\t\tvar node2 = this.marker.find(2);\n\n\t\t\t\t\tif (this.detect.isFirefox())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().focus();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (node1.length !== 0 && node2.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.caret.set(node1, node2);\n\t\t\t\t\t}\n\t\t\t\t\telse if (node1.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.caret.start(node1);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.editor().focus();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (removeMarkers !== false)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.marker.remove();\n\t\t\t\t\t\tthis.savedSel = false;\n\t\t\t\t\t}\n\t\t\t\t},\n                saveInstant: function()\n                {\n                    var el = this.core.editor()[0];\n                    var doc = el.ownerDocument, win = doc.defaultView;\n                    var sel = win.getSelection();\n\n                    if (!sel.getRangeAt || !sel.rangeCount)\n                    {\n                        return;\n                    }\n\n                    var range = sel.getRangeAt(0);\n                    var selectionRange = range.cloneRange();\n\n                    selectionRange.selectNodeContents(el);\n                    selectionRange.setEnd(range.startContainer, range.startOffset);\n\n                    var start = selectionRange.toString().length;\n\n                    this.saved = {\n                        start: start,\n                        end: start + range.toString().length,\n                        node: range.startContainer\n                    };\n\n                    return this.saved;\n                },\n                restoreInstant: function(saved)\n                {\n                    if (typeof saved === 'undefined' && !this.saved)\n                    {\n                        return;\n                    }\n\n                    this.saved = (typeof saved !== 'undefined') ? saved : this.saved;\n\n                    var $node = this.core.editor().find(this.saved.node);\n                    if ($node.length !== 0 && $node.text().trim().replace(/\\u200B/g, '').length === 0)\n                    {\n                       try {\n                            var range = document.createRange();\n                            range.setStart($node[0], 0);\n\n                            var sel = window.getSelection();\n                            sel.removeAllRanges();\n                            sel.addRange(range);\n                        }\n                        catch(e) {}\n\n                        return;\n                    }\n\n                    var el = this.core.editor()[0];\n                    var doc = el.ownerDocument, win = doc.defaultView;\n                    var charIndex = 0, range = doc.createRange();\n\n                    range.setStart(el, 0);\n                    range.collapse(true);\n\n                    var nodeStack = [el], node, foundStart = false, stop = false;\n                    while (!stop && (node = nodeStack.pop()))\n                    {\n                        if (node.nodeType == 3)\n                        {\n                            var nextCharIndex = charIndex + node.length;\n                            if (!foundStart && this.saved.start >= charIndex && this.saved.start <= nextCharIndex)\n                            {\n                                range.setStart(node, this.saved.start - charIndex);\n                                foundStart = true;\n                            }\n\n                            if (foundStart && this.saved.end >= charIndex && this.saved.end <= nextCharIndex)\n                            {\n                                range.setEnd(node, this.saved.end - charIndex);\n                                stop = true;\n                            }\n                            charIndex = nextCharIndex;\n                        }\n                        else\n                        {\n                            var i = node.childNodes.length;\n                            while (i--)\n                            {\n                                nodeStack.push(node.childNodes[i]);\n                            }\n                        }\n                    }\n\n                    var sel = win.getSelection();\n                    sel.removeAllRanges();\n                    sel.addRange(range);\n                },\n\t\t\t\tnode: function(node)\n\t\t\t\t{\n\t\t\t\t\t$(node).prepend(this.marker.get(1));\n\t\t\t\t\t$(node).append(this.marker.get(2));\n\n\t\t\t\t\tthis.selection.restore();\n\t\t\t\t},\n\t\t\t\tall: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().focus();\n\n\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\tvar range = this.selection.range(sel);\n\n\t\t\t\t\trange.selectNodeContents(this.core.editor()[0]);\n\n\t\t\t\t\tthis.selection.update(sel, range);\n\t\t\t\t},\n\t\t\t\tremove: function()\n\t\t\t\t{\n\t\t\t\t\tthis.selection.get().removeAllRanges();\n\t\t\t\t},\n\t\t\t\treplace: function(html)\n\t\t\t\t{\n\t\t\t\t\tthis.insert.html(html);\n\t\t\t\t},\n\t\t\t\ttext: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.selection.get().toString();\n\t\t\t\t},\n\t\t\t\thtml: function()\n\t\t\t\t{\n\t\t\t\t\tvar html = '';\n\t\t\t\t\tvar sel = this.selection.get();\n\n\t\t\t\t\tif (sel.rangeCount)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar container = document.createElement('div');\n\t\t\t\t\t\tvar len = sel.rangeCount;\n\t\t\t\t\t\tfor (var i = 0; i < len; ++i)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcontainer.appendChild(sel.getRangeAt(i).cloneContents());\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\thtml = this.clean.onGet(container.innerHTML);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\textractEndOfNode: function(node)\n\t\t\t\t{\n\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\tvar range = this.selection.range(sel);\n\n\t\t\t        var clonedRange = range.cloneRange();\n\t\t\t        clonedRange.selectNodeContents(node);\n\t\t\t        clonedRange.setStart(range.endContainer, range.endOffset);\n\n\t\t\t        return clonedRange.extractContents();\n\t\t\t\t},\n\n\t\t\t\t// #backward\n\t\t\t\tremoveMarkers: function()\n\t\t\t\t{\n\t\t\t\t\tthis.marker.remove();\n\t\t\t\t},\n\t\t\t\tmarker: function(num)\n\t\t\t\t{\n\t\t\t\t\treturn this.marker.get(num);\n\t\t\t\t},\n\t\t\t\tmarkerHtml: function(num)\n\t\t\t\t{\n\t\t\t\t\treturn this.marker.html(num);\n\t\t\t\t}\n\n\t\t\t};\n\t\t},\n\n\t\t// =shortcuts\n\t\tshortcuts: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\t// based on https://github.com/jeresig/jquery.hotkeys\n\t\t\t\thotkeysSpecialKeys: {\n\t\t\t\t\t8: \"backspace\", 9: \"tab\", 10: \"return\", 13: \"return\", 16: \"shift\", 17: \"ctrl\", 18: \"alt\", 19: \"pause\",\n\t\t\t\t\t20: \"capslock\", 27: \"esc\", 32: \"space\", 33: \"pageup\", 34: \"pagedown\", 35: \"end\", 36: \"home\",\n\t\t\t\t\t37: \"left\", 38: \"up\", 39: \"right\", 40: \"down\", 45: \"insert\", 46: \"del\", 59: \";\", 61: \"=\",\n\t\t\t\t\t96: \"0\", 97: \"1\", 98: \"2\", 99: \"3\", 100: \"4\", 101: \"5\", 102: \"6\", 103: \"7\",\n\t\t\t\t\t104: \"8\", 105: \"9\", 106: \"*\", 107: \"+\", 109: \"-\", 110: \".\", 111 : \"/\",\n\t\t\t\t\t112: \"f1\", 113: \"f2\", 114: \"f3\", 115: \"f4\", 116: \"f5\", 117: \"f6\", 118: \"f7\", 119: \"f8\",\n\t\t\t\t\t120: \"f9\", 121: \"f10\", 122: \"f11\", 123: \"f12\", 144: \"numlock\", 145: \"scroll\", 173: \"-\", 186: \";\", 187: \"=\",\n\t\t\t\t\t188: \",\", 189: \"-\", 190: \".\", 191: \"/\", 192: \"`\", 219: \"[\", 220: \"\\\\\", 221: \"]\", 222: \"'\"\n\t\t\t\t},\n\t\t\t\thotkeysShiftNums: {\n\t\t\t\t\t\"`\": \"~\", \"1\": \"!\", \"2\": \"@\", \"3\": \"#\", \"4\": \"$\", \"5\": \"%\", \"6\": \"^\", \"7\": \"&\",\n\t\t\t\t\t\"8\": \"*\", \"9\": \"(\", \"0\": \")\", \"-\": \"_\", \"=\": \"+\", \";\": \": \", \"'\": \"\\\"\", \",\": \"<\",\n\t\t\t\t\t\".\": \">\",  \"/\": \"?\",  \"\\\\\": \"|\"\n\t\t\t\t},\n\t\t\t\tinit: function(e, key)\n\t\t\t\t{\n\t\t\t\t\t// disable browser's hot keys for bold and italic if shortcuts off\n\t\t\t\t\tif (this.opts.shortcuts === false)\n\t\t\t\t\t{\n\t\t\t\t\t\tif ((e.ctrlKey || e.metaKey) && (key === 66 || key === 73))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t// build\n\t\t\t\t\t\t$.each(this.opts.shortcuts, $.proxy(function(str, command)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.shortcuts.build(e, str, command);\n\n\t\t\t\t\t\t}, this));\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tbuild: function(e, str, command)\n\t\t\t\t{\n\t\t\t\t\tvar handler = $.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.shortcuts.buildHandler(command);\n\n\t\t\t\t\t}, this);\n\n\t\t\t\t\tvar keys = str.split(',');\n\t\t\t\t\tvar len = keys.length;\n\t\t\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (typeof keys[i] === 'string')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.shortcuts.handler(e, $.trim(keys[i]), handler);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tbuildHandler: function(command)\n\t\t\t\t{\n\t\t\t\t\tvar func;\n\t\t\t\t\tif (command.func.search(/\\./) !== '-1')\n\t\t\t\t\t{\n\t\t\t\t\t\tfunc = command.func.split('.');\n\t\t\t\t\t\tif (typeof this[func[0]] !== 'undefined')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis[func[0]][func[1]].apply(this, command.params);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis[command.func].apply(this, command.params);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\thandler: function(e, keys, origHandler)\n\t\t\t\t{\n\t\t\t\t\tkeys = keys.toLowerCase().split(\" \");\n\n\t\t\t\t\tvar special = this.shortcuts.hotkeysSpecialKeys[e.keyCode];\n\t\t\t\t\tvar character = String.fromCharCode(e.which).toLowerCase();\n\t\t\t\t\tvar modif = \"\", possible = {};\n\n\t\t\t\t\t$.each([ \"alt\", \"ctrl\", \"meta\", \"shift\"], function(index, specialKey)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (e[specialKey + 'Key'] && special !== specialKey)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmodif += specialKey + '+';\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\n\t\t\t\t\tif (special)\n\t\t\t\t\t{\n\t\t\t\t\t\tpossible[modif + special] = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (character)\n\t\t\t\t\t{\n\t\t\t\t\t\tpossible[modif + character] = true;\n\t\t\t\t\t\tpossible[modif + this.shortcuts.hotkeysShiftNums[character]] = true;\n\n\t\t\t\t\t\t// \"$\" can be triggered as \"Shift+4\" or \"Shift+$\" or just \"$\"\n\t\t\t\t\t\tif (modif === \"shift+\")\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tpossible[this.shortcuts.hotkeysShiftNums[character]] = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tvar len = keys.length;\n\t\t\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (possible[keys[i]])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\treturn origHandler.apply(this, arguments);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =storage\n\t\tstorage: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tdata: [],\n\t\t\t\tadd: function(data)\n\t\t\t\t{\n\t\t\t\t\t// type, node, url, id\n\t\t\t\t\tdata.status = true;\n\t\t\t\t\tdata.url = decodeURI(data.url);\n\n\t\t\t\t\tthis.storage.data[data.url] = data;\n\t\t\t\t},\n\t\t\t\tstatus: function(url, status)\n\t\t\t\t{\n\t\t\t\t\tthis.storage.data[decodeURI(url)].status = status;\n\t\t\t\t},\n\t\t\t\tobserve: function()\n\t\t\t\t{\n\t\t\t\t\tvar _this = this;\n\n\t\t\t\t\tvar $images = this.core.editor().find('[data-image]');\n\t\t\t\t\t$images.each(function(i, s)\n\t\t\t\t\t{\n\t\t\t\t\t\t_this.storage.add({ type: 'image', node: s, url: s.src, id: $(s).attr('data-image') });\n\t\t\t\t\t});\n\n\t\t\t\t\tvar $files = this.core.editor().find('[data-file]');\n\t\t\t\t\t$files.each(function(i, s)\n\t\t\t\t\t{\n\t\t\t\t\t\t_this.storage.add({ type: 'file', node: s, url: s.href, id: $(s).attr('data-file') });\n\t\t\t\t\t});\n\n\t\t\t\t\tvar $s3 = this.core.editor().find('[data-s3]');\n\t\t\t\t\t$s3.each(function(i, s)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar url = (s.tagName === 'IMG') ? s.src : s.href;\n\t\t\t\t\t\t_this.storage.add({ type: 's3', node: s, url: url, id: $(s).attr('data-s3') });\n\t\t\t\t\t});\n\n\t\t\t\t},\n\t\t\t\tchanges: function()\n\t\t\t\t{\n\t\t\t\t\tfor (var key in this.storage.data)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar data = this.storage.data[key];\n\t\t\t\t\t\tvar attr = (data.node.tagName === 'IMG') ? 'src' : 'href';\n\t\t\t\t\t\tvar $el = this.core.editor().find('[data-' + data.type + '][' + attr + '=\"' + data.url + '\"]');\n\n\t\t\t\t\t\tif ($el.length === 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.storage.status(data.url, false);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.storage.status(data.url, true);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\n\t\t\t\t\treturn this.storage.data;\n\t\t\t\t}\n\n\t\t\t};\n\t\t},\n\n\t\t// =toolbar\n\t\ttoolbar: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tbuild: function()\n\t\t\t\t{\n\t\t\t\t\tthis.button.hideButtons();\n\t\t\t\t\tthis.button.hideButtonsOnMobile();\n\n\t\t\t\t\tthis.$toolbar = this.toolbar.createContainer();\n\n\t\t\t\t\tthis.toolbar.append();\n\t\t\t\t\tthis.button.$toolbar = this.$toolbar;\n\t\t\t\t\tthis.button.setFormatting();\n\t\t\t\t\tthis.button.load(this.$toolbar);\n\n\t\t\t\t\tthis.toolbar.setOverflow();\n\t\t\t\t\tthis.toolbar.setFixed();\n\n\t\t\t\t},\n\t\t\t\tcreateContainer: function()\n\t\t\t\t{\n\t\t\t\t\treturn $('<ul>').addClass('redactor-toolbar').attr({ 'id': 'redactor-toolbar-' + this.uuid, 'role': 'toolbar' });\n\t\t\t\t},\n\t\t\t\tappend: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.toolbarExternal)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$toolbar.addClass('redactor-toolbar-external');\n\t\t\t\t\t\t$(this.opts.toolbarExternal).html(this.$toolbar);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.opts.type === 'textarea')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.$box.prepend(this.$toolbar);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.$element.before(this.$toolbar);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsetOverflow: function()\n\t\t\t\t{\n    \t\t\t\tif (this.opts.toolbarOverflow)\n\t\t\t\t\t{\n    \t\t\t\t\tthis.$toolbar.addClass('redactor-toolbar-overflow');\n    \t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsetFixed: function()\n\t\t\t\t{\n\t\t\t\t\tif (!this.opts.toolbarFixed || this.opts.toolbarExternal)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.opts.toolbarFixedTarget !== document)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $el = $(this.opts.toolbarFixedTarget);\n\t\t\t\t\t\tthis.toolbar.toolbarOffsetTop = ($el.length === 0) ? 0 : this.core.box().offset().top - $el.offset().top;\n\t\t\t\t\t}\n\n\t\t\t\t\t// bootstrap modal fix\n\t\t\t\t\tvar late = (this.core.box().closest('.modal-body').length !== 0) ? 1000 : 0;\n\n\t\t\t\t\tsetTimeout($.proxy(function()\n\t\t\t\t\t{\n    \t\t\t\t\tvar self = this;\n\t\t\t\t\t\tthis.toolbar.observeScroll(false);\n\t\t\t\t\t\tif (this.detect.isDesktop())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$(this.opts.toolbarFixedTarget).on('scroll.redactor.' + this.uuid, function()\n\t\t\t\t\t\t\t{\n                                if (self.core.editor().height() < 100 || self.placeholder.isEditorEmpty())\n            \t\t\t\t\t{\n                \t\t\t\t\treturn;\n            \t\t\t\t\t}\n\n    \t\t\t\t\t\t\tself.toolbar.observeScroll();\n                            });\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$(this.opts.toolbarFixedTarget).on('scroll.redactor.' + this.uuid, function()\n\t\t\t\t\t\t\t{\n                                if (self.core.editor().height() < 100 || self.placeholder.isEditorEmpty())\n            \t\t\t\t\t{\n                \t\t\t\t\treturn;\n            \t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tself.core.toolbar().hide();\n\t\t\t\t\t\t\t\tclearTimeout($.data(this, \"scrollCheck\"));\n\t\t\t\t\t\t\t\t$.data(this, \"scrollCheck\", setTimeout(function()\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tself.core.toolbar().show();\n\t\t\t\t\t\t\t\t\tself.toolbar.observeScroll();\n\t\t\t\t\t\t\t\t}, 250) );\n\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}, this), late);\n\n\t\t\t\t},\n\t\t\t\tsetUnfixed: function()\n\t\t\t\t{\n    \t\t\t\tthis.toolbar.observeScrollDisable();\n\t\t\t\t},\n\t\t\t\tgetBoxTop: function()\n\t\t\t\t{\n\t\t\t\t\treturn (this.opts.toolbarFixedTarget === document) ? this.core.box().offset().top : this.toolbar.toolbarOffsetTop;\n\t\t\t\t},\n\t\t\t\tobserveScroll: function(start)\n\t\t\t\t{\n\t\t\t\t\t// tolerance 0 if redactor in the hidden layer\n\t\t\t\t\tvar tolerance = 0;\n\n\t\t\t\t\tif (start !== false)\n\t\t\t\t\t{\n\t\t\t\t\t\ttolerance = (this.opts.toolbarFixedTarget === document) ? 20 : 0;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar scrollTop = $(this.opts.toolbarFixedTarget).scrollTop();\n\t\t\t\t\tvar boxTop = this.toolbar.getBoxTop();\n\n                    if (scrollTop === boxTop)\n                    {\n                        return;\n                    }\n\n\t\t\t\t\tif ((scrollTop + this.opts.toolbarFixedTopOffset + tolerance) > boxTop)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.toolbar.observeScrollEnable(scrollTop, boxTop);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.toolbar.observeScrollDisable();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tobserveScrollResize: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$toolbar.css({\n\n\t\t\t\t\t\twidth: this.core.box().innerWidth(),\n\t\t\t\t\t\tleft: this.core.box().offset().left\n\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tobserveScrollEnable: function(scrollTop, boxTop)\n\t\t\t\t{\n\t\t\t\t\tif (typeof this.fullscreen !== 'undefined' && this.fullscreen.isOpened === false)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.toolbar.observeScrollDisable();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar end = boxTop + this.core.box().outerHeight() - 32;\n\t\t\t\t\tvar width = this.core.box().innerWidth();\n\n\t\t\t\t\tvar position = (this.detect.isDesktop()) ? 'fixed' : 'absolute';\n\t\t\t\t\tvar top = (this.detect.isDesktop()) ? this.opts.toolbarFixedTopOffset : ($(this.opts.toolbarFixedTarget).scrollTop() - boxTop + this.opts.toolbarFixedTopOffset);\n\t\t\t\t\tvar left = (this.detect.isDesktop()) ? this.core.box().offset().left : 0;\n\n\t\t\t\t\tif (this.opts.toolbarFixedTarget !== document)\n\t\t\t\t\t{\n\t\t\t\t\t\t position = 'absolute';\n\t\t\t\t\t\t top = this.opts.toolbarFixedTopOffset + $(this.opts.toolbarFixedTarget).scrollTop() - boxTop;\n\t\t\t\t\t\t left = 0;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.$toolbar.addClass('toolbar-fixed-box');\n\n\t\t\t\t\tthis.$toolbar.css({\n\t\t\t\t\t\tposition: position,\n\t\t\t\t\t\twidth: width,\n\t\t\t\t\t\ttop: top,\n\t\t\t\t\t\tleft: left\n\t\t\t\t\t});\n\n\n\t\t\t\t\tif (scrollTop > end)\n\t\t\t\t\t{\n\t\t\t\t\t\t$('.redactor-dropdown-' + this.uuid + ':visible').hide();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.toolbar.setDropdownsFixed();\n\n\t\t\t\t\tthis.$toolbar.css('visibility', (scrollTop < end) ? 'visible' : 'hidden');\n\t\t\t\t\t$(window).on('resize.redactor-toolbar.' + this.uuid, $.proxy(this.toolbar.observeScrollResize, this));\n\t\t\t\t},\n\t\t\t\tobserveScrollDisable: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$toolbar.css({\n\t\t\t\t\t\tposition: 'relative',\n\t\t\t\t\t\twidth: 'auto',\n\t\t\t\t\t\ttop: 0,\n\t\t\t\t\t\tleft: 0,\n\t\t\t\t\t\tvisibility: 'visible'\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.toolbar.unsetDropdownsFixed();\n\t\t\t\t\tthis.$toolbar.removeClass('toolbar-fixed-box');\n\t\t\t\t\t$(window).off('resize.redactor-toolbar.' + this.uuid);\n\t\t\t\t},\n\t\t\t\tsetDropdownsFixed: function()\n\t\t\t\t{\n\t\t\t\t\tvar position = (this.opts.toolbarFixedTarget === document && this.detect.isDesktop()) ? 'fixed' : 'absolute';\n\t\t\t\t\tthis.toolbar.setDropdownPosition(position);\n\t\t\t\t},\n\t\t\t\tunsetDropdownsFixed: function()\n\t\t\t\t{\n\t\t\t\t\tthis.toolbar.setDropdownPosition('absolute');\n\t\t\t\t},\n\t\t\t\tsetDropdownPosition: function(position)\n\t\t\t\t{\n\t\t\t\t\tvar self = this;\n\t\t\t\t\t$('.redactor-dropdown-' + this.uuid).each(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $el = $(this);\n\t\t\t\t\t\tvar $button = self.button.get($el.attr('rel'));\n\t\t\t\t\t\tvar top = (position === 'fixed') ? self.opts.toolbarFixedTopOffset : $button.offset().top;\n\n\t\t\t\t\t\t$el.css({ position: position, top: ($button.innerHeight() + top) + 'px' });\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =upload\n\t\tupload: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tinit: function(id, url, callback)\n\t\t\t\t{\n\t\t\t\t\tthis.upload.direct = false;\n\t\t\t\t\tthis.upload.callback = callback;\n\t\t\t\t\tthis.upload.url = url;\n\t\t\t\t\tthis.upload.$el = $(id);\n\t\t\t\t\tthis.upload.$droparea = $('<div id=\"redactor-droparea\" />');\n\n\t\t\t\t\tthis.upload.$placeholdler = $('<div id=\"redactor-droparea-placeholder\" />').text(this.lang.get('upload-label'));\n\t\t\t\t\tthis.upload.$input = $('<input type=\"file\" name=\"file\" multiple />');\n\n\t\t\t\t\tthis.upload.$placeholdler.append(this.upload.$input);\n\t\t\t\t\tthis.upload.$droparea.append(this.upload.$placeholdler);\n\t\t\t\t\tthis.upload.$el.append(this.upload.$droparea);\n\n\t\t\t\t\tthis.upload.$droparea.off('redactor.upload');\n\t\t\t\t\tthis.upload.$input.off('redactor.upload');\n\n\t\t\t\t\tthis.upload.$droparea.on('dragover.redactor.upload', $.proxy(this.upload.onDrag, this));\n\t\t\t\t\tthis.upload.$droparea.on('dragleave.redactor.upload', $.proxy(this.upload.onDragLeave, this));\n\n\t\t\t\t\t// change\n\t\t\t\t\tthis.upload.$input.on('change.redactor.upload', $.proxy(function(e)\n\t\t\t\t\t{\n                        e = e.originalEvent || e;\n                        var len = this.upload.$input[0].files.length;\n\n                        for (var i = 0; i < len; i++)\n                        {\n                            var index = (len - 1) - i;\n                            this.upload.traverseFile(this.upload.$input[0].files[index], e);\n                        }\n\t\t\t\t\t}, this));\n\n\t\t\t\t\t// drop\n\t\t\t\t\tthis.upload.$droparea.on('drop.redactor.upload', $.proxy(function(e)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\tthis.upload.$droparea.removeClass('drag-hover').addClass('drag-drop');\n\t\t\t\t\t\tthis.upload.onDrop(e);\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\tdirectUpload: function(file, e)\n\t\t\t\t{\n\t\t\t\t\tthis.upload.direct = true;\n\t\t\t\t\tthis.upload.traverseFile(file, e);\n\t\t\t\t},\n\t\t\t\tonDrop: function(e)\n\t\t\t\t{\n\t\t\t\t\te = e.originalEvent || e;\n\t\t\t\t\tvar files = e.dataTransfer.files;\n\n\t\t\t\t\tif (this.opts.multipleImageUpload)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar len = files.length;\n\t\t\t\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.upload.traverseFile(files[i], e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.upload.traverseFile(files[0], e);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\ttraverseFile: function(file, e)\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.s3)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.upload.setConfig(file);\n\t\t\t\t\t\tthis.uploads3.send(file, e);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar formData = !!window.FormData ? new FormData() : null;\n\t\t\t\t\tif (window.FormData)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.upload.setConfig(file);\n\n\t\t\t\t\t\tvar name = (this.upload.type === 'image') ? this.opts.imageUploadParam : this.opts.fileUploadParam;\n\t\t\t\t\t\tformData.append(name, file);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.progress.show();\n\t\t\t\t\tvar stop = this.core.callback('uploadStart', e, formData);\n\t\t\t\t\tif (stop !== false)\n\t\t\t\t\t{\n\t\t\t\t    \tthis.upload.send(formData, e);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsetConfig: function(file)\n\t\t\t\t{\n\t\t\t\t\tthis.upload.getType(file);\n\n\t\t\t\t\tif (this.upload.direct)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.upload.url = (this.upload.type === 'image') ? this.opts.imageUpload : this.opts.fileUpload;\n\t\t\t\t\t\tthis.upload.callback = (this.upload.type === 'image') ? this.image.insert : this.file.insert;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tgetType: function(file)\n\t\t\t\t{\n\t\t\t\t\tthis.upload.type = (this.opts.imageTypes.indexOf(file.type) === -1) ? 'file' : 'image';\n\n\t\t\t\t\tif (this.opts.imageUpload === null && this.opts.fileUpload !== null)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.upload.type = 'file';\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tgetHiddenFields: function(obj, fd)\n\t\t\t\t{\n\t\t\t\t\tif (obj === false || typeof obj !== 'object')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn fd;\n\t\t\t\t\t}\n\n\t\t\t\t\t$.each(obj, $.proxy(function(k, v)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (v !== null && v.toString().indexOf('#') === 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tv = $(v).val();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfd.append(k, v);\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\treturn fd;\n\n\t\t\t\t},\n\t\t\t\tsend: function(formData, e)\n\t\t\t\t{\n\t\t\t\t\t// append hidden fields\n\t\t\t\t\tif (this.upload.type === 'image')\n\t\t\t\t\t{\n\t\t\t\t\t\tformData = this.utils.appendFields(this.opts.imageUploadFields, formData);\n\t\t\t\t\t\tformData = this.utils.appendForms(this.opts.imageUploadForms, formData);\n\t\t\t\t\t\tformData = this.upload.getHiddenFields(this.upload.imageFields, formData);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tformData = this.utils.appendFields(this.opts.fileUploadFields, formData);\n\t\t\t\t\t\tformData = this.utils.appendForms(this.opts.fileUploadForms, formData);\n\t\t\t\t\t\tformData = this.upload.getHiddenFields(this.upload.fileFields, formData);\n\t\t\t\t\t}\n\n\t\t\t\t\tvar xhr = new XMLHttpRequest();\n\t\t\t\t\txhr.open('POST', this.upload.url);\n\t\t\t\t\txhr.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\n\n\t\t\t\t\t// complete\n\t\t\t\t\txhr.onreadystatechange = $.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t    if (xhr.readyState === 4)\n\t\t\t\t\t    {\n\t\t\t\t\t        var data = xhr.responseText;\n\n\t\t\t\t\t\t\tdata = data.replace(/^\\[/, '');\n\t\t\t\t\t\t\tdata = data.replace(/\\]$/, '');\n\n\t\t\t\t\t\t\tvar json;\n\t\t\t\t\t\t\ttry\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tjson = (typeof data === 'string' ? JSON.parse(data) : data);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcatch(err)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tjson = { error: true };\n\t\t\t\t\t\t\t}\n\n\n\t\t\t\t\t\t\tthis.progress.hide();\n\n\t\t\t\t\t\t\tif (!this.upload.direct)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.upload.$droparea.removeClass('drag-drop');\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.upload.callback(json, this.upload.direct, e);\n\t\t\t\t\t    }\n\t\t\t\t\t}, this);\n\n                    // before send\n                    var stop = this.core.callback('uploadBeforeSend', xhr);\n                    if (stop !== false)\n                    {\n\t\t\t\t\t    xhr.send(formData);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonDrag: function(e)\n\t\t\t\t{\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tthis.upload.$droparea.addClass('drag-hover');\n\t\t\t\t},\n\t\t\t\tonDragLeave: function(e)\n\t\t\t\t{\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tthis.upload.$droparea.removeClass('drag-hover');\n\t\t\t\t},\n\t\t\t\tclearImageFields: function()\n\t\t\t\t{\n\t\t\t\t\tthis.upload.imageFields = {};\n\t\t\t\t},\n\t\t\t\taddImageFields: function(name, value)\n\t\t\t\t{\n\t\t\t\t\tthis.upload.imageFields[name] = value;\n\t\t\t\t},\n\t\t\t\tremoveImageFields: function(name)\n\t\t\t\t{\n\t\t\t\t\tdelete this.upload.imageFields[name];\n\t\t\t\t},\n\t\t\t\tclearFileFields: function()\n\t\t\t\t{\n\t\t\t\t\tthis.upload.fileFields = {};\n\t\t\t\t},\n\t\t\t\taddFileFields: function(name, value)\n\t\t\t\t{\n\t\t\t\t\tthis.upload.fileFields[name] = value;\n\t\t\t\t},\n\t\t\t\tremoveFileFields: function(name)\n\t\t\t\t{\n\t\t\t\t\tdelete this.upload.fileFields[name];\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// =s3\n\t\tuploads3: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tsend: function(file, e)\n\t\t\t\t{\n\t\t\t\t\tthis.uploads3.executeOnSignedUrl(file, $.proxy(function(signedURL)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.uploads3.sendToS3(file, signedURL, e);\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\texecuteOnSignedUrl: function(file, callback)\n\t\t\t\t{\n\t\t\t\t\tvar xhr = new XMLHttpRequest();\n\t\t\t\t\tvar mark = (this.opts.s3.search(/\\?/) === -1) ? '?' : '&';\n\n\t\t\t\t\txhr.open('GET', this.opts.s3 + mark + 'name=' + file.name + '&type=' + file.type, true);\n\n\t\t\t\t\t// hack to pass bytes through unprocessed.\n\t\t\t\t\tif (xhr.overrideMimeType)\n\t\t\t\t\t{\n\t\t\t\t\t\txhr.overrideMimeType('text/plain; charset=x-user-defined');\n\t\t\t\t\t}\n\n\t\t\t\t\tvar that = this;\n\t\t\t\t\txhr.onreadystatechange = function(e)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.readyState === 4 && this.status === 200)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthat.progress.show();\n\t\t\t\t\t\t\tcallback(decodeURIComponent(this.responseText));\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\txhr.send();\n\t\t\t\t},\n\t\t\t\tcreateCORSRequest: function(method, url)\n\t\t\t\t{\n\t\t\t\t\tvar xhr = new XMLHttpRequest();\n\t\t\t\t\tif (\"withCredentials\" in xhr)\n\t\t\t\t\t{\n\t\t\t\t\t\txhr.open(method, url, true);\n\t\t\t\t\t}\n\t\t\t\t\telse if (typeof XDomainRequest !== \"undefined\")\n\t\t\t\t\t{\n\t\t\t\t\t\txhr = new XDomainRequest();\n\t\t\t\t\t\txhr.open(method, url);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\txhr = null;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn xhr;\n\t\t\t\t},\n\n                sendToS3: function(file, url, e)\n                {\n                    var xhr = this.uploads3.createCORSRequest('PUT', url);\n                    if (!xhr)\n                    {\n                        return;\n                    }\n\n                    xhr.onload = $.proxy(function()\n                    {\n                        var json;\n                        this.progress.hide();\n\n                        if (xhr.status !== 200)\n                        {\n                            // error\n                            json = { error: true };\n                            this.upload.callback(json, this.upload.direct, xhr);\n\n                            return;\n                        }\n\n                        var s3file = url.split('?');\n                        if (!s3file[0])\n                        {\n                            // url parsing is fail\n                            return false;\n                        }\n\n\n                        if (!this.upload.direct)\n                        {\n                            this.upload.$droparea.removeClass('drag-drop');\n                        }\n\n                        json = { url: s3file[0], id: s3file[0], s3: true };\n                        if (this.upload.type === 'file')\n                        {\n                            var arr = s3file[0].split('/');\n                            json.name = arr[arr.length-1];\n                        }\n\n                        this.upload.callback(json, this.upload.direct, e);\n\n\n                    }, this);\n\n                    xhr.onerror = function() {};\n                    xhr.upload.onprogress = function(e) {};\n\n                    xhr.setRequestHeader('Content-Type', file.type);\n                    xhr.setRequestHeader('x-amz-acl', 'public-read');\n\n                    xhr.send(file);\n\n                }\n\t\t\t};\n\t\t},\n\n\t\t// =utils\n\t\tutils: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tisEmpty: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = (typeof html === 'undefined') ? this.core.editor().html() : html;\n\n\t\t\t\t\thtml = html.replace(/[\\u200B-\\u200D\\uFEFF]/g, '');\n\t\t\t\t\thtml = html.replace(/&nbsp;/gi, '');\n\t\t\t\t\thtml = html.replace(/<\\/?br\\s?\\/?>/g, '');\n\t\t\t\t\thtml = html.replace(/\\s/g, '');\n\t\t\t\t\thtml = html.replace(/^<p>[^\\W\\w\\D\\d]*?<\\/p>$/i, '');\n\t\t\t\t\thtml = html.replace(/<iframe(.*?[^>])>$/i, 'iframe');\n\t\t\t\t\thtml = html.replace(/<source(.*?[^>])>$/i, 'source');\n\n\t\t\t\t\t// remove empty tags\n\t\t\t\t\thtml = html.replace(/<[^\\/>][^>]*><\\/[^>]+>/gi, '');\n\t\t\t\t\thtml = html.replace(/<[^\\/>][^>]*><\\/[^>]+>/gi, '');\n\n\t\t\t\t\thtml = $.trim(html);\n\n\t\t\t\t\treturn html === '';\n\t\t\t\t},\n\t\t\t\tisElement: function(obj)\n\t\t\t\t{\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// Using W3 DOM2 (works for FF, Opera and Chrome)\n\t\t\t\t\t\treturn obj instanceof HTMLElement;\n\t\t\t\t\t}\n\t\t\t\t\tcatch(e)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn (typeof obj === \"object\") && (obj.nodeType === 1) && (typeof obj.style === \"object\") && (typeof obj.ownerDocument === \"object\");\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tstrpos: function(haystack, needle, offset)\n\t\t\t\t{\n\t\t\t\t\tvar i = haystack.indexOf(needle, offset);\n\t\t\t\t\treturn i >= 0 ? i : false;\n\t\t\t\t},\n\t\t\t\tdataURItoBlob: function(dataURI)\n\t\t\t\t{\n\t\t\t\t\tvar byteString;\n\t\t\t\t\tif (dataURI.split(',')[0].indexOf('base64') >= 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tbyteString = atob(dataURI.split(',')[1]);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tbyteString = unescape(dataURI.split(',')[1]);\n\t\t\t\t\t}\n\n\t\t\t\t\tvar mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];\n\n\t\t\t\t\tvar ia = new Uint8Array(byteString.length);\n\t\t\t\t\tfor (var i = 0; i < byteString.length; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tia[i] = byteString.charCodeAt(i);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn new Blob([ia], { type:mimeString });\n\t\t\t\t},\n\t\t\t\tgetOuterHtml: function(el)\n\t\t\t\t{\n\t\t\t\t\treturn $('<div>').append($(el).eq(0).clone()).html();\n\t\t\t\t},\n\t\t\t\tcloneAttributes: function(from, to)\n\t\t\t\t{\n\t\t\t\t\tfrom = from[0] || from;\n\t\t\t\t\tto = $(to);\n\n\t\t\t\t\tvar attrs = from.attributes;\n\t\t\t\t\tvar len = attrs.length;\n\t\t\t\t\twhile (len--)\n\t\t\t\t\t{\n\t\t\t\t\t    var attr = attrs[len];\n\t\t\t\t\t    to.attr(attr.name, attr.value);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn to;\n\t\t\t\t},\n\t\t\t\tbreakBlockTag: function()\n\t\t\t\t{\n\t\t\t\t\tvar block = this.selection.block();\n\t\t\t\t\tif (!block)\n\t\t\t\t\t{\n    \t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar isEmpty = this.utils.isEmpty(block.innerHTML);\n\n\t\t\t\t\tvar tag = block.tagName.toLowerCase();\n\t\t\t\t\tif (tag === 'pre' || tag === 'li' || tag === 'td' || tag === 'th')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\n\t\t\t\t\tif (!isEmpty && this.utils.isStartOfElement(block))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn { $block: $(block), $next: $(block).next(), type: 'start' };\n\t\t\t\t\t}\n\t\t\t\t\telse if (!isEmpty && this.utils.isEndOfElement(block))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn { $block: $(block), $next: $(block).next(), type: 'end' };\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tvar endOfNode = this.selection.extractEndOfNode(block);\n\t\t\t\t\t\tvar $nextPart = $('<' + tag + ' />').append(endOfNode);\n\n\t\t\t\t\t\t$nextPart = this.utils.cloneAttributes(block, $nextPart);\n\t\t\t\t\t\t$(block).after($nextPart);\n\n\t\t\t\t\t\treturn { $block: $(block), $next: $nextPart, type: 'break' };\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t// tag detection\n\t\t\t\tinBlocks: function(tags)\n\t\t\t\t{\n\t\t\t\t\ttags = ($.isArray(tags)) ? tags : [tags];\n\n\t\t\t\t\tvar blocks = this.selection.blocks();\n\t\t\t\t\tvar len = blocks.length;\n\t\t\t\t\tvar contains = false;\n\t\t\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (blocks[i] !== false)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar tag = blocks[i].tagName.toLowerCase();\n\n\t\t\t\t\t\t\tif ($.inArray(tag, tags) !== -1)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tcontains = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn contains;\n\n\t\t\t\t},\n\t\t\t\tinInlines: function(tags)\n\t\t\t\t{\n\t\t\t\t\ttags = ($.isArray(tags)) ? tags : [tags];\n\n\t\t\t\t\tvar inlines = this.selection.inlines();\n\t\t\t\t\tvar len = inlines.length;\n\t\t\t\t\tvar contains = false;\n\t\t\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar tag = inlines[i].tagName.toLowerCase();\n\n\t\t\t\t\t\tif ($.inArray(tag, tags) !== -1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcontains = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn contains;\n\n\t\t\t\t},\n\t\t\t\tisTag: function(current, tag)\n\t\t\t\t{\n\t\t\t\t\tvar element = $(current).closest(tag, this.core.editor()[0]);\n\t\t\t\t\tif (element.length === 1)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn element[0];\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\tisBlock: function(block)\n\t\t\t\t{\n\t\t\t\t\tif (block === null)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tblock = block[0] || block;\n\n\t\t\t\t\treturn block && this.utils.isBlockTag(block.tagName);\n\t\t\t\t},\n\t\t\t\tisBlockTag: function(tag)\n\t\t\t\t{\n\t\t\t\t\treturn (typeof tag === 'undefined') ? false : this.reIsBlock.test(tag);\n\t\t\t\t},\n\t\t\t\tisInline: function(inline)\n\t\t\t\t{\n\t\t\t\t\tinline = inline[0] || inline;\n\n\t\t\t\t\treturn inline && this.utils.isInlineTag(inline.tagName);\n\t\t\t\t},\n\t\t\t\tisInlineTag: function(tag)\n\t\t\t\t{\n\t\t\t\t\treturn (typeof tag === 'undefined') ? false : this.reIsInline.test(tag);\n\t\t\t\t},\n\t\t\t\t// parents detection\n\t\t\t\tisRedactorParent: function(el)\n\t\t\t\t{\n\t\t\t\t\tif (!el)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($(el).parents('.redactor-in').length === 0 || $(el).hasClass('redactor-in'))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn el;\n\t\t\t\t},\n\t\t\t\tisCurrentOrParentHeader: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.utils.isCurrentOrParent(['H1', 'H2', 'H3', 'H4', 'H5', 'H6']);\n\t\t\t\t},\n\t\t\t\tisCurrentOrParent: function(tagName)\n\t\t\t\t{\n\t\t\t\t\tvar parent = this.selection.parent();\n\t\t\t\t\tvar current = this.selection.current();\n\n\t\t\t\t\tif ($.isArray(tagName))\n\t\t\t\t\t{\n\t\t\t\t\t\tvar matched = 0;\n\t\t\t\t\t\t$.each(tagName, $.proxy(function(i, s)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (this.utils.isCurrentOrParentOne(current, parent, s))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tmatched++;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, this));\n\n\t\t\t\t\t\treturn (matched === 0) ? false : true;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.utils.isCurrentOrParentOne(current, parent, tagName);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tisCurrentOrParentOne: function(current, parent, tagName)\n\t\t\t\t{\n\t\t\t\t\ttagName = tagName.toUpperCase();\n\n\t\t\t\t\treturn parent && parent.tagName === tagName ? parent : current && current.tagName === tagName ? current : false;\n\t\t\t\t},\n\t\t\t\tisEditorRelative: function()\n\t\t\t\t{\n\t\t\t\t\tvar position = this.core.editor().css('position');\n\t\t\t\t\tvar arr = ['absolute', 'fixed', 'relative'];\n\n\t\t\t\t\treturn ($.inArray(arr, position) !== -1);\n\t\t\t\t},\n\t\t\t\tsetEditorRelative: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.editor().addClass('redactor-relative');\n\t\t\t\t},\n\t\t\t\t// scroll\n\t\t\t\tgetScrollTarget: function()\n\t\t\t\t{\n    \t\t\t\tvar $scrollTarget = $(this.opts.scrollTarget);\n\n    \t\t\t\treturn ($scrollTarget.length !== 0) ? $scrollTarget : $(document);\n\t\t\t\t},\n\t\t\t\tfreezeScroll: function()\n\t\t\t\t{\n\t\t\t\t\tthis.freezeScrollTop = this.utils.getScrollTarget().scrollTop();\n\t\t\t\t\tthis.utils.getScrollTarget().scrollTop(this.freezeScrollTop);\n\t\t\t\t},\n\t\t\t\tunfreezeScroll: function()\n\t\t\t\t{\n\t\t\t\t\tif (typeof this.freezeScrollTop === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.utils.getScrollTarget().scrollTop(this.freezeScrollTop);\n\t\t\t\t},\n\t\t\t\tsaveScroll: function()\n\t\t\t\t{\n\t\t\t\t\tthis.tmpScrollTop = this.utils.getScrollTarget().scrollTop();\n\t\t\t\t},\n\t\t\t\trestoreScroll: function()\n\t\t\t\t{\n\t\t\t\t\tif (typeof this.tmpScrollTop === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.utils.getScrollTarget().scrollTop(this.tmpScrollTop);\n\t\t\t\t},\n\t\t\t\tisStartOfElement: function(element)\n\t\t\t\t{\n\t\t\t\t\tif (typeof element === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\telement = this.selection.block();\n\t\t\t\t\t\tif (!element)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn (this.offset.get(element) === 0) ? true : false;\n\t\t\t\t},\n\t\t\t\tisEndOfElement: function(element)\n\t\t\t\t{\n\t\t\t\t\tif (typeof element === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\telement = this.selection.block();\n\t\t\t\t\t\tif (!element)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tvar text = $.trim($(element).text()).replace(/[\\t\\n\\r\\n]/g, '').replace(/\\u200B/g, '');\n\t\t\t\t\tvar offset = this.offset.get(element);\n\n\t\t\t\t\treturn (offset === text.length) ? true : false;\n\t\t\t\t},\n\t\t\t\tremoveEmptyAttr: function(el, attr)\n\t\t\t\t{\n\t\t\t\t\tvar $el = $(el);\n\t\t\t\t\tif (typeof $el.attr(attr) === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($el.attr(attr) === '')\n\t\t\t\t\t{\n\t\t\t\t\t\t$el.removeAttr(attr);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\treplaceToTag: function(node, tag)\n\t\t\t\t{\n\t\t\t\t\tvar replacement;\n\t\t\t\t\t$(node).replaceWith(function()\n\t\t\t\t\t{\n\t\t\t\t\t\treplacement = $('<' + tag + ' />').append($(this).contents());\n\n\t\t\t\t\t\tfor (var i = 0; i < this.attributes.length; i++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treplacement.attr(this.attributes[i].name, this.attributes[i].value);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn replacement;\n\t\t\t\t\t});\n\n\t\t\t\t\treturn replacement;\n\t\t\t\t},\n\t\t\t\t// select all\n\t\t\t\tisSelectAll: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.selectAll;\n\t\t\t\t},\n\t\t\t\tenableSelectAll: function()\n\t\t\t\t{\n\t\t\t\t\tthis.selectAll = true;\n\t\t\t\t},\n\t\t\t\tdisableSelectAll: function()\n\t\t\t\t{\n\t\t\t\t\tthis.selectAll = false;\n\t\t\t\t},\n\t\t\t\tdisableBodyScroll: function()\n\t\t\t\t{\n\t\t\t\t\tvar $body = $('html');\n\t\t\t\t\tvar windowWidth = window.innerWidth;\n\t\t\t\t\tif (!windowWidth)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar documentElementRect = document.documentElement.getBoundingClientRect();\n\t\t\t\t\t\twindowWidth = documentElementRect.right - Math.abs(documentElementRect.left);\n\t\t\t\t\t}\n\n\t\t\t\t\tvar isOverflowing = document.body.clientWidth < windowWidth;\n\t\t\t\t\tvar scrollbarWidth = this.utils.measureScrollbar();\n\n\t\t\t\t\t$body.css('overflow', 'hidden');\n\t\t\t\t\tif (isOverflowing)\n\t\t\t\t\t{\n\t\t\t\t\t\t$body.css('padding-right', scrollbarWidth);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tmeasureScrollbar: function()\n\t\t\t\t{\n\t\t\t\t\tvar $body = $('body');\n\t\t\t\t\tvar scrollDiv = document.createElement('div');\n\t\t\t\t\tscrollDiv.className = 'redactor-scrollbar-measure';\n\n\t\t\t\t\t$body.append(scrollDiv);\n\t\t\t\t\tvar scrollbarWidth = scrollDiv.offsetWidth - scrollDiv.clientWidth;\n\t\t\t\t\t$body[0].removeChild(scrollDiv);\n\t\t\t\t\treturn scrollbarWidth;\n\t\t\t\t},\n\t\t\t\tenableBodyScroll: function()\n\t\t\t\t{\n\t\t\t\t\t$('html').css({ 'overflow': '', 'padding-right': '' });\n\t\t\t\t\t$('body').remove('redactor-scrollbar-measure');\n\t\t\t\t},\n\t\t\t\tappendFields: function(appendFields, data)\n\t\t\t\t{\n\t\t\t\t\tif (!appendFields)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn data;\n\t\t\t\t\t}\n\t\t\t\t\telse if (typeof appendFields === 'object')\n\t\t\t\t\t{\n    \t\t\t\t\t$.each(appendFields, function(k, v)\n    \t\t\t\t\t{\n    \t\t\t\t\t\tif (v !== null && v.toString().indexOf('#') === 0)\n    \t\t\t\t\t\t{\n        \t\t\t\t\t\tv = $(v).val();\n                            }\n\n    \t\t\t\t\t\tdata.append(k, v);\n\n    \t\t\t\t\t});\n\n    \t\t\t\t\treturn data;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $fields = $(appendFields);\n\t\t\t\t\tif ($fields.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn data;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tvar str = '';\n\t\t\t\t\t\t$fields.each(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdata.append($(this).attr('name'), $(this).val());\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn data;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tappendForms: function(appendForms, data)\n\t\t\t\t{\n\t\t\t\t\tif (!appendForms)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn data;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $forms = $(appendForms);\n\t\t\t\t\tif ($forms.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn data;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tvar formData = $forms.serializeArray();\n\n\t\t\t\t\t\t$.each(formData, function(z,f)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tdata.append(f.name, f.value);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn data;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tisRgb: function(str)\n\t\t\t\t{\n                    return (str.search(/^rgb/i) === 0);\n\t\t\t\t},\n\t\t\t\trgb2hex: function(rgb)\n\t\t\t\t{\n                    rgb = rgb.match(/^rgba?[\\s+]?\\([\\s+]?(\\d+)[\\s+]?,[\\s+]?(\\d+)[\\s+]?,[\\s+]?(\\d+)[\\s+]?/i);\n\n                    return (rgb && rgb.length === 4) ? \"#\" +\n                    (\"0\" + parseInt(rgb[1],10).toString(16)).slice(-2) +\n                    (\"0\" + parseInt(rgb[2],10).toString(16)).slice(-2) +\n                    (\"0\" + parseInt(rgb[3],10).toString(16)).slice(-2) : '';\n                },\n\n\t\t\t\t// #backward\n\t\t\t\tisCollapsed: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.selection.isCollapsed();\n\t\t\t\t},\n\t\t\t\tisMobile: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.detect.isMobile();\n\t\t\t\t},\n\t\t\t\tisDesktop: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.detect.isDesktop();\n\t\t\t\t},\n\t\t\t\tisPad: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.detect.isIpad();\n\t\t\t\t}\n\n\t\t\t};\n\t\t},\n\n\t\t// #backward\n\t\tbrowser: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\twebkit: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.detect.isWebkit();\n\t\t\t\t},\n\t\t\t\tff: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.detect.isFirefox();\n\t\t\t\t},\n\t\t\t\tie: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.detect.isIe();\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t};\n\n\t$(window).on('load.tools.redactor', function()\n\t{\n\t\t$('[data-tools=\"redactor\"]').redactor();\n\t});\n\n\t// constructor\n\tRedactor.prototype.init.prototype = Redactor.prototype;\n\n})(jQuery);\n\n(function($)\n{\n\t$.fn.redactorAnimation = function(animation, options, callback)\n\t{\n\t\treturn this.each(function()\n\t\t{\n\t\t\tnew redactorAnimation(this, animation, options, callback);\n\t\t});\n\t};\n\n\tfunction redactorAnimation(element, animation, options, callback)\n\t{\n\t\t// default\n\t\tvar opts = {\n\t\t\tduration: 0.5,\n\t\t\titerate: 1,\n\t\t\tdelay: 0,\n\t\t\tprefix: 'redactor-',\n\t\t\ttiming: 'linear'\n\t\t};\n\n\t\tthis.animation = animation;\n\t\tthis.slide = (this.animation === 'slideDown' || this.animation === 'slideUp');\n\t\tthis.$element = $(element);\n\t\tthis.prefixes = ['', '-moz-', '-o-animation-', '-webkit-'];\n\t\tthis.queue = [];\n\n\t\t// options or callback\n\t\tif (typeof options === 'function')\n\t\t{\n\t\t\tcallback = options;\n\t\t\tthis.opts = opts;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.opts = $.extend(opts, options);\n\t\t}\n\n\t\t// slide\n\t\tif (this.slide)\n\t\t{\n\t\t\tthis.$element.height(this.$element.height());\n\t\t}\n\n\t\t// init\n\t\tthis.init(callback);\n\n\t}\n\n\tredactorAnimation.prototype = {\n\n\t\tinit: function(callback)\n\t\t{\n\t\t\tthis.queue.push(this.animation);\n\n\t\t\tthis.clean();\n\n\t\t\tif (this.animation === 'show')\n\t\t\t{\n\t\t\t\tthis.opts.timing = 'linear';\n\t\t\t\tthis.$element.removeClass('hide').show();\n\n\t\t\t\tif (typeof callback === 'function')\n\t\t\t\t{\n\t\t\t\t\tcallback(this);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (this.animation === 'hide')\n\t\t\t{\n\t\t\t\tthis.opts.timing = 'linear';\n\t\t\t\tthis.$element.hide();\n\n\t\t\t\tif (typeof callback === 'function')\n\t\t\t\t{\n\t\t\t\t\tcallback(this);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis.animate(callback);\n\t\t\t}\n\n\t\t},\n\t\tanimate: function(callback)\n\t\t{\n\t\t\tthis.$element.addClass('redactor-animated').css('display', '').removeClass('hide');\n\t\t\tthis.$element.addClass(this.opts.prefix + this.queue[0]);\n\n\t\t\tthis.set(this.opts.duration + 's', this.opts.delay + 's', this.opts.iterate, this.opts.timing);\n\n\t\t\tvar _callback = (this.queue.length > 1) ? null : callback;\n\t\t\tthis.complete('AnimationEnd', $.proxy(function()\n\t\t\t{\n\t\t\t\tif (this.$element.hasClass(this.opts.prefix + this.queue[0]))\n\t\t\t\t{\n\t\t\t\t\tthis.clean();\n\t\t\t\t\tthis.queue.shift();\n\n\t\t\t\t\tif (this.queue.length)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.animate(callback);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t}, this), _callback);\n\t\t},\n\t\tset: function(duration, delay, iterate, timing)\n\t\t{\n\t\t\tvar len = this.prefixes.length;\n\n\t\t\twhile (len--)\n\t\t\t{\n\t\t\t\tthis.$element.css(this.prefixes[len] + 'animation-duration', duration);\n\t\t\t\tthis.$element.css(this.prefixes[len] + 'animation-delay', delay);\n\t\t\t\tthis.$element.css(this.prefixes[len] + 'animation-iteration-count', iterate);\n\t\t\t\tthis.$element.css(this.prefixes[len] + 'animation-timing-function', timing);\n\t\t\t}\n\n\t\t},\n\t\tclean: function()\n\t\t{\n\t\t\tthis.$element.removeClass('redactor-animated');\n\t\t\tthis.$element.removeClass(this.opts.prefix + this.queue[0]);\n\n\t\t\tthis.set('', '', '', '');\n\n\t\t},\n\t\tcomplete: function(type, make, callback)\n\t\t{\n\t\t\tthis.$element.one(type.toLowerCase() + ' webkit' + type + ' o' + type + ' MS' + type, $.proxy(function()\n\t\t\t{\n\t\t\t\tif (typeof make === 'function')\n\t\t\t\t{\n\t\t\t\t\tmake();\n\t\t\t\t}\n\n\t\t\t\tif (typeof callback === 'function')\n\t\t\t\t{\n\t\t\t\t\tcallback(this);\n\t\t\t\t}\n\n\t\t\t\t// hide\n\t\t\t\tvar effects = ['fadeOut', 'slideUp', 'zoomOut', 'slideOutUp', 'slideOutRight', 'slideOutLeft'];\n\t\t\t\tif ($.inArray(this.animation, effects) !== -1)\n\t\t\t\t{\n\t\t\t\t\tthis.$element.css('display', 'none');\n\t\t\t\t}\n\n\t\t\t\t// slide\n\t\t\t\tif (this.slide)\n\t\t\t\t{\n\t\t\t\t\tthis.$element.css('height', '');\n\t\t\t\t}\n\n\t\t\t}, this));\n\n\t\t}\n\t};\n\n})(jQuery);\n"]}