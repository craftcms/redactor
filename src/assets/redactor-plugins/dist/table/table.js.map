{"version":3,"sources":["table/table.js"],"names":["$R","add","translations","en","table","insert-table","insert-row-above","insert-row-below","insert-column-left","insert-column-right","add-head","delete-head","delete-column","delete-row","delete-table","init","app","this","lang","opts","caret","editor","toolbar","component","inspector","insertion","selection","ondropdown","observe","dropdown","_observeDropdown","onbottomclick","insertToEnd","getLastNode","start","title","get","api","classname","obj","$button","addButtonBefore","setIcon","setDropdown","insert","$component","create","i","addRow","insertHtml","setStart","addRowAbove","_getComponent","current","getCurrent","$row","addRowTo","addRowBelow","addColumnLeft","save","addColumnTo","restore","addColumnRight","addHead","deleteHead","dom","closest","length","removeHead","deleteColumn","$currentCell","nextCell","nextElement","prevCell","prevElement","removeColumn","setEnd","deleteTable","deleteRow","$currentRow","nextRow","prevRow","removeRow","_getTable","remove","data","parse","isTable","getTable","items","getItemsByClass","tableItem","getItem","_observeItems","disable","enable","type","Redactor","mixins","el","undefined","cmnt","_init","columns","$element","find","first","children","$head","_buildRow","append","prepend","_addRowTo","$current","index","each","node","origCell","$origCell","$td","clone","html","after","before","wrapper","element","$node","$figure","tagName","_buildWrapper","_buildElement","_initWrapper","position","$newRow","tag","$cell","attr","addClass","data-redactor-type","tabindex","contenteditable","detector","isIe","removeAttr"],"mappings":"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","file":"table.js","sourcesContent":["(function($R)\n{\n    $R.add('plugin', 'table', {\n        translations: {\n            en: {\n        \t\t\"table\": \"Table\",\n        \t\t\"insert-table\": \"Insert table\",\n        \t\t\"insert-row-above\": \"Insert row above\",\n        \t\t\"insert-row-below\": \"Insert row below\",\n        \t\t\"insert-column-left\": \"Insert column left\",\n        \t\t\"insert-column-right\": \"Insert column right\",\n        \t\t\"add-head\": \"Add head\",\n        \t\t\"delete-head\": \"Delete head\",\n        \t\t\"delete-column\": \"Delete column\",\n        \t\t\"delete-row\": \"Delete row\",\n        \t\t\"delete-table\": \"Delete table\"\n        \t}\n        },\n        init: function(app)\n        {\n            this.app = app;\n            this.lang = app.lang;\n            this.opts = app.opts;\n            this.caret = app.caret;\n            this.editor = app.editor;\n            this.toolbar = app.toolbar;\n            this.component = app.component;\n            this.inspector = app.inspector;\n            this.insertion = app.insertion;\n            this.selection = app.selection;\n        },\n        // messages\n        ondropdown: {\n            table: {\n                observe: function(dropdown)\n                {\n                    this._observeDropdown(dropdown);\n                }\n            }\n        },\n        onbottomclick: function()\n        {\n            this.insertion.insertToEnd(this.editor.getLastNode(), 'table');\n        },\n\n        // public\n        start: function()\n        {\n\t\t\tvar dropdown = {\n    \t\t\tobserve: 'table',\n    \t\t\t'insert-table': {\n    \t\t\t\ttitle: this.lang.get('insert-table'),\n    \t\t\t\tapi: 'plugin.table.insert'\n    \t\t\t},\n    \t\t\t'insert-row-above': {\n                    title: this.lang.get('insert-row-above'),\n    \t\t\t\tclassname: 'redactor-table-item-observable',\n                    api: 'plugin.table.addRowAbove'\n    \t\t\t},\n    \t\t\t'insert-row-below': {\n        \t\t\ttitle: this.lang.get('insert-row-below'),\n        \t\t\tclassname: 'redactor-table-item-observable',\n                    api: 'plugin.table.addRowBelow'\n    \t\t\t},\n    \t\t\t'insert-column-left': {\n        \t\t\ttitle: this.lang.get('insert-column-left'),\n        \t\t\tclassname: 'redactor-table-item-observable',\n                    api: 'plugin.table.addColumnLeft'\n    \t\t\t},\n    \t\t\t'insert-column-right': {\n        \t\t\ttitle: this.lang.get('insert-column-right'),\n        \t\t\tclassname: 'redactor-table-item-observable',\n                    api: 'plugin.table.addColumnRight'\n    \t\t\t},\n    \t\t\t'add-head': {\n        \t\t\ttitle: this.lang.get('add-head'),\n        \t\t\tclassname: 'redactor-table-item-observable',\n                    api: 'plugin.table.addHead'\n    \t\t\t},\n    \t\t\t'delete-head': {\n        \t\t\ttitle: this.lang.get('delete-head'),\n        \t\t\tclassname: 'redactor-table-item-observable',\n                    api: 'plugin.table.deleteHead'\n    \t\t\t},\n    \t\t\t'delete-column': {\n        \t\t\ttitle: this.lang.get('delete-column'),\n        \t\t\tclassname: 'redactor-table-item-observable',\n                    api: 'plugin.table.deleteColumn'\n    \t\t\t},\n    \t\t\t'delete-row': {\n        \t\t\ttitle: this.lang.get('delete-row'),\n        \t\t\tclassname: 'redactor-table-item-observable',\n                    api: 'plugin.table.deleteRow'\n    \t\t\t},\n    \t\t\t'delete-table': {\n        \t\t\ttitle: this.lang.get('delete-table'),\n        \t\t\tclassname: 'redactor-table-item-observable',\n                    api: 'plugin.table.deleteTable'\n    \t\t\t}\n\t\t\t};\n            var obj = {\n                title: this.lang.get('table')\n            };\n\n\t\t\tvar $button = this.toolbar.addButtonBefore('link', 'table', obj);\n\t\t\t$button.setIcon('<i class=\"re-icon-table\"></i>');\n\t\t\t$button.setDropdown(dropdown);\n        },\n\t\tinsert: function()\n\t\t{\n            var rows = 2;\n\t\t\tvar columns = 3;\n\t\t\tvar $component = this.component.create('table');\n\n\t\t\tfor (var i = 0; i < rows; i++)\n\t\t\t{\n\t\t\t    $component.addRow(columns);\n\t\t\t}\n\n\t\t\t$component =  this.insertion.insertHtml($component);\n\t\t\tthis.caret.setStart($component);\n\t\t},\n        addRowAbove: function()\n        {\n            var $component = this._getComponent();\n            if ($component)\n            {\n                var current = this.selection.getCurrent();\n                var $row = $component.addRowTo(current, 'before');\n\n                this.caret.setStart($row);\n            }\n        },\n        addRowBelow: function()\n        {\n            var $component = this._getComponent();\n            if ($component)\n            {\n                var current = this.selection.getCurrent();\n                var $row = $component.addRowTo(current, 'after');\n\n                this.caret.setStart($row);\n            }\n        },\n        addColumnLeft: function()\n        {\n            var $component = this._getComponent();\n            if ($component)\n            {\n                var current = this.selection.getCurrent();\n\n                this.selection.save();\n                $component.addColumnTo(current, 'left');\n                this.selection.restore();\n            }\n        },\n        addColumnRight: function()\n        {\n            var $component = this._getComponent();\n            if ($component)\n            {\n                var current = this.selection.getCurrent();\n\n                this.selection.save();\n                $component.addColumnTo(current, 'right');\n                this.selection.restore();\n            }\n        },\n        addHead: function()\n        {\n            var $component = this._getComponent();\n            if ($component)\n            {\n                this.selection.save();\n                $component.addHead();\n                this.selection.restore();\n            }\n        },\n        deleteHead: function()\n        {\n            var $component = this._getComponent();\n            if ($component)\n            {\n                var current = this.selection.getCurrent();\n                var $head = $R.dom(current).closest('thead');\n                if ($head.length !== 0)\n                {\n                    $component.removeHead();\n                    this.caret.setStart($component);\n                }\n                else\n                {\n                    this.selection.save();\n                    $component.removeHead();\n                    this.selection.restore();\n                }\n            }\n        },\n        deleteColumn: function()\n        {\n            var $component = this._getComponent();\n            if ($component)\n            {\n                var current = this.selection.getCurrent();\n\n                var $currentCell = $R.dom(current).closest('td, th');\n                var nextCell = $currentCell.nextElement().get();\n                var prevCell = $currentCell.prevElement().get();\n\n                $component.removeColumn(current);\n\n                if (nextCell) this.caret.setStart(nextCell);\n                else if (prevCell) this.caret.setEnd(prevCell);\n                else this.deleteTable();\n            }\n        },\n        deleteRow: function()\n        {\n            var $component = this._getComponent();\n            if ($component)\n            {\n                var current = this.selection.getCurrent();\n\n                var $currentRow = $R.dom(current).closest('tr');\n                var nextRow = $currentRow.nextElement().get();\n                var prevRow = $currentRow.prevElement().get();\n\n                $component.removeRow(current);\n\n                if (nextRow) this.caret.setStart(nextRow);\n                else if (prevRow) this.caret.setEnd(prevRow);\n                else this.deleteTable();\n            }\n        },\n        deleteTable: function()\n        {\n            var table = this._getTable();\n            if (table)\n            {\n                this.component.remove(table);\n            }\n        },\n\n        // private\n        _getTable: function()\n        {\n            var current = this.selection.getCurrent();\n            var data = this.inspector.parse(current);\n            if (data.isTable())\n            {\n                return data.getTable();\n            }\n        },\n        _getComponent: function()\n        {\n            var current = this.selection.getCurrent();\n            var data = this.inspector.parse(current);\n            if (data.isTable())\n            {\n                var table = data.getTable();\n\n                return this.component.create('table', table);\n            }\n        },\n        _observeDropdown: function(dropdown)\n        {\n            var table = this._getTable();\n            var items = dropdown.getItemsByClass('redactor-table-item-observable');\n            var tableItem = dropdown.getItem('insert-table');\n            if (table)\n            {\n                this._observeItems(items, 'enable');\n                tableItem.disable();\n            }\n            else\n            {\n                this._observeItems(items, 'disable');\n                tableItem.enable();\n            }\n        },\n        _observeItems: function(items, type)\n        {\n            for (var i = 0; i < items.length; i++)\n            {\n                items[i][type]();\n            }\n        }\n    });\n})(Redactor);\n(function($R)\n{\n    $R.add('class', 'table.component', {\n        mixins: ['dom', 'component'],\n        init: function(app, el)\n        {\n            this.app = app;\n\n            // init\n            return (el && el.cmnt !== undefined) ? el : this._init(el);\n        },\n\n        // public\n        addHead: function()\n        {\n\t\t\tthis.removeHead();\n\n\t\t\tvar columns = this.$element.find('tr').first().children('td, th').length;\n\t\t\tvar $head = $R.dom('<thead>');\n            var $row = this._buildRow(columns, '<th>');\n\n            $head.append($row);\n            this.$element.prepend($head);\n        },\n        addRow: function(columns)\n        {\n            var $row = this._buildRow(columns);\n            this.$element.append($row);\n\n            return $row;\n        },\n        addRowTo: function(current, type)\n        {\n            return this._addRowTo(current, type);\n        },\n        addColumnTo: function(current, type)\n        {\n            var $current = $R.dom(current);\n            var $currentRow = $current.closest('tr');\n            var $currentCell = $current.closest('td, th');\n\n            var index = 0;\n            $currentRow.find('td, th').each(function(node, i)\n\t\t\t{\n\t\t\t\tif (node === $currentCell.get()) index = i;\n\t\t\t});\n\n\t\t\tthis.$element.find('tr').each(function(node)\n\t\t\t{\n    \t\t\tvar $node = $R.dom(node);\n\t\t\t\tvar origCell = $node.find('td, th').get(index);\n\t\t\t\tvar $origCell = $R.dom(origCell);\n\n\t\t\t\tvar $td = $origCell.clone();\n\t\t\t\t$td.html('<div data-redactor-tag=\"tbr\"></div>');\n\n\t\t\t\tif (type === 'right') $origCell.after($td);\n\t\t\t\telse                  $origCell.before($td);\n\t\t\t});\n        },\n        removeHead: function()\n        {\n\t\t\tvar $head = this.$element.find('thead');\n\t\t\tif ($head.length !== 0) $head.remove();\n        },\n        removeRow: function(current)\n        {\n            var $current = $R.dom(current);\n            var $currentRow = $current.closest('tr');\n\n            $currentRow.remove();\n        },\n        removeColumn: function(current)\n        {\n            var $current = $R.dom(current);\n            var $currentRow = $current.closest('tr');\n            var $currentCell = $current.closest('td, th');\n\n            var index = 0;\n            $currentRow.find('td, th').each(function(node, i)\n\t\t\t{\n\t\t\t\tif (node === $currentCell.get()) index = i;\n\t\t\t});\n\n\t\t\tthis.$element.find('tr').each(function(node)\n\t\t\t{\n    \t\t\tvar $node = $R.dom(node);\n\t\t\t\tvar origCell = $node.find('td, th').get(index);\n\t\t\t\tvar $origCell = $R.dom(origCell);\n\n\t\t\t\t$origCell.remove();\n\t\t\t});\n        },\n\n        // private\n        _init: function(el)\n        {\n            var wrapper, element;\n            if (typeof el !== 'undefined')\n            {\n                var $node = $R.dom(el);\n                var node = $node.get();\n                var $figure = $node.closest('figure');\n                if ($figure.length !== 0)\n                {\n                    wrapper = $figure;\n                    element = $figure.find('table').get();\n                }\n                else if (node.tagName === 'TABLE')\n                {\n                    element = node;\n                }\n            }\n\n            this._buildWrapper(wrapper);\n            this._buildElement(element);\n            this._initWrapper();\n        },\n        _addRowTo: function(current, position)\n        {\n            var $current = $R.dom(current);\n            var $currentRow = $current.closest('tr');\n            if ($currentRow.length !== 0)\n            {\n                var columns = $currentRow.children('td, th').length;\n                var $newRow = this._buildRow(columns);\n\n                $currentRow[position]($newRow);\n\n                return $newRow;\n            }\n        },\n        _buildRow: function(columns, tag)\n        {\n            tag = tag || '<td>';\n\n            var $row = $R.dom('<tr>');\n            for (var i = 0; i < columns; i++)\n            {\n                var $cell = $R.dom(tag);\n                $cell.attr('contenteditable', true);\n                $cell.html('<div data-redactor-tag=\"tbr\"></div>');\n\n                $row.append($cell);\n            }\n\n            return $row;\n        },\n        _buildElement: function(node)\n        {\n            if (node)\n            {\n                this.$element = $R.dom(node);\n            }\n            else\n            {\n                this.$element = $R.dom('<table>');\n                this.append(this.$element);\n            }\n        },\n        _buildWrapper: function(node)\n        {\n            node = node || '<figure>';\n\n            this.parse(node);\n        },\n        _initWrapper: function()\n        {\n            this.addClass('redactor-component');\n            this.attr({\n                'data-redactor-type': 'table',\n                'tabindex': '-1',\n                'contenteditable': false\n            });\n\n            if (this.app.detector.isIe())\n            {\n                this.removeAttr('contenteditable');\n            }\n        }\n    });\n\n})(Redactor);"]}