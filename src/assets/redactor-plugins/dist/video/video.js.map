{"version":3,"sources":["video/video.js"],"names":["Redactor","add","translations","en","video","video-html-code","modals","init","app","this","lang","opts","toolbar","component","insertion","inspector","selection","onmodal","opened","$modal","$form","$video","getField","focus","insert","data","getData","_insert","oncontextbar","e","contextbar","parse","target","isComponentType","node","getComponent","buttons","remove","title","get","api","args","set","start","obj","addButtonAfter","setIcon","open","options","width","name","handle","commands","cancel","trim","_matchData","_isVideoIframe","create","insertHtml","match","iframeStart","iframeEnd","allowed","replace","$0","$1","indexOf","toLowerCase","regex","youtube","yturl","search","vimeo"],"mappings":"AA4JGA,SA1JIC,IAAI,SAAU,QAAS,CACtBC,aAAc,CACVC,GAAI,CACAC,MAAS,QACTC,kBAAmB,2CAG3BC,OAAQ,CACJF,MACI,iTAORG,KAAM,SAASC,GAEXC,KAAKD,IAAMA,EACXC,KAAKC,KAAOF,EAAIE,KAChBD,KAAKE,KAAOH,EAAIG,KAChBF,KAAKG,QAAUJ,EAAII,QACnBH,KAAKI,UAAYL,EAAIK,UACrBJ,KAAKK,UAAYN,EAAIM,UACrBL,KAAKM,UAAYP,EAAIO,UACrBN,KAAKO,UAAYR,EAAIQ,WAGzBC,QAAS,CACLb,MAAO,CACHc,OAAQ,SAASC,EAAQC,GAErBC,OAASD,EAAME,SAAS,SACxBD,OAAOE,SAEXC,OAAQ,SAASL,EAAQC,GAErB,IAAIK,EAAOL,EAAMM,UACjBjB,KAAKkB,QAAQF,MAIzBG,aAAc,SAASC,EAAGC,GAEtB,IAAIL,EAAOhB,KAAKM,UAAUgB,MAAMF,EAAEG,QAClC,GAAIP,EAAKQ,gBAAgB,SACzB,CACI,IAAIC,EAAOT,EAAKU,eACZC,EAAU,CACVC,OAAU,CACNC,MAAO7B,KAAKC,KAAK6B,IAAI,UACrBC,IAAK,sBACLC,KAAMP,IAIdJ,EAAWY,IAAIb,EAAGK,EAAME,EAAS,YAMzCO,MAAO,WAEH,IAAIC,EAAM,CACNN,MAAO7B,KAAKC,KAAK6B,IAAI,SACrBC,IAAK,qBAGK/B,KAAKG,QAAQiC,eAAe,QAAS,QAASD,GACpDE,QAAQ,kCAEpBC,KAAM,WAEF,IAAIC,EAAU,CACVV,MAAO7B,KAAKC,KAAK6B,IAAI,SACrBU,MAAO,QACPC,KAAM,QACNC,OAAQ,SACRC,SAAU,CACN5B,OAAQ,CAAEc,MAAO7B,KAAKC,KAAK6B,IAAI,WAC/Bc,OAAQ,CAAEf,MAAO7B,KAAKC,KAAK6B,IAAI,aAIvC9B,KAAKD,IAAIgC,IAAI,qBAAsBQ,IAEvCX,OAAQ,SAASH,GAEbzB,KAAKI,UAAUwB,OAAOH,IAIhCP,QAAS,SAASF,GAId,GAFAhB,KAAKD,IAAIgC,IAAI,sBAEa,KAAtBf,EAAKrB,MAAMkD,SAMT7B,EAAKrB,MAAQK,KAAK8C,WAAW9B,EAAKrB,OAG9BK,KAAK+C,eAAe/B,EAAKrB,QAC7B,CACI,IAAIiB,EAASZ,KAAKI,UAAU4C,OAAO,QAAShC,EAAKrB,OACjDK,KAAKK,UAAU4C,WAAWrC,KAIxCmC,eAAgB,SAAS/B,GAEf,OAA2C,OAAnCA,EAAKkC,MAAM,qBAE7BJ,WAAY,SAAS9B,GAEpB,IAAImC,EAAc,qDACdC,EAAY,8CAEP,GAAIpD,KAAK+C,eAAe/B,GACjC,CACC,IAAIqC,EAAU,CAAC,SAAU,QAAS,UAI/BrC,GADSA,EAAOA,EAAKsC,QAAQ,iCAAkC,KACnDA,QAHJ,kCAGkB,SAAUC,EAAIC,GAEpC,OAA+C,IAAvCH,EAAQI,QAAQD,EAAGE,eAAyB,GAAKH,UAK7D,GAAIvC,EAAKkC,MAAMlD,KAAKE,KAAKyD,MAAMC,SAC/B,CACa,IAAIC,EAAQ,qBACiC,IAAzC7C,EAAK8C,OAAO,0BACZD,EAAQ,8BAExB7C,EAAOA,EAAKsC,QAAQtD,KAAKE,KAAKyD,MAAMC,QAAST,EAAcU,EAAQ,YAAcT,QAEzEpC,EAAKkC,MAAMlD,KAAKE,KAAKyD,MAAMI,SAGnC/C,EAAOA,EAAKsC,QAAQtD,KAAKE,KAAKyD,MAAMI,MAAOZ,EAAc,8BAAgCC,IAK9F,OAAOpC","file":"video.js","sourcesContent":["(function($R)\n{\n    $R.add('plugin', 'video', {\n        translations: {\n            en: {\n                \"video\": \"Video\",\n                \"video-html-code\": \"Video Embed Code or Youtube/Vimeo Link\"\n            }\n        },\n        modals: {\n            'video':\n                '<form action=\"\"> \\\n                    <div class=\"form-item\"> \\\n                        <label for=\"modal-video-input\">## video-html-code ##</label> \\\n                        <textarea id=\"modal-video-input\" name=\"video\" style=\"height: 160px;\"></textarea> \\\n                    </div> \\\n                </form>'\n        },\n        init: function(app)\n        {\n            this.app = app;\n            this.lang = app.lang;\n            this.opts = app.opts;\n            this.toolbar = app.toolbar;\n            this.component = app.component;\n            this.insertion = app.insertion;\n            this.inspector = app.inspector;\n            this.selection = app.selection;\n        },\n        // messages\n        onmodal: {\n            video: {\n                opened: function($modal, $form)\n                {\n                    $video = $form.getField('video');\n                    $video.focus();\n                },\n                insert: function($modal, $form)\n                {\n                    var data = $form.getData();\n                    this._insert(data);\n                }\n            }\n        },\n        oncontextbar: function(e, contextbar)\n        {\n            var data = this.inspector.parse(e.target)\n            if (data.isComponentType('video'))\n            {\n                var node = data.getComponent();\n                var buttons = {\n                    \"remove\": {\n                        title: this.lang.get('delete'),\n                        api: 'plugin.video.remove',\n                        args: node\n                    }\n                };\n\n                contextbar.set(e, node, buttons, 'bottom');\n            }\n\n        },\n\n        // public\n        start: function()\n        {\n            var obj = {\n                title: this.lang.get('video'),\n                api: 'plugin.video.open'\n            };\n\n            var $button = this.toolbar.addButtonAfter('image', 'video', obj);\n            $button.setIcon('<i class=\"re-icon-video\"></i>');\n        },\n        open: function()\n\t\t{\n            var options = {\n                title: this.lang.get('video'),\n                width: '600px',\n                name: 'video',\n                handle: 'insert',\n                commands: {\n                    insert: { title: this.lang.get('insert') },\n                    cancel: { title: this.lang.get('cancel') }\n                }\n            };\n\n            this.app.api('module.modal.build', options);\n\t\t},\n        remove: function(node)\n        {\n            this.component.remove(node);\n        },\n\n        // private\n\t\t_insert: function(data)\n\t\t{\n    \t\tthis.app.api('module.modal.close');\n\n    \t\tif (data.video.trim() === '')\n    \t\t{\n        \t    return;\n    \t\t}\n\n            // parsing\n            data.video = this._matchData(data.video);\n\n            // inserting\n            if (this._isVideoIframe(data.video))\n            {\n                var $video = this.component.create('video', data.video);\n                this.insertion.insertHtml($video);\n            }\n\t\t},\n\n\t\t_isVideoIframe: function(data)\n\t\t{\n            return (data.match(/<iframe|<video/gi) !== null);\n\t\t},\n\t\t_matchData: function(data)\n\t\t{\n\t\t\tvar iframeStart = '<iframe style=\"width: 500px; height: 281px;\" src=\"';\n\t\t\tvar iframeEnd = '\" frameborder=\"0\" allowfullscreen></iframe>';\n\n            if (this._isVideoIframe(data))\n\t\t\t{\n\t\t\t\tvar allowed = ['iframe', 'video', 'source'];\n\t\t\t\tvar tags = /<\\/?([a-z][a-z0-9]*)\\b[^>]*>/gi;\n\n                data = data.replace(/<p(.*?[^>]?)>([\\w\\W]*?)<\\/p>/gi, '');\n\t\t\t    data = data.replace(tags, function ($0, $1)\n\t\t\t    {\n\t\t\t        return (allowed.indexOf($1.toLowerCase()) === -1) ? '' : $0;\n\t\t\t    });\n\t\t\t}\n            else\n            {\n    \t\t\tif (data.match(this.opts.regex.youtube))\n    \t\t\t{\n                    var yturl = '//www.youtube.com';\n                    if (data.search('youtube-nocookie.com') !== -1) {\n                        yturl = '//www.youtube-nocookie.com';\n                    }\n    \t\t\t\tdata = data.replace(this.opts.regex.youtube, iframeStart + yturl + '/embed/$1' + iframeEnd);\n    \t\t\t}\n    \t\t\telse if (data.match(this.opts.regex.vimeo))\n    \t\t\t{\n\n    \t\t\t\tdata = data.replace(this.opts.regex.vimeo, iframeStart + '//player.vimeo.com/video/$2' + iframeEnd);\n    \t\t\t}\n\t\t\t}\n\n\n\t\t\treturn data;\n\t\t}\n    });\n})(Redactor);"]}