{"version":3,"file":"RedactorOverrides.js","mappings":"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","sources":["webpack:///./js/RedactorOverrides.js"],"sourcesContent":["// Adjust the positioning of image resizer\n// =============================================================================\n\nvar imageResizeClass = $R['classes']['image.resize'];\n\nimageResizeClass.prototype.init = function (app) {\n  this.app = app;\n  this.$doc = app.$doc;\n  this.$win = app.$win;\n  this.$body = app.$body;\n  this.editor = app.editor;\n  this.toolbar = app.toolbar;\n  this.inspector = app.inspector;\n\n  // init\n  this.$target = this.toolbar.isTarget()\n    ? this.toolbar.getTargetElement()\n    : this.$body;\n\n  // Change the target according to LP\n  var attachLivePreview = () => {\n    this.hide();\n    var $editor = $('.lp-editor');\n    if ($editor.length) {\n      this.$target = $R.dom($editor[0]);\n    }\n  };\n\n  var detachLivePreview = () => {\n    this.hide();\n    this.$target = this.toolbar.isTarget()\n      ? this.toolbar.getTargetElement()\n      : this.$body;\n  };\n\n  attachPreviewListeners(attachLivePreview, detachLivePreview);\n\n  this._init();\n};\n// Position the image resizer correctly\nimageResizeClass.prototype._setResizerPosition = function () {\n  if (this.$resizer) {\n    var isTarget = this.toolbar.isTarget();\n    var targetOffset = this.$target.offset();\n    var offsetFix = 7;\n    var topOffset = isTarget\n      ? offsetFix - targetOffset.top + this.$target.scrollTop()\n      : offsetFix;\n    var leftOffset = isTarget ? offsetFix - targetOffset.left : offsetFix;\n    var pos = this.$resizableImage.offset();\n    var width = this.$resizableImage.width();\n    var height = this.$resizableImage.height();\n    var resizerWidth = this.$resizer.width();\n    var resizerHeight = this.$resizer.height();\n\n    this.$resizer.css({\n      top: Math.round(pos.top + height - resizerHeight + topOffset) + 'px',\n      left: Math.round(pos.left + width - resizerWidth + leftOffset) + 'px',\n    });\n  }\n};\n\n// When scrolling, reposition the resizer\nimageResizeClass.prototype._build = function (e) {\n  this.$target.find('#redactor-image-resizer').remove();\n\n  var data = this.inspector.parse(e.target);\n  var $editor = this.editor.getElement();\n\n  if (data.isComponentType('image')) {\n    this.$resizableBox = $editor;\n    this.$resizableImage = $R.dom(data.getImageElement());\n\n    this.$resizer = $R.dom('<span>');\n    this.$resizer.attr('id', 'redactor-image-resizer');\n    this.$resizer.css({'z-index': 100});\n\n    this.$target.append(this.$resizer);\n\n    this._setResizerPosition();\n    this.$resizer.on('mousedown touchstart', this._set.bind(this));\n  }\n};\n// Stop listening to scroll\nimageResizeClass.prototype.hide = function () {\n  this.$target.find('#redactor-image-resizer').remove();\n  if (this.toolbar.isTarget()) {\n    this.$target.off('scroll.resizer', this.rebuild.bind(this));\n  } else {\n    $R.dom('#content-container').off('scroll.resizer', this.rebuild.bind(this));\n  }\n};\n\n// Adjust the positioning of fixed toolbar\n// =============================================================================\n\nvar toolbarFixedClass = $R['classes']['toolbar.fixed'];\n\ntoolbarFixedClass.prototype.livePreview = false;\ntoolbarFixedClass.prototype.$previousFixedTarget = false;\n\ntoolbarFixedClass.prototype._init = function () {\n  this.$fixedTarget = this.toolbar.isTarget()\n    ? this.toolbar.getTargetElement()\n    : this.$win;\n  this._doFixed();\n\n  if (this.toolbar.isTarget()) {\n    this.$win.on(\n      'scroll.redactor-toolbar-' + this.uuid,\n      this._doFixed.bind(this)\n    );\n    this.$win.on(\n      'resize.redactor-toolbar-' + this.uuid,\n      this._doFixed.bind(this)\n    );\n  }\n\n  this.$fixedTarget.on(\n    'scroll.redactor-toolbar-' + this.uuid,\n    this._doFixed.bind(this)\n  );\n  this.$fixedTarget.on(\n    'resize.redactor-toolbar-' + this.uuid,\n    this._doFixed.bind(this)\n  );\n\n  var attachLivePreview = () => {\n    var $editor = $('.lp-editor');\n    if ($editor.length) {\n      this.livePreview = true;\n      this.$previousFixedTarget = this.$fixedTarget;\n      $editor = $R.dom($editor[0]);\n      $editor.on(\n        'scroll.redactor-toolbar-' + this.uuid,\n        this._doFixed.bind(this)\n      );\n      this.$fixedTarget = $editor;\n    }\n  };\n\n  var detachLivePreview = () => {\n    this.livePreview = false;\n    this.$fixedTarget = this.$previousFixedTarget;\n    this.$previousFixedTarget = null;\n  };\n\n  attachPreviewListeners(attachLivePreview, detachLivePreview);\n};\n\ntoolbarFixedClass.prototype._doFixed = function () {\n  var $editor = this.editor.getElement();\n  var $container = this.container.getElement();\n  var $toolbar = this.toolbar.getElement();\n  var $wrapper = this.toolbar.getWrapper();\n\n  if (this.editor.isSourceMode()) {\n    return;\n  }\n\n  var $targets = $container.parents().filter(function (node) {\n    return getComputedStyle(node, null).display === 'none' ? node : false;\n  });\n\n  // has hidden parent\n  if ($targets.length !== 0) return;\n\n  var isHeight = $editor.height() < 100;\n  var isEmpty = this.editor.isEmpty();\n\n  if (isHeight || isEmpty) {\n    this.reset();\n    return;\n  }\n\n  var toolbarHeight = $toolbar.height();\n\n  var pinIt = false;\n  var pinDistance = 0;\n  var tolerance = 20;\n\n  if (this.livePreview) {\n    var headerBuffer = $('.lp-editor-container header.flex').length\n      ? $('.lp-editor-container header.flex').outerHeight()\n      : 0;\n    var distanceFromScreenTop = $editor.offset().top - headerBuffer;\n    var bottomFromScreenTop =\n      distanceFromScreenTop + $editor.height() - toolbarHeight;\n  } else {\n    var headerBuffer = $('body.fixed-header #header').length\n      ? $('body.fixed-header #header').outerHeight()\n      : 0;\n    var distanceFromScreenTop =\n      $editor.offset().top - this.$win.scrollTop() - headerBuffer;\n    var bottomFromScreenTop =\n      distanceFromScreenTop + $editor.height() - toolbarHeight;\n  }\n\n  pinIt = distanceFromScreenTop + tolerance < 0 && bottomFromScreenTop > 0;\n  pinDistance = $editor.scrollTop() + headerBuffer;\n\n  // Figure out when to pin the toolbar\n\n  if (pinIt) {\n    var position = this.detector.isDesktop() ? 'fixed' : 'absolute';\n    pinDistance = this.detector.isDesktop()\n      ? pinDistance\n      : scrollOffset - boxOffset + this.opts.toolbarFixedTopOffset;\n\n    if (this.detector.isMobile()) {\n      if (this.fixedScrollTimeout) {\n        clearTimeout(this.fixedScrollTimeout);\n      }\n\n      $toolbar.hide();\n      this.fixedScrollTimeout = setTimeout(function () {\n        $toolbar.show();\n      }, 250);\n    }\n\n    $wrapper.height(toolbarHeight);\n    $toolbar.addClass('redactor-toolbar-fixed');\n    $toolbar.css({\n      position: position,\n      top: pinDistance + this.opts.toolbarFixedTopOffset + 'px',\n      width: $container.width() + 'px',\n    });\n\n    var dropdown = this.toolbar.getDropdown();\n\n    if (dropdown) {\n      dropdown.updatePosition();\n    }\n\n    this.app.broadcast('toolbar.fixed');\n  } else {\n    this.reset();\n    this.app.broadcast('toolbar.unfixed');\n  }\n};\n\nvar inputCleanerService = $R['services']['cleaner'];\n\ninputCleanerService.prototype.input = function (html, paragraphize, started) {\n  // fix &curren; entity in the links\n  html = html.replace(/Â¤t/gi, '&current');\n\n  // store\n  var storedComments = [];\n  html = this.storeComments(html, storedComments);\n\n  // pre/code\n  html = this.encodeCode(html);\n\n  // sanitize\n  var $wrapper = this.utils.buildWrapper(html);\n  $wrapper\n    .find('a, b, i, strong, em, img, svg, details, audio')\n    .removeAttr('onload onerror ontoggle onwheel onmouseover oncopy');\n  $wrapper.find('a, iframe, embed').each(function (node) {\n    var $node = $R.dom(node);\n    var href = $node.attr('href');\n    var src = $node.attr('src');\n    if (href && href.trim().search(/^data|javascript:/i) !== -1)\n      $node.attr('href', '');\n    if (src && src.trim().search(/^data|javascript:/i) !== -1)\n      $node.attr('src', '');\n  });\n\n  var imageattrs = [\n    'alt',\n    'title',\n    'src',\n    'class',\n    'width',\n    'height',\n    'srcset',\n    'usemap',\n  ];\n  $wrapper.find('img').each(\n    function (node) {\n      if (node.attributes.length > 0) {\n        var attrs = node.attributes;\n        for (var i = attrs.length - 1; i >= 0; i--) {\n          var removeAttrs =\n            attrs[i].name.search(/^data-/) === -1 &&\n            imageattrs.indexOf(attrs[i].name) === -1;\n          var removeDataSrc =\n            attrs[i].name === 'src' &&\n            attrs[i].value.search(/^data|javascript:/i) !== -1;\n          if (this.opts.imageSrcData) removeDataSrc = false;\n\n          if (removeAttrs || removeDataSrc) {\n            node.removeAttribute(attrs[i].name);\n          }\n        }\n      }\n    }.bind(this)\n  );\n\n  // get wrapper html\n  html = this.utils.getWrapperHtml($wrapper);\n\n  // converting entity\n  html = html.replace(/\\$/g, '&#36;');\n  html = html.replace(/&amp;/g, '&');\n\n  // convert to figure\n  var converter = $R.create('cleaner.figure', this.app);\n  html = converter.convert(html, this.convertRules);\n\n  // store components\n  html = this.storeComponents(html);\n\n  // clean\n  html = this.replaceTags(html, this.opts.replaceTags);\n  html = this._setSpanAttr(html);\n  html = this._setStyleCache(html);\n  html = this.removeTags(html, this.deniedTags);\n  html = this.opts.removeScript\n    ? this._removeScriptTag(html)\n    : this._replaceScriptTag(html);\n  //html = (this.opts.removeScript) ? this._removeScriptTag(html) : html;\n  html = this.opts.removeComments ? this.removeComments(html) : html;\n  html = this._isSpacedEmpty(html) ? this.opts.emptyHtml : html;\n\n  // restore components\n  html = this.restoreComponents(html);\n\n  // clear wrapped components\n  html = this._cleanWrapped(html);\n\n  // restore comments\n  html = this.restoreComments(html, storedComments);\n\n  // paragraphize\n  html = paragraphize ? this.paragraphize(html) : html;\n\n  return html;\n};\n\ninputCleanerService.prototype.output = function (html, removeMarkers) {\n  html = this.removeInvisibleSpaces(html);\n\n  if (this.opts.breakline) {\n    html = html.replace(\n      /<\\/(span|strong|b|i|em)><br\\s?\\/?><\\/div>/gi,\n      '</$1></div>'\n    );\n    html = html.replace(\n      /<br\\s?\\/?><\\/(span|strong|b|i|em)><\\/div>/gi,\n      '</$1></div>'\n    );\n  }\n\n  html = html.replace(/&#36;/g, '$');\n\n  // empty\n  if (this._isSpacedEmpty(html)) return '';\n  if (this._isParagraphEmpty(html)) return '';\n\n  html = this.removeServiceTagsAndAttrs(html, removeMarkers);\n\n  // store components\n  html = this.storeComponents(html);\n\n  html = this.removeSpanWithoutAttributes(html);\n  html = this.removeFirstBlockBreaklineInHtml(html);\n\n  html = this.opts.removeScript ? html : this._unreplaceScriptTag(html);\n  html = this.opts.preClass ? this._setPreClass(html) : html;\n  html = this.opts.linkNofollow ? this._setLinkNofollow(html) : html;\n  html = this.opts.removeNewLines ? this.cleanNewLines(html) : html;\n\n  // restore components\n  html = this.restoreComponents(html);\n\n  // convert to figure\n  var converter = $R.create('cleaner.figure', this.app);\n  html = converter.unconvert(html, this.unconvertRules);\n\n  // final clean up\n  html = this.removeEmptyAttributes(html, ['style', 'class', 'rel', 'title']);\n  html = this.cleanSpacesInPre(html);\n  html = this.tidy(html);\n\n  // converting entity\n  html = html.replace(/&amp;/g, '&');\n\n  // breakline tidy\n  if (this.opts.breakline) {\n    html = html.replace(/<br\\s?\\/?>/gi, '<br>\\n');\n    html = html.replace(/<br\\s?\\/?>\\n+/gi, '<br>\\n');\n  }\n\n  // check whitespaces\n  html = html.replace(/\\n/g, '') === '' ? '' : html;\n\n  return html;\n};\n\nvar toolbarDropdownClass = $R['classes']['toolbar.dropdown'];\n\ntoolbarDropdownClass.prototype.updatePosition = function () {\n  var isFixed = this.toolbar.isFixed();\n  var isTarget = this.toolbar.isTarget();\n\n  var btnHeight = this.$btn.height();\n  var btnWidth = this.$btn.width();\n\n  var pos = this.$btn.offset();\n  var position = 'absolute';\n  var topOffset = 2;\n\n  if (isFixed) {\n    pos.top = isTarget ? this.$btn.offset().top : this.$btn.position().top;\n    position = 'fixed';\n    topOffset = topOffset + this.opts.toolbarFixedTopOffset;\n  }\n\n  var leftOffset = 0;\n  var left = pos.left + leftOffset;\n  var width = parseFloat(this.css('width'));\n  var winWidth = this.$win.width();\n  var leftFix = winWidth < left + width ? width - btnWidth : 0;\n  var leftPos = left - leftFix;\n  var top = pos.top + btnHeight + topOffset;\n\n  if (isFixed) {\n    var toolbarElement = this.toolbar.getElement();\n    top = toolbarElement.position().top + toolbarElement.height();\n  }\n\n  leftPos = leftPos < 0 ? 4 : leftPos;\n\n  this.css({\n    maxHeight: '',\n    position: position,\n    top: top + 'px',\n    left: leftPos + 'px',\n  });\n\n  // height adaptive\n  var heightTolerance = 10;\n  var winHeight = this.$win.height();\n  var scrollTop = this.$doc.scrollTop();\n  var cropHeight = winHeight - (top - scrollTop) - heightTolerance;\n\n  this.css('max-height', cropHeight + 'px');\n};\n\nvar contextBarClass = $R['modules']['contextbar'];\n\ncontextBarClass.prototype.init = function (app) {\n  this.app = app;\n  this.opts = app.opts;\n  this.uuid = app.uuid;\n  this.$win = app.$win;\n  this.$doc = app.$doc;\n  this.$body = app.$body;\n  this.editor = app.editor;\n  this.toolbar = app.toolbar;\n  this.detector = app.detector;\n  this.livePreview = false;\n\n  // local\n  this.$target = this.toolbar.isTarget()\n    ? this.toolbar.getTargetElement()\n    : this.$body;\n\n  // Change the target according to LP\n  var attachLivePreview = () => {\n    var $target = $('.lp-editor');\n    if ($target.length) {\n      $(this.$contextbar.get()).appendTo($target);\n      this.livePreview = true;\n    }\n  };\n\n  var detachLivePreview = () => {\n    var $target = this.toolbar.getTargetElement();\n    if ($target.length) {\n      $(this.$contextbar.get(0)).appendTo($target.get(0));\n    }\n    this.livePreview = false;\n  };\n\n  attachPreviewListeners(attachLivePreview, detachLivePreview);\n};\n\ncontextBarClass.prototype.close = function (e) {\n  if (\n    !this.$contextbar ||\n    !this.$contextbar.nodes.length ||\n    this.$contextbar.nodes[0].style.display === 'none'\n  ) {\n    return;\n  }\n\n  if (e) {\n    var $target = $R.dom(e.target);\n    if (this.$el && $target.closest(this.$el).length !== 0) {\n      return;\n    }\n  }\n\n  this.$contextbar.hide();\n  this.$contextbar.removeClass('open');\n  this.$doc.off('.redactor.context');\n  this.app.broadcast('hardsync');\n};\n\nvar toolbarService = $R['services']['toolbar'];\n\ntoolbarService.prototype.addButton = function (\n  name,\n  btnObj,\n  position,\n  $el,\n  start\n) {\n  position = position || 'end';\n\n  var $button = $R.create('toolbar.button', this.app, name, btnObj);\n  if (btnObj.observe) {\n    this.opts.activeButtonsObservers[name] = {\n      observe: btnObj.observe,\n      button: $button,\n    };\n  }\n\n  if (this.is()) {\n    if (position === 'first') this.$toolbar.prepend($button);\n    else if (position === 'after') $el.after($button);\n    else if (position === 'before') $el.before($button);\n    else {\n      var index = this.opts.buttons.indexOf(name);\n\n      if (start !== true && index !== -1) {\n        if (index === 0) {\n          this.$toolbar.prepend($button);\n        } else {\n          var $btns = this._findButtons();\n\n          // If this was an added button, it might not exist in the options with how things are, so make sure to stay inside bounds\n          var $btn = $btns.eq(Math.min(index, $btns.length) - 1);\n          $btn.after($button);\n        }\n      } else {\n        this.$toolbar.append($button);\n      }\n    }\n  }\n\n  return $button;\n};\n\nfunction attachPreviewListeners(openCallback, closeCallback) {\n  Garnish.on(Craft.Preview, 'open', openCallback);\n  Garnish.on(Craft.LivePreview, 'enter', openCallback);\n\n  Garnish.on(Craft.Preview, 'close', closeCallback);\n  Garnish.on(Craft.LivePreview, 'exit', closeCallback);\n}\n\nwindow.imageResizeClass = imageResizeClass;\nwindow.toolbarFixedClass = toolbarFixedClass;\nwindow.inputCleanerService = inputCleanerService;\nwindow.toolbarDropdownClass = toolbarDropdownClass;\nwindow.contextBarClass = contextBarClass;\nwindow.toolbarDropdownClass = toolbarDropdownClass;\nwindow.toolbarService = toolbarService;\n"],"names":["imageResizeClass","$R","prototype","init","app","this","$doc","$win","$body","editor","toolbar","inspector","$target","isTarget","getTargetElement","attachPreviewListeners","hide","$editor","$","length","dom","_init","_setResizerPosition","$resizer","targetOffset","offset","topOffset","top","scrollTop","leftOffset","left","pos","$resizableImage","width","height","resizerWidth","resizerHeight","css","Math","round","_build","e","find","remove","data","parse","target","getElement","isComponentType","$resizableBox","getImageElement","attr","append","on","_set","bind","off","rebuild","toolbarFixedClass","livePreview","$previousFixedTarget","$fixedTarget","_doFixed","uuid","$container","container","$toolbar","$wrapper","getWrapper","isSourceMode","parents","filter","node","getComputedStyle","display","isHeight","isEmpty","reset","pinIt","distanceFromScreenTop","toolbarHeight","pinDistance","headerBuffer","outerHeight","bottomFromScreenTop","position","detector","isDesktop","scrollOffset","boxOffset","opts","toolbarFixedTopOffset","isMobile","fixedScrollTimeout","clearTimeout","setTimeout","show","addClass","dropdown","getDropdown","updatePosition","broadcast","inputCleanerService","input","html","paragraphize","started","replace","storedComments","storeComments","encodeCode","utils","buildWrapper","removeAttr","each","$node","href","src","trim","search","imageattrs","attributes","attrs","i","removeAttrs","name","indexOf","removeDataSrc","value","imageSrcData","removeAttribute","getWrapperHtml","create","convert","convertRules","storeComponents","replaceTags","_setSpanAttr","_setStyleCache","removeTags","deniedTags","removeScript","_removeScriptTag","_replaceScriptTag","removeComments","_isSpacedEmpty","emptyHtml","restoreComponents","_cleanWrapped","restoreComments","output","removeMarkers","removeInvisibleSpaces","breakline","_isParagraphEmpty","removeServiceTagsAndAttrs","removeSpanWithoutAttributes","removeFirstBlockBreaklineInHtml","_unreplaceScriptTag","preClass","_setPreClass","linkNofollow","_setLinkNofollow","removeNewLines","cleanNewLines","unconvert","unconvertRules","removeEmptyAttributes","cleanSpacesInPre","tidy","toolbarDropdownClass","isFixed","btnHeight","$btn","btnWidth","parseFloat","leftPos","toolbarElement","maxHeight","cropHeight","contextBarClass","$contextbar","get","appendTo","close","nodes","style","$el","closest","removeClass","toolbarService","openCallback","closeCallback","Garnish","Craft","Preview","LivePreview","addButton","btnObj","start","$button","observe","activeButtonsObservers","button","is","prepend","after","before","index","buttons","$btns","_findButtons","eq","min","window"],"sourceRoot":""}