!function(){var e;function t(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var r=$.extend({},Craft.Redactor.PluginBase,(t(e={linkOptions:[],existingText:"",hack:null,allSites:{},modalState:{selectedLink:{text:null,url:null}},start:function(){},showModal:function(e,t){var n=e.refHandle;e.callback,this.saveSelection(this.app),Craft.createElementSelectorModal(e.elementType,{storageKey:"RedactorInput.LinkTo."+e.elementType,sources:e.sources,criteria:e.criteria,defaultSiteId:this.elementSiteId,autoFocusSearchBox:!1,onSelect:$.proxy((function(e){if(e.length){this.restoreSelection(this.app);var t=e[0],r=this.app.selection.getText();this.modalState.selectedLink={url:t.url+"#"+n+":"+t.id+"@"+t.siteId,text:r.length>0?r:t.label},this.app.api("module.link.open")}}),this),closeOtherModals:!1})},setLinkOptions:function(e){this.linkOptions=e},onmodal:{link:{open:function(e,t){this.hack=e.app.editor.focus,e.app.editor.focus=function(){return null},$form=$(t.nodes),this.modalState.selectedLink.url&&$form.find("input[name=url]").val(this.modalState.selectedLink.url),this.modalState.selectedLink.text&&$form.find("input[name=text]").val(this.modalState.selectedLink.text),this.modalState.selectedLink={text:null,url:null};var r,a,i=$form.find("input[name=url]").val(),l=Craft.Redactor.localizedRefHandles.join("|"),o=i.match(new RegExp("(#(?:".concat(l,"):\\d+)(?:@(\\d+))?")));if(o){var s=this.allSites,c=o[2]?parseInt(o[2],10):null,u=$('<select id="modal-site-selector"></select>').on("change",(function(e){var t=parseInt($(e.currentTarget).val(),10),n=o[1];t&&(n+="@".concat(t));var r=i.replace(o[0],n);$form.find("input[name=url]").val(r)})),d=c?"":' selected="selected"';u.append('<option value="0"'.concat(d,">").concat(Craft.t("app","Link to the current site"),"</option>"));for(var p=0,f=Object.entries(s);p<f.length;p++){var m=(r=f[p],a=2,function(e){if(Array.isArray(e))return e}(r)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],l=!0,o=!1;try{for(n=n.call(e);!(l=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);l=!0);}catch(e){o=!0,a=e}finally{try{l||null==n.return||n.return()}finally{if(o)throw a}}return i}}(r,a)||function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(r,a)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());siteId=m[0],siteName=m[1];var h=c===parseInt(siteId,10)?' selected="selected"':"";u.append('<option value="'.concat(siteId,'"').concat(h,">").concat(siteName,"</option>"))}var v=$('<div class="form-item form-item-site"><label for="modal-site-selector">Site</label></div>').append(u);$(t.nodes[0]).append(v)}},close:function(e){e.app.editor.focus=this.hack,this.hack=null}}}},"setLinkOptions",(function(e){var t=this.app.toolbar.getButton("link"),n=t.getDropdown().items,r={},a=0;for(var i in e)i=e[i],r["custom"+ ++a]={title:i.optionTitle,api:"plugin.craftElementLinks.showModal",args:{elementType:i.elementType,refHandle:i.refHandle,sources:i.sources,criteria:i.criteria}};t.setDropdown($.extend(r,n))})),t(e,"setAllSites",(function(e){this.allSites=e})),e));Redactor.add("plugin","craftElementLinks",r)}();
//# sourceMappingURL=CraftElementLinks.js.map