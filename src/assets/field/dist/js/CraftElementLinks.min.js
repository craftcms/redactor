var plugin=$.extend({},Craft.Redactor.PluginBase,{linkOptions:[],existingText:"",hack:null,allSites:{},modalState:{selectedLink:{text:null,url:null}},start:function(){},showModal:function(arguments,e){let t=arguments.refHandle;arguments.callback;const i=this.app.selection.getText();this.app.selection.save();Craft.createElementSelectorModal(arguments.elementType,{storageKey:"RedactorInput.LinkTo."+arguments.elementType,sources:arguments.sources,criteria:arguments.criteria,defaultSiteId:this.elementSiteId,autoFocusSearchBox:!1,onSelect:$.proxy((function(e){if(e.length){const l=e[0];this.app.selection.restore(),this.modalState.selectedLink={url:l.url+"#"+t+":"+l.id+"@"+l.siteId,text:i.length>0?i:l.label},this.app.api("module.link.open")}}),this),closeOtherModals:!1})},setLinkOptions:function(e){this.linkOptions=e},onmodal:{link:{open:function(e,t){this.hack=e.app.editor.focus,e.app.editor.focus=()=>null,$form=$(t.nodes),this.modalState.selectedLink.url&&$form.find("input[name=url]").val(this.modalState.selectedLink.url),this.modalState.selectedLink.text&&$form.find("input[name=text]").val(this.modalState.selectedLink.text),this.modalState.selectedLink={text:null,url:null};let i=$form.find("input[name=url]").val();if(i.match(/#(category|entry|product):\d+/)){let e=this.allSites,l=0;i.split("@").length>1&&(l=parseInt(i.split("@").pop(),10));const n=$('<select id="modal-site-selector"></select>').on("change",function(e){let t=$form.find("input[name=url]").val();const i=parseInt($(e.currentTarget).val(),10);if(t.match(/.*(@\d+)$/)){let e=t.split("@");e.pop(),t=e.join("@")}i&&(t+="@"+i),$form.find("input[name=url]").val(t)}.bind(this));let o=0===l?' selected="selected"':"";for([siteId,siteName]of(n.append(`<option value="0"${o}>Multisite</option>`),Object.entries(e))){let e=l===parseInt(siteId,10)?' selected="selected"':"";n.append(`<option value="${siteId}"${e}>${siteName}</option>`)}const s=$('<div class="form-item form-item-site"><label for="modal-site-selector">Site</label></div>').append(n);$(t.nodes[0]).append(s)}},close:function(e){e.app.editor.focus=this.hack,this.hack=null}}},setLinkOptions:function(e){var t=this.app.toolbar.getButton("link"),i=t.getDropdown().items,l={},n=0;for(var o in e)o=e[o],l["custom"+ ++n]={title:o.optionTitle,api:"plugin.craftElementLinks.showModal",args:{elementType:o.elementType,refHandle:o.refHandle,sources:o.sources,criteria:o.criteria}};t.setDropdown($.extend(l,i))},setAllSites:function(e){this.allSites=e}});Redactor.add("plugin","craftElementLinks",plugin);
//# sourceMappingURL=CraftElementLinks.min.js.map
