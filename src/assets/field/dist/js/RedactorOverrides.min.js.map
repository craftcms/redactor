{"version":3,"sources":["RedactorOverrides.js"],"names":["imageResizeClass","$R","prototype","init","app","this","$doc","$win","$body","editor","toolbar","inspector","$target","isTarget","getTargetElement","attachPreviewListeners","hide","$editor","$","length","dom","_init","_setResizerPosition","$resizer","targetOffset","offset","topOffset","top","scrollTop","leftOffset","left","pos","$resizableImage","width","height","resizerWidth","resizerHeight","css","Math","round","_build","e","find","remove","data","parse","target","getElement","isComponentType","$resizableBox","getImageElement","attr","z-index","append","on","_set","bind","off","rebuild","toolbarFixedClass","livePreview","$previousFixedTarget","$fixedTarget","_doFixed","uuid","$container","container","$toolbar","$wrapper","getWrapper","isSourceMode","parents","filter","node","getComputedStyle","display","isHeight","isEmpty","reset","pinIt","toolbarHeight","pinDistance","headerBuffer","outerHeight","bottomFromScreenTop","distanceFromScreenTop","position","detector","isDesktop","scrollOffset","boxOffset","opts","toolbarFixedTopOffset","isMobile","fixedScrollTimeout","clearTimeout","setTimeout","show","addClass","dropdown","getDropdown","updatePosition","broadcast","inputCleanerService","input","html","paragraphize","started","replace","storedComments","storeComments","encodeCode","utils","buildWrapper","removeAttr","each","$node","href","src","trim","search","imageattrs","attributes","attrs","i","removeAttrs","name","indexOf","removeDataSrc","value","imageSrcData","removeAttribute","getWrapperHtml","create","convert","convertRules","storeComponents","replaceTags","_setSpanAttr","_setStyleCache","removeTags","deniedTags","_removeScriptTag","_replaceScriptTag","removeComments","_isSpacedEmpty","emptyHtml","restoreComponents","_cleanWrapped","restoreComments","output","removeMarkers","removeInvisibleSpaces","breakline","_isParagraphEmpty","removeServiceTagsAndAttrs","removeSpanWithoutAttributes","removeFirstBlockBreaklineInHtml","_unreplaceScriptTag","_setPreClass","_setLinkNofollow","cleanNewLines","unconvert","unconvertRules","removeEmptyAttributes","cleanSpacesInPre","tidy","toolbarDropdownClass","isFixed","btnHeight","$btn","btnWidth","parseFloat","leftPos","toolbarElement","maxHeight","cropHeight","contextBarClass","$contextbar","get","appendTo","close","$el","closest","removeClass","toolbarService","openCallback","closeCallback","Garnish","Craft","Preview","LivePreview","addButton","btnObj","start","$button","observe","activeButtonsObservers","button","is","prepend","after","before","index","buttons","$btns","_findButtons","eq","min"],"mappings":"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","file":"RedactorOverrides.min.js","sourcesContent":["// Adjust the positioning of image resizer\n// =============================================================================\n\nvar imageResizeClass = $R['classes']['image.resize'];\n\nimageResizeClass.prototype.init = function (app) {\n    this.app = app;\n    this.$doc = app.$doc;\n    this.$win = app.$win;\n    this.$body = app.$body;\n    this.editor = app.editor;\n    this.toolbar = app.toolbar;\n    this.inspector = app.inspector;\n\n    // init\n    this.$target = (this.toolbar.isTarget()) ? this.toolbar.getTargetElement() : this.$body;\n\n    // Change the target according to LP\n    var attachLivePreview = () => {\n        this.hide();\n        var $editor = $('.lp-editor');\n        if ($editor.length) {\n            this.$target = $R.dom($editor[0]);\n        }\n    };\n\n    var detachLivePreview = () => {\n        this.hide();\n        this.$target = (this.toolbar.isTarget()) ? this.toolbar.getTargetElement() : this.$body;\n    }\n\n    attachPreviewListeners(attachLivePreview, detachLivePreview);\n\n    this._init();\n}\n// Position the image resizer correctly\nimageResizeClass.prototype._setResizerPosition = function () {\n    if (this.$resizer)\n    {\n        var isTarget = this.toolbar.isTarget();\n        var targetOffset = this.$target.offset();\n        var offsetFix = 7;\n        var topOffset = (isTarget) ? (offsetFix - targetOffset.top + this.$target.scrollTop()) : offsetFix;\n        var leftOffset = (isTarget) ? (offsetFix - targetOffset.left) : offsetFix;\n        var pos = this.$resizableImage.offset();\n        var width = this.$resizableImage.width();\n        var height = this.$resizableImage.height();\n        var resizerWidth =  this.$resizer.width();\n        var resizerHeight =  this.$resizer.height();\n\n        this.$resizer.css({ top: Math.round(pos.top + height - resizerHeight + topOffset) + 'px', left: Math.round(pos.left + width - resizerWidth + leftOffset) + 'px' });\n    }\n};\n\n// When scrolling, reposition the resizer\nimageResizeClass.prototype._build = function (e) {\n    this.$target.find('#redactor-image-resizer').remove();\n\n    var data = this.inspector.parse(e.target);\n    var $editor = this.editor.getElement();\n\n    if (data.isComponentType('image'))\n    {\n        this.$resizableBox = $editor;\n        this.$resizableImage = $R.dom(data.getImageElement());\n\n        this.$resizer = $R.dom('<span>');\n        this.$resizer.attr('id', 'redactor-image-resizer');\n        this.$resizer.css({'z-index': 100});\n\n        this.$target.append(this.$resizer);\n\n        this._setResizerPosition();\n        this.$resizer.on('mousedown touchstart', this._set.bind(this));\n    }\n};\n// Stop listening to scroll\nimageResizeClass.prototype.hide = function () {\n    this.$target.find('#redactor-image-resizer').remove();\n    if (this.toolbar.isTarget()) {\n        this.$target.off('scroll.resizer', this.rebuild.bind(this));\n    } else {\n        $R.dom('#content-container').off('scroll.resizer', this.rebuild.bind(this));\n    }\n};\n\n// Adjust the positioning of fixed toolbar\n// =============================================================================\n\nvar toolbarFixedClass = $R['classes']['toolbar.fixed'];\n\ntoolbarFixedClass.prototype.livePreview = false;\ntoolbarFixedClass.prototype.$previousFixedTarget = false;\n\ntoolbarFixedClass.prototype._init = function() {\n    this.$fixedTarget = (this.toolbar.isTarget()) ? this.toolbar.getTargetElement() : this.$win;\n    this._doFixed();\n\n    if (this.toolbar.isTarget())\n    {\n        this.$win.on('scroll.redactor-toolbar-' + this.uuid, this._doFixed.bind(this));\n        this.$win.on('resize.redactor-toolbar-' + this.uuid, this._doFixed.bind(this));\n    }\n\n    this.$fixedTarget.on('scroll.redactor-toolbar-' + this.uuid, this._doFixed.bind(this));\n    this.$fixedTarget.on('resize.redactor-toolbar-' + this.uuid, this._doFixed.bind(this));\n\n    var attachLivePreview = () => {\n        var $editor = $('.lp-editor');\n        if ($editor.length) {\n            this.livePreview = true;\n            this.$previousFixedTarget = this.$fixedTarget;\n            $editor = $R.dom($editor[0]);\n            $editor.on('scroll.redactor-toolbar-' + this.uuid, this._doFixed.bind(this));\n            this.$fixedTarget = $editor;\n        }\n    };\n\n    var detachLivePreview = () => {\n        this.livePreview = false;\n        this.$fixedTarget = this.$previousFixedTarget;\n        this.$previousFixedTarget = null;\n    }\n\n    attachPreviewListeners(attachLivePreview, detachLivePreview);\n};\n\ntoolbarFixedClass.prototype._doFixed = function() {\n    var $editor = this.editor.getElement();\n    var $container = this.container.getElement();\n    var $toolbar = this.toolbar.getElement();\n    var $wrapper = this.toolbar.getWrapper();\n\n    if (this.editor.isSourceMode())\n    {\n        return;\n    }\n\n    var $targets = $container.parents().filter(function(node)\n    {\n        return (getComputedStyle(node, null).display === 'none') ? node : false;\n    });\n\n    // has hidden parent\n    if ($targets.length !== 0) return;\n\n    var isHeight = ($editor.height() < 100);\n    var isEmpty = this.editor.isEmpty();\n\n    if (isHeight || isEmpty) {\n        this.reset();\n        return;\n    }\n\n    var toolbarHeight = $toolbar.height();\n\n    var pinIt = false;\n    var pinDistance = 0;\n    var tolerance = 20;\n\n    if (this.livePreview) {\n        var headerBuffer = $('.lp-editor-container header.flex').length ? $('.lp-editor-container header.flex').outerHeight() : 0;\n        var distanceFromScreenTop = $editor.offset().top - headerBuffer;\n        var bottomFromScreenTop = distanceFromScreenTop + $editor.height() - toolbarHeight;\n    } else {\n        var headerBuffer = $('body.fixed-header #header').length ? $('body.fixed-header #header').outerHeight() : 0;\n        var distanceFromScreenTop = $editor.offset().top - this.$win.scrollTop() - headerBuffer;\n        var bottomFromScreenTop = distanceFromScreenTop + $editor.height() - toolbarHeight;\n    }\n\n    pinIt = (distanceFromScreenTop + tolerance) < 0 && bottomFromScreenTop > 0;\n    pinDistance = $editor.scrollTop() + headerBuffer;\n\n    // Figure out when to pin the toolbar\n\n    if (pinIt)\n    {\n        var position = (this.detector.isDesktop()) ? 'fixed' : 'absolute';\n        pinDistance = (this.detector.isDesktop()) ? pinDistance : (scrollOffset - boxOffset + this.opts.toolbarFixedTopOffset);\n\n        if (this.detector.isMobile())\n        {\n            if (this.fixedScrollTimeout)\n            {\n                clearTimeout(this.fixedScrollTimeout);\n            }\n\n            $toolbar.hide();\n            this.fixedScrollTimeout = setTimeout(function()\n            {\n                $toolbar.show();\n            }, 250);\n        }\n\n        $wrapper.height(toolbarHeight);\n        $toolbar.addClass('redactor-toolbar-fixed');\n        $toolbar.css({\n            position: position,\n            top: (pinDistance + this.opts.toolbarFixedTopOffset) + 'px',\n            width: $container.width() + 'px'\n        });\n\n        var dropdown = this.toolbar.getDropdown();\n\n        if (dropdown) {\n            dropdown.updatePosition();\n        }\n\n        this.app.broadcast('toolbar.fixed');\n    }\n    else\n    {\n        this.reset();\n        this.app.broadcast('toolbar.unfixed');\n    }\n};\n\nvar inputCleanerService = $R['services']['cleaner'];\n\ninputCleanerService.prototype.input = function(html, paragraphize, started)\n{\n    // fix &curren; entity in the links\n    html = html.replace(/Â¤t/gi, '&current');\n\n    // store\n    var storedComments = [];\n    html = this.storeComments(html, storedComments);\n\n    // pre/code\n    html = this.encodeCode(html);\n\n    // sanitize\n    var $wrapper = this.utils.buildWrapper(html);\n    $wrapper.find('a, b, i, strong, em, img, svg, details, audio').removeAttr('onload onerror ontoggle onwheel onmouseover oncopy');\n    $wrapper.find('a, iframe, embed').each(function(node) {\n        var $node = $R.dom(node);\n        var href = $node.attr('href');\n        var src = $node.attr('src');\n        if (href && href.trim().search(/^data|javascript:/i) !== -1) $node.attr('href', '');\n        if (src && src.trim().search(/^data|javascript:/i) !== -1) $node.attr('src', '');\n    });\n\n    var imageattrs = ['alt', 'title', 'src', 'class', 'width', 'height', 'srcset', 'usemap'];\n    $wrapper.find('img').each(function(node) {\n        if (node.attributes.length > 0) {\n            var attrs = node.attributes;\n            for (var i = attrs.length - 1; i >= 0; i--) {\n                var removeAttrs = (attrs[i].name.search(/^data-/) === -1 && imageattrs.indexOf(attrs[i].name) === -1);\n                var removeDataSrc = (attrs[i].name === 'src' && attrs[i].value.search(/^data|javascript:/i) !== -1);\n                if (this.opts.imageSrcData) removeDataSrc = false;\n\n                if (removeAttrs || removeDataSrc) {\n                    node.removeAttribute(attrs[i].name);\n                }\n            }\n        }\n    }.bind(this));\n\n    // get wrapper html\n    html = this.utils.getWrapperHtml($wrapper);\n\n    // converting entity\n    html = html.replace(/\\$/g, '&#36;');\n    html = html.replace(/&amp;/g, '&');\n\n    // convert to figure\n    var converter = $R.create('cleaner.figure', this.app);\n    html = converter.convert(html, this.convertRules);\n\n    // store components\n    html = this.storeComponents(html);\n\n    // clean\n    html = this.replaceTags(html, this.opts.replaceTags);\n    html = this._setSpanAttr(html);\n    html = this._setStyleCache(html);\n    html = this.removeTags(html, this.deniedTags);\n    html = (this.opts.removeScript) ? this._removeScriptTag(html) : this._replaceScriptTag(html);\n    //html = (this.opts.removeScript) ? this._removeScriptTag(html) : html;\n    html = (this.opts.removeComments) ? this.removeComments(html) : html;\n    html = (this._isSpacedEmpty(html)) ? this.opts.emptyHtml : html;\n\n\n    // restore components\n    html = this.restoreComponents(html);\n\n\n    // clear wrapped components\n    html = this._cleanWrapped(html);\n\n    // restore comments\n    html = this.restoreComments(html, storedComments);\n\n    // paragraphize\n    html = (paragraphize) ? this.paragraphize(html) : html;\n\n    return html;\n}\n\ninputCleanerService.prototype.output = function(html, removeMarkers)\n{\n    html = this.removeInvisibleSpaces(html);\n\n    if (this.opts.breakline) {\n        html = html.replace(/<\\/(span|strong|b|i|em)><br\\s?\\/?><\\/div>/gi, \"</$1></div>\");\n        html = html.replace(/<br\\s?\\/?><\\/(span|strong|b|i|em)><\\/div>/gi, \"</$1></div>\");\n    }\n\n    html = html.replace(/&#36;/g, '$');\n\n    // empty\n    if (this._isSpacedEmpty(html)) return '';\n    if (this._isParagraphEmpty(html)) return '';\n\n    html = this.removeServiceTagsAndAttrs(html, removeMarkers);\n\n    // store components\n    html = this.storeComponents(html);\n\n    html = this.removeSpanWithoutAttributes(html);\n    html = this.removeFirstBlockBreaklineInHtml(html);\n\n    html = (this.opts.removeScript) ? html : this._unreplaceScriptTag(html);\n    html = (this.opts.preClass) ? this._setPreClass(html) : html;\n    html = (this.opts.linkNofollow) ? this._setLinkNofollow(html) : html;\n    html = (this.opts.removeNewLines) ? this.cleanNewLines(html) : html;\n\n    // restore components\n    html = this.restoreComponents(html);\n\n    // convert to figure\n    var converter = $R.create('cleaner.figure', this.app);\n    html = converter.unconvert(html, this.unconvertRules);\n\n    // final clean up\n    html = this.removeEmptyAttributes(html, ['style', 'class', 'rel', 'title']);\n    html = this.cleanSpacesInPre(html);\n    html = this.tidy(html);\n\n    // converting entity\n    html = html.replace(/&amp;/g, '&');\n\n    // breakline tidy\n    if (this.opts.breakline) {\n        html = html.replace(/<br\\s?\\/?>/gi, \"<br>\\n\");\n        html = html.replace(/<br\\s?\\/?>\\n+/gi, \"<br>\\n\");\n    }\n\n    // check whitespaces\n    html = (html.replace(/\\n/g, '') === '') ? '' : html;\n\n    return html;\n};\n\nvar toolbarDropdownClass = $R['classes']['toolbar.dropdown'];\n\ntoolbarDropdownClass.prototype.updatePosition = function ()\n{\n    var isFixed = this.toolbar.isFixed();\n    var isTarget = this.toolbar.isTarget();\n\n    var btnHeight = this.$btn.height();\n    var btnWidth = this.$btn.width();\n\n    var pos = this.$btn.offset();\n    var position = 'absolute';\n    var topOffset = 2;\n\n    if (isFixed) {\n        pos.top = (isTarget) ? this.$btn.offset().top : this.$btn.position().top;\n        position = 'fixed';\n        topOffset = topOffset + this.opts.toolbarFixedTopOffset;\n    }\n\n\n    var leftOffset = 0;\n    var left = (pos.left + leftOffset);\n    var width = parseFloat(this.css('width'));\n    var winWidth = this.$win.width();\n    var leftFix = (winWidth < (left + width)) ? (width - btnWidth) : 0;\n    var leftPos = (left - leftFix);\n    var top = (pos.top + btnHeight + topOffset);\n\n    if (isFixed) {\n        var toolbarElement = this.toolbar.getElement();\n        top = toolbarElement.position().top + toolbarElement.height();\n    }\n\n    leftPos = (leftPos < 0) ? 4 : leftPos;\n\n    this.css({\n        maxHeight: '',\n        position: position,\n        top: top + 'px',\n        left: leftPos + 'px'\n    });\n\n    // height adaptive\n    var heightTolerance = 10;\n    var winHeight = this.$win.height();\n    var scrollTop = this.$doc.scrollTop();\n    var cropHeight = winHeight - (top - scrollTop) - heightTolerance;\n\n    this.css('max-height', cropHeight + 'px');\n};\n\nvar contextBarClass = $R[\"modules\"][\"contextbar\"];\n\ncontextBarClass.prototype.init = function (app) {\n    this.app = app;\n    this.opts = app.opts;\n    this.uuid = app.uuid;\n    this.$win = app.$win;\n    this.$doc = app.$doc;\n    this.$body = app.$body;\n    this.editor = app.editor;\n    this.toolbar = app.toolbar;\n    this.detector = app.detector;\n    this.livePreview = false;\n\n    // local\n    this.$target = (this.toolbar.isTarget()) ? this.toolbar.getTargetElement() : this.$body;\n\n    // Change the target according to LP\n    var attachLivePreview = () => {\n        var $target = $('.lp-editor');\n        if ($target.length) {\n            $(this.$contextbar.get()).appendTo($target);\n            this.livePreview = true;\n        }\n    };\n\n    var detachLivePreview = () => {\n        var $target = this.toolbar.getTargetElement();\n        if ($target.length) {\n            $(this.$contextbar.get(0)).appendTo($target.get(0));\n        }\n        this.livePreview = false;\n    }\n\n    attachPreviewListeners(attachLivePreview, detachLivePreview);\n};\n\ncontextBarClass.prototype.close = function(e) {\n    if (!this.$contextbar) return;\n    if (e)\n    {\n        var $target = $R.dom(e.target);\n        if (this.$el && $target.closest(this.$el).length !== 0)\n        {\n            return;\n        }\n    }\n\n    this.$contextbar.hide();\n    this.$contextbar.removeClass('open');\n    this.$doc.off('.redactor.context');\n    this.app.broadcast('hardsync');\n};\n\nvar toolbarService = $R['services']['toolbar'];\n\ntoolbarService.prototype.addButton = function(name, btnObj, position, $el, start)\n{\n    position = position || 'end';\n\n    var $button = $R.create('toolbar.button', this.app, name, btnObj);\n    if (btnObj.observe)\n    {\n        this.opts.activeButtonsObservers[name] = { observe: btnObj.observe, button: $button };\n    }\n\n    if (this.is())\n    {\n        if (position === 'first') this.$toolbar.prepend($button);\n        else if (position === 'after') $el.after($button);\n        else if (position === 'before') $el.before($button);\n        else {\n            var index = this.opts.buttons.indexOf(name);\n\n            if (start !== true && index !== -1) {\n                if (index === 0) {\n                    this.$toolbar.prepend($button);\n                }\n                else {\n                    var $btns = this._findButtons();\n\n                    // If this was an added button, it might not exist in the options with how things are, so make sure to stay inside bounds\n                    var $btn = $btns.eq(Math.min(index, $btns.length) - 1);\n                    $btn.after($button);\n                }\n            }\n            else {\n                this.$toolbar.append($button);\n            }\n        }\n    }\n\n    return $button;\n};\n\nfunction attachPreviewListeners (openCallback, closeCallback) {\n    Garnish.on(Craft.Preview, 'open', openCallback);\n    Garnish.on(Craft.LivePreview, 'enter', openCallback);\n\n    Garnish.on(Craft.Preview, 'close', closeCallback);\n    Garnish.on(Craft.LivePreview, 'exit', closeCallback);\n}\n"]}