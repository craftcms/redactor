window.livePreviewHideFullscreen=!1,function(t){Craft.RedactorInput=Garnish.Base.extend({id:null,linkOptions:null,volumes:null,elementSiteId:null,allSites:{},redactorConfig:null,showAllUploaders:!1,$textarea:null,redactor:null,linkOptionModals:null,enforceButtonOrder:null,init:function(e){if(this.id=e.id,this.linkOptions=e.linkOptions,this.volumes=e.volumes,this.transforms=e.transforms,this.elementSiteId=e.elementSiteId,this.allSites=e.allSites,this.redactorConfig=e.redactorConfig,this.showAllUploaders=e.showAllUploaders,this.defaultTransform=e.defaultTransform,this.linkOptionModals=[],this.redactorConfig.enforceButtonOrder&&(this.enforceButtonOrder=this.redactorConfig.enforceButtonOrder,delete this.redactorConfig.enforceButtonOrder),this.redactorConfig.lang||(this.redactorConfig.lang=e.redactorLang),this.redactorConfig.direction||(this.redactorConfig.direction=e.direction||Craft.orientation),this.redactorConfig.imageUpload=!1,this.redactorConfig.fileUpload=!1,typeof this.redactorConfig.plugins!=typeof[]&&(this.redactorConfig.plugins=[]),this.redactorConfig.plugins.push("craftAssetImages"),this.redactorConfig.plugins.push("craftAssetFiles"),this.redactorConfig.plugins.push("craftElementLinks"),this.redactorConfig.plugins.push("craftAssetImageEditor"),this.redactorConfig.buttons){-1!==(n=t.inArray("formatting",this.redactorConfig.buttons))&&this.redactorConfig.buttons.splice(n,1,"format");for(var r,i=["unorderedlist","orderedlist","undent","indent"],o=0;o<i.length;o++)-1!==(n=t.inArray(i[o],this.redactorConfig.buttons))&&(this.redactorConfig.buttons.splice(n,1),(void 0===r||n<r)&&(r=n));void 0!==r&&this.redactorConfig.buttons.splice(r,0,"lists")}else this.redactorConfig.buttons=["html","format","bold","italic","deleted","lists","image","file","link"];var n;if(this.redactorConfig.buttonsAddFirst&&(this.redactorConfig.buttons=this.redactorConfig.buttonsAddFirst.buttons.concat(this.redactorConfig.buttons)),this.redactorConfig.buttonsAdd&&(this.redactorConfig.buttons=this.redactorConfig.buttons.concat(this.redactorConfig.buttonsAdd.buttons)),this.redactorConfig.buttonsAddBefore)for(o=0;o<this.redactorConfig.buttons.length;o++)if(this.redactorConfig.buttons[o]==this.redactorConfig.buttonsAddBefore.before){this.redactorConfig.buttons.splice(o,0,...this.redactorConfig.buttonsAddBefore.buttons);break}if(this.redactorConfig.buttonsAddAfter)for(o=0;o<this.redactorConfig.buttons.length;o++)if(this.redactorConfig.buttons[o]==this.redactorConfig.buttonsAddAfter.after){this.redactorConfig.buttons.splice(o+1,0,...this.redactorConfig.buttonsAddAfter.buttons);break}delete this.redactorConfig.buttonsAddFirst,delete this.redactorConfig.buttonsAddBefore,delete this.redactorConfig.buttonsAddAfter,delete this.redactorConfig.buttonsAdd,this.redactorConfig.callbacks={started:Craft.RedactorInput.handleRedactorInit,focus:this.onEditorFocus.bind(this),blur:this.onEditorBlur.bind(this),contextbar:this.showContextBar.bind(this)},0===this.redactorConfig.buttons.length&&delete this.redactorConfig.buttons,this.initRedactor(),void 0!==Craft.Slideout&&(Garnish.on(Craft.Slideout,"open",()=>t("body").addClass("redactor-element-editor-open")),Garnish.on(Craft.Slideout,"close",()=>t("body").removeClass("redactor-element-editor-open")))},initRedactor:function(){var e="#"+this.id;if(this.$textarea=t(e),void 0===this.redactorConfig.toolbarFixed||this.redactorConfig.toolbarFixed){var r=this.$textarea.closest("#content");r.length&&(this.redactorConfig.toolbarFixedTarget=r)}Craft.RedactorInput.currentInstance=this,this.$textarea.redactor(this.redactorConfig),this.redactor=$R(e),void 0===this.redactorConfig.buttons&&(this.redactorConfig.buttons=[]);var i=this.redactor.toolbar.getButtonsKeys();if(-1!==this.redactorConfig.buttons.indexOf("image")&&(-1!==i.indexOf("image")?this.redactor.plugin.craftAssetImages.overrideButton("image"):this.redactor.plugin.craftAssetImages.addButton("image",this.redactorConfig.buttons.indexOf("image")),this.redactor.plugin.craftAssetImages.setTransforms(this.transforms),this.redactor.plugin.craftAssetImages.setDefaultTransform(this.defaultTransform),this.redactor.plugin.craftAssetImages.setVolumes(this.volumes),this.redactor.plugin.craftAssetImages.setElementSiteId(this.elementSiteId),this.redactor.plugin.craftAssetImages.allowAllUploaders=this.showAllUploaders),-1!==this.redactorConfig.buttons.indexOf("file")&&(-1!==i.indexOf("file")?this.redactor.plugin.craftAssetFiles.overrideButton("file"):this.redactor.plugin.craftAssetFiles.addButton("file",this.redactorConfig.buttons.indexOf("file")),this.redactor.plugin.craftAssetFiles.setVolumes(this.volumes),this.redactor.plugin.craftAssetFiles.setElementSiteId(this.elementSiteId)),-1!==i.indexOf("link")&&(this.redactor.plugin.craftElementLinks.setElementSiteId(this.elementSiteId),this.redactor.plugin.craftElementLinks.setAllSites(this.allSites),this.linkOptions.length&&this.redactor.plugin.craftElementLinks.setLinkOptions(this.linkOptions)),-1!==this.redactorConfig.plugins.indexOf("fullscreen")&&void 0!==Craft.livePreview&&!1===window.livePreviewHideFullscreen&&(window.livePreviewHideFullscreen=!0,Craft.livePreview.on("beforeEnter",(function(e){t("a.re-button.re-fullscreen").addClass("hidden")})),Craft.livePreview.on("beforeExit",(function(e){t("a.re-button.re-fullscreen").removeClass("hidden")}))),this.trigger("afterInitializeRedactor",{inputField:this}),this.enforceButtonOrder){const e=this.enforceButtonOrder;let r=t(this.redactor.toolbar.getElement().nodes);if(e.length>0){for(let t of e.reverse()){let e=r.find(`[data-re-name=${t}]`);e.length>0&&r.prepend(e)}}}delete Craft.RedactorInput.currentInstance},onInitRedactor:function(t){this.redactor=t,this.redactor.container.getElement().addClass("focusable-input"),this.leaveFullscreenOnSaveShortcut(),this.redactor.opts.toolbarFixed&&!Craft.RedactorInput.scrollPageOnReady&&(Garnish.$doc.ready((function(){Garnish.$doc.trigger("scroll")})),Craft.RedactorInput.scrollPageOnReady=!0)},onEditorFocus:function(){this.redactor.container.getElement().trigger("focus")},onEditorBlur:function(){this.redactor.container.getElement().trigger("blur")},leaveFullscreenOnSaveShortcut:function(){void 0!==this.redactor.plugin.fullscreen&&"function"==typeof this.redactor.plugin.fullscreen.close&&Craft.cp.on("beforeSaveShortcut",t.proxy((function(){this.redactor.plugin.fullscreen.isOpen&&this.redactor.plugin.fullscreen.close()}),this))},replaceRedactorButton:function(t,e){var r=this.redactor.toolbar.getButton(t);if(r){var i=r.$icon.get(0),o=t+"_placeholder",n=this.redactor.toolbar.addButtonAfter(t,o,{title:e});r.remove();var s=this.redactor.toolbar.addButtonAfter(o,t,{title:e});return n.remove(),s.setIcon(i),s}},showContextBar:function(e,r){if(this.justResized)this.justResized=!1;else{var i=this.redactor.selection.getCurrent(),o=this.redactor.inspector.parse(i),n=function(t,e){var r=e.$contextbar.parent(),i=t.clientY+e.$contextbar.height()-10-r.offset().top+(e.livePreview?r.scrollTop():e.$win.scrollTop()),o={left:t.clientX-e.$contextbar.width()/2-r.offset().left+"px",top:i+"px"};e.$contextbar.css(o)};if(!o.isFigcaption()&&o.isComponentType("image")){var s=o.getComponent(),a=t(s).find("img");if(1===a.length){var d=d=a.attr("src").match(/#asset:(\d+)/i);if(d){var l=d[1];Craft.postActionRequest("redactor",{assetId:l},function(t){if(t.success){var i={"image-editor":{title:this.redactor.lang.get("image-editor"),api:"plugin.craftAssetImageEditor.open",args:l},edit:{title:this.redactor.lang.get("edit"),api:"module.image.open"},remove:{title:this.redactor.lang.get("delete"),api:"module.image.remove",args:s}};r.set(e,s,i)}n(e,r)}.bind(this))}}}n(e,r)}}},{handleRedactorInit:function(){Craft.RedactorInput.currentInstance.onInitRedactor(this)}})}(jQuery);
//# sourceMappingURL=RedactorInput.min.js.map
