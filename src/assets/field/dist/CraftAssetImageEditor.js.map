{"version":3,"file":"CraftAssetImageEditor.js","mappings":"YAAA,IAAIA,EAASC,EAAEC,OAAO,GAAIC,MAAMC,SAASC,WAAY,CACnDC,QAAS,KAETC,MAAO,aAEPC,KAAM,SAAUF,GACdG,KAAKH,QAAUA,EAEf,IAAII,EAAW,CACbC,kBAAkB,EAClBC,OAAQH,KAAKI,YAAYC,KAAKL,MAC9BM,qBAAsBZ,MAAMa,WAG9B,IAAIb,MAAMc,iBAAiBX,EAASI,IAGtCG,YAAa,WACX,IACIK,EADUT,KAAKU,IAAIC,OAAOC,aACRC,KAAK,gBAEvBC,EAAoB,SAAUC,GAChC,IAAIC,EAAUD,EAAKE,IAAIC,MAAM,uCAG7B,GAAIF,GAAWA,EAAQ,IAAMhB,KAAKH,QAEhC,GAAKmB,EAAQ,GAGN,CACL,IAAIG,EAAS,CACXtB,QAASmB,EAAQ,GACjBI,OAAQJ,EAAQ,IAElBtB,MAAM2B,kBACJ,4BACAF,GACA,SAAUG,GACRP,EAAKE,IACHK,EAAKC,IACL,KACA,IAAIC,MAAOC,UACX,UACAT,EAAQ,GACR,cACAA,EAAQ,WAlBdD,EAAKE,IACHD,EAAQ,GAAK,KAAM,IAAIQ,MAAOC,UAAY,UAAYT,EAAQ,IAsBpEX,KAAKL,MAEP,IAAK,IAAIe,KAAQN,EAAQiB,MAEvBZ,EADAC,EAAON,EAAQiB,MAAMX,IAIvBf,KAAKU,IAAIiB,QAAQC,mBAMlBjC,SADEkC,IAAI,SAAU,wBAAyBtC,G","sources":["webpack:///./js/CraftAssetImageEditor.js"],"sourcesContent":["var plugin = $.extend({}, Craft.Redactor.PluginBase, {\n  assetId: null,\n\n  start: function () {},\n\n  open: function (assetId) {\n    this.assetId = assetId;\n\n    var settings = {\n      allowSavingAsNew: false,\n      onSave: this.reloadImage.bind(this),\n      allowDegreeFractions: Craft.isImagick,\n    };\n\n    new Craft.AssetImageEditor(assetId, settings);\n  },\n\n  reloadImage: function () {\n    var $editor = this.app.editor.getElement();\n    var $images = $editor.find('[data-image]');\n\n    var refreshNodeSource = function (node) {\n      var matches = node.src.match(/(.*)#asset:(\\d+)(:transform:(.*))?/i);\n\n      // Find all instances of THIS asset.\n      if (matches && matches[2] == this.assetId) {\n        // Not a transform\n        if (!matches[4]) {\n          node.src =\n            matches[1] + '?' + new Date().getTime() + '#asset:' + matches[2];\n        } else {\n          var params = {\n            assetId: matches[2],\n            handle: matches[4],\n          };\n          Craft.postActionRequest(\n            'assets/generate-transform',\n            params,\n            function (data) {\n              node.src =\n                data.url +\n                '?' +\n                new Date().getTime() +\n                '#asset:' +\n                matches[2] +\n                ':transform:' +\n                matches[4];\n            }\n          );\n        }\n      }\n    }.bind(this);\n\n    for (var node in $images.nodes) {\n      node = $images.nodes[node];\n      refreshNodeSource(node);\n    }\n\n    this.app.storage.observeImages();\n  },\n});\n\n(function ($R) {\n  $R.add('plugin', 'craftAssetImageEditor', plugin);\n})(Redactor);\n"],"names":["plugin","$","extend","Craft","Redactor","PluginBase","assetId","start","open","this","settings","allowSavingAsNew","onSave","reloadImage","bind","allowDegreeFractions","isImagick","AssetImageEditor","$images","app","editor","getElement","find","refreshNodeSource","node","matches","src","match","params","handle","postActionRequest","data","url","Date","getTime","nodes","storage","observeImages","add"],"sourceRoot":""}