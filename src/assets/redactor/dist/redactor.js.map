{"version":3,"file":"redactor.js","mappings":"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","sources":["webpack:///./index.js","webpack:///./lib/redactor/redactor.js","webpack:///../../../../node_modules/expose-loader/dist/runtime/getGlobalThis.js","webpack:///./lib/redactor/redactor.css?0bd8","webpack:///../../../../node_modules/vue-style-loader/lib/listToStyles.js","webpack:///../../../../node_modules/vue-style-loader/lib/addStylesClient.js","webpack:///webpack/bootstrap","webpack:///webpack/runtime/compat get default export","webpack:///webpack/runtime/define property getters","webpack:///webpack/runtime/global","webpack:///webpack/runtime/hasOwnProperty shorthand","webpack:///webpack/runtime/make namespace object","webpack:///webpack/runtime/node module decorator","webpack:///webpack/startup"],"sourcesContent":["var ___EXPOSE_LOADER_IMPORT___ = require(\"-!./index.js\");\nvar ___EXPOSE_LOADER_GET_GLOBAL_THIS___ = require(\"../../../../node_modules/expose-loader/dist/runtime/getGlobalThis.js\");\nvar ___EXPOSE_LOADER_GLOBAL_THIS___ = ___EXPOSE_LOADER_GET_GLOBAL_THIS___;\nvar ___EXPOSE_LOADER_IMPORT_MODULE_LOCAL_NAME___ = ___EXPOSE_LOADER_IMPORT___.default\nif (typeof ___EXPOSE_LOADER_GLOBAL_THIS___[\"Redactor\"] === 'undefined') ___EXPOSE_LOADER_GLOBAL_THIS___[\"Redactor\"] = ___EXPOSE_LOADER_IMPORT_MODULE_LOCAL_NAME___;\nmodule.exports = ___EXPOSE_LOADER_IMPORT___;\n","/*\n    Redactor\n    Version 3.5.2\n    Updated: October 7, 2021\n\n    http://imperavi.com/redactor/\n\n    Copyright (c) 2009-2021, Imperavi Ltd.\n    License: http://imperavi.com/redactor/license/\n*/\nif (typeof CodeMirror === 'undefined') { var CodeMirror = undefined; }\nif (typeof jQuery === 'undefined') { var jQuery = undefined; }\n(function() {\nvar Ajax = {};\n\nAjax.settings = {};\nAjax.post = function(options) { return new AjaxRequest('post', options); };\nAjax.get = function(options) { return new AjaxRequest('get', options); };\nAjax.request = function(method, options) { return new AjaxRequest(method, options); };\n\nvar AjaxRequest = function(method, options)\n{\n    var defaults = {\n        method: method,\n        url: '',\n        before: function() {},\n        success: function() {},\n        error: function() {},\n        data: false,\n        async: true,\n        headers: {}\n    };\n\n    this.p = this.extend(defaults, options);\n    this.p = this.extend(this.p, Ajax.settings);\n    this.p.method = this.p.method.toUpperCase();\n\n    this.prepareData();\n\n    this.xhr = new XMLHttpRequest();\n    this.xhr.open(this.p.method, this.p.url, this.p.async);\n\n    this.setHeaders();\n\n    var before = (typeof this.p.before === 'function') ? this.p.before(this.xhr) : true;\n    if (before !== false)\n    {\n        this.send();\n    }\n};\n\nAjaxRequest.prototype = {\n    extend: function(obj1, obj2)\n    {\n        if (obj2) for (var name in obj2) { obj1[name] = obj2[name]; }\n        return obj1;\n    },\n    prepareData: function()\n    {\n        if (['POST', 'PUT'].indexOf(this.p.method) !== -1 && !this.isFormData()) this.p.headers['Content-Type'] = 'application/x-www-form-urlencoded';\n        if (typeof this.p.data === 'object' && !this.isFormData()) this.p.data = this.toParams(this.p.data);\n        if (this.p.method === 'GET') this.p.url = (this.p.data) ? this.p.url + '?' + this.p.data : this.p.url;\n    },\n    setHeaders: function()\n    {\n        this.xhr.setRequestHeader('X-Requested-With', this.p.headers['X-Requested-With'] || 'XMLHttpRequest');\n        for (var name in this.p.headers)\n        {\n            this.xhr.setRequestHeader(name, this.p.headers[name]);\n        }\n    },\n    isFormData: function()\n    {\n        return (typeof window.FormData !== 'undefined' && this.p.data instanceof window.FormData);\n    },\n    isComplete: function()\n    {\n        return !(this.xhr.status < 200 || (this.xhr.status >= 300 && this.xhr.status !== 304));\n    },\n    send: function()\n    {\n        if (this.p.async)\n        {\n            this.xhr.onload = this.loaded.bind(this);\n            this.xhr.send(this.p.data);\n        }\n        else\n        {\n            this.xhr.send(this.p.data);\n            this.loaded.call(this);\n        }\n    },\n    loaded: function()\n    {\n        if (this.isComplete())\n        {\n            var response = this.parseResponse();\n            if (typeof this.p.success === 'function') this.p.success(response, this.xhr);\n        }\n        else\n        {\n            var response = this.parseResponse();\n            if (typeof this.p.error === 'function') this.p.error(response, this.xhr, this.xhr.status);\n        }\n    },\n    parseResponse: function() {\n        var response = this.xhr.response;\n        var json = this.parseJson(response);\n        return (json) ? json : response;\n    },\n    parseJson: function(str)\n    {\n        try {\n            var o = JSON.parse(str);\n            if (o && typeof o === 'object')\n            {\n                return o;\n            }\n\n        } catch (e) {}\n\n        return false;\n    },\n    toParams: function (obj)\n    {\n        return Object.keys(obj).map(\n            function(k){ return encodeURIComponent(k) + '=' + encodeURIComponent(obj[k]); }\n        ).join('&');\n    }\n};\nvar DomCache = [0];\nvar DomExpando = 'data' + new Date().getTime();\nvar DomHClass = 'is-hidden';\nvar DomHMClass = 'is-hidden-mobile';\n\nvar Dom = function(selector, context)\n{\n    return this.parse(selector, context);\n};\n\nDom.ready = function(fn)\n{\n    if (document.readyState !== 'loading') fn();\n    else document.addEventListener('DOMContentLoaded', fn);\n};\n\nDom.prototype = {\n    get sdom()\n    {\n        return true;\n    },\n    get length()\n    {\n        return this.nodes.length;\n    },\n    parse: function(selector, context)\n    {\n        var nodes;\n        var reHtmlTest = /^\\s*<(\\w+|!)[^>]*>/;\n\n        if (!selector)\n        {\n            nodes = [];\n        }\n        else if (selector.sdom)\n        {\n            this.nodes = selector.nodes;\n            return selector;\n        }\n        else if (typeof selector !== 'string')\n        {\n            if (selector.nodeType && selector.nodeType === 11)\n            {\n                nodes = selector.childNodes;\n            }\n            else\n            {\n                nodes = (selector.nodeType || selector === window) ? [selector] : selector;\n            }\n        }\n        else if (reHtmlTest.test(selector))\n        {\n            nodes = this.create(selector);\n        }\n        else\n        {\n            nodes = this._query(selector, context);\n        }\n\n        this.nodes = this._slice(nodes);\n    },\n    create: function(html)\n    {\n        if (/^<(\\w+)\\s*\\/?>(?:<\\/\\1>|)$/.test(html))\n        {\n            return [document.createElement(RegExp.$1)];\n        }\n\n        var elements = [];\n        var container = document.createElement('div');\n        var children = container.childNodes;\n\n        container.innerHTML = html;\n\n        for (var i = 0, l = children.length; i < l; i++)\n        {\n            elements.push(children[i]);\n        }\n\n        return elements;\n    },\n\n    // add\n    add: function(nodes)\n    {\n        this.nodes = this.nodes.concat(this._toArray(nodes));\n    },\n\n    // get\n    get: function(index)\n    {\n        return this.nodes[(index || 0)] || false;\n    },\n    getAll: function()\n    {\n        return this.nodes;\n    },\n    eq: function(index)\n    {\n        return new Dom(this.nodes[index]);\n    },\n    first: function()\n    {\n        return new Dom(this.nodes[0]);\n    },\n    last: function()\n    {\n        return new Dom(this.nodes[this.nodes.length - 1]);\n    },\n    contents: function()\n    {\n        return this.get().childNodes;\n    },\n\n    // loop\n    each: function(callback)\n    {\n        var len = this.nodes.length;\n        for (var i = 0; i < len; i++)\n        {\n            callback.call(this, (this.nodes[i].sdom) ? this.nodes[i].get() : this.nodes[i], i);\n        }\n\n        return this;\n    },\n\n    // traversing\n    is: function(selector)\n    {\n        return (this.filter(selector).length > 0);\n    },\n    filter: function (selector)\n    {\n        var callback;\n        if (selector === undefined)\n        {\n            return this;\n        }\n        else if (typeof selector === 'function')\n        {\n            callback = selector;\n        }\n        else\n        {\n            callback = function(node)\n            {\n                if (selector instanceof Node)\n                {\n                    return (selector === node);\n                }\n                else if (selector && selector.sdom)\n                {\n                    return ((selector.nodes).indexOf(node) !== -1);\n                }\n                else\n                {\n                    node.matches = node.matches || node.msMatchesSelector || node.webkitMatchesSelector;\n                    return (node.nodeType === 1) ? node.matches(selector || '*') : false;\n                }\n            };\n        }\n\n        return new Dom(this.nodes.filter(callback));\n    },\n    not: function(filter)\n    {\n        return this.filter(function(node)\n        {\n            return !new Dom(node).is(filter || true);\n        });\n    },\n    find: function(selector)\n    {\n        var nodes = [];\n        this.each(function(node)\n        {\n            var ns = this._query(selector || '*', node);\n            for (var i = 0; i < ns.length; i++)\n            {\n                nodes.push(ns[i]);\n            }\n        });\n\n        return new Dom(nodes);\n    },\n    children: function(selector)\n    {\n        var nodes = [];\n        this.each(function(node)\n        {\n            if (node.children)\n            {\n                var ns = node.children;\n                for (var i = 0; i < ns.length; i++)\n                {\n                    nodes.push(ns[i]);\n                }\n            }\n        });\n\n        return new Dom(nodes).filter(selector);\n    },\n    parent: function(selector)\n    {\n        var nodes = [];\n        this.each(function(node)\n        {\n            if (node.parentNode) nodes.push(node.parentNode);\n        });\n\n        return new Dom(nodes).filter(selector);\n    },\n    parents: function(selector, context)\n    {\n        context = this._getContext(context);\n\n        var nodes = [];\n        this.each(function(node) {\n            var parent = node.parentNode;\n            while (parent && parent !== context) {\n                if (selector) {\n                    if (new Dom(parent).is(selector)) { nodes.push(parent); }\n                }\n                else {\n                    nodes.push(parent);\n                }\n                parent = parent.parentNode;\n            }\n        });\n\n        return new Dom(nodes);\n\n    },\n    closest: function(selector, context)\n    {\n        context = this._getContext(context);\n        selector = (selector.sdom) ? selector.get() : selector;\n\n        var nodes = [];\n        var isNode = (selector && selector.nodeType);\n        this.each(function(node)\n        {\n            do {\n                if ((isNode && node === selector) || new Dom(node).is(selector)) return nodes.push(node);\n            } while ((node = node.parentNode) && node !== context);\n        });\n\n        return new Dom(nodes);\n    },\n    next: function(selector)\n    {\n         return this._getSibling(selector, 'nextSibling');\n    },\n    nextElement: function(selector)\n    {\n        return this._getSibling(selector, 'nextElementSibling');\n    },\n    prev: function(selector)\n    {\n        return this._getSibling(selector, 'previousSibling');\n    },\n    prevElement: function(selector)\n    {\n        return this._getSibling(selector, 'previousElementSibling');\n    },\n\n    // css\n    css: function(name, value)\n    {\n        if (value === undefined && (typeof name !== 'object'))\n        {\n            var node = this.get();\n            if (name === 'width' || name === 'height')\n            {\n                return (node.style) ? this._getHeightOrWidth(name, node, false) + 'px' : undefined;\n            }\n            else\n            {\n                return (node.style) ? getComputedStyle(node, null)[name] : undefined;\n            }\n        }\n\n        // set\n        return this.each(function(node)\n        {\n            var obj = {};\n            if (typeof name === 'object') obj = name;\n            else obj[name] = value;\n\n            for (var key in obj)\n            {\n                if (node.style) node.style[key] = obj[key];\n            }\n        });\n    },\n\n    // attr\n    attr: function(name, value, data)\n    {\n        data = (data) ? 'data-' : '';\n\n        if (value === undefined && (typeof name !== 'object'))\n        {\n            var node = this.get();\n            if (node && node.nodeType !== 3)\n            {\n                return (name === 'checked') ? node.checked : this._getBooleanFromStr(node.getAttribute(data + name));\n            }\n            else return;\n        }\n\n        // set\n        return this.each(function(node)\n        {\n            var obj = {};\n            if (typeof name === 'object') obj = name;\n            else obj[name] = value;\n\n            for (var key in obj)\n            {\n                if (node.nodeType !== 3)\n                {\n                    if (key === 'checked') node.checked = obj[key];\n                    else node.setAttribute(data + key, obj[key]);\n                }\n            }\n        });\n    },\n    data: function(name, value)\n    {\n        if (name === undefined)\n        {\n            var reDataAttr = /^data-(.+)$/;\n            var attrs = this.get().attributes;\n\n            var data = {};\n            var replacer = function (g) { return g[1].toUpperCase(); };\n\n            for (var key in attrs)\n            {\n                if (attrs[key] && reDataAttr.test(attrs[key].nodeName))\n                {\n                    var dataName = attrs[key].nodeName.match(reDataAttr)[1];\n                    var val = attrs[key].value;\n                    dataName = dataName.replace(/-([a-z])/g, replacer);\n\n                    if (this._isObjectString(val)) val = this._toObject(val);\n                    else val = (this._isNumber(val)) ? parseFloat(val) : this._getBooleanFromStr(val);\n\n                    data[dataName] = val;\n                }\n            }\n\n            return data;\n        }\n\n        return this.attr(name, value, true);\n    },\n    val: function(value)\n    {\n        if (value === undefined)\n        {\n            var el = this.get();\n            if (el.type && el.type === 'checkbox') return el.checked;\n            else return el.value;\n        }\n\n        return this.each(function(node)\n        {\n            node.value = value;\n        });\n    },\n    removeAttr: function(value)\n    {\n        return this.each(function(node)\n        {\n            var rmAttr = function(name) { if (node.nodeType !== 3) node.removeAttribute(name); };\n            value.split(' ').forEach(rmAttr);\n        });\n    },\n    removeData: function(value)\n    {\n        return this.each(function(node)\n        {\n            var rmData = function(name) { if (node.nodeType !== 3) node.removeAttribute('data-' + name); };\n            value.split(' ').forEach(rmData);\n        });\n    },\n\n    // dataset/dataget\n    dataset: function(key, value)\n    {\n        return this.each(function(node)\n        {\n            DomCache[this.dataindex(node)][key] = value;\n        });\n    },\n    dataget: function(key)\n    {\n        return DomCache[this.dataindex(this.get())][key];\n    },\n    dataindex: function(el)\n    {\n        var cacheIndex = el[DomExpando];\n        var nextCacheIndex = DomCache.length;\n\n        if (!cacheIndex)\n        {\n            cacheIndex = el[DomExpando] = nextCacheIndex;\n            DomCache[cacheIndex] = {};\n        }\n\n        return cacheIndex;\n    },\n\n\n    // class\n    addClass: function(value)\n    {\n        return this._eachClass(value, 'add');\n    },\n    removeClass: function(value)\n    {\n        return this._eachClass(value, 'remove');\n    },\n    toggleClass: function(value)\n    {\n        return this._eachClass(value, 'toggle');\n    },\n    hasClass: function(value)\n    {\n        return this.nodes.some(function(node)\n        {\n            return (node.classList) ? node.classList.contains(value) : false;\n        });\n    },\n\n    // html & text\n    empty: function()\n    {\n        return this.each(function(node)\n        {\n            node.innerHTML = '';\n        });\n    },\n    html: function(html)\n    {\n        return (html === undefined) ? (this.get().innerHTML || '') : this.empty().append(html);\n    },\n    text: function(text)\n    {\n        return (text === undefined) ? (this.get().textContent || '') : this.each(function(node) { node.textContent = text; });\n    },\n\n    // manipulation\n    after: function(html)\n    {\n        return this._inject(html, function(frag, node)\n        {\n            if (typeof frag === 'string')\n            {\n                node.insertAdjacentHTML('afterend', frag);\n            }\n            else\n            {\n                if (node.parentNode !== null) {\n                    for (var i = frag instanceof Node ? [frag] : this._toArray(frag).reverse(), s = 0; s < i.length; s++) {\n                        node.parentNode.insertBefore(i[s], node.nextSibling);\n                    }\n                }\n            }\n\n            return node;\n\n        });\n    },\n    before: function(html)\n    {\n        return this._inject(html, function(frag, node)\n        {\n            if (typeof frag === 'string')\n            {\n                node.insertAdjacentHTML('beforebegin', frag);\n            }\n            else\n            {\n                var elms = (frag instanceof Node) ? [frag] : this._toArray(frag);\n                for (var i = 0; i < elms.length; i++)\n                {\n                    node.parentNode.insertBefore(elms[i], node);\n                }\n            }\n\n            return node;\n        });\n    },\n    append: function(html)\n    {\n        return this._inject(html, function(frag, node)\n        {\n            if (typeof frag === 'string' || typeof frag === 'number')\n            {\n                node.insertAdjacentHTML('beforeend', frag);\n            }\n            else\n            {\n                var elms = (frag instanceof Node) ? [frag] : this._toArray(frag);\n                for (var i = 0; i < elms.length; i++)\n                {\n                    node.appendChild(elms[i]);\n                }\n            }\n\n            return node;\n        });\n    },\n    prepend: function(html)\n    {\n        return this._inject(html, function(frag, node)\n        {\n            if (typeof frag === 'string' || typeof frag === 'number')\n            {\n                node.insertAdjacentHTML('afterbegin', frag);\n            }\n            else\n            {\n                var elms = (frag instanceof Node) ? [frag] : this._toArray(frag).reverse();\n                for (var i = 0; i < elms.length; i++)\n                {\n                    node.insertBefore(elms[i], node.firstChild);\n                }\n            }\n\n            return node;\n        });\n    },\n    wrap: function(html)\n    {\n        return this._inject(html, function(frag, node)\n        {\n            var wrapper = (typeof frag === 'string' || typeof frag === 'number') ? this.create(frag)[0] : (frag instanceof Node) ? frag : this._toArray(frag)[0];\n\n            if (node.parentNode)\n            {\n                node.parentNode.insertBefore(wrapper, node);\n            }\n\n            wrapper.appendChild(node);\n\n            return new Dom(wrapper);\n\n        });\n    },\n    unwrap: function()\n    {\n        return this.each(function(node)\n        {\n            var $node = new Dom(node);\n\n            return $node.replaceWith($node.contents());\n        });\n    },\n    replaceWith: function(html)\n    {\n        return this._inject(html, function(frag, node)\n        {\n            var docFrag = document.createDocumentFragment();\n            var elms = (typeof frag === 'string' || typeof frag === 'number') ? this.create(frag) : (frag instanceof Node) ? [frag] : this._toArray(frag);\n\n            for (var i = 0; i < elms.length; i++)\n            {\n                docFrag.appendChild(elms[i]);\n            }\n\n            var result = docFrag.childNodes[0];\n            if (node.parentNode) {\n                node.parentNode.replaceChild(docFrag, node);\n            }\n\n            return result;\n\n        });\n    },\n    remove: function()\n    {\n        return this.each(function(node)\n        {\n            if (node.parentNode) node.parentNode.removeChild(node);\n        });\n    },\n    clone: function(events)\n    {\n        var nodes = [];\n        this.each(function(node)\n        {\n            var copy = this._clone(node);\n            if (events) copy = this._cloneEvents(node, copy);\n            nodes.push(copy);\n        });\n\n        return new Dom(nodes);\n    },\n\n    // show/hide\n    show: function()\n    {\n        return this.each(function(node)\n        {\n            if (!node.style || !this._hasDisplayNone(node)) return;\n\n            var target = node.getAttribute('domTargetShow');\n            var isHidden = (node.classList) ? node.classList.contains(DomHClass) : false;\n            var isHiddenMobile = (node.classList) ? node.classList.contains(DomHMClass) : false;\n            var type;\n\n            if (isHidden)\n            {\n                type = DomHClass;\n                node.classList.remove(DomHClass);\n            }\n            else if (isHiddenMobile)\n            {\n                type = DomHMClass;\n                node.classList.remove(DomHMClass);\n            }\n            else\n            {\n                node.style.display = (target) ? target : 'block';\n            }\n\n            if (type) node.setAttribute('domTargetHide', type);\n            node.removeAttribute('domTargetShow');\n\n        }.bind(this));\n    },\n    hide: function()\n    {\n        return this.each(function(node)\n        {\n            if (!node.style || this._hasDisplayNone(node)) return;\n\n            var display = node.style.display;\n            var target = node.getAttribute('domTargetHide');\n\n            if (target === DomHClass)\n            {\n                node.classList.add(DomHClass);\n            }\n            else if (target === DomHMClass)\n            {\n                node.classList.add(DomHMClass);\n            }\n            else\n            {\n                if (display !== 'block') node.setAttribute('domTargetShow', display);\n                node.style.display = 'none';\n            }\n\n            node.removeAttribute('domTargetHide');\n\n        });\n    },\n\n    // dimensions\n    scrollTop: function(value)\n    {\n        var node = this.get();\n        var isWindow = (node === window);\n        var isDocument = (node.nodeType === 9);\n        var el = (isDocument) ? (document.scrollingElement || document.body.parentNode || document.body || document.documentElement) : node;\n\n        if (value !== undefined)\n        {\n            if (isWindow) window.scrollTo(0, value);\n            else el.scrollTop = value;\n            return;\n        }\n\n        if (isDocument)\n        {\n            return (typeof window.pageYOffset != 'undefined') ? window.pageYOffset : ((document.documentElement.scrollTop) ? document.documentElement.scrollTop : ((document.body.scrollTop) ? document.body.scrollTop : 0));\n        }\n        else\n        {\n            return (isWindow) ? window.pageYOffset : el.scrollTop;\n        }\n    },\n    offset: function()\n    {\n        return this._getDim('Offset');\n    },\n    position: function()\n    {\n        return this._getDim('Position');\n    },\n    width: function(value, adjust)\n    {\n        return this._getSize('width', 'Width', value, adjust);\n    },\n    height: function(value, adjust)\n    {\n        return this._getSize('height', 'Height', value, adjust);\n    },\n    outerWidth: function()\n    {\n        return this._getInnerOrOuter('width', 'outer');\n    },\n    outerHeight: function()\n    {\n        return this._getInnerOrOuter('height', 'outer');\n    },\n    innerWidth: function()\n    {\n        return this._getInnerOrOuter('width', 'inner');\n    },\n    innerHeight: function()\n    {\n        return this._getInnerOrOuter('height', 'inner');\n    },\n\n    // events\n    click: function()\n    {\n        return this._triggerEvent('click');\n    },\n    focus: function()\n    {\n        return this._triggerEvent('focus');\n    },\n    trigger: function(names)\n    {\n        return this.each(function(node)\n        {\n            var events = names.split(' ');\n            for (var i = 0; i < events.length; i++)\n            {\n                var ev;\n                var opts = { bubbles: true, cancelable: true };\n\n                try {\n                    ev = new window.CustomEvent(events[i], opts);\n                } catch(e) {\n                    ev = document.createEvent('CustomEvent');\n                    ev.initCustomEvent(events[i], true, true);\n                }\n\n                node.dispatchEvent(ev);\n            }\n        });\n    },\n    on: function(names, handler, one)\n    {\n        return this.each(function(node)\n        {\n            var events = names.split(' ');\n            for (var i = 0; i < events.length; i++)\n            {\n                var event = this._getEventName(events[i]);\n                var namespace = this._getEventNamespace(events[i]);\n\n                handler = (one) ? this._getOneHandler(handler, names) : handler;\n                node.addEventListener(event, handler);\n\n                node._e = node._e || {};\n                node._e[namespace] = node._e[namespace] || {};\n                node._e[namespace][event] = node._e[namespace][event] || [];\n                node._e[namespace][event].push(handler);\n            }\n\n        });\n    },\n    one: function(events, handler)\n    {\n        return this.on(events, handler, true);\n    },\n    off: function(names, handler)\n    {\n        var testEvent = function(name, key, event) { return (name === event); };\n        var testNamespace = function(name, key, event, namespace) { return (key === namespace); };\n        var testEventNamespace = function(name, key, event, namespace) { return (name === event && key === namespace); };\n        var testPositive = function() { return true; };\n\n        if (names === undefined)\n        {\n            // ALL\n            return this.each(function(node)\n            {\n                this._offEvent(node, false, false, handler, testPositive);\n            });\n        }\n\n        return this.each(function(node)\n        {\n            var events = names.split(' ');\n\n            for (var i = 0; i < events.length; i++)\n            {\n                var event = this._getEventName(events[i]);\n                var namespace = this._getEventNamespace(events[i]);\n\n                // 1) event without namespace\n                if (namespace === '_events') this._offEvent(node, event, namespace, handler, testEvent);\n                // 2) only namespace\n                else if (!event && namespace !== '_events') this._offEvent(node, event, namespace, handler, testNamespace);\n                // 3) event + namespace\n                else this._offEvent(node, event, namespace, handler, testEventNamespace);\n            }\n        });\n    },\n\n    // form\n    serialize: function(asObject)\n    {\n        var obj = {};\n        var elms = this.get().elements;\n        for (var i = 0; i < elms.length; i++)\n        {\n            var el = elms[i];\n            if (/(checkbox|radio)/.test(el.type) && !el.checked) continue;\n            if (!el.name || el.disabled || el.type === 'file') continue;\n\n            if (el.type === 'select-multiple')\n            {\n                for (var z = 0; z < el.options.length; z++)\n                {\n                    var opt = el.options[z];\n                    if (opt.selected) obj[el.name] = opt.value;\n                }\n            }\n\n            obj[el.name] = (this._isNumber(el.value)) ? parseFloat(el.value) : this._getBooleanFromStr(el.value);\n        }\n\n        return (asObject) ? obj : this._toParams(obj);\n    },\n    ajax: function(success, error)\n    {\n        if (typeof AjaxRequest !== 'undefined')\n        {\n            var method = this.attr('method') || 'post';\n            var options = {\n                url: this.attr('action'),\n                data: this.serialize(),\n                success: success,\n                error: error\n            };\n\n            return new AjaxRequest(method, options);\n        }\n    },\n\n    // private\n    _queryContext: function(selector, context)\n    {\n        context = this._getContext(context);\n\n        return (context.nodeType !== 3 && typeof context.querySelectorAll === 'function') ? context.querySelectorAll(selector) : [];\n    },\n    _query: function(selector, context)\n    {\n        if (context)\n        {\n            return this._queryContext(selector, context);\n        }\n        else if (/^[.#]?[\\w-]*$/.test(selector))\n        {\n            if (selector[0] === '#')\n            {\n                var element = document.getElementById(selector.slice(1));\n                return element ? [element] : [];\n            }\n\n            if (selector[0] === '.')\n            {\n                return document.getElementsByClassName(selector.slice(1));\n            }\n\n            return document.getElementsByTagName(selector);\n        }\n\n        return document.querySelectorAll(selector);\n    },\n    _getContext: function(context)\n    {\n        context = (typeof context === 'string') ? document.querySelector(context) : context;\n\n        return (context && context.sdom) ? context.get() : (context || document);\n    },\n    _inject: function(html, fn)\n    {\n        var len = this.nodes.length;\n        var nodes = [];\n        while (len--)\n        {\n            var res = (typeof html === 'function') ? html.call(this, this.nodes[len]) : html;\n            var el = (len === 0) ? res : this._clone(res);\n            var node = fn.call(this, el, this.nodes[len]);\n\n            if (node)\n            {\n                if (node.sdom) nodes.push(node.get());\n                else nodes.push(node);\n            }\n        }\n\n        return new Dom(nodes);\n    },\n    _cloneEvents: function(node, copy)\n    {\n        var events = node._e;\n        if (events)\n        {\n            copy._e = events;\n            for (var name in events._events)\n            {\n                for (var i = 0; i < events._events[name].length; i++)\n                {\n                    copy.addEventListener(name, events._events[name][i]);\n                }\n            }\n        }\n\n        return copy;\n    },\n    _clone: function(node)\n    {\n        if (typeof node === 'undefined') return;\n        if (typeof node === 'string') return node;\n        else if (node instanceof Node || node.nodeType) return node.cloneNode(true);\n        else if ('length' in node)\n        {\n            return [].map.call(this._toArray(node), function(el) { return el.cloneNode(true); });\n        }\n    },\n    _slice: function(obj)\n    {\n        return (!obj || obj.length === 0) ? [] : (obj.length) ? [].slice.call(obj.nodes || obj) : [obj];\n    },\n    _eachClass: function(value, type)\n    {\n        return this.each(function(node)\n        {\n            if (value)\n            {\n                var setClass = function(name) { if (node.classList) node.classList[type](name); };\n                value.split(' ').forEach(setClass);\n            }\n        });\n    },\n    _triggerEvent: function(name)\n    {\n        var node = this.get();\n        if (node && node.nodeType !== 3) node[name]();\n        return this;\n    },\n    _getOneHandler: function(handler, events)\n    {\n        var self = this;\n        return function()\n        {\n            handler.apply(this, arguments);\n            self.off(events);\n        };\n    },\n    _getEventNamespace: function(event)\n    {\n        var arr = event.split('.');\n        var namespace = (arr[1]) ? arr[1] : '_events';\n        return (arr[2]) ? namespace + arr[2] : namespace;\n    },\n    _getEventName: function(event)\n    {\n        return event.split('.')[0];\n    },\n    _offEvent: function(node, event, namespace, handler, condition)\n    {\n        for (var key in node._e)\n        {\n            for (var name in node._e[key])\n            {\n                if (condition(name, key, event, namespace))\n                {\n                    var handlers = node._e[key][name];\n                    for (var i = 0; i < handlers.length; i++)\n                    {\n                        if (typeof handler !== 'undefined' && handlers[i].toString() !== handler.toString())\n                        {\n                            continue;\n                        }\n\n                        node.removeEventListener(name, handlers[i]);\n                        node._e[key][name].splice(i, 1);\n\n                        if (node._e[key][name].length === 0) delete node._e[key][name];\n                        if (Object.keys(node._e[key]).length === 0) delete node._e[key];\n                    }\n                }\n            }\n        }\n    },\n    _getInnerOrOuter: function(method, type)\n    {\n        return this[method](undefined, type);\n    },\n    _getDocSize: function(node, type)\n    {\n        var body = node.body, html = node.documentElement;\n        return Math.max(body['scroll' + type], body['offset' + type], html['client' + type], html['scroll' + type], html['offset' + type]);\n    },\n    _getSize: function(type, captype, value, adjust)\n    {\n        if (value === undefined)\n        {\n            var el = this.get();\n            if (el.nodeType === 3)      value = 0;\n            else if (el.nodeType === 9) value = this._getDocSize(el, captype);\n            else if (el === window)     value = window['inner' + captype];\n            else                        value = this._getHeightOrWidth(type, el, adjust || 'normal');\n\n            return Math.round(value);\n        }\n\n        return this.each(function(node)\n        {\n            value = parseFloat(value);\n            value = value + this._adjustResultHeightOrWidth(type, node, adjust || 'normal');\n\n            new Dom(node).css(type, value + 'px');\n\n        }.bind(this));\n    },\n    _getHeightOrWidth: function(type, el, adjust)\n    {\n        if (!el) return 0;\n\n        var name = type.charAt(0).toUpperCase() + type.slice(1);\n        var result = 0;\n        var style = getComputedStyle(el, null);\n        var $el = new Dom(el);\n        var $targets = $el.parents().filter(function(node)\n        {\n            return (node.nodeType === 1 && getComputedStyle(node, null).display === 'none') ? node : false;\n        });\n\n        if (style.display === 'none') $targets.add(el);\n        if ($targets.length !== 0)\n        {\n            var fixStyle = 'visibility: hidden !important; display: block !important;';\n            var tmp = [];\n\n            $targets.each(function(node)\n            {\n                var $node = new Dom(node);\n                var thisStyle = $node.attr('style');\n                if (thisStyle !== null) tmp.push(thisStyle);\n                $node.attr('style', (thisStyle !== null) ? thisStyle + ';' + fixStyle : fixStyle);\n            });\n\n            result = $el.get()['offset' + name] - this._adjustResultHeightOrWidth(type, el, adjust);\n\n            $targets.each(function(node, i)\n            {\n                var $node = new Dom(node);\n                if (tmp[i] === undefined) $node.removeAttr('style');\n                else $node.attr('style', tmp[i]);\n            });\n        }\n        else\n        {\n            result = el['offset' + name] - this._adjustResultHeightOrWidth(type, el, adjust);\n        }\n\n        return result;\n    },\n    _adjustResultHeightOrWidth: function(type, el, adjust)\n    {\n        if (!el || adjust === false) return 0;\n\n        var fix = 0;\n        var style = getComputedStyle(el, null);\n        var isBorderBox = (style.boxSizing === \"border-box\");\n\n        if (type === 'height')\n        {\n            if (adjust === 'inner' || (adjust === 'normal' && isBorderBox))\n            {\n                fix += (parseFloat(style.borderTopWidth) || 0) + (parseFloat(style.borderBottomWidth) || 0);\n            }\n\n            if (adjust === 'outer') fix -= (parseFloat(style.marginTop) || 0) + (parseFloat(style.marginBottom) || 0);\n        }\n        else\n        {\n            if (adjust === 'inner' || (adjust === 'normal' && isBorderBox))\n            {\n                fix += (parseFloat(style.borderLeftWidth) || 0) + (parseFloat(style.borderRightWidth) || 0);\n            }\n\n            if (adjust === 'outer') fix -= (parseFloat(style.marginLeft) || 0) + (parseFloat(style.marginRight) || 0);\n        }\n\n        return fix;\n    },\n    _getDim: function(type)\n    {\n        var node = this.get();\n        return (node.nodeType === 3) ? { top: 0, left: 0 } : this['_get' + type](node);\n    },\n    _getPosition: function(node)\n    {\n        return { top: node.offsetTop, left: node.offsetLeft };\n    },\n    _getOffset: function(node)\n    {\n        var rect = node.getBoundingClientRect();\n        var doc = node.ownerDocument;\n\t\tvar docElem = doc.documentElement;\n\t\tvar win = doc.defaultView;\n\n\t\treturn {\n\t\t\ttop: rect.top + win.pageYOffset - docElem.clientTop,\n\t\t\tleft: rect.left + win.pageXOffset - docElem.clientLeft\n\t\t};\n    },\n    _getSibling: function(selector, method)\n    {\n        selector = (selector && selector.sdom) ? selector.get() : selector;\n\n        var isNode = (selector && selector.nodeType);\n        var sibling;\n\n        this.each(function(node)\n        {\n            while (node = node[method])\n            {\n                if ((isNode && node === selector) || new Dom(node).is(selector))\n                {\n                    sibling = node;\n                    return;\n                }\n            }\n        });\n\n        return new Dom(sibling);\n    },\n    _toArray: function(obj)\n    {\n        if (obj instanceof NodeList)\n        {\n            var arr = [];\n            for (var i = 0; i < obj.length; i++)\n            {\n                arr[i] = obj[i];\n            }\n\n            return arr;\n        }\n        else if (obj === undefined) return [];\n        else\n        {\n            return (obj.sdom) ? obj.nodes : obj;\n        }\n    },\n    _toParams: function(obj)\n    {\n        var params = '';\n        for (var key in obj)\n        {\n            params += '&' + this._encodeUri(key) + '=' + this._encodeUri(obj[key]);\n        }\n\n        return params.replace(/^&/, '');\n    },\n    _toObject: function(str)\n    {\n        return (new Function(\"return \" + str))();\n    },\n    _encodeUri: function(str)\n    {\n        return encodeURIComponent(str).replace(/!/g, '%21').replace(/'/g, '%27').replace(/\\(/g, '%28').replace(/\\)/g, '%29').replace(/\\*/g, '%2A').replace(/%20/g, '+');\n    },\n    _isNumber: function(str)\n    {\n        return !isNaN(str) && !isNaN(parseFloat(str));\n    },\n    _isObjectString: function(str)\n    {\n        return (str.search(/^{/) !== -1);\n    },\n    _getBooleanFromStr: function(str)\n    {\n        if (str === 'true') return true;\n        else if (str === 'false') return false;\n\n        return str;\n    },\n    _hasDisplayNone: function(el)\n    {\n        return (el.style.display === 'none') || ((el.currentStyle) ? el.currentStyle.display : getComputedStyle(el, null).display) === 'none';\n    }\n};\n// Unique ID\nvar uuid = 0;\n\n// Wrapper\nvar $R = function(selector, options)\n{\n    return RedactorApp(selector, options, [].slice.call(arguments, 2));\n};\n\n// Globals\n$R.app = [];\n$R.version = '3.5.2';\n$R.options = {};\n$R.modules = {};\n$R.services = {};\n$R.classes = {};\n$R.plugins = {};\n$R.mixins = {};\n$R.modals = {};\n$R.lang = {};\n$R.dom = function(selector, context) { return new Dom(selector, context); };\n$R.ajax = Ajax;\n$R.Dom = Dom;\n$R.keycodes = {\n\tBACKSPACE: 8,\n\tDELETE: 46,\n\tUP: 38,\n\tDOWN: 40,\n\tENTER: 13,\n\tSPACE: 32,\n\tESC: 27,\n\tTAB: 9,\n\tCTRL: 17,\n\tMETA: 91,\n\tSHIFT: 16,\n\tALT: 18,\n\tRIGHT: 39,\n\tLEFT: 37\n};\n$R.env = {\n    'plugin': 'plugins',\n    'module': 'modules',\n    'service': 'services',\n    'class': 'classes',\n    'mixin': 'mixins'\n};\n\n// jQuery Wrapper\n/*eslint-env jquery*/\nif (typeof jQuery !== 'undefined')\n{\n    (function($) { $.fn.redactor = function(options) { return RedactorApp(this.toArray(), options, [].slice.call(arguments, 1)); }; })(jQuery);\n}\n\n// Class\nvar RedactorApp = function(selector, options, args)\n{\n    var namespace = 'redactor';\n    var nodes = (Array.isArray(selector)) ? selector : (selector && selector.nodeType) ? [selector] : document.querySelectorAll(selector);\n    var isApi = (typeof options === 'string' || typeof options === 'function');\n    var value = [];\n    var instance;\n\n    for (var i = 0; i < nodes.length; i++)\n    {\n        var el = nodes[i];\n        var $el = $R.dom(el);\n\n        instance = $el.dataget(namespace);\n        if (!instance && !isApi)\n        {\n            // Initialization\n            instance = new App(el, options, uuid);\n            $el.dataset(namespace, instance);\n            $R.app[uuid] = instance;\n            uuid++;\n        }\n\n        // API\n        if (instance && isApi)\n        {\n            var isDestroy = (options === 'destroy');\n            options = (isDestroy) ? 'stop' : options;\n\n            var methodValue;\n            if (typeof options === 'function')\n            {\n                methodValue = options.apply(instance, args);\n            }\n            else\n            {\n                args.unshift(options);\n                methodValue = instance.api.apply(instance, args);\n            }\n            if (methodValue !== undefined) value.push(methodValue);\n\n            if (isDestroy) $el.dataset(namespace, false);\n        }\n    }\n\n    return (value.length === 0 || value.length === 1) ? ((value.length === 0) ? instance : value[0]) : value;\n};\n\n// add\n$R.add = function(type, name, obj)\n{\n    if (typeof $R.env[type] === 'undefined') return;\n\n    // translations\n    if (obj.translations)\n    {\n        $R.lang = $R.extend(true, {}, $R.lang, obj.translations);\n    }\n\n    // modals\n    if (obj.modals)\n    {\n        $R.modals = $R.extend(true, {}, $R.modals, obj.modals);\n    }\n\n    // mixin\n    if (type === 'mixin')\n    {\n        $R[$R.env[type]][name] = obj;\n    }\n    else\n    {\n        // prototype\n        var F = function() {};\n        F.prototype = obj;\n\n        // mixins\n        if (obj.mixins)\n        {\n            for (var i = 0; i < obj.mixins.length; i++)\n            {\n                $R.inherit(F, $R.mixins[obj.mixins[i]]);\n            }\n        }\n\n        $R[$R.env[type]][name] = F;\n    }\n};\n\n// add lang\n$R.addLang = function(lang, obj)\n{\n    if (typeof $R.lang[lang] === 'undefined')\n    {\n        $R.lang[lang] = {};\n    }\n\n    $R.lang[lang] = $R.extend($R.lang[lang], obj);\n};\n\n// create\n$R.create = function(name)\n{\n    var arr = name.split('.');\n    var args = [].slice.call(arguments, 1);\n\n    var type = 'classes';\n    if (typeof $R.env[arr[0]] !== 'undefined')\n    {\n        type = $R.env[arr[0]];\n        name = arr.slice(1).join('.');\n    }\n\n    // construct\n    var instance = new $R[type][name]();\n\n    // init\n    if (instance.init)\n    {\n        var res = instance.init.apply(instance, args);\n\n        return (res) ? res : instance;\n    }\n\n    return instance;\n};\n\n// inherit\n$R.inherit = function(current, parent)\n{\n    var F = function () {};\n    F.prototype = parent;\n    var f = new F();\n\n    for (var prop in current.prototype)\n    {\n        if (current.prototype.__lookupGetter__(prop)) f.__defineGetter__(prop, current.prototype.__lookupGetter__(prop));\n        else f[prop] = current.prototype[prop];\n    }\n\n    current.prototype = f;\n    current.prototype.super = parent;\n\n    return current;\n};\n\n// error\n$R.error = function(exception)\n{\n    throw exception;\n};\n\n// extend\n$R.extend = function()\n{\n    var extended = {};\n    var deep = false;\n    var i = 0;\n    var length = arguments.length;\n\n    if (Object.prototype.toString.call( arguments[0] ) === '[object Boolean]')\n    {\n        deep = arguments[0];\n        i++;\n    }\n\n    var merge = function(obj)\n    {\n        for (var prop in obj)\n        {\n            if (Object.prototype.hasOwnProperty.call(obj, prop))\n            {\n                if (deep && Object.prototype.toString.call(obj[prop]) === '[object Object]') extended[prop] = $R.extend(true, extended[prop], obj[prop]);\n                else extended[prop] = obj[prop];\n            }\n        }\n    };\n\n    for (; i < length; i++ )\n    {\n        var obj = arguments[i];\n        merge(obj);\n    }\n\n    return extended;\n};\n$R.opts = {\n    animation: true,\n    lang: 'en',\n    direction: 'ltr',\n    spellcheck: true,\n    structure: false,\n    scrollTarget: false,\n    styles: true,\n    stylesClass: 'redactor-styles',\n    placeholder: false,\n\n    source: true,\n    showSource: false,\n\n    inline: false,\n\n    breakline: false,\n    markup: 'p',\n    enterKey: true,\n\n    clickToEdit: false,\n    clickToSave: false,\n    clickToCancel: false,\n\n    focus: false,\n    focusEnd: false,\n\n    minHeight: false, // string, '100px'\n    maxHeight: false, // string, '100px'\n    maxWidth: false, // string, '700px'\n\n    plugins: [], // array\n    callbacks: {},\n\n    // pre & tab\n    preClass: false, // string\n    preSpaces: 4, // or false\n    tabindex: false, // int\n    tabAsSpaces: false, // true or number of spaces\n    tabKey: true,\n\n    // autosave\n    autosave: false, // false or url\n    autosaveName: false,\n    autosaveData: false,\n    autosaveMethod: 'post',\n\n    // toolbar\n    toolbar: true,\n    toolbarFixed: true,\n    toolbarFixedTarget: document,\n    toolbarFixedTopOffset: 0, // pixels\n    toolbarExternal: false, // ID selector\n    toolbarContext: true,\n\n    // air\n    air: false,\n\n    // formatting\n    formatting: ['p', 'blockquote', 'pre', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6'],\n    formattingAdd: false,\n    formattingHide: false,\n\n    // buttons\n    buttons: ['html', 'format', 'bold', 'italic', 'deleted', 'lists', 'image', 'file', 'link'],\n    // + 'line', 'redo', 'undo', 'underline', 'ol', 'ul', 'indent', 'outdent'\n    buttonsTextLabeled: false,\n    buttonsAdd: [],\n    buttonsAddFirst: [],\n    buttonsAddAfter: false,\n    buttonsAddBefore: false,\n    buttonsHide: [],\n    buttonsHideOnMobile: [],\n\n    // image\n    imageUpload: false,\n    imageUploadParam: 'file',\n    imageData: false,\n    imageEditable: true,\n    imageCaption: true,\n    imageLink: true,\n    imagePosition: false,\n    imageResizable: false,\n    imageFloatMargin: '10px',\n    imageFigure: true,\n    imageObserve: true,\n    imageSrcData: false,\n\n    // file\n    fileUpload: false,\n    fileUploadParam: 'file',\n    fileData: false,\n    fileAttachment: false,\n\n    // upload opts\n    uploadData: false,\n    dragUpload: true,\n    multipleUpload: true,\n    clipboardUpload: true,\n    uploadBase64: false,\n\n    // link\n    linkTarget: false,\n    linkTitle: false,\n    linkNewTab: true,\n    linkNofollow: false,\n    linkSize: 30,\n    linkValidation: true,\n\n    // clean\n    cleanOnEnter: true,\n    cleanInlineOnEnter: false,\n    paragraphize: true,\n    removeScript: true,\n    removeNewLines: false,\n    removeComments: true,\n    replaceTags: {\n        'b': 'strong',\n        'i': 'em',\n        'strike': 'del'\n    },\n\n    // paste\n    pastePlainText: false,\n    pasteLinkTarget: false,\n    pasteImages: true,\n    pasteLinks: true,\n    pasteClean: true,\n    pasteKeepStyle: [],\n    pasteKeepClass: [],\n    pasteKeepAttrs: ['td', 'th'],\n    pasteBlockTags: ['pre', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'table', 'tbody', 'thead', 'tfoot', 'th', 'tr', 'td', 'ul', 'ol', 'li', 'blockquote', 'p', 'figure', 'figcaption'],\n    pasteInlineTags: ['a', 'img', 'br', 'strong', 'ins', 'code', 'del', 'span', 'samp', 'kbd', 'sup', 'sub', 'mark', 'var', 'cite', 'small', 'b', 'u', 'em', 'i', 'abbr'],\n\n    // active buttons\n    activeButtons: {\n        b: 'bold',\n        strong: 'bold',\n        i: 'italic',\n        em: 'italic',\n        del: 'deleted',\n        strike: 'deleted',\n        u: 'underline'\n    },\n    activeButtonsAdd: {},\n    activeButtonsObservers: {},\n\n    // autoparser\n    autoparse: true,\n    autoparseStart: true,\n    autoparsePaste: true,\n    autoparseLinks: true,\n    autoparseImages: true,\n    autoparseVideo: true,\n    autoparseHttps: false,\n\n    // shortcodes\n    shortcodes: {\n        'p.': { format: 'p' },\n        'quote.': { format: 'blockquote' },\n        'pre.': { format: 'pre' },\n        'h1.': { format: 'h1' },\n        'h2.': { format: 'h2' },\n        'h3.': { format: 'h3' },\n        'h4.': { format: 'h4' },\n        'h5.': { format: 'h5' },\n        'h6.': { format: 'h6' },\n        //'1.': { format: 'ol' },\n        '*.': { format: 'ul' }\n    },\n    shortcodesAdd: false, // object\n\n    // shortcuts\n    shortcuts: {\n        'ctrl+shift+m, meta+shift+m': { api: 'module.inline.clearformat' },\n        'ctrl+b, meta+b': { api: 'module.inline.format', args: 'b' },\n        'ctrl+i, meta+i': { api: 'module.inline.format', args: 'i' },\n        'ctrl+u, meta+u': { api: 'module.inline.format', args: 'u' },\n        'ctrl+h, meta+h': { api: 'module.inline.format', args: 'sup' },\n        'ctrl+l, meta+l': { api: 'module.inline.format', args: 'sub' },\n        'ctrl+k, meta+k': { api: 'module.link.open' },\n        'ctrl+alt+0, meta+alt+0': { api: 'module.block.format', args: 'p' },\n        'ctrl+alt+1, meta+alt+1': { api: 'module.block.format', args: 'h1' },\n        'ctrl+alt+2, meta+alt+2': { api: 'module.block.format', args: 'h2' },\n        'ctrl+alt+3, meta+alt+3': { api: 'module.block.format', args: 'h3' },\n        'ctrl+alt+4, meta+alt+4': { api: 'module.block.format', args: 'h4' },\n        'ctrl+alt+5, meta+alt+5': { api: 'module.block.format', args: 'h5' },\n        'ctrl+alt+6, meta+alt+6': { api: 'module.block.format', args: 'h6' },\n        'ctrl+shift+7, meta+shift+7': { api: 'module.list.toggle', args: 'ol' },\n        'ctrl+shift+8, meta+shift+8': { api: 'module.list.toggle', args: 'ul' }\n    },\n    shortcutsAdd: false, // object\n\n    // misc\n    grammarly: true,\n    notranslate: false,\n\n    // private\n    bufferLimit: 100,\n    emptyHtml: '<p></p>',\n    markerChar: '\\ufeff',\n    imageTypes: ['image/png', 'image/jpeg', 'image/gif'],\n    imageAttrs: ['alt', 'title', 'src', 'class', 'width', 'height', 'srcset'],\n    inlineTags: ['a', 'span', 'strong', 'strike', 'b', 'u', 'em', 'i', 'code', 'del', 'ins', 'samp', 'kbd', 'sup', 'sub', 'mark', 'var', 'cite', 'small', 'abbr'],\n    blockTags: ['pre', 'ul', 'ol', 'li', 'p', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6',  'dl', 'dt', 'dd', 'div', 'table', 'tbody', 'thead', 'tfoot', 'tr', 'th', 'td', 'blockquote', 'output', 'figcaption', 'figure', 'address', 'section', 'header', 'footer', 'aside', 'article', 'iframe'],\n    regex: {\n        youtube: /^https?\\:\\/\\/(?:www\\.youtube(?:\\-nocookie)?\\.com\\/|m\\.youtube\\.com\\/|youtube\\.com\\/)?(?:ytscreeningroom\\?vi?=|youtu\\.be\\/|vi?\\/|user\\/.+\\/u\\/\\w{1,2}\\/|embed\\/|watch\\?(?:.*\\&)?vi?=|\\&vi?=|\\?(?:.*\\&)?vi?=)([^#\\&\\?\\n\\/<>\"']*)/gi,\n        vimeo: /(http|https)?:\\/\\/(?:www.|player.)?vimeo.com\\/(?:channels\\/(?:\\w+\\/)?|groups\\/(?:[^/]*)\\/videos\\/|album\\/(?:\\d+)\\/video\\/|video\\/|)(\\d+)(?:\\/[a-zA-Z0-9_-]+)?/gi,\n        imageurl: /((https?|www)[^\\s]+\\.)(jpe?g|png|gif)(\\?[^\\s-]+)?/gi,\n        url: /https?:\\/\\/(www\\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b([-a-zA-Z\\u00F0-\\u02AF0-9()!@:%_+.~#?&//=]*)/gi,\n        aurl1: /(\\b(https?|ftp):\\/\\/[-A-Z0-9+&@#\\/%?=~_|!:,.;]*[-A-Z0-9+&@#\\/%=~_|])/gim,\n        aurl2: /(^|[^\\/])(www\\.[\\S]+(\\b|$))/gim\n    },\n    input: true,\n    zindex: false,\n    modes: {\n        \"inline\": {\n            pastePlainText: true,\n            pasteImages: false,\n            enterKey: false,\n            toolbar: false,\n            autoparse: false,\n            source: false,\n            showSource: false,\n            styles: false,\n            air: false\n        },\n        \"original\": {\n            styles: false\n        }\n    }\n};\n$R.lang['en'] = {\n    \"format\": \"Format\",\n    \"image\": \"Image\",\n    \"file\": \"File\",\n    \"link\": \"Link\",\n    \"bold\": \"Bold\",\n    \"italic\": \"Italic\",\n    \"deleted\": \"Strikethrough\",\n    \"underline\": \"Underline\",\n    \"superscript\": \"Superscript\",\n    \"subscript\": \"Subscript\",\n    \"bold-abbr\": \"B\",\n    \"italic-abbr\": \"I\",\n    \"deleted-abbr\": \"S\",\n    \"underline-abbr\": \"U\",\n    \"superscript-abbr\": \"Sup\",\n    \"subscript-abbr\": \"Sub\",\n    \"lists\": \"Lists\",\n    \"link-insert\": \"Insert Link\",\n    \"link-edit\": \"Edit Link\",\n    \"link-in-new-tab\": \"Open link in new tab\",\n    \"unlink\": \"Unlink\",\n    \"cancel\": \"Cancel\",\n    \"close\": \"Close\",\n    \"insert\": \"Insert\",\n    \"save\": \"Save\",\n    \"delete\": \"Delete\",\n    \"text\": \"Text\",\n    \"edit\": \"Edit\",\n    \"title\": \"Alt\",\n    \"paragraph\": \"Normal text\",\n    \"quote\": \"Quote\",\n    \"code\": \"Code\",\n    \"heading1\": \"Heading 1\",\n    \"heading2\": \"Heading 2\",\n    \"heading3\": \"Heading 3\",\n    \"heading4\": \"Heading 4\",\n    \"heading5\": \"Heading 5\",\n    \"heading6\": \"Heading 6\",\n    \"filename\": \"Name\",\n    \"optional\": \"optional\",\n    \"unorderedlist\": \"Unordered List\",\n    \"orderedlist\": \"Ordered List\",\n    \"outdent\": \"Outdent\",\n    \"indent\": \"Indent\",\n    \"horizontalrule\": \"Line\",\n    \"upload\": \"Upload\",\n    \"upload-label\": \"Drop files here or click to upload\",\n    \"accessibility-help-label\": \"Rich text editor\",\n    \"caption\": \"Caption\",\n    \"bulletslist\": \"Bullets\",\n    \"numberslist\": \"Numbers\",\n    \"image-position\": \"Position\",\n    \"none\": \"None\",\n    \"left\": \"Left\",\n    \"right\": \"Right\",\n    \"center\": \"Center\",\n    \"undo\": \"Undo\",\n    \"redo\": \"Redo\"\n};\n$R.buttons = {\n    html: {\n        title: 'HTML',\n        icon: true,\n        api: 'module.source.toggle'\n    },\n    undo: {\n        title: '## undo ##',\n        icon: true,\n        api: 'module.buffer.undo'\n    },\n    redo: {\n        title: '## redo ##',\n        icon: true,\n        api: 'module.buffer.redo'\n    },\n    format: {\n        title: '## format ##',\n        icon: true,\n        dropdown: {\n            p: {\n                title: '## paragraph ##',\n                api: 'module.block.format',\n                args: {\n                    tag: 'p'\n                }\n            },\n            blockquote: {\n                title: '## quote ##',\n                api: 'module.block.format',\n                args: {\n                    tag: 'blockquote'\n                }\n            },\n            pre: {\n                title: '## code ##',\n                api: 'module.block.format',\n                args: {\n                    tag: 'pre'\n                }\n            },\n            h1: {\n                title: '## heading1 ##',\n                api: 'module.block.format',\n                args: {\n                    tag: 'h1'\n                }\n            },\n            h2: {\n                title: '## heading2 ##',\n                api: 'module.block.format',\n                args: {\n                    tag: 'h2'\n                }\n            },\n            h3: {\n                title: '## heading3 ##',\n                api: 'module.block.format',\n                args: {\n                    tag: 'h3'\n                }\n            },\n            h4: {\n                title: '## heading4 ##',\n                api: 'module.block.format',\n                args: {\n                    tag: 'h4'\n                }\n            },\n            h5: {\n                title: '## heading5 ##',\n                api: 'module.block.format',\n                args: {\n                    tag: 'h5'\n                }\n            },\n            h6: {\n                title: '## heading6 ##',\n                api: 'module.block.format',\n                args: {\n                    tag: 'h6'\n                }\n            }\n        }\n    },\n    bold: {\n        title: '## bold-abbr ##',\n        icon: true,\n        tooltip: '## bold ##',\n        api: 'module.inline.format',\n        args: {\n            tag: 'b'\n        }\n    },\n    italic: {\n        title: '## italic-abbr ##',\n        icon: true,\n        tooltip: '## italic ##',\n        api: 'module.inline.format',\n        args: {\n            tag: 'i'\n        }\n    },\n    deleted: {\n        title: '## deleted-abbr ##',\n        icon: true,\n        tooltip: '## deleted ##',\n        api: 'module.inline.format',\n        args: {\n            tag: 'del'\n        }\n    },\n    underline: {\n        title: '## underline-abbr ##',\n        icon: true,\n        tooltip: '## underline ##',\n        api: 'module.inline.format',\n        args: {\n            tag: 'u'\n        }\n    },\n    sup: {\n        title: '## superscript-abbr ##',\n        icon: true,\n        tooltip: '## superscript ##',\n        api: 'module.inline.format',\n        args: {\n            tag: 'sup'\n        }\n    },\n    sub: {\n        title: '## subscript-abbr ##',\n        icon: true,\n        tooltip: '## subscript ##',\n        api: 'module.inline.format',\n        args: {\n            tag: 'sub'\n        }\n    },\n    lists: {\n        title: '## lists ##',\n        icon: true,\n        observe: 'list',\n        dropdown: {\n            observe: 'list',\n            unorderedlist: {\n                title: '&bull; ## unorderedlist ##',\n                api: 'module.list.toggle',\n                args: 'ul'\n            },\n            orderedlist: {\n                title: '1. ## orderedlist ##',\n                api: 'module.list.toggle',\n                args: 'ol'\n            },\n            outdent: {\n                title: '< ## outdent ##',\n                api: 'module.list.outdent'\n            },\n            indent: {\n                title: '> ## indent ##',\n                api: 'module.list.indent'\n            }\n        }\n    },\n    ul: {\n        title: '&bull; ## bulletslist ##',\n        icon: true,\n        api: 'module.list.toggle',\n        observe: 'list',\n        args: 'ul'\n    },\n    ol: {\n        title: '1. ## numberslist ##',\n        icon: true,\n        api: 'module.list.toggle',\n        observe: 'list',\n        args: 'ol'\n    },\n    outdent: {\n        title: '## outdent ##',\n        icon: true,\n        api: 'module.list.outdent',\n        observe: 'list'\n    },\n    indent: {\n        title: '## indent ##',\n        icon: true,\n        api: 'module.list.indent',\n        observe: 'list'\n    },\n    image: {\n        title: '## image ##',\n        icon: true,\n        api: 'module.image.open'\n    },\n    file: {\n        title: '## file ##',\n        icon: true,\n        api: 'module.file.open'\n    },\n    link: {\n        title: '## link ##',\n        icon: true,\n        observe: 'link',\n        dropdown: {\n            observe: 'link',\n            link: {\n                title: '## link-insert ##',\n                api: 'module.link.open'\n            },\n            unlink: {\n                title: '## unlink ##',\n                api: 'module.link.unlink'\n            }\n        }\n    },\n    line: {\n        title: '## horizontalrule ##',\n        icon: true,\n        api: 'module.line.insert'\n    }\n};\nvar App = function(element, options, uuid)\n{\n    this.module = {};\n    this.plugin = {};\n    this.instances = {};\n\n    // start/stop\n    this.started = false;\n    this.stopped = false;\n\n    // environment\n    this.uuid = uuid;\n    this.rootElement = element;\n    this.rootOpts = options;\n    this.dragInside = false;\n    this.dragComponentInside = false;\n    this.keycodes = $R.keycodes;\n    this.namespace = 'redactor';\n    this.$win = $R.dom(window);\n    this.$doc = $R.dom(document);\n    this.$body = $R.dom('body');\n    this.editorReadOnly = false;\n\n    // core services\n    this.opts = $R.create('service.options', options, element);\n    this.lang = $R.create('service.lang', this);\n\n    // build\n    this.buildServices();\n    this.buildModules();\n    this.buildPlugins();\n\n    // start\n    this.start();\n};\n\nApp.prototype = {\n    start: function()\n    {\n        // start\n        this.stopped = false;\n        this.broadcast('start');\n        this.broadcast('startcode');\n\n        if (this.opts.clickToEdit)\n        {\n            this.broadcast('startclicktoedit');\n        }\n        else\n        {\n            this.broadcast('enable');\n            if (this.opts.showSource) this.broadcast('startcodeshow');\n            this.broadcast('enablefocus');\n        }\n\n        // started\n        this.broadcast('started');\n        this.started = true;\n    },\n    stop: function()\n    {\n        this.started = false;\n        this.stopped = true;\n\n        this.broadcast('stop');\n        this.broadcast('disable');\n        this.broadcast('stopped');\n    },\n\n    // started & stopped\n    isStarted: function()\n    {\n        return this.started;\n    },\n    isStopped: function()\n    {\n        return this.stopped;\n    },\n\n    // build\n    buildServices: function()\n    {\n        var core = ['options', 'lang'];\n        var bindable = ['uuid', 'keycodes', 'opts', 'lang', '$win', '$doc', '$body'];\n        var services = [];\n        for (var name in $R.services)\n        {\n            if (core.indexOf(name) === -1)\n            {\n                this[name] = $R.create('service.' + name, this);\n                services.push(name);\n                bindable.push(name);\n            }\n        }\n\n        // binding\n        for (var i = 0; i < services.length; i++)\n        {\n            var service = services[i];\n            for (var z = 0; z < bindable.length; z++)\n            {\n                var inj = bindable[z];\n                if (service !== inj)\n                {\n                    this[service][inj] = this[inj];\n                }\n            }\n        }\n    },\n    buildModules: function()\n    {\n        for (var name in $R.modules)\n        {\n            this.module[name] = $R.create('module.' + name, this);\n            this.instances[name] = this.module[name];\n        }\n    },\n    buildPlugins: function()\n    {\n        var plugins = this.opts.plugins;\n        for (var i = 0; i < plugins.length; i++)\n        {\n            var name = plugins[i];\n            if (typeof $R.plugins[name] !== 'undefined')\n            {\n                this.plugin[name] = $R.create('plugin.' + name, this);\n                this.instances[name] = this.plugin[name];\n            }\n        }\n    },\n\n    // draginside\n    isDragInside: function()\n    {\n        return this.dragInside;\n    },\n    setDragInside: function(dragInside)\n    {\n        this.dragInside = dragInside;\n    },\n    isDragComponentInside: function()\n    {\n        return this.dragComponentInside;\n    },\n    setDragComponentInside: function(dragInside)\n    {\n        this.dragComponentInside = dragInside;\n    },\n    getDragComponentInside: function()\n    {\n        return this.dragComponentInside;\n    },\n\n    // readonly\n    isReadOnly: function()\n    {\n        return this.editorReadOnly;\n    },\n    enableReadOnly: function()\n    {\n        this.editorReadOnly = true;\n        this.broadcast('enablereadonly');\n        this.component.clearActive();\n        this.toolbar.disableButtons();\n    },\n    disableReadOnly: function()\n    {\n        this.editorReadOnly = false;\n        this.broadcast('disablereadonly');\n        this.toolbar.enableButtons();\n    },\n\n    // messaging\n    callMessageHandler: function(instance, name, args)\n    {\n        var arr = name.split('.');\n        var value;\n        if (arr.length === 1)\n        {\n            if (typeof instance['on' + name] === 'function')\n            {\n                value = instance['on' + name].apply(instance, args);\n            }\n        }\n        else\n        {\n            arr[0] = 'on' + arr[0];\n\n            var func = this.utils.checkProperty(instance, arr);\n            if (typeof func === 'function')\n            {\n                value = func.apply(instance, args);\n            }\n        }\n\n        return value;\n    },\n    broadcast: function(name)\n    {\n        var args = [].slice.call(arguments, 1);\n        var returned;\n        for (var moduleName in this.instances)\n        {\n            var value = this.callMessageHandler(this.instances[moduleName], name, args);\n            if (typeof value !== 'undefined') {\n                returned = value;\n            }\n        }\n\n        // callback\n        var cval = this.callback.trigger(name, args);\n\n        return (typeof returned !== 'undefined') ? returned : cval;\n    },\n\n    // callback\n    on: function(name, func)\n    {\n        this.callback.add(name, func);\n    },\n    off: function(name, func)\n    {\n        this.callback.remove(name, func);\n    },\n\n    // api\n    api: function(name)\n    {\n        if (!this.isStarted() && name !== 'start') return;\n        if (this.isReadOnly() && name !== 'disableReadOnly') return;\n\n        this.broadcast('state');\n\n        var args = [].slice.call(arguments, 1);\n        var arr = name.split('.');\n\n        var isApp = (arr.length === 1);\n        var isCallback = (arr[0] === 'on' || arr[0] === 'off');\n        var isService = (!isCallback && arr.length === 2);\n        var isPlugin = (arr[0] === 'plugin');\n        var isModule = (arr[0] === 'module');\n\n        // app\n        if (isApp)\n        {\n            if (typeof this[arr[0]] === 'function')\n            {\n                return this.callInstanceMethod(this, arr[0], args);\n            }\n        }\n        // callback\n        else if (isCallback)\n        {\n            return (arr[0] === 'on') ? this.on(arr[1], args[0]) : this.off(arr[1], args[0] || undefined);\n        }\n        // service\n        else if (isService)\n        {\n            if (this.isInstanceExists(this, arr[0]))\n            {\n                return this.callInstanceMethod(this[arr[0]], arr[1], args);\n            }\n            else\n            {\n                $R.error(new Error('Service \"' + arr[0] + '\" not found'));\n            }\n        }\n        // plugin\n        else if (isPlugin)\n        {\n            if (this.isInstanceExists(this.plugin, arr[1]))\n            {\n                return this.callInstanceMethod(this.plugin[arr[1]], arr[2], args);\n            }\n            else\n            {\n                $R.error(new Error('Plugin \"' + arr[1] + '\" not found'));\n            }\n        }\n        // module\n        else if (isModule)\n        {\n            if (this.isInstanceExists(this.module, arr[1]))\n            {\n                return this.callInstanceMethod(this.module[arr[1]], arr[2], args);\n            }\n            else\n            {\n                $R.error(new Error('Module \"' + arr[1] + '\" not found'));\n            }\n        }\n\n    },\n    isInstanceExists: function(obj, name)\n    {\n        return (typeof obj[name] !== 'undefined');\n    },\n    callInstanceMethod: function(instance, method, args)\n    {\n        if (typeof instance[method] === 'function')\n        {\n            return instance[method].apply(instance, args);\n        }\n    }\n};\n$R.add('mixin', 'formatter', {\n\n    // public\n    buildArgs: function(args)\n    {\n        this.args = {\n            'class': args['class'] || false,\n            'style': args['style'] || false,\n            'attr': args['attr'] || false\n        };\n\n        if (!this.args['class'] && !this.args['style'] && !this.args['attr'])\n        {\n            this.args = false;\n        }\n    },\n    applyArgs: function(nodes, selection)\n    {\n        if (this.args)\n        {\n            nodes = this[this.type](this.args, false, nodes, selection);\n        }\n        else\n        {\n            nodes = this._clearAll(nodes, selection);\n        }\n\n        return nodes;\n    },\n    clearClass: function(tags, nodes)\n    {\n        this.selection.save();\n\n        var $elements = (nodes) ? $R.dom(nodes) : this.getElements(tags, true);\n        $elements.removeAttr('class');\n\n        nodes = this._unwrapSpanWithoutAttr($elements.getAll());\n\n        this.selection.restore();\n\n        return nodes;\n    },\n    clearStyle: function(tags, nodes)\n    {\n        this.selection.save();\n\n        var $elements = (nodes) ? $R.dom(nodes) : this.getElements(tags, true);\n        $elements.removeAttr('style');\n\n        nodes = this._unwrapSpanWithoutAttr($elements.getAll());\n\n        this.selection.restore();\n\n        return nodes;\n    },\n    clearAttr: function(tags, nodes)\n    {\n        this.selection.save();\n\n        var $elements = (nodes) ? $R.dom(nodes) : this.getElements(tags, true);\n        this._removeAllAttr($elements);\n\n        nodes = this._unwrapSpanWithoutAttr($elements.getAll());\n\n        this.selection.restore();\n\n        return nodes;\n    },\n    set: function(args, tags, nodes, selection)\n    {\n        if (selection !== false) this.selection.save();\n\n        var $elements = (nodes) ? $R.dom(nodes) : this.getElements(tags);\n\n        if (args['class'])\n        {\n            $elements.removeAttr('class');\n            $elements.addClass(args['class']);\n        }\n\n        if (args['style'])\n        {\n            $elements.removeAttr('style');\n            $elements.css(args['style']);\n            $elements.each(function(node)\n            {\n                var $node = $R.dom(node);\n                $node.attr('data-redactor-style-cache', $node.attr('style'));\n            });\n        }\n\n        if (args['attr'])\n        {\n            this._removeAllAttr($elements);\n            $elements.attr(args['attr']);\n        }\n\n        if (selection !== false) this.selection.restore();\n\n        return $elements.getAll();\n    },\n    toggle: function(args, tags, nodes, selection)\n    {\n        if (selection !== false) this.selection.save();\n\n        var $elements = (nodes) ? $R.dom(nodes) : this.getElements(tags);\n\n        if (args['class'])\n        {\n            $elements.toggleClass(args['class']);\n            $elements.each(function(node)\n            {\n                if (node.className === '') node.removeAttribute('class');\n            });\n        }\n\n        var params;\n        if (args['style'])\n        {\n            params = args['style'];\n            $elements.each(function(node)\n            {\n                var $node = $R.dom(node);\n                for (var key in params)\n                {\n                    var newVal = params[key];\n                    var oldVal = $node.css(key);\n\n                    oldVal = (this.utils.isRgb(oldVal)) ? this.utils.rgb2hex(oldVal) : oldVal.replace(/\"/g, '');\n                    newVal = (this.utils.isRgb(newVal)) ? this.utils.rgb2hex(newVal) : newVal.replace(/\"/g, '');\n\n                    oldVal = this.utils.hex2long(oldVal);\n                    newVal = this.utils.hex2long(newVal);\n\n                    var compareNew = (typeof newVal === 'string') ? newVal.toLowerCase() : newVal;\n                    var compareOld = (typeof oldVal === 'string') ? oldVal.toLowerCase() : oldVal;\n\n                    if (compareNew === compareOld) $node.css(key, '');\n                    else $node.css(key, newVal);\n                }\n\n                this._convertStyleQuotes($node);\n                if (this.utils.removeEmptyAttr(node, 'style'))\n                {\n                    $node.removeAttr('data-redactor-style-cache');\n                }\n                else\n                {\n                    $node.attr('data-redactor-style-cache', $node.attr('style'));\n                }\n\n            }.bind(this));\n        }\n\n        if (args['attr'])\n        {\n            params = args['attr'];\n            $elements.each(function(node)\n            {\n                var $node = $R.dom(node);\n                for (var key in params)\n                {\n                    if ($node.attr(key)) $node.removeAttr(key);\n                    else $node.attr(key, params[key]);\n                }\n            });\n\n        }\n\n        if (selection !== false) this.selection.restore();\n\n        return $elements.getAll();\n    },\n    add: function(args, tags, nodes, selection)\n    {\n        if (selection !== false) this.selection.save();\n\n        var $elements = (nodes) ? $R.dom(nodes) : this.getElements(tags);\n\n        if (args['class'])\n        {\n            $elements.addClass(args['class']);\n        }\n\n        if (args['style'])\n        {\n            var params = args['style'];\n            $elements.each(function(node)\n            {\n                var $node = $R.dom(node);\n                $node.css(params);\n                $node.attr('data-redactor-style-cache', $node.attr('style'));\n\n                this._convertStyleQuotes($node);\n\n            }.bind(this));\n        }\n\n        if (args['attr'])\n        {\n            $elements.attr(args['attr']);\n        }\n\n        if (selection !== false) this.selection.restore();\n\n        return $elements.getAll();\n    },\n    remove: function(args, tags, nodes, selection)\n    {\n        if (selection !== false) this.selection.save();\n\n        var $elements = (nodes) ? $R.dom(nodes) : this.getElements(tags);\n\n        if (args['class'])\n        {\n            $elements.removeClass(args['class']);\n            $elements.each(function(node)\n            {\n                if (node.className === '') node.removeAttribute('class');\n            });\n        }\n\n        if (args['style'])\n        {\n            var name = args['style'];\n            $elements.each(function(node)\n            {\n                var $node = $R.dom(node);\n                $node.css(name, '');\n\n                if (this.utils.removeEmptyAttr(node, 'style'))\n                {\n                    $node.removeAttr('data-redactor-style-cache');\n                }\n                else\n                {\n                    $node.attr('data-redactor-style-cache', $node.attr('style'));\n                }\n\n            }.bind(this));\n        }\n\n        if (args['attr'])\n        {\n            $elements.removeAttr(args['attr']);\n        }\n\n        nodes = this._unwrapSpanWithoutAttr($elements.getAll());\n\n        if (selection !== false) this.selection.restore();\n\n        return nodes;\n    },\n\n    // private\n    _removeAllAttr: function($elements)\n    {\n        $elements.each(function(node)\n        {\n            for (var i = node.attributes.length; i-->0;)\n            {\n                var nodeAttr = node.attributes[i];\n                var name = nodeAttr.name;\n                if (name !== 'style' && name !== 'class')\n                {\n                    node.removeAttributeNode(nodeAttr);\n                }\n            }\n        });\n    },\n    _convertStyleQuotes: function($node)\n    {\n        var style = $node.attr('style');\n        if (style) $node.attr('style', style.replace(/\"/g, '\\''));\n    },\n    _clearAll: function(nodes, selection)\n    {\n        if (selection !== false) this.selection.save();\n\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var node = nodes[i];\n            while (node.attributes.length > 0)\n            {\n                node.removeAttribute(node.attributes[0].name);\n            }\n        }\n\n        nodes = this._unwrapSpanWithoutAttr(nodes);\n\n        if (selection !== false) this.selection.restore();\n\n        return nodes;\n    },\n    _unwrapSpanWithoutAttr: function(nodes)\n    {\n        var finalNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var node = nodes[i];\n            var len = node.attributes.length;\n            if (len <= 0 && node.nodeType !== 3 && node.tagName === 'SPAN')\n            {\n                $R.dom(node).unwrap();\n            }\n            else\n            {\n                finalNodes.push(node);\n            }\n        }\n\n        return finalNodes;\n    }\n});\n$R.add('mixin', 'dom', $R.Dom.prototype);\n$R.add('mixin', 'component', {\n    get cmnt()\n    {\n        return true;\n    }\n});\n$R.add('service', 'options', {\n    init: function(options, element)\n    {\n        var $el = $R.dom(element);\n        var opts = $R.extend({}, $R.opts, (element) ? $el.data() : {}, $R.options);\n        opts = $R.extend(true, opts, options);\n\n        return opts;\n    }\n});\n$R.add('service', 'lang', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n\n        // build\n        this.vars = this._build(this.opts.lang);\n    },\n\n    // public\n    rebuild: function(lang)\n    {\n        this.opts.lang = lang;\n        this.vars = this._build(lang);\n    },\n    extend: function(obj)\n    {\n        this.vars = $R.extend(this.vars, obj);\n    },\n    parse: function(str)\n    {\n        if (str === undefined)\n        {\n            return '';\n        }\n\n        var matches = str.match(/## (.*?) ##/g);\n        if (matches)\n        {\n            for (var i = 0; i < matches.length; i++)\n            {\n                var key = matches[i].replace(/^##\\s/g, '').replace(/\\s##$/g, '');\n                str = str.replace(matches[i], this.get(key));\n            }\n        }\n\n        return str;\n    },\n    get: function(name)\n    {\n        var str = '';\n        if (typeof this.vars[name] !== 'undefined')\n        {\n            str = this.vars[name];\n        }\n        else if (this.opts.lang !== 'en' && typeof $R.lang['en'][name] !== 'undefined')\n        {\n            str = $R.lang['en'][name];\n        }\n\n        return str;\n    },\n\n    // private\n    _build: function(lang)\n    {\n        var vars = $R.lang['en'];\n        if (lang !== 'en')\n        {\n            vars = ($R.lang[lang] !== undefined) ? $R.lang[lang] : vars;\n        }\n\n        return vars;\n    }\n});\n$R.add('service', 'callback', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n\n        // local\n        this.callbacks = {};\n\n        // build\n        if (this.opts.callbacks)\n        {\n            this._set(this.opts.callbacks, '');\n        }\n    },\n    stop: function()\n    {\n        this.callbacks = {};\n    },\n    add: function(name, handler)\n    {\n        if (!this.callbacks[name]) this.callbacks[name] = [];\n        this.callbacks[name].push(handler);\n    },\n    remove: function(name, handler)\n    {\n        if (handler === undefined)\n        {\n            delete this.callbacks[name];\n        }\n        else\n        {\n            for (var i = 0; i < this.callbacks[name].length; i++)\n            {\n                this.callbacks[name].splice(i, 1);\n            }\n\n            if (Object.keys(this.callbacks[name]).length === 0) delete this.callbacks[name];\n        }\n    },\n    trigger: function(name, args)\n    {\n        var value = this._loop(name, args, this.callbacks);\n        return (typeof value === 'undefined' && args && args[0] !== false) ? args[0] : value;\n    },\n\n    // private\n    _set: function(obj, name)\n    {\n        for (var key in obj)\n        {\n            var path = (name === '') ? key : name + '.' + key;\n            if (typeof obj[key] === 'object')\n            {\n                this._set(obj[key], path);\n            }\n            else\n            {\n                this.callbacks[path] = [];\n                this.callbacks[path].push(obj[key]);\n            }\n        }\n    },\n    _loop: function(name, args, obj)\n    {\n        var value;\n        for (var key in obj)\n        {\n            if (name === key)\n            {\n                for (var i = 0; i < obj[key].length; i++)\n                {\n                    value = obj[key][i].apply(this.app, args);\n\n                }\n            }\n        }\n\n        return value;\n    }\n});\n$R.add('service', 'animate', {\n    init: function(app)\n    {\n        this.animationOpt = app.opts.animation;\n    },\n    start: function(element, animation, options, callback)\n    {\n        var defaults = {\n            duration: false,\n            iterate: false,\n            delay: false,\n            timing: false,\n            prefix: 'redactor-'\n        };\n\n        defaults = (typeof options === 'function') ? defaults : $R.extend(defaults, options);\n        callback = (typeof options === 'function') ? options : callback;\n\n        // play\n        return new $R.AnimatePlay(element, animation, defaults, callback, this.animationOpt);\n    },\n    stop: function(element)\n    {\n        this.$el = $R.dom(element);\n        this.$el.removeClass('redactor-animated');\n\n        var effect = this.$el.attr('redactor-animate-effect');\n        this.$el.removeClass(effect);\n\n        this.$el.removeAttr('redactor-animate-effect');\n        var hide = this.$el.attr('redactor-animate-hide');\n        if (hide)\n        {\n            this.$el.addClass(hide).removeAttr('redactor-animate-hide');\n        }\n\n        this.$el.off('animationend webkitAnimationEnd');\n    }\n});\n\n$R.AnimatePlay = function(element, animation, defaults, callback, animationOpt)\n{\n    this.hidableEffects = ['fadeOut', 'flipOut', 'slideUp', 'zoomOut', 'slideOutUp', 'slideOutRight', 'slideOutLeft'];\n    this.prefixes = ['', '-webkit-'];\n\n    this.$el = $R.dom(element);\n    this.$body = $R.dom('body');\n    this.callback = callback;\n    this.animation = (!animationOpt) ? this.buildAnimationOff(animation) : animation;\n    this.defaults = defaults;\n\n    if (this.animation === 'slideUp')\n    {\n        this.$el.height(this.$el.height());\n    }\n\n    // animate\n    return (this.isInanimate()) ? this.inanimate() : this.animate();\n};\n\n$R.AnimatePlay.prototype = {\n    buildAnimationOff: function(animation)\n    {\n        return (this.isHidable(animation)) ? 'hide' : 'show';\n    },\n    buildHideClass: function()\n    {\n        return 'redactor-animate-hide';\n    },\n    isInanimate: function()\n    {\n        return (this.animation === 'show' || this.animation === 'hide');\n    },\n    isAnimated: function()\n    {\n        return this.$el.hasClass('redactor-animated');\n    },\n    isHidable: function(effect)\n    {\n        return (this.hidableEffects.indexOf(effect) !== -1);\n    },\n    inanimate: function()\n    {\n        this.defaults.timing = 'linear';\n\n        var hide;\n        if (this.animation === 'show')\n        {\n            hide = this.buildHideClass();\n            this.$el.attr('redactor-animate-hide', hide);\n            this.$el.removeClass(hide);\n        }\n        else\n        {\n            hide = this.$el.attr('redactor-animate-hide');\n            this.$el.addClass(hide).removeAttr('redactor-animate-hide');\n        }\n\n        if (typeof this.callback === 'function') this.callback(this);\n\n        return this;\n    },\n    animate: function()\n    {\n        var delay = (this.defaults.delay) ? this.defaults.delay : 0;\n        setTimeout(function()\n        {\n            this.$body.addClass('no-scroll-x');\n            this.$el.addClass('redactor-animated');\n            if (!this.$el.attr('redactor-animate-hide'))\n            {\n                var hide = this.buildHideClass();\n                this.$el.attr('redactor-animate-hide', hide);\n                this.$el.removeClass(hide);\n            }\n\n            this.$el.addClass(this.defaults.prefix + this.animation);\n            this.$el.attr('redactor-animate-effect', this.defaults.prefix + this.animation);\n\n            this.set(this.defaults.duration + 's', this.defaults.iterate, this.defaults.timing);\n            this.complete();\n\n        }.bind(this), delay * 1000);\n\n        return this;\n    },\n    set: function(duration, iterate, timing)\n    {\n        var len = this.prefixes.length;\n\n        while (len--)\n        {\n            if (duration !== false || duration === '') this.$el.css(this.prefixes[len] + 'animation-duration', duration);\n            if (iterate !== false || iterate === '') this.$el.css(this.prefixes[len] + 'animation-iteration-count', iterate);\n            if (timing !== false || timing === '') this.$el.css(this.prefixes[len] + 'animation-timing-function', timing);\n        }\n    },\n    clean: function()\n    {\n        this.$body.removeClass('no-scroll-x');\n        this.$el.removeClass('redactor-animated');\n        this.$el.removeClass(this.defaults.prefix + this.animation);\n        this.$el.removeAttr('redactor-animate-effect');\n\n        this.set('', '', '');\n    },\n    complete: function()\n    {\n        this.$el.one('animationend webkitAnimationEnd', function()\n        {\n            if (this.$el.hasClass(this.defaults.prefix + this.animation)) this.clean();\n            if (this.isHidable(this.animation))\n            {\n                var hide = this.$el.attr('redactor-animate-hide');\n                this.$el.addClass(hide).removeAttr('redactor-animate-hide');\n            }\n\n            if (this.animation === 'slideUp') this.$el.height('');\n            if (typeof this.callback === 'function') this.callback(this.$el);\n\n        }.bind(this));\n    }\n};\n$R.add('service', 'caret', {\n    init: function(app)\n    {\n        this.app = app;\n    },\n\n    // set\n    setStart: function(el)\n    {\n        this._setCaret('Start', el);\n    },\n    setEnd: function(el)\n    {\n        this._setCaret('End', el);\n    },\n    setBefore: function(el)\n    {\n        this._setCaret('Before', el);\n    },\n    setAfter: function(el)\n    {\n        this._setCaret('After', el);\n    },\n\n    // is\n    isStart: function(el)\n    {\n        return this._isStartOrEnd(el, 'First');\n    },\n    isEnd: function(el)\n    {\n        return this._isStartOrEnd(el, 'Last');\n    },\n\n    // set side\n    setAtEnd: function(node)\n    {\n        var data = this.inspector.parse(node);\n        var tag = data.getTag();\n        var range = document.createRange();\n        if (this._isInPage(node))\n        {\n            if (tag === 'a')\n            {\n                var textNode = this.utils.createInvisibleChar();\n                $R.dom(node).after(textNode);\n\n                range.selectNodeContents(textNode);\n                range.collapse(true);\n            }\n            else\n            {\n                range.selectNodeContents(node);\n                range.collapse(false);\n            }\n\n            this.selection.setRange(range);\n        }\n    },\n    setAtStart: function(node)\n    {\n\t\tvar range = document.createRange();\n\t\tvar data = this.inspector.parse(node);\n        if (this._isInPage(node))\n        {\n            range.setStart(node, 0);\n            range.collapse(true);\n\n            if (data.isInline())\n            {\n                var textNode = this.utils.createInvisibleChar();\n                range.insertNode(textNode);\n                range.selectNodeContents(textNode);\n                range.collapse(false);\n            }\n\n            this.selection.setRange(range);\n        }\n    },\n    setAtBefore: function(node)\n    {\n        var data = this.inspector.parse(node);\n        var range = document.createRange();\n        if (this._isInPage(node))\n        {\n            range.setStartBefore(node);\n            range.collapse(true);\n\n            if (data.isInline())\n            {\n                var textNode = this.utils.createInvisibleChar();\n                node.parentNode.insertBefore(textNode, node);\n                range.selectNodeContents(textNode);\n                range.collapse(false);\n            }\n\n            this.selection.setRange(range);\n        }\n    },\n    setAtAfter: function(node)\n    {\n\n        var range = document.createRange();\n        if (this._isInPage(node))\n        {\n            range.setStartAfter(node);\n            range.collapse(true);\n\n            var textNode = this.utils.createInvisibleChar();\n            range.insertNode(textNode);\n            range.selectNodeContents(textNode);\n            range.collapse(false);\n\n            this.selection.setRange(range);\n        }\n    },\n    setAtPrev: function(node)\n    {\n        var prev = node.previousSibling;\n        if (prev)\n        {\n            prev = (prev.nodeType === 3 && this._isEmptyTextNode(prev)) ? prev.previousElementSibling : prev;\n            if (prev) this.setEnd(prev);\n        }\n    },\n    setAtNext: function(node)\n    {\n        var next = node.nextSibling;\n        if (next)\n        {\n            next = (next.nodeType === 3 && this._isEmptyTextNode(next)) ? next.nextElementSibling : next;\n            if (next) this.setStart(next);\n        }\n    },\n\n    // private\n    _setCaret: function(type, el)\n    {\n        var data = this.inspector.parse(el);\n        var node = data.getNode();\n\n        if (node)\n        {\n            this.component.clearActive();\n            this['_set' + type](node, data, data.getTag());\n        }\n    },\n    _setStart: function(node, data, tag)\n    {\n        // 1. text\n        if (data.isText())\n        {\n            this.editor.focus();\n            return this.setAtStart(node);\n        }\n        // 2. ul, ol\n        else if (tag === 'ul' || tag === 'ol')\n        {\n            node = data.findFirstNode('li');\n\n            var item = this.utils.getFirstElement(node);\n            var dataItem = this.inspector.parse(item);\n            if (item && dataItem.isComponent())\n            {\n                return this.setStart(dataItem.getComponent());\n            }\n        }\n        // 3. dl\n        else if (tag === 'dl')\n        {\n            node = data.findFirstNode('dt');\n        }\n        // 4. br / hr\n        else if (tag === 'br' || tag === 'hr')\n        {\n            return this.setBefore(node);\n        }\n        // 5. th, td\n        else if (tag === 'td' || tag === 'th')\n        {\n            var el = data.getFirstElement(node);\n            if (el)\n            {\n                return this.setStart(el);\n            }\n        }\n        // 6. table\n        else if (tag === 'table' || tag === 'tr')\n        {\n            return this.setStart(data.findFirstNode('th, td'));\n        }\n        // 7. figure code\n        else if (data.isComponentType('code') && !data.isFigcaption())\n        {\n            var code = data.findLastNode('pre, code');\n\n            this.editor.focus();\n            return this.setAtStart(code);\n        }\n        // 8. table component\n        else if (tag === 'figure' && data.isComponentType('table'))\n        {\n            var table = data.getTable();\n            var tableData = this.inspector.parse(table);\n\n            return this.setStart(tableData.findFirstNode('th, td'));\n        }\n        // 9. non editable components\n        else if (!data.isComponentType('table') && data.isComponent() && !data.isFigcaption())\n        {\n            return this.component.setActive(node);\n        }\n\n        this.editor.focus();\n\n        // set\n        if (!this._setInline(node, 'Start'))\n        {\n            this.setAtStart(node);\n        }\n    },\n    _setEnd: function(node, data, tag)\n    {\n        // 1. text\n        if (data.isText())\n        {\n            this.editor.focus();\n            return this.setAtEnd(node);\n        }\n        // 2. ul, ol\n        else if (tag === 'ul' || tag === 'ol')\n        {\n            node = data.findLastNode('li');\n\n            var item = this.utils.getLastElement(node);\n            var dataItem = this.inspector.parse(item);\n            if (item && dataItem.isComponent())\n            {\n                return this.setEnd(dataItem.getComponent());\n            }\n        }\n        // 3. dl\n        else if (tag === 'dl')\n        {\n            node = data.findLastNode('dd');\n        }\n        // 4. br / hr\n        else if (tag === 'br' || tag === 'hr')\n        {\n            return this.setAfter(node);\n        }\n        // 5. th, td\n        else if (tag === 'td' || tag === 'th')\n        {\n            var el = data.getLastElement();\n            if (el)\n            {\n                return this.setEnd(el);\n            }\n        }\n        // 6. table\n        else if (tag === 'table' || tag === 'tr')\n        {\n            return this.setEnd(data.findLastNode('th, td'));\n        }\n        // 7. figure code\n        else if (data.isComponentType('code') && !data.isFigcaption())\n        {\n            var code = data.findLastNode('pre, code');\n\n            this.editor.focus();\n            return this.setAtEnd(code);\n        }\n        // 8. table component\n        else if (tag === 'figure' && data.isComponentType('table'))\n        {\n            var table = data.getTable();\n            var tableData = this.inspector.parse(table);\n\n            return this.setEnd(tableData.findLastNode('th, td'));\n        }\n        // 9. non editable components\n        else if (!data.isComponentType('table') && data.isComponent() && !data.isFigcaption())\n        {\n            return this.component.setActive(node);\n        }\n\n        this.editor.focus();\n\n        // set\n        if (!this._setInline(node, 'End'))\n        {\n            // is element empty\n            if (this.utils.isEmpty(node))\n            {\n                return this.setStart(node);\n            }\n\n            this.setAtEnd(node);\n        }\n    },\n    _setBefore: function(node, data, tag)\n    {\n        // text\n        if (node.nodeType === 3)\n        {\n            return this.setAtBefore(node);\n        }\n        // inline\n        else if (data.isInline())\n        {\n            return this.setAtBefore(node);\n        }\n        // td / th\n        else if (data.isFirstTableCell())\n        {\n            return this.setAtPrev(data.getComponent());\n        }\n        else if (tag === 'td' || tag === 'th')\n        {\n            return this.setAtPrev(node);\n        }\n        // li\n        else if (data.isFirstListItem())\n        {\n            return this.setAtPrev(data.getList());\n        }\n        // figcaption\n        else if (data.isFigcaption())\n        {\n            return this.setStart(data.getComponent());\n        }\n        // component\n        else if (!data.isComponentType('table') && data.isComponent())\n        {\n            return this.setAtPrev(data.getComponent());\n        }\n        // block\n        else if (data.isBlock())\n        {\n            return this.setAtPrev(node);\n        }\n\n        this.editor.focus();\n        this.setAtBefore(node);\n\n    },\n    _setAfter: function(node, data, tag)\n    {\n        // text\n        if (node.nodeType === 3)\n        {\n            return this.setAtAfter(node);\n        }\n        // inline\n        else if (data.isInline())\n        {\n            return this.setAtAfter(node);\n        }\n        // td / th\n        else if (data.isLastTableCell())\n        {\n            return this.setAtNext(data.getComponent());\n        }\n        else if (tag === 'td' || tag === 'th')\n        {\n            return this.setAtNext(node);\n        }\n        // li\n        else if (data.isFirstListItem())\n        {\n            return this.setAtNext(data.getList());\n        }\n        // component\n        else if (!data.isComponentType('table') && data.isComponent())\n        {\n            return this.setAtNext(data.getComponent());\n        }\n        // block\n        else if (data.isBlock())\n        {\n            return this.setAtNext(node);\n        }\n\n        this.editor.focus();\n        this.setAtAfter(node);\n    },\n    _setInline: function(node, type)\n    {\n        // is first element inline (FF only)\n        var inline = this._hasInlineChild(node, (type === 'Start') ? 'first' : 'last');\n        if (inline)\n        {\n            if (type === 'Start')\n            {\n                this.setStart(inline);\n            }\n            else\n            {\n                this.setEnd(inline);\n            }\n\n            return true;\n        }\n    },\n    _isStartOrEnd: function(el, type)\n    {\n        var node = this.utils.getNode(el);\n        if (!node) return false;\n\n        var data = this.inspector.parse(node);\n        node = this._getStartEndNode(node, data, type);\n\n        if (node && (node.nodeType !== 3 && node.tagName !== 'LI'))\n        {\n            var html = (node.nodeType === 3) ? node.textContent : node.innerHTML;\n            html = this.utils.trimSpaces(html);\n            if (html === '') return true;\n        }\n\n        if (!data.isFigcaption() && data.isComponent() && !data.isComponentEditable())\n        {\n            return true;\n        }\n\n        var offset = this.offset.get(node, true);\n        if (offset)\n        {\n            return (type === 'First') ? (offset.start === 0) : (offset.end === this.offset.size(node, true));\n        }\n        else\n        {\n            return false;\n        }\n    },\n    _isInPage: function(node)\n    {\n        if (node && node.nodeType)\n        {\n            return (node === document.body) ? false : document.body.contains(node);\n        }\n        else\n        {\n            return false;\n        }\n    },\n    _hasInlineChild: function(el, pos)\n    {\n        var data = this.inspector.parse(el);\n        var node = (pos === 'first') ? data.getFirstNode() : data.getLastNode();\n        var $node = $R.dom(node);\n\n        if (node && node.nodeType !== 3\n            && this.inspector.isInlineTag(node.tagName)\n            && !$node.hasClass('redactor-component')\n             && !$node.hasClass('non-editable'))\n        {\n            return node;\n        }\n    },\n    _isEmptyTextNode: function(node)\n    {\n        var text = node.textContent.trim().replace(/\\n/, '');\n        text = this.utils.removeInvisibleChars(text);\n\n        return (text === '');\n    },\n    _getStartEndNode: function(node, data, type)\n    {\n        if (data.isFigcaption())\n        {\n            node = data.getFigcaption();\n        }\n        else if (data.isTable())\n        {\n            node = data['find' + type + 'Node']('th, td');\n        }\n        else if (data.isList())\n        {\n            node = data['find' + type + 'Node']('li');\n        }\n        else if (data.isComponentType('code'))\n        {\n            node = data.findLastNode('pre, code');\n        }\n\n        return node;\n    }\n});\nvar containsNode = function containsNode(node) {\n    return document.getSelection().containsNode(node, true);\n};\n\nvar containsNodePolyfill = function polyfill(node) {\n    var selection = document.getSelection();\n    var start = selection.anchorNode.parentNode;\n    var finalnode = selection.focusNode.parentNode;\n    var rectSelection = selection.getRangeAt(0).getBoundingClientRect();\n    var rectBlock = node.getBoundingClientRect();\n\n    if ($R.dom(start).closest(node).length) {\n        return true;\n    }\n\n    if ($R.dom(finalnode).closest(node).length) {\n        return true;\n    }\n\n    if (rectSelection.top < rectBlock.top && rectSelection.height > rectBlock.height) {\n        return true;\n    }\n\n    return false;\n};\n\nif (!('containsNode' in Selection.prototype)) {\n    containsNode = containsNodePolyfill;\n}\n\n$R.add('service', 'selection', {\n    init: function(app)\n    {\n        this.app = app;\n    },\n    // is\n    is: function()\n    {\n        var sel = this.get();\n        if (sel)\n        {\n            var node = sel.anchorNode;\n\n            return ($R.dom(node).closest('.redactor-in-' + this.uuid).length !== 0 || node === this.editor.getElement().get());\n        }\n\n        return false;\n    },\n    isCollapsed: function()\n    {\n        var sel = this.get();\n        var range = this.getRange();\n\n        if (sel && sel.isCollapsed) return true;\n        else if (range && range.toString().length === 0) return true;\n\n        return false;\n    },\n    isBackwards: function()\n    {\n        var backwards = false;\n        var sel = this.get();\n\n        if (sel && !sel.isCollapsed)\n        {\n            var range = document.createRange();\n            range.setStart(sel.anchorNode, sel.anchorOffset);\n            range.setEnd(sel.focusNode, sel.focusOffset);\n            backwards = range.collapsed;\n            range.detach();\n        }\n\n        return backwards;\n    },\n    isIn: function(el)\n    {\n        var node = $R.dom(el).get();\n        var current = this.getCurrent();\n\n        return (current && node) ? node.contains(current) : false;\n    },\n    isText: function()\n    {\n        var sel = this.get();\n        if (sel)\n        {\n            var el = sel.anchorNode;\n            var block = this.getBlock(el);\n            var blocks = this.getBlocks();\n\n            // td, th or hasn't block\n            if ((block && this.inspector.isTableCellTag(block.tagName)) || (block === false && blocks.length === 0))\n            {\n                return true;\n            }\n        }\n\n        return false;\n    },\n    isAll: function(el)\n    {\n        var node = this.utils.getNode(el);\n        if (!node) return false;\n\n        var isEditor = this.editor.isEditor(node);\n        var data = this.inspector.parse(node);\n\n        // component\n        if (!data.isFigcaption() && this.component.isNonEditable(node) && this.component.isActive(node))\n        {\n            return true;\n        }\n\n        if (isEditor)\n        {\n            var $editor = this.editor.getElement();\n            var output = $editor.html().replace(/<p><\\/p>$/i, '');\n            var htmlLen = this.getHtml(false).length;\n            var outputLen = output.length;\n\n            if (htmlLen !== outputLen)\n            {\n                return false;\n            }\n        }\n\n        // editor empty or collapsed\n        if ((isEditor && this.editor.isEmpty()) || this.isCollapsed())\n        {\n            return false;\n        }\n\n        // all\n        var offset = this.offset.get(node, true);\n        var size = this.offset.size(node, true);\n\n        // pre, table, or pre/code in figure\n        if (!isEditor && data.isComponentType('code'))\n        {\n            size = this.getText().trim().length;\n        }\n\n        if (offset && offset.start === 0 && offset.end === size)\n        {\n            return true;\n        }\n\n        return false;\n    },\n\n    // has\n    hasNonEditable: function()\n    {\n        var selected = this.getHtml();\n        var $wrapper = $R.dom('<div>').html(selected);\n\n        return (!this.isCollapsed() && $wrapper.find('.non-editable').length !== 0);\n    },\n\n    // set\n    setRange: function(range)\n    {\n        var sel = window.getSelection();\n        sel.removeAllRanges();\n        sel.addRange(range);\n    },\n    setAll: function(el)\n    {\n        var node = this.utils.getNode(el);\n        if (!node) return;\n\n        var data = this.inspector.parse(node);\n\n        this.component.clearActive();\n\n        this.editor.focus();\n        this.editor.saveScroll();\n        this.editor.disableNonEditables();\n\n        if (node && node.tagName === 'TABLE')\n        {\n            var first = data.findFirstNode('td, th');\n            var last = data.findLastNode('td, th');\n\n            $R.dom(first).prepend(this.marker.build('start'));\n            $R.dom(last).append(this.marker.build('end'));\n\n            this.restoreMarkers();\n        }\n        else if (!data.isFigcaption() && this.component.isNonEditable(node))\n        {\n            this.component.setActive(node);\n        }\n        else\n        {\n            if (data.isComponentType('code'))\n            {\n                node = data.getComponentCodeElement();\n                node.focus();\n            }\n\n            var range = document.createRange();\n            range.selectNodeContents(node);\n\n            this.setRange(range);\n        }\n\n        this.editor.enableNonEditables();\n        this.editor.restoreScroll();\n    },\n\n    // get\n    get: function()\n    {\n        var sel = window.getSelection();\n        return (sel.rangeCount > 0) ? sel : null;\n    },\n    getRange: function()\n    {\n        var sel = this.get();\n        return (sel) ? ((sel.getRangeAt(0)) ? sel.getRangeAt(0) : null) : null;\n    },\n    getTextBeforeCaret: function(num)\n    {\n        num = (typeof num === 'undefined') ? 1 : num;\n\n        var el = this.editor.getElement().get();\n        var range = this.getRange();\n        var text = false;\n        if (range)\n        {\n            range = range.cloneRange();\n            range.collapse(true);\n            range.setStart(el, 0);\n            text = range.toString().slice(-num);\n        }\n\n        return text;\n    },\n    getTextAfterCaret: function(num)\n    {\n        num = (typeof num === 'undefined') ? 1 : num;\n\n        var el = this.editor.getElement().get();\n        var range = this.getRange();\n        var text = false;\n        if (range)\n        {\n            var clonedRange = range.cloneRange();\n            clonedRange.selectNodeContents(el);\n            clonedRange.setStart(range.endContainer, range.endOffset);\n\n            text = clonedRange.toString().slice(0, num);\n        }\n\n        return text;\n    },\n    getPosition: function()\n    {\n        var range = this.getRange();\n        var pos = { top: 0, left: 0, width: 0, height: 0 };\n        if (window.getSelection && range.getBoundingClientRect)\n        {\n            range = range.cloneRange();\n            var offset = (range.startOffset-1);\n            range.setStart(range.startContainer, (offset < 0) ? 0 : offset);\n            var rect = range.getBoundingClientRect();\n            pos = { top: rect.top, left: rect.left, width: (rect.right - rect.left) , height: (rect.bottom - rect.top) };\n        }\n\n        return pos;\n    },\n    getCurrent: function()\n    {\n        var node = false;\n        var sel = this.get();\n        var component = this.component.getActive();\n\n        if (component)\n        {\n            node = component;\n        }\n        else if (sel && this.is())\n        {\n            node = (sel.anchorNode !== this.editor.getElement().get()) ? sel.anchorNode : false;\n        }\n\n        return node;\n    },\n    getParent: function()\n    {\n        var node = false;\n        var current = this.getCurrent();\n        if (current)\n        {\n            var parent = current.parentNode;\n            node = (parent !== this.editor.getElement().get()) ? parent : false;\n        }\n\n        return node;\n    },\n    getElement: function(el)\n    {\n        var node = el || this.getCurrent();\n        while (node)\n        {\n            var data = this.inspector.parse(node);\n            if (data.isElement() && data.isInEditor())\n            {\n                return node;\n            }\n\n            node = node.parentNode;\n        }\n\n        return false;\n    },\n    getInline: function(el)\n    {\n        var node = el || this.getCurrent();\n        var inline = false;\n        while (node)\n        {\n            if (this._isInlineNode(node))\n            {\n                inline = node;\n            }\n\n            node = node.parentNode;\n        }\n\n        return inline;\n    },\n    getInlineFirst: function(el)\n    {\n        var node = el || this.getCurrent();\n        while (node)\n        {\n            if (this._isInlineNode(node))\n            {\n                return node;\n            }\n\n            node = node.parentNode;\n        }\n\n        return false;\n    },\n    getInlineAll: function(el)\n    {\n        var node = el || this.getCurrent();\n        var inlines = [];\n        while (node)\n        {\n            if (this._isInlineNode(node))\n            {\n                inlines.push(node);\n            }\n\n            node = node.parentNode;\n        }\n\n        return inlines;\n    },\n    getBlock: function(el)\n    {\n        var node = el || this.getCurrent();\n        while (node)\n        {\n            var data = this.inspector.parse(node);\n            var isBlock = this.inspector.isBlockTag(node.tagName);\n\n            if (isBlock && data.isInEditor(node))\n            {\n                return node;\n            }\n\n            node = node.parentNode;\n        }\n\n        return false;\n    },\n    getInlinesAllSelected: function(options)\n    {\n        if (this.isAll()) return [];\n\n        var inlines = this.getInlines({ all: true, inside: true });\n        //var textNodes = this.getNodes({ textnodes: true, inline: false });\n        var selected = this.getText().replace(/[-[\\]/{}()*+?.\\\\^$|]/g, \"\\\\$&\");\n        var finalNodes = [];\n\n        //if (textNodes.length !== 0)\n        // {\n        //     return finalNodes;\n        // }\n\n        if (selected === '')\n        {\n            finalNodes = inlines;\n        }\n        else if (inlines.length > 1)\n        {\n            for (var i = 0; i < inlines.length; i++)\n            {\n                if (this._isTextSelected(inlines[i], selected))\n                {\n                    finalNodes.push(inlines[i]);\n                }\n            }\n        }\n        else if (inlines.length === 1)\n        {\n            if (this._isTextSelected(inlines[0], selected))\n            {\n                finalNodes = inlines;\n            }\n        }\n\n        finalNodes = (options && options.tags) ? this._filterNodesByTags(finalNodes, options.tags) : finalNodes;\n\n        return finalNodes;\n    },\n    getInlines: function(options)\n    {\n        var nodes = this.getNodes();\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var node;\n            if (options && options.all)\n            {\n                node = nodes[i];\n                while (node)\n                {\n                    if (this._isInlineNode(node) && !this._isInNodesArray(filteredNodes, node))\n                    {\n                        filteredNodes.push(node);\n                    }\n\n                    node = node.parentNode;\n                }\n            }\n            else\n            {\n                node = this.getInline(nodes[i]);\n                if (node && !this._isInNodesArray(filteredNodes, node))\n                {\n                    filteredNodes.push(node);\n                }\n            }\n        }\n\n        // filter\n        filteredNodes = (options && options.tags) ? this._filterNodesByTags(filteredNodes, options.tags) : filteredNodes;\n        filteredNodes = (options && options.inside) ? this._filterInlinesInside(filteredNodes, options) : filteredNodes;\n\n        return filteredNodes;\n    },\n    getBlocks: function(options)\n    {\n        var nodes = this.getNodes();\n        var block = this.getBlock();\n        nodes = (nodes.length === 0 && block) ? [block] : nodes;\n\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var node = this.getBlock(nodes[i]);\n            var $node = $R.dom(node);\n            if ($node.hasClass('non-editable')) continue;\n\n            if (node && !this._isInNodesArray(filteredNodes, node))\n            {\n                filteredNodes.push(node);\n            }\n        }\n\n        // filter\n        filteredNodes = (options && options.tags) ? this._filterNodesByTags(filteredNodes, options.tags) : filteredNodes;\n        filteredNodes = (options && options.first) ? this._filterBlocksFirst(filteredNodes, options) : filteredNodes;\n\n        return filteredNodes;\n    },\n    getElements: function(options)\n    {\n        var nodes = this.getNodes({ textnodes: false });\n        var block = this.getBlock();\n        nodes = (nodes.length === 0 && block) ? [block] : nodes;\n\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            if (!this._isInNodesArray(filteredNodes, nodes[i]))\n            {\n                filteredNodes.push(nodes[i]);\n            }\n        }\n\n        // filter\n        filteredNodes = (options && options.tags) ? this._filterNodesByTags(filteredNodes, options.tags) : filteredNodes;\n\n        return filteredNodes;\n    },\n    getNodes: function(options)\n    {\n        var nodes = [];\n        var activeComponent = this.component.getActive();\n        if (activeComponent)\n        {\n            nodes = this._getNodesComponent(activeComponent);\n        }\n        else if (this.isCollapsed())\n        {\n            var current = this.getCurrent();\n            nodes = (current) ? [current] : [];\n        }\n        else if (this.is() && !activeComponent)\n        {\n            nodes = this._getRangeSelectedNodes();\n        }\n\n        // filter\n        nodes = this._filterServicesNodes(nodes);\n        nodes = this._filterEditor(nodes);\n\n        // options\n        nodes = (options && options.tags) ? this._filterNodesByTags(nodes, options.tags) : nodes;\n        nodes = (options && options.textnodes) ? this._filterNodesTexts(nodes, options) : nodes;\n        nodes = (options && !options.textnodes) ? this._filterNodesElements(nodes) : nodes;\n\n        return nodes;\n    },\n\n    // text & html\n    getText: function()\n    {\n        var sel = this.get();\n        return (sel) ? this.utils.removeInvisibleChars(sel.toString()) : '';\n    },\n    getHtml: function(clean)\n    {\n        var html = '';\n        var sel = this.get();\n        if (sel)\n        {\n            var container = document.createElement('div');\n            var len = sel.rangeCount;\n            for (var i = 0; i < len; ++i)\n            {\n                container.appendChild(sel.getRangeAt(i).cloneContents());\n            }\n\n            html = container.innerHTML;\n            html = (clean !== false) ? this.cleaner.output(html) : html;\n            html = html.replace(/<p><\\/p>$/i, '');\n        }\n\n        return html;\n    },\n\n    // clear\n    clear: function()\n    {\n        this.component.clearActive();\n        this.get().removeAllRanges();\n    },\n\n    // collapse\n    collapseToStart: function()\n    {\n        var sel = this.get();\n        if (sel && !sel.isCollapsed) sel.collapseToStart();\n    },\n    collapseToEnd: function()\n    {\n        var sel = this.get();\n        if (sel && !sel.isCollapsed) sel.collapseToEnd();\n    },\n\n    // save\n    saveActiveComponent: function()\n    {\n        var activeComponent = this.component.getActive();\n        if (activeComponent)\n        {\n            this.savedComponent = activeComponent;\n            return true;\n        }\n\n        return false;\n    },\n    restoreActiveComponent: function()\n    {\n        if (this.savedComponent)\n        {\n            this.component.setActive(this.savedComponent);\n            return true;\n        }\n\n        return false;\n    },\n    save: function()\n    {\n        this._clearSaved();\n\n        var el = this.getElement();\n        var tags = ['TD', 'TH', 'P', 'DIV', 'PRE', 'H1', 'H2', 'H3', 'H4', 'H5', 'H6', 'LI', 'BLOCKQUOTE'];\n        if (el && (tags.indexOf(el.tagName) !== -1) && (el.innerHTML === '' || el.innerHTML === '<br>'))\n        {\n            this.savedElement = el;\n        }\n        else if (!this.saveActiveComponent())\n        {\n            this.saved = this.offset.get();\n        }\n    },\n    restore: function()\n    {\n        if (!this.saved && !this.savedComponent && !this.savedElement) return;\n\n        this.editor.saveScroll();\n        if (this.savedElement)\n        {\n            this.caret.setStart(this.savedElement);\n        }\n        else if (!this.restoreActiveComponent())\n        {\n            this.offset.set(this.saved);\n        }\n\n        this._clearSaved();\n        this.editor.restoreScroll();\n    },\n    saveMarkers: function()\n    {\n        this._clearSaved();\n\n        if (!this.saveActiveComponent())\n        {\n            this.marker.insert();\n        }\n    },\n    restoreMarkers: function()\n    {\n        this.editor.saveScroll();\n\n        if (!this.restoreActiveComponent())\n        {\n            this.marker.restore();\n        }\n\n        this._clearSaved();\n        this.editor.restoreScroll();\n    },\n\n    // private\n    _getNextNode: function(node)\n    {\n        if (node.hasChildNodes()) return node.firstChild;\n\n        while (node && !node.nextSibling)\n        {\n            node = node.parentNode;\n        }\n\n        if (!node) return null;\n\n        return node.nextSibling;\n    },\n    _getNodesComponent: function(component)\n    {\n        var current = this.getCurrent();\n        var data = this.inspector.parse(current);\n\n        return (data.isFigcaption()) ? [data.getFigcaption()] : [component];\n    },\n    _getRangeSelectedNodes: function()\n    {\n        var nodes = [];\n        var range = this.getRange();\n        var node = range.startContainer;\n        var startNode = range.startContainer;\n        var endNode = range.endContainer;\n        var $editor = this.editor.getElement();\n\n        // editor\n        if (startNode === $editor.get() && this.isAll())\n        {\n            nodes = this.utils.getChildNodes($editor);\n        }\n        // single node\n        else if (node === endNode)\n        {\n            nodes = [node];\n        }\n        else\n        {\n            while (node && node !== endNode)\n            {\n                nodes.push(node = this._getNextNode(node));\n            }\n\n            node = range.startContainer;\n            while (node && node !== range.commonAncestorContainer)\n            {\n                nodes.unshift(node);\n                node = node.parentNode;\n            }\n        }\n\n        return nodes;\n    },\n    _isInNodesArray: function(nodes, node)\n    {\n        return (nodes.indexOf(node) !== -1);\n    },\n    _filterEditor: function(nodes)\n    {\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var data = this.inspector.parse(nodes[i]);\n            if (data.isInEditor())\n            {\n                filteredNodes.push(nodes[i]);\n            }\n        }\n\n        return filteredNodes;\n    },\n    _filterServicesNodes: function(nodes)\n    {\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var $el = $R.dom(nodes[i]);\n            var skip = false;\n\n            if (nodes[i] && nodes[i].nodeType === 3 && this.utils.isEmpty(nodes[i])) skip = true;\n            if ($el.hasClass('redactor-script-tag')\n                || $el.hasClass('redactor-component-caret')\n                || $el.hasClass('redactor-selection-marker')\n                || $el.hasClass('non-editable')) skip = true;\n\n            if (!skip)\n            {\n                filteredNodes.push(nodes[i]);\n            }\n        }\n\n        return filteredNodes;\n    },\n    _filterNodesTexts: function(nodes, options)\n    {\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            if (nodes[i].nodeType === 3 || (options.keepbr && nodes[i].tagName === 'BR'))\n            {\n                var inline = this.getInline(nodes[i]);\n                var isInline = (inline && options && options.inline === false);\n                if (!isInline)\n                {\n                    filteredNodes.push(nodes[i]);\n                }\n            }\n        }\n\n        return filteredNodes;\n    },\n    _filterNodesElements: function(nodes)\n    {\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            if (nodes[i].nodeType !== 3)\n            {\n                filteredNodes.push(nodes[i]);\n            }\n        }\n\n        return filteredNodes;\n    },\n    _filterNodesByTags: function(nodes, tags, passtexts)\n    {\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            if (passtexts && nodes[i].nodeType === 3)\n            {\n                filteredNodes.push(nodes[i]);\n            }\n            else if (nodes[i].nodeType !== 3)\n            {\n                var nodeTag = nodes[i].tagName.toLowerCase();\n                if (tags.indexOf(nodeTag.toLowerCase()) !== -1)\n                {\n                    filteredNodes.push(nodes[i]);\n                }\n            }\n        }\n\n        return filteredNodes;\n    },\n    _filterBlocksFirst: function(nodes)\n    {\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var $node = $R.dom(nodes[i]);\n            var parent = $node.parent().get();\n            var isFirst = ($node.parent().hasClass('redactor-in'));\n            var isCellParent = (parent && (parent.tagName === 'TD' || parent.tagName === 'TH'));\n            if (isFirst || isCellParent)\n            {\n                filteredNodes.push(nodes[i]);\n            }\n        }\n\n        return filteredNodes;\n    },\n    _filterInlinesInside: function(nodes)\n    {\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            if (containsNode(nodes[i], true))\n            {\n                filteredNodes.push(nodes[i]);\n            }\n        }\n\n        return filteredNodes;\n    },\n    _isTextSelected: function(node, selected) {\n        var text = (node.nodeType !== 9) ? this.utils.removeInvisibleChars(node.textContent) : '';\n\n        return (\n            selected === text\n            || text.search(selected) !== -1\n            || selected.search(new RegExp('^' + this.utils.escapeRegExp(text) + '$')) !== -1\n        );\n    },\n    _isInlineNode: function(node)\n    {\n        var data = this.inspector.parse(node);\n\n        return (this.inspector.isInlineTag(node.tagName) && data.isInEditor());\n    },\n    _clearSaved: function()\n    {\n        this.saved = false;\n        this.savedComponent = false;\n        this.savedElement = false;\n    }\n});\n$R.add('service', 'element', {\n    init: function(app)\n    {\n        this.app = app;\n        this.rootElement = app.rootElement;\n\n        // local\n        this.$element = {};\n        this.type = 'inline';\n    },\n    start: function()\n    {\n        this._build();\n        this._buildType();\n    },\n\n    // public\n    isType: function(type)\n    {\n        return (type === this.type);\n    },\n    getType: function()\n    {\n        return this.type;\n    },\n    getElement: function()\n    {\n        return this.$element;\n    },\n\n    // private\n    _build: function()\n    {\n        this.$element = $R.dom(this.rootElement);\n    },\n    _buildType: function()\n    {\n        var tag = this.$element.get().tagName;\n\n        this.type = (tag === 'TEXTAREA') ? 'textarea' : this.type;\n        this.type = (tag === 'DIV') ? 'div' : this.type;\n        this.type = (this.opts.inline) ? 'inline' : this.type;\n    }\n});\n$R.add('service', 'editor', {\n    init: function(app)\n    {\n        this.app = app;\n\n        // local\n        this.scrolltop = false;\n        this.pasting = false;\n    },\n\n    // start\n    start: function()\n    {\n        this._build();\n    },\n\n    // focus\n    focus: function()\n    {\n        if (!this.isFocus() && !this._isContenteditableFocus())\n        {\n            this.saveScroll();\n            this.$editor.focus();\n            this.restoreScroll();\n        }\n    },\n    startFocus: function()\n    {\n        this.caret.setStart(this.getFirstNode());\n    },\n    endFocus: function()\n    {\n        this.caret.setEnd(this.getLastNode());\n    },\n\n    // pasting\n    isPasting: function()\n    {\n        return this.pasting;\n    },\n    enablePasting: function()\n    {\n        this.pasting = true;\n    },\n    disablePasting: function()\n    {\n        this.pasting = false;\n    },\n\n    // scroll\n    saveScroll: function()\n    {\n        this.scrolltop = this._getScrollTarget().scrollTop();\n        if (this.opts.maxHeight) {\n            this.scrolltopin = this.$editor.scrollTop();\n        }\n\n    },\n    restoreScroll: function()\n    {\n        if (this.scrolltop !== false)\n        {\n            this._getScrollTarget().scrollTop(this.scrolltop);\n            this.scrolltop = false;\n        }\n\n        if (this.scrolltopin) {\n            this.$editor.scrollTop(this.scrolltopin);\n            this.scrolltopin = false;\n        }\n    },\n\n    // non editables\n    disableNonEditables: function()\n    {\n        this.$noneditables = this.$editor.find('[contenteditable=false]');\n        this.$noneditables.attr('contenteditable', true);\n    },\n    enableNonEditables: function()\n    {\n        if (this.$noneditables)\n        {\n            setTimeout(function() { this.$noneditables.attr('contenteditable', false); }.bind(this), 1);\n        }\n    },\n\n    // nodes\n    getFirstNode: function()\n    {\n        return this.$editor.contents()[0];\n    },\n    getLastNode: function()\n    {\n        var nodes = this.$editor.contents();\n\n        return nodes[nodes.length-1];\n    },\n\n    // utils\n    isSourceMode: function()\n    {\n        var $source = this.source.getElement();\n\n        return $source.hasClass('redactor-source-open');\n    },\n    isEditor: function(el)\n    {\n        var node = $R.dom(el).get();\n\n        return (node === this.$editor.get());\n    },\n    isEmpty: function(keeplists)\n    {\n        return this.utils.isEmptyHtml(this.$editor.html(), false, keeplists);\n    },\n    isFocus: function()\n    {\n        var $active = $R.dom(document.activeElement);\n        var isComponentSelected = (this.$editor.find('.redactor-component-active').length !== 0);\n\n        return (isComponentSelected || $active.closest('.redactor-in-' + this.uuid).length !== 0);\n    },\n    setEmpty: function()\n    {\n        this.$editor.html(this.opts.emptyHtml);\n    },\n\n    // element\n    getElement: function()\n    {\n        return this.$editor;\n    },\n\n    // private\n    _build: function()\n    {\n        var $element = this.element.getElement();\n        var editableElement = (this.element.isType('textarea')) ? '<div>' : $element.get();\n\n        this.$editor = $R.dom(editableElement);\n    },\n    _getScrollTarget: function()\n    {\n        var $target = this.$doc;\n        if (this.opts.toolbarFixedTarget !== document)\n        {\n            $target = $R.dom(this.opts.toolbarFixedTarget);\n        }\n        else\n        {\n            $target = (this.opts.scrollTarget) ? $R.dom(this.opts.scrollTarget) : $target;\n        }\n\n        return $target;\n    },\n    _isContenteditableFocus: function()\n    {\n        var block = this.selection.getBlock();\n        var $blockParent = (block) ? $R.dom(block).closest('[contenteditable=true]').not('.redactor-in') : [];\n\n        return ($blockParent.length !== 0);\n    }\n});\n$R.add('service', 'container', {\n    init: function(app)\n    {\n        this.app = app;\n    },\n    // public\n    start: function()\n    {\n        this._build();\n    },\n    getElement: function()\n    {\n        return this.$container;\n    },\n\n    // private\n    _build: function()\n    {\n        var tag = (this.element.isType('inline')) ? '<span>' : '<div>';\n        this.$container = $R.dom(tag);\n    }\n});\n$R.add('service', 'source', {\n    init: function(app)\n    {\n        this.app = app;\n\n        // local\n        this.$source = {};\n        this.content = '';\n    },\n    // public\n    start: function()\n    {\n        this._build();\n        this._buildName();\n        this._buildStartedContent();\n    },\n    getElement: function()\n    {\n        return this.$source;\n    },\n    getCode: function()\n    {\n        return this.$source.val();\n    },\n    getName: function()\n    {\n        return this.$source.attr('name');\n    },\n    getStartedContent: function()\n    {\n        return this.content;\n    },\n    setCode: function(html)\n    {\n        return this.insertion.set(html, true, false);\n    },\n    isNameGenerated: function()\n    {\n        return (this.name);\n    },\n    rebuildStartedContent: function()\n    {\n        this._buildStartedContent();\n    },\n\n    // private\n    _build: function()\n    {\n        var $element = this.element.getElement();\n        var isTextarea = this.element.isType('textarea');\n        var sourceElement = (isTextarea) ? $element.get() : '<textarea>';\n\n        this.$source = $R.dom(sourceElement);\n    },\n    _buildName: function()\n    {\n        var $element = this.element.getElement();\n\n        this.name = $element.attr('name');\n        this.$source.attr('name', (this.name) ? this.name : 'content-' + this.uuid);\n    },\n    _buildStartedContent: function()\n    {\n        var $element = this.element.getElement();\n        var content = (this.element.isType('textarea')) ? $element.val() : $element.html();\n\n        this.content = content.trim();\n    }\n});\n$R.add('service', 'statusbar', {\n    init: function(app)\n    {\n        this.app = app;\n\n        // local\n        this.$statusbar = {};\n        this.items = [];\n    },\n    // public\n    start: function()\n    {\n        this.$statusbar = $R.dom('<ul>');\n        this.$statusbar.attr('dir', this.opts.direction);\n    },\n    add: function(name, html)\n    {\n        return this.update(name, html);\n    },\n    update: function(name, html)\n    {\n        var $item;\n        if (typeof this.items[name] !== 'undefined')\n        {\n            $item = this.items[name];\n        }\n        else\n        {\n            $item = $R.dom('<li>');\n            this.$statusbar.append($item);\n            this.items[name] = $item;\n        }\n\n        return $item.html(html);\n    },\n    get: function(name)\n    {\n        return (this.items[name]) ? this.items[name] : false;\n    },\n    remove: function(name)\n    {\n        if (this.items[name])\n        {\n            this.items[name].remove();\n            delete this.items[name];\n        }\n    },\n    getItems: function()\n    {\n        return this.items;\n    },\n    removeItems: function()\n    {\n        this.items = {};\n        this.$statusbar.html('');\n    },\n    getElement: function()\n    {\n        return this.$statusbar;\n    }\n});\n$R.add('service', 'toolbar', {\n    init: function(app)\n    {\n        this.app = app;\n\n        // local\n        this.buttons = [];\n        this.dropdownOpened = false;\n        this.buttonsObservers = {};\n    },\n    // public\n    start: function()\n    {\n        if (this.is())\n        {\n            this.opts.activeButtons = (this.opts.activeButtonsAdd) ? this._extendActiveButtons() : this.opts.activeButtons;\n            this.create();\n        }\n    },\n    stopObservers: function()\n    {\n        this.buttonsObservers = {};\n    },\n    create: function()\n    {\n        this.$wrapper = $R.dom('<div>');\n        this.$toolbar = $R.dom('<div>');\n    },\n    observe: function()\n    {\n        if (!this.is()) return;\n\n        this.setButtonsInactive();\n\n        var button, observer;\n\n        // observers\n        for (var name in this.buttonsObservers)\n        {\n            observer = this.buttonsObservers[name];\n            button = this.getButton(name);\n            this.app.broadcast('button.' + observer + '.observe', button);\n        }\n\n        // inline buttons\n        var buttons = this.opts.activeButtons;\n        var inlines = this.selection.getInlinesAllSelected();\n        var current = this.selection.getInline();\n        var currents = this.selection.getInlineAll();\n\n        if (this.selection.isCollapsed())\n        {\n            if (current) inlines.push(current);\n            if (currents.length !== 0) {\n                inlines = inlines.concat(currents);\n            }\n        }\n\n        var tags = this._inlinesToTags(inlines);\n        for (var key in buttons)\n        {\n            if (tags.indexOf(key) !== -1)\n            {\n                button = this.getButton(buttons[key]);\n                if (button) {\n                    button.setActive();\n                }\n            }\n\n        }\n    },\n\n    // is\n    is: function()\n    {\n        return !(!this.opts.toolbar || (this.detector.isMobile() && this.opts.air));\n    },\n    isAir: function()\n    {\n        return (this.is()) ? this.$toolbar.hasClass('redactor-air') : false;\n    },\n    isFixed: function()\n    {\n        return (this.is()) ? this.$toolbar.hasClass('redactor-toolbar-fixed') : false;\n    },\n    isContextBar: function()\n    {\n        var $bar = this.$body.find('#redactor-context-toolbar-' + this.uuid);\n        return $bar.hasClass('open');\n    },\n    isTarget: function()\n    {\n        return (this.opts.toolbarFixedTarget !== document);\n    },\n\n    // get\n    getElement: function()\n    {\n        return this.$toolbar;\n    },\n    getWrapper: function()\n    {\n        return this.$wrapper;\n    },\n    getDropdown: function()\n    {\n        return this.dropdownOpened;\n    },\n    getTargetElement: function()\n    {\n        return $R.dom(this.opts.toolbarFixedTarget);\n    },\n    getButton: function(name)\n    {\n        var $btn = this._findButton('.re-' + name);\n\n        return ($btn.length !== 0) ? $btn.dataget('data-button-instance') : false;\n    },\n    getButtons: function()\n    {\n        var buttons = [];\n        this._findButtons().each(function(node)\n        {\n            var $node = $R.dom(node);\n            buttons.push($node.dataget('data-button-instance'));\n        });\n\n        return buttons;\n    },\n    getButtonsKeys: function()\n    {\n        var keys = [];\n        this._findButtons().each(function(node)\n        {\n            var $node = $R.dom(node);\n            keys.push($node.attr('data-re-name'));\n        });\n\n        return keys;\n    },\n\n    // add\n    addButton: function(name, btnObj, position, $el, start)\n    {\n        position = position || 'end';\n\n        var $button = $R.create('toolbar.button', this.app, name, btnObj);\n        if (btnObj.observe)\n        {\n            this.opts.activeButtonsObservers[name] = { observe: btnObj.observe, button: $button };\n        }\n\n        if (this.is())\n        {\n            if (position === 'first') this.$toolbar.prepend($button);\n            else if (position === 'after') $el.after($button);\n            else if (position === 'before') $el.before($button);\n            else {\n                var index = this.opts.buttons.indexOf(name);\n                if (start !== true && index !== -1) {\n                    if (index === 0) {\n                        this.$toolbar.prepend($button);\n                    }\n                    else {\n                        var $btns = this._findButtons();\n                        var $btn = $btns.eq(index-1);\n                        if ($btn.length > 0) {\n                            $btn.after($button);\n                        }\n                        else {\n                            this.$toolbar.append($button);\n                        }\n                    }\n                }\n                else {\n                    this.$toolbar.append($button);\n                }\n            }\n        }\n\n        return $button;\n    },\n    addButtonFirst: function(name, btnObj)\n    {\n        return this.addButton(name, btnObj, 'first');\n    },\n    addButtonAfter: function(after, name, btnObj)\n    {\n        var $btn = this.getButton(after);\n\n        return ($btn) ? this.addButton(name, btnObj, 'after', $btn) : this.addButton(name, btnObj);\n    },\n    addButtonBefore: function(before, name, btnObj)\n    {\n        var $btn = this.getButton(before);\n\n        return ($btn) ? this.addButton(name, btnObj, 'before', $btn) : this.addButton(name, btnObj);\n    },\n    addButtonObserver: function(name, observer)\n    {\n        this.buttonsObservers[name] = observer;\n    },\n\n    // set\n    setButtons: function(buttons)\n    {\n        this.buttons = buttons;\n    },\n    setDropdown: function(dropdown)\n    {\n        this.dropdownOpened = dropdown;\n    },\n    setButtonsInactive: function()\n    {\n        var $buttons = this.getButtons();\n        for (var i = 0; i < $buttons.length; i++)\n        {\n            $buttons[i].setInactive();\n        }\n    },\n    setButtonsActive: function()\n    {\n        var $buttons = this.getButtons();\n        for (var i = 0; i < $buttons.length; i++)\n        {\n            $buttons[i].setActive();\n        }\n    },\n\n    // disable & enable\n    disableButtons: function()\n    {\n        var $buttons = this.getButtons();\n        for (var i = 0; i < $buttons.length; i++)\n        {\n            $buttons[i].disable();\n        }\n    },\n    enableButtons: function()\n    {\n        var $buttons = this.getButtons();\n        for (var i = 0; i < $buttons.length; i++)\n        {\n            $buttons[i].enable();\n        }\n\n    },\n\n    // private\n    _findButton: function(selector)\n    {\n        return (this.is()) ? this.$toolbar.find(selector) : $R.dom();\n    },\n    _findButtons: function()\n    {\n        return (this.is()) ? this.$toolbar.find('.re-button') : $R.dom();\n    },\n    _extendActiveButtons: function()\n    {\n        return $R.extend({}, this.opts.activeButtons, this.opts.activeButtonsAdd);\n    },\n    _inlinesToTags: function(inlines)\n    {\n        var tags = [];\n        for (var i = 0; i < inlines.length; i++)\n        {\n            tags.push(inlines[i].tagName.toLowerCase());\n        }\n\n        return tags;\n    }\n});\n$R.add('class', 'toolbar.button', {\n    mixins: ['dom'],\n    init: function(app, name, btnObj)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.lang = app.lang;\n        this.$body = app.$body;\n        this.toolbar = app.toolbar;\n        this.detector = app.detector;\n\n        // local\n        this.obj = btnObj;\n        this.name = name;\n        this.dropdown = false;\n        this.tooltip = false;\n\n        // init\n        this._init();\n    },\n    // is\n    isActive: function()\n    {\n        return this.hasClass('redactor-button-active');\n    },\n    isDisabled: function()\n    {\n        return this.hasClass('redactor-button-disabled');\n    },\n\n    // has\n    hasIcon: function()\n    {\n        return (this.obj.icon && !this.opts.buttonsTextLabeled);\n    },\n\n    // set\n    setDropdown: function(dropdown)\n    {\n        this.obj.dropdown = dropdown;\n        this.obj.message = false;\n        this.dropdown = $R.create('toolbar.dropdown', this.app, this.name, this.obj.dropdown);\n        this.attr('data-dropdown', true);\n    },\n    setMessage: function(message, args)\n    {\n        this.obj.message = message;\n        this.obj.args = args;\n        this.obj.dropdown = false;\n    },\n    setApi: function(api, args)\n    {\n        this.obj.api = api;\n        this.obj.args = args;\n        this.obj.dropdown = false;\n    },\n    setTitle: function(title)\n    {\n        this.obj.title = this.lang.parse(title);\n        this.obj.tooltip = this.obj.title;\n\n        this.attr({ 'alt': this.obj.tooltip, 'aria-label': this.obj.tooltip });\n        if (!this.attr('data-re-icon')) this.html(this.obj.title);\n    },\n    setTooltip: function(tooltip)\n    {\n        this.obj.tooltip = this.lang.parse(tooltip);\n        this.attr({ 'alt': this.obj.tooltip, 'aria-label': this.obj.tooltip });\n    },\n    setIcon: function(icon)\n    {\n        if (this.opts.buttonsTextLabeled) return;\n\n        this.obj.icon = true;\n        this.$icon = $R.dom(icon);\n\n        this.html('');\n        this.append(this.$icon);\n        this.attr('data-re-icon', true);\n        this.addClass('re-button-icon');\n        this.setTooltip(this.obj.title);\n        this._buildTooltip();\n    },\n    setActive: function()\n    {\n        this.addClass('redactor-button-active');\n    },\n    setInactive: function()\n    {\n        this.removeClass('redactor-button-active');\n    },\n\n    // hide\n    hideTooltip: function()\n    {\n        this.$body.find('.re-button-tooltip').remove();\n    },\n\n    // get\n    getDropdown: function()\n    {\n        return this.dropdown;\n    },\n\n    // enable & disable\n    disable: function()\n    {\n        this.addClass('redactor-button-disabled');\n    },\n    enable: function()\n    {\n        this.removeClass('redactor-button-disabled');\n    },\n\n    // toggle\n    toggle: function(e)\n    {\n        if (e) e.preventDefault();\n        if (this.isDisabled()) return;\n\n        if (this.obj.dropdown)\n        {\n            this.dropdown.toggle(e);\n        }\n        else if (this.obj.api)\n        {\n            // broadcast\n            this.app.api(this.obj.api, this.obj.args, this.name);\n        }\n        else if (this.obj.message)\n        {\n            // broadcast\n            this.app.broadcast(this.obj.message, this.obj.args, this.name);\n        }\n\n        this.hideTooltip();\n    },\n\n    // private\n    _init: function()\n    {\n        // parse\n        this._parseTitle();\n        this._parseTooltip();\n\n        // build\n        this._build();\n        this._buildCallback();\n        this._buildAttributes();\n        this._buildObserver();\n\n        if (this.hasIcon())\n        {\n            this._buildIcon();\n            this._buildTooltip();\n        }\n        else\n        {\n            this.html(this.obj.title);\n        }\n    },\n    _parseTooltip: function()\n    {\n        this.obj.tooltip = (this.obj.tooltip) ? this.lang.parse(this.obj.tooltip) : this.obj.title;\n    },\n    _parseTitle: function()\n    {\n        this.obj.title = this.lang.parse(this.obj.title);\n    },\n    _build: function()\n    {\n        this.parse('<a>');\n        this.addClass('re-button re-' + this.name);\n        this.attr('data-re-name', this.name);\n        this.dataset('data-button-instance', this);\n\n        if (this.obj.dropdown) this.setDropdown(this.obj.dropdown);\n    },\n    _buildCallback: function()\n    {\n        this.on('click', this.toggle.bind(this));\n    },\n    _buildAttributes: function()\n    {\n        var attrs = {\n            'href': '#',\n            'alt': this.obj.tooltip,\n            'rel': this.name,\n            'role': 'button',\n            'aria-label': this.obj.tooltip,\n            'tabindex': '-1'\n        };\n\n        this.attr(attrs);\n    },\n    _buildObserver: function()\n    {\n        if (typeof this.obj.observe !== 'undefined')\n        {\n            this.toolbar.addButtonObserver(this.name, this.obj.observe);\n        }\n    },\n    _buildIcon: function()\n    {\n        var icon = this.obj.icon;\n        var isHtml = (/(<([^>]+)>)/ig.test(icon));\n\n        this.$icon = (isHtml) ? $R.dom(icon) : $R.dom('<i>');\n        if (!isHtml) this.$icon.addClass('re-icon-' + this.name);\n\n        this.append(this.$icon);\n        this.attr('data-re-icon', true);\n        this.addClass('re-button-icon');\n    },\n    _buildTooltip: function()\n    {\n        if (this.detector.isDesktop())\n        {\n            this.tooltip = $R.create('toolbar.button.tooltip', this.app, this);\n        }\n    }\n});\n$R.add('class', 'toolbar.button.tooltip', {\n    mixins: ['dom'],\n    init: function(app, $button)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.opts = app.opts;\n        this.$body = app.$body;\n        this.toolbar = app.toolbar;\n\n        // local\n        this.$button = $button;\n        this.created = false;\n\n        // init\n        this._init();\n    },\n    open: function()\n    {\n        if (this.$button.hasClass('redactor-button-disabled') || this.$button.hasClass('redactor-button-active')) return;\n\n        this.created = true;\n        this.parse('<span>');\n        this.addClass('re-button-tooltip re-button-tooltip-' + this.uuid);\n        this.$body.append(this);\n        this.html(this.$button.attr('alt'));\n\n        var offset = this.$button.offset();\n        var position = 'absolute';\n        var height = this.$button.height();\n        var width = this.$button.width();\n        var arrowOffset = 4;\n\n        this.css({\n            top: (offset.top + height + arrowOffset) + 'px',\n            left: (offset.left + width/2 - this.width()/2) + 'px',\n            position: position\n        });\n\n        this.show();\n    },\n    close: function()\n    {\n        if (!this.created || this.$button.hasClass('redactor-button-disabled')) return;\n\n        this.remove();\n        this.created = false;\n    },\n\n    // private\n    _init: function()\n    {\n        this.$button.on('mouseover', this.open.bind(this));\n        this.$button.on('mouseout', this.close.bind(this));\n    }\n});\n$R.add('class', 'toolbar.dropdown', {\n    mixins: ['dom'],\n    init: function(app, name, items)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.opts = app.opts;\n        this.$win = app.$win;\n        this.$doc = app.$doc;\n        this.$body = app.$body;\n        this.animate = app.animate;\n        this.toolbar = app.toolbar;\n\n        // local\n        this.name = name;\n        this.started = false;\n        this.items = (name === 'format') ? $R.extend({}, true, items) : items;\n        this.$items = [];\n    },\n    // public\n    toggle: function(e)\n    {\n        if (!this.started)\n        {\n            this._build();\n        }\n\n        // toggle\n        if (this.isOpened() && this.isActive())\n        {\n            this.close(false);\n        }\n        else\n        {\n            this.open(e);\n        }\n    },\n    isOpened: function()\n    {\n        var $dropdown = this.$body.find('.redactor-dropdown-' + this.uuid + '.open');\n\n        return ($dropdown.length !== 0 && $dropdown.attr('data-re-name') === this.name);\n    },\n    isActive: function()\n    {\n        var $dropdown = this.$body.find('#redactor-dropdown-' + this.uuid + '-' + this.name + '.open');\n        return ($dropdown.length !== 0);\n    },\n    getName: function()\n    {\n        return this.attr('data-re-name');\n    },\n    getItem: function(name)\n    {\n        return this.$items[name];\n    },\n    getItemsByClass: function(classname)\n    {\n        var result = [];\n        for (var key in this.$items) {\n            var item = this.$items[key];\n            if (typeof item === 'object' && item.attr('data-re-name') && item.hasClass(classname)) {\n                result.push(item);\n            }\n        }\n\n        return result;\n    },\n    open: function(e)\n    {\n        this._closeAll();\n\n        this.$btn = this.toolbar.getButton(this.name);\n        this.app.broadcast('dropdown.open', e, this, this.$btn);\n        this.toolbar.setDropdown(this);\n\n        this.show();\n        this.removeClass('redactor-animate-hide');\n        this.addClass('open');\n        this._observe();\n\n        this.$btn.hideTooltip();\n        this.$btn.setActive();\n\n        this.$doc.on('keyup.redactor.dropdown-' + this.uuid, this._handleKeyboard.bind(this));\n        this.$doc.on('click.redactor.dropdown-' + this.uuid, this.close.bind(this));\n\n        this.updatePosition();\n        this.app.broadcast('dropdown.opened', e, this, this.$btn);\n\n    },\n    close: function(e, animate)\n    {\n        if (e)\n        {\n            var $el = $R.dom(e.target);\n            if (this._isButton(e) || $el.hasClass('redactor-dropdown-not-close') || $el.hasClass('redactor-dropdown-item-disabled'))\n            {\n                e.preventDefault();\n                return;\n            }\n        }\n\n        this.app.broadcast('dropdown.close', this, this.$btn);\n        this.toolbar.setDropdown(false);\n\n        this.$btn.setInactive();\n        if (animate === false)\n        {\n            this._close();\n        }\n        else\n        {\n            this.animate.start(this, 'fadeOut', this._close.bind(this));\n        }\n    },\n    updatePosition: function()\n    {\n        var isFixed = this.toolbar.isFixed();\n        var isTarget = this.toolbar.isTarget();\n\n        var btnHeight = this.$btn.height();\n        var btnWidth = this.$btn.width();\n\n        var pos = this.$btn.offset();\n        var position = 'absolute';\n        var topOffset = 2;\n\n\n        if (isFixed) {\n            //pos.top = (isTarget) ? this.$btn.offset().top : this.$btn.position().top;\n            //position = 'fixed';\n            //topOffset = topOffset + this.opts.toolbarFixedTopOffset;\n        }\n\n        var leftOffset = 0;\n        var left = (pos.left + leftOffset);\n        var width = parseFloat(this.css('width'));\n        var winWidth = this.$win.width();\n        var leftFix = (winWidth < (left + width)) ? (width - btnWidth) : 0;\n        var leftPos = (left - leftFix);\n        var top = (pos.top + btnHeight + topOffset);\n        leftPos = (leftPos < 0) ? 4 : leftPos;\n\n        this.css({\n            maxHeight: '',\n            position: position,\n            top: top + 'px',\n            left: leftPos + 'px'\n        });\n\n        // height adaptive\n        var heightTolerance = 10;\n        var winHeight = this.$win.height();\n        var scrollTop = this.$doc.scrollTop();\n        var cropHeight = winHeight - (top - scrollTop) - heightTolerance;\n\n        this.css('max-height', cropHeight + 'px');\n    },\n\n    // private\n    _build: function()\n    {\n        this.parse('<div>');\n        this.attr('dir', this.opts.direction);\n        this.attr('id', 'redactor-dropdown-' + this.uuid + '-' + this.name);\n        this.attr('data-re-name', this.name);\n\n        this.addClass('redactor-dropdown redactor-dropdown-' + this.uuid + ' redactor-dropdown-' + this.name);\n        this.dataset('data-dropdown-instance', this);\n        var isDom = (this.items.sdom || typeof this.items === 'string');\n\n        if (isDom) this._buildDom();\n        else this._buildItems();\n\n        this.$body.append(this);\n        this.started = true;\n    },\n    _buildDom: function()\n    {\n        this.html('').append($R.dom(this.items));\n    },\n    _buildItems: function()\n    {\n        this.items = (this.name === 'format') ? this._buildFormattingItems() : this.items;\n\n        for (var key in this.items)\n        {\n            var obj = this.items[key];\n\n            if (key === 'observe')\n            {\n                this.attr('data-observe', this.items[key]);\n            }\n            else\n            {\n                var $item = $R.create('toolbar.dropdown.item', this.app, key, obj, this);\n\n                this.$items[key] = $item;\n                this.append($item);\n            }\n        }\n    },\n    _buildFormattingItems: function()\n    {\n        // build the format set\n        for (var key in this.items)\n        {\n            if (this.opts.formatting.indexOf(key) === -1) delete this.items[key];\n        }\n\n        // remove from the format set\n        if (this.opts.formattingHide)\n        {\n            for (var key in this.items)\n            {\n                if (this.opts.formattingHide.indexOf(key) !== -1) delete this.items[key];\n            }\n        }\n\n        // add to the format set\n        if (this.opts.formattingAdd)\n        {\n            for (var key in this.opts.formattingAdd)\n            {\n                this.items[key] = this.opts.formattingAdd[key];\n            }\n        }\n\n        return this.items;\n    },\n    _handleKeyboard: function(e)\n    {\n        if (e.which === 27) this.close();\n    },\n    _isButton: function(e)\n    {\n        var $el = $R.dom(e.target);\n        var $btn = $el.closest('.re-button');\n\n        return ($btn.get() === this.$btn.get());\n    },\n    _close: function()\n    {\n        this.$btn.setInactive();\n        this.$doc.off('.redactor.dropdown-' + this.uuid);\n        this.removeClass('open');\n        this.addClass('redactor-animate-hide');\n        this.app.broadcast('dropdown.closed', this, this.$btn);\n    },\n    _closeAll: function()\n    {\n        this.$body.find('.redactor-dropdown-' + this.uuid + '.open').each(function(node)\n        {\n            var $node = $R.dom(node);\n            var instance =  $node.dataget('data-dropdown-instance');\n            instance._close();\n        });\n    },\n    _observe: function()\n    {\n        var observer = this.attr('data-observe');\n        if (observer)\n        {\n            this.app.broadcast('dropdown.' + observer + '.observe', this);\n        }\n    }\n});\n$R.add('class', 'toolbar.dropdown.item', {\n    mixins: ['dom'],\n    init: function(app, name, obj, dropdown)\n    {\n        this.app = app;\n        this.lang = app.lang;\n\n        // local\n        this.dropdown = dropdown;\n        this.name = name;\n        this.obj = obj;\n\n        // init\n        this._init();\n    },\n    setTitle: function(html)\n    {\n        this.$span.html(html);\n    },\n    getTitle: function()\n    {\n        return this.$span.html();\n    },\n    enable: function()\n    {\n        this.removeClass('redactor-dropdown-item-disabled');\n    },\n    disable: function()\n    {\n        this.addClass('redactor-dropdown-item-disabled');\n    },\n    toggle: function(e)\n    {\n        if (e) e.preventDefault();\n        if (this.hasClass('redactor-dropdown-item-disabled')) return;\n\n        if (this.obj.message)\n        {\n            // broadcast\n            this.app.broadcast(this.obj.message, this.obj.args, this.name);\n        }\n        else if (this.obj.api)\n        {\n            this.app.api(this.obj.api, this.obj.args, this.name);\n        }\n    },\n\n    // private\n    _init: function()\n    {\n        this.parse('<a>');\n        this.attr('href', '#');\n        this.addClass('redactor-dropdown-item-' + this.name);\n\n        if (this.obj.classname)\n        {\n            this.addClass(this.obj.classname);\n        }\n\n        this.attr('data-re-name', this.name);\n        this.on('click', this.toggle.bind(this));\n\n        this.$span = $R.dom('<span>');\n        this.append(this.$span);\n        this.setTitle(this.lang.parse(this.obj.title));\n    }\n});\n$R.add('service', 'cleaner', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n\n        // local\n        this.storedComponents = [];\n        this.storedComments = [];\n        this.storedImages = [];\n        this.storedLinks = [];\n        this.deniedTags = ['font', 'html', 'head', 'link', 'title', 'body', 'meta', 'applet'];\n        this.convertRules = {};\n        this.unconvertRules = {};\n\n        // regex\n        this.reComments = /<!--[\\s\\S]*?-->\\n?/g;\n        this.reSpacedEmpty = /^(||\\s||<br\\s?\\/?>||&nbsp;)$/i;\n        this.reScriptTag = /<script(.*?[^>]?)>([\\w\\W]*?)<\\/script>/gi;\n    },\n    // public\n    addConvertRules: function(name, func)\n    {\n        this.convertRules[name] = func;\n    },\n    addUnconvertRules: function(name, func)\n    {\n        this.unconvertRules[name] = func;\n    },\n    input: function(html, paragraphize, started)\n    {\n        // fix &curren; entity in the links\n        html = html.replace(/¤t/gi, '&current');\n\n        // store\n        var storedComments = [];\n        html = this.storeComments(html, storedComments);\n\n        // pre/code\n        html = this.encodeCode(html);\n\n        // sanitize\n        var $wrapper = this.utils.buildWrapper(html);\n        $wrapper.find('a, b, i, strong, em, img, svg, details, audio').removeAttr('onload onerror ontoggle onwheel onmouseover oncopy');\n        $wrapper.find('a, iframe, embed').each(function(node) {\n            var $node = $R.dom(node);\n            var href = $node.attr('href');\n            var src = $node.attr('src');\n            if (href && href.trim().search(/^data|javascript:/i) !== -1) $node.attr('href', '');\n            if (src && src.trim().search(/^data|javascript:/i) !== -1) $node.attr('src', '');\n        });\n\n        var imageattrs = ['alt', 'title', 'src', 'class', 'width', 'height', 'srcset', 'style', 'usemap'];\n        $wrapper.find('img').each(function(node) {\n            if (node.attributes.length > 0) {\n                var attrs = node.attributes;\n                for (var i = attrs.length - 1; i >= 0; i--) {\n                    var removeAttrs = (attrs[i].name.search(/^data-/) === -1 && imageattrs.indexOf(attrs[i].name) === -1);\n                    var removeDataSrc = (attrs[i].name === 'src' && attrs[i].value.search(/^data|javascript:/i) !== -1);\n                    if (this.opts.imageSrcData) removeDataSrc = false;\n\n                    if (removeAttrs || removeDataSrc) {\n                        node.removeAttribute(attrs[i].name);\n                    }\n                }\n            }\n        }.bind(this));\n\n        // get wrapper html\n        html = this.utils.getWrapperHtml($wrapper);\n\n        // converting entity\n        html = html.replace(/\\$/g, '&#36;');\n        html = html.replace(/&amp;/g, '&');\n\n        // convert to figure\n        var converter = $R.create('cleaner.figure', this.app);\n        html = converter.convert(html, this.convertRules);\n\n        // store components\n        html = this.storeComponents(html);\n\n        // clean\n        html = this.replaceTags(html, this.opts.replaceTags);\n        html = this._setSpanAttr(html);\n        html = this._setStyleCache(html);\n        html = this.removeTags(html, this.deniedTags);\n        html = (this.opts.removeScript) ? this._removeScriptTag(html) : this._replaceScriptTag(html);\n        //html = (this.opts.removeScript) ? this._removeScriptTag(html) : html;\n        html = (this.opts.removeComments) ? this.removeComments(html) : html;\n        html = (this._isSpacedEmpty(html)) ? this.opts.emptyHtml : html;\n\n\n        // restore components\n        html = this.restoreComponents(html);\n\n\n        // clear wrapped components\n        html = this._cleanWrapped(html);\n\n        // restore comments\n        html = this.restoreComments(html, storedComments);\n\n        // paragraphize\n        html = (paragraphize) ? this.paragraphize(html) : html;\n\n        return html;\n    },\n    output: function(html, removeMarkers)\n    {\n        html = this.removeInvisibleSpaces(html);\n\n        if (this.opts.breakline) {\n            html = html.replace(/<\\/(span|strong|b|i|em)><br\\s?\\/?><\\/div>/gi, \"</$1></div>\");\n            html = html.replace(/<br\\s?\\/?><\\/(span|strong|b|i|em)><\\/div>/gi, \"</$1></div>\");\n        }\n\n        html = html.replace(/&#36;/g, '$');\n\n        // empty\n        if (this._isSpacedEmpty(html)) return '';\n        if (this._isParagraphEmpty(html)) return '';\n\n        html = this.removeServiceTagsAndAttrs(html, removeMarkers);\n\n        // store components\n        html = this.storeComponents(html);\n\n        html = this.removeSpanWithoutAttributes(html);\n        html = this.removeFirstBlockBreaklineInHtml(html);\n\n        html = (this.opts.removeScript) ? html : this._unreplaceScriptTag(html);\n        html = (this.opts.preClass) ? this._setPreClass(html) : html;\n        html = (this.opts.linkNofollow) ? this._setLinkNofollow(html) : html;\n        html = (this.opts.removeNewLines) ? this.cleanNewLines(html) : html;\n\n        // restore components\n        html = this.restoreComponents(html);\n\n        // convert to figure\n        var converter = $R.create('cleaner.figure', this.app);\n        html = converter.unconvert(html, this.unconvertRules);\n\n        // final clean up\n        html = this.removeEmptyAttributes(html, ['style', 'class', 'rel', 'alt', 'title']);\n        html = this.cleanSpacesInPre(html);\n        html = this.tidy(html);\n\n        // converting entity\n        html = html.replace(/&amp;/g, '&');\n\n        // breakline tidy\n        if (this.opts.breakline) {\n            html = html.replace(/<br\\s?\\/?>/gi, \"<br>\\n\");\n            html = html.replace(/<br\\s?\\/?>\\n+/gi, \"<br>\\n\");\n        }\n\n        // check whitespaces\n        html = (html.replace(/\\n/g, '') === '') ? '' : html;\n\n        return html;\n    },\n    paste: function(html)\n    {\n        // store components\n        html = this.storeComponents(html);\n\n        // remove comments\n        html = html.replace(/<!--[\\s\\S]*?-->/g, '');\n\n        // remove tags\n        var deniedTags = this.deniedTags.concat(['iframe']);\n        html = this.removeTags(html, deniedTags);\n\n        // remove doctype tag\n        html = html.replace(new RegExp(\"<!doctype([\\\\s\\\\S]+?)>\", 'gi'), '');\n\n        // remove style tag\n        html = html.replace(new RegExp(\"<style([\\\\s\\\\S]+?)</style>\", 'gi'), '');\n\n        // remove br between\n        html = html.replace(new RegExp(\"</p><br /><p\", 'gi'), '</p><p');\n\n        // gdocs & word\n        var isMsWord = this._isHtmlMsWord(html);\n\n        html = (isMsWord) ? html : this._cleanGDocs(html);\n        html = (isMsWord) ? this._cleanMsWord(html) : html;\n\n        // do not clean\n        if (!this.opts.pasteClean)\n        {\n            // restore components\n            html = this.restoreComponents(html);\n\n            return html;\n        }\n\n        // plain text\n        if (this.opts.pastePlainText)\n        {\n            // restore components\n            html = this.restoreComponents(html);\n\n            return this.pastePlainText(html);\n        }\n\n        // unconvert data redactor tag\n        var $wrapper = this.utils.buildWrapper(html);\n        $wrapper.find('*').removeAttr('style');\n        $wrapper.find('[data-redactor-tag]').each(function(node) {\n            var $node = $R.dom(node);\n            $node.removeAttr('data-redactor-tag');\n\n            if (this.utils.isEmptyHtml($node.html())) {\n                $node.html('<br>').unwrap();\n            }\n            else if (node.lastChild && node.lastChild.tagName === 'BR') {\n                $node.unwrap();\n            }\n            else {\n                $node.append('<br>').unwrap();\n            }\n        }.bind(this));\n        html = this.utils.getWrapperHtml($wrapper);\n        html = html.replace(/<br\\s?\\/?>$/, '');\n        html = html.replace(/<br\\s?\\/?><\\/(td|th)>/, '</$1>');\n\n        // remove tags\n        var exceptedTags = this.opts.pasteBlockTags.concat(this.opts.pasteInlineTags);\n        html = this.removeTagsExcept(html, exceptedTags);\n\n        // links & images\n        html = (this.opts.pasteLinks) ? html : this.removeTags(html, ['a']);\n        html = (this.opts.pasteImages) ? html : this.removeTags(html, ['img']);\n\n        // build wrapper\n        var $wrapper = this.utils.buildWrapper(html);\n\n        // clean attrs\n        var $elms = $wrapper.find('*');\n\n        // remove style\n        var filterStyle = (this.opts.pasteKeepStyle.length !== 0) ? ',' + this.opts.pasteKeepStyle.join(',') : '';\n        $elms.not('[data-redactor-style-cache]' + filterStyle).removeAttr('style');\n\n        // remove class\n        var filterClass = (this.opts.pasteKeepClass.length !== 0) ? ',' + this.opts.pasteKeepClass.join(',') : '';\n        $elms.not('[data-redactor-style-cache], span.redactor-component' + filterClass).removeAttr('class');\n\n        // remove attrs\n        var filterAttrs = (this.opts.pasteKeepAttrs.length !== 0) ? ',' + this.opts.pasteKeepAttrs.join(',') : '';\n        $elms.not('img, a, span.redactor-component, [data-redactor-style-cache]' + filterAttrs).each(function(node)\n        {\n            var attrs = node.attributes;\n            for (var i = attrs.length - 1; i >= 0; i--) {\n                if (node.attributes[i].name !== 'class' && node.attributes[i].name !== 'dir') {\n                    node.removeAttribute(attrs[i].name);\n                }\n            }\n        });\n\n        // paste link target\n        if (this.opts.pasteLinks && this.opts.pasteLinkTarget !== false)\n        {\n            $wrapper.find('a').attr('target', this.opts.pasteLinkTarget);\n        }\n\n        // keep style\n        $wrapper.find('[data-redactor-style-cache]').each(function(node)\n        {\n            var style = node.getAttribute('data-redactor-style-cache');\n            node.setAttribute('style', style);\n        });\n\n        // remove image attributes\n        var imageattrs = this.opts.imageAttrs;\n        $wrapper.find('img').each(function(node) {\n            if (node.attributes.length > 0) {\n                var attrs = node.attributes;\n                for (var i = attrs.length - 1; i >= 0; i--) {\n                    if (imageattrs.indexOf(attrs[i].name) === -1) {\n                        node.removeAttribute(attrs[i].name);\n                    }\n                }\n            }\n        });\n\n        // remove empty span\n        $wrapper.find('span').each(function(node)\n        {\n            if (node.attributes.length === 0)\n            {\n                $R.dom(node).unwrap();\n            }\n        });\n\n        // remove empty inline\n        $wrapper.find(this.opts.inlineTags.join(',')).each(function(node)\n        {\n            if (node.attributes.length === 0 && this.utils.isEmptyHtml(node.innerHTML))\n            {\n                $R.dom(node).unwrap();\n            }\n\n        }.bind(this));\n\n        // place ul/ol into li\n        $wrapper.find('ul, ol').each(function(node)\n        {\n            var prev = node.previousSibling;\n            if (prev && prev.tagName === 'LI')\n            {\n                var $li = $R.dom(prev);\n                $li.find('p').unwrap();\n                $li.append(node);\n            }\n        });\n\n        // get wrapper\n        html = this.utils.getWrapperHtml($wrapper);\n\n        // remove paragraphs form lists (google docs bug)\n        html = html.replace(/<li><p>/gi, '<li>');\n        html = html.replace(/<\\/p><\\/li>/gi, '</li>');\n\n        // gmail list paste\n        html = html.replace(/^<li/gi, '<ul><li');\n        html = html.replace(/<\\/li>$/gi, '</li></ul>');\n\n        // convert lines to br\n        if (this.opts.breakline) {\n            html = html.replace(/\\n/g, '<br>');\n        }\n\n        // clean empty p\n        html = html.replace(/<p>&nbsp;<\\/p>/gi, '<p></p>');\n        html = html.replace(/<p><br\\s?\\/?><\\/p>/gi, '<p></p>');\n\n        if (isMsWord)\n        {\n            html = html.replace(/<p><\\/p>/gi, '');\n            html = html.replace(/<p>\\s<\\/p>/gi, '');\n            html = html.replace(/<td\\n/gi, '<td ');\n        }\n\n        // restore components\n        html = this.restoreComponents(html);\n\n        return html;\n    },\n    pastePlainText: function(html)\n    {\n        html = (this.opts.pasteLinks) ? this.storeLinks(html) : html;\n        html = (this.opts.pasteImages) ? this.storeImages(html) : html;\n\n        html = this.getPlainText(html);\n        html = this._replaceNlToBr(html);\n\n        html = (this.opts.pasteLinks) ? this.restoreLinks(html) : html;\n        html = (this.opts.pasteImages) ? this.restoreImages(html) : html;\n\n        return html;\n    },\n    tidy: function(html)\n    {\n        return html;\n    },\n    paragraphize: function(html)\n    {\n        var paragraphize = $R.create('cleaner.paragraphize', this.app);\n        html = paragraphize.convert(html);\n        return html;\n    },\n    storeComments: function(html, storedComments) {\n        var comments = html.match(new RegExp('<!--([\\\\w\\\\W]*?)-->', 'gi'));\n        if (comments !== null) {\n            for (var i = 0; i < comments.length; i++) {\n                html = html.replace(comments[i], '#####xstarthtmlcommentzz' + i + 'xendhtmlcommentzz#####');\n                storedComments.push(comments[i]);\n            }\n        }\n\n        return html;\n    },\n    restoreComments: function(html, storedComments) {\n        for (var i = 0; i < storedComments.length; i++) {\n            html = html.replace('#####xstarthtmlcommentzz' + i + 'xendhtmlcommentzz#####', storedComments[i]);\n        }\n\n        return html;\n    },\n\n    // get\n    getFlatText: function(html)\n    {\n        var $div = $R.dom('<div>');\n\n        if (!html.nodeType && !html.dom)\n        {\n            html = html.toString();\n            html = html.trim();\n            $div.html(html);\n        }\n        else\n        {\n            $div.append(html);\n        }\n\n        html = $div.get().textContent || $div.get().innerText || '';\n\n        return (html === undefined) ? '' : html;\n    },\n\tgetPlainText: function(html)\n\t{\n\t\thtml = html.replace(/<!--[\\s\\S]*?-->/gi, '');\n\t\thtml = html.replace(/<style[\\s\\S]*?style>/gi, '');\n        html = html.replace(/<p><\\/p>/g, '');\n\t\thtml = html.replace(/<\\/div>|<\\/li>|<\\/td>/gi, '\\n');\n\t\thtml = html.replace(/<\\/p>/gi, '\\n\\n');\n\t\thtml = html.replace(/<\\/H[1-6]>/gi, '\\n\\n');\n\n\t\tvar tmp = document.createElement('div');\n\t\ttmp.innerHTML = html;\n\n\t\thtml = tmp.textContent || tmp.innerText;\n\n\t\treturn html.trim();\n\t},\n\n    // replace\n    replaceTags: function(html, tags)\n    {\n        if (tags)\n        {\n            var self = this;\n            var keys = Object.keys(tags);\n            var $wrapper = this.utils.buildWrapper(html);\n            $wrapper.find(keys.join(',')).each(function(node)\n            {\n                self.utils.replaceToTag(node, tags[node.tagName.toLowerCase()]);\n            });\n\n            html = this.utils.getWrapperHtml($wrapper);\n        }\n\n        return html;\n    },\n    replaceNbspToSpaces: function(html)\n    {\n        return html.replace('&nbsp;', ' ');\n    },\n    replaceBlocksToBr: function(html)\n    {\n        html = html.replace(/<div[^>]*><\\/div>/gi, '');\n        html = html.replace(/<td[^>]*><\\/td>/gi, '');\n        html = html.replace(/<\\/div>|<\\/li>|<\\/td>|<\\/p>|<\\/H[1-6]>/gi, '<br>');\n\n        return html;\n    },\n\n    // clean\n    cleanNewLines: function(html)\n    {\n        return html.replace(/\\r?\\n/g, \"\");\n    },\n    cleanSpacesInPre: function(html)\n    {\n        return html.replace('&nbsp;&nbsp;&nbsp;&nbsp;', '    ');\n    },\n\n    // remove\n    removeInvisibleSpaces: function(html)\n    {\n        html = this.utils.removeInvisibleChars(html);\n        html = html.replace(/&#65279;/gi, '');\n\n        return html;\n    },\n    removeNl: function(html)\n    {\n        html = html.replace(/\\n/g, \" \");\n        html = html.replace(/\\s+/g, \"\\s\");\n\n        return html;\n    },\n    removeBrAtEnd: function(html)\n    {\n        html = html.replace(/<br\\s?\\/?>$/gi, ' ');\n        html = html.replace(/<br\\s?\\/?><li/gi, '<li');\n\n        return html;\n    },\n    removeTags: function(input, denied)\n    {\n        var re = (denied) ? /<\\/?([a-z][a-z0-9]*)\\b[^>]*>/gi : /(<([^>]+)>)/gi;\n        var replacer = (!denied) ? '' : function ($0, $1)\n        {\n            return denied.indexOf($1.toLowerCase()) === -1 ? $0 : '';\n        };\n\n        return input.replace(re, replacer);\n    },\n    removeTagsExcept: function(input, except)\n    {\n        if (except === undefined) return input.replace(/(<([^>]+)>)/gi, '');\n\n        var tags = /<\\/?([a-z][a-z0-9]*)\\b[^>]*>/gi;\n        return input.replace(tags, function($0, $1)\n        {\n            return except.indexOf($1.toLowerCase()) === -1 ? '' : $0;\n        });\n    },\n    removeComments: function(html)\n    {\n        return html.replace(this.reComments, '');\n    },\n    removeServiceTagsAndAttrs: function(html, removeMarkers)\n    {\n        var $wrapper = this.utils.buildWrapper(html);\n        var self = this;\n        if (removeMarkers !== false)\n        {\n            $wrapper.find('.redactor-selection-marker').each(function(node)\n            {\n                var $el = $R.dom(node);\n                var text = self.utils.removeInvisibleChars($el.text());\n\n                return (text === '') ? $el.remove() : $el.unwrap();\n            });\n        }\n\n        $wrapper.find('[data-redactor-style-cache]').removeAttr('data-redactor-style-cache');\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n    removeSpanWithoutAttributes: function(html)\n    {\n        var $wrapper = this.utils.buildWrapper(html);\n        $wrapper.find('span').removeAttr('data-redactor-span data-redactor-style-cache').each(function(node)\n        {\n            if (node.attributes.length === 0) $R.dom(node).unwrap();\n        });\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n    removeFirstBlockBreaklineInHtml: function(html)\n    {\n        return html.replace(new RegExp('</li><br\\\\s?/?>', 'gi'), '</li>');\n    },\n    removeEmptyAttributes: function(html, attrs)\n    {\n        var $wrapper = this.utils.buildWrapper(html);\n        for (var i = 0; i < attrs.length; i++)\n        {\n            $wrapper.find('[' + attrs[i] + '=\"\"]').removeAttr(attrs[i]);\n        }\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n\n    // encode / decode\n    encodeHtml: function(html)\n    {\n        html = html.replace(/<br\\s?\\/?>/g, \"\\n\");\n        html = html.replace(/&nbsp;/g, ' ');\n        html = html.replace(/”/g, '\"');\n        html = html.replace(/“/g, '\"');\n        html = html.replace(/‘/g, '\\'');\n        html = html.replace(/’/g, '\\'');\n        html = this.encodeEntities(html);\n        html = html.replace(/\\$/g, '&#36;');\n\n        if (this.opts.preSpaces)\n        {\n            html = html.replace(/\\t/g, new Array(this.opts.preSpaces + 1).join(' '));\n        }\n\n        return html;\n    },\n\n    encodeCode: function(html) {\n\n        html = this.encodeAttrSings(html);\n\n        // replace all tags\n        html = html.replace(/<\\s/gi, '&lt; ');\n        html = html.replace(/<([^>]+)</gi, '&lt;$1<');\n        html = html.replace(/<(.*?)>/gi, 'xtagstartz$1xtagendz');\n\n        // revert pre / code\n        html = html.replace(/xtagstartzpre(.*?)xtagendz/g, '<pre$1>');\n        html = html.replace(/xtagstartzcode(.*?)xtagendz/g, '<code$1>');\n        html = html.replace(/xtagstartz\\/codextagendz/g, '</code>');\n        html = html.replace(/xtagstartz\\/prextagendz/g, '</pre>');\n\n        // encode\n        html = this._encodeCode(html);\n\n        // revert all tags\n        html = html.replace(/xtagstartz([\\w\\W]*?)xtagendz/g, '<$1>');\n        html = html.replace(/xtagstartz\\/(.*?)xtagendz/g, '</$1>');\n\n        html = this.decodeAttrSings(html);\n\n        return html;\n    },\n    _encodeCode: function(html) {\n        var $wrapper = this.utils.buildWrapper(html);\n        $wrapper.find('pre code, pre, code').each(this._encodeNode.bind(this));\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n    _encodeNode: function(node) {\n        var first = node.firstChild;\n        var html = node.innerHTML;\n        if (node.tagName === 'PRE' && first && first.tagName === 'CODE') {\n            return;\n        }\n\n        html = html.replace(/xtagstartz/g, '<');\n        html = html.replace(/xtagendz/g, '>');\n\n        var encoded = this.decodeEntities(html);\n        node.textContent = this._encodeNodeHtml(encoded);\n    },\n    _encodeNodeHtml: function(html) {\n        html = html.replace(/&nbsp;/g, ' ').replace(/<br\\s?\\/?>/g, '\\n');\n        html = (this.opts.preSpaces) ? html.replace(/\\t/g, new Array(this.opts.preSpaces + 1).join(' ')) : html;\n\n        return html;\n    },\n\n    encodeAttrSings: function(html) {\n        var matches = html.match(/=\"(.*?)\"/g);\n        if (matches !== null) {\n            for (var i = 0; i < matches.length; i++) {\n                if (matches[i].search(/^\"</) !== -1 || matches[i].search(/>\"$/) !== -1) {\n                    continue;\n                }\n\n\n                var str = matches[i].replace('>', 'xmoresignz');\n                str = str.replace('<', 'xlesssignz');\n                html = html.replace(matches[i], str);\n            }\n        }\n\n        return html;\n    },\n    encodeEntities: function(str)\n    {\n        str = this.decodeEntities(str);\n        str = str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;');\n\n        return str;\n    },\n    encodePhpCode: function(html)\n    {\n        html = html.replace('<?php', '&lt;?php');\n        html = html.replace('<?', '&lt;?');\n        html = html.replace('?>', '?&gt;');\n\n        return html;\n    },\n    decodeAttrSings: function(html) {\n        html = html.replace(/xmoresignz/gi, '>');\n        html = html.replace(/xlesssignz/gi, '<');\n\n        return html;\n    },\n    decodeEntities: function(str)\n    {\n        return String(str).replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&quot;/g, '\"').replace(/&amp;/g, '&');\n    },\n\n    // store / restore\n    storeComponents: function(html)\n    {\n        var matched = this.utils.getElementsFromHtml(html, 'figure', 'table');\n\n        return this._storeMatched(html, matched, 'Components', 'figure');\n    },\n    restoreComponents: function(html)\n    {\n        return this._restoreMatched(html, 'Components', 'figure');\n    },\n    storeLinks: function(html)\n    {\n        var matched = this.utils.getElementsFromHtml(html, 'a');\n\n        return this._storeMatched(html, matched, 'Links', 'a');\n    },\n    storeImages: function(html)\n    {\n        var matched = this.utils.getElementsFromHtml(html, 'img');\n\n        return this._storeMatched(html, matched, 'Images', 'img');\n    },\n    restoreLinks: function(html)\n    {\n        return this._restoreMatched(html, 'Links', 'a');\n    },\n    restoreImages: function(html)\n    {\n        return this._restoreMatched(html, 'Images', 'img');\n    },\n\n    // PRIVATE\n\n    // clean\n    _cleanWrapped: function(html)\n    {\n        html = html.replace(new RegExp('<p><figure([\\\\w\\\\W]*?)</figure></p>', 'gi'), '<figure$1</figure>');\n\n        return html;\n    },\n    _cleanGDocs: function(html)\n    {\n        // remove google docs markers\n        html = html.replace(/<b\\sid=\"internal-source-marker(.*?)\">([\\w\\W]*?)<\\/b>/gi, \"$2\");\n        html = html.replace(/<b(.*?)id=\"docs-internal-guid(.*?)\">([\\w\\W]*?)<\\/b>/gi, \"$3\");\n\n        html = html.replace(/<span[^>]*(font-style:\\s?italic;\\s?font-weight:\\s?bold|font-weight:\\s?bold;\\s?font-style:\\s?italic)[^>]*>([\\w\\W]*?)<\\/span>/gi, '<b><i>$2</i></b>');\n        html = html.replace(/<span[^>]*(font-style:\\s?italic;\\s?font-weight:\\s?600|font-weight:\\s?600;\\s?font-style:\\s?italic)[^>]*>([\\w\\W]*?)<\\/span>/gi, '<b><i>$2</i></b>');\n        html = html.replace(/<span[^>]*(font-style:\\s?italic;\\s?font-weight:\\s?700|font-weight:\\s?700;\\s?font-style:\\s?italic)[^>]*>([\\w\\W]*?)<\\/span>/gi, '<b><i>$2</i></b>');\n        html = html.replace(/<span[^>]*font-style:\\s?italic[^>]*>([\\w\\W]*?)<\\/span>/gi, '<i>$1</i>');\n        html = html.replace(/<span[^>]*font-weight:\\s?bold[^>]*>([\\w\\W]*?)<\\/span>/gi, '<b>$1</b>');\n        html = html.replace(/<span[^>]*font-weight:\\s?700[^>]*>([\\w\\W]*?)<\\/span>/gi, '<b>$1</b>');\n        html = html.replace(/<span[^>]*font-weight:\\s?600[^>]*>([\\w\\W]*?)<\\/span>/gi, '<b>$1</b>');\n\n        return html;\n    },\n    _cleanMsWord: function(html)\n    {\n        html = html.replace(/<!--[\\s\\S]+?-->/gi, '');\n        html = html.replace(/<(!|script[^>]*>.*?<\\/script(?=[>\\s])|\\/?(\\?xml(:\\w+)?|img|meta|link|style|\\w:\\w+)(?=[\\s\\/>]))[^>]*>/gi, '');\n        html = html.replace(/<(\\/?)s>/gi, \"<$1strike>\");\n        html = html.replace(/&nbsp;/gi, ' ');\n        html = html.replace(/<span\\s+style\\s*=\\s*\"\\s*mso-spacerun\\s*:\\s*yes\\s*;?\\s*\"\\s*>([\\s\\u00a0]*)<\\/span>/gi, function(str, spaces) {\n            return (spaces.length > 0) ? spaces.replace(/./, \" \").slice(Math.floor(spaces.length/2)).split(\"\").join(\"\\u00a0\") : '';\n        });\n\n        // build wrapper\n        var $wrapper = this.utils.buildWrapper(html);\n\n        // footnote fix\n        $wrapper.find('.MsoFootnoteText').each(function(node) {\n            var $node = $R.dom(node);\n            var $parent = $node.parent();\n            if ($parent.length !== 0 && $parent.attr('style').search(/mso-element:footnote/) !== -1) {\n                $node.find('a').attr('id', '_' + $parent.attr('id'));\n            }\n\n        });\n\n        $wrapper.find('.MsoFootnoteReference').each(function(node) {\n            var $node = $R.dom(node);\n            var $parent = $node.parent();\n            if ($parent.length !== 0 && $parent.get().tagName === 'A') {\n                $parent.attr('id', $parent.attr('name'));\n            }\n\n        });\n\n        // build lists\n        $wrapper.find('p').each(function(node)\n        {\n            var $node = $R.dom(node);\n            var str = $node.attr('style');\n            var matches = /mso-list:\\w+ \\w+([0-9]+)/.exec(str);\n            if (matches)\n            {\n                $node.attr('data-listLevel',  parseInt(matches[1], 10));\n            }\n        });\n\n        // parse Lists\n        this._parseWordLists($wrapper);\n\n        $wrapper.find('[align]').removeAttr('align');\n        $wrapper.find('[name]').removeAttr('name');\n        $wrapper.find('span').each(function(node)\n        {\n            var $node = $R.dom(node);\n            var str = $node.attr('style');\n            var matches = /mso-list:Ignore/.exec(str);\n\n            if (matches) $node.remove();\n            else $node.unwrap();\n\n        });\n        $wrapper.find('[style]').removeAttr('style');\n        $wrapper.find(\"[class^='Mso']\").removeAttr('class');\n        $wrapper.find('a').filter(function(node) { return !node.hasAttribute('href'); }).unwrap();\n\n        // get wrapper\n        html = this.utils.getWrapperHtml($wrapper);\n        html = html.replace(/<p[^>]*><\\/p>/gi, '');\n        html = html.replace(/<li>·/gi, '<li>');\n        html = html.trim();\n\n        // remove spaces between\n        html = html.replace(/\\/(p|ul|ol|h1|h2|h3|h4|h5|h6|blockquote)>\\s+<(p|ul|ol|h1|h2|h3|h4|h5|h6|blockquote)/gi, '/$1>\\n<$2');\n\n        var result = '';\n        var lines = html.split(/\\n/);\n        for (var i = 0; i < lines.length; i++)\n        {\n            var space = (lines[i] !== '' && lines[i].search(/>$/) === -1) ? ' ' : '\\n';\n\n            result += lines[i] + space;\n        }\n\n        return result;\n    },\n    _parseWordLists: function($wrapper)\n    {\n        var lastLevel = 0;\n        var $item = null;\n        var $list = null;\n        var $listChild = null;\n\n        $wrapper.find('p').each(function(node) {\n            var $node = $R.dom(node);\n            var level = $node.attr('data-listLevel');\n            if (level === null && $node.hasClass('MsoListParagraphCxSpMiddle')) {\n                level = 1;\n            }\n\n            if (level !== null) {\n                var txt = $node.text();\n                var listTag = (/^\\s*\\w+\\./.test(txt)) ? '<ol></ol>' : '<ul></ul>';\n\n                // new parent list\n                if ($node.hasClass('MsoListParagraphCxSpFirst') || $node.hasClass('MsoNormal')) {\n                    $list = $R.dom(listTag);\n                    $node.before($list);\n                }\n                // new child list\n                else if (level > lastLevel && lastLevel !== 0) {\n                    $listChild = $R.dom(listTag);\n                    $item.append($listChild);\n                    $list = $listChild;\n                }\n                // level up\n                if (level < lastLevel) {\n                    var len = lastLevel - level + 1;\n                    for (var i = 0; i < len; i++) {\n                        $list = $list.parent();\n                    }\n                }\n\n                // create item\n                $node.find('span').first().unwrap();\n                $item = $R.dom('<li>' + $node.html().trim() + '</li>');\n                if ($list === null) {\n                    $node.before(listTag);\n                    $list = $node.prev();\n                }\n\n                // append\n                $list.append($item);\n                $node.remove();\n\n                lastLevel = level;\n            }\n            else {\n                $list = null;\n                lastLevel = 0;\n            }\n        });\n    },\n\n    // is\n    _isSpacedEmpty: function(html)\n    {\n        return (html.search(this.reSpacedEmpty) !== -1);\n    },\n    _isParagraphEmpty: function(html)\n    {\n        return (html.search(/^<p><\\/p>$/i) !== -1);\n    },\n    _isHtmlMsWord: function(html)\n    {\n        return html.match(/class=\"?Mso|style=\"[^\"]*\\bmso-|style='[^'']*\\bmso-|w:WordDocument/i);\n    },\n\n    // set\n    _setSpanAttr: function(html)\n    {\n        var $wrapper = this.utils.buildWrapper(html);\n        $wrapper.find('span').attr('data-redactor-span', true);\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n    _setStyleCache: function(html)\n    {\n        var $wrapper = this.utils.buildWrapper(html);\n        $wrapper.find('[style]').each(function(node)\n        {\n            var $el = $R.dom(node);\n            $el.attr('data-redactor-style-cache', $el.attr('style'));\n        });\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n    _setPreClass: function(html)\n    {\n        var $wrapper = this.utils.buildWrapper(html);\n        $wrapper.find('pre').addClass(this.opts.preClass);\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n    _setLinkNofollow: function(html)\n    {\n        var $wrapper = this.utils.buildWrapper(html);\n        $wrapper.find('a').attr('rel', 'nofollow');\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n\n    // replace\n    _replaceScriptTag: function(html)\n    {\n        return html.replace(this.reScriptTag, '<script class=\"redactor-script-tag\" $1>$2</script>');\n    },\n    _unreplaceScriptTag: function(html)\n    {\n        return html.replace(/<script class=\"redactor-script-tag\"(.*?[^>]?)>([\\w\\W]*?)<\\/script>/gi, '<script$1>$2</script>');\n    },\n\t_replaceNlToBr: function(html)\n\t{\n\t\treturn html.replace(/\\n/g, '<br />');\n\t},\n\n    // remove\n    _removeScriptTag: function(html)\n    {\n        return html.replace(this.reScriptTag, '');\n    },\n\n    // private\n    _storeMatched: function(html, matched, stored, name)\n    {\n        this['stored' + stored] = [];\n        if (matched)\n        {\n            for (var i = 0; i < matched.length; i++)\n            {\n                this['stored' + stored][i] = matched[i];\n                html = html.replace(matched[i], '####' + name + i + '####');\n            }\n        }\n\n        return html;\n    },\n    _restoreMatched: function(html, stored, name)\n    {\n        if (this['stored' + stored])\n        {\n            for (var i = 0; i < this['stored' + stored].length; i++)\n            {\n                html = html.replace('####' + name + i + '####', this['stored' + stored][i]);\n            }\n        }\n\n        return html;\n    }\n});\n$R.add('class', 'cleaner.figure', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.detector = app.detector;\n    },\n    // public\n    convert: function(html, rules)\n    {\n        var $wrapper = this.utils.buildWrapper(html);\n\n        // convert\n        $wrapper.find('img').each(this._convertImage.bind(this));\n        $wrapper.find('hr').each(this._convertLine.bind(this));\n        $wrapper.find('iframe').each(this._convertIframe.bind(this));\n        $wrapper.find('table').each(this._convertTable.bind(this));\n        $wrapper.find('form').each(this._convertForm.bind(this));\n        $wrapper.find('figure pre').each(this._convertCode.bind(this));\n\n        // variables\n        $wrapper.find('[data-redactor-type=variable]').addClass('redactor-component');\n\n        // widgets\n        $wrapper.find('figure').not('.redactor-component, .redactor-figure-code').each(this._convertWidget.bind(this));\n\n        // contenteditable\n        $wrapper.find('figure pre').each(this._setContenteditableCode.bind(this));\n        $wrapper.find('.redactor-component, .non-editable').attr('contenteditable', false);\n\n        if (this.detector.isIe())\n        {\n            $wrapper.find('[data-redactor-type=table]').removeAttr('contenteditable');\n        }\n\n        $wrapper.find('figcaption, td, th').attr('contenteditable', true);\n        $wrapper.find('.redactor-component, figcaption').attr('tabindex', '-1');\n\n        // extra rules\n        this._acceptExtraRules($wrapper, rules);\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n    unconvert: function(html, rules)\n    {\n        html = html.replace(/<\\/([^>]+)><div data-redactor-tag/g, '</$1>\\n<div data-redactor-tag');\n        html = html.replace(/<\\/([^>]+)><p/g, '</$1>\\n<p');\n\n        var $wrapper = this.utils.buildWrapper(html);\n\n        // contenteditable\n        $wrapper.find('th, td, figcaption, figure, pre, code, .redactor-component').removeAttr('contenteditable tabindex');\n\n        // remove class\n        $wrapper.find('figure').removeClass('redactor-component redactor-component-active redactor-uploaded-figure');\n\n        // unconvert\n        $wrapper.find('[data-redactor-type=variable]').removeClass('redactor-component redactor-component-active');\n        $wrapper.find('figure[data-redactor-type=line]').unwrap();\n        $wrapper.find('figure[data-redactor-type=widget]').each(this._unconvertWidget.bind(this));\n        $wrapper.find('figure[data-redactor-type=form]').each(this._unconvertForm.bind(this));\n        $wrapper.find('figure[data-redactor-type=table]').each(this._unconvertTable.bind(this));\n        $wrapper.find('figure[data-redactor-type=image]').removeAttr('rel').each(this._unconvertImages.bind(this));\n\n        $wrapper.find('img').removeAttr('data-redactor-type').removeClass('redactor-component');\n        $wrapper.find('.non-editable').removeAttr('contenteditable');\n\n        // remove types\n        $wrapper.find('figure').each(this._removeTypes.bind(this));\n\n        // remove caret\n        $wrapper.find('span.redactor-component-caret').remove();\n\n        // break div\n        $wrapper = this._unconvertBreakTag($wrapper);\n\n        // extra rules\n        this._acceptExtraRules($wrapper, rules);\n\n        html = this.utils.getWrapperHtml($wrapper);\n        html = html.replace(/<br\\s?\\/?>$/, '');\n        html = html.replace(/<br\\s?\\/?><\\/(td|th)>/, '</$1>');\n\n        return html;\n    },\n\n    // private\n    _convertImage: function(node)\n    {\n        var $node = $R.dom(node);\n        if (this._isNonEditable($node)) return;\n\n        // set id\n        if (this.opts.imageObserve && !$node.attr('data-image'))\n        {\n            $node.attr('data-image', this.utils.getRandomId());\n        }\n\n        var $link = $node.closest('a');\n        var $figure = $node.closest('figure');\n        var isImage = ($figure.children().not('a, img, br, figcaption').length === 0);\n        if (!isImage) return;\n\n        if ($figure.length === 0)\n        {\n            var $parent = ($link.length !== 0) ? $link.closest('p') : $node.closest('p');\n            if (this.opts.imageFigure === false && $parent.length !== 0)\n            {\n                var $el = this.utils.replaceToTag($parent, 'figure');\n                $figure = $el;\n                $figure.addClass('redactor-replace-figure');\n            }\n            else\n            {\n                if ($parent.length !== 0) {\n                    $parent.unwrap();\n                }\n\n                $figure = ($link.length !== 0) ? $link.wrap('<figure>') : $node.wrap('<figure>');\n            }\n        }\n        else\n        {\n            if ($figure.hasClass('redactor-uploaded-figure'))\n            {\n                $figure.removeClass('redactor-uploaded-figure');\n            }\n            else\n            {\n                $figure.addClass('redactor-keep-figure');\n            }\n        }\n\n        this._setFigure($figure, 'image');\n    },\n    _convertTable: function(node)\n    {\n        if (this._isNonEditable(node)) return;\n\n        var $figure = this._wrapFigure(node);\n        this._setFigure($figure, 'table');\n    },\n    _convertLine: function(node)\n    {\n        if (this._isNonEditable(node)) return;\n\n        var $figure = this._wrapFigure(node);\n        this._setFigure($figure, 'line');\n    },\n    _convertForm: function(node)\n    {\n        if (this._isNonEditable(node)) return;\n\n        var $figure = this.utils.replaceToTag(node, 'figure');\n        this._setFigure($figure, 'form');\n    },\n    _convertIframe: function(node)\n    {\n        if (this._isNonEditable(node)) return;\n\n        var $node = $R.dom(node);\n        if ($node.closest('.redactor-component').length !== 0) return;\n\n        var src = node.getAttribute('src');\n        var isVideo = (src && (src.match(this.opts.regex.youtube) || src.match(this.opts.regex.vimeo)));\n        var $figure = this._wrapFigure(node);\n\n        if (isVideo)\n        {\n            this._setFigure($figure, 'video');\n        }\n    },\n    _convertCode: function(node)\n    {\n        if (this._isNonEditable(node)) return;\n\n        var $figure = this._wrapFigure(node);\n        this._setFigure($figure, 'code');\n    },\n    _convertWidget: function(node)\n    {\n        if (this._isNonEditable(node)) return;\n\n        var $node = $R.dom(node);\n        $node.addClass('redactor-component');\n        $node.attr('data-redactor-type', 'widget');\n        $node.attr('data-widget-code', encodeURI(node.innerHTML.trim()));\n    },\n\n    // unconvert\n    _unconvertBreakTag: function($wrapper) {\n        $wrapper.find('[data-redactor-tag]').each(function(node) {\n            var $node = $R.dom(node);\n            $node.removeAttr('data-redactor-tag');\n            if (node.attributes.length !== 0) {\n                if (node.lastChild && node.lastChild.tagName === 'BR') $R.dom(node.lastChild).remove();\n                return;\n            }\n\n            if (node.lastChild && node.lastChild.tagName === 'BR') {\n                $node.unwrap();\n            }\n            else {\n                var $next = $node.nextElement();\n                if ($next.length !== 0 && $next.attr('data-redactor-tag')) {\n                    node.appendChild(document.createElement('br'));\n                }\n\n                $node.unwrap();\n            }\n        }.bind(this));\n        return $wrapper;\n    },\n    _unconvertForm: function(node)\n    {\n        this.utils.replaceToTag(node, 'form');\n    },\n    _unconvertTable: function(node)\n    {\n        var $node = $R.dom(node);\n        $node.unwrap();\n    },\n    _unconvertWidget: function(node)\n    {\n        var $node = $R.dom(node);\n        $node.html(decodeURI($node.attr('data-widget-code')));\n        $node.removeAttr('data-widget-code');\n    },\n    _unconvertImages: function(node)\n    {\n        var $node = $R.dom(node);\n        $node.removeClass('redactor-component');\n\n        var isList = ($node.closest('li').length !== 0);\n        var isTable = ($node.closest('table').length !== 0);\n        var hasFigcaption = ($node.find('figcaption').length !== 0);\n\n        var style = $node.attr('style');\n        var hasStyle = !(style === null || style === '');\n        var hasClass = ($node.attr('class') !== '');\n\n        if (isList || (isTable && !hasFigcaption && !hasStyle && !hasClass))\n        {\n            $node.unwrap();\n        }\n    },\n    _removeTypes: function(node)\n    {\n        var $node = $R.dom(node);\n        var type = $node.attr('data-redactor-type');\n        var removed = ['image', 'widget', 'line', 'video', 'code', 'form', 'table'];\n        if (type && removed.indexOf(type) !== -1)\n        {\n            $node.removeAttr('data-redactor-type');\n        }\n\n        // keep figure\n        if ($node.hasClass('redactor-keep-figure'))\n        {\n            $node.removeClass('redactor-keep-figure');\n        }\n\n        // unwrap figure\n        else if (type === 'image' && this.opts.imageFigure === false)\n        {\n            var hasFigcaption = ($node.find('figcaption').length !== 0);\n            if (!hasFigcaption)\n            {\n                // replace\n                if ($node.hasClass('redactor-replace-figure'))\n                {\n                    $node.removeClass('redactor-replace-figure');\n                    this.utils.replaceToTag($node, 'p');\n                }\n                else\n                {\n                    this.utils.replaceToTag($node, 'p');\n                }\n            }\n        }\n\n        $node.removeClass('redactor-replace-figure');\n    },\n\n    // wrap\n    _wrapFigure: function(node)\n    {\n        var $node = $R.dom(node);\n        var $figure = $node.closest('figure');\n\n        return ($figure.length === 0) ? $node.wrap('<figure>') : $figure;\n    },\n\n    // set\n    _setFigure: function($figure, type)\n    {\n        $figure.addClass('redactor-component');\n        $figure.attr('data-redactor-type', type);\n    },\n    _setContenteditableCode: function(node)\n    {\n        if (this._isNonEditable(node)) return;\n\n        var $node = $R.dom(node);\n        var $code = $node.children('code').first();\n\n        var $el = ($code.length !== 0) ? $code : $node;\n        $el.attr('contenteditable', true).attr('tabindex', '-1');\n    },\n\n    // utils\n    _acceptExtraRules: function($wrapper, rules)\n    {\n        for (var key in rules)\n        {\n            if (typeof rules[key] === 'function')\n            {\n                rules[key]($wrapper);\n            }\n        }\n    },\n    _isNonEditable: function(node)\n    {\n        return ($R.dom(node).closest('.non-editable').length !== 0);\n    }\n});\n$R.add('class', 'cleaner.paragraphize', {\n    init: function(app) {\n        this.app = app;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.cleaner = app.cleaner;\n        this.element = app.element;\n\n        // local\n        this.stored = [];\n        this.remStart = '#####replace';\n        this.remEnd = '#####';\n        this.paragraphizeTags = ['table', 'div', 'pre', 'form', 'ul', 'ol', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'dl', 'blockquote', 'figcaption',\n                'address', 'section', 'header', 'footer', 'aside', 'article', 'object', 'style', 'script', 'iframe', 'select', 'input', 'textarea',\n                'button', 'option', 'map', 'area', 'math', 'hr', 'fieldset', 'legend', 'hgroup', 'nav', 'figure', 'details', 'menu', 'summary', 'p'];\n    },\n    // public\n    convert: function(html) {\n\n        var value = this._isConverted(html);\n\n        value = (value === true) ? this._convert(html) : value;\n        value = this._convertTable(value);\n\n        return value;\n    },\n\n    // private\n    _convert: function(html, tablemarkup) {\n        // build markup tag\n        var tag = (this.opts.breakline || tablemarkup) ? 'sdivtag' : this.opts.markup;\n        var attr = (tablemarkup) ? 'tbr' : 'br';\n\n        // store\n        html = this._storeTags(html);\n\n        var storedComments = [];\n        html = this.cleaner.storeComments(html, storedComments);\n\n        // trim\n        html = html.trim();\n        html = this._trimLinks(html);\n\n        // trim new line in inline\n        var inlines = this.opts.inlineTags.join('|');\n        html = html.replace(new RegExp('<(' + inlines + ')(.*?[^>]?)>\\n</(' + inlines + ')>', 'gi'), '<$1$2></$3>');\n\n        // replace new lines\n        html = html.replace(/xparagraphmarkerz(?:\\r\\n|\\r|\\n)$/g, '');\n        html = html.replace(/xparagraphmarkerz$/g, '');\n        html = html.replace(/xparagraphmarkerz(?:\\r\\n|\\r|\\n)/g, '\\n');\n        html = html.replace(/xparagraphmarkerz/g, '\\n');\n\n        if (this.opts.breakline) {\n            html = html.replace(/<br\\s?\\/?>(?:\\r\\n|\\r|\\n)/gi, 'xbreakmarkerz\\n');\n            html = html.replace(/<br\\s?\\/?>/gi, 'xbreakmarkerz\\n');\n            html = html.replace(/xbreakmarkerz\\n<\\//gi, 'xbreakmarkerz</');\n\n        }\n        else {\n            html = html.replace(/[\\n]+/g, \"\\n\");\n        }\n\n        // wrap to tag\n        var str = '';\n        var arr = html.split(\"\\n\");\n        for (var i = 0; i < arr.length; i++) {\n            str += '<' + tag + '>' + arr[i] + '</' + tag + '>\\n';\n        }\n\n        html = str.replace(/\\n$/, '');\n\n\n        // clean\n        html = html.replace(new RegExp('<' + tag + '>\\\\s+#####', 'gi'), '#####');\n        html = html.replace(new RegExp('<' + tag + '>#####', 'gi'), '#####');\n        html = html.replace(new RegExp('#####</' + tag + '>', 'gi'), '#####');\n\n        // replace marker\n        html = (this.opts.breakline) ? html.replace(/xbreakmarkerz/gi, \"<br>\") : html;\n\n        // restore\n        html = this._restoreTags(html);\n        html = this.cleaner.restoreComments(html, storedComments);\n\n        // remove empty\n        if (this.opts.breakline) {\n            html = html.replace(new RegExp('<' + tag + '></' + tag + '>', 'gi'), '<' + tag + '><br></' + tag + '>');\n        }\n        else {\n            //html = html.replace(new RegExp('<' + tag + '><br\\\\s?/?></' + tag + '>', 'gi'), '');\n            //html = html.replace(new RegExp('<' + tag + '></' + tag + '>', 'gi'), '');\n        }\n\n        // clean restored\n        html = html.replace(new RegExp('<sdivtag>', 'gi'), '<div data-redactor-tag=\"' + attr + '\">');\n        html = html.replace(new RegExp('sdivtag', 'gi'), 'div');\n        html = html.replace(/<\\/([^>]+)><div data-redactor-tag/g, '</$1>\\n<div data-redactor-tag');\n\n        return html;\n    },\n    _convertTable: function(html) {\n        var $wrapper = this.utils.buildWrapper(html);\n        $wrapper.find('td, th').each(this._convertCell.bind(this));\n        html = this.utils.getWrapperHtml($wrapper);\n\n        return html;\n    },\n    _convertCell: function(node) {\n        var $node = $R.dom(node);\n        this.stored = [];\n        var code = this._convert($node.html(), true);\n        $node.html(code);\n    },\n    _storeTags: function(html) {\n        var self = this;\n        var $wrapper = this.utils.buildWrapper(html);\n        $wrapper.find(this.paragraphizeTags.join(', ')).each(function(node, i) {\n            var replacement = document.createTextNode(self.remStart + i + self.remEnd + 'xparagraphmarkerz'); //  + \"\\n\"\n            self.stored.push(node.outerHTML);\n            node.parentNode.replaceChild(replacement, node);\n        });\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n    _restoreTags: function(html) {\n        for (var i = 0; i < this.stored.length; i++) {\n            this.stored[i] = this.stored[i].replace(/\\$/g, '&#36;');\n            html = html.replace(this.remStart + i + this.remEnd, this.stored[i]);\n        }\n\n        return html;\n    },\n    _trimLinks: function(html) {\n        var $wrapper = this.utils.buildWrapper(html);\n        $wrapper.find('a').each(this._trimLink.bind(this));\n        html = this.utils.getWrapperHtml($wrapper);\n\n        return html;\n    },\n    _trimLink: function(node) {\n        var $node = $R.dom(node);\n        $node.html($node.html().trim());\n    },\n    _isConverted: function(html) {\n        if (this._isDisabled(html)) return html;\n        else if (this._isEmptyHtml(html)) return this.opts.emptyHtml;\n        else return true;\n    },\n    _isDisabled: function() {\n        return (this.opts.paragraphize === false || this.element.isType('inline'));\n    },\n    _isEmptyHtml: function(html) {\n        return (html === '' || html === '<p></p>' || html === '<div></div>');\n    }\n});\n$R.add('service', 'detector', {\n    init: function(app)\n    {\n        this.app = app;\n\n        // local\n        this.userAgent = navigator.userAgent.toLowerCase();\n    },\n\tisWebkit: function()\n\t{\n\t\treturn /webkit/.test(this.userAgent);\n\t},\n\tisFirefox: function()\n\t{\n\t\treturn (this.userAgent.indexOf('firefox') > -1);\n\t},\n\tisIe: function(v)\n\t{\n        if (document.documentMode || /Edge/.test(navigator.userAgent)) return 'edge';\n\n\t\tvar ie;\n\t\tie = RegExp('msie' + (!isNaN(v)?('\\\\s'+v):''), 'i').test(navigator.userAgent);\n\t\tif (!ie) ie = !!navigator.userAgent.match(/Trident.*rv[ :]*11\\./);\n\n\t\treturn ie;\n\t},\n\tisMobile: function()\n\t{\n\t\treturn /(iPhone|iPod|Android)/.test(navigator.userAgent);\n\t},\n\tisDesktop: function()\n\t{\n\t\treturn !/(iPhone|iPod|iPad|Android)/.test(navigator.userAgent);\n\t},\n\tisIpad: function()\n\t{\n\t\treturn /iPad/.test(navigator.userAgent);\n\t}\n});\n$R.add('service', 'offset', {\n    init: function(app)\n    {\n        this.app = app;\n    },\n    get: function(el, trimmed)\n    {\n        var offset = { start: 0, end: 0 };\n        var node = this.utils.getNode(el);\n        if (!node) return false;\n\n        var isEditor = this.editor.isEditor(node);\n        var isIn = (isEditor) ? true : this.selection.isIn(node);\n        var range = this.selection.getRange();\n\n        if (!isEditor && !isIn)\n        {\n            offset = false;\n        }\n        else if (this.selection.is() && isIn)\n        {\n            var $startNode = $R.dom(range.startContainer);\n            var fix = ($startNode.hasClass('redactor-component')) ? range.startOffset : 0;\n            var clonedRange = range.cloneRange();\n\n            clonedRange.selectNodeContents(node);\n            clonedRange.setEnd(range.startContainer, range.startOffset);\n\n            var selection = this._getString(range, trimmed);\n\n            offset.start = this._getString(clonedRange, trimmed).length - fix;\n            offset.end = offset.start + selection.length + fix;\n        }\n\n        return offset;\n    },\n    set: function(offset, el)\n    {\n        if (this._setComponentOffset(el)) return;\n\n        this.component.clearActive();\n        var node = this.utils.getNode(el);\n        if (!node) return;\n\n        var size = this.size(node);\n        var charIndex = 0, range = document.createRange();\n\n        offset.end = (offset.end > size) ? size : offset.end;\n\n        range.setStart(node, 0);\n        range.collapse(true);\n\n        var nodeStack = [node], foundStart = false, stop = false;\n        while (!stop && (node = nodeStack.pop()))\n        {\n            if (node.nodeType === 3)\n            {\n                var nextCharIndex = charIndex + node.length;\n\n                if (!foundStart && !this._isFigcaptionNext(node) && offset.start >= charIndex && offset.start <= nextCharIndex)\n                {\n                    range.setStart(node, offset.start - charIndex);\n                    foundStart = true;\n                }\n\n                if (foundStart && offset.end >= charIndex && offset.end <= nextCharIndex)\n                {\n                    range.setEnd(node, offset.end - charIndex);\n                    stop = true;\n                }\n\n                charIndex = nextCharIndex;\n            }\n            else\n            {\n                var i = node.childNodes.length;\n                while (i--)\n                {\n                    nodeStack.push(node.childNodes[i]);\n                }\n            }\n        }\n\n        this.selection.setRange(range);\n    },\n    size: function(el, trimmed)\n    {\n        var node = this.utils.getNode(el);\n        if (node)\n        {\n            var range = document.createRange();\n\n            var clonedRange = range.cloneRange();\n            clonedRange.selectNodeContents(node);\n\n            return this._getString(clonedRange, trimmed).length;\n        }\n\n        return 0;\n    },\n\n    // private\n    _getString: function(obj, trimmed)\n    {\n        var str = obj.toString();\n        str = (this.editor.isEmpty()) ? str.replace(/\\uFEFF/g, '') : str;\n        str = (trimmed) ? str.trim() : str;\n\n        return str;\n    },\n    _setComponentOffset: function(el)\n    {\n        return (this.component.isNonEditable(el)) ? this.component.setActive(el) : false;\n    },\n    _isFigcaptionNext: function(node)\n    {\n        var next = node.nextSibling;\n        return (node.nodeValue.trim() === '' && next && next.tagName === 'FIGCAPTION');\n    }\n});\n$R.add('service', 'inspector', {\n    init: function(app)\n    {\n        this.app = app;\n    },\n    // parse\n    parse: function(el)\n    {\n        return $R.create('inspector.parser', this.app, this, el);\n    },\n\n    // text detection\n    isText: function(el)\n    {\n        if (typeof el === 'string' && !/^\\s*<(\\w+|!)[^>]*>/.test(el))\n        {\n            return true;\n        }\n\n        var node = $R.dom(el).get();\n        return (node && node.nodeType === 3); //  && !this.selection.getBlock(el)\n    },\n\n    // tag detection\n    isInlineTag: function(tag, extend)\n    {\n        var tags = this._extendTags(this.opts.inlineTags, extend);\n\n        return (this._isTag(tag) && tags.indexOf(tag.toLowerCase()) !== -1);\n    },\n    isBlockTag: function(tag, extend)\n    {\n        var tags = this._extendTags(this.opts.blockTags, extend);\n\n        return (this._isTag(tag) && tags.indexOf(tag.toLowerCase()) !== -1);\n    },\n    isTableCellTag: function(tag)\n    {\n        return (['td', 'th'].indexOf(tag.toLowerCase()) !== -1);\n    },\n    isHeadingTag: function(tag)\n    {\n        return (['h1', 'h2', 'h3', 'h4', 'h5', 'h6'].indexOf(tag.toLowerCase()) !== -1);\n    },\n\n\n    _isTag: function(tag)\n    {\n        return (tag !== undefined && tag);\n    },\n    _extendTags: function(tags, extend)\n    {\n        tags = tags.concat(tags);\n\n        if (extend)\n        {\n            for (var i = 0 ; i < extend.length; i++)\n            {\n                tags.push(extend[i]);\n            }\n        }\n\n        return tags;\n    }\n});\n$R.add('class', 'inspector.parser', {\n    init: function(app, inspector, el)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.editor = app.editor;\n        this.selection = app.selection;\n        this.inspector = inspector;\n\n        // local\n        var $editor = this.editor.getElement();\n        this.el = el;\n        this.$el = $R.dom(this.el, $editor);\n        this.node = this.$el.get();\n\n        // comment node\n        if (this.node && this.node.nodeType === 8)\n        {\n            this.node = false;\n        }\n\n        this.$component = this.$el.closest('.redactor-component', $editor);\n    },\n    // is\n    isEditor: function()\n    {\n        return (this.node === this.editor.getElement().get());\n    },\n    isInEditor: function()\n    {\n        return (this.$el.parents('.redactor-in-' + this.uuid).length !== 0);\n    },\n    isComponent: function()\n    {\n        return (this.$component.length !== 0);\n    },\n    isComponentType: function(type)\n    {\n        return (this.getComponentType() === type);\n    },\n    isComponentActive: function()\n    {\n        return (this.isComponent() && this.$component.hasClass('redactor-component-active'));\n    },\n    isComponentEditable: function()\n    {\n        var types = ['code', 'table'];\n        var type = this.getComponentType();\n\n        return (this.isComponent() && types.indexOf(type) !== -1);\n    },\n    isFigcaption: function()\n    {\n        return this.getFigcaption();\n    },\n    isPre: function()\n    {\n        return this.getPre();\n    },\n    isCode: function()\n    {\n        var $code = this.$el.closest('code');\n        var $parent = $code.parent('pre');\n\n        return ($code.length !== 0 && $parent.length === 0);\n    },\n    isList: function()\n    {\n        return this.getList();\n    },\n    isFirstListItem: function()\n    {\n        return this._getLastOrFirstListItem('first');\n    },\n    isLastListItem: function()\n    {\n        return this._getLastOrFirstListItem('last');\n    },\n    isFirstTableCell: function()\n    {\n        return this._getLastOrFirstTableCell('first');\n    },\n    isLastTableCell: function()\n    {\n        return this._getLastOrFirstTableCell('last');\n    },\n    isTable: function()\n    {\n        return (this.isComponentType('table') || this.getTable());\n    },\n    isHeading: function()\n    {\n        return this.getHeading();\n    },\n    isBlockquote: function()\n    {\n        return this.getBlockquote();\n    },\n    isDl: function()\n    {\n        return this.getDl();\n    },\n    isParagraph: function()\n    {\n        return this.getParagraph();\n    },\n    isLink: function()\n    {\n        return this.getLink();\n    },\n    isFile: function()\n    {\n        return this.getFile();\n    },\n    isText: function()\n    {\n        return this.inspector.isText(this.el);\n    },\n    isInline: function()\n    {\n        var tags = this.opts.inlineTags;\n\n        return (this.isElement()) ? (tags.indexOf(this.node.tagName.toLowerCase()) !== -1) : false;\n    },\n    isBlock: function()\n    {\n        var tags = this.opts.blockTags;\n\n        return (this.isElement()) ? (tags.indexOf(this.node.tagName.toLowerCase()) !== -1) : false;\n    },\n    isElement: function()\n    {\n        return (this.node && this.node.nodeType && this.node.nodeType !== 3);\n    },\n\n    // has\n    hasParent: function(tags)\n    {\n        return (this.$el.closest(tags.join(',')).length !== 0);\n    },\n\n    // get\n    getNode: function()\n    {\n        return this.node;\n    },\n    getTag: function()\n    {\n        return (this.isElement()) ? this.node.tagName.toLowerCase() : false;\n    },\n    getComponent: function()\n    {\n        return (this.isComponent()) ? this.$component.get() : false;\n    },\n    getComponentType: function()\n    {\n        return (this.isComponent()) ? this.$component.attr('data-redactor-type') : false;\n    },\n    getFirstNode: function()\n    {\n        return this.utils.getFirstNode(this.node);\n    },\n    getLastNode: function()\n    {\n        return this.utils.getLastNode(this.node);\n    },\n    getFirstElement: function()\n    {\n        return this.utils.getFirstElement(this.node);\n    },\n    getLastElement: function()\n    {\n        return this.utils.getLastElement(this.node);\n    },\n    getFigcaption: function()\n    {\n        return this._getClosestNode('figcaption');\n    },\n    getPre: function()\n    {\n        return this._getClosestNode('pre');\n    },\n    getCode: function()\n    {\n        return this._getClosestNode('code');\n    },\n    getList: function()\n    {\n        return this._getClosestNode('ul, ol');\n    },\n    getParentList: function()\n    {\n        return this._getClosestUpNode('ul, ol');\n    },\n    getListItem: function()\n    {\n        return this._getClosestNode('li');\n    },\n    getTable: function()\n    {\n        if (this.getComponentType('table'))\n        {\n            return this.$component.find('table').get();\n        }\n        else\n        {\n            return this._getClosestNode('table');\n        }\n    },\n    getTableCell: function()\n    {\n        var $td = this.$el.closest('td, th');\n\n        return ($td.length !== 0) ? $td.get() : false;\n    },\n    getComponentCodeElement: function()\n    {\n        return (this.isComponentType('code')) ? this.$component.find('pre code, pre').last().get() : false;\n    },\n    getImageElement: function()\n    {\n        return (this.isComponentType('image')) ? this.$component.find('img').get() : false;\n    },\n    getParagraph: function()\n    {\n        return this._getClosestNode('p');\n    },\n    getHeading: function()\n    {\n        return this._getClosestNode('h1, h2, h3, h4, h5, h6');\n    },\n    getDl: function()\n    {\n        return this._getClosestNode('dl');\n    },\n    getBlockquote: function()\n    {\n        return this._getClosestNode('blockquote');\n    },\n    getLink: function()\n    {\n        var isComponent = (this.isComponent() && !this.isFigcaption());\n        var isTable = this.isComponentType('table');\n\n        if (isTable || !isComponent)\n        {\n            var $el = this._getClosestElement('a');\n\n            return ($el && !$el.attr('data-file')) ? $el.get() : false;\n        }\n\n        return false;\n    },\n    getFile: function()\n    {\n        var isComponent = this.isComponent();\n        var isTable = this.isComponentType('table');\n\n        if (isTable || !isComponent)\n        {\n            var $el = this._getClosestElement('a');\n\n            return ($el && $el.attr('data-file')) ? $el.get() : false;\n        }\n\n        return false;\n    },\n\n    // find\n    findFirstNode: function(selector)\n    {\n        return this.$el.find(selector).first().get();\n    },\n    findLastNode: function(selector)\n    {\n        return this.$el.find(selector).last().get();\n    },\n\n    // private\n    _getLastOrFirstListItem: function(type)\n    {\n        var list = this.getList();\n        var tag = this.getTag();\n        if (list && tag === 'li')\n        {\n            var item = $R.dom(list).find('li')[type]().get();\n            if (item && this.node === item)\n            {\n                return true;\n            }\n        }\n\n        return false;\n    },\n    _getLastOrFirstTableCell: function(type)\n    {\n        var table = this.getTable();\n        var tag = this.getTag();\n        if (table && (tag === 'td' || tag === 'th'))\n        {\n            var item = $R.dom(table).find('td, th')[type]().get();\n            if (item && this.node === item)\n            {\n                return true;\n            }\n        }\n\n        return false;\n    },\n    _getClosestUpNode: function(selector)\n    {\n        var $editor = this.editor.getElement();\n        var $el = this.$el.parents(selector, $editor).last();\n\n        return ($el.length !== 0) ? $el.get() : false;\n    },\n    _getClosestNode: function(selector)\n    {\n        var $editor = this.editor.getElement();\n        var $el = this.$el.closest(selector, $editor);\n\n        return ($el.length !== 0) ? $el.get() : false;\n    },\n    _getClosestElement: function(selector)\n    {\n        var $editor = this.editor.getElement();\n        var $el = this.$el.closest(selector, $editor);\n\n        return ($el.length !== 0) ? $el : false;\n    }\n});\n$R.add('service', 'marker', {\n    init: function(app)\n    {\n        this.app = app;\n    },\n    build: function(pos, html)\n    {\n        var marker = document.createElement('span');\n\n        marker.id = 'selection-marker-' + this._getPos(pos);\n        marker.className = 'redactor-selection-marker';\n        marker.innerHTML = this.opts.markerChar;\n\n        return (html) ? marker.outerHTML : marker;\n    },\n    buildHtml: function(pos)\n    {\n        return this.build(pos, true);\n    },\n    insert: function(side)\n    {\n        this.remove();\n\n        var atStart = (side !== 'both' && (side === 'start' || this.selection.isCollapsed()));\n\n        if (!this.selection.is()) this.editor.focus();\n\n        var range = this.selection.getRange();\n        if (range)\n        {\n            var start = this.build('start');\n            var end = this.build('end');\n\n            var cloned = range.cloneRange();\n\n            if (!atStart)\n            {\n                cloned.collapse(false);\n                cloned.insertNode(end);\n            }\n\n            cloned.setStart(range.startContainer, range.startOffset);\n            cloned.collapse(true);\n            cloned.insertNode(start);\n\n            range.setStartAfter(start);\n\n            if (!atStart)\n            {\n                range.setEndBefore(end);\n            }\n\n            this.selection.setRange(range);\n\n            return start;\n        }\n    },\n    find: function(pos, $context)\n    {\n        var $editor = this.editor.getElement();\n        var $marker = ($context || $editor).find('span#selection-marker-' + this._getPos(pos));\n\n        return ($marker.length !== 0) ? $marker.get() : false;\n    },\n    restore: function()\n    {\n        var start = this.find('start');\n        var end = this.find('end');\n\n        var range = this.selection.getRange();\n        if (!range || !this.selection.is())\n        {\n            this.editor.focus();\n            range = document.createRange();\n        }\n\n        if (start)\n        {\n            var prev = (end) ? end.previousSibling : false;\n            var next = start.nextSibling;\n            next = (next && next.nodeType === 3 && next.textContent.replace(/[\\n\\t]/g, '') === '') ? false : next;\n\n            if (!end)\n            {\n                if (next)\n                {\n                    range.selectNodeContents(next);\n                    range.collapse(true);\n                }\n                else\n                {\n                    this._restoreInject(range, start);\n                }\n            }\n            else if (next && next.id === 'selection-marker-end')\n            {\n                this._restoreInject(range, start);\n            }\n            else\n            {\n                if (prev && next)\n                {\n                    range.selectNodeContents(prev);\n                    range.collapse(false);\n                    range.setStart(next, 0);\n                }\n                else if (prev && !next)\n                {\n                    range.selectNodeContents(prev);\n                    range.collapse(false);\n                    range.setStartAfter(start);\n                }\n                else\n                {\n                    range.setStartAfter(start);\n                    range.setEndBefore(end);\n                }\n            }\n\n            this.selection.setRange(range);\n\n            if (start) start.parentNode.removeChild(start);\n            if (end) end.parentNode.removeChild(end);\n        }\n    },\n    remove: function()\n    {\n        var start = this.find('start');\n        var end = this.find('end');\n\n        if (start) start.parentNode.removeChild(start);\n        if (end) end.parentNode.removeChild(end);\n    },\n\n    // private\n    _getPos: function(pos)\n    {\n        return (pos === undefined) ? 'start' : pos;\n    },\n    _restoreInject: function(range, start)\n    {\n        var textNode = this.utils.createInvisibleChar();\n        $R.dom(start).after(textNode);\n\n        range.selectNodeContents(textNode);\n        range.collapse(false);\n    }\n});\n$R.add('service', 'component', {\n    init: function(app)\n    {\n        this.app = app;\n\n        // local\n        this.activeClass = 'redactor-component-active';\n    },\n    create: function(type, el)\n    {\n        return $R.create(type + '.component', this.app, el);\n    },\n    build: function(el)\n    {\n        var $el = $R.dom(el);\n        var component;\n        var type = $el.attr('data-redactor-type');\n        if (type)\n        {\n            component = this.create(type, el);\n        }\n\n        return (component) ? component : el;\n    },\n    remove: function(el, caret)\n    {\n        var $component = $R.dom(el).closest('.redactor-component');\n        var type = $component.attr('data-redactor-type');\n        var current = $component.parent();\n        var data = this.inspector.parse(current);\n        var prev = this.utils.findSiblings($component, 'prev');\n        var next = this.utils.findSiblings($component, 'next');\n        var stop = this.app.broadcast(type + '.delete', $component);\n        if (stop !== false)\n        {\n            $component.remove();\n\n            // callback\n            this.app.broadcast(type + '.deleted', $component);\n            this.app.broadcast('contextbar.close');\n            this.app.broadcast('imageresizer.stop');\n\n            if (caret !== false)\n            {\n                var cell = data.getTableCell();\n                if (cell && this.utils.isEmptyHtml(cell.innerHTML))\n                {\n                    this.caret.setStart(cell);\n                }\n                else if (next) this.caret.setStart(next);\n                else if (prev) this.caret.setEnd(prev);\n                else\n                {\n                    this.editor.startFocus();\n                }\n            }\n\n            // is empty\n            if (this.editor.isEmpty())\n            {\n                this.editor.setEmpty();\n                this.editor.startFocus();\n                this.app.broadcast('empty');\n            }\n        }\n    },\n    isNonEditable: function(el)\n    {\n        var data = this.inspector.parse(el);\n        return (data.isComponent() && !data.isComponentEditable());\n    },\n    isActive: function(el)\n    {\n        var $component;\n        if (el)\n        {\n            var data = this.inspector.parse(el);\n            $component = $R.dom(data.getComponent());\n\n            return $component.hasClass(this.activeClass);\n        }\n        else\n        {\n            $component = this._find();\n\n            return ($component.length !== 0);\n        }\n    },\n    getActive: function(dom)\n    {\n        var $component = this._find();\n\n        return ($component.length !== 0) ? ((dom) ? $component : $component.get()) : false;\n    },\n    setActive: function(el)\n    {\n        this.clearActive();\n        this.editor.focus();\n\n        var data = this.inspector.parse(el);\n        var component = data.getComponent();\n        var $component = $R.dom(component);\n\n        if (!data.isFigcaption())\n        {\n            var $caret = $component.find('.redactor-component-caret');\n            if ($caret.length === 0)\n            {\n                $caret = this._buildCaret();\n                $component.prepend($caret);\n            }\n\n            this.caret.setAtStart($caret.get());\n        }\n\n        $component.addClass(this.activeClass);\n    },\n    clearActive: function()\n    {\n        var $component = this._find();\n\n        $component.removeClass(this.activeClass);\n        $component.find('.redactor-component-caret').remove();\n\n        this.app.broadcast('imageresizer.stop');\n    },\n    setOnEvent: function(e, contextmenu)\n    {\n        this.clearActive();\n\n        var data = this.inspector.parse(e.target);\n        if (data.isFigcaption() || data.isComponentEditable())\n        {\n            return;\n        }\n\n        // component\n        if (data.isComponent())\n        {\n            this.setActive(e.target);\n            if (contextmenu !== true) e.preventDefault();\n        }\n    },\n    executeScripts: function(scripts)\n    {\n        if (scripts === undefined)\n        {\n            var $editor = this.editor.getElement();\n            var scripts = $editor.find('[data-redactor-type]').find(\"script\").getAll();\n            this.executeScripts.call(this, scripts);\n        }\n        else\n        {\n            for (var i = 0; i < scripts.length; i++)\n            {\n                if (scripts[i].src !== '')\n                {\n                    var src = scripts[i].src;\n                    this.$doc.find('head script[src=\"' + src + '\"]').remove();\n\n                    var $script = $R.dom('<script>');\n                    $script.attr('src', src);\n                    $script.attr('async defer');\n                    $script.get().onload = function()\n                    {\n                        if (src.search('instagram') !== -1) window.instgrm.Embeds.process();\n                        this.executeScripts(scripts.slice(i + 1));\n                    }.bind(this);\n\n                    var head = document.getElementsByTagName('head')[0];\n                    if (head) head.appendChild($script.get());\n\n                    break;\n                }\n            }\n        }\n    },\n\n    // private\n    _find: function()\n    {\n        return this.editor.getElement().find('.' + this.activeClass);\n    },\n    _buildCaret: function()\n    {\n        var $caret = $R.dom('<span>');\n        $caret.addClass('redactor-component-caret');\n        $caret.attr('contenteditable', true);\n\n        return $caret;\n    }\n});\n$R.add('service', 'insertion', {\n    init: function(app)\n    {\n        this.app = app;\n    },\n    set: function(html, clean, focus)\n    {\n        if (html === null) {\n            html = '';\n        }\n\n        html = (clean !== false) ? this.cleaner.input(html) : html;\n        html = (clean !== false) ? this.cleaner.paragraphize(html) : html;\n\n        // set html\n        var $editor = this.editor.getElement();\n        $editor.html(html);\n\n        // set focus at the end\n        if (focus !== false) this.editor.endFocus();\n\n        return html;\n    },\n    insertNode: function(node, caret)\n    {\n        this.editor.focus();\n        var fragment = (this.utils.isFragment(node)) ? node : this.utils.createFragment(node);\n\n        this._collapseSelection();\n        this._insertFragment(fragment);\n        this._setCaret(caret, fragment);\n\n        return this._sendNodes(fragment.nodes);\n    },\n    insertBreakLine: function()\n    {\n        return this.insertNode(document.createElement('br'), 'after');\n    },\n    insertNewline: function()\n    {\n        return this.insertNode(document.createTextNode('\\n'), 'after');\n    },\n    insertText: function(text)\n    {\n        return this.insertHtml(this.cleaner.getFlatText(text));\n    },\n    insertChar: function(charhtml)\n    {\n        return this.insertNode(charhtml, 'after');\n    },\n    insertRaw: function(html)\n    {\n        return this.insertHtml(html, false);\n    },\n    insertToEnd: function(lastNode, type)\n    {\n        if (!lastNode) return;\n        if (lastNode.nodeType === 3 && lastNode.nodeValue.search(/^\\n/) !== -1)\n        {\n            lastNode = lastNode.previousElementSibling;\n        }\n\n        var $lastNode = $R.dom(lastNode);\n        if ($lastNode.attr('data-redactor-type') === type)\n        {\n            var tag = (this.opts.breakline) ? '<br>' : '<p>';\n            var $newNode = $R.dom(tag);\n\n            $lastNode.after($newNode);\n            this.caret.setStart($newNode);\n        }\n    },\n    insertPoint: function(e)\n    {\n        var range, data;\n        var marker = this.marker.build('start');\n        var markerInserted = false;\n        var x = e.clientX, y = e.clientY;\n\n        if (document.caretPositionFromPoint)\n        {\n            var pos = document.caretPositionFromPoint(x, y);\n            var sel = document.getSelection();\n\n            data = this.inspector.parse(pos.offsetNode);\n            if (data.isInEditor())\n            {\n                range = sel.getRangeAt(0);\n                range.setStart(pos.offsetNode, pos.offset);\n                range.collapse(true);\n                range.insertNode(marker);\n                markerInserted = true;\n            }\n        }\n        else if (document.caretRangeFromPoint)\n        {\n            range = document.caretRangeFromPoint(x, y);\n\n            data = this.inspector.parse(range.startContainer);\n            if (data.isInEditor())\n            {\n                range.insertNode(marker);\n                markerInserted = true;\n            }\n        }\n\n        return markerInserted;\n    },\n    insertToPoint: function(e, html, point, clean)\n    {\n        var pointInserted = (point === true) ? true : this.insertPoint(e);\n        if (!pointInserted)\n        {\n            var lastNode = this.editor.getLastNode();\n            $R.dom(lastNode).after(this.marker.build('start'));\n        }\n\n        this.component.clearActive();\n        this.selection.restoreMarkers();\n\n        return this.insertHtml(html, clean);\n    },\n    insertToOffset: function(start, html)\n    {\n        this.offset.set({ start: start, end: start });\n\n        return this.insertHtml(html);\n    },\n    insertHtml: function(html, clean)\n    {\n        if (!this.opts.input) return;\n\n        // parse\n        var parsedInput = this.utils.parseHtml(html);\n\n        // all selection\n        if (this.selection.isAll())\n        {\n            return this._insertToAllSelected(parsedInput);\n        }\n\n        // there is no selection\n        if (!this.selection.is())\n        {\n            var $el = $R.dom('<p>');\n            var $editor = this.editor.getElement();\n\n            $editor.append($el);\n            this.caret.setStart($el);\n        }\n\n        // environment\n        var isCollapsed = this.selection.isCollapsed();\n        var isText = this.selection.isText();\n        var current = this.selection.getCurrent();\n        var block = this.selection.getBlock();\n        var dataCurrent = this.inspector.parse(current);\n\n        // collapse air\n        this._collapseSelection();\n\n        // clean\n        parsedInput = this._getCleanedInput(parsedInput, dataCurrent, clean);\n\n        // input is figure or component span\n        var isFigure = this._isFigure(parsedInput.html);\n        var isComponentSpan = this._isComponentSpan(parsedInput.html);\n        var isInsertedText = this.inspector.isText(parsedInput.html);\n        var fragment, except;\n\n        // multiple selection\n        //var blocks = this.selection.getBlocks();\n        //if (blocks && blocks.length > 1) {\n        //    parsedInput.html = (clean !== false) ? this.cleaner.paragraphize(parsedInput.html) : parsedInput.html;\n        //}\n\n        // empty editor\n        if (this.editor.isEmpty())\n        {\n            return this._insertToEmptyEditor(parsedInput.html);\n        }\n        // to component\n        else if (dataCurrent.isComponent() && !dataCurrent.isComponentEditable())\n        {\n            return this._insertToWidget(current, dataCurrent, parsedInput.html);\n        }\n        // component span\n        else if (isComponentSpan)\n        {\n            return this.insertNode(parsedInput.nodes, 'end');\n        }\n        // inserting figure & split node\n        else if (isFigure && !isText && !dataCurrent.isList())\n        {\n            if (dataCurrent.isInline())\n            {\n                return this._insertToInline(current, parsedInput);\n            }\n\n            fragment = this.utils.createFragment(parsedInput.html);\n            this.utils.splitNode(current, fragment);\n            this.caret.setEnd(fragment.last);\n\n            return this._sendNodes(fragment.nodes);\n        }\n        // to code\n        else if (dataCurrent.isCode())\n        {\n            return this._insertToCode(parsedInput, current, clean);\n        }\n        // to pre\n        else if (dataCurrent.isPre())\n        {\n            return this._insertToPre(parsedInput, clean);\n        }\n        // to h1-h6 & figcaption\n        else if (dataCurrent.isHeading() || dataCurrent.isFigcaption())\n        {\n            parsedInput.html = (clean !== false) ? this.cleaner.removeTagsExcept(parsedInput.html, ['a']) : parsedInput.html;\n            parsedInput.html = (clean !== false) ? this.cleaner.replaceNbspToSpaces(parsedInput.html) : parsedInput.html;\n\n            fragment = this.utils.createFragment(parsedInput.html);\n\n            return this.insertNode(fragment, 'end');\n        }\n        // breakline div\n        else if (this.opts.breakline && block && block.tagName === 'DIV') {\n\n            if (this._isPlainHtml(parsedInput.html)) {\n                return this.insertNode(parsedInput.nodes, 'end');\n            }\n\n            parsedInput.html = (clean !== false) ? this.cleaner.paragraphize(parsedInput.html) : parsedInput.html;\n\n\n            fragment = this.utils.createFragment(parsedInput.html);\n\n            var range = this.selection.getRange();\n            if (range && !this.selection.isCollapsed()) {\n                range.deleteContents();\n            }\n\n            this.utils.splitNode(current, fragment);\n            this.caret.setEnd(fragment.last);\n\n            return this._sendNodes(fragment.nodes);\n        }\n        // text inserting\n        else if (isInsertedText)\n        {\n            if (!isText && this.opts.markup !== 'br' && this._hasBlocksAndImages(parsedInput.nodes))\n            {\n                parsedInput.html = (clean !== false) ? this.cleaner.paragraphize(parsedInput.html) : parsedInput.html;\n\n                fragment = this.utils.createFragment(parsedInput.html);\n\n                this.utils.splitNode(current, fragment);\n                this.caret.setEnd(fragment.last);\n                return this._sendNodes(fragment.nodes);\n            }\n\n            parsedInput.html = (clean !== false) ? parsedInput.html.replace(/\\n/g, '<br>') : parsedInput.html;\n\n            fragment = this.utils.createFragment(parsedInput.html);\n\n            return this.insertNode(fragment.nodes, 'end');\n        }\n        // uncollapsed\n        else if (!isCollapsed && !isFigure)\n        {\n            if (this._isPlainHtml(parsedInput.html))\n            {\n                return this.insertNode(parsedInput.nodes, 'end');\n            }\n\n            parsedInput.html = (clean !== false) ? this.cleaner.paragraphize(parsedInput.html) : parsedInput.html;\n            fragment = this.utils.createFragment(parsedInput.html);\n\n            return this.insertNode(fragment, 'end');\n        }\n        // to inline tag\n        else if (dataCurrent.isInline() && !this._isPlainHtml(parsedInput.html))\n        {\n            return this._insertToInline(current, parsedInput);\n        }\n        // to blockquote or dt, dd\n        else if (dataCurrent.isBlockquote() || dataCurrent.isDl())\n        {\n            except = this.opts.inlineTags;\n            except.concat(['br']);\n\n            parsedInput.html = (clean !== false) ? this.cleaner.replaceBlocksToBr(parsedInput.html) : parsedInput.html;\n            parsedInput.html = (clean !== false) ? this.cleaner.removeTagsExcept(parsedInput.html, except) : parsedInput.html;\n\n            fragment = this.utils.createFragment(parsedInput.html);\n\n            return this.insertNode(fragment, 'end');\n        }\n        // to p\n        else if (dataCurrent.isParagraph())\n        {\n            if (this._isPlainHtml(parsedInput.html))\n            {\n                return this.insertNode(parsedInput.nodes, 'end');\n            }\n\n            parsedInput.html = (clean !== false) ? this.cleaner.paragraphize(parsedInput.html) : parsedInput.html;\n\n            fragment = this.utils.createFragment(parsedInput.html);\n\n            this.utils.splitNode(current, fragment);\n            this.caret.setEnd(fragment.last);\n\n            return this._sendNodes(fragment.nodes);\n        }\n        // to li\n        else if (dataCurrent.isList())\n        {\n            except = this.opts.inlineTags;\n            except = except.concat(['br', 'li', 'ul', 'ol', 'img']);\n\n            parsedInput.html = (clean !== false) ? this.cleaner.replaceBlocksToBr(parsedInput.html) : parsedInput.html;\n            parsedInput.html = (clean !== false) ? this.cleaner.removeTagsExcept(parsedInput.html, except) : parsedInput.html;\n            parsedInput.html = (clean !== false) ? this.cleaner.removeBrAtEnd(parsedInput.html) : parsedInput.html;\n\n            fragment = this.utils.createFragment(parsedInput.html);\n            parsedInput.nodes = fragment.nodes;\n\n            if (this._containsTags(parsedInput.html, ['ul', 'ol', 'li']))\n            {\n                var element = this.selection.getElement(current);\n                if (element && element.tagName === 'LI' && this.caret.isStart(element))\n                {\n                    parsedInput.nodes = $R.dom(fragment.nodes).unwrap('ul, ol').getAll();\n                    $R.dom(element).before(parsedInput.nodes);\n\n                    var lastNode = parsedInput.nodes[parsedInput.nodes.length-1];\n                    this.caret.setEnd(lastNode);\n\n                    return this._sendNodes(parsedInput.nodes);\n                }\n                else if (this._isPlainHtml(parsedInput.html))\n                {\n                    return this.insertNode(fragment, 'end');\n                }\n                else\n                {\n                    fragment = this._buildList(parsedInput, element, fragment);\n\n                    this.utils.splitNode(current, fragment, true);\n                    this.caret.setEnd(fragment.last);\n\n                    return this._sendNodes(fragment.nodes);\n                }\n            }\n        }\n\n        // other cases\n        return this.insertNode(parsedInput.nodes, 'end');\n    },\n\n    // private\n    _insertToAllSelected: function(parsedInput)\n    {\n        var insertedHtml = this.set(parsedInput.html);\n        var dataInserted = this.utils.parseHtml(insertedHtml);\n\n        return this._sendNodes(dataInserted.nodes);\n    },\n    _insertToEmptyEditor: function(html)\n    {\n        html = this.cleaner.paragraphize(html);\n\n        var fragment = this.utils.createFragment(html);\n        var $editor = this.editor.getElement();\n\n        $editor.html('');\n        $editor.append(fragment.frag);\n\n        this.caret.setEnd(fragment.last);\n\n        return this._sendNodes(fragment.nodes);\n    },\n    _insertToInline: function(current, parsedInput)\n    {\n        var fragment = this.utils.createFragment(parsedInput.html);\n        this.utils.splitNode(current, fragment, false, true);\n        this.caret.setEnd(fragment.last);\n\n        return this._sendNodes(fragment.nodes);\n    },\n    _insertToCode: function(parsedInput, current, clean)\n    {\n        parsedInput.html = (clean !== false) ? this.cleaner.encodeHtml(parsedInput.html) : parsedInput.html;\n        parsedInput.html = (clean !== false) ? this.cleaner.removeNl(parsedInput.html) : parsedInput.html;\n\n        var fragment = this.utils.createFragment(parsedInput.html);\n        var nodes = this.insertNode(fragment, 'end');\n\n        this.utils.normalizeTextNodes(current);\n\n        return nodes;\n    },\n    _insertToPre: function(parsedInput, clean)\n    {\n        parsedInput.html = (clean !== false) ? this.cleaner.encodeHtml(parsedInput.html) : parsedInput.html;\n\n        var fragment = this.utils.createFragment(parsedInput.html);\n\n        return this.insertNode(fragment, 'end');\n    },\n    _insertToWidget: function(current, dataCurrent, html)\n    {\n        html = (this._isComponentSpan(html)) ? html : this.cleaner.paragraphize(html);\n\n        var fragment = this.utils.createFragment(html);\n        var component = dataCurrent.getComponent();\n        var $component = $R.dom(component);\n\n        $component.after(fragment.frag);\n        $component.remove();\n\n        this.caret.setEnd(fragment.last);\n\n        return this._sendNodes(fragment.nodes);\n    },\n    _insertFragment: function(fragment)\n    {\n        var range = this.selection.getRange();\n        if (range)\n        {\n            if (this.selection.isCollapsed())\n            {\n                var startNode = range.startContainer;\n                if (startNode.nodeType !== 3 && startNode.tagName === 'BR')\n                {\n                    this.caret.setAfter(startNode);\n                    startNode.parentNode.removeChild(startNode);\n                }\n            }\n            else\n            {\n                range.deleteContents();\n            }\n\n            range.insertNode(fragment.frag);\n        }\n    },\n    _sendNodes: function(nodes)\n    {\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var el = nodes[i];\n            var type = (el.nodeType !== 3 && typeof el.getAttribute === 'function') ? el.getAttribute('data-redactor-type') : false;\n            if (type)\n            {\n                this.app.broadcast(type + '.inserted', this.component.build(el));\n            }\n        }\n\n        if (this.detector.isIe())\n        {\n            this.editor.getElement().find('[data-redactor-type=table]').attr('contenteditable', true);\n        }\n\n        // callback\n        this.app.broadcast('inserted', nodes);\n\n        // widget's scripts\n        this.component.executeScripts();\n\n        return nodes;\n    },\n    _setCaret: function(caret, fragment)\n    {\n        var isLastInline = this._isLastInline(fragment);\n\n        if (caret)\n        {\n            caret = (isLastInline && caret === 'end') ? 'after' : caret;\n            this.caret['set' + this.utils.ucfirst(caret)](fragment.last);\n        }\n        else if (caret !== false)\n        {\n            if (isLastInline) this.caret.setAfter(fragment.last);\n        }\n    },\n    _isLastInline: function(fragment)\n    {\n        if (fragment.last)\n        {\n            var data = this.inspector.parse(fragment.last);\n\n            return data.isInline();\n        }\n\n        return false;\n    },\n    _getCleanedInput: function(parsedInput, dataCurrent, clean)\n    {\n        var isPreformatted = (dataCurrent.isCode() || dataCurrent.isPre());\n\n        parsedInput.html = parsedInput.html.replace(/&nbsp;/g, ' ');\n        parsedInput.html = (!isPreformatted && clean !== false) ? this.cleaner.input(parsedInput.html) : parsedInput.html;\n        parsedInput = (!isPreformatted && clean !== false) ? this.utils.parseHtml(parsedInput.html) : parsedInput;\n\n        return parsedInput;\n    },\n    _getContainer: function(nodes)\n    {\n        return $R.dom(this.utils.createTmpContainer(nodes));\n    },\n    _buildList: function(parsedInput, list, fragment)\n    {\n        var nodes = parsedInput.nodes;\n        var first = nodes[0];\n\n        if (first && first.nodeType !== 3 && first.tagName === 'li')\n        {\n            var $parent = $R.dom(list);\n            var parentListTag = $parent.get().tagName.toLowerCase();\n            var $list = $R.dom('<' + parentListTag + ' />');\n            $list.append(fragment.nodes);\n\n            return this.utils.createFragment($list.get().outerHTML);\n        }\n\n        return fragment;\n    },\n    _containsTags: function(html, tags)\n    {\n        return (this._getContainer(html).find(tags.join(',')).length !== 0);\n    },\n    _collapseSelection: function()\n    {\n        //if (this.app.isAirToolbar()) this.selection.collapseToEnd();\n    },\n    _hasFigureOrTable: function(nodes)\n    {\n        return (this._getContainer(nodes).find('figure, table').length !== 0);\n    },\n    _hasBlocks: function(nodes)\n    {\n        return (this._getContainer(nodes).find(this.opts.blockTags.join(',')).length !== 0);\n    },\n    _hasBlocksAndImages: function(nodes)\n    {\n        return (this._getContainer(nodes).find(this.opts.blockTags.join(',') + ',img').length !== 0);\n    },\n    _isPlainHtml: function(html)\n    {\n        return (this._getContainer(html).find(this.opts.blockTags.join(',') + ', img').length === 0);\n    },\n    _isFigure: function(html)\n    {\n        if (this._isHtmlString(html))\n        {\n            return ($R.dom(html).closest('figure').length !== 0);\n        }\n    },\n    _isComponentSpan: function(html)\n    {\n        if (this._isHtmlString(html))\n        {\n            return ($R.dom(html).closest('span.redactor-component').length !== 0);\n        }\n    },\n    _isHtmlString: function(html)\n    {\n        return !(typeof html === 'string' && !/^\\s*<(\\w+|!)[^>]*>/.test(html));\n    }\n});\n$R.add('service', 'block', {\n    init: function(app) {\n        this.app = app;\n        this.tags = ['p', 'div', 'blockquote', 'pre', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6'];\n    },\n    // format\n    format: function(args) {\n\n        // params\n        this.params = {\n            args: false\n        };\n\n        // type of applying styles and attributes\n        this.params.type = (args.type) ? args.type : 'set'; // add, remove, toggle\n\n        // tag\n        this.params.tag = (typeof args === 'string') ? args : (args.tag || this.opts.markup);\n        this.params.tag = this.params.tag.toLowerCase();\n\n        // args\n        this.params.args = {\n            'class': args['class'] || false,\n            'style': args['style'] || false,\n            'attr': args['attr'] || false\n        };\n\n        if (!args['class'] && !args['style'] && !args['attr']) {\n            this.params.args = false;\n        }\n\n        // format\n        return this._format();\n    },\n\n    // funcs\n    add: function(args, tags, el) {\n        return this._apply('add', args, tags, true, el);\n    },\n    set: function(args, tags) {\n        return this._apply('set', args, tags);\n    },\n    toggle: function(args, tags) {\n        return this._apply('toggle', args, tags);\n    },\n    remove: function(args, tags) {\n        return this._apply('remove', args, tags);\n    },\n\n    // clear\n    clearFormat: function(tags) {\n        return this._clear(tags, 'all');\n    },\n    clearStyle: function(tags) {\n        return this._clear(tags, 'style');\n    },\n    clearClass: function(tags) {\n        return this._clear(tags, 'class');\n    },\n    clearAttr: function(tags) {\n        return this._clear(tags, 'attr');\n    },\n\n    // format\n    _format: function() {\n\n        var nodes = [];\n\n        // collapsed\n        this.collapsed = this.selection.isCollapsed();\n\n        // save selection\n        this.selection.save();\n\n        // blocks\n        var block = this.selection.getBlock();\n        var blocks = this._getBlocks();\n        var type = (this._isToggleFormatType(blocks)) ? 'toggle' : 'set';\n        var replacedTag = this._getReplacedTag(type);\n\n        nodes = this._replaceBlocks(blocks, replacedTag);\n\n        // apply args & clean\n        nodes = this._buildNodes(nodes);\n\n        // restore selection\n        this._restoreSelection(nodes);\n\n        return nodes;\n    },\n\n\n    // clear\n    _clear: function(tags, type, selection, nodes) {\n        // save selection\n        if (selection !== false) {\n\t\t    this.selection.save();\n\t\t}\n\n        // get elements\n        var $elements = this._getElements(tags, nodes);\n\n        // remove all format\n        if (type === 'all') {\n            this._removeAllAttr($elements, false);\n        }\n        // remove style\n        else if (type === 'style') {\n            $elements.removeAttr('style');\n            $elements.removeAttr('data-redactor-style-cache');\n        }\n        // remove class\n        else if (type === 'class') {\n            $elements.removeAttr('class');\n        }\n        // remove attrs\n        else if (type === 'attr') {\n            this._removeAllAttr($elements);\n        }\n\n        // get nodes\n        nodes = $elements.getAll();\n\n        // restore selection\n        if (selection !== false) {\n            this._restoreSelection(nodes);\n        }\n\n        return nodes;\n    },\n\n    // get\n    _getElements: function(tags, nodes) {\n        return (nodes) ? $R.dom(nodes) : $R.dom(this._getBlocks(tags));\n    },\n    _getBlocks: function(tags) {\n        var blocks = this.selection.getBlocks({ tags: tags || this.tags });\n        var finalBlocks = [];\n        for (var i = 0; i < blocks.length; i++) {\n            if (blocks[i].tagName === 'DIV' && !blocks[i].getAttribute('data-redactor-tag')) {\n                continue;\n            }\n            else {\n                finalBlocks.push(blocks[i]);\n            }\n        }\n\n        return finalBlocks;\n    },\n\n    _getReplacedTag: function(type) {\n        if (this.opts.breakline) {\n            return (type === 'toggle') ? 'div' : (this.params.tag === 'p') ? 'div' : this.params.tag;\n        }\n        else {\n            return (type === 'toggle') ? this.opts.markup : this.params.tag;\n        }\n    },\n\n    // is\n    _isStandardParagraph: function() {\n        return (!this.opts.breakline && this.opts.markup === 'p');\n    },\n    _isStandardDiv: function() {\n        return (!this.opts.breakline && this.opts.markup === 'div');\n    },\n    _isBreaklineBlock: function(block) {\n        return (block && block.tagName === 'DIV' && block.getAttribute('data-redactor-tag') === 'br');\n    },\n    _isToggleFormatType: function(blocks) {\n        var count = 0;\n        var len = blocks.length;\n        for (var i = 0; i < len; i++) {\n            if (blocks[i] && this.params.tag === blocks[i].tagName.toLowerCase()) count++;\n        }\n\n        return (count === len);\n    },\n    _isCurrentBlockOneAndEmpty: function(nodes) {\n        return (this.collapsed && nodes.length === 1 && this.utils.isEmpty(nodes[0]));\n    },\n\n    // build\n    _buildNodes: function(nodes) {\n        if (nodes.length > 0) {\n            // clean & appliyng styles and attributes\n            nodes = this._applyArgs(nodes, false);\n            nodes = this._combinePre(nodes);\n            nodes = this._cleanBlocks(nodes);\n        }\n\n        return nodes;\n    },\n\n    // replace\n    _replaceBlocks: function(blocks, replacedTag) {\n        var nodes = [];\n\n        for (var i = 0; i < blocks.length; i++) {\n            var $node = this.utils.replaceToTag(blocks[i], replacedTag);\n            nodes.push($node.get());\n        }\n\n        return nodes;\n    },\n\n    // combine\n    _combinePre: function(nodes) {\n        var combinedNodes = [];\n        for (var i = 0; i < nodes.length; i++) {\n            var next = nodes[i].nextElementSibling;\n            if (next && nodes[i].tagName === 'PRE' && next.tagName === 'PRE') {\n                var $current = $R.dom(nodes[i]);\n                var $next = $R.dom(next);\n                var newline = document.createTextNode('\\n');\n\n                $current.append(newline);\n                $current.append($next);\n                $next.unwrap('pre');\n            }\n\n            combinedNodes.push(nodes[i]);\n        }\n\n        return combinedNodes;\n    },\n\n    // clean\n    _cleanBlocks: function(nodes) {\n        var headings = ['h1', 'h2', 'h3', 'h4', 'h5', 'h6'];\n        var tags = this.opts.inlineTags;\n        for (var i = 0; i < nodes.length; i++) {\n            var tag = nodes[i].tagName.toLowerCase();\n            var $node = $R.dom(nodes[i]);\n\n            // remove all spans in headings\n            if (headings.indexOf(tag) !== - 1) {\n                $node.find('span').not('.redactor-component, .non-editable, .redactor-selection-marker').unwrap();\n            }\n            // remove all inlines in pre\n            else if (tag === 'pre') {\n                $node.find(tags.join(',')).not('.redactor-selection-marker').unwrap();\n            }\n\n\n            if (this.params.args === false && this.params.tag === 'p') {\n                $node.removeAttr('class');\n            }\n\n            // breakline attr\n            if (this.opts.breakline && tag === 'div') {\n                $node.attr('data-redactor-tag', 'br');\n            }\n            else {\n                $node.removeAttr('data-redactor-tag');\n            }\n\n            // normalize\n            this.utils.normalizeTextNodes(nodes[i]);\n        }\n\n        return nodes;\n    },\n    _cleanEmptyClass: function($elements) {\n        $elements.each(function(node) {\n            if (node.className === '') node.removeAttribute('class');\n        });\n    },\n    _cleanEmptyStyle: function($node) {\n         if (this.utils.removeEmptyAttr($node.get(), 'style')) {\n            $node.removeAttr('data-redactor-style-cache');\n        }\n        else {\n            $node.attr('data-redactor-style-cache', $node.attr('style'));\n        }\n    },\n\n    // apply\n    _apply: function(type, args, tags, selection, nodes) {\n        // save selection\n        if (selection !== false) {\n\t\t    this.selection.save();\n\t\t}\n\n        // get elements\n        var $elements = this._getElements(tags, nodes);\n\n        // class\n        if (args['class']) {\n            if (type === 'set') {\n                $elements.removeAttr('class');\n                $elements.addClass(args['class']);\n            }\n            else if (type === 'add') {\n                $elements.addClass(args['class']);\n            }\n            else if (type === 'toggle') {\n                $elements.toggleClass(args['class']);\n            }\n            else if (type === 'remove') {\n                $elements.removeClass(args['class']);\n            }\n\n            this._cleanEmptyClass($elements);\n        }\n\n        // attr\n        if (args['attr']) {\n            if (type === 'set') {\n                this._removeAllAttr($elements);\n                $elements.attr(args['attr']);\n            }\n            else if (type === 'add') {\n                $elements.attr(args['attr']);\n            }\n            else if (type === 'toggle') {\n                params = args['attr'];\n                $elements.each(function(node) {\n                    var $node = $R.dom(node);\n                    for (var key in params) {\n                        if ($node.attr(key)) $node.removeAttr(key);\n                        else $node.attr(key, params[key]);\n                    }\n                });\n            }\n            else if (type === 'remove') {\n                $elements.removeAttr(args['attr']);\n            }\n        }\n\n        // style\n        if (args['style']) {\n            if (type === 'set') {\n                $elements.removeAttr('style');\n                $elements.css(args['style']);\n                $elements.each(function(node) {\n                    var $node = $R.dom(node);\n                    $node.attr('data-redactor-style-cache', $node.attr('style'));\n                });\n            }\n            else if (type === 'add') {\n                var params = args['style'];\n                $elements.each(function(node) {\n                    var $node = $R.dom(node);\n                    $node.css(params);\n                    $node.attr('data-redactor-style-cache', $node.attr('style'));\n                    this._convertStyleQuotes($node);\n                }.bind(this));\n            }\n            else if (type === 'toggle') {\n                var params = args['style'];\n                $elements.each(function(node) {\n                    var $node = $R.dom(node);\n                    for (var key in params) {\n                        var newVal = params[key];\n                        var oldVal = $node.css(key);\n\n                        oldVal = (this.utils.isRgb(oldVal)) ? this.utils.rgb2hex(oldVal) : oldVal.replace(/\"/g, '');\n                        newVal = (this.utils.isRgb(newVal)) ? this.utils.rgb2hex(newVal) : newVal.replace(/\"/g, '');\n\n                        oldVal = this.utils.hex2long(oldVal);\n                        newVal = this.utils.hex2long(newVal);\n\n                        var compareNew = (typeof newVal === 'string') ? newVal.toLowerCase() : newVal;\n                        var compareOld = (typeof oldVal === 'string') ? oldVal.toLowerCase() : oldVal;\n\n                        if (compareNew === compareOld) $node.css(key, '');\n                        else $node.css(key, newVal);\n                    }\n\n                    this._convertStyleQuotes($node);\n                    this._cleanEmptyStyle($node);\n                }.bind(this));\n            }\n            else if (type === 'remove') {\n                var name = args['style'];\n                $elements.each(function(node) {\n                    var $node = $R.dom(node);\n                    $node.css(name, '');\n                    this._cleanEmptyStyle($node);\n                }.bind(this));\n            }\n        }\n\n        // get nodes\n        nodes = $elements.getAll();\n\n        // restore selection\n        if (selection !== false) {\n            this._restoreSelection(nodes);\n        }\n\n        return nodes;\n    },\n    _applyArgs: function(nodes) {\n        if (this.params.args) {\n            nodes = this._apply(this.params.type, this.params.args, false, false, nodes);\n        }\n        else {\n            nodes = this._clear(false, 'all', false, nodes);\n        }\n\n        return nodes;\n    },\n\n    // remove\n    _removeAllAttr: function($elements, keepStyleAndClass) {\n        $elements.each(function(node) {\n            var keepAttrs = ['data-redactor-tag', 'data-redactor-style-cache'];\n            if (keepStyleAndClass === false) {\n                keepAttrs.push('style');\n                keepAttrs.push('class');\n            }\n\n            for (var i = node.attributes.length; i--> 0;) {\n                var nodeAttr = node.attributes[i];\n                var name = nodeAttr.name;\n                if (keepAttrs.indexOf(name) === -1) {\n                    node.removeAttributeNode(nodeAttr);\n                }\n            }\n        });\n    },\n\n    // selection\n    _restoreSelection: function(nodes) {\n        if (this._isCurrentBlockOneAndEmpty(nodes)) {\n            this.caret.setStart(nodes[0]);\n        }\n        else {\n            setTimeout(function() { this.selection.restore(); }.bind(this), 1);\n        }\n    },\n\n    // convert\n    _convertStyleQuotes: function($node) {\n        var style = $node.attr('style');\n        if (style) $node.attr('style', style.replace(/\"/g, '\\''));\n    }\n});\n$R.add('service', 'inline', {\n    mixins: ['formatter'],\n    init: function(app)\n    {\n        this.app = app;\n\n        this.count = 0;\n    },\n    // public\n    format: function(args)\n    {\n        if (!this._isFormat()) return [];\n\n        // type of applying styles and attributes\n        this.type = (args.type) ? args.type : 'set'; // add, remove, toggle\n        // tag\n        this.tag = (typeof args === 'string') ? args : args.tag;\n        this.tag = this.tag.toLowerCase();\n        this.tag = this.arrangeTag(this.tag);\n\n        if (typeof args === 'string') this.args = false;\n        else this.buildArgs(args);\n\n        if (!this.detector.isIe())\n        {\n            this.editor.disableNonEditables();\n        }\n\n        // format\n        var nodes = (this.selection.isCollapsed()) ? this.formatCollapsed() : this.formatUncollapsed();\n\n        if (!this.detector.isIe())\n        {\n            this.editor.enableNonEditables();\n        }\n\n        return nodes;\n    },\n\n    // private\n    _isFormat: function()\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var isComponent = (data.isComponent() && !data.isComponentType('table') && !data.isFigcaption());\n\n        if (current === false && this.selection.isAll())\n        {\n            return true;\n        }\n        else if (!current || data.isPre() || data.isCode() || isComponent)\n        {\n            return false;\n        }\n\n        return true;\n    },\n    arrangeTag: function(tag)\n    {\n        var replaced = this.opts.replaceTags;\n        for (var key in replaced)\n        {\n            if (tag === key) tag = replaced[key];\n        }\n\n        return tag;\n    },\n    formatCollapsed: function()\n    {\n        var nodes = [];\n        var inline = this.selection.getInlineFirst();\n        var inlines = this.selection.getInlines({ all: true });\n        var $inline = $R.dom(inline);\n        var $parent, parent, $secondPart, extractedContent;\n\n        // 1) not inline\n        if (!inline)\n        {\n            nodes = this.insertInline(nodes);\n        }\n        else\n        {\n            var dataInline = this.inspector.parse(inline);\n            var isEmpty = this.utils.isEmptyHtml(inline.innerHTML);\n\n            // 2) inline is empty\n            if (isEmpty)\n            {\n                // 2.1) has same tag\n                if (inline.tagName.toLowerCase() === this.tag)\n                {\n                    // 2.1.1) has same args or hasn't args\n                    if (this.hasSameArgs(inline))\n                    {\n                        this.caret.setAfter(inline);\n                        $inline.remove();\n\n                        var el = this.selection.getElement();\n                        this.utils.normalizeTextNodes(el);\n                    }\n                    // 2.1.2) has different args and it is span tag\n                    else if (this.tag === 'span')\n                    {\n                        nodes = this.applyArgs([inline], false);\n                        this.caret.setStart(inline);\n                    }\n                    // 2.1.3) has different args and it is not span tag\n                    else\n                    {\n                       nodes = this.insertInline(nodes);\n                    }\n\n                }\n                // 2.2) has another tag\n                else\n                {\n                    // 2.2.1) has parent\n                    if (dataInline.hasParent([this.tag]))\n                    {\n                        $parent = $inline.closest(this.tag);\n                        parent = $parent.get();\n                        if (this.hasSameArgs(parent))\n                        {\n                            $parent.unwrap();\n                            this.caret.setStart(inline);\n                        }\n                        else\n                        {\n                            nodes = this.insertInline(nodes);\n                        }\n                    }\n                    // 2.2.2) hasn't parent\n                    else\n                    {\n                        nodes = this.insertInline(nodes);\n                    }\n                }\n            }\n            // 3) inline isn't empty\n            else\n            {\n                // 3.1) has same tag\n                if (inline.tagName.toLowerCase() === this.tag)\n                {\n                    // 3.1.1) has same args or hasn't args\n                    if (this.hasSameArgs(inline))\n                    {\n                        // insert break\n                        extractedContent = this.utils.extractHtmlFromCaret(inline);\n                        $secondPart = $R.dom('<' + this.tag + ' />');\n                        $secondPart = this.utils.cloneAttributes(inline, $secondPart);\n\n                        $inline.after($secondPart.append(extractedContent));\n\n                        if ($secondPart.html().trim() === '') {\n                            $secondPart.remove();\n                        }\n\n                        this.caret.setAfter(inline);\n                    }\n                    else\n                    {\n                        nodes = this.insertInline(nodes);\n                    }\n                }\n                // 3.2) has another tag\n                else\n                {\n                    // 3.2.1) has parent\n                    if (dataInline.hasParent([this.tag]))\n                    {\n                        $parent = $inline.closest(this.tag);\n                        parent = $parent.get();\n                        if (this.hasSameArgs(parent))\n                        {\n                            // insert break\n                            extractedContent = this.utils.extractHtmlFromCaret(parent, parent);\n                            $secondPart = $R.dom('<' + this.tag + ' />');\n                            $secondPart = this.utils.cloneAttributes(parent, $secondPart);\n\n                            var $breaked, $last;\n                            var z = 0;\n                            inlines = inlines.reverse();\n                            for (var i = 0; i < inlines.length; i++)\n                            {\n                                if (inlines[i] !== parent)\n                                {\n                                    $last = $R.dom('<' + inlines[i].tagName.toLowerCase() + '>');\n                                    if (z === 0)\n                                    {\n                                        $breaked = $last;\n                                    }\n                                    else\n                                    {\n                                        $breaked.append($last);\n                                    }\n\n                                    z++;\n                                }\n                            }\n\n                            $parent.after($secondPart.append(extractedContent));\n                            $parent.after($breaked);\n\n                            this.caret.setStart($last);\n                        }\n                        else\n                        {\n                            nodes = this.insertInline(nodes);\n                        }\n                    }\n                    // 3.2.2) hasn't parent\n                    else\n                    {\n                        nodes = this.insertInline(nodes);\n                    }\n                }\n            }\n        }\n\n        return nodes;\n    },\n    insertInline: function(nodes)\n    {\n        var node = document.createElement(this.tag);\n        nodes = this.insertion.insertNode(node, 'start');\n\n        return this.applyArgs(nodes, false);\n    },\n    hasSameArgs: function(inline)\n    {\n        if (inline.attributes.length === 0 && this.args === false)\n        {\n            return true;\n        }\n        else\n        {\n            var same = true;\n            if (this.args)\n            {\n                var count = 0;\n                for (var key in this.args)\n                {\n                    var $node = $R.dom(inline);\n                    var args = (this.args[key]);\n                    var value = this.utils.toParams(args);\n                    var nodeAttrValue = $node.attr(key);\n\n                    if (args)\n                    {\n                        if (key === 'style')\n                        {\n                            value = value.trim().replace(/;$/, '');\n\n                            var origRules = this.utils.styleToObj($node.attr('style'));\n                            var rules = value.split(';');\n                            var innerCount = 0;\n\n                            for (var i = 0; i < rules.length; i++)\n                            {\n                                var arr = rules[i].split(':');\n                                var ruleName = arr[0].trim();\n                                var ruleValue = arr[1].trim();\n\n                                if (ruleName.search(/color/) !== -1)\n                                {\n                                    var val = $node.css(ruleName);\n                                    if (val && (val === ruleValue || this.utils.rgb2hex(val) === ruleValue))\n                                    {\n                                        innerCount++;\n                                    }\n                                }\n                                else if ($node.css(ruleName) === ruleValue)\n                                {\n                                    innerCount++;\n                                }\n                            }\n\n                            if (innerCount === rules.length && Object.keys(origRules).length === rules.length)\n                            {\n                                count++;\n                            }\n                        }\n                        else\n                        {\n                            if (nodeAttrValue === value)\n                            {\n                                count++;\n                            }\n                        }\n                    }\n                    else\n                    {\n                        if (!nodeAttrValue || nodeAttrValue === '')\n                        {\n                            count++;\n                        }\n                    }\n                }\n\n                same = (count === Object.keys(this.args).length);\n            }\n\n            return same;\n        }\n    },\n    formatUncollapsed: function()\n    {\n        var inlines = this.selection.getInlines({ all: true, inside: true });\n\n        if (this.detector.isIe()) this.selection.saveMarkers();\n        else this.selection.save();\n\n        // convert del / u\n        this._convertTags('u');\n        this._convertTags('del');\n\n        // convert target tags\n        this._convertToStrike(inlines);\n\n        if (this.detector.isIe()) this.selection.restoreMarkers();\n        else this.selection.restore();\n\n        // apply strike\n        document.execCommand('strikethrough');\n\n        // clear decoration\n        this._clearDecoration();\n\n        this.selection.save();\n\n        // revert and set style\n        var nodes = this._revertToInlines();\n        nodes = this.applyArgs(nodes, false);\n\n        // unwrap if attributes was removed\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var node = nodes[i];\n            var tag = node.tagName.toLowerCase();\n            var len = node.attributes.length;\n\n            if (tag === this.tag && len === 0 && this.args)\n            {\n                $R.dom(node).unwrap();\n                nodes.splice(i, 1);\n            }\n        }\n\n        this.selection.restore();\n\n        // clear and normalize\n        this._clearEmptyStyle();\n        nodes = this._normalizeBlocks(nodes);\n\n        return nodes;\n    },\n    _convertTags: function(tag)\n    {\n        if (this.tag !== tag)\n        {\n            var $editor = this.editor.getElement();\n            $editor.find(tag).each(function(node)\n            {\n                var $el = this.utils.replaceToTag(node, 'span');\n                $el.addClass('redactor-convertable-' + tag);\n            }.bind(this));\n        }\n    },\n    _revertTags: function(tag)\n    {\n        var $editor = this.editor.getElement();\n\n        $editor.find('span.redactor-convertable-' + tag).each(function(node)\n        {\n            var $el = this.utils.replaceToTag(node, tag);\n            $el.removeClass('redactor-convertable-' + tag);\n            if (this.utils.removeEmptyAttr($el, 'class')) $el.removeAttr('class');\n\n        }.bind(this));\n    },\n    _convertToStrike: function(inlines)\n    {\n        var selected = this.selection.getText().replace(/[-[\\]/{}()*+?.\\\\^$|]/g, \"\\\\$&\");\n\n        for (var i = 0; i < inlines.length; i++)\n        {\n            var tag = this.arrangeTag(inlines[i].tagName.toLowerCase());\n            var inline = inlines[i];\n            var $inline = $R.dom(inline);\n            var hasSameArgs = this.hasSameArgs(inline);\n\n            if (tag === this.tag)\n            {\n\n                if (this.tag === 'span' && this._isTextSelected(inline, selected))\n                {\n                    $inline.addClass('redactor-convertable-apply');\n                }\n                else if (hasSameArgs && this.tag !== 'a')\n                {\n                    this._replaceToStrike($inline);\n                }\n                else if (this.tag === 'span')\n                {\n                    if (this.args && this.args.style) {\n                        for (var key in this.args.style) {\n                            $inline.css(key, '');\n                        }\n                    }\n\n                    if (this.utils.removeEmptyAttr($inline.get(), 'style')) {\n                        $inline.addClass('redactor-convertable-apply');\n                    }\n                    else {\n                        $inline.addClass('redactor-unconvertable-apply');\n                    }\n                }\n                else if (!hasSameArgs)\n                {\n                    $inline.addClass('redactor-convertable-apply');\n                }\n\n            }\n        }\n    },\n    _replaceToStrike: function($el)\n    {\n        $el.replaceWith(function()\n        {\n            return $R.dom('<strike>').append($el.contents());\n        });\n    },\n    _revertToInlines: function()\n    {\n        var nodes = [];\n        var $editor = this.editor.getElement();\n\n        if (this.tag !== 'u') $editor.find('u').unwrap();\n\n        $editor.find('.redactor-convertable-u').each(function(node)\n        {\n             nodes.push(node);\n\n        });\n\n        // span convertable\n        $editor.find('.redactor-convertable-apply').each(function(node)\n        {\n            var $node = $R.dom(node);\n            $node.find('strike').unwrap();\n\n            this._forceRemoveClass($node, 'redactor-convertable-apply');\n            nodes.push(node);\n\n        }.bind(this));\n\n        // span unconvertable\n        $editor.find('span.redactor-unconvertable-apply').each(function(node)\n        {\n            var $node = $R.dom(node);\n            this._forceRemoveClass($node, 'redactor-unconvertable-apply');\n\n        }.bind(this));\n\n        // strike\n        $editor.find('strike').each(function(node)\n        {\n            var $node = this.utils.replaceToTag(node, this.tag);\n            nodes.push($node.get());\n\n        }.bind(this));\n\n\n        this._revertTags('u');\n        this._revertTags('del');\n\n        return nodes;\n    },\n    _normalizeBlocks: function(nodes)\n    {\n        var tags = this.opts.inlineTags;\n        var blocks = this.selection.getBlocks();\n        if (blocks)\n        {\n            for (var i = 0; i < blocks.length; i++)\n            {\n                if (blocks[i].tagName === 'PRE')\n                {\n                    var $node = $R.dom(blocks[i]);\n                    $node.find(tags.join(',')).not('.redactor-selection-marker').each(function(inline)\n                    {\n                        if (nodes.indexOf(inline) !== -1)\n                        {\n                            nodes = this.utils.removeFromArrayByValue(nodes, inline);\n                        }\n\n                        $R.dom(inline).unwrap();\n                    }.bind(this));\n                }\n            }\n        }\n\n        return nodes;\n    },\n    _clearDecoration: function()\n    {\n        var $editor = this.editor.getElement();\n        $editor.find(this.opts.inlineTags.join(',')).each(function(node)\n        {\n            if (node.style.textDecoration === 'line-through' || node.style.textDecorationLine === 'line-through')\n            {\n                var $el = $R.dom(node);\n                $el.css('textDecorationLine', '');\n                $el.css('textDecoration', '');\n                $el.wrap('<strike>');\n            }\n        });\n    },\n    _clearEmptyStyle: function()\n    {\n        var inlines = this.getInlines();\n        for (var i = 0; i < inlines.length; i++)\n        {\n            this._clearEmptyStyleAttr(inlines[i]);\n\n            var childNodes = inlines[i].childNodes;\n            if (childNodes)\n            {\n                for (var z = 0; z < childNodes.length; z++)\n                {\n                    this._clearEmptyStyleAttr(childNodes[z]);\n                }\n            }\n        }\n    },\n    _clearEmptyStyleAttr: function(node)\n    {\n        if (node.nodeType !== 3 && this.utils.removeEmptyAttr(node, 'style'))\n        {\n            node.removeAttribute('style');\n            node.removeAttribute('data-redactor-style-cache');\n        }\n    },\n    _forceRemoveClass: function($node, classname)\n    {\n        $node.removeClass(classname);\n        if (this.utils.removeEmptyAttr($node, 'class')) $node.removeAttr('class');\n    },\n    _isTextSelected: function(node, selected)\n    {\n        var text = this.utils.removeInvisibleChars(node.textContent);\n\n        return (selected === text || selected.search(new RegExp('^' + this.utils.escapeRegExp(text) + '$')) !== -1);\n    },\n    getInlines: function(tags)\n    {\n        return (tags) ? this.selection.getInlines({ tags: tags, all: true }) : this.selection.getInlines({ all: true });\n    },\n    getElements: function(tags)\n    {\n        return $R.dom(this.getInlines(tags));\n    },\n    clearFormat: function()\n    {\n        this.selection.save();\n\n        var nodes = this.selection.getInlines({ all: true });\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var $el = $R.dom(nodes[i]);\n            var inline = this.selection.getInline(nodes[i]);\n            if (inline)\n            {\n                $el.unwrap();\n            }\n        }\n\n        this.selection.restore();\n    }\n});\n$R.add('service', 'autoparser', {\n    init: function(app)\n    {\n        this.app = app;\n        this.cleaner = this.app.cleaner;\n    },\n    observe: function()\n    {\n        var $editor = this.editor.getElement();\n        var $objects = $editor.find('.redactor-autoparser-object').each(function(node)\n        {\n           var $node = $R.dom(node);\n           $node.removeClass('redactor-autoparser-object');\n           if ($node.attr('class') === '') $node.removeAttr('class');\n        });\n\n        if ($objects.length > 0)\n        {\n            $objects.each(function(node)\n            {\n                var type;\n                var $object = false;\n                var tag = node.tagName;\n\n                if (tag === 'A') type = 'link';\n                else if (tag === 'IMG') type = 'image';\n                else if (tag === 'IFRAME') type = 'video';\n\n                if (type)\n                {\n                    $object = $R.create(type + '.component', this.app, node);\n                    this.app.broadcast(type + '.inserted', $object);\n                    this.app.broadcast('autoparse', type, $object);\n                }\n\n            }.bind(this));\n        }\n    },\n    format: function(e, key)\n    {\n        if (this._isKey(key))\n        {\n            this._format(key === this.keycodes.ENTER);\n        }\n    },\n    parse: function(html)\n    {\n        var tags = ['figure', 'html', 'form', 'pre', 'object', 'video', 'iframe', 'code', 'a', 'img'];\n        var stored = [];\n        var z = 0;\n\n        // store\n        var storedComments = [];\n        html = this.cleaner.storeComments(html, storedComments);\n\n        // encode\n        html = this.cleaner.encodeCode(html);\n\n        // converting entity\n        html = html.replace(/\\$/g, '&#36;');\n        html = html.replace(/&amp;/g, '&');\n\n        // store tags\n        for (var i = 0; i < tags.length; i++)\n        {\n            var reTags = (tags[i] === 'img') ? '<' + tags[i] + '[^>]*>' : '<' + tags[i] + '([\\\\w\\\\W]*?)</' + tags[i] + '>';\n            var matched = html.match(new RegExp(reTags, 'gi'));\n\n            if (matched !== null)\n            {\n                for (var y = 0; y < matched.length; y++)\n                {\n                    html = html.replace(matched[y], '#####replaceparse' + z + '#####');\n                    stored.push(matched[y]);\n                    z++;\n                }\n            }\n        }\n\n        // images\n        if (this.opts.autoparseImages && html.match(this.opts.regex.imageurl))\n        {\n            var imagesMatches = html.match(this.opts.regex.imageurl);\n            for (var i = 0; i < imagesMatches.length; i++)\n            {\n                html = html.replace(imagesMatches[i], '<img class=\"redactor-autoparser-object\" src=\"' + imagesMatches[i] + '\">');\n            }\n        }\n\n        // video\n        if (this.opts.autoparseVideo && (html.match(this.opts.regex.youtube) || html.match(this.opts.regex.vimeo)))\n        {\n            var iframeStart = '<iframe width=\"500\" height=\"281\" src=\"';\n            var iframeEnd = '\" frameborder=\"0\" allowfullscreen></iframe>';\n\n            var str, re;\n            var https = (this.opts.autoparseHttps) ? 'https:' : '';\n            if (html.match(this.opts.regex.youtube))\n            {\n                str = https + '//www.youtube.com/embed/$1';\n                re = this.opts.regex.youtube;\n            }\n            else if (html.match(this.opts.regex.vimeo))\n            {\n                str = https + '//player.vimeo.com/video/$2';\n                re = this.opts.regex.vimeo;\n            }\n\n            var $video = this.component.create('video', iframeStart + str + iframeEnd);\n\n            html = html.replace(re, $video.get().outerHTML);\n        }\n\n        // store tags\n        for (var i = 0; i < tags.length; i++)\n        {\n            var reTags = (tags[i] === 'img') ? '<' + tags[i] + '[^>]*>' : '<' + tags[i] + '([\\\\w\\\\W]*?)</' + tags[i] + '>';\n            var matched = html.match(new RegExp(reTags, 'gi'));\n\n            if (matched !== null)\n            {\n                for (var y = 0; y < matched.length; y++)\n                {\n                    html = html.replace(matched[y], '#####replaceparse' + z + '#####');\n                    stored.push(matched[y]);\n                    z++;\n                }\n            }\n        }\n\n        // links\n        if (this.opts.autoparseLinks && html.match(this.opts.regex.url))\n        {\n            html = this._formatLinks(html);\n        }\n\n        // restore\n        html = this._restoreReplaced(stored, html);\n\n        // repeat for nested tags\n        html = this._restoreReplaced(stored, html);\n\n        // restore comments\n        html = this.cleaner.restoreComments(html, storedComments);\n\n        return html;\n    },\n\n    // private\n    _isKey: function(key)\n    {\n        return (key === this.keycodes.ENTER || key === this.keycodes.SPACE);\n    },\n    _format: function(enter)\n    {\n        var parent = this.selection.getParent();\n        var $parent = $R.dom(parent);\n\n        var isNotFormatted = (parent && $parent.closest('figure, pre, code, img, a, iframe').length !== 0);\n        if (isNotFormatted || !this.selection.isCollapsed())\n        {\n            return;\n        }\n\n        // add split marker\n        var marker = this.utils.createInvisibleChar();\n        var range = this.selection.getRange();\n        range.insertNode(marker);\n\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var $current = $R.dom(current);\n\n        // remove split marker\n        marker.parentNode.removeChild(marker);\n\n        if (current && current.nodeType === 3)\n        {\n            var content = current.textContent;\n            var type;\n\n            // images\n            if (this.opts.autoparseImages && content.match(this._convertToRegExp(this.opts.regex.imageurl)))\n            {\n                var isList = data.isList();\n                var matches = content.match(this.opts.regex.imageurl);\n                var el = (isList) ? undefined : '<figure><img></figure>';\n\n                var $img = this.component.create('image', el);\n                $img.setSrc(matches[0]);\n                $img.addClass('redactor-autoparser-object');\n\n                content = content.replace(matches[0], $img.get().outerHTML);\n                type = 'image';\n            }\n            // video\n            else if (this.opts.autoparseVideo && (content.match(this._convertToRegExp(this.opts.regex.youtube)) || content.match(this._convertToRegExp(this.opts.regex.vimeo))))\n            {\n                var iframeStart = '<iframe width=\"500\" height=\"281\" src=\"';\n                var iframeEnd = '\" frameborder=\"0\" allowfullscreen></iframe>';\n                var str, re;\n\n                if (content.match(this.opts.regex.youtube))\n                {\n                    str = '//www.youtube.com/embed/$1';\n                    re = this.opts.regex.youtube;\n                }\n                else if (content.match(this.opts.regex.vimeo))\n                {\n                    str = '//player.vimeo.com/video/$2';\n                    re = this.opts.regex.vimeo;\n                }\n\n                var $video = this.component.create('video', iframeStart + str + iframeEnd);\n                $video.addClass('redactor-autoparser-object');\n\n                content = content.replace(re, $video.get().outerHTML);\n                type = 'video';\n            }\n            // links\n            else if (this.opts.autoparseLinks && content.match(this._convertToRegExp(this.opts.regex.url)))\n            {\n                content = this._formatLinks(content, enter);\n                type = 'link';\n            }\n\n            // replace\n            if (type)\n            {\n                if (enter)\n                {\n                    this.selection.save();\n                    $current.replaceWith(content);\n                    this.selection.restore();\n                }\n                else\n                {\n                    $current.replaceWith(content);\n                }\n\n                // object\n                var $editor = this.editor.getElement();\n                var $object = $editor.find('.redactor-autoparser-object').removeClass('redactor-autoparser-object');\n                $object = (type === 'link') ? $R.create('link.component', this.app, $object) : $object;\n\n                // caret\n                if (type === 'link')\n                {\n                    if (!enter) this.caret.setAfter($object);\n                    this.app.broadcast('link.inserted', $object);\n                }\n                else\n                {\n                    this.caret.setAfter($object);\n\n                    var $cloned = $object.clone();\n                    $object.remove();\n                    $object = this.insertion.insertHtml($cloned);\n                    $object = this.component.build($object);\n                }\n\n                // callback\n                this.app.broadcast('autoparse', type, $object);\n            }\n        }\n    },\n    _formatLinks: function(content) {\n        var target = (this.opts.pasteLinkTarget !== false) ? ' target=\"' + this.opts.pasteLinkTarget + '\"' : '';\n        var protocol = 'http';\n        var classstr = ' class=\"redactor-autoparser-object\"';\n        var self = this;\n\n        content = content.replace(this.opts.regex.aurl1, function(url) {\n            return '<a href=\"' + url + '\"' + target + classstr + '>' + self._subLinkText(url) + '</a>';\n        });\n\n        content = content.replace(this.opts.regex.aurl2, function(match, before, url) {\n            return before + '<a href=\"' + protocol + '://' + url + '\"' + target + classstr + '>' + self._subLinkText(url) + '</a>';\n        });\n\n        return content;\n    },\n    _subLinkText: function(text) {\n        text = (text.length > this.opts.linkSize) ? text.substring(0, this.opts.linkSize) + '...' : text;\n        text = (text.search('%') === -1) ? decodeURIComponent(text) : text;\n\n        return text;\n    },\n    _restoreReplaced: function(stored, html) {\n        for (var i = 0; i < stored.length; i++) {\n            html = html.replace('#####replaceparse' + i + '#####', stored[i]);\n        }\n\n        return html;\n    },\n    _convertToRegExp: function(str) {\n        return new RegExp(String(str).replace(/^\\//, '').replace(/\\/ig$/, '').replace(/\\/gi$/, '') + '$', 'gi');\n    }\n});\n$R.add('service', 'storage', {\n    init: function(app)\n    {\n        this.app = app;\n\n        // local\n        this.data = [];\n    },\n    // public\n    observeImages: function()\n    {\n        if (this.opts.imageObserve) {\n            var $editor = this.editor.getElement();\n            var $images = $editor.find('[data-image]');\n            $images.each(this._addImage.bind(this));\n        }\n    },\n    observeFiles: function()\n    {\n        var $editor = this.editor.getElement();\n        var $files = $editor.find('[data-file]');\n\n\t\t$files.each(this._addFile.bind(this));\n    },\n\tsetStatus: function(url, status)\n\t{\n\t\tthis.data[url].status = status;\n\t},\n    getChanges: function()\n    {\n        var $editor = this.editor.getElement();\n\n        // check status\n        for (var key in this.data)\n\t\t{\n\t\t\tvar data = this.data[key];\n\t\t\tvar $el = $editor.find('[data-' + data.type + '=\"' + data.id + '\"]');\n\n\t\t\tthis.setStatus(data.id, ($el.length === 0) ? false : true);\n\t\t}\n\n        return this.data;\n    },\n\tadd: function(type, node)\n\t{\n        var $node = $R.dom(node);\n        var id = $node.attr('data-' + type);\n\n        this.data[id] = { type: type, status: true, node: $node.get(), id: $node.attr('data-' + type) };\n\t},\n\n    // private\n    _addImage: function(node)\n    {\n        this.add('image', node);\n    },\n    _addFile: function(node)\n    {\n        this.add('file', node);\n    }\n});\n$R.add('service', 'utils', {\n    init: function(app)\n    {\n        this.app = app;\n    },\n    // empty\n    isEmpty: function(el)\n    {\n        var isEmpty = false;\n        el = $R.dom(el).get();\n        if (el)\n        {\n            isEmpty = (el.nodeType === 3) ? (el.textContent.trim().replace(/\\n/, '') === '') : (el.innerHTML === '');\n        }\n\n        return isEmpty;\n    },\n    isEmptyHtml: function(html, keepbr, keeplists)\n    {\n        html = this.removeInvisibleChars(html);\n        html = html.replace(/&nbsp;/gi, '');\n        html = html.replace(/<\\/?br\\s?\\/?>/g, ((keepbr) ? 'br' : ''));\n        html = html.replace(/\\s/g, '');\n        html = html.replace(/^<p>[^\\W\\w\\D\\d]*?<\\/p>$/i, '');\n        html = html.replace(/^<div>[^\\W\\w\\D\\d]*?<\\/div>$/i, '');\n\n        if (keeplists)\n        {\n            html = html.replace(/<ul(.*?[^>])>$/i, 'ul');\n            html = html.replace(/<ol(.*?[^>])>$/i, 'ol');\n        }\n\n        html = html.replace(/<hr(.*?[^>])>$/i, 'hr');\n        html = html.replace(/<iframe(.*?[^>])>$/i, 'iframe');\n        html = html.replace(/<source(.*?[^>])>$/i, 'source');\n\n        // remove empty tags\n        html = html.replace(/<[^\\/>][^>]*><\\/[^>]+>/gi, '');\n        html = html.replace(/<[^\\/>][^>]*><\\/[^>]+>/gi, '');\n\n        // trim\n        html = html.trim();\n\n        return html === '';\n    },\n    trimSpaces: function(html)\n    {\n        return html = this.removeInvisibleChars(html.trim());\n    },\n\n    // invisible chars\n    createInvisibleChar: function()\n    {\n        return document.createTextNode(this.opts.markerChar);\n    },\n    searchInvisibleChars: function(str)\n    {\n        return str.search(/^\\uFEFF$/g);\n    },\n    removeInvisibleChars: function(html)\n    {\n        return html.replace(/\\uFEFF/g, '');\n    },\n    trimInvisibleChars: function(direction)\n    {\n        if (!this.selection.isCollapsed()) return;\n\n        var current = this.selection.getCurrent();\n        var side = (direction === 'left') ? this.selection.getTextBeforeCaret() : this.selection.getTextAfterCaret();\n        var isSpace = (current && current.nodeType === 3 && this.searchInvisibleChars(side) === 0);\n\n        if (isSpace)\n        {\n            if (direction === 'left')\n            {\n                $R.dom(current).replaceWith(current.textContent.trim());\n            }\n            else\n            {\n                var offset = this.offset.get();\n                this.offset.set({ start: offset.start + 1, end: offset.end + 1 });\n            }\n        }\n    },\n\n    // wrapper\n    buildWrapper: function(html)\n    {\n        return $R.dom('<div>').html(html);\n    },\n    getWrapperHtml: function($wrapper)\n    {\n        var html = $wrapper.html();\n        $wrapper.remove();\n\n        return html;\n    },\n\n    // fragment\n    createTmpContainer: function(html)\n    {\n        var $div = $R.dom('<div>');\n\n        if (typeof html === 'string')\n        {\n            $div.html(html);\n        }\n        else\n        {\n            $div.append($R.dom(html).clone(true));\n        }\n\n        return $div.get();\n    },\n    createFragment: function(html)\n    {\n        var el = this.createTmpContainer(html);\n        var frag = document.createDocumentFragment(), node, firstNode, lastNode;\n        var nodes = [];\n        var i = 0;\n        while ((node = el.firstChild))\n        {\n            i++;\n            var n = frag.appendChild(node);\n            if (i === 1) firstNode = n;\n\n            nodes.push(n);\n            lastNode = n;\n        }\n\n        return { frag: frag, first: firstNode, last: lastNode, nodes: nodes };\n    },\n    isFragment: function(obj)\n    {\n        return (typeof obj === 'object' && obj.frag);\n    },\n    parseHtml: function(html)\n    {\n        var div = this.createTmpContainer(html);\n\n        return { html: div.innerHTML, nodes: div.childNodes };\n    },\n\n    splitNode: function(current, nodes, isList, inline)\n    {\n        nodes = (this.isFragment(nodes)) ? nodes.frag : nodes;\n\n        var element;\n        if (inline)\n        {\n            element = (this.inspector.isInlineTag(current.tagName)) ? current : this.selection.getInline(current);\n        }\n        else\n        {\n            element = (this.inspector.isBlockTag(current.tagName)) ? current : this.selection.getBlock(current);\n        }\n\n        var $element = $R.dom(element);\n\n        // replace is empty\n        if (!inline && this.isEmptyHtml(element.innerHTML, true))\n        {\n            $element.after(nodes);\n            $element.remove();\n\n            return nodes;\n        }\n\n        var tag = $element.get().tagName.toLowerCase();\n        var isEnd = this.caret.isEnd(element);\n        var isStart = this.caret.isStart(element);\n\n        if (!isEnd && !isStart)\n        {\n            var extractedContent = this.extractHtmlFromCaret(inline);\n\n            var $secondPart = $R.dom('<' + tag + ' />');\n            $secondPart = this.cloneAttributes(element, $secondPart);\n\n            $element.after($secondPart.append(extractedContent));\n        }\n\n        if (isStart)\n        {\n            return $element.before(nodes);\n        }\n        else\n        {\n            if (isList)\n            {\n                return $element.append(nodes);\n            }\n            else\n            {\n                nodes = $element.after(nodes);\n\n                var html = $element.html();\n                html = this.removeInvisibleChars(html);\n                html = html.replace(/&nbsp;/gi, '');\n\n                if (html === '') $element.remove();\n\n                return nodes;\n            }\n        }\n    },\n    extractHtmlFromCaret: function(inline, element)\n    {\n        var range = this.selection.getRange();\n        if (range)\n        {\n            element = (element) ? element : ((inline) ? this.selection.getInline() : this.selection.getBlock());\n            if (element)\n            {\n                var clonedRange = range.cloneRange();\n                clonedRange.selectNodeContents(element);\n                clonedRange.setStart(range.endContainer, range.endOffset);\n\n                return clonedRange.extractContents();\n            }\n        }\n    },\n    createMarkup: function(el)\n    {\n        var markup = document.createElement(this.opts.markup);\n        if (this.opts.breakline) markup.setAttribute('data-redactor-tag', 'br');\n\n        var $el = $R.dom(el);\n\n        $el.after(markup);\n        this.caret.setStart(markup);\n    },\n    createMarkupBefore: function(el)\n    {\n        var markup = document.createElement(this.opts.markup);\n        if (this.opts.breakline) markup.setAttribute('data-redactor-tag', 'br');\n\n        var $el = $R.dom(el);\n\n        $el.before(markup);\n        this.caret.setEnd(markup);\n    },\n    getNode: function(el)\n    {\n        var node = $R.dom(el).get();\n        var editor = this.editor.getElement().get();\n\n        return (typeof el === 'undefined') ? editor : ((node) ? node : false);\n    },\n    findSiblings: function(node, type)\n    {\n        node = $R.dom(node).get();\n        type = (type === 'next') ? 'nextSibling' : 'previousSibling';\n\n        while (node = node[type])\n        {\n            if ((node.nodeType === 3 && node.textContent.trim() === '') || node.tagName === 'BR')\n            {\n                continue;\n            }\n\n            return node;\n        }\n\n        return false;\n    },\n    getElementsFromHtml: function(html, selector, exclude)\n    {\n        var div = document.createElement(\"div\");\n        div.innerHTML = html;\n\n        var elems = div.querySelectorAll(selector);\n\n        // array map polyfill\n        var mapping = function(callback, thisArg)\n        {\n            if (typeof this.length !== 'number') return;\n            if (typeof callback !== 'function') return;\n\n            var newArr = [];\n            if (typeof this == 'object')\n            {\n                for (var i = 0; i < this.length; i++)\n                {\n                    if (i in this) newArr[i] = callback.call(thisArg || this, this[i], i, this);\n                    else return;\n                }\n            }\n\n            return newArr;\n        };\n\n        return mapping.call(elems, function(el)\n        {\n            var type = el.getAttribute('data-redactor-type');\n            if (exclude && type && type === exclude) {}\n            else return el.outerHTML;\n        });\n    },\n\n    // childnodes\n    getChildNodes: function(el, recursive, elements)\n    {\n        el = (el && el.nodeType && el.nodeType === 11) ? el : $R.dom(el).get();\n\n        var nodes = el.childNodes;\n        var result = [];\n        if (nodes)\n        {\n            for (var i = 0; i < nodes.length; i++)\n            {\n                if (elements === true && nodes[i].nodeType === 3) continue;\n                else if (nodes[i].nodeType === 3 && this.isEmpty(nodes[i])) continue;\n\n                result.push(nodes[i]);\n\n                if (recursive !== false)\n                {\n                    var nestedNodes = this.getChildNodes(nodes[i], elements);\n                    if (nestedNodes.length > 0)\n                    {\n                        result = result.concat(nestedNodes);\n                    }\n                }\n            }\n        }\n\n        return result;\n    },\n    getChildElements: function(el)\n    {\n        return this.getChildNodes(el, true, true);\n    },\n    getFirstNode: function(el)\n    {\n        return this._getFirst(this.getChildNodes(el, false));\n    },\n    getLastNode: function(el)\n    {\n        return this._getLast(this.getChildNodes(el, false));\n    },\n    getFirstElement: function(el)\n    {\n        return this._getFirst(this.getChildNodes(el, false, true));\n    },\n    getLastElement: function(el)\n    {\n        return this._getLast(this.getChildNodes(el, false, true));\n    },\n\n    // replace\n    replaceToTag: function(node, tag)\n    {\n        var $node = $R.dom(node);\n        return $node.replaceWith(function(node)\n        {\n            var $replaced = $R.dom('<' + tag + '>').append($R.dom(node).contents());\n            if (node.attributes)\n            {\n                var attrs = node.attributes;\n                for (var i = 0; i < attrs.length; i++)\n                {\n                    $replaced.attr(attrs[i].nodeName, attrs[i].value);\n                }\n            }\n\n            return $replaced;\n\n        });\n    },\n\n    // string\n    ucfirst: function(str)\n    {\n        return str.charAt(0).toUpperCase() + str.slice(1);\n    },\n\n    // array\n    removeFromArrayByValue: function(arr, value)\n    {\n        var a = arguments, len = a.length, ax;\n        while (len > 1 && arr.length)\n        {\n            value = a[--len];\n            while ((ax= arr.indexOf(value)) !== -1)\n            {\n                arr.splice(ax, 1);\n            }\n        }\n\n        return arr;\n    },\n\n    // attributes\n    removeEmptyAttr: function(el, attr)\n    {\n        var $el = $R.dom(el);\n\n        if (typeof $el.attr(attr) === 'undefined' || $el.attr(attr) === null) return true;\n        else if ($el.attr(attr) === '')\n        {\n            $el.removeAttr(attr);\n            return true;\n        }\n\n        return false;\n    },\n    cloneAttributes: function(elFrom, elTo)\n    {\n        elFrom = $R.dom(elFrom).get();\n        elTo = $R.dom(elTo);\n\n        var attrs = elFrom.attributes;\n        var len = attrs.length;\n        while (len--)\n        {\n            var attr = attrs[len];\n            elTo.attr(attr.name, attr.value);\n        }\n\n        return elTo;\n    },\n\n    // object\n    toParams: function(obj)\n    {\n        if (typeof obj !== 'object') return obj;\n\n        var keys = Object.keys(obj);\n        if (!keys.length) return '';\n        var result = '';\n\n        for (var i = 0; i < keys.length; i++)\n        {\n            var key = keys[i];\n            result += key + ':' + obj[key] + ';';\n        }\n\n        return result;\n    },\n    styleToObj: function(str)\n    {\n        var obj = {};\n\n        if (str)\n        {\n            var style = str.replace(/;$/, '').split(';');\n            for (var i = 0; i < style.length; i++)\n            {\n                var rule = style[i].split(':');\n                obj[rule[0].trim()] = rule[1].trim();\n            }\n        }\n\n        return obj;\n    },\n    checkProperty: function(obj)\n    {\n        var args = (arguments[1] && Array.isArray(arguments[1])) ? arguments[1] : [].slice.call(arguments, 1);\n\n        for (var i = 0; i < args.length; i++)\n        {\n            if (!obj || (typeof obj[args[i]] === 'undefined'))\n            {\n                return false;\n            }\n\n            obj = obj[args[i]];\n        }\n\n        return obj;\n    },\n\n    // data\n    extendData: function(data, obj)\n    {\n        for (var key in obj)\n        {\n            if (key === 'elements')\n            {\n                var $elms = $R.dom(obj[key]);\n                $elms.each(function(node)\n                {\n                    var $node = $R.dom(node);\n                    if (node.tagName === 'FORM')\n                    {\n                        var serializedData = $node.serialize(true);\n                        for (var z in serializedData)\n                        {\n                            data = this._setData(data, z, serializedData[z]);\n                        }\n                    }\n                    else\n                    {\n                        var name = ($node.attr('name')) ? $node.attr('name') : $node.attr('id');\n                        data = this._setData(data, name, $node.val());\n                    }\n                }.bind(this));\n            }\n            else\n            {\n                data = this._setData(data, key, obj[key]);\n            }\n        }\n\n        return data;\n    },\n    _setData: function(data, name, value)\n    {\n        if (data instanceof FormData) data.append(name, value);\n        else data[name] = value;\n\n        return data;\n    },\n\n    // normalize\n    normalizeTextNodes: function(el)\n    {\n        el = $R.dom(el).get();\n        if (el) el.normalize();\n    },\n\n    // color\n    isRgb: function(str)\n    {\n        return (str.search(/^rgb/i) === 0);\n    },\n    rgb2hex: function(rgb)\n    {\n        rgb = rgb.match(/^rgba?[\\s+]?\\([\\s+]?(\\d+)[\\s+]?,[\\s+]?(\\d+)[\\s+]?,[\\s+]?(\\d+)[\\s+]?/i);\n\n        return (rgb && rgb.length === 4) ? \"#\" +\n        (\"0\" + parseInt(rgb[1],10).toString(16)).slice(-2) +\n        (\"0\" + parseInt(rgb[2],10).toString(16)).slice(-2) +\n        (\"0\" + parseInt(rgb[3],10).toString(16)).slice(-2) : '';\n    },\n    hex2long: function(val)\n    {\n        if (val.search(/^#/) !== -1 && val.length === 4)\n        {\n            val = '#' + val[1] + val[1] + val[2] + val[2] + val[3] + val[3];\n        }\n\n        return val;\n    },\n\n    // escape\n    escapeRegExp: function(s)\n    {\n        return s.replace(/[-\\/\\\\^$*~+?.()|[\\]{}]/g, '\\\\$&');\n    },\n\n    // random\n    getRandomId: function()\n    {\n        var id = '';\n        var possible = 'abcdefghijklmnopqrstuvwxyz0123456789';\n\n        for (var i = 0; i < 12; i++)\n        {\n            id += possible.charAt(Math.floor(Math.random() * possible.length));\n        }\n\n        return id;\n    },\n\n    // private\n    _getFirst: function(nodes)\n    {\n        return (nodes.length !== 0) ? nodes[0] : false;\n    },\n    _getLast: function(nodes)\n    {\n        return (nodes.length !== 0) ? nodes[nodes.length-1] : false;\n    }\n});\n$R.add('service', 'progress', {\n    init: function(app)\n    {\n        this.app = app;\n\n        // local\n        this.$box = null;\n        this.$bar = null;\n    },\n\n    // public\n    show: function()\n    {\n        if (!this._is()) this._build();\n        this.$box.show();\n    },\n    hide: function()\n    {\n        if (this._is())\n        {\n            this.animate.start(this.$box, 'fadeOut', this._destroy.bind(this));\n        }\n    },\n    update: function(value)\n    {\n        this.show();\n        this.$bar.css('width', value + '%');\n    },\n\n    // private\n    _is: function()\n    {\n        return (this.$box !== null);\n    },\n    _build: function()\n    {\n        this.$bar = $R.dom('<span />');\n        this.$box = $R.dom('<div id=\"redactor-progress\" />');\n\n        this.$box.append(this.$bar);\n        this.$body.append(this.$box);\n    },\n    _destroy: function()\n    {\n        if (this._is()) this.$box.remove();\n\n        this.$box = null;\n        this.$bar = null;\n    }\n});\n$R.add('module', 'starter', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.plugin = app.plugin;\n        this.module = app.module;\n    },\n    // messages\n    onstart: function()\n    {\n        var services = ['element', 'container', 'source', 'editor', 'statusbar', 'toolbar'];\n        var modules = ['element', 'container', 'source', 'editor', 'statusbar', 'contextbar', 'input'];\n\n        this._startStop('start', this.app, services);\n        this._startStop('start', this.module, modules);\n    },\n    onstop: function()\n    {\n        var modules = ['observer', 'element', 'container', 'source', 'editor', 'contextbar'];\n\n        this._startStop('stop', this.module, modules);\n    },\n    onenable: function()\n    {\n        var modules = ['observer', 'toolbar'];\n        var plugins = this.opts.plugins;\n\n        this._startStop('start', this.module, modules);\n        this._startStop('start', this.plugin, plugins);\n    },\n    ondisable: function()\n    {\n        var modules = ['observer', 'toolbar'];\n        var plugins = this.opts.plugins;\n\n        this._startStop('stop', this.module, modules);\n        this._startStop('stop', this.plugin, plugins);\n    },\n\n    // private\n    _startStop: function(type, obj, arr)\n    {\n        for (var i = 0; i < arr.length; i++)\n        {\n            if (typeof obj[arr[i]] !== 'undefined')\n            {\n                this.app.callInstanceMethod(obj[arr[i]], type);\n            }\n        }\n    }\n});\n$R.add('module', 'element', {\n    init: function(app)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.opts = app.opts;\n        this.namespace = app.namespace;\n        this.element = app.element;\n        this.rootOpts = $R.extend({}, true, $R.options, app.rootOpts);\n    },\n    // public\n    start: function()\n    {\n        this._build();\n        this._buildModes();\n        this._buildMarkup();\n    },\n    stop: function()\n    {\n        var $element = this.element.getElement();\n        $element.removeData(this.namespace + '-uuid');\n    },\n\n    // private\n    _build: function()\n    {\n        var $element = this.element.getElement();\n        $element.data(this.namespace + '-uuid', this.uuid);\n    },\n    _buildModes: function()\n    {\n        var type = this.element.getType();\n\n        if (type === 'inline') this._redefineOptions(this.opts.modes['inline']);\n        if (type === 'div') this._redefineOptions(this.opts.modes['original']);\n\n        if (type !== 'inline')\n        {\n            if (this._isRootOption('styles') && this.rootOpts.styles) this.opts.styles = true;\n            if (this._isRootOption('source') && !this.rootOpts.source) this.opts.showSource = false;\n        }\n    },\n    _buildMarkup: function()\n    {\n        var type = this.element.getType();\n\n        if (type === 'inline')\n        {\n            this.opts.emptyHtml = '';\n        }\n        else if (this.opts.breakline)\n        {\n            this.opts.markup = 'div';\n            this.opts.emptyHtml = '<div data-redactor-tag=\"br\">' + this.opts.markerChar + '</div>';\n        }\n        else\n        {\n            this.opts.emptyHtml = '<' + this.opts.markup + '></' + this.opts.markup + '>';\n        }\n    },\n    _redefineOptions: function(opts)\n    {\n        for (var key in opts)\n        {\n            this.opts[key] = opts[key];\n        }\n    },\n    _isRootOption: function()\n    {\n        return (typeof this.rootOpts['styles'] !== 'undefined');\n    }\n});\n$R.add('module', 'editor', {\n    init: function(app)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.opts = app.opts;\n        this.editor = app.editor;\n        this.source = app.source;\n        this.element = app.element;\n        this.component = app.component;\n        this.container = app.container;\n        this.inspector = app.inspector;\n        this.autoparser = app.autoparser;\n\n        // local\n        this.placeholder = false;\n        this.events = false;\n    },\n    // messages\n    onenable: function()\n    {\n        this.enable();\n    },\n    ondisable: function()\n    {\n        this.disable();\n    },\n    onenablefocus: function()\n    {\n        this._enableFocus();\n    },\n    oncontextmenu: function(e)\n    {\n        this.component.setOnEvent(e, true);\n    },\n    onclick: function(e)\n    {\n        this.component.setOnEvent(e);\n    },\n    onkeyup: function(e)\n    {\n        var data = this.inspector.parse(e.target);\n        if (!data.isComponent())\n        {\n            this.component.clearActive();\n        }\n    },\n    onenablereadonly: function()\n    {\n        this._enableReadOnly();\n    },\n    ondisablereadonly: function()\n    {\n        this._disableReadOnly();\n    },\n    onautoparseobserve: function()\n    {\n        this.autoparser.observe();\n    },\n    onplaceholder: {\n        build: function()\n        {\n            this._buildPlaceholder();\n        },\n        toggle: function()\n        {\n            this._togglePlacehodler();\n        }\n    },\n\n    // public\n    start: function()\n    {\n        this._build();\n        this._buildEvents();\n        this._buildOptions();\n        this._buildAccesibility();\n    },\n    stop: function()\n    {\n        var $editor = this.editor.getElement();\n        var $container = this.container.getElement();\n\n        var classesEditor = ['redactor-in', 'redactor-in-' + this.uuid, 'redactor-structure', 'redactor-placeholder', 'notranslate'];\n        if (this.opts.stylesClass !== '') {\n            classesEditor.push(this.opts.stylesClass);\n        }\n\n        var classesContainer = ['redactor-focus', 'redactor-blur', 'redactor-over', 'redactor-styles-on',\n                                'redactor-styles-off', 'redactor-toolbar-on', 'redactor-text-labeled-on', 'redactor-source-view'];\n\n        $editor.removeAttr('spellcheck');\n        $editor.removeAttr('dir');\n        $editor.removeAttr('contenteditable');\n        $editor.removeAttr('placeholder');\n        $editor.removeAttr('data-gramm_editor');\n        $editor.removeClass(classesEditor.join(' '));\n\n        $container.removeClass(classesContainer.join(' '));\n\n        this._destroyEvents();\n\n        if ($editor.get().classList.length === 0) $editor.removeAttr('class');\n    },\n    enable: function()\n    {\n        var $editor = this.editor.getElement();\n        var $container = this.container.getElement();\n\n        $editor.addClass('redactor-in redactor-in-' + this.uuid);\n        $editor.attr({ 'contenteditable': true });\n\n        if (this.opts.structure)\n        {\n            $editor.addClass('redactor-structure');\n        }\n\n        if (this.opts.toolbar && !this.opts.air && !this.opts.toolbarExternal)\n        {\n            $container.addClass('redactor-toolbar-on');\n        }\n\n        // prevent editing\n        this._disableBrowsersEditing();\n    },\n    disable: function()\n    {\n        var $editor = this.editor.getElement();\n        var $container = this.container.getElement();\n\n        $editor.removeClass('redactor-in redactor-in-' + this.uuid);\n        $editor.removeClass('redactor-structure');\n        $editor.removeAttr('contenteditable');\n\n        $container.addClass('redactor-toolbar-on');\n    },\n\n    // private\n    _build: function()\n    {\n        var $editor = this.editor.getElement();\n        var $element = this.element.getElement();\n        var $container = this.container.getElement();\n\n        $container.addClass('redactor-blur');\n\n        if (!this.opts.grammarly)\n        {\n            $editor.attr('data-gramm_editor', false);\n        }\n\n        if (this.opts.notranslate)\n        {\n            $editor.addClass('notranslate');\n        }\n\n        if (this.opts.styles)\n        {\n            $editor.addClass(this.opts.stylesClass);\n            $container.addClass('redactor-styles-on');\n        }\n        else\n        {\n            $container.addClass('redactor-styles-off');\n        }\n\n        if (this.opts.buttonsTextLabeled)\n        {\n            $container.addClass('redactor-text-labeled-on');\n        }\n\n        if (this.element.isType('textarea')) $element.before($editor);\n    },\n    _buildEvents: function()\n    {\n        this.events = $R.create('editor.events', this.app);\n    },\n    _buildOptions: function()\n    {\n        var $editor = this.editor.getElement();\n\n        $editor.attr('dir', this.opts.direction);\n\n        if (!this.opts.spellcheck) $editor.attr('spellcheck', false);\n        if (this.opts.tabindex) $editor.attr('tabindex', this.opts.tabindex);\n        if (this.opts.minHeight) $editor.css('min-height', this.opts.minHeight);\n        if (this.opts.maxHeight) $editor.css('max-height', this.opts.maxHeight);\n        if (this.opts.maxWidth) $editor.css({ 'max-width': this.opts.maxWidth, 'margin': 'auto' });\n    },\n    _buildAccesibility: function()\n    {\n        var $editor = this.editor.getElement();\n\n        $editor.attr({ 'aria-labelledby': 'redactor-voice-' + this.uuid, 'role': 'presentation' });\n    },\n    _buildPlaceholder: function()\n    {\n        this.placeholder = $R.create('editor.placeholder', this.app);\n    },\n    _enableFocus: function()\n    {\n        if (this.opts.showSource) this._enableFocusSource();\n        else this._enableFocusEditor();\n    },\n    _enableFocusSource: function()\n    {\n        var $source = this.source.getElement();\n\n        if (this.opts.focus)\n        {\n            $source.focus();\n            $source.get().setSelectionRange(0, 0);\n        }\n        else if (this.opts.focusEnd)\n        {\n            $source.focus();\n        }\n    },\n    _enableFocusEditor: function()\n    {\n        if (this.opts.focus)\n        {\n            setTimeout(this.editor.startFocus.bind(this.editor), 100);\n        }\n        else if (this.opts.focusEnd)\n        {\n            setTimeout(this.editor.endFocus.bind(this.editor), 100);\n        }\n    },\n    _togglePlacehodler: function()\n    {\n        if (this.placeholder) this.placeholder.toggle();\n    },\n    _disableBrowsersEditing: function()\n    {\n        try {\n            // FF fix\n            document.execCommand('enableObjectResizing', false, false);\n            document.execCommand('enableInlineTableEditing', false, false);\n            // IE prevent converting links\n            document.execCommand(\"AutoUrlDetect\", false, false);\n\n            // IE disable image resizing\n            var $editor = this.editor.getElement();\n            var el = $editor.get();\n            if (el.addEventListener) el.addEventListener('mscontrolselect', function(e) { e.preventDefault(); });\n            else el.attachEvent('oncontrolselect', function(e) { e.returnValue = false; });\n\n        } catch (e) {}\n    },\n    _destroyEvents: function()\n    {\n        if (this.events)\n        {\n            this.events.destroy();\n        }\n    },\n    _enableReadOnly: function()\n    {\n        var $editor = this.editor.getElement();\n\n        this._getEditables($editor).removeAttr('contenteditable');\n        $editor.removeAttr('contenteditable');\n        $editor.addClass('redactor-read-only');\n\n        if (this.events) this.events.destroy();\n    },\n    _disableReadOnly: function()\n    {\n        var $editor = this.editor.getElement();\n\n        this._getEditables($editor).attr({ 'contenteditable': true });\n        $editor.removeClass('redactor-read-only');\n        $editor.attr({ 'contenteditable': true });\n\n        this._buildEvents();\n    },\n    _getEditables: function($editor)\n    {\n        return $editor.find('figcaption, td, th');\n    }\n});\n$R.add('class', 'editor.placeholder', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.editor = app.editor;\n        this.element = app.element;\n\n        // build\n        this.build();\n    },\n    build: function()\n    {\n        var $element = this.element.getElement();\n        var $editor = this.editor.getElement();\n\n        if (this.opts.placeholder !== false || $element.attr('placeholder'))\n        {\n            var text = (this.opts.placeholder !== false) ? this.opts.placeholder : $element.attr('placeholder');\n            $editor.attr('placeholder', text);\n            this.toggle();\n        }\n    },\n    toggle: function()\n    {\n        return (this.editor.isEmpty(true)) ? this.show() : this.hide();\n    },\n    show: function()\n    {\n        var $editor = this.editor.getElement();\n        $editor.addClass('redactor-placeholder');\n    },\n    hide: function()\n    {\n        var $editor = this.editor.getElement();\n        $editor.removeClass('redactor-placeholder');\n    }\n});\n$R.add('class', 'editor.events', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.$doc = app.$doc;\n        this.uuid = app.uuid;\n        this.source = app.source;\n        this.editor = app.editor;\n        this.cleaner = app.cleaner;\n        this.container = app.container;\n        this.insertion = app.insertion;\n        this.inspector = app.inspector;\n        this.selection = app.selection;\n        this.component = app.component;\n\n        // local\n        this.blurNamespace = '.redactor-blur.' + this.uuid;\n        this.eventsList = ['paste', 'click', 'contextmenu', 'keydown', 'keyup', 'mouseup', 'touchstart',\n                           'cut', 'copy', 'dragenter', 'dragstart', 'drop', 'dragover', 'dragleave'];\n\n        // init\n        this._init();\n    },\n    destroy: function()\n    {\n        var $editor = this.editor.getElement();\n\n        $editor.off('.redactor-focus');\n        this.$doc.off('keyup' + this.blurNamespace + ' mousedown' + this.blurNamespace);\n\n        // all events\n        this._loop('off');\n    },\n    focus: function(e)\n    {\n        var $container = this.container.getElement();\n\n        if (this.editor.isPasting() || $container.hasClass('redactor-focus')) return;\n\n        $container.addClass('redactor-focus');\n        $container.removeClass('redactor-blur');\n\n        this.app.broadcast('observe', e);\n        this.app.broadcast('focus', e);\n\n        this.isFocused = true;\n        this.isBlured = false;\n    },\n    blur: function(e)\n    {\n        var $container = this.container.getElement();\n        var $target = $R.dom(e.target);\n        var targets = ['.redactor-in-' + this.uuid,  '.redactor-toolbar', '.redactor-dropdown',\n        '.redactor-context-toolbar', '.redactor-modal-box', '#redactor-image-resizer'];\n\n        this.app.broadcast('originalblur', e);\n        if (this.app.stopBlur) return;\n\n        if (!this.app.isStarted() || this.editor.isPasting()) return;\n        if ($target.closest(targets.join(',')).length !== 0) return;\n\n        if (!this.isBlured && !$container.hasClass('redactor-blur'))\n        {\n            $container.removeClass('redactor-focus');\n            $container.addClass('redactor-blur');\n            this.app.broadcast('blur', e);\n\n            this.isFocused = false;\n            this.isBlured = true;\n        }\n    },\n    cut: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n\n        this.app.broadcast('state', e);\n\n        if (this.component.isNonEditable(current))\n        {\n            this._passSelectionToClipboard(e, data, true);\n            e.preventDefault();\n        }\n    },\n    copy: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n\n        this.app.broadcast('state', e);\n\n        if (this.component.isNonEditable(current))\n        {\n            this._passSelectionToClipboard(e, data, false);\n            e.preventDefault();\n        }\n    },\n    drop: function(e)\n    {\n        e = e.originalEvent || e;\n        e.stopPropagation();\n        this._removeOverClass();\n\n        if (this.opts.dragUpload === false)\n        {\n            e.preventDefault();\n            return;\n        }\n\n\n        if (this.app.isDragComponentInside())\n        {\n            var $dragComponent = $R.dom(this.app.getDragComponentInside());\n            var $component = $dragComponent.clone(true);\n            this.insertion.insertToPoint(e, $component);\n\n            $dragComponent.remove();\n\n            this.app.setDragComponentInside(false);\n            this.app.broadcast('state', e);\n            this.app.broadcast('drop', e);\n            this.app.broadcast('image.observe', e);\n\n            e.preventDefault();\n\n            return;\n        }\n        else if (this.app.isDragInside() && this.opts.input)\n        {\n            this.insertion.insertPoint(e);\n\n            var dt = e.dataTransfer;\n            var html = dt.getData('text/html');\n\n            // clear selected\n            var range = this.selection.getRange();\n            if (range)\n            {\n                var blocks = this.selection.getBlocks();\n                range.deleteContents();\n\n                // remove empty blocks\n                for (var i = 0; i < blocks.length; i++)\n                {\n                    if (blocks[i].innerHTML === '') $R.dom(blocks[i]).remove();\n                }\n            }\n\n            // paste\n            $R.create('input.paste', this.app, e, true, html, true);\n\n            this.app.broadcast('state', e);\n            this.app.broadcast('drop', e);\n\n            this.app.setDragInside(false);\n            e.preventDefault();\n\n            return;\n        }\n\n        this.app.broadcast('state', e);\n        this.app.broadcast('paste', e, e.dataTransfer);\n        this.app.broadcast('drop', e);\n\n    },\n    dragenter: function(e)\n    {\n        e.preventDefault();\n    },\n    dragstart: function(e)\n    {\n        this.app.setDragComponentInside(false);\n        this.app.setDragInside(false);\n\n        var data = this.inspector.parse(e.target);\n        if (data.isComponent() && !data.isComponentEditable() && !data.isFigcaption())\n        {\n            this.app.setDragComponentInside(data.getComponent());\n        }\n        else if (this.selection.is() && !this.selection.isCollapsed())\n        {\n            // drag starts inside editor\n            this.app.setDragInside(true);\n            this._setDragData(e);\n        }\n\n        this.app.broadcast('dragstart', e);\n    },\n    dragover: function(e)\n    {\n        this.app.broadcast('dragover', e);\n    },\n    dragleave: function(e)\n    {\n        this.app.broadcast('dragleave', e);\n    },\n    paste: function(e)\n    {\n        this.app.broadcast('paste', e);\n    },\n    contextmenu: function(e)\n    {\n        // chrome crashes fix\n        //this.editor.disableNonEditables();\n\n        //setTimeout(function()\n        //{\n          //  this.editor.enableNonEditables();\n           // this.app.broadcast('contextmenu', e);\n\n        //}.bind(this), 0);\n    },\n    click: function(e)\n    {\n        // triple click selection\n        if (e.detail === 3)\n        {\n            e.preventDefault();\n\n            var block = this.selection.getBlock();\n            if (block) {\n                var range = document.createRange();\n                range.selectNodeContents(block);\n                this.selection.setRange(range)\n            }\n        }\n\n        // observe bottom click & start click & outside click\n        var $target = $R.dom(e.target);\n        if ($target.hasClass('redactor-in'))\n        {\n            var top = $target.offset().top;\n            var pad = parseFloat($target.css('padding-bottom'));\n            var height = $target.height();\n            var posHeight = top + height - pad*2;\n\n            if (posHeight < e.pageY)\n            {\n                this.app.broadcast('bottomclick', e);\n            }\n            else if ($target.hasClass('redactor-placeholder')) {\n                this.editor.startFocus(this.editor);\n            }\n        }\n\n        this.app.broadcast('state', e);\n        this.app.broadcast('click', e);\n    },\n    keydown: function(e)\n    {\n        this.app.broadcast('state', e);\n        var stop = this.app.broadcast('keydown', e);\n        if (stop === false)\n        {\n            return e.preventDefault();\n        }\n    },\n    keyup: function(e)\n    {\n        this.app.broadcast('keyup', e);\n    },\n    mouseup: function(e)\n    {\n        this.app.broadcast('observe', e);\n        this.app.broadcast('state', e);\n    },\n    touchstart: function(e)\n    {\n        this.app.broadcast('observe', e);\n        this.app.broadcast('state', e);\n    },\n\n    // private\n    _init: function()\n    {\n        var $editor = this.editor.getElement();\n\n        $editor.on('focus.redactor-focus click.redactor-focus', this.focus.bind(this));\n        this.$doc.on('keyup' + this.blurNamespace + ' mousedown' + this.blurNamespace, this.blur.bind(this));\n\n        // all events\n        this._loop('on');\n    },\n    _removeOverClass: function()\n    {\n        var $editor = this.editor.getElement();\n        $editor.removeClass('over');\n    },\n    _loop: function(func)\n    {\n        var $editor = this.editor.getElement();\n        for (var i = 0; i < this.eventsList.length; i++)\n        {\n            var event = this.eventsList[i] + '.redactor-events';\n            var method = this.eventsList[i];\n\n            $editor[func](event, this[method].bind(this));\n        }\n    },\n    _passAllToClipboard: function(e)\n    {\n        var clipboard = e.clipboardData;\n        var content = this.source.getCode();\n\n        clipboard.setData('text/html', content);\n        clipboard.setData('text/plain', content.toString().replace(/\\n$/, \"\"));\n    },\n    _passSelectionToClipboard: function(e, data, remove)\n    {\n        var clipboard = e.clipboardData;\n        var node = data.getComponent();\n        var $node = $R.dom(node);\n        var $cloned = $node.clone();\n\n        // clean\n        $cloned.find('.redactor-component-caret').remove();\n        $cloned.removeClass('redactor-component-active');\n        $cloned.removeAttr('contenteditable');\n        $cloned.removeAttr('tabindex');\n\n        // html\n        var content = $cloned.get().outerHTML;\n\n        if (remove) this.component.remove(node);\n\n        clipboard.setData('text/html', content);\n        clipboard.setData('text/plain', content.toString().replace(/\\n$/, \"\"));\n    },\n    _setDragData: function(e)\n    {\n        e = e.originalEvent || e;\n\n        var dt = e.dataTransfer;\n        dt.effectAllowed = 'move';\n        dt.setData('text/Html', this.selection.getHtml());\n    }\n});\n$R.add('module', 'container', {\n    init: function(app)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.opts = app.opts;\n        this.lang = app.lang;\n        this.element = app.element;\n        this.container = app.container;\n    },\n    // public\n    start: function()\n    {\n        this._build();\n        this._buildAccesibility();\n    },\n    stop: function()\n    {\n        var $element = this.element.getElement();\n        var $container = this.container.getElement();\n\n        $container.after($element);\n        $container.remove();\n        $element.show();\n    },\n\n    // private\n    _build: function()\n    {\n        var $element = this.element.getElement();\n        var $container = this.container.getElement();\n\n        $container.addClass('redactor-box');\n        $container.attr('dir', this.opts.direction);\n\n        if (this.element.isType('inline')) $container.addClass('redactor-inline');\n\n        $element.after($container);\n        $container.append($element);\n    },\n    _buildAccesibility: function()\n    {\n        var $container = this.container.getElement();\n        var $label = $R.dom('<span />');\n\n        $label.addClass('redactor-voice-label');\n        $label.attr({ 'id': 'redactor-voice-' + this.uuid, 'aria-hidden': false });\n        $label.html(this.lang.get('accessibility-help-label'));\n\n        $container.prepend($label);\n    }\n});\n$R.add('module', 'source', {\n    init: function(app)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.element = app.element;\n        this.source = app.source;\n        this.editor = app.editor;\n        this.toolbar = app.toolbar;\n        this.cleaner = app.cleaner;\n        this.component = app.component;\n        this.container = app.container;\n        this.autoparser = app.autoparser;\n        this.selection = app.selection;\n\n        // local\n        this.syncedHtml = '';\n    },\n    // messages\n    onstartcode: function()\n    {\n        var sourceContent = this.source.getStartedContent();\n        var $editor = this.editor.getElement();\n        var $source = this.source.getElement();\n\n        // autoparse\n        if (this.opts.autoparse && this.opts.autoparseStart)\n        {\n            sourceContent = this.autoparser.parse(sourceContent);\n        }\n\n        // started content\n        var startContent = this.cleaner.input(sourceContent, true, true);\n        var syncContent = this.cleaner.output(startContent);\n\n        // set content\n        $editor.html(startContent);\n        $source.val(syncContent);\n\n        this.syncedHtml = syncContent;\n        this.app.broadcast('placeholder.build');\n        this.app.broadcast('autoparseobserve');\n\n        // widget's scripts\n        this.component.executeScripts();\n    },\n    onstartcodeshow: function()\n    {\n        this.show();\n    },\n    ontrytosync: function()\n    {\n        this.sync();\n    },\n    onhardsync: function()\n    {\n        var $editor = this.editor.getElement();\n        var html = $editor.html();\n\n        html = this.app.broadcast('syncBefore', html);\n        html = this.cleaner.output(html);\n\n        this._syncing(html);\n    },\n\n    // public\n    start: function()\n    {\n        this._build();\n        this._buildClasses();\n    },\n    stop: function()\n    {\n        var $element = this.element.getElement();\n        var $source = this.source.getElement();\n\n        $element.removeClass('redactor-source redactor-source-open');\n        $source.off('input.redactor-source');\n        $source.removeAttr('data-gramm_editor');\n\n        if ($source.get().classList.length === 0) $source.removeAttr('class');\n        if (!this.source.isNameGenerated()) $element.removeAttr('name');\n        if (!this.element.isType('textarea')) $source.remove();\n\n    },\n    getCode: function()\n    {\n        return this.source.getCode();\n    },\n\n    // public\n    toggle: function()\n    {\n        if (!this.opts.source) return;\n\n        var $source = this.source.getElement();\n\n        return ($source.hasClass('redactor-source-open')) ? this.hide() : this.show();\n    },\n    show: function()\n    {\n        if (!this.opts.source) return;\n\n        var $editor = this.editor.getElement();\n        var $source = this.source.getElement();\n        var $container = this.container.getElement();\n\n        var html = $source.val();\n\n        if (this.app.isStarted()) html = this.app.broadcast('source.open', html);\n\n        // get height\n        var editorHeight = $editor.height();\n\n        $editor.hide();\n        $source.height(editorHeight);\n        $source.val(html.trim());\n        $source.show();\n        $source.addClass('redactor-source-open');\n        $source.on('input.redactor-source-events', this._onChangedSource.bind(this));\n        $source.on('keydown.redactor-source-events', this._onTabKey.bind(this));\n        $source.on('focus.redactor-source-events', this._onFocus.bind(this));\n\n        if (this.opts.source.hasOwnProperty('codemirror')) {\n            var opts = (typeof this.opts.source.codemirror === 'object') ? this.opts.source.codemirror : {};\n            var codemirrorSrc = (typeof this.opts.source.codemirrorSrc !== 'undefined') ? this.opts.source.codemirrorSrc : CodeMirror;\n            this.codemirror = codemirrorSrc.fromTextArea($source.get(), opts);\n            this.codemirror.setSize(null, editorHeight);\n            this.codemirror.on('change', function(cm, changeObj){ cm.save() });\n            this.codemirror.on('change', this._onChangedSource.bind(this));\n        }\n        else {\n            $container.addClass('redactor-source-view');\n        }\n\n        // buttons\n        setTimeout(function()\n        {\n            this._disableButtons();\n            this._setActiveSourceButton();\n\n        }.bind(this), 100);\n\n        if (this.app.isStarted()) this.app.broadcast('source.opened');\n    },\n    hide: function()\n    {\n        if (!this.opts.source) return;\n\n        var $editor = this.editor.getElement();\n        var $source = this.source.getElement();\n        var $container = this.container.getElement();\n\n        var html = $source.val();\n        if (this.opts.source.hasOwnProperty('codemirror')) {\n            html = this.codemirror.getValue();\n            this.codemirror.toTextArea();\n        }\n\n\n        // clean\n        html = this.cleaner.input(html, true);\n        html = (this.utils.isEmptyHtml(html)) ? this.opts.emptyHtml : html;\n        html = this.app.broadcast('source.close', html);\n\n        // buttons\n        this._enableButtons();\n        this._setInactiveSourceButton();\n\n        $source.hide();\n        $source.removeClass('redactor-source-open');\n        $source.off('.redactor-source-events');\n        $editor.show();\n        $editor.html(html);\n\n        $container.removeClass('redactor-source-view');\n\n        setTimeout(function()\n        {\n            this.editor.startFocus();\n\n            // widget's scripts\n            this.component.executeScripts();\n\n        }.bind(this), 0);\n\n        this.app.broadcast('source.closed');\n    },\n    sync: function()\n    {\n        var self = this;\n        var $editor = this.editor.getElement();\n        var html = $editor.html();\n\n        html = this.app.broadcast('syncBefore', html);\n        html = this.cleaner.output(html);\n\n        if (this._isSync(html))\n        {\n            if (this.timeout) clearTimeout(this.timeout);\n            this.timeout = setTimeout(function() { self._syncing(html); }, 200);\n        }\n    },\n\n    // private\n    _build: function()\n    {\n        var $source = this.source.getElement();\n        var $element = this.element.getElement();\n\n        $source.hide();\n\n        if (!this.opts.grammarly)\n        {\n            $source.attr('data-gramm_editor', false);\n        }\n\n        if (!this.element.isType('textarea'))\n        {\n            $element.after($source);\n        }\n    },\n    _buildClasses: function()\n    {\n        var $source = this.source.getElement();\n\n        $source.addClass('redactor-source');\n    },\n    _syncing: function(html)\n    {\n        html = this.app.broadcast('syncing', html);\n\n        var $source = this.source.getElement();\n        $source.val(html);\n\n        this.app.broadcast('synced', html);\n        this.app.broadcast('changed', html);\n    },\n    _isSync: function(html)\n    {\n        if (this.syncedHtml !== html)\n        {\n            this.syncedHtml = html;\n            return true;\n        }\n\n        return false;\n    },\n    _onChangedSource: function()\n    {\n        var $source = this.source.getElement();\n        var html = $source.val();\n\n        this.app.broadcast('changed', html);\n        this.app.broadcast('source.changed', html);\n    },\n    _onTabKey: function(e)\n    {\n        if (e.keyCode !== 9) return true;\n\n        e.preventDefault();\n\n        var $source = this.source.getElement();\n        var el = $source.get();\n        var start = el.selectionStart;\n\n        $source.val($source.val().substring(0, start) + \"    \" + $source.val().substring(el.selectionEnd));\n        el.selectionStart = el.selectionEnd = start + 4;\n    },\n    _onFocus: function()\n    {\n        this.app.broadcast('sourcefocus');\n    },\n    _disableButtons: function()\n    {\n        this.toolbar.disableButtons();\n    },\n    _enableButtons: function()\n    {\n        this.toolbar.enableButtons();\n    },\n    _setActiveSourceButton: function()\n    {\n        var $btn = this.toolbar.getButton('html');\n        $btn.enable();\n        $btn.setActive();\n    },\n    _setInactiveSourceButton: function()\n    {\n        var $btn = this.toolbar.getButton('html');\n        $btn.setInactive();\n    }\n});\n$R.add('module', 'observer', {\n    init: function(app)\n    {\n        this.app = app;\n        this.editor = app.editor;\n\n        // local\n        this.observerUnit = false;\n    },\n    // public\n    start: function()\n    {\n        if (window.MutationObserver)\n        {\n            var $editor = this.editor.getElement();\n            var el = $editor.get();\n            this.observerUnit = this._build(el);\n            this.observerUnit.observe(el, {\n                 attributes: true,\n                 subtree: true,\n                 childList: true,\n                 characterData: true,\n                 characterDataOldValue: true\n            });\n        }\n    },\n    stop: function()\n    {\n        if (this.observerUnit) this.observerUnit.disconnect();\n    },\n\n    // private\n    _build: function(el)\n    {\n        var self = this;\n        return new MutationObserver(function(mutations)\n        {\n            self._observe(mutations[mutations.length-1], el);\n        });\n    },\n    _observe: function(mutation, el)\n    {\n        if (this.app.isReadOnly() || (mutation.type === 'attributes' && mutation.target === el))\n        {\n            return;\n        }\n\n        this.app.broadcast('observe');\n        this.app.broadcast('trytosync');\n        this.app.broadcast('placeholder.toggle');\n    }\n});\n$R.add('module', 'clicktoedit', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.source = app.source;\n        this.editor = app.editor;\n        this.container = app.container;\n        this.selection = app.selection;\n    },\n    // messages\n    onstartclicktoedit: function()\n    {\n        this.start();\n    },\n    onenablereadonly: function()\n    {\n        if (!this.opts.clickToEdit) return;\n        if (!this._isEnabled()) this.stop();\n    },\n    ondisablereadonly: function()\n    {\n        if (!this.opts.clickToEdit) return;\n        if (!this._isEnabled()) this.start();\n    },\n    onstop: function()\n    {\n        this.stop();\n    },\n\n    // public\n    start: function()\n    {\n        this._build();\n    },\n    stop: function()\n    {\n        if (this.buttonSave) this.buttonSave.stop();\n        if (this.buttonCancel) this.buttonCancel.stop();\n\n        this._destroy();\n        this.app.broadcast('disable');\n    },\n    enable: function()\n    {\n        this.app.broadcast('clickStart');\n\n        var isEmpty = this.editor.isEmpty();\n        if (!isEmpty) this.selection.saveMarkers();\n\n        this._setFocus();\n        this._destroy();\n        this.app.broadcast('enable');\n        this.buttonSave.enable();\n        this.buttonCancel.enable();\n\n        if (!isEmpty) this.selection.restoreMarkers();\n        if (isEmpty) this.editor.focus();\n\n        var $container = this.container.getElement();\n        $container.addClass('redactor-clicktoedit-enabled');\n\n        this.source.rebuildStartedContent();\n\n        this.app.broadcast('startcode');\n        this.app.broadcast('image.observe');\n    },\n    save: function(e)\n    {\n        if (e) e.preventDefault();\n\n        var html = this.source.getCode();\n\n        this.app.broadcast('disable');\n        this.app.broadcast('clickSave', html);\n        this.app.broadcast('clickStop');\n        this.app.broadcast('toolbar.removeexternal');\n        this._build();\n    },\n    cancel: function(e)\n    {\n        if (e) e.preventDefault();\n\n        var html = this.saved;\n        var $editor = this.editor.getElement();\n        $editor.html(html);\n\n        this.saved = '';\n\n        this.app.broadcast('disable');\n        this.app.broadcast('clickCancel', html);\n        this.app.broadcast('clickStop');\n        this.app.broadcast('toolbar.removeexternal');\n        this._build();\n    },\n\n    // private\n    _build: function()\n    {\n        // buttons\n        this.buttonSave = $R.create('clicktoedit.button', 'save', this.app, this);\n        this.buttonCancel = $R.create('clicktoedit.button', 'cancel', this.app, this);\n\n        this.buttonSave.stop();\n        this.buttonCancel.stop();\n\n        var $editor = this.editor.getElement();\n        var $container = this.container.getElement();\n\n        $editor.on('click.redactor-click-to-edit mouseup.redactor-click-to-edit', this.enable.bind(this));\n        $container.addClass('redactor-over');\n        $container.removeClass('redactor-clicktoedit-enabled');\n    },\n    _isEnabled: function()\n    {\n        return this.container.getElement().hasClass('redactor-clicktoedit-enabled');\n    },\n    _destroy: function()\n    {\n        var $editor = this.editor.getElement();\n        var $container = this.container.getElement();\n\n        $editor.off('.redactor-click-to-edit');\n        $container.removeClass('redactor-over redactor-clicktoedit-enabled');\n    },\n    _setFocus: function()\n    {\n        this.saved = this.source.getCode();\n\n        this.buttonSave.start();\n        this.buttonCancel.start();\n    }\n});\n$R.add('class', 'clicktoedit.button', {\n    init: function(type, app, context)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.toolbar = app.toolbar;\n        this.context = context;\n\n        // local\n        this.type = type;\n        this.name = (type === 'save') ? 'clickToSave' : 'clickToCancel';\n        this.objected = false;\n        this.enabled = false;\n        this.namespace = '.redactor-click-to-edit';\n\n        // build\n        this._build();\n    },\n    enable: function()\n    {\n        if (!this.objected) return;\n\n        var data = this.opts[this.name];\n        data.api = 'module.clicktoedit.' + this.type;\n\n        this.toolbar.addButton(this.type, data);\n        this.enabled = true;\n    },\n    start: function()\n    {\n        if (this.objected) return;\n\n        this.$button.off(this.namespace);\n        this.$button.show();\n        this.$button.on('click' + this.namespace, this.context[this.type].bind(this.context));\n    },\n    stop: function()\n    {\n        if (this.objected || !this.enabled) return;\n\n        this.$button.hide();\n    },\n\n    // private\n    _build: function()\n    {\n        this.objected = (typeof this.opts[this.name] === 'object');\n\n        if (!this.objected)\n        {\n            this.$button = $R.dom(this.opts[this.name]);\n            this.enabled = true;\n        }\n    }\n});\n$R.add('module', 'statusbar', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.element = app.element;\n        this.statusbar = app.statusbar;\n        this.container = app.container;\n    },\n    // public\n    start: function()\n    {\n        if (!this.element.isType('inline'))\n        {\n            var $statusbar = this.statusbar.getElement();\n            var $container = this.container.getElement();\n\n            $statusbar.addClass('redactor-statusbar');\n            $container.append($statusbar);\n        }\n    }\n});\n$R.add('module', 'contextbar', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.uuid = app.uuid;\n        this.$win = app.$win;\n        this.$doc = app.$doc;\n        this.$body = app.$body;\n        this.editor = app.editor;\n        this.toolbar = app.toolbar;\n        this.detector = app.detector;\n\n        // local\n        this.$target = (this.toolbar.isTarget()) ? this.toolbar.getTargetElement() : this.$body;\n    },\n    // messages\n    onstop: function() {\n        this.stop();\n    },\n    onenablereadonly: function()\n    {\n        this.stop();\n    },\n    ondisablereadonly: function()\n    {\n        this.start();\n    },\n    oncontextbar: {\n        close: function()\n        {\n            this.close();\n        }\n    },\n\n    // public\n    start: function()\n    {\n        if (this.opts.toolbarContext)\n        {\n            var $editor = this.editor.getElement();\n\n            this._build();\n            $editor.on('click.redactor-context mouseup.redactor-context', this.open.bind(this));\n\n            if (this.opts.scrollTarget)\n            {\n                $R.dom(this.opts.scrollTarget).on('scroll.redactor-context', this.close.bind(this));\n            }\n            else if (this.opts.maxHeight !== false)\n            {\n                $editor.on('scroll.redactor-context', this.close.bind(this));\n            }\n        }\n    },\n    stop: function()\n    {\n        var $editor = this.editor.getElement();\n        $editor.off('.redactor-context');\n\n        this.$doc.off('.redactor-context');\n        this.$win.off('.redactor-context');\n\n        if (this.$contextbar) this.$contextbar.remove();\n        if (this.opts.scrollTarget)\n        {\n            $R.dom(this.opts.scrollTarget).off('.redactor-context');\n        }\n    },\n    is: function()\n    {\n        return (this.$contextbar && this.$contextbar.hasClass('open'));\n    },\n    set: function(e, node, buttons, position)\n    {\n        this.$contextbar.html('');\n        this.$el = $R.dom(node);\n\n        // buttons\n        for (var key in buttons)\n        {\n            var $btn = $R.create('contextbar.button', this.app, buttons[key]);\n            if ($btn.html() !== '')\n            {\n                this.$contextbar.append($btn);\n            }\n        }\n\n        // show\n        var pos = this._buildPosition(e, this.$el, position);\n\n        this.$contextbar.css(pos);\n        this.$contextbar.show();\n        this.$contextbar.addClass('open');\n        this.$doc.on('click.redactor-context mouseup.redactor-context', this.close.bind(this));\n        this.$win.on('resize.redactor-context', this.close.bind(this));\n    },\n    open: function(e)\n    {\n        setTimeout(function()\n        {\n            this.app.broadcast('contextbar', e, this);\n        }.bind(this), 0);\n    },\n    close: function(e)\n    {\n        if (!this.$contextbar) return;\n        if (e)\n        {\n            var $target = $R.dom(e.target);\n            if (this.$el && $target.closest(this.$el).length !== 0)\n            {\n                return;\n            }\n        }\n\n        this.$contextbar.hide();\n        this.$contextbar.removeClass('open');\n        this.$doc.off('.redactor.context');\n    },\n\n    // private\n    _build: function()\n    {\n        this.$contextbar = $R.dom('<div>');\n        this.$contextbar.attr('id', 'redactor-context-toolbar-' + this.uuid);\n        this.$contextbar.attr('dir', this.opts.direction);\n        this.$contextbar.addClass('redactor-context-toolbar');\n        this.$contextbar.hide();\n\n        this.$target.append(this.$contextbar);\n    },\n    _buildPosition: function(e, $el, position)\n    {\n        var top, left;\n        var isTarget = this.toolbar.isTarget();\n        var offset = (isTarget) ? $el.position() : $el.offset();\n\n        var width = $el.width();\n        var height = $el.height();\n\n        var barWidth = this.$contextbar.width();\n        var barHeight = this.$contextbar.height();\n        var docScrollTop = (isTarget) ? (this.$target.scrollTop() + this.$doc.scrollTop()) : this.$doc.scrollTop();\n\n        var targetOffset = this.$target.offset();\n        var leftFix = (isTarget) ? targetOffset.left : 0;\n        var topFix = (isTarget) ? targetOffset.top : 0;\n\n        if (!position)\n        {\n            top = (e.clientY + docScrollTop - barHeight);\n            left = (e.clientX - barWidth/2);\n        }\n        else if (position === 'top')\n        {\n            top = (offset.top - barHeight);\n            left = (offset.left + width/2 - barWidth/2);\n        }\n        else if (position === 'bottom')\n        {\n            top = (offset.top + height);\n            left = (offset.left + width/2 - barWidth/2);\n        }\n\n        if (left < 0) left = 0;\n\n        return { top: (top - topFix) + 'px', left: (left - leftFix) + 'px' };\n    }\n});\n$R.add('class', 'contextbar.button', {\n    mixins: ['dom'],\n    init: function(app, obj)\n    {\n        this.app = app;\n\n        // local\n        this.obj = obj;\n\n        // init\n        this._init();\n    },\n    // private\n    _init: function()\n    {\n        this.parse('<a>');\n\n        if (typeof this.obj.title !== 'string')\n        {\n            var url = this.obj.title.attr('href');\n            this.attr('href', url);\n\n            if (url.search(/^#/) === -1) {\n                this.attr('target', '_blank');\n            }\n\n            this.text(this.obj.html || url);\n        }\n        else\n        {\n            this.attr('href', '#');\n\n            this._buildTitle();\n            this._buildMessage();\n        }\n    },\n    _buildTitle: function()\n    {\n        this.html(this.obj.title);\n    },\n    _buildMessage: function()\n    {\n        if (typeof this.obj.message !== 'undefined' || typeof this.obj.api !== 'undefined')\n        {\n            this.on('click', this._toggle.bind(this));\n        }\n    },\n    _toggle: function(e)\n    {\n        e.preventDefault();\n\n        if (this.obj.message)\n        {\n            this.app.broadcast(this.obj.message, this.obj.args);\n        }\n        else if (this.obj.api)\n        {\n            this.app.api(this.obj.api, this.obj.args);\n        }\n    }\n});\n$R.add('module', 'toolbar', {\n    init: function(app)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.toolbar = app.toolbar;\n        this.detector = app.detector;\n\n        // local\n        this.buttons = [];\n        this.toolbarModule = false;\n    },\n    // messages\n    onsource: {\n        open: function()\n        {\n            if (!this.toolbar.isAir() && this.toolbar.isFixed())\n            {\n                this.toolbarModule.resetPosition();\n            }\n        },\n        opened: function()\n        {\n            if (this.toolbar.isAir() && this.toolbarModule)\n            {\n                this.toolbarModule.createSourceHelper();\n            }\n\n            // hide tooltips\n            setTimeout(function()\n            {\n                $R.dom('.re-button-tooltip-' + this.uuid).remove();\n            }.bind(this), 100)\n\n        },\n        close: function()\n        {\n            if (this.toolbar.isAir() && this.toolbarModule)\n            {\n                this.toolbarModule.destroySourceHelper();\n            }\n        },\n        closed: function()\n        {\n            if (this.toolbar.is() && this.opts.air)\n            {\n                this.toolbarModule.openSelected();\n            }\n        }\n    },\n    ontoolbar: {\n        removeexternal: function() {\n            if (!this.opts.air && this.opts.toolbarExternal && this.opts.clickToEdit) {\n                $R.dom(this.opts.toolbarExternal).html('');\n            }\n        }\n    },\n    onobserve: function()\n    {\n        if (this.toolbar.is())\n        {\n            this.toolbar.observe();\n        }\n    },\n    onfocus: function()\n    {\n        this._setExternalOnFocus();\n    },\n    onsourcefocus: function()\n    {\n        this._setExternalOnFocus();\n    },\n    onempty: function()\n    {\n        if (this.toolbar.isFixed())\n        {\n            this.toolbarModule.resetPosition();\n        }\n    },\n    onenablereadonly: function()\n    {\n        if (this.toolbar.isAir())\n        {\n            this.toolbarModule.close();\n        }\n    },\n\n    // public\n    start: function()\n    {\n        if (this.toolbar.is())\n        {\n            this._buildButtons();\n            this._initToolbar();\n            this._initButtons();\n        }\n    },\n    stop: function()\n    {\n        if (this.toolbarModule)\n        {\n            this.toolbarModule.stop();\n        }\n\n        // stop dropdowns & tooltips\n        $R.dom('.re-button-tooltip-' + this.uuid).remove();\n        $R.dom('.redactor-dropdown-' + this.uuid).remove();\n    },\n\n    // private\n    _buildButtons: function()\n    {\n        this.buttons = this.opts.buttons.concat();\n\n        this._buildImageButton();\n        this._buildFileButton();\n        this._buildSourceButton();\n        this._buildAdditionalButtons();\n        this._buildHiddenButtons();\n    },\n    _buildImageButton: function()\n    {\n        if (!this.opts.imageUpload && !this.opts.imageManagerJson) this.utils.removeFromArrayByValue(this.buttons, 'image');\n    },\n    _buildFileButton: function()\n    {\n        if (!this.opts.fileUpload) this.utils.removeFromArrayByValue(this.buttons, 'file');\n    },\n    _buildSourceButton: function()\n    {\n        if (!this.opts.source) this.utils.removeFromArrayByValue(this.buttons, 'html');\n    },\n    _buildAdditionalButtons: function()\n    {\n        // end\n        if (this.opts.buttonsAdd.length !== 0)\n        {\n            this.opts.buttonsAdd = this._removeExistButtons(this.opts.buttonsAdd);\n            this.buttons = this.buttons.concat(this.opts.buttonsAdd);\n        }\n\n        // beginning\n        if (this.opts.buttonsAddFirst.length !== 0)\n        {\n            this.opts.buttonsAddFirst = this._removeExistButtons(this.opts.buttonsAddFirst);\n            this.buttons.unshift(this.opts.buttonsAddFirst);\n        }\n\n        var index, btns;\n\n        // after\n        if (this.opts.buttonsAddAfter !== false)\n        {\n            index = this.buttons.indexOf(this.opts.buttonsAddAfter.after) + 1;\n            btns = this.opts.buttonsAddAfter.buttons;\n            for (var i = 0; i < btns.length; i++)\n            {\n                this.buttons.splice(index+i, 0, btns[i]);\n            }\n        }\n\n        // before\n        if (this.opts.buttonsAddBefore !== false)\n        {\n            index = this.buttons.indexOf(this.opts.buttonsAddBefore.before)+1;\n            btns = this.opts.buttonsAddBefore.buttons;\n            for (var i = 0; i < btns.length; i++)\n            {\n                this.buttons.splice(index-(1-i), 0, btns[i]);\n            }\n        }\n    },\n    _buildHiddenButtons: function()\n    {\n        if (this.opts.buttonsHide.length !== 0) {\n            var buttons = this.opts.buttonsHide;\n            for (var i = 0; i < buttons.length; i++) {\n                this.utils.removeFromArrayByValue(this.buttons, buttons[i]);\n            }\n        }\n\n        if (this.detector.isMobile() && this.opts.buttonsHideOnMobile.length !== 0) {\n            var buttons = this.opts.buttonsHideOnMobile;\n            for (var i = 0; i < buttons.length; i++) {\n                this.utils.removeFromArrayByValue(this.buttons, buttons[i]);\n            }\n        }\n    },\n    _removeExistButtons: function(buttons)\n    {\n        for (var i = 0; i < buttons.length; i++)\n        {\n            if (this.opts.buttons.indexOf(buttons[i]) !== -1)\n            {\n                this.utils.removeFromArrayByValue(buttons, buttons[i]);\n            }\n        }\n\n        return buttons;\n    },\n    _setExternalOnFocus: function()\n    {\n        if (!this.opts.air && this.opts.toolbarExternal)\n        {\n            this.toolbarModule.setExternal();\n        }\n    },\n    _initToolbar: function()\n    {\n        this.toolbarModule = (this.opts.air) ? $R.create('toolbar.air', this.app) : $R.create('toolbar.standard', this.app);\n    },\n    _initButtons: function()\n    {\n        this.toolbar.setButtons(this.buttons);\n\n        for (var i = 0; i < this.buttons.length; i++)\n        {\n            var name = this.buttons[i];\n            if ($R.buttons[name])\n            {\n                this.toolbar.addButton(name, $R.extend(true, {}, $R.buttons[name]), false, false, true);\n            }\n        }\n    }\n});\n$R.add('class', 'toolbar.air', {\n    init: function(app)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.$doc = app.$doc;\n        this.$win = app.$win;\n        this.utils = app.utils;\n        this.editor = app.editor;\n        this.animate = app.animate;\n        this.toolbar = app.toolbar;\n        this.container = app.container;\n        this.inspector = app.inspector;\n        this.selection = app.selection;\n\n        // local\n        this.clicks = 0;\n\n        // init\n        this._init();\n    },\n    // public\n    stop: function()\n    {\n        var $wrapper = this.toolbar.getWrapper();\n        $wrapper.remove();\n\n        var $editor = this.editor.getElement();\n        $editor.off('.redactor-air-trigger-' + this.uuid);\n\n        this.$doc.off('.redactor-air-' + this.uuid);\n        this.$doc.off('.redactor-air-trigger-' + this.uuid);\n\n        this.toolbar.stopObservers();\n    },\n    createSourceHelper: function()\n    {\n        this.$airHelper = $R.dom('<span>');\n        this.$airHelper.addClass('redactor-air-helper');\n        this.$airHelper.html('<i class=\"re-icon-html\"></i>');\n        this.$airHelper.on('click', function(e)\n        {\n            e.preventDefault();\n            this.app.api('module.source.hide');\n\n        }.bind(this));\n\n        var $container = this.container.getElement();\n        $container.append(this.$airHelper);\n    },\n    destroySourceHelper: function()\n    {\n        if (this.$airHelper) this.$airHelper.remove();\n    },\n    openSelected: function()\n    {\n        setTimeout(function()\n        {\n            if (this._isSelection()) this._open(false);\n\n        }.bind(this), 0);\n    },\n    close: function()\n    {\n        this.$doc.off('.redactor-air-' + this.uuid);\n\n        var $toolbar = this.toolbar.getElement();\n        $toolbar.removeClass('open');\n        $toolbar.hide();\n    },\n\n    // private\n    _init: function()\n    {\n        this.toolbar.create();\n\n        var $wrapper = this.toolbar.getWrapper();\n        var $toolbar = this.toolbar.getElement();\n        var $editor = this.editor.getElement();\n        var $container = this.container.getElement();\n\n        $wrapper.addClass('redactor-toolbar-wrapper-air');\n        $toolbar.addClass('redactor-air');\n        //$toolbar.addClass('redactor-animate-hide');\n        $toolbar.hide();\n\n        $wrapper.append($toolbar);\n        $container.prepend($wrapper);\n\n        // open selected\n        this.openSelected();\n\n        // events\n        this.$doc.on('mouseup.redactor-air-trigger-' + this.uuid, this._open.bind(this));\n        $editor.on('keyup.redactor-air-trigger-' + this.uuid, this._openCmd.bind(this));\n    },\n    _isSelection: function()\n    {\n        return (this.selection.is() && !this.selection.isCollapsed());\n    },\n    _isOpened: function()\n    {\n        var $toolbar = this.toolbar.getElement();\n\n        return $toolbar.hasClass('open');\n    },\n    _open: function(e)\n    {\n        var target = (e) ? e.target : false;\n        var $el = (e) ? $R.dom(e.target) : false;\n        var dataTarget = this.inspector.parse(target);\n        var isComponent = (dataTarget.isComponent() && !dataTarget.isComponentType('table'));\n        var isFigcaption = (dataTarget.isFigcaption());\n        var isModalTarget = ($el && $el.closest('.redactor-modal').length !== 0);\n        var isButtonCall = (e && $el.closest('.re-button').length !== 0);\n        var isDropdownCall = (e && $el.closest('.redactor-dropdown').length !== 0);\n\n        if (isDropdownCall || isButtonCall || isModalTarget || isFigcaption || isComponent || this.toolbar.isContextBar() || !this._isSelection())\n        {\n            return;\n        }\n\n        var pos = this.selection.getPosition();\n\n        setTimeout(function()\n        {\n            if (this.app.isReadOnly()) return;\n            if (this._isSelection()) this._doOpen(pos);\n\n        }.bind(this), 1);\n\n    },\n    _openCmd: function()\n    {\n        if (this.selection.isAll())\n        {\n            var $toolbar = this.toolbar.getElement();\n            var pos = this.selection.getPosition();\n\n            pos.top = (pos.top < 20) ? 0 : pos.top - $toolbar.height();\n            pos.height = 0;\n\n            this._doOpen(pos);\n        }\n    },\n    _doOpen: function(pos)\n    {\n        var $wrapper = this.toolbar.getWrapper();\n        var $toolbar = this.toolbar.getElement();\n        var $container = this.container.getElement();\n        var containerOffset = $container.offset();\n        var leftFix = 0;\n        var winWidth = this.$win.width();\n        var toolbarWidth = $toolbar.width();\n\n        if (winWidth < (pos.left + toolbarWidth))\n        {\n            var selPos = this.selection.getPosition();\n            leftFix = toolbarWidth - selPos.width;\n        }\n\n        $wrapper.css({\n            left: (pos.left - containerOffset.left - leftFix) + 'px',\n            top: (pos.top - containerOffset.top + pos.height + this.$doc.scrollTop()) + 'px'\n        });\n\n        this.app.broadcast('airOpen');\n        $toolbar.addClass('open');\n        $toolbar.show();\n\n        this.$doc.on('click.redactor-air-' + this.uuid, this._close.bind(this));\n        this.$doc.on('keydown.redactor-air-' + this.uuid, this._close.bind(this));\n        this.app.broadcast('airOpened');\n    },\n    _close: function(e)\n    {\n        var $el = (e) ? $R.dom(e.target) : false;\n        var isDropdownCall = (e && $el.closest('[data-dropdown], .redactor-dropdown-not-close').length !== 0);\n        var isButtonCall = (!isDropdownCall && e && $el.closest('.re-button').length !== 0);\n\n        if (!isButtonCall && (isDropdownCall || !this._isOpened()))\n        {\n            return;\n        }\n\n        // close\n        this.app.broadcast('airClose');\n\n        this.close();\n        this.app.broadcast('airClosed');\n    }\n});\n$R.add('class', 'toolbar.fixed', {\n    init: function(app)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.opts = app.opts;\n        this.$doc = app.$doc;\n        this.$win = app.$win;\n        this.editor = app.editor;\n        this.toolbar = app.toolbar;\n        this.detector = app.detector;\n        this.container = app.container;\n\n        // init\n        this._init();\n    },\n    // public\n    stop: function()\n    {\n        this.$fixedTarget.off('.redactor-toolbar-' + this.uuid);\n        this.$win.off('.redactor-toolbar-' + this.uuid);\n    },\n    reset: function()\n    {\n        var $toolbar = this.toolbar.getElement();\n        var $wrapper = this.toolbar.getWrapper();\n\n        $wrapper.css('height', '');\n        $toolbar.removeClass('redactor-toolbar-fixed');\n        $toolbar.css({ position: '', top: '', left: '', width: '' });\n\n        var dropdown = this.toolbar.getDropdown();\n        if (dropdown) dropdown.updatePosition();\n    },\n\n    // private\n    _init: function()\n    {\n        this.$fixedTarget = (this.toolbar.isTarget()) ? this.toolbar.getTargetElement() : this.$win;\n        this._doFixed();\n\n        if (this.toolbar.isTarget())\n        {\n            this.$win.on('scroll.redactor-toolbar-' + this.uuid, this._doFixed.bind(this));\n            this.$win.on('resize.redactor-toolbar-' + this.uuid, this._doFixed.bind(this));\n        }\n\n        this.$fixedTarget.on('scroll.redactor-toolbar-' + this.uuid, this._doFixed.bind(this));\n        this.$fixedTarget.on('resize.redactor-toolbar-' + this.uuid, this._doFixed.bind(this));\n    },\n    _doFixed: function()\n    {\n        var $editor = this.editor.getElement();\n        var $container = this.container.getElement();\n        var $toolbar = this.toolbar.getElement();\n        var $wrapper = this.toolbar.getWrapper();\n\n        if (this.editor.isSourceMode())\n        {\n            return;\n        }\n\n        var $targets = $container.parents().filter(function(node)\n        {\n            return (getComputedStyle(node, null).display === 'none') ? node : false;\n        });\n\n        // has hidden parent\n        if ($targets.length !== 0) return;\n\n        var isHeight = ($editor.height() < 100);\n        var isEmpty = this.editor.isEmpty();\n\n        if (isHeight || isEmpty) {\n            this.reset();\n            return;\n        }\n\n        if (this.editor.isSourceMode()) {\n            return;\n        }\n\n        var toolbarHeight = $toolbar.height();\n        var toleranceEnd = 60;\n        var containerOffset = (this.toolbar.isTarget()) ? $container.position() : $container.offset();\n        var boxOffset = containerOffset.top;\n        var boxEnd = boxOffset + $container.height() - toleranceEnd;\n        var scrollOffset = this.$fixedTarget.scrollTop() + this.opts.toolbarFixedTopOffset;\n        var top = (!this.toolbar.isTarget()) ? 0 : this.$fixedTarget.offset().top - this.$win.scrollTop();\n        if (this.toolbar.isTarget() && this.$fixedTarget.css('position') === 'fixed') {\n            var bs = (this.$fixedTarget.hasClass('modal') && this.$fixedTarget.hasClass('fade'));\n            var bsFix = (bs) ? $container.closest('.modal-dialog').position().top : 0;\n            top = this.$fixedTarget.scrollTop() - bsFix;\n        }\n\n\n        if (scrollOffset > boxOffset && scrollOffset < boxEnd)\n        {\n            var position = (this.detector.isDesktop()) ? 'fixed' : 'absolute';\n            top = (this.detector.isDesktop()) ? top : (scrollOffset - boxOffset);\n\n            if (this.detector.isMobile())\n            {\n                if (this.fixedScrollTimeout)\n                {\n                    clearTimeout(this.fixedScrollTimeout);\n                }\n\n                $toolbar.hide();\n                this.fixedScrollTimeout = setTimeout(function()\n                {\n                    $toolbar.show();\n                }, 250);\n            }\n\n            $wrapper.height(toolbarHeight);\n            $toolbar.addClass('redactor-toolbar-fixed');\n\n            if ($container.hasClass('redactor-box-fullscreen'))\n            {\n                $toolbar.css({\n                    position: position,\n                    top: '0px',\n                    width: $container.width() + 'px'\n                });\n            }\n            else\n            {\n                $toolbar.css({\n                    position: position,\n                    top: (top + this.opts.toolbarFixedTopOffset) + 'px',\n                    width: $container.width() + 'px'\n                });\n            }\n\n            var dropdown = this.toolbar.getDropdown();\n            if (dropdown) dropdown.updatePosition();\n\n            this.app.broadcast('toolbar.fixed');\n        }\n        else\n        {\n            this.reset();\n            this.app.broadcast('toolbar.unfixed');\n        }\n    }\n});\n$R.add('class', 'toolbar.standard', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.uuid = app.uuid;\n        this.$body = app.$body;\n        this.toolbar = app.toolbar;\n        this.container = app.container;\n\n        // local\n        this.isExternalMultiple = false;\n        this.toolbarFixed = false;\n\n        // init\n        this._init();\n    },\n    // public\n    stop: function()\n    {\n        var $wrapper = this.toolbar.getWrapper();\n        $wrapper.remove();\n\n        if (this.toolbarFixed) this.toolbarFixed.stop();\n        if (this.opts.toolbarExternal) this._findToolbars();\n\n        this.toolbar.stopObservers();\n        this.$body.find('.re-button-tooltip-' + this.uuid).remove();\n    },\n    setExternal: function()\n    {\n        this._findToolbars();\n        if (this.isExternalMultiple)\n        {\n            this.$toolbars.hide();\n            var $current = this.$external.find('.redactor-toolbar-external-' + this.uuid);\n            $current.show();\n        }\n    },\n    resetPosition: function()\n    {\n        if (this.toolbarFixed) this.toolbarFixed.reset();\n    },\n\n    // private\n    _init: function()\n    {\n        this._build();\n\n        if (this.opts.toolbarExternal)\n        {\n            this._buildExternal();\n        }\n        else\n        {\n            this._buildFixed();\n\n            var $toolbar = this.toolbar.getElement();\n            $toolbar.show();\n        }\n    },\n    _build: function()\n    {\n        this.toolbar.create();\n\n        var $wrapper = this.toolbar.getWrapper();\n        var $toolbar = this.toolbar.getElement();\n\n        $wrapper.addClass('redactor-toolbar-wrapper');\n        $toolbar.addClass('redactor-toolbar');\n        $toolbar.hide();\n        $wrapper.append($toolbar);\n\n        if (!this.opts.toolbarExternal)\n        {\n            var $container = this.container.getElement();\n            $container.prepend($wrapper);\n        }\n    },\n    _buildExternal: function()\n    {\n        this._initExternal();\n        this._findToolbars();\n\n        if (this.isExternalMultiple)\n        {\n            this._hideToolbarsExceptFirst();\n        }\n        else\n        {\n            var $toolbar = this.toolbar.getElement();\n            $toolbar.show();\n        }\n    },\n    _buildFixed: function()\n    {\n        if (this.opts.toolbarFixed)\n        {\n            this.toolbarFixed = $R.create('toolbar.fixed', this.app);\n        }\n    },\n    _initExternal: function()\n    {\n        var $toolbar = this.toolbar.getElement();\n        var $wrapper = this.toolbar.getElement();\n\n        $toolbar.addClass('redactor-toolbar-external redactor-toolbar-external-' + this.uuid);\n\n        this.$external = $R.dom(this.opts.toolbarExternal);\n        this.$external.append($wrapper);\n\n    },\n    _findToolbars: function()\n    {\n        this.$toolbars = this.$external.find('.redactor-toolbar-external');\n        this.isExternalMultiple = (this.$toolbars.length > 1);\n    },\n    _hideToolbarsExceptFirst: function()\n    {\n        this.$toolbars.hide();\n        var $first = this.$toolbars.first();\n        $first.show();\n    }\n});\n$R.add('module', 'line', {\n    init: function(app)\n    {\n        this.app = app;\n        this.lang = app.lang;\n        this.component = app.component;\n        this.inspector = app.inspector;\n        this.insertion = app.insertion;\n    },\n    // messages\n    oncontextbar: function(e, contextbar)\n    {\n        var data = this.inspector.parse(e.target);\n        if (data.isComponentType('line'))\n        {\n            var node = data.getComponent();\n            var buttons = {\n                \"remove\": {\n                    title: this.lang.get('delete'),\n                    api: 'module.line.remove',\n                    args: node\n                }\n            };\n\n            contextbar.set(e, node, buttons, 'bottom');\n        }\n\n    },\n\n    // public\n    insert: function()\n    {\n        var line = this.component.create('line');\n        this.insertion.insertRaw(line);\n    },\n    remove: function(node)\n    {\n        this.component.remove(node);\n    }\n});\n$R.add('class', 'line.component', {\n    mixins: ['dom', 'component'],\n    init: function(app, el)\n    {\n        this.app = app;\n\n        // init\n        return (el && el.cmnt !== undefined) ? el : this._init(el);\n    },\n    // private\n    _init: function(el)\n    {\n        var wrapper, element;\n        if (typeof el !== 'undefined')\n        {\n            var $node = $R.dom(el);\n            var node = $node.get();\n\n            if (node.tagName === 'HR') element = node;\n            else if (node.tagName === 'FIGURE')\n            {\n                wrapper = node;\n                element = $node.find('hr').get();\n            }\n        }\n\n        this._buildWrapper(wrapper);\n        this._buildElement(element);\n        this._initWrapper();\n    },\n    _buildElement: function(node)\n    {\n        if (node)\n        {\n            this.$element = $R.dom(node);\n        }\n        else\n        {\n            this.$element = $R.dom('<hr>');\n            this.append(this.$element);\n        }\n    },\n    _buildWrapper: function(node)\n    {\n        node = node || '<figure>';\n\n        this.parse(node);\n    },\n    _initWrapper: function()\n    {\n        this.addClass('redactor-component');\n        this.attr({\n            'data-redactor-type': 'line',\n            'tabindex': '-1',\n            'contenteditable': false\n        });\n    }\n});\n$R.add('module', 'link', {\n    modals: {\n        'link':\n            '<form action=\"\"> \\\n                <div class=\"form-item\"> \\\n                    <label for=\"modal-link-url\">URL <span class=\"req\">*</span></label> \\\n                    <input type=\"text\" id=\"modal-link-url\" name=\"url\"> \\\n                </div> \\\n                <div class=\"form-item\"> \\\n                    <label for=\"modal-link-text\">## text ##</label> \\\n                    <input type=\"text\" id=\"modal-link-text\" name=\"text\"> \\\n                </div> \\\n                <div class=\"form-item form-item-title\"> \\\n                    <label for=\"modal-link-title\">## title ##</label> \\\n                    <input type=\"text\" id=\"modal-link-title\" name=\"title\"> \\\n                </div> \\\n                <div class=\"form-item form-item-target\"> \\\n                    <label class=\"checkbox\"> \\\n                        <input type=\"checkbox\" name=\"target\"> ## link-in-new-tab ## \\\n                    </label> \\\n                </div> \\\n            </form>'\n    },\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.lang = app.lang;\n        this.caret = app.caret;\n        this.utils = app.utils;\n        this.inline = app.inline;\n        this.editor = app.editor;\n        this.inspector = app.inspector;\n        this.insertion = app.insertion;\n        this.selection = app.selection;\n\n        // local\n        this.isCurrentLink = false;\n        this.currentText = false;\n    },\n    // messages\n    onmodal: {\n        link: {\n            open: function($modal, $form)\n            {\n                this._setFormData($form, $modal);\n            },\n            opened: function($modal, $form)\n            {\n                this._setFormFocus($form);\n            },\n            update: function($modal, $form)\n            {\n                var data = $form.getData();\n                if (this._validateData($form, data))\n                {\n                    this._update(data);\n                }\n            },\n            insert: function($modal, $form)\n            {\n                var data = $form.getData();\n                if (this._validateData($form, data))\n                {\n                    this._insert(data);\n                }\n            },\n            unlink: function()\n            {\n                this._unlink();\n            }\n        }\n    },\n    onbutton: {\n        link: {\n            observe: function(button)\n            {\n                this._observeButton(button);\n            }\n        }\n    },\n    ondropdown: {\n        link: {\n            observe: function(dropdown)\n            {\n                this._observeUnlink(dropdown);\n                this._observeEdit(dropdown);\n            }\n        }\n    },\n    oncontextbar: function(e, contextbar)\n    {\n        var current = this._getCurrent();\n        var data = this.inspector.parse(current);\n        if (data.isLink() || data.isFile())\n        {\n            var node = (data.isFile()) ? data.getFile() : data.getLink();\n            var $el = $R.dom(node);\n\n            var $point = $R.dom('<a>');\n            var url = $el.attr('href');\n\n            $point.text(this._truncateText(url));\n            $point.attr('href', url);\n            $point.attr('target', '_blank');\n\n            var buttons = {\n                \"link\": {\n                    title: $point,\n                    html: this._truncateText(url)\n                },\n                \"edit\": {\n                    title: this.lang.get('edit'),\n                    api: 'module.link.open'\n                },\n                \"unlink\": {\n                    title: this.lang.get('unlink'),\n                    api: 'module.link.unlink'\n                }\n            };\n\n            contextbar.set(e, node, buttons, 'bottom');\n        }\n    },\n\n    // public\n    open: function()\n    {\n        this.$link = this._buildCurrent();\n        this.app.api('module.modal.build', this._getModalData());\n    },\n    insert: function(data)\n    {\n        this._insert(data);\n    },\n    update: function(data)\n    {\n        this._update(data);\n    },\n    unlink: function()\n    {\n        this._unlink();\n    },\n\n    // private\n    _observeButton: function(button)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n\n        if (data.isPre() || data.isCode())\n        {\n            button.disable();\n        }\n        else\n        {\n            button.enable();\n        }\n    },\n    _observeUnlink: function(dropdown)\n    {\n        var $item = dropdown.getItem('unlink');\n        var links = this._getLinks();\n\n        if (links.length === 0) $item.disable();\n        else                    $item.enable();\n    },\n    _observeEdit: function(dropdown)\n    {\n        var current = this._getCurrent();\n        var $item = dropdown.getItem('link');\n\n        var data = this.inspector.parse(current);\n        var title = (data.isLink() || data.isFile()) ? this.lang.get('link-edit') : this.lang.get('link-insert');\n\n        $item.setTitle(title);\n    },\n    _unlink: function()\n    {\n        this.app.api('module.modal.close');\n\n        var elms = [];\n        var nodes = this._getLinks();\n\n        this.selection.save();\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var $link = $R.create('link.component', this.app, nodes[i]);\n            elms.push(this.selection.getElement(nodes[i]));\n\n            $link.unwrap();\n\n            // callback\n            this.app.broadcast('link.deleted', $link);\n        }\n        this.selection.restore();\n\n        // normalize\n        for (var i = 0; i < elms.length; i++)\n        {\n            var el = (elms[i]) ? elms[i] : this.editor.getElement();\n            this.utils.normalizeTextNodes(el);\n        }\n\n        this._resetCurrent();\n    },\n    _update: function(data)\n    {\n        this.app.api('module.modal.close');\n\n        var nodes = this._getLinks();\n        this._setLinkData(nodes, data, 'updated');\n        this._resetCurrent();\n\n        // callback\n        this.app.broadcast('link.changed', nodes);\n    },\n    _insert: function(data)\n    {\n        this.app.api('module.modal.close');\n\n        var links = this._getLinks();\n\n        if (!this._insertSingle(links, data))\n        {\n            this._removeInSelection(links);\n            this._insertMultiple(data);\n        }\n\n        this._resetCurrent();\n    },\n    _removeInSelection: function(links)\n    {\n        this.selection.save();\n        for (var i = 0; i < links.length; i++)\n        {\n            var $link = $R.create('link.component', this.app, links[i]);\n            var $clonedLink = $link.clone();\n            $link.unwrap();\n\n            // callback\n            this.app.broadcast('link.deleted', $clonedLink);\n        }\n        this.selection.restore();\n    },\n    _insertMultiple: function(data)\n    {\n        var range = this.selection.getRange();\n        if (range && this._isCurrentTextChanged(data))\n        {\n            this._deleteContents(range);\n        }\n\n        var nodes = this.inline.format({ tag: 'a' });\n\n        this._setLinkData(nodes, data, 'inserted');\n    },\n    _insertSingle: function(links, data)\n    {\n        var inline = this.selection.getInline();\n        if (links.length === 1 && ((links[0].textContext === this.selection.getText()) || (inline && inline.tagName === 'A')))\n        {\n            var $link = $R.create('link.component', this.app, links[0]);\n\n            $link.setData(data);\n            this.caret.setAfter($link);\n\n            // callback\n            this.app.broadcast('link.inserted', $link);\n\n            return true;\n        }\n\n        return false;\n    },\n    _setLinkData: function(nodes, data, type)\n    {\n        data.text = (data.text.trim() === '') ? this._truncateText(data.url) : data.text;\n\n        var isTextChanged = (!this.currentText || this.currentText !== data.text);\n\n        this.selection.save();\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var $link = $R.create('link.component', this.app, nodes[i]);\n            var linkData = {};\n\n            if (data.text && isTextChanged) linkData.text = data.text;\n            if (data.url) linkData.url = data.url;\n            if (data.title !== undefined) linkData.title = data.title;\n            if (data.target !== undefined) linkData.target = data.target;\n\n            $link.setData(linkData);\n\n            // callback\n            this.app.broadcast('link.' + type, $link);\n        }\n\n        setTimeout(this.selection.restore.bind(this.selection), 0);\n    },\n    _deleteContents: function(range)\n    {\n        var html = this.selection.getHtml();\n        var parsed = this.utils.parseHtml(html);\n        var first = parsed.nodes[0];\n\n        if (first && first.nodeType !== 3)\n        {\n            var tag = first.tagName.toLowerCase();\n            var container = document.createElement(tag);\n\n            this.insertion.insertNode(container, 'start');\n        }\n        else\n        {\n            range.deleteContents();\n        }\n    },\n    _getModalData: function()\n    {\n        var commands;\n        if (this._isLink())\n        {\n           commands = {\n                update: { title: this.lang.get('save') },\n                unlink: { title: this.lang.get('unlink'), type: 'danger' },\n                cancel: { title: this.lang.get('cancel') }\n            };\n        }\n        else\n        {\n            commands = {\n                insert: { title: this.lang.get('insert') },\n                cancel: { title: this.lang.get('cancel') }\n            };\n        }\n\n        var modalData = {\n            name: 'link',\n            title: (this._isLink()) ? this.lang.get('link-edit') : this.lang.get('link-insert'),\n            handle: (this._isLink()) ? 'update' : 'insert',\n            commands: commands\n        };\n\n\n        return modalData;\n    },\n    _isLink: function()\n    {\n        return this.currentLink;\n    },\n    _isCurrentTextChanged: function(data)\n    {\n        return (this.currentText && this.currentText !== data.text);\n    },\n    _buildCurrent: function()\n    {\n        var current = this._getCurrent();\n        var data = this.inspector.parse(current);\n        var $link;\n\n        if (data.isLink() || data.isFile())\n        {\n            this.currentLink = true;\n\n            $link = (data.isFile()) ? data.getFile() : data.getLink();\n            $link = $R.create('link.component', this.app, $link);\n        }\n        else\n        {\n            this.currentLink = false;\n\n            $link = $R.create('link.component', this.app);\n            var linkData = {\n                text: this.selection.getText()\n            };\n\n            $link.setData(linkData);\n        }\n\n        return $link;\n    },\n    _getCurrent: function()\n    {\n        return this.selection.getInlinesAllSelected({ tags: ['a'] })[0];\n    },\n    _getLinks: function()\n    {\n        var links = this.selection.getInlines({ all: true, tags: ['a'] });\n        var arr = [];\n        for (var i = 0; i < links.length; i++)\n        {\n            var data = this.inspector.parse(links[i]);\n            if (data.isLink() || data.isFile())\n            {\n                arr.push(links[i]);\n            }\n        }\n\n        return arr;\n    },\n    _resetCurrent: function()\n    {\n        this.isCurrentLink = false;\n        this.currentText = false;\n    },\n    _truncateText: function(url)\n    {\n        return (url && url.length > this.opts.linkSize) ? url.substring(0, this.opts.linkSize) + '...' : url;\n    },\n    _validateData: function($form, data)\n    {\n        return (data.url.trim() === '') ? $form.setError('url') : true;\n    },\n    _setFormFocus: function($form)\n    {\n        $form.getField('url').focus();\n    },\n    _setFormData: function($form, $modal)\n    {\n        var linkData = this.$link.getData();\n        var data = {\n            url: linkData.url,\n            text: linkData.text,\n            title: linkData.title,\n            target: (this.opts.linkTarget || linkData.target)\n        };\n\n        if (!this.opts.linkNewTab) $modal.find('.form-item-target').hide();\n        if (!this.opts.linkTitle) $modal.find('.form-item-title').hide();\n\n        $form.setData(data);\n        this.currentText = $form.getField('text').val();\n    }\n});\n$R.add('class', 'link.component', {\n    mixins: ['dom', 'component'],\n    init: function(app, el)\n    {\n        this.app = app;\n        this.opts = app.opts;\n\n        // local\n        this.reUrl = /^(?:(?:(?:https?|ftp):)?\\/\\/)?(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))(?::\\d{2,5})?(?:[/?#]\\S*)?$/i;\n\n        // init\n        return (el && el.cmnt !== undefined) ? el :  this._init(el);\n    },\n\n    // public\n    setData: function(data)\n    {\n        for (var name in data)\n        {\n            this._set(name, data[name]);\n        }\n    },\n    getData: function()\n    {\n        var names = ['url', 'text', 'target', 'title'];\n        var data = {};\n\n        for (var i = 0; i < names.length; i++)\n        {\n            data[names[i]] = this._get(names[i]);\n        }\n\n        return data;\n    },\n\n    // private\n    _init: function(el)\n    {\n        var $el = $R.dom(el);\n        if (el === undefined)\n        {\n            this.parse('<a>');\n        }\n        else\n        {\n            this.parse($el);\n        }\n    },\n    _set: function(name, value)\n    {\n        this['_set_' + name](value);\n    },\n    _get: function(name)\n    {\n        return this['_get_' + name]();\n    },\n    _get_target: function()\n    {\n        return (this.attr('target')) ? this.attr('target') : false;\n    },\n    _get_url: function()\n    {\n        return this.attr('href');\n    },\n    _get_title: function()\n    {\n        return this.attr('title');\n    },\n    _get_text: function()\n    {\n        return this._getContext().text();\n    },\n    _getContext: function()\n    {\n        return this._findDeepestChild(this).element;\n    },\n    _set_target: function(target)\n    {\n        if (target === false) this.removeAttr('target');\n        else if (target)\n        {\n            this.attr('target', (target === true) ? '_blank' : target);\n        }\n    },\n    _set_text: function(text)\n    {\n        text = this._escapeHtml(text);\n        this._getContext().html(text);\n    },\n    _set_title: function(title)\n    {\n        if (!title || title === '') this.removeAttr('title');\n        else this.attr('title', title);\n    },\n    _set_url: function(url)\n    {\n        if (this.opts.linkValidation)\n        {\n            url = this._cleanUrl(url);\n\n            if (this._isMailto(url))\n            {\n                url = 'mailto:' + url.replace('mailto:', '');\n            }\n            else if (this._isUrl(url) && url.search(/^(ftp|https?)/i) === -1)\n            {\n                url = 'http://' + url.replace(/(ftp|https?):\\/\\//i, '');\n            }\n        }\n\n        this.attr('href', url);\n    },\n    _isMailto: function(url)\n    {\n        return (url.search('@') !== -1 && /(ftp|https?):\\/\\//i.test(url) === false);\n    },\n    _isUrl: function(url)\n    {\n        return this.reUrl.test(url);\n    },\n    _cleanUrl: function(url)\n    {\n        url = this._escapeHtml(url);\n\n        return url.trim().replace(/[^\\W\\w\\D\\d+&\\'@#/%?=~_|!:,.;\\(\\)]/gi, '');\n    },\n    _escapeHtml: function(html) {\n        return html.replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\").replace(/\"/g, \"&quot;\").replace(/'/g, \"&#039;\");\n    },\n    _findDeepestChild: function(parent)\n    {\n        var result = {depth: 0, element: parent };\n\n        parent.children().each(function(node)\n        {\n            var child = $R.dom(node);\n\n            if (node.outerHTML !== parent.html())\n            {\n                return;\n            }\n            else\n            {\n                var childResult = this._findDeepestChild(child);\n                if (childResult.depth + 1 > result.depth)\n                {\n                    result = {\n                        depth: 1 + childResult.depth,\n                        element: childResult.element\n                    };\n                }\n            }\n        }.bind(this));\n\n        return result;\n    }\n});\n$R.add('module', 'modal', {\n    init: function(app)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.lang = app.lang;\n        this.$doc = app.$doc;\n        this.$win = app.$win;\n        this.$body = app.$body;\n        this.utils = app.utils;\n        this.editor = app.editor;\n        this.animate = app.animate;\n        this.detector = app.detector;\n        this.selection = app.selection;\n\n        // local\n        this.$box = false;\n        this.$modal = false;\n        this.selectionMarkers = false;\n\n        // defaults\n        this.defaults = {\n            name: false,\n            url: false,\n            title: false,\n            width: '600px',\n            height: false,\n            handle: false,\n            commands: false\n        };\n    },\n    // public\n    build: function(data)\n    {\n        this._open(data);\n    },\n    close: function()\n    {\n        this._close();\n    },\n    onstop: function() {\n        this.$body.find('#redactor-modal-' + this.uuid).remove();\n        this.$body.find('#redactor-overlay-' + this.uuid).remove();\n    },\n    stop: function()\n    {\n        if (this.$box)\n        {\n            this.$box.remove();\n            this.$box = false;\n            this.$modal = false;\n        }\n\n        if (this.$overlay) {\n            this.$overlay.remove();\n        }\n\n        this.$doc.off('.redactor.modal');\n        this.$win.off('.redactor.modal');\n    },\n    resize: function()\n    {\n        this.$modal.setWidth(this.p.width);\n        this.$modal.updatePosition();\n    },\n\n    // private\n    _isOpened: function()\n    {\n        return (this.$modal && this.$modal.hasClass('open'));\n    },\n    _open: function(data)\n    {\n        this._buildDefaults(data);\n\n        if (this.p.url) this._openUrl();\n        else this._openTemplate();\n    },\n    _openUrl: function()\n    {\n        $R.ajax.post({\n            url: this.p.url,\n            success: this._doOpen.bind(this)\n        });\n    },\n    _openTemplate: function()\n    {\n        if (typeof $R.modals[this.p.name] !== 'undefined')\n        {\n            var template = this.lang.parse($R.modals[this.p.name]);\n            this._doOpen(template);\n        }\n    },\n    _doOpen: function(template)\n    {\n        this.stop();\n\n        if (this.selection.isCollapsed())\n        {\n            this.selection.save();\n            this.selectionMarkers = false;\n        }\n        else\n        {\n            this.selection.saveMarkers();\n            this.selectionMarkers = true;\n        }\n\n        if (!this.detector.isDesktop())\n        {\n            document.activeElement.blur();\n        }\n\n        this._createModal(template);\n\n        this._buildModalBox();\n        this._buildOverlay();\n        this._buildModal();\n        this._buildModalForm();\n        this._buildModalCommands();\n\n        this._broadcast('open');\n\n        this.$modal.updatePosition();\n        this._buildModalTabs();\n\n        this.animate.start(this.$box, 'fadeIn', this._opened.bind(this));\n        this.animate.start(this.$overlay, 'fadeIn');\n\n    },\n    _opened: function()\n    {\n        this.$modal.addClass('open');\n        this.$box.on('mousedown.redactor.modal', this._close.bind(this));\n        this.$doc.on('keyup.redactor.modal', this._handleEscape.bind(this));\n        this.$win.on('resize.redactor.modal', this.resize.bind(this));\n        this.$modal.getBody().find('input[type=text],input[type=url],input[type=email]').on('keydown.redactor.modal', this._handleEnter.bind(this));\n\n        // fix bootstrap modal focus\n        if (window.jQuery) window.jQuery(document).off('focusin.modal');\n\n        this._broadcast('opened');\n    },\n    _close: function(e)\n    {\n        if (!this.$box || !this._isOpened()) return;\n\n        if (e)\n        {\n            if (!this._needToClose(e.target))\n            {\n                return;\n            }\n\n            e.stopPropagation();\n            e.preventDefault();\n        }\n\n        if (this.selectionMarkers) this.selection.restoreMarkers();\n        else this.selection.restore();\n\n\n        this.selectionMarkers = false;\n\n        this._broadcast('close');\n\n        this.animate.start(this.$box, 'fadeOut', this._closed.bind(this));\n        this.animate.start(this.$overlay, 'fadeOut');\n    },\n    _closed: function()\n    {\n        this.$modal.removeClass('open');\n        this.$box.off('.redactor.modal');\n        this.$doc.off('.redactor.modal');\n        this.$win.off('.redactor.modal');\n\n        this._broadcast('closed');\n    },\n    _createModal: function(template)\n    {\n        this.$modal = $R.create('modal.element', this.app, template);\n    },\n    _broadcast: function(message)\n    {\n        this.app.broadcast('modal.' + message, this.$modal, this.$modalForm);\n        this.app.broadcast('modal.' + this.p.name + '.' + message, this.$modal, this.$modalForm);\n    },\n    _buildDefaults: function(data)\n    {\n         this.p = $R.extend({}, this.defaults, data);\n    },\n    _buildModalBox: function()\n    {\n        this.$box = $R.dom('<div>');\n        this.$box.attr('id', 'redactor-modal-' + this.uuid);\n        this.$box.addClass('redactor-modal-box redactor-animate-hide');\n        this.$box.html('');\n        this.$body.append(this.$box);\n    },\n    _buildOverlay: function()\n    {\n        this.$overlay = $R.dom('#redactor-overlay-' + this.uuid);\n        if (this.$overlay.length === 0)\n        {\n            this.$overlay = $R.dom('<div>');\n            this.$overlay.attr('id', 'redactor-overlay-' + this.uuid);\n            this.$overlay.addClass('redactor-overlay redactor-animate-hide');\n            this.$body.prepend(this.$overlay);\n        }\n    },\n    _buildModal: function()\n    {\n        this.$box.append(this.$modal);\n\n        this.$modal.setTitle(this.p.title);\n        this.$modal.setHeight(this.p.height);\n        this.$modal.setWidth(this.p.width);\n    },\n    _buildModalCommands: function()\n    {\n        if (this.p.commands)\n        {\n            var commands = this.p.commands;\n            var $footer = this.$modal.getFooter();\n            for (var key in commands)\n            {\n                var $btn = $R.dom('<button>');\n\n                $btn.html(commands[key].title);\n                $btn.attr('data-command', key);\n\n                // cancel\n                if (key === 'cancel')\n                {\n                    $btn.attr('data-action', 'close');\n                    $btn.addClass('redactor-button-unstyled');\n                }\n\n                // danger\n                if (typeof commands[key].type !== 'undefined' && commands[key].type === 'danger')\n                {\n                    $btn.addClass('redactor-button-danger');\n                }\n\n                $btn.on('click', this._handleCommand.bind(this));\n\n                $footer.append($btn);\n            }\n        }\n    },\n    _buildModalTabs: function()\n    {\n        var $body = this.$modal.getBody();\n        var $tabs = $body.find('.redactor-modal-tab');\n        var $box = $body.find('.redactor-modal-tabs');\n\n\n        if ($tabs.length > 1)\n        {\n            $box = ($box.length === 0) ? $R.dom('<div>') : $box.html('');\n            $box.addClass('redactor-modal-tabs');\n\n            $tabs.each(function(node, i)\n            {\n                var $node = $R.dom(node);\n                var $item = $R.dom('<a>');\n                $item.attr('href', '#');\n                $item.attr('rel', i);\n                $item.text($node.attr('data-title'));\n                $item.on('click', this._showTab.bind(this));\n\n                if (i === 0)\n                {\n                    $item.addClass('active');\n                }\n\n                $box.append($item);\n\n            }.bind(this));\n\n            $body.prepend($box);\n        }\n\n        if ($tabs.length === 1) {\n            $tabs.show();\n        }\n    },\n    _buildModalForm: function()\n    {\n        this.$modalForm = $R.create('modal.form', this.app, this.$modal.getForm());\n    },\n    _showTab: function(e)\n    {\n        e.preventDefault();\n\n        var $el = $R.dom(e.target);\n        var index = $el.attr('rel');\n        var $body = this.$modal.getBody();\n        var $tabs = $body.find('.redactor-modal-tab');\n\n        $tabs.hide();\n        $tabs.eq(index).show();\n\n        $body.find('.redactor-modal-tabs a').removeClass('active');\n        $el.addClass('active');\n\n    },\n    _needToClose: function(el)\n    {\n        var $target = $R.dom(el);\n        if ($target.attr('data-action') === 'close' || this.$modal.isCloseNode(el) || $target.closest('.redactor-modal').length === 0)\n        {\n            return true;\n        }\n\n        return false;\n    },\n    _handleCommand: function(e)\n    {\n        var $btn = $R.dom(e.target).closest('button');\n        var command = $btn.attr('data-command');\n\n        if (command !== 'cancel') e.preventDefault();\n\n        this._broadcast(command);\n    },\n    _handleEnter: function(e)\n    {\n        if (e.which === 13)\n        {\n            if (this.p.handle)\n            {\n                e.preventDefault();\n                this._broadcast(this.p.handle);\n            }\n        }\n    },\n    _handleEscape: function(e)\n    {\n        if (e.which === 27) this._close();\n    }\n});\n$R.add('class', 'modal.element', {\n    mixins: ['dom'],\n    init: function(app, template)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.$win = app.$win;\n\n        // init\n        this._init(template);\n    },\n\n    // get\n    getForm: function()\n    {\n        return this.find('form');\n    },\n    getHeader: function()\n    {\n        return this.$modalHeader;\n    },\n    getBody: function()\n    {\n        return this.$modalBody;\n    },\n    getFooter: function()\n    {\n        return this.$modalFooter;\n    },\n\n    // set\n    setTitle: function(title)\n    {\n        if (title) this.$modalHeader.html(title);\n    },\n    setWidth: function(width)\n    {\n        width = (parseInt(width) >= this.$win.width()) ? '96%' : width;\n\n        this.css('max-width', width);\n    },\n    setHeight: function(height)\n    {\n        if (height !== false) this.$modalBody.css('height', height);\n    },\n\n    // update\n    updatePosition: function()\n    {\n        var width = this.width();\n        this.css({ 'left': '50%', 'margin-left': '-' + (width/2) + 'px' });\n\n        var windowHeight = this.$win.height();\n        var height = this.height();\n        var marginTop = (windowHeight/2 - height/2);\n\n        if (height < windowHeight && marginTop !== 0)\n        {\n            this.css('margin-top', marginTop + 'px');\n        }\n    },\n\n    // is\n    isCloseNode: function(el)\n    {\n        return (el === this.$modalClose.get());\n    },\n\n    // private\n    _init: function(template)\n    {\n        this._build();\n        this._buildClose();\n        this._buildHeader();\n        this._buildBody();\n        this._buildFooter();\n        this._buildTemplate(template);\n    },\n    _build: function()\n    {\n        this.parse('<div>');\n        this.addClass('redactor-modal');\n        this.attr('dir', this.opts.direction);\n    },\n    _buildClose: function()\n    {\n        this.$modalClose = $R.dom('<span>');\n        this.$modalClose.addClass('redactor-close');\n\n        this.append(this.$modalClose);\n    },\n    _buildHeader: function()\n    {\n        this.$modalHeader = $R.dom('<div>');\n        this.$modalHeader.addClass('redactor-modal-header');\n\n        this.append(this.$modalHeader);\n    },\n    _buildBody: function()\n    {\n        this.$modalBody = $R.dom('<div>');\n        this.$modalBody.addClass('redactor-modal-body');\n\n        this.append(this.$modalBody);\n    },\n    _buildFooter: function()\n    {\n        this.$modalFooter = $R.dom('<div>');\n        this.$modalFooter.addClass('redactor-modal-footer');\n\n        this.append(this.$modalFooter);\n    },\n    _buildTemplate: function(template)\n    {\n        this.$modalBody.html(template);\n    }\n});\n$R.add('class', 'modal.form', {\n    mixins: ['dom'],\n    init: function(app, element)\n    {\n        this.app = app;\n\n        // build\n        this.build(element);\n    },\n\n    // public\n    build: function(element)\n    {\n        this.parse(element);\n    },\n    getData: function()\n    {\n        var data = {};\n        this.find('[name]').each(function(node)\n        {\n            var $node = $R.dom(node);\n            data[$node.attr('name')] = $node.val();\n        });\n\n        return data;\n    },\n    setData: function(data)\n    {\n        this.find('[name]').each(function(node)\n        {\n            var $node = $R.dom(node);\n            var name = $node.attr('name');\n            if (data.hasOwnProperty(name))\n            {\n                if (node.type && node.type === 'checkbox') node.checked = data[name];\n                else $node.val(data[name]);\n            }\n        });\n    },\n    getField: function(name)\n    {\n        return this.find('[name=' + name + ']');\n    },\n    setError: function(name)\n    {\n        var $el = this.getField(name);\n\n        $el.addClass('error');\n        $el.one(this._getFieldEventName($el.get()), this._clearError);\n\n        return false;\n    },\n\n    // private\n    _clearError: function()\n    {\n        return $R.dom(this).removeClass('error');\n    },\n    _getFieldEventName: function(el)\n    {\n        return (el.tagName === 'SELECT' || el.type === 'checkbox' || el.type === 'radio') ? 'change' : 'keyup';\n    }\n});\n$R.add('module', 'block', {\n    init: function(app)\n    {\n        this.app = app;\n        this.block = app.block;\n    },\n    // public\n    format: function(args)\n    {\n        var nodes = this.block.format(args);\n\n        // callback\n        this.app.broadcast('format', 'block', nodes);\n    },\n    clearformat: function()\n    {\n        this.block.clearFormat();\n    },\n    clearstyle: function()\n    {\n        this.block.clearStyle();\n    },\n    clearclass: function()\n    {\n        this.block.clearClass();\n    },\n    clearattr: function()\n    {\n        this.block.clearAttr();\n    },\n    add: function(args, tags)\n    {\n        this.block.add(args, tags);\n    },\n    toggle: function(args, tags)\n    {\n        this.block.toggle(args, tags);\n    },\n    set: function(args, tags)\n    {\n        this.block.set(args, tags);\n    },\n    remove: function(args, tags)\n    {\n        this.block.remove(args, tags);\n    }\n});\n$R.add('module', 'inline', {\n    init: function(app)\n    {\n        this.app = app;\n        this.inline = app.inline;\n    },\n    format: function(args)\n    {\n        var nodes = this.inline.format(args);\n\n        // callback\n        this.app.broadcast('format', 'inline', nodes);\n    },\n    clearformat: function()\n    {\n        this.inline.clearFormat();\n    },\n    clearstyle: function()\n    {\n        this.inline.clearStyle();\n    },\n    clearclass: function()\n    {\n        this.inline.clearClass();\n    },\n    clearattr: function()\n    {\n        this.inline.clearAttr();\n    },\n    add: function(args, tags)\n    {\n        this.inline.add(args, tags);\n    },\n    toggle: function(args, tags)\n    {\n        this.inline.toggle(args, tags);\n    },\n    set: function(args, tags)\n    {\n        this.inline.set(args, tags);\n    },\n    remove: function(args, tags)\n    {\n        this.inline.remove(args, tags);\n    }\n});\n$R.add('module', 'autosave', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.source = app.source;\n    },\n    // messages\n    onsynced: function()\n    {\n        if (this.opts.autosave)\n        {\n            this._send();\n        }\n    },\n\n    // private\n    _send: function()\n    {\n        var name = (this.opts.autosaveName) ? this.opts.autosaveName : this.source.getName();\n\n        var data = {};\n        data[name] = this.source.getCode();\n        data = this.utils.extendData(data, this.opts.autosaveData);\n        $R.ajax.request(this.opts.autosaveMethod, {\n            url: this.opts.autosave,\n            data: data,\n            success: function(response)\n            {\n                this._complete(response, name, data);\n            }.bind(this)\n        });\n    },\n    _complete: function(response, name, data)\n    {\n        var callback = (response && response.error) ? 'autosaveError' : 'autosave';\n        this.app.broadcast(callback, name, data, response);\n    }\n});\n$R.add('module', 'input', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.editor = app.editor;\n        this.keycodes = app.keycodes;\n        this.element = app.element;\n        this.selection = app.selection;\n        this.insertion = app.insertion;\n        this.inspector = app.inspector;\n        this.autoparser = app.autoparser;\n\n        // local\n        this.lastShiftKey = false;\n    },\n    // messages\n    onpaste: function(e, dataTransfer)\n    {\n        if (!this.opts.input) return;\n\n        return $R.create('input.paste', this.app, e, dataTransfer);\n    },\n    onkeydown: function(e)\n    {\n        if (!this.opts.input) return;\n\n        // key\n        var key = e.which;\n\n        // shortcuts\n        var shortcut = $R.create('input.shortcut', this.app, e);\n        if (shortcut.is()) return;\n\n        // select all\n        if ((e.ctrlKey || e.metaKey) && !e.altKey && key === 65)\n        {\n            e.preventDefault();\n            return this._selectAll();\n        }\n\n        // set empty if all selected\n        var keys = [this.keycodes.ENTER, this.keycodes.SPACE, this.keycodes.BACKSPACE, this.keycodes.DELETE];\n        var arrowKeys = [this.keycodes.UP, this.keycodes.DOWN, this.keycodes.LEFT, this.keycodes.RIGHT];\n        var isKeys = (keys.indexOf(key) !== -1);\n        var isArrowKeys = (arrowKeys.indexOf(key) !== -1);\n        var isXKey = ((e.ctrlKey || e.metaKey) && key === 88); // x\n        var isAlphaKeys = ((!e.ctrlKey && !e.metaKey) && ((key >= 48 && key <= 57) || (key >= 65 && key <= 90)));\n\n        if (this.selection.isAll() && isArrowKeys && (isXKey || (!e.ctrlKey && !e.metaKey && !e.altKey && !e.shiftKey)))\n        {\n            if (isXKey)\n            {\n                this.editor.disableNonEditables();\n                this.app.broadcast('empty');\n                return;\n            }\n\n            if (this._isArrowKey(key)) return true;\n            if (isKeys) e.preventDefault();\n\n            if (this.element.isType('inline'))\n            {\n                var $editor = this.editor.getElement();\n                $editor.html('');\n\n                this.editor.startFocus();\n            }\n            else\n            {\n                this.insertion.set(this.opts.emptyHtml);\n            }\n\n            if (isKeys) return;\n            else this.app.broadcast('empty');\n        }\n\n        // autoparse\n        if (this.opts.autoparse)\n        {\n            this.autoparser.format(e, key);\n        }\n\n        // a-z, 0-9 - non editable\n        if (isAlphaKeys)\n        {\n            // has non-editable\n            if (this.selection.hasNonEditable())\n            {\n                e.preventDefault();\n                return;\n            }\n        }\n\n        // enter, shift/ctrl + enter\n        if (key === this.keycodes.ENTER)\n        {\n            return $R.create('input.enter', this.app, e, key);\n        }\n        // cmd + [\n        else if (e.metaKey && key === 219)\n        {\n            e.preventDefault();\n            this.app.api('module.list.outdent');\n            return;\n        }\n        // tab or cmd + ]\n        else if (key === this.keycodes.TAB || (e.metaKey && key === 221))\n        {\n            return $R.create('input.tab', this.app, e, key);\n        }\n        // space\n        else if (key === this.keycodes.SPACE)\n        {\n            return $R.create('input.space', this.app, e, key, this.lastShiftKey);\n        }\n        // backspace or delete\n        else if (this._isDeleteKey(key))\n        {\n            return $R.create('input.delete', this.app, e, key);\n        }\n        else if (this._isArrowKey(key))\n        {\n            return $R.create('input.arrow', this.app, e, key);\n        }\n    },\n    onkeyup: function(e)\n    {\n        if (!this.opts.input) return;\n\n        // key\n        var key = e.which;\n\n        // shift key\n        this.lastShiftKey = e.shiftKey;\n\n        // hide context toolbar\n        this.app.broadcast('contextbar.close');\n\n        // shortcode\n        var shortcode = $R.create('input.shortcode', this.app, e, key);\n        if (shortcode.is()) return;\n\n        // is empty\n        if (key === this.keycodes.BACKSPACE)\n        {\n            var $editor = this.editor.getElement();\n            var html = this.utils.trimSpaces($editor.html());\n            html = html.replace(/<br\\s?\\/?>/g, '');\n            html = html.replace(/<div><\\/div>/, '');\n\n            if (html === '')\n            {\n                e.preventDefault();\n                this.editor.setEmpty();\n                this.editor.startFocus();\n                return;\n            }\n        }\n\n        if (this.editor.isEmpty())\n        {\n            this.app.broadcast('empty');\n        }\n    },\n\n    // public\n    start: function()\n    {\n        // extend shortcuts\n        if (this.opts.shortcutsAdd)\n        {\n            this.opts.shortcuts = $R.extend({}, true, this.opts.shortcuts, this.opts.shortcutsAdd);\n        }\n    },\n\n    // private\n    _selectAll: function()\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var el;\n\n        if (data.isComponentType('table'))\n        {\n            el = data.getTable();\n            this.selection.setAll(el);\n            return;\n        }\n        else if (data.isComponentType('code'))\n        {\n            el = data.getComponentCodeElement();\n            this.selection.setAll(el);\n            return;\n        }\n\n        this.selection.setAll();\n    },\n    _isArrowKey: function(key)\n    {\n        return ([this.keycodes.UP, this.keycodes.DOWN, this.keycodes.RIGHT, this.keycodes.LEFT].indexOf(key) !== -1);\n    },\n    _isDeleteKey: function(key)\n    {\n        return (key === this.keycodes.BACKSPACE || key === this.keycodes.DELETE);\n    }\n});\n$R.add('class', 'input.arrow', {\n    init: function(app, e, key)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.caret = app.caret;\n        this.offset = app.offset;\n        this.marker = app.marker;\n        this.editor = app.editor;\n        this.keycodes = app.keycodes;\n        this.component = app.component;\n        this.inspector = app.inspector;\n        this.selection = app.selection;\n\n        // local\n        this.key = key;\n\n        // init\n        this._init(e);\n    },\n    // private\n    _init: function(e)\n    {\n        if (this._isRightLeftKey() && this._isExitVariable(e)) return;\n\n        if (this._isRightDownKey())\n        {\n            if (this._isExitOnDownRight(e)) return;\n            if (this._selectComponent(e, 'End', 'next')) return;\n        }\n\n        if (this._isLeftUpKey())\n        {\n            if (this._isExitOnUpLeft(e)) return;\n            if (this._selectComponent(e, 'Start', 'prev')) return;\n        }\n\n        if (this.key === this.keycodes.LEFT) this.utils.trimInvisibleChars('left');\n        else if (this.key === this.keycodes.RIGHT) this.utils.trimInvisibleChars('right');\n\n    },\n    _isRightDownKey: function()\n    {\n        return ([this.keycodes.DOWN, this.keycodes.RIGHT].indexOf(this.key) !== -1);\n    },\n    _isLeftUpKey: function()\n    {\n        return ([this.keycodes.UP, this.keycodes.LEFT].indexOf(this.key) !== -1);\n    },\n    _isRightLeftKey: function()\n    {\n        return ([this.keycodes.RIGHT, this.keycodes.LEFT].indexOf(this.key) !== -1);\n    },\n    _isExitVariable: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var component = data.getComponent();\n        if (data.isComponentType('variable') && data.isComponentActive())\n        {\n            e.preventDefault();\n            var func = (this.key === this.keycodes.LEFT) ? 'setBefore' : 'setAfter';\n            this.caret[func](component);\n            return;\n        }\n    },\n    _isExitOnUpLeft: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var block = this.selection.getBlock(current);\n        var data = this.inspector.parse(current);\n        var prev = block.previousElementSibling;\n        var isStart = this.caret.isStart(block);\n\n        // prev table\n        if (isStart && prev && prev.tagName === 'TABLE')\n        {\n            e.preventDefault();\n            this.caret.setEnd(prev);\n            return true;\n        }\n        // figcaption\n        else if (data.isFigcaption())\n        {\n            block = data.getFigcaption();\n            isStart = this.caret.isStart(block);\n\n            var $component = $R.dom(block).closest('.redactor-component');\n            if (isStart && $component.length !== 0)\n            {\n                e.preventDefault();\n                this.caret.setEnd($component);\n                return true;\n            }\n        }\n        // exit table\n        else if (data.isTable() && isStart)\n        {\n            e.preventDefault();\n            this.caret.setEnd(block.previousElementSibling);\n            return true;\n        }\n        // component\n        else if (!data.isComponentEditable() && data.isComponent() && !data.isComponentType('variable'))\n        {\n            var component = data.getComponent();\n            if (!component.previousElementSibling)\n            {\n                e.preventDefault();\n                this.component.clearActive();\n\n                return this._exitPrevElement(e, data.getComponent());\n            }\n            else if (component.previousElementSibling)\n            {\n                e.preventDefault();\n                this.component.clearActive();\n                this.caret.setEnd(component.previousElementSibling);\n                return true;\n            }\n        }\n    },\n    _isExitOnDownRight: function(e)\n    {\n        var $editor = this.editor.getElement();\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var isEndEditor = this.caret.isEnd();\n        var block, isEnd;\n\n        // table\n        if (data.isTable())\n        {\n            block = data.getTable();\n            isEnd = this.caret.isEnd(block);\n\n            if (isEnd || isEndEditor)\n            {\n                return this._exitNextElement(e, data.getComponent());\n            }\n        }\n        // figcaption\n        else if (data.isFigcaption())\n        {\n            block = data.getFigcaption();\n            isEnd = this.caret.isEnd(block);\n\n            if (isEnd || isEndEditor)\n            {\n                return this._exitNextElement(e, data.getComponent());\n            }\n        }\n        // figure/code\n        else if (data.isComponentType('code'))\n        {\n            var component = data.getComponent();\n            var pre = $R.dom(data.getComponentCodeElement()).closest('pre');\n\n            isEnd = this.caret.isEnd(block);\n\n            var isNext = (pre && pre.get().nextElementSibling);\n            if (isEnd && !isNext)\n            {\n                return this._exitNextElement(e, component);\n            }\n        }\n        // pre & blockquote & dl\n        else if (data.isPre() || data.isBlockquote() || data.isDl())\n        {\n            if (isEndEditor)\n            {\n                if (data.isPre()) return this._exitNextElement(e, data.getPre());\n                else if (data.isBlockquote()) return this._exitNextElement(e, data.getBlockquote());\n                else if (data.isDl()) return this._exitNextElement(e, data.getDl());\n            }\n        }\n        // li\n        else if (data.isList())\n        {\n            var $list = $R.dom(current).parents('ul, ol', $editor).last();\n            isEnd = this.caret.isEnd($list);\n\n            if (isEnd || isEndEditor)\n            {\n                return this._exitNextElement(e, $list.get());\n            }\n        }\n        // component\n        else if (data.isComponent() && !data.isComponentType('variable') && data.getTag() !== 'span')\n        {\n            this.component.clearActive();\n            return this._exitNextElement(e, data.getComponent());\n        }\n    },\n    _exitPrevElement: function(e, node)\n    {\n        e.preventDefault();\n\n        if (node.previousElementSibling) this.caret.setEnd(node.previousElementSibling);\n        else this.utils.createMarkupBefore(node);\n\n        return true;\n    },\n    _exitNextElement: function(e, node)\n    {\n        e.preventDefault();\n\n        if (node.nextElementSibling) this.caret.setStart(node.nextElementSibling);\n        else this.utils.createMarkup(node);\n\n        return true;\n    },\n    _selectComponent: function(e, caret, type)\n    {\n        var current = this.selection.getCurrent();\n        var block = this.selection.getBlock(current);\n        var sibling = this.utils.findSiblings(current, type);\n        var siblingBlock = this.utils.findSiblings(block, type);\n\n        if (sibling && this.caret['is' + caret](current))\n        {\n            this._selectComponentItem(e, sibling, caret);\n        }\n        else if (siblingBlock && this.caret['is' + caret](block))\n        {\n            this._selectComponentItem(e, siblingBlock, caret);\n        }\n    },\n    _selectComponentItem: function(e, item, caret)\n    {\n        if (this.component.isNonEditable(item))\n        {\n            e.preventDefault();\n            this.caret['set' + caret](item);\n            return true;\n        }\n    }\n});\n$R.add('class', 'input.delete', {\n    init: function(app, e, key)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.caret = app.caret;\n        this.utils = app.utils;\n        this.editor = app.editor;\n        this.marker = app.marker;\n        this.keycodes = app.keycodes;\n        this.component = app.component;\n        this.inspector = app.inspector;\n        this.selection = app.selection;\n        this.insertion = app.insertion;\n\n        // local\n        this.key = key;\n\n        // init\n        this._init(e);\n    },\n    // private\n    _init: function(e)\n    {\n        if (this._removeActiveComponent(e)) return;\n        if (this._removeAllSelectedTable(e)) return;\n\n        // is empty\n        if (this.key === this.keycodes.BACKSPACE)\n        {\n            var $editor = this.editor.getElement();\n            var html = this.utils.trimSpaces($editor.html());\n\n            if (html === this.opts.emptyHtml)\n            {\n                e.preventDefault();\n                return;\n            }\n        }\n\n        // variable or non editable prev/next or selection\n        if (this._detectVariableOrNonEditable() || this.selection.hasNonEditable())\n        {\n            e.preventDefault();\n            return;\n        }\n\n        // all selected\n        if (this.selection.isAll())\n        {\n            e.preventDefault();\n            this.insertion.set(this.opts.emptyHtml);\n            return;\n        }\n\n        // collapsed\n        if (this.selection.isCollapsed())\n        {\n            // next / prev\n            if (this.key === this.keycodes.BACKSPACE) this._traverseBackspace(e);\n            else if (this.key === this.keycodes.DELETE) this._traverseDelete(e);\n        }\n\n        if (this.key === this.keycodes.BACKSPACE) this.utils.trimInvisibleChars('left');\n\n        this._removeUnwantedStyles();\n        this._removeEmptySpans();\n        this._removeSpanTagsInHeadings();\n        this._removeInlineTagsInPre();\n    },\n    _detectVariableOrNonEditable: function()\n    {\n        var block = this.selection.getBlock();\n        var isBlockStart = this.caret.isStart(block);\n        var isBlockEnd = this.caret.isEnd(block);\n        var el;\n\n        // backspace\n        if (this.key === this.keycodes.BACKSPACE && isBlockStart)\n        {\n            el = block.previousSibling;\n            if (this._isNonEditable(el)) return true;\n        }\n        // delete\n        else if (this.key === this.keycodes.DELETE && isBlockEnd)\n        {\n            el = block.nextSibling;\n            if (this._isNonEditable(el)) return true;\n        }\n\n        var current = this.selection.getCurrent();\n        var isCurrentStart = this.caret.isStart(current);\n        var isCurrentEnd = this.caret.isEnd(current);\n        var isCurrentStartSpace = (this.selection.getTextBeforeCaret().trim() === '');\n        var isCurrentEndSpace = (this.selection.getTextAfterCaret().trim() === '');\n\n        // backspace\n        if (this.key === this.keycodes.BACKSPACE && isCurrentStart && !isCurrentStartSpace)\n        {\n            el = current.previousSibling;\n            if (this._isVariable(el))\n            {\n                this.caret.setEnd(el);\n                return true;\n            }\n            else if (this._isNonEditable(el)) return true;\n        }\n        // delete\n        else if (this.key === this.keycodes.DELETE && isCurrentEnd && !isCurrentEndSpace)\n        {\n            el = current.nextSibling;\n            if (this._isVariable(el))\n            {\n                this.caret.setStart(el);\n                return true;\n            }\n            else if (this._isNonEditable(el)) return true;\n        }\n    },\n    _isVariable: function(node)\n    {\n        return ($R.dom(node).closest('[data-redactor-type=\"variable\"]').length !== 0);\n    },\n    _isNonEditable: function(node)\n    {\n        return ($R.dom(node).closest('.non-editable').length !== 0);\n    },\n    _getBlock: function()\n    {\n        var $editor = this.editor.getElement();\n        var block = this.selection.getBlock();\n        var data = this.inspector.parse(block);\n\n        block = (data.isList()) ? $R.dom(block).parents('ul, ol', $editor).last().get() : block;\n        block = (data.isDl()) ? data.getDl() : block;\n        block = (data.isTable()) ? data.getTable() : block;\n\n        return block;\n    },\n    _traverseDelete: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var block, isEnd, $next;\n\n        // figcaption\n        if (data.isFigcaption())\n        {\n            block = data.getFigcaption();\n            isEnd = this.caret.isEnd(block);\n\n            if (isEnd)\n            {\n                e.preventDefault();\n                return;\n            }\n        }\n        // figure/code\n        else if (data.isComponentType('code'))\n        {\n            block = data.getComponent();\n            isEnd = this.caret.isEnd(block);\n\n            if (isEnd)\n            {\n                e.preventDefault();\n                return;\n            }\n        }\n\n\n        // next\n        block = this._getBlock();\n        var next = this.utils.findSiblings(block, 'next');\n        if (!next) return;\n\n        isEnd = this.caret.isEnd(block);\n        var dataNext = this.inspector.parse(next);\n        var isNextBlock = (next.tagName === 'P' || next.tagName === 'DIV');\n\n        // table\n        if (isEnd && dataNext.isComponentType('table'))\n        {\n            e.preventDefault();\n            this.caret.setStart(next);\n            return;\n        }\n        // figure/code\n        else if (isEnd && dataNext.isComponentEditable())\n        {\n            e.preventDefault();\n            this.component.remove(next, false);\n            return;\n        }\n        // component\n        else if (isEnd && dataNext.isComponent())\n        {\n            e.preventDefault();\n\n            // select component\n            this.caret.setStart(next);\n\n            // remove current if empty\n            if (this.utils.isEmptyHtml(block.innerHTML))\n            {\n                $R.dom(block).remove();\n            }\n\n            return;\n        }\n        // combine list\n        else if (isEnd && dataNext.isList())\n        {\n            var $currentList = $R.dom(block);\n            $next = $R.dom(next);\n\n            // current list\n            if (data.isList())\n            {\n                e.preventDefault();\n\n                $currentList.append($next);\n                $next.unwrap();\n\n                return;\n            }\n            else\n            {\n                var $first = $next.children('li').first();\n                var $lists = $first.find('ul, ol');\n\n                if ($lists.length !== 0)\n                {\n                    e.preventDefault();\n\n                    $next.prepend($lists);\n                    $lists.unwrap();\n\n                    $currentList.append($first);\n                    $first.unwrap();\n\n                    return;\n                }\n            }\n        }\n        // block\n        else if (isEnd && !data.isList() && !data.isTable() && isNextBlock && !this.utils.isEmptyHtml(block.innerHTML))\n        {\n            e.preventDefault();\n\n            var $current = $R.dom(block);\n            $next = $R.dom(next);\n\n            $current.append($next);\n            $next.unwrap();\n\n            return;\n        }\n    },\n    _traverseBackspace: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var block, isStart, $prev, $currentList;\n\n        // figcaption\n        if (data.isFigcaption())\n        {\n            block = data.getFigcaption();\n            isStart = this.caret.isStart(block);\n\n            if (isStart)\n            {\n                e.preventDefault();\n                return;\n            }\n        }\n        // figure/code\n        else if (data.isComponentType('code'))\n        {\n            block = data.getComponent();\n            isStart = this.caret.isStart(block);\n\n            if (isStart && block.previousElementSibling)\n            {\n                e.preventDefault();\n                this.caret.setEnd(block.previousElementSibling);\n                return true;\n            }\n        }\n\n        // prev\n        block = this._getBlock();\n        var prev = this.utils.findSiblings(block, 'prev');\n\n        if (!prev)\n        {\n            setTimeout(this._replaceBlock.bind(this), 1);\n            return;\n        }\n\n        isStart = this.caret.isStart(block);\n        var dataPrev = this.inspector.parse(prev);\n        var isPrevBlock = (prev.tagName === 'P' || prev.tagName === 'DIV');\n\n        // figure/code\n        if (isStart && dataPrev.isComponentType('code'))\n        {\n            e.preventDefault();\n            this.component.remove(prev, false);\n            return;\n        }\n        // table\n        else if (isStart && dataPrev.isComponentType('table'))\n        {\n            e.preventDefault();\n            this.caret.setEnd(prev);\n            return;\n        }\n        // component\n        else if (isStart && dataPrev.isComponent())\n        {\n            e.preventDefault();\n\n            // select component\n            this.caret.setStart(prev);\n\n\n            // remove current if empty\n            if (this.utils.isEmptyHtml(block.innerHTML))\n            {\n                $R.dom(block).remove();\n            }\n\n            return;\n        }\n        // lists\n        else if (isStart && data.isList())\n        {\n            e.preventDefault();\n\n            $currentList = $R.dom(block);\n            $prev = $R.dom(prev);\n\n            if (dataPrev.isList())\n            {\n                $currentList.children('li').first().prepend(this.marker.build('start'));\n                $prev.append($currentList);\n                $currentList.unwrap();\n\n                this.selection.restoreMarkers();\n            }\n            else\n            {\n                var $first = $currentList.children('li').first();\n                var first = $first.get();\n                var $lists = $first.find('ul, ol');\n\n                var $newnode = this.utils.replaceToTag(first, this.opts.markup);\n                if (this.opts.breakline) $newnode.attr('data-redactor-tag', 'br');\n                $currentList.before($newnode);\n                this.caret.setStart($newnode);\n\n                if ($lists.length !== 0)\n                {\n                    $currentList.prepend($lists);\n                    $lists.unwrap();\n                }\n            }\n\n            return;\n        }\n        // block\n        else if (isStart && isPrevBlock)\n        {\n            e.preventDefault();\n\n            if (this.utils.isEmpty(prev)) {\n                $prev = $R.dom(prev);\n                $prev.remove();\n                return;\n            }\n\n            var textNode = this.utils.createInvisibleChar();\n            var $current = $R.dom(block);\n            $prev = $R.dom(prev);\n\n            this.caret.setEnd($prev);\n\n            $current.prepend(textNode);\n            $prev.append($current.contents());\n            $current.remove();\n\n            return;\n        }\n\n    },\n    _replaceBlock: function()\n    {\n        var block = this.selection.getBlock();\n        var $block = $R.dom(block);\n\n        if (this.opts.markup === 'p' && block && this._isNeedToReplaceBlock(block))\n        {\n            var markup = document.createElement(this.opts.markup);\n\n            $block.replaceWith(markup);\n            this.caret.setStart(markup);\n        }\n\n        if (this.opts.breakline && block && block.tagName === 'DIV')\n        {\n            $block.attr('data-redactor-tag', 'br');\n        }\n    },\n    _isNeedToReplaceBlock: function(block)\n    {\n        return (block.tagName === 'DIV' && this.utils.isEmptyHtml(block.innerHTML));\n    },\n    _removeActiveComponent: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var component = data.getComponent();\n        if (data.isComponent() && this.component.isActive(component))\n        {\n            e.preventDefault();\n            this.component.remove(component);\n            return true;\n        }\n    },\n    _removeAllSelectedTable: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var table = data.getTable();\n        if (table && this.selection.isAll(table))\n        {\n            e.preventDefault();\n            this.component.remove(table);\n            return true;\n        }\n    },\n    _removeUnwantedStyles: function()\n    {\n        var $editor = this.editor.getElement();\n\n        setTimeout(function()\n        {\n            var $tags = $editor.find('*[style]');\n            $tags.not('img, figure, figcaption, iframe, [data-redactor-style-cache], [data-redactor-span]').removeAttr('style');\n\n        }, 0);\n    },\n    _removeEmptySpans: function()\n    {\n        var $editor = this.editor.getElement();\n\n        setTimeout(function()\n        {\n            $editor.find('span').each(function(node)\n            {\n                if (node.attributes.length === 0)\n                {\n                    $R.dom(node).replaceWith(node.childNodes);\n                }\n            });\n\n        }, 0);\n    },\n    _removeSpanTagsInHeadings: function()\n    {\n        var $editor = this.editor.getElement();\n\n        setTimeout(function()\n        {\n            $editor.find('h1, h2, h3, h4, h5, h6').each(function(node)\n            {\n                var $node = $R.dom(node);\n                if ($node.closest('figure').length === 0)\n                {\n                    $node.find('span').not('.redactor-component, .non-editable, .redactor-selection-marker, [data-redactor-style-cache], [data-redactor-span]').unwrap();\n                }\n            });\n\n        }, 1);\n    },\n    _removeInlineTagsInPre: function()\n    {\n        var $editor = this.editor.getElement();\n        var tags = this.opts.inlineTags;\n\n        setTimeout(function()\n        {\n            $editor.find('pre').each(function(node)\n            {\n                var $node = $R.dom(node);\n                if ($node.closest('figure').length === 0)\n                {\n                    $node.find(tags.join(',')).not('code, .redactor-selection-marker').unwrap();\n                }\n            });\n\n        }, 1);\n    }\n});\n$R.add('class', 'input.enter', {\n    init: function(app, e)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.caret = app.caret;\n        this.editor = app.editor;\n        this.keycodes = app.keycodes;\n        this.detector = app.detector;\n        this.insertion = app.insertion;\n        this.selection = app.selection;\n        this.inspector = app.inspector;\n\n        // init\n        this._init(e);\n    },\n    // private\n    _init: function(e)\n    {\n        // turn off\n        if (!this.opts.enterKey) return this._disable(e);\n\n        // callback\n        var stop = this.app.broadcast('enter', e);\n        if (stop === false) return e.preventDefault();\n\n        // has non-editable\n        if (this.selection.hasNonEditable())\n        {\n            e.preventDefault();\n            return;\n        }\n\n        // shift enter\n        if (e.ctrlKey || e.shiftKey) {\n            return this._insertBreak(e);\n        }\n\n        // enter & exit\n        if (this._isExit(e)) return;\n\n        // traverse\n        this._traverse(e);\n    },\n    _disable: function(e)\n    {\n        e.preventDefault();\n        var range = this.selection.getRange();\n        if (range && !range.collapsed) range.deleteContents();\n    },\n    _insertBreak: function(e)\n    {\n        e.preventDefault();\n\n        var current = this.selection.getCurrent();\n        var block = this.selection.getBlock();\n        var data = this.inspector.parse(current);\n\n        if (data.isHeading() && this.caret.isStart(block)) {\n            var $block = $R.dom(block);\n            var $newBlock = $block.clone().html('');\n            $block.before($newBlock);\n            this.caret.setStart($block);\n        }\n        else if ((data.isComponent() && !data.isComponentEditable()) || data.isCode()) return;\n        else if (data.isPre()) this.insertion.insertNewline();\n        else this.insertion.insertBreakLine();\n    },\n    _isExit: function(e)\n    {\n        var $editor = this.editor.getElement();\n        var block = this.selection.getBlock();\n        var data = this.inspector.parse(block);\n        var isEnd = this.caret.isEnd(block);\n        var current = this.selection.getCurrent();\n        var prev = current.previousSibling;\n\n        // blockquote\n        if (data.isBlockquote())\n        {\n            var isParagraphExit = (isEnd && this._isExitableBlock(block, 'P'));\n            var isBreaklineExit = (isEnd && this._isExitableDblBreak(prev));\n\n            if (isParagraphExit || isBreaklineExit)\n            {\n                return this._exitFromElement(e, ((isBreaklineExit) ? prev : block), data.getBlockquote());\n            }\n        }\n        // pre\n        else if (!data.isComponentType('code') && data.isPre())\n        {\n            if (isEnd)\n            {\n                var html = block.innerHTML;\n                html = this.utils.removeInvisibleChars(html);\n                if (html.match(/(\\n\\n\\n)$/) !== null)\n                {\n                    $R.dom(prev.previousSibling.previousSibling).remove();\n                    return this._exitFromElement(e, prev, block);\n                }\n            }\n        }\n        // dl\n        else if (data.isDl())\n        {\n            if (isEnd && this._isExitableBlock(block, 'DT'))\n            {\n                return this._exitFromElement(e, block, data.getDl());\n            }\n        }\n        // li\n        else if (data.isList())\n        {\n            var list = $R.dom(current).parents('ul, ol', $editor).last();\n\n            isEnd = this.caret.isEnd(list);\n            if (isEnd && this._isExitableBlock(block, 'LI'))\n            {\n                return this._exitFromElement(e, block, list);\n            }\n        }\n        else if (data.isComponent() && data.isComponentActive() && !data.isFigcaption() && !data.isComponentEditable())\n        {\n            return this._exitFromElement(e, false, data.getComponent());\n        }\n    },\n    _isExitableDblBreak: function(prev)\n    {\n        var next = (prev) ? prev.nextSibling : false;\n        if (next)\n        {\n            var text = this.utils.removeInvisibleChars(next.textContent);\n\n            return (next.nodeType === 3 && text.trim() === '');\n        }\n    },\n    _isExitableBlock: function(block, tag)\n    {\n        return (block && block.tagName === tag && this.utils.isEmptyHtml(block.innerHTML));\n    },\n    _exitFromElement: function(e, prev, el)\n    {\n        e.preventDefault();\n        if (prev) $R.dom(prev).remove();\n        this.utils.createMarkup(el);\n\n        return true;\n    },\n    _exitNextElement: function(e, node)\n    {\n        e.preventDefault();\n\n        if (node.nextSibling) this.caret.setStart(node.nextSibling);\n        else this.utils.createMarkup(node);\n\n        return true;\n    },\n    _traverse: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var isText = this.selection.isText();\n        var block = this.selection.getBlock();\n        var data = this.inspector.parse(current);\n        var blockTag = (block) ? block.tagName.toLowerCase() : false;\n        var $variable = $R.dom(current).closest('[data-redactor-type=variable]');\n        // variable parent\n        if ($variable.length !== 0) {\n            this.caret.setAfter($variable);\n        }\n\n        // pre\n        if (data.isPre())\n        {\n            e.preventDefault();\n            return this.insertion.insertNewline();\n        }\n        // blockquote\n        else if (data.isBlockquote())\n        {\n            block = this.selection.getBlock(current);\n            if (block && block.tagName === 'BLOCKQUOTE')\n            {\n                e.preventDefault();\n                return this.insertion.insertBreakLine();\n            }\n        }\n        // figcaption\n        else if (data.isFigcaption())\n        {\n            block = data.getFigcaption();\n            var isEnd = this.caret.isEnd(block);\n            var isEndEditor = this.caret.isEnd();\n            if (isEnd || isEndEditor)\n            {\n                return this._exitNextElement(e, data.getComponent());\n            }\n            else\n            {\n                e.preventDefault();\n                return;\n            }\n        }\n        // dl\n        else if (data.isDl())\n        {\n            e.preventDefault();\n            return this._traverseDl(current);\n        }\n        // breakline\n        else if (this.opts.breakline && blockTag === 'div') {\n            setTimeout(this._replaceBlock.bind(this), 1);\n            return;\n        }\n        // text\n        else if (isText)\n        {\n            e.preventDefault();\n            return this.insertion.insertBreakLine();\n        }\n        // list\n        else if (data.isList()) {\n            return;\n        }\n        // div / p\n        else\n        {\n            var delay = (!this.detector.isDesktop()) ? 1 : 50;\n            setTimeout(this._replaceBlock.bind(this), delay);\n            return;\n        }\n\n    },\n    _traverseDl: function(current)\n    {\n        var block = this.selection.getBlock(current);\n        var data = this.inspector.parse(block);\n        var tag = data.getTag();\n        var $el = $R.dom(block);\n        var next = $el.get().nextSibling || false;\n        var $next = $R.dom(next);\n        var nextDd = (next && $next.is('dd'));\n        var nextDt = (next && $next.is('dt'));\n        var isEnd = this.caret.isEnd(block);\n\n        if (tag === 'dt' && !nextDd && isEnd)\n        {\n            var dd = document.createElement('dd');\n            $el.after(dd);\n\n            this.caret.setStart(dd);\n            return;\n        }\n        else if (tag === 'dd' && !nextDt && isEnd)\n        {\n            var dt = document.createElement('dt');\n            $el.after(dt);\n\n            this.caret.setStart(dt);\n            return;\n        }\n\n        return this.insertion.insertBreakLine();\n    },\n    _replaceBlock: function()\n    {\n        var block = this.selection.getBlock();\n        var $block = $R.dom(block);\n\n        if (this.opts.markup === 'p' && block && this._isNeedToReplaceBlock(block))\n        {\n            var markup = document.createElement(this.opts.markup);\n            $block.replaceWith(markup);\n            this.caret.setStart(markup);\n        }\n        else\n        {\n            if (block)\n            {\n                if (this.utils.isEmptyHtml(block.innerHTML))\n                {\n                    this._clearBlock($block, block);\n                }\n                else\n                {\n                    var first = this.utils.getFirstNode(block);\n                    if (first && first.tagName === 'BR')\n                    {\n                        $R.dom(first).remove();\n                        this.caret.setStart(block);\n                    }\n                }\n            }\n        }\n\n        // remove id\n        $block.removeAttr('id');\n\n        if (block && this._isNeedToCleanBlockStyle(block) && this.opts.cleanOnEnter)\n        {\n            $block.removeAttr('class style');\n        }\n\n        if (this.opts.breakline && block && block.tagName === 'DIV')\n        {\n            //$block.append(document.createElement('br'));\n            //$block.attr('data-redactor-tag', 'br');\n        }\n    },\n    _clearBlock: function($block, block)\n    {\n        if (block.tagName === 'DIV') {\n            $block.find('br').remove();\n        }\n\n        if (this.opts.cleanInlineOnEnter || block.innerHTML === '<br>')\n        {\n            $block.html('');\n        }\n\n        this.caret.setStart(block);\n    },\n    _isNeedToReplaceBlock: function(block)\n    {\n        return (block.tagName === 'DIV' && this.utils.isEmptyHtml(block.innerHTML));\n    },\n    _isNeedToCleanBlockStyle: function(block)\n    {\n        return (block.tagName === 'P' && this.utils.isEmptyHtml(block.innerHTML));\n    }\n});\n$R.add('class', 'input.paste', {\n    init: function(app, e, dataTransfer, html, point)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.editor = app.editor;\n        this.cleaner = app.cleaner;\n        this.container = app.container;\n        this.inspector = app.inspector;\n        this.insertion = app.insertion;\n        this.selection = app.selection;\n        this.autoparser = app.autoparser;\n\n        // local\n        this.pasteHtml = html;\n        this.pointInserted = point;\n        this.dataTransfer = dataTransfer;\n\n        // init\n        this._init(e);\n    },\n    // private\n    _init: function(e)\n    {\n        var clipboard = this.dataTransfer || e.clipboardData;\n        var current = this.selection.getCurrent();\n        var dataCurrent = this.inspector.parse(current);\n\n        this.dropPasted = this.dataTransfer;\n        //this.isRawCode = (this.dropPasted) ? (dataCurrent.isPre() || dataCurrent.isCode()) : this._isPlainText(clipboard);\n        this.isRawCode = (dataCurrent.isPre() || dataCurrent.isCode());\n\n        this.editor.enablePasting();\n        this.editor.saveScroll();\n\n        if (!this.dropPasted)\n        {\n            this.selection.saveMarkers();\n        }\n\n        if (this.isRawCode || !clipboard)\n        {\n\n            var text;\n            if (!this.isRawCode && !clipboard && window.clipboardData)\n            {\n                text = window.clipboardData.getData(\"text\");\n            }\n            else\n            {\n                text = clipboard.getData(\"text/plain\");\n            }\n\n            e.preventDefault();\n            this._insert(e, text);\n            return;\n        }\n        else if (this.pasteHtml)\n        {\n            e.preventDefault();\n            this._insert(e, this.pasteHtml);\n        }\n        else\n        {\n            // html / text\n            var url = clipboard.getData('URL');\n            var html = (this._isPlainText(clipboard)) ? this.cleaner.encodeEntities(clipboard.getData(\"text/plain\")) : clipboard.getData(\"text/html\");\n\n            // safari anchor links\n            html = (!url || url === '') ? html : url;\n\n            // file\n            if (clipboard.files !== null && clipboard.files.length > 0 && html === '')\n            {\n                var files = [];\n                for (var i = 0; i < clipboard.files.length; i++)\n                {\n                    var file = clipboard.files[i] || clipboard.items[i].getAsFile();\n                    if (file) files.push(file);\n                }\n\n                if (files.length > 0)\n                {\n                    e.preventDefault();\n                    this._insertFiles(e, files);\n                    return;\n                }\n            }\n\n\n            e.preventDefault();\n            this._insert(e, html);\n        }\n    },\n    _isPlainText: function(clipboard)\n    {\n        var text = clipboard.getData(\"text/plain\");\n        var html = clipboard.getData(\"text/html\");\n\n        if (text && html)\n        {\n            var element = document.createElement(\"div\");\n            element.innerHTML = html;\n\n            if (element.textContent === text)\n            {\n                return !element.querySelector(\":not(meta)\");\n            }\n        }\n        else\n        {\n            return (text !== null);\n        }\n    },\n    _restoreSelection: function()\n    {\n        this.editor.restoreScroll();\n        this.editor.disablePasting();\n        if (!this.dropPasted)\n        {\n            this.selection.restoreMarkers();\n        }\n    },\n    _insert: function(e, html)\n    {\n        // pasteBefore callback\n        var returned = this.app.broadcast('pasteBefore', html);\n        html = (returned === undefined) ? html : returned;\n\n        // clean\n        html = html.trim();\n        html = (this.isRawCode) ? html : this.cleaner.paste(html);\n        html = html.trim();\n        html = (this.isRawCode) ? this.cleaner.encodePhpCode(html) : html;\n\n        // paste callback\n        returned = this.app.broadcast('pasting', html);\n        html = (returned === undefined) ? html : returned;\n\n        this._restoreSelection();\n\n        // stop input\n        if (!this.opts.input) return;\n\n        this.app.broadcast('state', false);\n\n        // insert\n        var nodes = [];\n        if (this.isRawCode) {\n            html = html.replace('&lt;?php', '<?php');\n\n            var textNode = document.createTextNode(html);\n            nodes = this.insertion.insertNode(textNode, 'after');\n\n            this.app.broadcast('pasted', nodes);\n        }\n        else {\n\n            // autoparse\n            if (this.opts.autoparse && this.opts.autoparsePaste)\n            {\n                html = this.autoparser.parse(html);\n            }\n\n            nodes = (this.dropPasted) ? this.insertion.insertToPoint(e, html, this.pointInserted) : this.insertion.insertHtml(html);\n\n            // pasted callback\n            this.app.broadcast('pasted', nodes);\n            this.app.broadcast('autoparseobserve');\n        }\n\n    },\n    _insertFiles: function(e, files)\n    {\n        this._restoreSelection();\n\n        // drop or clipboard\n        var isImage = (this.opts.imageTypes.indexOf(files[0].type) !== -1);\n        var isClipboard = (typeof this.dropPasted === 'undefined');\n\n        if (isImage) this.app.broadcast('dropimage', e, files, isClipboard);\n        else this.app.broadcast('dropfile', e, files, isClipboard);\n    }\n});\n$R.add('class', 'input.shortcode', {\n    init: function(app, e, key)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.marker = app.marker;\n        this.keycodes = app.keycodes;\n        this.selection = app.selection;\n\n        // local\n        this.worked = false;\n\n        // init\n        if (key === this.keycodes.SPACE) this._init();\n    },\n    // public\n    is: function()\n    {\n        return this.worked;\n    },\n    // private\n    _init: function()\n    {\n        var current = this.selection.getCurrent();\n        if (current && current.nodeType === 3)\n        {\n            var text = this.utils.removeInvisibleChars(current.textContent);\n            var shortcodes = this.opts.shortcodes;\n            for (var name in shortcodes)\n            {\n                var re = new RegExp('^' + this.utils.escapeRegExp(name));\n                var match = text.match(re);\n                if (match !== null)\n                {\n                    if (typeof shortcodes[name].format !== 'undefined')\n                    {\n                        return this._format(shortcodes[name].format, current, re);\n                    }\n                }\n            }\n        }\n    },\n    _format: function(tag, current, re)\n    {\n        var marker = this.marker.insert('start');\n        current = marker.previousSibling;\n\n        var text = current.textContent;\n        text = this.utils.trimSpaces(text);\n        text = text.replace(re, '');\n        current.textContent = text;\n\n        var api = (tag === 'ul' || tag === 'ol') ? 'module.list.toggle' : 'module.block.format';\n\n        this.app.api(api, tag);\n        this.selection.restoreMarkers();\n\n        this.worked = true;\n    }\n});\n$R.add('class', 'input.shortcut', {\n    init: function(app, e)\n    {\n        this.app = app;\n        this.opts = app.opts;\n\n        // local\n        this.worked = false;\n\n        // based on https://github.com/jeresig/jquery.hotkeys\n        this.hotkeys = {\n            8: \"backspace\", 9: \"tab\", 10: \"return\", 13: \"return\", 16: \"shift\", 17: \"ctrl\", 18: \"alt\", 19: \"pause\",\n            20: \"capslock\", 27: \"esc\", 32: \"space\", 33: \"pageup\", 34: \"pagedown\", 35: \"end\", 36: \"home\",\n            37: \"left\", 38: \"up\", 39: \"right\", 40: \"down\", 45: \"insert\", 46: \"del\", 59: \";\", 61: \"=\",\n            96: \"0\", 97: \"1\", 98: \"2\", 99: \"3\", 100: \"4\", 101: \"5\", 102: \"6\", 103: \"7\",\n            104: \"8\", 105: \"9\", 106: \"*\", 107: \"+\", 109: \"-\", 110: \".\", 111 : \"/\",\n            112: \"f1\", 113: \"f2\", 114: \"f3\", 115: \"f4\", 116: \"f5\", 117: \"f6\", 118: \"f7\", 119: \"f8\",\n            120: \"f9\", 121: \"f10\", 122: \"f11\", 123: \"f12\", 144: \"numlock\", 145: \"scroll\", 173: \"-\", 186: \";\", 187: \"=\",\n            188: \",\", 189: \"-\", 190: \".\", 191: \"/\", 192: \"`\", 219: \"[\", 220: \"\\\\\", 221: \"]\", 222: \"'\"\n        };\n\n        this.hotkeysShiftNums = {\n            \"`\": \"~\", \"1\": \"!\", \"2\": \"@\", \"3\": \"#\", \"4\": \"$\", \"5\": \"%\", \"6\": \"^\", \"7\": \"&\",\n            \"8\": \"*\", \"9\": \"(\", \"0\": \")\", \"-\": \"_\", \"=\": \"+\", \";\": \": \", \"'\": \"\\\"\", \",\": \"<\",\n            \".\": \">\",  \"/\": \"?\",  \"\\\\\": \"|\"\n        };\n\n        // init\n        this._init(e);\n    },\n    // public\n    is: function()\n    {\n        return this.worked;\n    },\n    // private\n    _init: function(e)\n    {\n        // disable browser's hot keys for bold and italic if shortcuts off\n        if (this.opts.shortcuts === false)\n        {\n            if ((e.ctrlKey || e.metaKey) && (e.which === 66 || e.which === 73)) e.preventDefault();\n            return;\n        }\n\n        // build\n        for (var key in this.opts.shortcuts)\n        {\n            this._build(e, key, this.opts.shortcuts[key]);\n        }\n    },\n    _build: function(e, str, command)\n    {\n        var keys = str.split(',');\n        var len = keys.length;\n        for (var i = 0; i < len; i++)\n        {\n            if (typeof keys[i] === 'string')\n            {\n                this._handler(e, keys[i].trim(), command);\n            }\n        }\n    },\n    _handler: function(e, keys, command)\n    {\n        keys = keys.toLowerCase().split(\" \");\n\n        var special = this.hotkeys[e.keyCode];\n        var character = String.fromCharCode(e.which).toLowerCase();\n        var modif = \"\", possible = {};\n        var cmdKeys = [\"meta\", \"ctrl\", \"alt\", \"shift\"];\n\n        for (var i = 0; i < cmdKeys.length; i++)\n        {\n            var specialKey = cmdKeys[i];\n            if (e[specialKey + 'Key'] && special !== specialKey)\n            {\n                modif += specialKey + '+';\n            }\n        }\n\n        if (special) possible[modif + special] = true;\n        if (character)\n        {\n            possible[modif + character] = true;\n            possible[modif + this.hotkeysShiftNums[character]] = true;\n\n            // \"$\" can be triggered as \"Shift+4\" or \"Shift+$\" or just \"$\"\n            if (modif === \"shift+\")\n            {\n                possible[this.hotkeysShiftNums[character]] = true;\n            }\n        }\n\n        var len = keys.length;\n        for (var i = 0; i < len; i++)\n        {\n            if (possible[keys[i]])\n            {\n\n                e.preventDefault();\n                this.worked = true;\n\n                if (command.message)\n                {\n                    this.app.broadcast(command.message, command.args);\n                    this.app.broadcast('buffer.trigger');\n                }\n                else if (command.api)\n                {\n                    this.app.api(command.api, command.args);\n                    this.app.broadcast('buffer.trigger');\n                }\n\n                return;\n            }\n        }\n    }\n});\n$R.add('class', 'input.space', {\n    init: function(app, e, key, lastShiftKey)\n    {\n        this.app = app;\n        this.keycodes = app.keycodes;\n        this.insertion = app.insertion;\n        this.selection = app.selection;\n\n        // local\n        this.key = key;\n        this.lastShiftKey = lastShiftKey;\n\n        // init\n        this._init(e);\n    },\n    // private\n    _init: function(e)\n    {\n        // has non-editable\n        if (this.selection.hasNonEditable())\n        {\n            e.preventDefault();\n            return;\n        }\n\n        // shift/ctrl + space\n        if (!this.lastShiftKey && this.key === this.keycodes.SPACE && (e.ctrlKey || e.shiftKey) && !e.metaKey)\n        {\n            e.preventDefault();\n            this.insertion.insertChar('&nbsp;');\n            return;\n        }\n    }\n});\n$R.add('class', 'input.tab', {\n    init: function(app, e)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.inspector = app.inspector;\n        this.insertion = app.insertion;\n        this.selection = app.selection;\n\n        // init\n        this._init(e);\n    },\n    // private\n    _init: function(e)\n    {\n        // turn off tab\n        if (!this.opts.tabKey) return;\n\n        // callback\n        var stop = this.app.broadcast('tab', e);\n        if (stop === false) return e.preventDefault();\n\n        // traverse\n        this._traverse(e);\n    },\n    _traverse: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n\n        // hard tab\n        if (!data.isComponent() && e.shiftKey)\n        {\n            return this._insertHardTab(e, 4);\n        }\n\n        // list\n        if (data.isList())\n        {\n            e.preventDefault();\n            return this.app.api('module.list.indent');\n        }\n        // pre\n        if (data.isPre() || (data.isComponentType('code') && !data.isFigcaption()))\n        {\n            return this._tabCode(e);\n        }\n\n        // tab as spaces\n        if (this.opts.tabAsSpaces !== false)\n        {\n            return this._insertHardTab(e, this.opts.tabAsSpaces);\n        }\n    },\n    _insertHardTab: function(e, num)\n    {\n        e.preventDefault();\n        var node = document.createTextNode(Array(num + 1).join('\\u00a0'));\n        return this.insertion.insertNode(node, 'end');\n    },\n    _tabCode: function(e)\n    {\n        e.preventDefault();\n\n        var node = (this.opts.preSpaces) ? document.createTextNode(Array(this.opts.preSpaces + 1).join('\\u00a0')) : document.createTextNode('\\t');\n\n        return this.insertion.insertNode(node, 'end');\n    }\n});\n$R.add('module', 'upload', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.lang = app.lang;\n        this.utils = app.utils;\n        this.editor = app.editor;\n        this.progress = app.progress;\n\n        // local\n        this.defaults = {\n            event: false,\n            element: false,\n            name: false,\n            files: false,\n            url: false,\n            data: false,\n            paramName: false\n        };\n    },\n    // public\n    build: function(options)\n    {\n        this.p = $R.extend(this.defaults, options);\n        this.$el = $R.dom(this.p.element);\n\n        if (this.$el.get().tagName === 'INPUT') this._buildInput();\n        else                                    this._buildBox();\n    },\n    send: function(options)\n    {\n        this.p = $R.extend(this.defaults, options);\n        this.$uploadbox = this.editor.getElement();\n        this._send(this.p.event, this.p.files);\n    },\n    complete: function(response, e)\n    {\n        this._complete(response, e);\n    },\n\n    // private\n    _buildInput: function()\n    {\n        this.box = false;\n        this.prefix = '';\n\n        this.$uploadbox = $R.dom('<div class=\"upload-redactor-box\" />');\n\n        this.$el.hide();\n        this.$el.after(this.$uploadbox);\n\n        if (this.opts.multipleUpload) this.$el.attr('multiple', 'multiple');\n        else this.$el.removeAttr('multiple');\n\n        if (this.p.name !== 'file')\n        {\n            this.$el.attr('accept', 'image/*');\n        }\n\n        this._buildPlaceholder();\n        this._buildEvents();\n    },\n    _buildBox: function()\n    {\n        this.box = true;\n        this.prefix = 'box-';\n\n        this.$uploadbox = this.$el;\n        this.$uploadbox.attr('ondragstart', 'return false;');\n\n        // events\n        this.$uploadbox.on('drop.redactor.upload', this._onDropBox.bind(this));\n        this.$uploadbox.on('dragover.redactor.upload', this._onDragOver.bind(this));\n        this.$uploadbox.on('dragleave.redactor.upload', this._onDragLeave.bind(this));\n    },\n    _buildPlaceholder: function()\n    {\n        this.$placeholder = $R.dom('<div class=\"upload-redactor-placeholder\" />');\n        this.$placeholder.html(this.lang.get('upload-label'));\n        this.$uploadbox.append(this.$placeholder);\n    },\n    _buildEvents: function()\n    {\n        this.$el.on('change.redactor.upload', this._onChange.bind(this));\n        this.$uploadbox.on('click.redactor.upload', this._onClick.bind(this));\n        this.$uploadbox.on('drop.redactor.upload', this._onDrop.bind(this));\n        this.$uploadbox.on('dragover.redactor.upload', this._onDragOver.bind(this));\n        this.$uploadbox.on('dragleave.redactor.upload', this._onDragLeave.bind(this));\n    },\n    _onClick: function(e)\n    {\n        e.preventDefault();\n        this.$el.click();\n    },\n    _onChange: function(e)\n    {\n        this._send(e, this.$el.get().files);\n    },\n    _onDrop: function(e)\n    {\n        e.preventDefault();\n\n        this._clear();\n        this._setStatusDrop();\n        this._send(e);\n    },\n    _onDragOver: function(e)\n    {\n        e.preventDefault();\n        this._setStatusHover();\n\n        return false;\n    },\n    _onDragLeave: function(e)\n    {\n        e.preventDefault();\n        this._removeStatusHover();\n\n        return false;\n    },\n    _onDropBox: function(e)\n    {\n        e.preventDefault();\n\n        this._clear();\n        this._setStatusDrop();\n        this._send(e);\n    },\n    _removeStatusHover: function()\n    {\n        this.$uploadbox.removeClass('upload-redactor-' + this.prefix + 'hover');\n    },\n    _setStatusDrop: function()\n    {\n        this.$uploadbox.addClass('upload-redactor-' + this.prefix + 'drop');\n    },\n    _setStatusHover: function()\n    {\n        this.$uploadbox.addClass('upload-redactor-' + this.prefix + 'hover');\n    },\n    _setStatusError: function()\n    {\n        this.$uploadbox.addClass('upload-redactor-' + this.prefix + 'error');\n    },\n    _setStatusSuccess: function()\n    {\n        this.$uploadbox.addClass('upload-redactor-' + this.prefix + 'success');\n    },\n    _clear: function()\n    {\n        var classes = ['drop', 'hover', 'error', 'success'];\n        for (var i = 0; i < classes.length; i++)\n        {\n            this.$uploadbox.removeClass('upload-redactor-' + this.prefix + classes[i]);\n        }\n\n        this.$uploadbox.removeAttr('ondragstart');\n    },\n    _send: function(e, files)\n    {\n        e = e.originalEvent || e;\n\n        files = (files) ? files : e.dataTransfer.files;\n\n        var data = new FormData();\n        var name = this._getUploadParam();\n\n        data = this._buildData(name, files, data);\n        data = this.utils.extendData(data, this.p.data);\n\n        var stop = this.app.broadcast('upload.start', e, data, files);\n        if (stop !== false)\n        {\n            this._sendData(data, files, e);\n        }\n    },\n    _sendData: function(data, files, e)\n    {\n        this.progress.show();\n        if (typeof this.p.url === 'function')\n        {\n            var res = this.p.url(data, files, e, this);\n            if (!(res instanceof Promise))\n            {\n                this._complete(res, e);\n            }\n        }\n        else\n        {\n            $R.ajax.post({\n                url: this.p.url,\n                data: data,\n                before: function(xhr)\n                {\n                    return this.app.broadcast('upload.beforeSend', xhr);\n\n                }.bind(this),\n                success: function(response)\n                {\n                    this._complete(response, e);\n                }.bind(this),\n                error: function(response, xhr, status)\n                {\n                    this._complete(response, e, status);\n                }.bind(this)\n            });\n        }\n    },\n    _getUploadParam: function()\n    {\n        return (this.p.paramName) ? this.p.paramName : 'file';\n    },\n    _buildData: function(name, files, data)\n    {\n        if (files.length === 1)\n        {\n            data.append(name + '[]', files[0]);\n        }\n        else if (files.length > 1 && this.opts.multipleUpload !== false)\n        {\n            for (var i = 0; i < files.length; i++)\n            {\n                data.append(name + '[]', files[i]);\n            }\n        }\n\n        return data;\n    },\n    _complete: function(response, e, status)\n    {\n        this._clear();\n        this.progress.hide();\n\n        if (response && response.error)\n        {\n            this._setStatusError();\n\n            this.app.broadcast('upload.' + this.p.name + '.error', response, e, status);\n            this.app.broadcast('upload.error', response, status);\n        }\n        else\n        {\n            this._setStatusSuccess();\n\n            this.app.broadcast('upload.' + this.p.name + '.complete', response, e);\n            this.app.broadcast('upload.complete', response);\n\n            setTimeout(this._clear.bind(this), 500);\n        }\n    }\n});\n$R.add('class', 'code.component', {\n    mixins: ['dom', 'component'],\n    init: function(app, el)\n    {\n        this.app = app;\n\n        // init\n        return (el && el.cmnt !== undefined) ? el : this._init(el);\n    },\n\n    // private\n   _init: function(el)\n    {\n        var $pre;\n        if (typeof el !== 'undefined')\n        {\n            var $node = $R.dom(el);\n            var $wrapper = $node.closest('figure');\n            if ($wrapper.length !== 0)\n            {\n                this.parse($wrapper);\n            }\n            else\n            {\n                this.parse('<figure>');\n                this.append(el);\n            }\n\n            $pre = this.find('pre code, pre').last();\n        }\n        else\n        {\n            $pre = $R.dom('<pre>');\n\n            this.parse('<figure>');\n            this.append($pre);\n        }\n\n        this._initElement($pre);\n        this._initWrapper();\n    },\n    _initElement: function($pre)\n    {\n        $pre.attr({\n            'tabindex': '-1',\n            'contenteditable': true\n        });\n    },\n    _initWrapper: function()\n    {\n        this.addClass('redactor-component');\n        this.attr({\n            'data-redactor-type': 'code',\n            'tabindex': '-1',\n            'contenteditable': false\n        });\n    }\n});\n$R.add('module', 'form', {\n    init: function(app)\n    {\n        this.app = app;\n        this.lang = app.lang;\n        this.component = app.component;\n        this.inspector = app.inspector;\n    },\n    // messages\n    onform: {\n        remove: function(node)\n        {\n            this._remove(node);\n        }\n    },\n    oncontextbar: function(e, contextbar)\n    {\n        var data = this.inspector.parse(e.target);\n        if (data.isComponentType('form'))\n        {\n            var node = data.getComponent();\n            var buttons = {\n                \"remove\": {\n                    title: this.lang.get('delete'),\n                    api: 'module.form.remove',\n                    args: node\n                }\n            };\n\n            contextbar.set(e, node, buttons, 'top');\n        }\n\n    },\n\n    // private\n    _remove: function(node)\n    {\n        this.component.remove(node);\n    }\n});\n$R.add('class', 'form.component', {\n    mixins: ['dom', 'component'],\n    init: function(app, el)\n    {\n        this.app = app;\n        this.utils = app.utils;\n\n        // init\n        return (el && el.cmnt !== undefined) ? el : this._init(el);\n    },\n    // private\n    _init: function(el)\n    {\n        if (typeof el !== 'undefined')\n        {\n            var $node = $R.dom(el);\n            var $wrapper = $node.closest('form');\n            if ($wrapper.length !== 0)\n            {\n                var $figure = this.utils.replaceToTag(el, 'figure');\n                this.parse($figure);\n            }\n            else\n            {\n                this.parse('<figure>');\n                this.append(el);\n            }\n        }\n        else\n        {\n            this.parse('<figure>');\n        }\n\n        this._initWrapper();\n    },\n    _initWrapper: function()\n    {\n        this.addClass('redactor-component');\n        this.attr({\n            'data-redactor-type': 'form',\n            'tabindex': '-1',\n            'contenteditable': false\n        });\n    }\n});\n$R.add('module', 'image', {\n    modals: {\n        'image':\n            '<div class=\"redactor-modal-tab redactor-modal-tab-upload\" data-title=\"## upload ##\"><form action=\"\"> \\\n                <input type=\"file\" name=\"file\"> \\\n            </form></div>',\n        'imageedit':\n            '<div class=\"redactor-modal-group\"> \\\n                <div id=\"redactor-modal-image-preview\" class=\"redactor-modal-side\"></div> \\\n                <form action=\"\" class=\"redactor-modal-area\"> \\\n                    <div class=\"form-item\"> \\\n                        <label for=\"modal-image-title\"> ## title ##</label> \\\n                        <input type=\"text\" id=\"modal-image-title\" name=\"title\" /> \\\n                    </div> \\\n                    <div class=\"form-item form-item-caption\"> \\\n                        <label for=\"modal-image-caption\">## caption ##</label> \\\n                        <input type=\"text\" id=\"modal-image-caption\" name=\"caption\" aria-label=\"## caption ##\" /> \\\n                    </div> \\\n                    <div class=\"form-item form-item-align\"> \\\n                        <label>## image-position ##</label> \\\n                        <select name=\"align\" aria-label=\"## image-position ##\"> \\\n                            <option value=\"none\">## none ##</option> \\\n                            <option value=\"left\">## left ##</option> \\\n                            <option value=\"center\">## center ##</option> \\\n                            <option value=\"right\">## right ##</option> \\\n                        </select> \\\n                    </div> \\\n                    <div class=\"form-item form-item-link\"> \\\n                        <label for=\"modal-image-url\">## link ##</label> \\\n                        <input type=\"text\" id=\"modal-image-url\" name=\"url\" aria-label=\"## link ##\" /> \\\n                    </div> \\\n                    <div class=\"form-item form-item-link\"> \\\n                        <label class=\"checkbox\"><input type=\"checkbox\" name=\"target\" aria-label=\"## link-in-new-tab ##\"> ## link-in-new-tab ##</label> \\\n                    </div> \\\n                </form> \\\n            </div>'\n    },\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.lang = app.lang;\n        this.caret = app.caret;\n        this.utils = app.utils;\n        this.editor = app.editor;\n        this.storage = app.storage;\n        this.component = app.component;\n        this.inspector = app.inspector;\n        this.insertion = app.insertion;\n        this.selection = app.selection;\n\n        // local\n        this.justResized = false;\n    },\n    // messages\n    oninsert: function()\n    {\n        this._observeImages();\n    },\n    onstarted: function()\n    {\n        // storage observe\n        this.storage.observeImages();\n\n        // resize\n        if (this.opts.imageResizable)\n        {\n            this.resizer = $R.create('image.resize', this.app);\n        }\n\n        // observe\n        this._observeImages();\n    },\n    ondropimage: function(e, files, clipboard)\n    {\n        if (!this.opts.imageUpload) return;\n\n        var options = {\n            url: this.opts.imageUpload,\n            event: (clipboard) ? false : e,\n            files: files,\n            name: 'imagedrop',\n            data: this.opts.imageData,\n            paramName: this.opts.imageUploadParam\n        };\n\n        this.app.api('module.upload.send', options);\n    },\n    onstop: function()\n    {\n        if (this.resizer) this.resizer.stop();\n    },\n    onbottomclick: function()\n    {\n        this.insertion.insertToEnd(this.editor.getLastNode(), 'image');\n    },\n    onimageresizer: {\n        stop: function()\n        {\n            if (this.resizer) this.resizer.hide();\n        }\n    },\n    onsource: {\n        open: function()\n        {\n            if (this.resizer) this.resizer.hide();\n        },\n        closed: function()\n        {\n            this._observeImages();\n            if (this.resizer) this.resizer.rebuild();\n        }\n    },\n    onupload: {\n        complete: function()\n        {\n            this._observeImages();\n        },\n        image: {\n            complete: function(response)\n            {\n                this._insert(response);\n                this.app.broadcast('state', false);\n            },\n            error: function(response)\n            {\n                this._uploadError(response);\n            }\n        },\n        imageedit: {\n            complete: function(response)\n            {\n                this._change(response);\n            },\n            error: function(response)\n            {\n                this._uploadError(response);\n            }\n        },\n        imagedrop: {\n            complete: function(response, e)\n            {\n                this._insert(response, e);\n            },\n            error: function(response)\n            {\n                this._uploadError(response);\n            }\n        },\n        imagereplace: {\n            complete: function(response)\n            {\n                this._change(response, false);\n            },\n            error: function(response)\n            {\n                this._uploadError(response);\n            }\n        }\n    },\n    onmodal: {\n        image: {\n            open: function($modal, $form)\n            {\n                this._setUpload($modal, $form);\n            }\n        },\n        imageedit: {\n            open: function($modal, $form)\n            {\n                this._setFormData($modal, $form);\n            },\n            opened: function($modal, $form)\n            {\n                this._setFormFocus($form);\n            },\n            remove: function()\n            {\n                this._remove(this.$image);\n            },\n            save: function($modal, $form)\n            {\n                this._save($modal, $form);\n            }\n        }\n    },\n    onimage: {\n        observe: function()\n        {\n            this._observeImages();\n        },\n        resized: function()\n        {\n            this.justResized = true;\n        }\n    },\n    oncontextbar: function(e, contextbar)\n    {\n        if (this.justResized)\n        {\n            this.justResized = false;\n            return;\n        }\n\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var $img = $R.dom(current).closest('img');\n\n        if ((!data.isFigcaption() && data.isComponentType('image')) || $img.length !== 0)\n        {\n            var node = ($img.length !== 0) ? $img.get() : data.getComponent();\n            var buttons = {\n                \"edit\": {\n                    title: this.lang.get('edit'),\n                    api: 'module.image.open'\n                },\n                \"remove\": {\n                    title: this.lang.get('delete'),\n                    api: 'module.image.remove',\n                    args: node\n                }\n            };\n\n            contextbar.set(e, node, buttons);\n        }\n    },\n\n    // public\n    open: function()\n    {\n        this.$image = this._getCurrent();\n        this.app.api('module.modal.build', this._getModalData());\n    },\n    insert: function(data)\n    {\n        this._insert(data);\n    },\n    remove: function(node)\n    {\n        this._remove(node);\n    },\n\n    // private\n    _getModalData: function()\n    {\n        var modalData;\n        if (this._isImage() && this.opts.imageEditable)\n        {\n            modalData = {\n                name: 'imageedit',\n                width: '800px',\n                title: this.lang.get('edit'),\n                handle: 'save',\n                commands: {\n                    save: { title: this.lang.get('save') },\n                    remove: { title: this.lang.get('delete'), type: 'danger' },\n                    cancel: { title: this.lang.get('cancel') }\n                }\n            };\n        }\n        else\n        {\n            modalData = {\n                name: 'image',\n                title: this.lang.get('image')\n            };\n        }\n\n        return modalData;\n    },\n    _isImage: function()\n    {\n        return this.$image;\n    },\n    _getCurrent: function()\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var $img = $R.dom(current).closest('img');\n\n        if ($img.length !== 0) {\n            return this.component.create('image', $img);\n        }\n        else {\n            return (data.isComponentType('image') && data.isComponentActive()) ? this.component.create('image', data.getComponent()) : false;\n        }\n    },\n    _insert: function(response, e)\n    {\n        this.app.api('module.modal.close');\n\n        if (Array.isArray(response))\n        {\n            var obj = {};\n            for (var i = 0; i < response.length; i++)\n            {\n                obj = $R.extend(obj, response[i]);\n            }\n\n            response = obj;\n        }\n        else if (typeof response === 'string')\n        {\n            response = { \"file\": { url: response }};\n        }\n\n        if (typeof response === 'object')\n        {\n\n            var multiple = 0;\n            for (var key in response)\n            {\n                if (typeof response[key] === 'object') multiple++;\n            }\n\n            if (multiple > 1)\n            {\n                this._insertMultiple(response, e);\n            }\n            else\n            {\n                this._insertSingle(response, e);\n            }\n        }\n    },\n    _insertSingle: function(response, e)\n    {\n        for (var key in response)\n        {\n            if (typeof response[key] === 'object')\n            {\n                var $img = this._createImageAndStore(response[key]);\n                var inserted = (e) ? this.insertion.insertToPoint(e, $img, false, false) : this.insertion.insertHtml($img, false);\n\n                this._removeSpaceBeforeFigure(inserted[0]);\n\n                // set is active\n                this.component.setActive(inserted[0]);\n                this.app.broadcast('image.uploaded', inserted[0], response);\n            }\n        }\n    },\n    _insertMultiple: function(response, e)\n    {\n        var z = 0;\n        var inserted = [];\n        var last;\n        for (var key in response)\n        {\n            if (typeof response[key] === 'object')\n            {\n                z++;\n\n                var $img = this._createImageAndStore(response[key]);\n\n                if (z === 1)\n                {\n                    inserted = (e) ? this.insertion.insertToPoint(e, $img, false, false) : this.insertion.insertHtml($img, false);\n                }\n                else\n                {\n                    var $inserted = $R.dom(inserted[0]);\n                    $inserted.after($img);\n                    inserted = [$img.get()];\n\n                    this.app.broadcast('image.inserted', $img);\n                }\n\n                last = inserted[0];\n\n                this._removeSpaceBeforeFigure(inserted[0]);\n                this.app.broadcast('image.uploaded', inserted[0], response);\n            }\n        }\n\n        // set last is active\n        this.component.setActive(last);\n    },\n    _createImageAndStore: function(item)\n    {\n        var $img = this.component.create('image');\n\n        $img.addClass('redactor-uploaded-figure');\n        $img.setData({\n            src: item.url,\n            id: (item.id) ? item.id : this.utils.getRandomId()\n        });\n\n        // add to storage\n        this.storage.add('image', $img.getElement());\n\n        return $img;\n    },\n    _removeSpaceBeforeFigure: function(img)\n    {\n        if (!img) return;\n\n        var prev = img.previousSibling;\n        var next = img.nextSibling;\n        var $prev = $R.dom(prev);\n        var $next = $R.dom(next);\n\n        if (this.opts.breakline) {\n            if (next && $next.attr('data-redactor-tag') === 'br') {\n                $next.find('br').first().remove();\n            }\n            if (prev && $prev.attr('data-redactor-tag') === 'br') {\n                $prev.find('br').last().remove();\n            }\n        }\n\n        if (prev)\n        {\n            this._removeInvisibleSpace(prev);\n            this._removeInvisibleSpace(prev.previousSibling);\n        }\n    },\n    _removeInvisibleSpace: function(el)\n    {\n        if (el && el.nodeType === 3 && this.utils.searchInvisibleChars(el.textContent) !== -1)\n        {\n            el.parentNode.removeChild(el);\n        }\n    },\n    _save: function($modal, $form)\n    {\n        var data = $form.getData();\n        var imageData = {\n            title: data.title\n        };\n\n        if (this.opts.imageLink) imageData.link = { url: data.url, target: data.target };\n        if (this.opts.imageCaption) imageData.caption = data.caption;\n        if (this.opts.imagePosition) imageData.align = data.align;\n\n        this.$image.setData(imageData);\n        if (this.resizer) this.resizer.rebuild();\n\n        this.app.broadcast('image.changed', this.$image);\n        this.app.api('module.modal.close');\n    },\n    _change: function(response, modal)\n    {\n        if (typeof response === 'string')\n        {\n            response = { \"file\": { url: response }};\n        }\n\n        if (typeof response === 'object')\n        {\n            var $img;\n            for (var key in response)\n            {\n                if (typeof response[key] === 'object')\n                {\n                    $img = $R.dom('<img>');\n                    $img.attr('src', response[key].url);\n\n                    this.$image.changeImage(response[key]);\n\n                    this.app.broadcast('image.changed', this.$image, response);\n                    this.app.broadcast('image.uploaded', this.$image, response);\n\n                    this.app.broadcast('hardsync');\n\n                    break;\n                }\n            }\n\n            if (modal !== false)\n            {\n                $img.on('load', function() { this.$previewBox.html($img); }.bind(this));\n            }\n        }\n    },\n    _uploadError: function(response)\n    {\n        this.app.broadcast('image.uploadError', response);\n    },\n    _remove: function(node)\n    {\n        this.app.api('module.modal.close');\n        this.component.remove(node);\n    },\n    _observeImages: function()\n    {\n        var $editor = this.editor.getElement();\n        var self = this;\n        $editor.find('img').each(function(node)\n        {\n            var $node = $R.dom(node);\n\n            $node.off('.drop-to-replace');\n            $node.on('dragover.drop-to-replace dragenter.drop-to-replace', function(e)\n            {\n                e.preventDefault();\n                return;\n            });\n\n            $node.on('drop.drop-to-replace', function(e)\n            {\n                if (!self.app.isDragComponentInside())\n                {\n                    return self._setReplaceUpload(e, $node);\n                }\n            });\n        });\n    },\n    _setFormData: function($modal, $form)\n    {\n        this._buildPreview($modal);\n        this._buildPreviewUpload();\n\n        var imageData = this.$image.getData();\n        var data = {\n            title: imageData.title\n        };\n\n        // caption\n        if (this.opts.imageCaption) data.caption = imageData.caption;\n        else $modal.find('.form-item-caption').hide();\n\n        // position\n        if (this.opts.imagePosition) data.align = imageData.align;\n        else $modal.find('.form-item-align').hide();\n\n        // link\n        if (this.opts.imageLink)\n        {\n            if (imageData.link)\n            {\n                data.url = imageData.link.url;\n                if (imageData.link.target) data.target = true;\n            }\n        }\n        else $modal.find('.form-item-link').hide();\n\n        $form.setData(data);\n    },\n    _setFormFocus: function($form)\n    {\n        $form.getField('title').focus();\n    },\n    _setReplaceUpload: function(e, $node)\n    {\n        e = e.originalEvent || e;\n        e.stopPropagation();\n        e.preventDefault();\n\n        if (!this.opts.imageUpload) return;\n\n        this.$image = this.component.create('image', $node);\n\n        var options = {\n            url: this.opts.imageUpload,\n            files: e.dataTransfer.files,\n            name: 'imagereplace',\n            data: this.opts.imageData,\n            paramName: this.opts.imageUploadParam\n        };\n\n        this.app.api('module.upload.send', options);\n\n        return;\n    },\n    _setUpload: function($modal, $form)\n    {\n        if (!this.opts.imageUpload) {\n            var $body = $modal.getBody();\n            var $tab = $body.find('.redactor-modal-tab-upload');\n            $tab.remove();\n        }\n\n        var options = {\n            url: this.opts.imageUpload,\n            element: $form.getField('file'),\n            name: 'image',\n            data: this.opts.imageData,\n            paramName: this.opts.imageUploadParam\n        };\n\n        this.app.api('module.upload.build', options);\n    },\n    _buildPreview: function($modal)\n    {\n        this.$preview = $modal.find('#redactor-modal-image-preview');\n\n        var imageData = this.$image.getData();\n        var $previewImg = $R.dom('<img>');\n        $previewImg.attr('src', imageData.src);\n\n        this.$previewBox = $R.dom('<div>');\n        this.$previewBox.append($previewImg);\n\n        this.$preview.html('');\n        this.$preview.append(this.$previewBox);\n    },\n    _buildPreviewUpload: function()\n    {\n        if (!this.opts.imageUpload) return;\n\n        var $desc = $R.dom('<div class=\"desc\">');\n        $desc.html(this.lang.get('upload-change-label'));\n\n        this.$preview.append($desc);\n\n        var options = {\n            url: this.opts.imageUpload,\n            element: this.$previewBox,\n            name: 'imageedit',\n            data: this.opts.imageData,\n            paramName: this.opts.imageUploadParam\n        };\n\n        this.app.api('module.upload.build', options);\n    }\n});\n$R.add('class', 'image.component', {\n    mixins: ['dom', 'component'],\n    init: function(app, el)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.selection = app.selection;\n\n        // init\n        return (el && el.cmnt !== undefined) ? el : this._init(el);\n    },\n    setData: function(data)\n    {\n        for (var name in data)\n        {\n            this._set(name, data[name]);\n        }\n    },\n    getData: function()\n    {\n        var names = ['src', 'title', 'caption', 'align', 'link', 'id'];\n        var data = {};\n\n        for (var i = 0; i < names.length; i++)\n        {\n            data[names[i]] = this._get(names[i]);\n        }\n\n        return data;\n    },\n    getElement: function()\n    {\n        return this.$element;\n    },\n    changeImage: function(data)\n    {\n        this.$element.attr('src', data.url);\n    },\n\n\n    // private\n    _init: function(el)\n    {\n        var $el = $R.dom(el);\n        var $figure = $el.closest('figure');\n\n        if (el === undefined)\n        {\n            this.$element = $R.dom('<img>');\n            this.parse('<figure>');\n            this.append(this.$element);\n        }\n        else if ($figure.length === 0)\n        {\n            this.parse('<figure>');\n            this.$element = $el;\n            this.$element.wrap(this);\n        }\n        else\n        {\n            this.parse($figure);\n            this.$element = this.find('img');\n        }\n\n        this._initWrapper();\n    },\n    _set: function(name, value)\n    {\n        this['_set_' + name](value);\n    },\n    _get: function(name)\n    {\n        return this['_get_' + name]();\n    },\n    _set_src: function(src)\n    {\n       this.$element.attr('src', src);\n    },\n    _set_id: function(id)\n    {\n        if (this.opts.imageObserve) {\n            this.$element.attr('data-image', id);\n        }\n    },\n    _set_title: function(title)\n    {\n        title = title.trim().replace(/(<([^>]+)>)/ig,\"\");\n\n        if (title === '')\n        {\n            this.$element.removeAttr('alt');\n        }\n        else\n        {\n            this.$element.attr('alt', title);\n        }\n\n    },\n    _set_caption: function(caption)\n    {\n        var $figcaption = this.find('figcaption');\n        if ($figcaption.length === 0)\n        {\n            $figcaption = $R.dom('<figcaption>');\n            $figcaption.attr('contenteditable', 'true');\n\n            this.append($figcaption);\n        }\n\n        if (caption === '') $figcaption.remove();\n        else $figcaption.html(caption);\n\n        return $figcaption;\n    },\n    _set_align: function(align)\n    {\n        var imageFloat = '';\n        var imageMargin = '';\n        var textAlign = '';\n        var $el = this;\n        var $img = this.find('img');\n        var $figcaption = this.find('figcaption');\n\n        if (typeof this.opts.imagePosition === 'object')\n        {\n            var positions = this.opts.imagePosition;\n            for (var key in positions)\n            {\n                $el.removeClass(positions[key]);\n            }\n\n            var alignClass = (typeof positions[align] !== 'undefined') ? positions[align] : false;\n            if (alignClass)\n            {\n                $el.addClass(alignClass);\n            }\n        }\n        else\n        {\n            var width = $img.width();\n\n            switch (align)\n            {\n\n                case 'left':\n                    imageFloat = 'left';\n                    imageMargin = this.opts.imageFloatMargin;\n                break;\n                case 'right':\n                    imageFloat = 'right';\n                    imageMargin = this.opts.imageFloatMargin;\n                break;\n                case 'center':\n                    textAlign = 'center';\n                    imageMargin = 'auto';\n                break;\n            }\n\n            $el.css({ 'float': imageFloat, width: width + 'px', maxWidth: width + 'px', 'margin-left': imageMargin, 'margin-right': imageMargin, 'text-align': textAlign });\n            $el.attr('rel', $el.attr('style'));\n\n            if (align === 'none') {\n                $el.css('max-width', '');\n                $el.css('width', '');\n            }\n\n            if (align === 'center')\n            {\n                $el.css('max-width', '');\n                $el.css('width', '');\n                $figcaption.css('text-align', 'center');\n            }\n            else\n            {\n                $figcaption.css('text-align', '');\n            }\n        }\n    },\n    _set_link: function(data)\n    {\n        var $link = this._findLink();\n        if (data.url === '')\n        {\n            if ($link) $link.unwrap();\n\n            return;\n        }\n\n        if (!$link)\n        {\n            $link = $R.dom('<a>');\n            this.$element.wrap($link);\n        }\n\n        $link.attr('href', data.url);\n\n        if (data.target) $link.attr('target', (data.target === true) ? '_blank' : data.target);\n        else $link.removeAttr('target');\n\n        return $link;\n    },\n    _get_src: function()\n    {\n        return this.$element.attr('src');\n    },\n    _get_id: function()\n    {\n        return this.$element.attr('data-image');\n    },\n    _get_title: function()\n    {\n        var alt = this.$element.attr('alt');\n\n        return (alt) ? alt : '';\n    },\n    _get_caption: function()\n    {\n        var $figcaption = this.find('figcaption');\n\n        if ($figcaption.length === 0)\n        {\n            return '';\n        }\n        else\n        {\n            return $figcaption.html();\n        }\n    },\n    _get_align: function()\n    {\n        var align = '';\n        if (typeof this.opts.imagePosition === 'object')\n        {\n            align = 'none';\n            var positions = this.opts.imagePosition;\n            for (var key in positions)\n            {\n                if (this.hasClass(positions[key]))\n                {\n                    align = key;\n                    break;\n                }\n            }\n        }\n        else\n        {\n            align = (this.css('text-align') === 'center') ? 'center' : this.css('float');\n        }\n\n        return align;\n    },\n    _get_link: function()\n    {\n        var $link = this._findLink();\n        if ($link)\n        {\n            var target = ($link.attr('target')) ? true : false;\n\n            return {\n                url: $link.attr('href'),\n                target: target\n            };\n        }\n    },\n    _initWrapper: function()\n    {\n        this.addClass('redactor-component');\n        this.attr({\n            'data-redactor-type': 'image',\n            'tabindex': '-1',\n            'contenteditable': false\n        });\n    },\n    _findLink: function()\n    {\n        var $link = this.find('a').filter(function(node)\n        {\n            return ($R.dom(node).closest('figcaption').length === 0);\n        });\n\n        if ($link.length !== 0)\n        {\n            return $link;\n        }\n\n        return false;\n    }\n});\n$R.add('class', 'image.resize', {\n    init: function(app)\n    {\n        this.app = app;\n        this.$doc = app.$doc;\n        this.$win = app.$win;\n        this.$body = app.$body;\n        this.editor = app.editor;\n        this.toolbar = app.toolbar;\n        this.inspector = app.inspector;\n\n        // init\n        this.$target = (this.toolbar.isTarget()) ? this.toolbar.getTargetElement() : this.$body;\n        this._init();\n    },\n    // public\n    rebuild: function()\n    {\n        this._setResizerPosition();\n    },\n    hide: function()\n    {\n        this.$target.find('#redactor-image-resizer').remove();\n    },\n    stop: function()\n    {\n        var $editor = this.editor.getElement();\n        $editor.off('.redactor.image-resize');\n\n        this.$doc.off('.redactor.image-resize');\n        this.$win.off('resize.redactor.image-resize');\n        this.hide();\n    },\n\n    // private\n    _init: function()\n    {\n        var $editor = this.editor.getElement();\n        $editor.on('click.redactor.image-resize', this._build.bind(this));\n\n        this.$win.on('resize.redactor.image-resize', this._setResizerPosition.bind(this));\n    },\n    _build: function(e)\n    {\n        this.$target.find('#redactor-image-resizer').remove();\n\n        if (this.app.isReadOnly()) return;\n\n        var data = this.inspector.parse(e.target);\n        var $editor = this.editor.getElement();\n\n        if (data.isComponentType('image'))\n        {\n            this.$resizableBox = $editor;\n            this.$resizableImage = $R.dom(data.getImageElement());\n\n            this.$resizer = $R.dom('<span>');\n            this.$resizer.attr('id', 'redactor-image-resizer');\n\n            this.$target.append(this.$resizer);\n\n            this._setResizerPosition();\n            this.$resizer.on('mousedown touchstart', this._set.bind(this));\n        }\n    },\n    _setResizerPosition: function()\n    {\n        if (this.$resizer)\n        {\n            var isTarget = this.toolbar.isTarget();\n            var targetOffset = this.$target.offset();\n            var offsetFix = 7;\n            var topOffset = (isTarget) ? (offsetFix - targetOffset.top + this.$target.scrollTop()) : offsetFix;\n            var leftOffset = (isTarget) ? (offsetFix - targetOffset.left) : offsetFix;\n            var pos = this.$resizableImage.offset();\n            var width = this.$resizableImage.width();\n            var height = this.$resizableImage.height();\n            var resizerWidth =  this.$resizer.width();\n            var resizerHeight =  this.$resizer.height();\n\n            this.$resizer.css({ top: Math.round(pos.top + height - resizerHeight + topOffset) + 'px', left: Math.round(pos.left + width - resizerWidth + leftOffset) + 'px' });\n        }\n    },\n    _set: function(e)\n    {\n        e.preventDefault();\n\n        this.resizeHandle = {\n            x : e.pageX,\n            y : e.pageY,\n            el : this.$resizableImage,\n            $figure: this.$resizableImage.closest('figure'),\n            ratio: this.$resizableImage.width() / this.$resizableImage.height(),\n            h: this.$resizableImage.height()\n        };\n\n        e = e.originalEvent || e;\n\n        if (e.targetTouches)\n        {\n             this.resizeHandle.x = e.targetTouches[0].pageX;\n             this.resizeHandle.y = e.targetTouches[0].pageY;\n        }\n\n        this.app.broadcast('contextbar.close');\n        this.app.broadcast('image.resize', this.$resizableImage);\n        this._start();\n    },\n    _start: function()\n    {\n        this.$doc.on('mousemove.redactor.image-resize touchmove.redactor.image-resize', this._move.bind(this));\n        this.$doc.on('mouseup.redactor.image-resize touchend.redactor.image-resize', this._stop.bind(this));\n    },\n    _stop: function()\n    {\n        this.$doc.off('.redactor.image-resize');\n        this.app.broadcast('image.resized', this.$resizableImage);\n    },\n    _move: function(e)\n    {\n        e.preventDefault();\n\n        e = e.originalEvent || e;\n\n        var height = this.resizeHandle.h;\n\n        if (e.targetTouches) height += (e.targetTouches[0].pageY -  this.resizeHandle.y);\n        else height += (e.pageY -  this.resizeHandle.y);\n\n        var width = height * this.resizeHandle.ratio;\n\n        width = Math.round(width);\n        height = Math.round(height);\n\n        if (height < 20 || width < 100) return;\n        if (this._getResizableBoxWidth() <= width) return;\n\n        if (this.resizeHandle.$figure.length !== 0 && this.resizeHandle.$figure.css('max-width') !== '') {\n            this.resizeHandle.$figure.css({ width: width + 'px' , 'max-width': width + 'px' });\n        }\n\n        this.resizeHandle.el.attr({ width: width, height: height });\n        this.resizeHandle.el.width(width);\n        this.resizeHandle.el.css('max-width', width + 'px');\n        this.resizeHandle.el.height(height);\n        this._setResizerPosition();\n    },\n    _getResizableBoxWidth: function()\n    {\n        var width = this.$resizableBox.width();\n        return width - parseInt(this.$resizableBox.css('padding-left')) - parseInt(this.$resizableBox.css('padding-right'));\n    }\n});\n$R.add('module', 'file', {\n    modals: {\n        'file':\n            '<div class=\"redactor-modal-tab\" data-title=\"## upload ##\"><form action=\"\"> \\\n                <div class=\"form-item form-item-title\"> \\\n                    <label for=\"modal-file-title\"> ## filename ## <span class=\"desc\">(## optional ##)</span></label> \\\n                    <input type=\"text\" id=\"modal-file-title\" name=\"title\" /> \\\n                </div> \\\n                <input type=\"file\" name=\"file\"> \\\n            </form></div>'\n    },\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.lang = app.lang;\n        this.caret = app.caret;\n        this.utils = app.utils;\n        this.storage = app.storage;\n        this.component = app.component;\n        this.inspector = app.inspector;\n        this.insertion = app.insertion;\n        this.selection = app.selection;\n    },\n    // messages\n    onstarted: function()\n    {\n        // storage observe\n        this.storage.observeFiles();\n    },\n    ondropfile: function(e, files, clipboard)\n    {\n        if (!this.opts.fileUpload) return;\n\n        var options = {\n            url: this.opts.fileUpload,\n            event: (clipboard) ? false : e,\n            files: files,\n            name: 'filedrop',\n            data: this.opts.fileData\n        };\n\n        this.app.api('module.upload.send', options);\n    },\n    onmodal: {\n        file: {\n            open: function($modal, $form)\n            {\n                this._setFormData($modal, $form);\n                this._setUpload($form);\n            },\n            opened: function($modal, $form)\n            {\n                this._setFormFocus($form);\n\n                this.$form = $form;\n            }\n        }\n    },\n    onupload: {\n        file: {\n            complete: function(response)\n            {\n                this._insert(response);\n            },\n            error: function(response)\n            {\n                this._uploadError(response);\n            }\n        },\n        filedrop: {\n            complete: function(response, e)\n            {\n                this._insert(response, e);\n            },\n            error: function(response)\n            {\n                this._uploadError(response);\n            }\n        }\n    },\n\n    // public\n    open: function()\n    {\n        this._open();\n    },\n    insert: function(data)\n    {\n        this._insert(data);\n    },\n    remove: function(node)\n    {\n        this._remove(node);\n    },\n\n    // private\n    _open: function()\n    {\n        this.app.api('module.modal.build', this._getModalData());\n    },\n    _getModalData: function()\n    {\n        var modalData = {\n            name: 'file',\n            title: this.lang.get('file')\n        };\n\n        return modalData;\n    },\n    _insert: function(response, e)\n    {\n        this.app.api('module.modal.close');\n        if (typeof response !== 'object') return;\n\n        if (Array.isArray(response))\n        {\n            var obj = {};\n            for (var i = 0; i < response.length; i++)\n            {\n                obj = $R.extend(obj, response[i]);\n            }\n\n            response = obj;\n        }\n\n        var multiple = (Object.keys(response).length  > 1);\n\n        if (multiple)\n        {\n            this._insertMultiple(response, e);\n        }\n        else\n        {\n            this._insertSingle(response, e);\n        }\n\n        this.$form = false;\n    },\n    _insertSingle: function(response, e)\n    {\n        var inserted = [];\n        for (var key in response)\n        {\n            var $file = this._createFileAndStore(response[key]);\n\n            if (this.opts.fileAttachment)\n            {\n                inserted = this._insertAsAttachment($file);\n            }\n            else\n            {\n                inserted = (e) ? this.insertion.insertToPoint(e, $file) : this.insertion.insertRaw($file);\n            }\n\n            this.app.broadcast('file.uploaded', inserted[0], response);\n        }\n    },\n    _insertMultiple: function(response, e)\n    {\n        var z = 0;\n        var inserted = [];\n        var $last;\n        for (var key in response)\n        {\n            z++;\n\n            var $file = this._createFileAndStore(response[key]);\n\n            if (this.opts.fileAttachment)\n            {\n                inserted = this._insertAsAttachment($file, response);\n            }\n            else\n            {\n                if (z === 1)\n                {\n                    inserted = (e) ? this.insertion.insertToPoint(e, $file) : this.insertion.insertRaw($file);\n                }\n                else\n                {\n                    var $inserted = $R.dom(inserted[0]);\n                    $inserted.after($file).after(' ');\n                    inserted = [$file.get()];\n\n                    this.app.broadcast('file.inserted', $file);\n                }\n            }\n\n            $last = $file;\n            this.app.broadcast('file.uploaded', inserted[0], response);\n        }\n\n        // set caret after last\n        if (!this.opts.fileAttachment)\n        {\n            this.caret.setAfter($last);\n        }\n    },\n    _insertAsAttachment: function($file, response)\n    {\n        var $box = $R.dom(this.opts.fileAttachment);\n        var $wrapper = $file.wrapAttachment();\n        $box.append($wrapper);\n\n        var inserted = [$wrapper.get()];\n        this.app.broadcast('file.appended', inserted[0], response);\n\n        return inserted;\n    },\n    _createFileAndStore: function(item)\n    {\n        var modalFormData = (this.$form) ? this.$form.getData() : false;\n        var name = (item.name) ? item.name : item.url;\n        var title = (!this.opts.fileAttachment && modalFormData && modalFormData.title !== '') ? modalFormData.title : this._truncateUrl(name);\n\n        var $file = this.component.create('file');\n        $file.attr('href', item.url);\n        $file.attr('data-file', (item.id) ? item.id : this.utils.getRandomId());\n        $file.attr('data-name', item.name);\n        $file.html(title);\n\n        // add to storage\n        this.storage.add('file', $file);\n\n        return $file;\n    },\n    _remove: function(node)\n    {\n        this.selection.save();\n\n        var $file = this.component.create('file', node);\n        var stop = this.app.broadcast('file.delete', $file);\n        if (stop !== false)\n        {\n            $file.unwrap();\n\n            this.selection.restore();\n\n            // callback\n            this.app.broadcast('file.deleted', $file);\n        }\n        else\n        {\n            this.selection.restore();\n        }\n    },\n    _truncateUrl: function(url)\n    {\n        return (url.search(/^http/) !== -1 && url.length > 20) ? url.substring(0, 20) + '...' : url;\n    },\n    _setUpload: function($form)\n    {\n        var options = {\n            url: this.opts.fileUpload,\n            element: $form.getField('file'),\n            name: 'file',\n            data: this.opts.fileData,\n            paramName: this.opts.fileUploadParam\n        };\n\n        this.app.api('module.upload.build', options);\n    },\n    _setFormData: function($modal, $form)\n    {\n        if (this.opts.fileAttachment)\n        {\n            $modal.find('.form-item-title').hide();\n        }\n        else\n        {\n            $form.setData({ title: this.selection.getText() });\n        }\n    },\n    _setFormFocus: function($form)\n    {\n        $form.getField('title').focus();\n    },\n    _uploadError: function(response)\n    {\n        this.app.broadcast('file.uploadError', response);\n    }\n});\n$R.add('class', 'file.component', {\n    mixins: ['dom', 'component'],\n    init: function(app, el)\n    {\n        this.app = app;\n        this.opts = app.opts;\n\n        // init\n        return (el && el.cmnt !== undefined) ? el : this._init(el);\n    },\n    wrapAttachment: function()\n    {\n        this.$wrapper = $R.dom('<span class=\"redactor-file-item\">');\n        this.$remover = $R.dom('<span class=\"redactor-file-remover\">');\n        this.$remover.html('&times;');\n        this.$remover.on('click', this.removeAttachment.bind(this));\n\n        this.$wrapper.append(this);\n        this.$wrapper.append(this.$remover);\n\n        return this.$wrapper;\n    },\n    removeAttachment: function(e)\n    {\n        e.preventDefault();\n\n        var stop = this.app.broadcast('file.delete', this, this.$wrapper);\n        if (stop !== false)\n        {\n            this.$wrapper.remove();\n            this.app.broadcast('file.deleted', this);\n            this.app.broadcast('file.removeAttachment', this);\n        }\n    },\n\n    // private\n    _init: function(el)\n    {\n        if (el === undefined)\n        {\n            this.parse('<a>');\n        }\n        else\n        {\n            var $a = $R.dom(el).closest('a');\n            this.parse($a);\n        }\n    }\n});\n$R.add('module', 'buffer', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.editor = app.editor;\n        this.offset = app.offset;\n        this.keycodes = app.keycodes;\n        this.selection = app.selection;\n\n        // local\n        this.state = false;\n        this.passed = false;\n        this.keyPressed = false;\n        this.undoStorage = [];\n        this.redoStorage = [];\n    },\n    // messages\n    onkeydown: function(e)\n    {\n        this._listen(e);\n    },\n    onsyncing: function()\n    {\n        if (!this.keyPressed)\n        {\n            this.trigger();\n        }\n\n        this.keyPressed = false;\n    },\n    onbuffer: {\n        trigger: function()\n        {\n            this.trigger();\n        }\n    },\n    onstate: function(e, html, offset)\n    {\n        if ((e && (e.ctrlKey || e.metaKey)) || (e && (this._isUndo(e) || this._isRedo(e))))\n        {\n            return;\n        }\n\n        this.passed = false;\n        this._saveState(html, offset);\n\n        if (e === false) {\n            this._setUndo();\n        }\n    },\n    onenable: function()\n    {\n        this.clear();\n    },\n\n    // public\n    clear: function()\n    {\n        this.state = false;\n        this.undoStorage = [];\n        this.redoStorage = [];\n    },\n    undo: function()\n    {\n        this._getUndo();\n    },\n    redo: function()\n    {\n        this._getRedo();\n    },\n    trigger: function()\n    {\n        if (this.state && this.passed === false) this._setUndo();\n    },\n\n    // private\n    _saveState: function(html, offset)\n    {\n        var $editor = this.editor.getElement();\n\n        this.state = {\n            html: html || $editor.html(),\n            offset: offset || this.offset.get()\n        };\n    },\n    _listen: function(e)\n    {\n        var key = e.which;\n        var ctrl = e.ctrlKey || e.metaKey;\n        var cmd = ctrl || e.shiftKey || e.altKey;\n        var keys = [this.keycodes.SPACE, this.keycodes.ENTER, this.keycodes.BACKSPACE, this.keycodes.DELETE, this.keycodes.TAB,\n                    this.keycodes.LEFT, this.keycodes.RIGHT, this.keycodes.UP, this.keycodes.DOWN];\n        // undo\n        if (this._isUndo(e)) // z key\n        {\n            e.preventDefault();\n            this.undo();\n            return;\n        }\n        // redo\n        else if (this._isRedo(e))\n        {\n            e.preventDefault();\n            this.redo();\n            return;\n        }\n        // spec keys\n        else if (!ctrl && keys.indexOf(key) !== -1)\n        {\n            cmd = true;\n            this.trigger();\n        }\n        // cut & copy\n        else if (ctrl && (key === 88 || key === 67))\n        {\n            cmd = true;\n            this.trigger();\n        }\n\n\n        // empty buffer\n        if (!cmd && !this._hasUndo())\n        {\n            this.trigger();\n        }\n\n        this.keyPressed = true;\n    },\n    _isUndo: function(e)\n    {\n        var key = e.which;\n        var ctrl = e.ctrlKey || e.metaKey;\n\n        return (ctrl && key === 90 && !e.shiftKey && !e.altKey);\n    },\n    _isRedo: function(e)\n    {\n        var key = e.which;\n        var ctrl = e.ctrlKey || e.metaKey;\n\n        return (ctrl && ((key === 90 && e.shiftKey) || (key === 89 && !e.shiftKey)) && !e.altKey);\n    },\n    _setUndo: function()\n    {\n        var last = this.undoStorage[this.undoStorage.length-1];\n        if (typeof last === 'undefined' || last[0] !== this.state.html)\n        {\n            this.undoStorage.push([this.state.html, this.state.offset]);\n            this._removeOverStorage();\n        }\n    },\n    _setRedo: function()\n    {\n        var $editor = this.editor.getElement();\n        var offset = this.offset.get();\n        var html = $editor.html();\n\n        this.redoStorage.push([html, offset]);\n        this.redoStorage = this.redoStorage.slice(0, this.opts.bufferLimit);\n    },\n    _getUndo: function()\n    {\n        if (!this._hasUndo()) return;\n\n        this.passed = true;\n\n        var $editor = this.editor.getElement();\n        var buffer = this.undoStorage.pop();\n\n        this._setRedo();\n\n        $editor.html(buffer[0]);\n        this.offset.set(buffer[1]);\n        this._saveState(buffer[0], buffer[1]);\n\n        this.app.broadcast('undo', buffer[0], buffer[1]);\n\n    },\n    _getRedo: function()\n    {\n        if (!this._hasRedo()) return;\n\n        this.passed = true;\n\n        var $editor = this.editor.getElement();\n        var buffer = this.redoStorage.pop();\n\n        this._setUndo();\n        $editor.html(buffer[0]);\n        this.offset.set(buffer[1]);\n        this._saveState(buffer[0], buffer[1]);\n\n        this.app.broadcast('redo', buffer[0], buffer[1]);\n    },\n    _removeOverStorage: function()\n    {\n        if (this.undoStorage.length > this.opts.bufferLimit)\n        {\n            this.undoStorage = this.undoStorage.slice(0, (this.undoStorage.length - this.opts.bufferLimit));\n        }\n    },\n    _hasUndo: function()\n    {\n        return (this.undoStorage.length !== 0);\n    },\n    _hasRedo: function()\n    {\n        return (this.redoStorage.length !== 0);\n    }\n});\n$R.add('module', 'list', {\n    init: function(app)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.block = app.block;\n        this.editor = app.editor;\n        this.toolbar = app.toolbar;\n        this.inspector = app.inspector;\n        this.selection = app.selection;\n    },\n    // messages\n    onbutton: {\n        list: {\n            observe: function(button)\n            {\n                this._observeButton(button);\n            }\n        }\n    },\n    ondropdown: {\n        list: {\n            observe: function(dropdown)\n            {\n                this._observeDropdown(dropdown);\n            }\n        }\n    },\n\n    // public\n    toggle: function(type)\n    {\n        var nodes = this._getBlocks();\n        var block = this.selection.getBlock();\n        var $list = $R.dom(block).parents('ul, ol',  this.editor.getElement()).last();\n        if (nodes.length === 0 && $list.length !== 0)\n        {\n            nodes = [$list.get()];\n        }\n\n        if (block && (block.tagName === 'TD' || block.tagName === 'TH'))\n        {\n            nodes = this.block.format('div');\n        }\n\n        this.selection.saveMarkers();\n\n        nodes = (nodes.length !== 0 && this._isUnformat(type, nodes)) ? this._unformat(type, nodes) : this._format(type, nodes);\n\n        this.selection.restoreMarkers();\n\n        return nodes;\n    },\n    indent: function()\n    {\n        var isCollapsed = this.selection.isCollapsed();\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var item = (data.isList()) ? data.getListItem() : false;\n        var $item = $R.dom(item);\n        var $prev = $item.prevElement();\n        var prev = $prev.get();\n        var isIndent = (isCollapsed && item && prev && prev.tagName === 'LI');\n\n        if (isIndent)\n        {\n            this.selection.saveMarkers();\n\n            $prev = $R.dom(prev);\n            var $prevChild = $prev.children('ul, ol');\n            var $list = $item.closest('ul, ol');\n\n            if ($prevChild.length !== 0)\n            {\n                $prevChild.append($item);\n            }\n            else\n            {\n                var listTag = $list.get().tagName.toLowerCase();\n                var $newList = $R.dom('<' + listTag + '>');\n\n                $newList.append($item);\n                $prev.append($newList);\n            }\n\n            this.selection.restoreMarkers();\n\n            // empty list item\n            if (this.utils.isEmptyHtml($item.html())) {\n                this.app.caret.setStart($item);\n            }\n        }\n    },\n    outdent: function()\n    {\n        var isCollapsed = this.selection.isCollapsed();\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var item = (data.isList()) ? data.getListItem() : false;\n        var $item = $R.dom(item);\n\n        if (isCollapsed && item)\n        {\n\n            var $listItem = $item.parent();\n            var $liItem = $listItem.closest('li', '.redactor-in-' + this.uuid);\n            var $prev = $item.prevElement();\n            var $next = $item.nextElement();\n            var prev = $prev.get();\n            var next = $next.get();\n            var nextItems, nextList, $newList, $nextList;\n            var isTop = (prev === false);\n            var isMiddle = (prev !== false && next !== false);\n            var isBottom = (!isTop && next === false);\n\n            this.selection.saveMarkers();\n\n            // out\n            if ($liItem.length !== 0)\n            {\n                if (isMiddle)\n                {\n                    nextItems = this._getAllNext($item.get());\n                    $newList = $R.dom('<' + $listItem.get().tagName.toLowerCase() + '>');\n\n                    for (var i = 0; i < nextItems.length; i++)\n                    {\n                        $newList.append(nextItems[i]);\n                    }\n\n                    $liItem.after($item);\n                    $item.append($newList);\n                }\n                else\n                {\n                    $liItem.after($item);\n\n                    if ($listItem.children().length === 0)\n                    {\n                        $listItem.remove();\n                    }\n                    else\n                    {\n                        if (isTop) $item.append($listItem);\n                    }\n                }\n            }\n            // unformat\n            else\n            {\n                var $container =  this._createUnformatContainer($item);\n                var $childList = $container.find('ul, ol').first();\n\n                if (isTop) $listItem.before($container);\n                else if (isBottom) $listItem.after($container);\n                else if (isMiddle)\n                {\n                    $newList = $R.dom('<' + $listItem.get().tagName.toLowerCase() + '>');\n                    nextItems = this._getAllNext($item.get());\n\n                    for (var i = 0; i < nextItems.length; i++)\n                    {\n                        $newList.append(nextItems[i]);\n                    }\n\n                    $listItem.after($container);\n                    $container.after($newList);\n                }\n\n                if ($childList.length !== 0)\n                {\n                    $nextList = $container.nextElement();\n                    nextList = $nextList.get();\n                    if (nextList && nextList.tagName === $listItem.get().tagName)\n                    {\n                        $R.dom(nextList).prepend($childList);\n                        $childList.unwrap();\n                    }\n                    else\n                    {\n                        $container.after($childList);\n                    }\n                }\n\n                $item.remove();\n            }\n\n            this.selection.restoreMarkers();\n        }\n    },\n\n    // private\n    _getAllNext: function(next)\n    {\n        var nodes = [];\n\n        while (next)\n        {\n            var $next = $R.dom(next).nextElement();\n            next = $next.get();\n\n            if (next) nodes.push(next);\n            else return nodes;\n        }\n\n        return nodes;\n    },\n    _isUnformat: function(type, nodes)\n    {\n        var countLists = 0;\n        for (var i = 0; i < nodes.length; i++)\n        {\n            if (nodes[i].nodeType !== 3)\n            {\n                var tag = nodes[i].tagName.toLowerCase();\n                if (tag === type || tag === 'figure')\n                {\n                    countLists++;\n                }\n            }\n        }\n\n        return (countLists === nodes.length);\n    },\n    _format: function(type, nodes)\n    {\n        var tags = ['p', 'div', 'blockquote', 'pre', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'ul', 'ol'];\n        var blocks = this._uniteBlocks(nodes, tags);\n        var lists = [];\n\n        for (var key in blocks)\n        {\n            var items = blocks[key];\n            var $list = this._createList(type, blocks[key]);\n\n            for (var i = 0; i < items.length; i++)\n            {\n                var $item;\n\n                // lists\n                if (items[i].nodeType !== 3 && (items[i].tagName === 'UL' || items[i].tagName === 'OL'))\n                {\n                    var $oldList = $R.dom(items[i]);\n\n                    $item = $oldList.contents();\n                    $list.append($item);\n\n                    // old is empty\n                    if (this.utils.isEmpty($oldList)) $oldList.remove();\n                }\n                // other blocks or texts\n                else\n                {\n                    $item = this._createListItem(items[i]);\n                    var last = $item.get().lastChild;\n                    if (last && last.tagName === 'BR') {\n                        $R.dom(last).remove();\n                    }\n\n                    this.utils.normalizeTextNodes($item);\n                    $list.append($item);\n                }\n            }\n\n            lists.push($list.get());\n        }\n\n        return lists;\n    },\n    _uniteBlocks: function(nodes, tags)\n    {\n        var z = 0;\n        var blocks = { 0: [] };\n        var lastcell = false;\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var $node = $R.dom(nodes[i]);\n            var $cell = $node.closest('th, td');\n\n            if ($cell.length !== 0)\n            {\n                if ($cell.get() !== lastcell)\n                {\n                    // create block\n                    z++;\n                    blocks[z] = [];\n                }\n\n                if (this._isUniteBlock(nodes[i], tags))\n                {\n                    blocks[z].push(nodes[i]);\n                }\n            }\n            else\n            {\n                if (this._isUniteBlock(nodes[i], tags))\n                {\n                    blocks[z].push(nodes[i]);\n                }\n                else\n                {\n                    // create block\n                    z++;\n                    blocks[z] = [];\n                }\n            }\n\n            lastcell = $cell.get();\n        }\n\n        return blocks;\n    },\n    _isUniteBlock: function(node, tags)\n    {\n        return (node.nodeType === 3 || tags.indexOf(node.tagName.toLowerCase()) !== -1);\n    },\n    _createList: function(type, blocks)\n    {\n        var last = blocks[blocks.length-1];\n        var $last = $R.dom(last);\n        var $list = $R.dom('<' + type + '>');\n        $last.after($list);\n\n        return $list;\n    },\n    _createListItem: function(item)\n    {\n        var $item = $R.dom('<li>');\n        if (item.nodeType === 3)\n        {\n            $item.append(item);\n        }\n        else\n        {\n            var $el = $R.dom(item);\n            $item.append($el.contents());\n            $el.remove();\n        }\n\n        return $item;\n    },\n    _unformat: function(type, nodes)\n    {\n        if (nodes.length === 1)\n        {\n            // one list\n            var $list = $R.dom(nodes[0]);\n            var $items = $list.find('li');\n\n            var selectedItems = this.selection.getNodes({ tags: ['li'] });\n            var block = this.selection.getBlock();\n            var $li = $R.dom(block).closest('li');\n            if (selectedItems.length === 0 && $li.length !== 0)\n            {\n                selectedItems = [$li.get()];\n            }\n\n\n            // 1) entire\n            if (selectedItems.length === $items.length)\n            {\n                return this._unformatEntire(nodes[0]);\n            }\n\n            var pos = this._getItemsPosition($items, selectedItems);\n\n            // 2) top\n            if (pos === 'Top')\n            {\n                return this._unformatAtSide('before', selectedItems, $list);\n            }\n\n            // 3) bottom\n            else if (pos === 'Bottom')\n            {\n                selectedItems.reverse();\n                return this._unformatAtSide('after', selectedItems, $list);\n            }\n\n            // 4) middle\n            else if (pos === 'Middle')\n            {\n                var $last = $R.dom(selectedItems[selectedItems.length-1]);\n\n                var ci = false;\n\n                var $parent = false;\n                var $secondList = $R.dom('<' + $list.get().tagName.toLowerCase() + '>');\n                $items.each(function(node)\n                {\n                    if (ci)\n                    {\n                        var $node = $R.dom(node);\n                        if ($node.closest('.redactor-split-item').length === 0 && ($parent === false || $node.closest($parent).length === 0))\n                        {\n                            $node.addClass('redactor-split-item');\n                        }\n\n                        $parent = $node;\n                    }\n\n                    if (node === $last.get())\n                    {\n                        ci = true;\n                    }\n                });\n\n                $items.filter('.redactor-split-item').each(function(node)\n                {\n                    var $node = $R.dom(node);\n                    $node.removeClass('redactor-split-item');\n                    $secondList.append(node);\n                });\n\n                $list.after($secondList);\n\n                selectedItems.reverse();\n                for (var i = 0; i < selectedItems.length; i++)\n                {\n                    var $item = $R.dom(selectedItems[i]);\n                    var $container = this._createUnformatContainer($item);\n\n                    $list.after($container);\n                    $container.find('ul, ol').remove();\n                    $item.remove();\n                }\n\n\n                return;\n            }\n\n        }\n        else\n        {\n            // unformat all\n            for (var i = 0; i < nodes.length; i++)\n            {\n                if (nodes[i].nodeType !== 3 && nodes[i].tagName.toLowerCase() === type)\n                {\n                    this._unformatEntire(nodes[i]);\n                }\n            }\n        }\n    },\n    _unformatEntire: function(list)\n    {\n        var $list = $R.dom(list);\n        var $items = $list.find('li');\n        $items.each(function(node)\n        {\n            var $item = $R.dom(node);\n            var $container = this._createUnformatContainer($item);\n\n            $item.remove();\n            $list.before($container);\n\n        }.bind(this));\n\n        $list.remove();\n    },\n    _unformatAtSide: function(type, selectedItems, $list)\n    {\n        for (var i = 0; i < selectedItems.length; i++)\n        {\n            var $item = $R.dom(selectedItems[i]);\n            var $container = this._createUnformatContainer($item);\n\n            $list[type]($container);\n\n            var $innerLists = $container.find('ul, ol').first();\n            $item.append($innerLists);\n\n            $innerLists.each(function(node)\n            {\n                var $node = $R.dom(node);\n                var $parent = $node.closest('li');\n\n                if ($parent.get() === selectedItems[i])\n                {\n                    $node.unwrap();\n                    $parent.addClass('r-unwrapped');\n                }\n\n            });\n\n            if (this.utils.isEmptyHtml($item.html())) $item.remove();\n        }\n\n        // clear empty\n        $list.find('.r-unwrapped').each(function(node)\n        {\n            var $node = $R.dom(node);\n            if ($node.html().trim() === '') $node.remove();\n            else $node.removeClass('r-unwrapped');\n        });\n    },\n    _getItemsPosition: function($items, selectedItems)\n    {\n        var pos = 'Middle';\n\n        var sFirst = selectedItems[0];\n        var sLast = selectedItems[selectedItems.length-1];\n\n        var first = $items.first().get();\n        var last = $items.last().get();\n\n        if (first === sFirst && last !== sLast)\n        {\n            pos = 'Top';\n        }\n        else if (first !== sFirst && last === sLast)\n        {\n            pos = 'Bottom';\n        }\n\n        return pos;\n    },\n    _createUnformatContainer: function($item)\n    {\n        var $container = $R.dom('<' + this.opts.markup + '>');\n        if (this.opts.breakline) $container.attr('data-redactor-tag', 'br');\n\n        $container.append($item.contents());\n\n        return $container;\n    },\n    _getBlocks: function()\n    {\n        return this.selection.getBlocks({ first: true });\n    },\n    _observeButton: function()\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var isDisabled = (data.isPre() || data.isCode() || data.isFigcaption());\n\n        this._observeButtonsList(isDisabled, ['lists', 'ul', 'ol', 'outdent', 'indent']);\n\n        var itemOutdent = this.toolbar.getButton('outdent');\n        var itemIndent = this.toolbar.getButton('indent');\n\n        this._observeIndent(itemIndent, itemOutdent);\n    },\n    _observeDropdown: function(dropdown)\n    {\n        var itemOutdent = dropdown.getItem('outdent');\n        var itemIndent = dropdown.getItem('indent');\n\n        this._observeIndent(itemIndent, itemOutdent);\n    },\n    _observeIndent: function(itemIndent, itemOutdent)\n    {\n        var isCollapsed = this.selection.isCollapsed();\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var item = (data.isList()) ? data.getListItem() : false;\n        var $item = $R.dom(item);\n        var $prev = $item.prevElement();\n        var prev = $prev.get();\n        var isIndent = (isCollapsed && item && prev && prev.tagName === 'LI');\n\n        if (itemOutdent)\n        {\n            if (item && isCollapsed) itemOutdent.enable();\n            else itemOutdent.disable();\n        }\n\n        if (itemIndent)\n        {\n            if (item && isIndent) itemIndent.enable();\n            else itemIndent.disable();\n        }\n    },\n    _observeButtonsList: function(param, buttons)\n    {\n        for (var i = 0; i < buttons.length; i++)\n        {\n            var button = this.toolbar.getButton(buttons[i]);\n            if (button)\n            {\n                if (param) button.disable();\n                else button.enable();\n            }\n        }\n    }\n});\n$R.add('class', 'video.component', {\n    mixins: ['dom', 'component'],\n    init: function(app, el)\n    {\n        this.app = app;\n\n        // init\n        return (el && el.cmnt !== undefined) ? el : this._init(el);\n    },\n\n    // private\n    _init: function(el)\n    {\n        if (typeof el !== 'undefined')\n        {\n            var $node = $R.dom(el);\n            var $wrapper = $node.closest('figure');\n            if ($wrapper.length !== 0)\n            {\n                this.parse($wrapper);\n            }\n            else\n            {\n                this.parse('<figure>');\n                this.append(el);\n            }\n        }\n        else\n        {\n            this.parse('<figure>');\n        }\n\n\n        this._initWrapper();\n    },\n    _initWrapper: function()\n    {\n        this.addClass('redactor-component');\n        this.attr({\n            'data-redactor-type': 'video',\n            'tabindex': '-1',\n            'contenteditable': false\n        });\n    }\n});\n\n$R.add('class', 'widget.component', {\n    mixins: ['dom', 'component'],\n    init: function(app, el)\n    {\n        this.app = app;\n\n        // init\n        return (el && el.cmnt !== undefined) ? el : this._init(el);\n    },\n    getData: function()\n    {\n        return {\n            html: this._getHtml()\n        };\n    },\n\n    // private\n    _init: function(el)\n    {\n        if (typeof el !== 'undefined')\n        {\n            var $node = $R.dom(el);\n            var $figure = $node.closest('figure');\n            if ($figure.length !== 0)\n            {\n                this.parse($figure);\n            }\n            else\n            {\n                this.parse('<figure>');\n                this.html(el);\n            }\n        }\n        else\n        {\n            this.parse('<figure>');\n        }\n\n\n        this._initWrapper();\n    },\n    _getHtml: function()\n    {\n        var $wrapper = $R.dom('<div>');\n        $wrapper.html(this.html());\n        $wrapper.find('.redactor-component-caret').remove();\n\n        return $wrapper.html();\n    },\n    _initWrapper: function()\n    {\n        this.addClass('redactor-component');\n        this.attr({\n            'data-redactor-type': 'widget',\n            'tabindex': '-1',\n            'contenteditable': false\n        });\n    }\n});\n\n    var Redactor = $R;\n    window.Redactor = window.$R = $R;\n\n    // Data attribute load\n    window.addEventListener('load', function()\n    {\n        $R('[data-redactor]');\n    });\n\n    // Export for webpack\n    if (typeof module === 'object' && module.exports) {\n        module.exports = Redactor;\n        module.exports.Redactor = Redactor;\n    }\n}());\n","\"use strict\";\n\n// eslint-disable-next-line func-names\nmodule.exports = function () {\n  if (typeof globalThis === \"object\") {\n    return globalThis;\n  }\n\n  var g;\n\n  try {\n    // This works if eval is allowed (see CSP)\n    // eslint-disable-next-line no-new-func\n    g = this || new Function(\"return this\")();\n  } catch (e) {\n    // This works if the window reference is available\n    if (typeof window === \"object\") {\n      return window;\n    } // This works if the self reference is available\n\n\n    if (typeof self === \"object\") {\n      return self;\n    } // This works if the global reference is available\n\n\n    if (typeof global !== \"undefined\") {\n      return global;\n    }\n  }\n\n  return g;\n}();","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ruleSet[1].rules[3].use[1]!../../../../../../node_modules/css-loader/dist/cjs.js!../../../../../../node_modules/postcss-loader/dist/cjs.js??ruleSet[1].rules[3].use[3]!../../../../../../node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[3].use[4]!./redactor.css\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../../../../node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"4aeb9562\", content, true, {});","/**\n * Translates the list format produced by css-loader into something\n * easier to manipulate.\n */\nexport default function listToStyles (parentId, list) {\n  var styles = []\n  var newStyles = {}\n  for (var i = 0; i < list.length; i++) {\n    var item = list[i]\n    var id = item[0]\n    var css = item[1]\n    var media = item[2]\n    var sourceMap = item[3]\n    var part = {\n      id: parentId + ':' + i,\n      css: css,\n      media: media,\n      sourceMap: sourceMap\n    }\n    if (!newStyles[id]) {\n      styles.push(newStyles[id] = { id: id, parts: [part] })\n    } else {\n      newStyles[id].parts.push(part)\n    }\n  }\n  return styles\n}\n","/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n  Modified by Evan You @yyx990803\n*/\n\nimport listToStyles from './listToStyles'\n\nvar hasDocument = typeof document !== 'undefined'\n\nif (typeof DEBUG !== 'undefined' && DEBUG) {\n  if (!hasDocument) {\n    throw new Error(\n    'vue-style-loader cannot be used in a non-browser environment. ' +\n    \"Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.\"\n  ) }\n}\n\n/*\ntype StyleObject = {\n  id: number;\n  parts: Array<StyleObjectPart>\n}\n\ntype StyleObjectPart = {\n  css: string;\n  media: string;\n  sourceMap: ?string\n}\n*/\n\nvar stylesInDom = {/*\n  [id: number]: {\n    id: number,\n    refs: number,\n    parts: Array<(obj?: StyleObjectPart) => void>\n  }\n*/}\n\nvar head = hasDocument && (document.head || document.getElementsByTagName('head')[0])\nvar singletonElement = null\nvar singletonCounter = 0\nvar isProduction = false\nvar noop = function () {}\nvar options = null\nvar ssrIdKey = 'data-vue-ssr-id'\n\n// Force single-tag solution on IE6-9, which has a hard limit on the # of <style>\n// tags it will allow on a page\nvar isOldIE = typeof navigator !== 'undefined' && /msie [6-9]\\b/.test(navigator.userAgent.toLowerCase())\n\nexport default function addStylesClient (parentId, list, _isProduction, _options) {\n  isProduction = _isProduction\n\n  options = _options || {}\n\n  var styles = listToStyles(parentId, list)\n  addStylesToDom(styles)\n\n  return function update (newList) {\n    var mayRemove = []\n    for (var i = 0; i < styles.length; i++) {\n      var item = styles[i]\n      var domStyle = stylesInDom[item.id]\n      domStyle.refs--\n      mayRemove.push(domStyle)\n    }\n    if (newList) {\n      styles = listToStyles(parentId, newList)\n      addStylesToDom(styles)\n    } else {\n      styles = []\n    }\n    for (var i = 0; i < mayRemove.length; i++) {\n      var domStyle = mayRemove[i]\n      if (domStyle.refs === 0) {\n        for (var j = 0; j < domStyle.parts.length; j++) {\n          domStyle.parts[j]()\n        }\n        delete stylesInDom[domStyle.id]\n      }\n    }\n  }\n}\n\nfunction addStylesToDom (styles /* Array<StyleObject> */) {\n  for (var i = 0; i < styles.length; i++) {\n    var item = styles[i]\n    var domStyle = stylesInDom[item.id]\n    if (domStyle) {\n      domStyle.refs++\n      for (var j = 0; j < domStyle.parts.length; j++) {\n        domStyle.parts[j](item.parts[j])\n      }\n      for (; j < item.parts.length; j++) {\n        domStyle.parts.push(addStyle(item.parts[j]))\n      }\n      if (domStyle.parts.length > item.parts.length) {\n        domStyle.parts.length = item.parts.length\n      }\n    } else {\n      var parts = []\n      for (var j = 0; j < item.parts.length; j++) {\n        parts.push(addStyle(item.parts[j]))\n      }\n      stylesInDom[item.id] = { id: item.id, refs: 1, parts: parts }\n    }\n  }\n}\n\nfunction createStyleElement () {\n  var styleElement = document.createElement('style')\n  styleElement.type = 'text/css'\n  head.appendChild(styleElement)\n  return styleElement\n}\n\nfunction addStyle (obj /* StyleObjectPart */) {\n  var update, remove\n  var styleElement = document.querySelector('style[' + ssrIdKey + '~=\"' + obj.id + '\"]')\n\n  if (styleElement) {\n    if (isProduction) {\n      // has SSR styles and in production mode.\n      // simply do nothing.\n      return noop\n    } else {\n      // has SSR styles but in dev mode.\n      // for some reason Chrome can't handle source map in server-rendered\n      // style tags - source maps in <style> only works if the style tag is\n      // created and inserted dynamically. So we remove the server rendered\n      // styles and inject new ones.\n      styleElement.parentNode.removeChild(styleElement)\n    }\n  }\n\n  if (isOldIE) {\n    // use singleton mode for IE9.\n    var styleIndex = singletonCounter++\n    styleElement = singletonElement || (singletonElement = createStyleElement())\n    update = applyToSingletonTag.bind(null, styleElement, styleIndex, false)\n    remove = applyToSingletonTag.bind(null, styleElement, styleIndex, true)\n  } else {\n    // use multi-style-tag mode in all other cases\n    styleElement = createStyleElement()\n    update = applyToTag.bind(null, styleElement)\n    remove = function () {\n      styleElement.parentNode.removeChild(styleElement)\n    }\n  }\n\n  update(obj)\n\n  return function updateStyle (newObj /* StyleObjectPart */) {\n    if (newObj) {\n      if (newObj.css === obj.css &&\n          newObj.media === obj.media &&\n          newObj.sourceMap === obj.sourceMap) {\n        return\n      }\n      update(obj = newObj)\n    } else {\n      remove()\n    }\n  }\n}\n\nvar replaceText = (function () {\n  var textStore = []\n\n  return function (index, replacement) {\n    textStore[index] = replacement\n    return textStore.filter(Boolean).join('\\n')\n  }\n})()\n\nfunction applyToSingletonTag (styleElement, index, remove, obj) {\n  var css = remove ? '' : obj.css\n\n  if (styleElement.styleSheet) {\n    styleElement.styleSheet.cssText = replaceText(index, css)\n  } else {\n    var cssNode = document.createTextNode(css)\n    var childNodes = styleElement.childNodes\n    if (childNodes[index]) styleElement.removeChild(childNodes[index])\n    if (childNodes.length) {\n      styleElement.insertBefore(cssNode, childNodes[index])\n    } else {\n      styleElement.appendChild(cssNode)\n    }\n  }\n}\n\nfunction applyToTag (styleElement, obj) {\n  var css = obj.css\n  var media = obj.media\n  var sourceMap = obj.sourceMap\n\n  if (media) {\n    styleElement.setAttribute('media', media)\n  }\n  if (options.ssrId) {\n    styleElement.setAttribute(ssrIdKey, obj.id)\n  }\n\n  if (sourceMap) {\n    // https://developer.chrome.com/devtools/docs/javascript-debugging\n    // this makes source maps inside style tags work properly in Chrome\n    css += '\\n/*# sourceURL=' + sourceMap.sources[0] + ' */'\n    // http://stackoverflow.com/a/26603875\n    css += '\\n/*# sourceMappingURL=data:application/json;base64,' + btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))) + ' */'\n  }\n\n  if (styleElement.styleSheet) {\n    styleElement.styleSheet.cssText = css\n  } else {\n    while (styleElement.firstChild) {\n      styleElement.removeChild(styleElement.firstChild)\n    }\n    styleElement.appendChild(document.createTextNode(css))\n  }\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\tloaded: false,\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Flag the module as loaded\n\tmodule.loaded = true;\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","__webpack_require__.nmd = (module) => {\n\tmodule.paths = [];\n\tif (!module.children) module.children = [];\n\treturn module;\n};","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(177);\n"],"names":["___EXPOSE_LOADER_IMPORT___","require","___EXPOSE_LOADER_GLOBAL_THIS___","___EXPOSE_LOADER_IMPORT_MODULE_LOCAL_NAME___","module","exports","CodeMirror","undefined","jQuery","Ajax","options","AjaxRequest","method","defaults","url","before","success","error","data","async","headers","this","p","extend","settings","toUpperCase","prepareData","xhr","XMLHttpRequest","open","setHeaders","send","prototype","obj1","obj2","name","indexOf","isFormData","toParams","setRequestHeader","window","FormData","isComplete","status","onload","loaded","bind","call","response","parseResponse","parseJson","str","o","JSON","parse","e","obj","Object","keys","map","k","encodeURIComponent","join","DomCache","DomExpando","Date","getTime","DomHClass","DomHMClass","Dom","selector","context","ready","fn","document","readyState","addEventListener","sdom","length","nodes","nodeType","childNodes","test","create","_query","_slice","html","createElement","RegExp","$1","elements","container","children","innerHTML","i","l","push","add","concat","_toArray","get","index","getAll","eq","first","last","contents","each","callback","len","is","filter","node","Node","matches","msMatchesSelector","webkitMatchesSelector","not","find","ns","parent","parentNode","parents","_getContext","closest","isNode","next","_getSibling","nextElement","prev","prevElement","css","value","style","_getHeightOrWidth","getComputedStyle","key","attr","checked","_getBooleanFromStr","getAttribute","setAttribute","reDataAttr","attrs","attributes","replacer","g","nodeName","dataName","match","val","replace","_isObjectString","_toObject","_isNumber","parseFloat","el","type","removeAttr","split","forEach","removeAttribute","removeData","dataset","dataindex","dataget","cacheIndex","nextCacheIndex","addClass","_eachClass","removeClass","toggleClass","hasClass","some","classList","contains","empty","append","text","textContent","after","_inject","frag","insertAdjacentHTML","reverse","s","insertBefore","nextSibling","elms","appendChild","prepend","firstChild","wrap","wrapper","unwrap","$node","replaceWith","docFrag","createDocumentFragment","result","replaceChild","remove","removeChild","clone","events","copy","_clone","_cloneEvents","show","_hasDisplayNone","target","isHidden","isHiddenMobile","display","hide","scrollTop","isWindow","isDocument","scrollingElement","body","documentElement","pageYOffset","scrollTo","offset","_getDim","position","width","adjust","_getSize","height","outerWidth","_getInnerOrOuter","outerHeight","innerWidth","innerHeight","click","_triggerEvent","focus","trigger","names","ev","CustomEvent","bubbles","cancelable","createEvent","initCustomEvent","dispatchEvent","on","handler","one","event","_getEventName","namespace","_getEventNamespace","_getOneHandler","_e","off","testEvent","testNamespace","testEventNamespace","testPositive","_offEvent","serialize","asObject","disabled","z","opt","selected","_toParams","ajax","_queryContext","querySelectorAll","element","getElementById","slice","getElementsByClassName","getElementsByTagName","querySelector","res","_events","cloneNode","self","apply","arguments","arr","condition","handlers","toString","removeEventListener","splice","_getDocSize","Math","max","captype","round","_adjustResultHeightOrWidth","charAt","$el","$targets","fixStyle","tmp","thisStyle","fix","isBorderBox","boxSizing","borderTopWidth","borderBottomWidth","marginTop","marginBottom","borderLeftWidth","borderRightWidth","marginLeft","marginRight","top","left","_getPosition","offsetTop","offsetLeft","_getOffset","rect","getBoundingClientRect","doc","ownerDocument","docElem","win","defaultView","clientTop","pageXOffset","clientLeft","sibling","NodeList","params","_encodeUri","Function","isNaN","search","currentStyle","uuid","$R","RedactorApp","app","version","modules","services","classes","plugins","mixins","modals","lang","dom","keycodes","BACKSPACE","DELETE","UP","DOWN","ENTER","SPACE","ESC","TAB","CTRL","META","SHIFT","ALT","RIGHT","LEFT","env","redactor","toArray","args","instance","Array","isArray","isApi","App","methodValue","isDestroy","unshift","api","translations","F","inherit","addLang","init","current","f","prop","__lookupGetter__","__defineGetter__","exception","extended","deep","merge","hasOwnProperty","opts","animation","direction","spellcheck","structure","scrollTarget","styles","stylesClass","placeholder","source","showSource","inline","breakline","markup","enterKey","clickToEdit","clickToSave","clickToCancel","focusEnd","minHeight","maxHeight","maxWidth","callbacks","preClass","preSpaces","tabindex","tabAsSpaces","tabKey","autosave","autosaveName","autosaveData","autosaveMethod","toolbar","toolbarFixed","toolbarFixedTarget","toolbarFixedTopOffset","toolbarExternal","toolbarContext","air","formatting","formattingAdd","formattingHide","buttons","buttonsTextLabeled","buttonsAdd","buttonsAddFirst","buttonsAddAfter","buttonsAddBefore","buttonsHide","buttonsHideOnMobile","imageUpload","imageUploadParam","imageData","imageEditable","imageCaption","imageLink","imagePosition","imageResizable","imageFloatMargin","imageFigure","imageObserve","imageSrcData","fileUpload","fileUploadParam","fileData","fileAttachment","uploadData","dragUpload","multipleUpload","clipboardUpload","uploadBase64","linkTarget","linkTitle","linkNewTab","linkNofollow","linkSize","linkValidation","cleanOnEnter","cleanInlineOnEnter","paragraphize","removeScript","removeNewLines","removeComments","replaceTags","pastePlainText","pasteLinkTarget","pasteImages","pasteLinks","pasteClean","pasteKeepStyle","pasteKeepClass","pasteKeepAttrs","pasteBlockTags","pasteInlineTags","activeButtons","b","strong","em","del","strike","u","activeButtonsAdd","activeButtonsObservers","autoparse","autoparseStart","autoparsePaste","autoparseLinks","autoparseImages","autoparseVideo","autoparseHttps","shortcodes","format","shortcodesAdd","shortcuts","shortcutsAdd","grammarly","notranslate","bufferLimit","emptyHtml","markerChar","imageTypes","imageAttrs","inlineTags","blockTags","regex","youtube","vimeo","imageurl","aurl1","aurl2","input","zindex","modes","title","icon","undo","redo","dropdown","tag","blockquote","pre","h1","h2","h3","h4","h5","h6","bold","tooltip","italic","deleted","underline","sup","sub","lists","observe","unorderedlist","orderedlist","outdent","indent","ul","ol","image","file","link","unlink","line","plugin","instances","started","stopped","rootElement","rootOpts","dragInside","dragComponentInside","$win","$doc","$body","editorReadOnly","buildServices","buildModules","buildPlugins","start","broadcast","stop","isStarted","isStopped","core","bindable","service","inj","isDragInside","setDragInside","isDragComponentInside","setDragComponentInside","getDragComponentInside","isReadOnly","enableReadOnly","component","clearActive","disableButtons","disableReadOnly","enableButtons","callMessageHandler","func","utils","checkProperty","returned","moduleName","cval","isApp","isCallback","isService","isPlugin","isModule","callInstanceMethod","isInstanceExists","Error","buildArgs","applyArgs","selection","_clearAll","clearClass","tags","save","$elements","getElements","_unwrapSpanWithoutAttr","restore","clearStyle","clearAttr","_removeAllAttr","set","toggle","className","newVal","oldVal","isRgb","rgb2hex","hex2long","toLowerCase","_convertStyleQuotes","removeEmptyAttr","nodeAttr","removeAttributeNode","finalNodes","tagName","cmnt","vars","_build","rebuild","_set","_loop","path","animationOpt","duration","iterate","delay","timing","prefix","AnimatePlay","effect","hidableEffects","prefixes","buildAnimationOff","isInanimate","inanimate","animate","isHidable","buildHideClass","isAnimated","setTimeout","complete","clean","setStart","_setCaret","setEnd","setBefore","setAfter","isStart","_isStartOrEnd","isEnd","setAtEnd","inspector","getTag","range","createRange","_isInPage","textNode","createInvisibleChar","selectNodeContents","collapse","setRange","setAtStart","isInline","insertNode","setAtBefore","setStartBefore","setAtAfter","setStartAfter","setAtPrev","previousSibling","_isEmptyTextNode","previousElementSibling","setAtNext","nextElementSibling","getNode","_setStart","isText","editor","findFirstNode","item","getFirstElement","dataItem","isComponent","getComponent","isComponentType","isFigcaption","code","findLastNode","table","getTable","tableData","setActive","_setInline","_setEnd","getLastElement","isEmpty","_setBefore","isFirstTableCell","isFirstListItem","getList","isBlock","_setAfter","isLastTableCell","_hasInlineChild","_getStartEndNode","trimSpaces","isComponentEditable","end","size","pos","getFirstNode","getLastNode","isInlineTag","trim","removeInvisibleChars","getFigcaption","isTable","isList","containsNode","getSelection","Selection","anchorNode","finalnode","focusNode","rectSelection","getRangeAt","rectBlock","sel","getElement","isCollapsed","getRange","isBackwards","backwards","anchorOffset","focusOffset","collapsed","detach","isIn","getCurrent","block","getBlock","blocks","getBlocks","isTableCellTag","isAll","isEditor","isNonEditable","isActive","output","getHtml","getText","hasNonEditable","$wrapper","removeAllRanges","addRange","setAll","saveScroll","disableNonEditables","marker","build","restoreMarkers","getComponentCodeElement","enableNonEditables","restoreScroll","rangeCount","getTextBeforeCaret","num","cloneRange","getTextAfterCaret","clonedRange","endContainer","endOffset","getPosition","startOffset","startContainer","right","bottom","getActive","getParent","isElement","isInEditor","getInline","_isInlineNode","getInlineFirst","getInlineAll","inlines","isBlockTag","getInlinesAllSelected","getInlines","all","inside","_isTextSelected","_filterNodesByTags","getNodes","filteredNodes","_isInNodesArray","_filterInlinesInside","_filterBlocksFirst","textnodes","activeComponent","_getNodesComponent","_getRangeSelectedNodes","_filterServicesNodes","_filterEditor","_filterNodesTexts","_filterNodesElements","cloneContents","cleaner","clear","collapseToStart","collapseToEnd","saveActiveComponent","savedComponent","restoreActiveComponent","_clearSaved","saved","savedElement","caret","saveMarkers","insert","_getNextNode","hasChildNodes","startNode","endNode","$editor","getChildNodes","commonAncestorContainer","skip","keepbr","passtexts","nodeTag","isFirst","isCellParent","escapeRegExp","$element","_buildType","isType","getType","scrolltop","pasting","isFocus","_isContenteditableFocus","startFocus","endFocus","isPasting","enablePasting","disablePasting","_getScrollTarget","scrolltopin","$noneditables","isSourceMode","keeplists","isEmptyHtml","$active","activeElement","setEmpty","editableElement","$target","$container","$source","content","_buildName","_buildStartedContent","getCode","getName","getStartedContent","setCode","insertion","isNameGenerated","rebuildStartedContent","sourceElement","$statusbar","items","update","$item","getItems","removeItems","dropdownOpened","buttonsObservers","_extendActiveButtons","stopObservers","$toolbar","button","observer","setButtonsInactive","getButton","currents","_inlinesToTags","detector","isMobile","isAir","isFixed","isContextBar","isTarget","getWrapper","getDropdown","getTargetElement","$btn","_findButton","getButtons","_findButtons","getButtonsKeys","addButton","btnObj","$button","addButtonFirst","addButtonAfter","addButtonBefore","addButtonObserver","setButtons","setDropdown","$buttons","setInactive","setButtonsActive","disable","enable","_init","isDisabled","hasIcon","message","setMessage","setApi","setTitle","setTooltip","setIcon","$icon","_buildTooltip","hideTooltip","preventDefault","_parseTitle","_parseTooltip","_buildCallback","_buildAttributes","_buildObserver","_buildIcon","isHtml","isDesktop","created","close","$items","isOpened","$dropdown","getItem","getItemsByClass","classname","_closeAll","_observe","_handleKeyboard","updatePosition","_isButton","_close","btnHeight","btnWidth","leftPos","cropHeight","_buildDom","_buildItems","_buildFormattingItems","which","$span","getTitle","storedComponents","storedComments","storedImages","storedLinks","deniedTags","convertRules","unconvertRules","reComments","reSpacedEmpty","reScriptTag","addConvertRules","addUnconvertRules","storeComments","encodeCode","buildWrapper","href","src","imageattrs","removeAttrs","removeDataSrc","getWrapperHtml","convert","storeComponents","_setSpanAttr","_setStyleCache","removeTags","_removeScriptTag","_replaceScriptTag","_isSpacedEmpty","restoreComponents","_cleanWrapped","restoreComments","removeMarkers","removeInvisibleSpaces","_isParagraphEmpty","removeServiceTagsAndAttrs","removeSpanWithoutAttributes","removeFirstBlockBreaklineInHtml","_unreplaceScriptTag","_setPreClass","_setLinkNofollow","cleanNewLines","unconvert","removeEmptyAttributes","cleanSpacesInPre","tidy","paste","isMsWord","_isHtmlMsWord","_cleanGDocs","_cleanMsWord","lastChild","exceptedTags","removeTagsExcept","$elms","filterStyle","filterClass","filterAttrs","$li","storeLinks","storeImages","getPlainText","_replaceNlToBr","restoreLinks","restoreImages","comments","getFlatText","$div","innerText","replaceToTag","replaceNbspToSpaces","replaceBlocksToBr","removeNl","removeBrAtEnd","denied","re","$0","except","encodeHtml","encodeEntities","encodeAttrSings","_encodeCode","decodeAttrSings","_encodeNode","encoded","decodeEntities","_encodeNodeHtml","encodePhpCode","String","matched","getElementsFromHtml","_storeMatched","_restoreMatched","spaces","floor","$parent","exec","parseInt","_parseWordLists","hasAttribute","lines","space","lastLevel","$list","$listChild","level","txt","listTag","stored","rules","_convertImage","_convertLine","_convertIframe","_convertTable","_convertForm","_convertCode","_convertWidget","_setContenteditableCode","isIe","_acceptExtraRules","_unconvertWidget","_unconvertForm","_unconvertTable","_unconvertImages","_removeTypes","_unconvertBreakTag","_isNonEditable","getRandomId","$link","$figure","_setFigure","_wrapFigure","isVideo","encodeURI","$next","decodeURI","hasFigcaption","hasStyle","$code","remStart","remEnd","paragraphizeTags","_isConverted","_convert","tablemarkup","_storeTags","_trimLinks","_restoreTags","_convertCell","replacement","createTextNode","outerHTML","_trimLink","_isDisabled","_isEmptyHtml","userAgent","navigator","isWebkit","isFirefox","v","documentMode","ie","isIpad","trimmed","_getString","_setComponentOffset","charIndex","nodeStack","foundStart","pop","nextCharIndex","_isFigcaptionNext","nodeValue","_extendTags","_isTag","isHeadingTag","$component","getComponentType","isComponentActive","isPre","getPre","isCode","_getLastOrFirstListItem","isLastListItem","_getLastOrFirstTableCell","isHeading","getHeading","isBlockquote","getBlockquote","isDl","getDl","isParagraph","getParagraph","isLink","getLink","isFile","getFile","hasParent","_getClosestNode","getParentList","_getClosestUpNode","getListItem","getTableCell","$td","getImageElement","_getClosestElement","list","id","_getPos","buildHtml","side","atStart","cloned","setEndBefore","$context","$marker","_restoreInject","activeClass","findSiblings","cell","_find","$caret","_buildCaret","setOnEvent","contextmenu","executeScripts","scripts","$script","instgrm","Embeds","process","head","fragment","isFragment","createFragment","_collapseSelection","_insertFragment","_sendNodes","insertBreakLine","insertNewline","insertText","insertHtml","insertChar","charhtml","insertRaw","insertToEnd","lastNode","$lastNode","$newNode","insertPoint","markerInserted","x","clientX","y","clientY","caretPositionFromPoint","offsetNode","caretRangeFromPoint","insertToPoint","point","insertToOffset","parsedInput","parseHtml","_insertToAllSelected","dataCurrent","_getCleanedInput","isFigure","_isFigure","isComponentSpan","_isComponentSpan","isInsertedText","_insertToEmptyEditor","_insertToWidget","_insertToInline","splitNode","_insertToCode","_insertToPre","_isPlainHtml","deleteContents","_hasBlocksAndImages","_containsTags","_buildList","insertedHtml","dataInserted","normalizeTextNodes","isLastInline","_isLastInline","ucfirst","isPreformatted","_getContainer","createTmpContainer","parentListTag","_hasFigureOrTable","_hasBlocks","_isHtmlString","_format","_apply","clearFormat","_clear","_getBlocks","_isToggleFormatType","replacedTag","_getReplacedTag","_replaceBlocks","_buildNodes","_restoreSelection","_getElements","finalBlocks","_isStandardParagraph","_isStandardDiv","_isBreaklineBlock","count","_isCurrentBlockOneAndEmpty","_applyArgs","_combinePre","_cleanBlocks","combinedNodes","$current","newline","headings","_cleanEmptyClass","_cleanEmptyStyle","keepStyleAndClass","keepAttrs","_isFormat","arrangeTag","formatCollapsed","formatUncollapsed","replaced","$secondPart","extractedContent","$inline","dataInline","hasSameArgs","insertInline","extractHtmlFromCaret","cloneAttributes","$breaked","$last","same","nodeAttrValue","origRules","styleToObj","innerCount","ruleName","ruleValue","_convertTags","_convertToStrike","execCommand","_clearDecoration","_revertToInlines","_clearEmptyStyle","_normalizeBlocks","_revertTags","_replaceToStrike","_forceRemoveClass","removeFromArrayByValue","textDecoration","textDecorationLine","_clearEmptyStyleAttr","$objects","$object","_isKey","reTags","imagesMatches","https","$video","_formatLinks","_restoreReplaced","enter","_convertToRegExp","$img","setSrc","$cloned","classstr","_subLinkText","substring","decodeURIComponent","observeImages","_addImage","observeFiles","_addFile","setStatus","getChanges","searchInvisibleChars","trimInvisibleChars","firstNode","n","div","extractContents","createMarkup","createMarkupBefore","exclude","elems","thisArg","newArr","recursive","nestedNodes","getChildElements","_getFirst","_getLast","$replaced","ax","a","elFrom","elTo","rule","extendData","serializedData","_setData","normalize","rgb","possible","random","$box","$bar","_is","_destroy","onstart","_startStop","onstop","onenable","ondisable","_buildModes","_buildMarkup","_redefineOptions","_isRootOption","autoparser","onenablefocus","_enableFocus","oncontextmenu","onclick","onkeyup","onenablereadonly","_enableReadOnly","ondisablereadonly","_disableReadOnly","onautoparseobserve","onplaceholder","_buildPlaceholder","_togglePlacehodler","_buildEvents","_buildOptions","_buildAccesibility","classesEditor","_destroyEvents","_disableBrowsersEditing","_enableFocusSource","_enableFocusEditor","setSelectionRange","attachEvent","returnValue","destroy","_getEditables","blurNamespace","eventsList","isFocused","isBlured","blur","targets","stopBlur","cut","_passSelectionToClipboard","drop","originalEvent","stopPropagation","_removeOverClass","$dragComponent","dataTransfer","getData","dragenter","dragstart","_setDragData","dragover","dragleave","detail","pad","pageY","keydown","keyup","mouseup","touchstart","_passAllToClipboard","clipboard","clipboardData","setData","dt","effectAllowed","$label","syncedHtml","onstartcode","sourceContent","startContent","syncContent","onstartcodeshow","ontrytosync","sync","onhardsync","_syncing","_buildClasses","editorHeight","_onChangedSource","_onTabKey","_onFocus","codemirror","codemirrorSrc","fromTextArea","setSize","cm","changeObj","_disableButtons","_setActiveSourceButton","getValue","toTextArea","_enableButtons","_setInactiveSourceButton","_isSync","timeout","clearTimeout","keyCode","selectionStart","selectionEnd","observerUnit","MutationObserver","subtree","childList","characterData","characterDataOldValue","disconnect","mutations","mutation","onstartclicktoedit","_isEnabled","buttonSave","buttonCancel","_setFocus","cancel","objected","enabled","statusbar","oncontextbar","$contextbar","_buildPosition","barWidth","barHeight","docScrollTop","targetOffset","leftFix","topFix","_buildTitle","_buildMessage","_toggle","toolbarModule","onsource","resetPosition","opened","createSourceHelper","destroySourceHelper","closed","openSelected","ontoolbar","removeexternal","onobserve","onfocus","_setExternalOnFocus","onsourcefocus","onempty","_buildButtons","_initToolbar","_initButtons","_buildImageButton","_buildFileButton","_buildSourceButton","_buildAdditionalButtons","_buildHiddenButtons","imageManagerJson","btns","_removeExistButtons","setExternal","clicks","$airHelper","_isSelection","_open","_openCmd","_isOpened","dataTarget","isModalTarget","isButtonCall","_doOpen","containerOffset","winWidth","toolbarWidth","isDropdownCall","$fixedTarget","reset","_doFixed","isHeight","toolbarHeight","boxOffset","boxEnd","scrollOffset","bsFix","fixedScrollTimeout","isExternalMultiple","_findToolbars","$toolbars","$external","_buildExternal","_buildFixed","_initExternal","_hideToolbarsExceptFirst","contextbar","_buildWrapper","_buildElement","_initWrapper","isCurrentLink","currentText","onmodal","$modal","$form","_setFormData","_setFormFocus","_validateData","_update","_insert","_unlink","onbutton","_observeButton","ondropdown","_observeUnlink","_observeEdit","_getCurrent","$point","_truncateText","_buildCurrent","_getModalData","_getLinks","_resetCurrent","_setLinkData","links","_insertSingle","_removeInSelection","_insertMultiple","$clonedLink","_isCurrentTextChanged","_deleteContents","textContext","isTextChanged","linkData","commands","_isLink","handle","currentLink","setError","getField","reUrl","_get","_get_target","_get_url","_get_title","_get_text","_findDeepestChild","_set_target","_set_text","_escapeHtml","_set_title","_set_url","_cleanUrl","_isMailto","_isUrl","depth","child","childResult","selectionMarkers","$overlay","resize","setWidth","_buildDefaults","_openUrl","_openTemplate","post","template","_createModal","_buildModalBox","_buildOverlay","_buildModal","_buildModalForm","_buildModalCommands","_broadcast","_buildModalTabs","_opened","_handleEscape","getBody","_handleEnter","_needToClose","_closed","$modalForm","setHeight","$footer","getFooter","_handleCommand","$tabs","_showTab","getForm","isCloseNode","command","getHeader","$modalHeader","$modalBody","$modalFooter","windowHeight","$modalClose","_buildClose","_buildHeader","_buildBody","_buildFooter","_buildTemplate","_getFieldEventName","_clearError","clearformat","clearstyle","clearclass","clearattr","onsynced","_send","request","_complete","lastShiftKey","onpaste","onkeydown","ctrlKey","metaKey","altKey","_selectAll","arrowKeys","isKeys","isArrowKeys","isXKey","isAlphaKeys","shiftKey","_isArrowKey","_isDeleteKey","_isRightLeftKey","_isExitVariable","_isRightDownKey","_isExitOnDownRight","_selectComponent","_isLeftUpKey","_isExitOnUpLeft","_exitPrevElement","isEndEditor","_exitNextElement","isNext","siblingBlock","_selectComponentItem","_removeActiveComponent","_removeAllSelectedTable","_detectVariableOrNonEditable","_traverseBackspace","_traverseDelete","_removeUnwantedStyles","_removeEmptySpans","_removeSpanTagsInHeadings","_removeInlineTagsInPre","isBlockStart","isBlockEnd","isCurrentStart","isCurrentEnd","isCurrentStartSpace","isCurrentEndSpace","_isVariable","_getBlock","dataNext","isNextBlock","$currentList","$first","$lists","$prev","dataPrev","isPrevBlock","$newnode","_replaceBlock","$block","_isNeedToReplaceBlock","_insertBreak","_isExit","_traverse","_disable","$newBlock","isParagraphExit","_isExitableBlock","isBreaklineExit","_isExitableDblBreak","_exitFromElement","blockTag","$variable","_traverseDl","nextDd","nextDt","dd","_clearBlock","_isNeedToCleanBlockStyle","pasteHtml","pointInserted","dropPasted","isRawCode","_isPlainText","files","getAsFile","_insertFiles","isImage","isClipboard","worked","hotkeys","hotkeysShiftNums","_handler","special","character","fromCharCode","modif","cmdKeys","specialKey","_insertHardTab","_tabCode","progress","paramName","_buildInput","_buildBox","$uploadbox","box","_onDropBox","_onDragOver","_onDragLeave","$placeholder","_onChange","_onClick","_onDrop","_setStatusDrop","_setStatusHover","_removeStatusHover","_setStatusError","_setStatusSuccess","_getUploadParam","_buildData","_sendData","Promise","$pre","_initElement","onform","_remove","storage","justResized","oninsert","_observeImages","onstarted","resizer","ondropimage","onbottomclick","onimageresizer","onupload","_uploadError","imageedit","_change","imagedrop","imagereplace","_setUpload","$image","_save","onimage","resized","_isImage","multiple","_createImageAndStore","inserted","_removeSpaceBeforeFigure","img","_removeInvisibleSpace","caption","align","modal","changeImage","$previewBox","_setReplaceUpload","_buildPreview","_buildPreviewUpload","$preview","$previewImg","$desc","_set_src","_set_id","_set_caption","$figcaption","_set_align","imageFloat","imageMargin","textAlign","positions","alignClass","_set_link","_findLink","_get_src","_get_id","_get_caption","_get_align","_get_link","_setResizerPosition","$resizableBox","$resizableImage","$resizer","topOffset","leftOffset","resizerWidth","resizerHeight","resizeHandle","pageX","ratio","h","targetTouches","_start","_move","_stop","_getResizableBoxWidth","ondropfile","filedrop","$file","_createFileAndStore","_insertAsAttachment","wrapAttachment","modalFormData","_truncateUrl","$remover","removeAttachment","$a","state","passed","keyPressed","undoStorage","redoStorage","_listen","onsyncing","onbuffer","onstate","_isUndo","_isRedo","_saveState","_setUndo","_getUndo","_getRedo","ctrl","cmd","_hasUndo","_removeOverStorage","_setRedo","buffer","_hasRedo","_observeDropdown","_isUnformat","_unformat","$prevChild","$newList","nextItems","nextList","$listItem","$liItem","isTop","isMiddle","isBottom","_getAllNext","_createUnformatContainer","$childList","countLists","_uniteBlocks","_createList","_createListItem","$oldList","lastcell","$cell","_isUniteBlock","selectedItems","_unformatEntire","_getItemsPosition","_unformatAtSide","ci","$secondList","$innerLists","sFirst","sLast","_observeButtonsList","itemOutdent","itemIndent","_observeIndent","isIndent","param","_getHtml","Redactor","globalThis","__esModule","default","locals","listToStyles","parentId","newStyles","part","media","sourceMap","parts","hasDocument","DEBUG","stylesInDom","singletonElement","singletonCounter","isProduction","noop","ssrIdKey","isOldIE","addStylesClient","_isProduction","_options","addStylesToDom","newList","mayRemove","domStyle","refs","j","addStyle","createStyleElement","styleElement","styleIndex","applyToSingletonTag","applyToTag","newObj","textStore","replaceText","Boolean","styleSheet","cssText","cssNode","ssrId","sources","btoa","unescape","stringify","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","getter","d","definition","defineProperty","enumerable","r","Symbol","toStringTag","nmd","paths"],"sourceRoot":""}