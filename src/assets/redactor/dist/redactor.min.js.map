{"version":3,"sources":["redactor.js"],"names":["Ajax","settings","post","options","AjaxRequest","get","method","defaults","url","before","success","error","data","async","headers","this","p","extend","toUpperCase","prepareData","xhr","XMLHttpRequest","open","setHeaders","send","prototype","obj1","obj2","name","isFormData","toParams","setRequestHeader","window","FormData","isComplete","status","onload","loaded","bind","call","response","json","parseJson","statusText","str","o","JSON","parse","e","obj","Object","keys","map","k","encodeURIComponent","join","DomCache","DomExpando","Date","getTime","DomHClass","DomHMClass","Dom","selector","context","ready","fn","document","readyState","addEventListener","sdom","length","nodes","nodeType","childNodes","test","create","_query","_slice","html","createElement","RegExp","$1","elements","container","children","innerHTML","i","l","push","add","concat","_toArray","index","getAll","eq","first","last","contents","each","callback","len","is","filter","undefined","node","Node","indexOf","matches","msMatchesSelector","webkitMatchesSelector","not","find","ns","parent","parentNode","parents","_getContext","closest","isNode","next","_getSibling","nextElement","prev","prevElement","css","value","_getHeightOrWidth","getComputedStyle","key","style","attr","checked","_getBooleanFromStr","getAttribute","setAttribute","reDataAttr","attrs","attributes","replacer","g","nodeName","dataName","match","val","replace","_isObjectString","_toObject","_isNumber","parseFloat","el","type","removeAttr","split","forEach","removeAttribute","removeData","dataset","dataindex","dataget","cacheIndex","nextCacheIndex","addClass","_eachClass","removeClass","toggleClass","hasClass","some","classList","contains","empty","append","text","textContent","after","_inject","frag","insertAdjacentHTML","reverse","s","insertBefore","nextSibling","elms","appendChild","prepend","firstChild","wrap","wrapper","unwrap","$node","replaceWith","docFrag","createDocumentFragment","result","replaceChild","remove","removeChild","clone","events","copy","_clone","_cloneEvents","show","_hasDisplayNone","target","isHidden","isHiddenMobile","display","hide","scrollTop","isWindow","isDocument","scrollingElement","body","documentElement","pageYOffset","scrollTo","offset","_getDim","position","width","adjust","_getSize","height","outerWidth","_getInnerOrOuter","outerHeight","innerWidth","innerHeight","click","_triggerEvent","focus","trigger","names","ev","CustomEvent","bubbles","cancelable","createEvent","initCustomEvent","dispatchEvent","on","handler","one","event","_getEventName","namespace","_getEventNamespace","_getOneHandler","_e","off","testEvent","testNamespace","testEventNamespace","testPositive","_offEvent","serialize","asObject","disabled","z","opt","selected","_toParams","ajax","_queryContext","querySelectorAll","element","getElementById","slice","getElementsByClassName","getElementsByTagName","querySelector","res","_events","cloneNode","self","apply","arguments","arr","condition","handlers","toString","removeEventListener","splice","_getDocSize","Math","max","captype","round","_adjustResultHeightOrWidth","charAt","$el","$targets","fixStyle","tmp","thisStyle","fix","isBorderBox","boxSizing","borderTopWidth","borderBottomWidth","marginTop","marginBottom","borderLeftWidth","borderRightWidth","marginLeft","marginRight","top","left","_getPosition","offsetTop","offsetLeft","_getOffset","rect","getBoundingClientRect","doc","ownerDocument","docElem","win","defaultView","clientTop","pageXOffset","clientLeft","sibling","NodeList","params","_encodeUri","Function","isNaN","search","currentStyle","uuid","$R","RedactorApp","app","version","modules","services","classes","plugins","mixins","modals","lang","dom","keycodes","BACKSPACE","DELETE","UP","DOWN","ENTER","SPACE","ESC","TAB","CTRL","META","SHIFT","ALT","RIGHT","LEFT","env","plugin","module","service","class","mixin","jQuery","redactor","toArray","args","instance","Array","isArray","isApi","App","methodValue","isDestroy","unshift","api","translations","F","inherit","addLang","init","current","f","prop","__lookupGetter__","__defineGetter__","super","exception","extended","deep","merge","hasOwnProperty","opts","animation","direction","spellcheck","structure","scrollTarget","styles","stylesClass","placeholder","source","showSource","inline","breakline","markup","enterKey","clickToEdit","clickToSave","clickToCancel","focusEnd","minHeight","maxHeight","maxWidth","callbacks","preClass","preSpaces","tabindex","tabAsSpaces","tabKey","autosave","autosaveName","autosaveData","toolbar","toolbarFixed","toolbarFixedTarget","toolbarFixedTopOffset","toolbarExternal","toolbarContext","air","formatting","formattingAdd","formattingHide","buttons","buttonsTextLabeled","buttonsAdd","buttonsAddFirst","buttonsAddAfter","buttonsAddBefore","buttonsHide","buttonsHideOnMobile","imageUpload","imageUploadParam","imageData","imageEditable","imageCaption","imageLink","imagePosition","imageResizable","imageFloatMargin","imageFigure","imageObserve","fileUpload","fileUploadParam","fileData","fileAttachment","uploadData","dragUpload","multipleUpload","clipboardUpload","uploadBase64","linkTarget","linkTitle","linkNewTab","linkNofollow","linkSize","linkValidation","cleanOnEnter","cleanInlineOnEnter","paragraphize","removeScript","removeNewLines","removeComments","replaceTags","b","strike","pastePlainText","pasteLinkTarget","pasteImages","pasteLinks","pasteClean","pasteKeepStyle","pasteKeepClass","pasteKeepAttrs","pasteBlockTags","pasteInlineTags","activeButtons","strong","em","del","u","activeButtonsAdd","activeButtonsObservers","autoparse","autoparseStart","autoparsePaste","autoparseLinks","autoparseImages","autoparseVideo","shortcodes","p.","format","quote.","pre.","h1.","h2.","h3.","h4.","h5.","h6.","*.","shortcodesAdd","shortcuts","ctrl+shift+m, meta+shift+m","ctrl+b, meta+b","ctrl+i, meta+i","ctrl+u, meta+u","ctrl+h, meta+h","ctrl+l, meta+l","ctrl+k, meta+k","ctrl+alt+0, meta+alt+0","ctrl+alt+1, meta+alt+1","ctrl+alt+2, meta+alt+2","ctrl+alt+3, meta+alt+3","ctrl+alt+4, meta+alt+4","ctrl+alt+5, meta+alt+5","ctrl+alt+6, meta+alt+6","ctrl+shift+7, meta+shift+7","ctrl+shift+8, meta+shift+8","shortcutsAdd","grammarly","notranslate","bufferLimit","emptyHtml","markerChar","imageTypes","imageAttrs","inlineTags","blockTags","regex","youtube","vimeo","imageurl","input","zindex","modes","original","image","file","link","bold","italic","deleted","underline","superscript","subscript","bold-abbr","italic-abbr","deleted-abbr","underline-abbr","superscript-abbr","subscript-abbr","lists","link-insert","link-edit","link-in-new-tab","unlink","cancel","close","insert","save","delete","edit","title","paragraph","quote","code","heading1","heading2","heading3","heading4","heading5","heading6","filename","optional","unorderedlist","orderedlist","outdent","indent","horizontalrule","upload","upload-label","accessibility-help-label","caption","bulletslist","numberslist","image-position","none","right","center","undo","redo","icon","dropdown","tag","blockquote","pre","h1","h2","h3","h4","h5","h6","tooltip","sup","sub","observe","ul","ol","line","instances","started","stopped","rootElement","rootOpts","dragInside","dragComponentInside","$win","$doc","$body","editorReadOnly","buildServices","buildModules","buildPlugins","start","broadcast","stop","isStarted","isStopped","core","bindable","inj","isDragInside","setDragInside","isDragComponentInside","setDragComponentInside","getDragComponentInside","isReadOnly","enableReadOnly","component","clearActive","disableButtons","disableReadOnly","enableButtons","callMessageHandler","func","utils","checkProperty","moduleName","isApp","isCallback","isService","isPlugin","isModule","callInstanceMethod","isInstanceExists","Error","buildArgs","applyArgs","selection","_clearAll","clearClass","tags","$elements","getElements","_unwrapSpanWithoutAttr","restore","clearStyle","clearAttr","_removeAllAttr","set","toggle","className","newVal","oldVal","isRgb","rgb2hex","hex2long","toLowerCase","_convertStyleQuotes","removeEmptyAttr","nodeAttr","removeAttributeNode","finalNodes","tagName","cmnt","vars","_build","rebuild","_set","_loop","path","animationOpt","duration","iterate","delay","timing","prefix","AnimatePlay","effect","hidableEffects","prefixes","buildAnimationOff","isInanimate","inanimate","animate","isHidable","buildHideClass","isAnimated","setTimeout","complete","clean","setStart","_setCaret","setEnd","setBefore","setAfter","isStart","_isStartOrEnd","isEnd","setAtEnd","inspector","getTag","range","createRange","_isInPage","textNode","createInvisibleChar","selectNodeContents","collapse","setRange","setAtStart","isInline","isEmpty","insertNode","setAtBefore","setStartBefore","setAtAfter","setStartAfter","setAtPrev","previousSibling","_isEmptyTextNode","previousElementSibling","setAtNext","nextElementSibling","getNode","_setStart","isText","editor","findFirstNode","item","getFirstElement","dataItem","isComponent","getComponent","isComponentType","isFigcaption","findLastNode","table","getTable","tableData","setActive","_setInline","_setEnd","getLastElement","_setBefore","isFirstTableCell","isFirstListItem","getList","isBlock","_setAfter","isLastTableCell","_hasInlineChild","_getStartEndNode","trimSpaces","isComponentEditable","end","size","pos","getFirstNode","getLastNode","isInlineTag","trim","removeInvisibleChars","getFigcaption","isTable","isList","containsNode","getSelection","Selection","containsNodePolyfill","anchorNode","finalnode","focusNode","rectSelection","getRangeAt","rectBlock","sel","isInEditor","isEditor","isCollapsed","getRange","isBackwards","backwards","anchorOffset","focusOffset","collapsed","detach","isIn","getCurrent","block","getBlock","blocks","getBlocks","isTableCellTag","isAll","isNonEditable","isActive","output","getElement","getHtml","getText","hasNonEditable","$wrapper","removeAllRanges","addRange","setAll","saveScroll","disableNonEditables","marker","build","restoreMarkers","getComponentCodeElement","enableNonEditables","restoreScroll","rangeCount","getTextBeforeCaret","num","cloneRange","getTextAfterCaret","clonedRange","endContainer","endOffset","getPosition","startOffset","startContainer","bottom","getActive","getParent","isElement","getInline","_isInlineNode","getInlineFirst","getInlineAll","inlines","isBlockTag","getInlinesAllSelected","getInlines","all","textNodes","getNodes","textnodes","_isTextSelected","_filterNodesByTags","filteredNodes","_isInNodesArray","inside","_filterInlinesInside","_filterBlocksFirst","activeComponent","_getNodesComponent","_getRangeSelectedNodes","_filterServicesNodes","_filterEditor","_filterNodesTexts","_filterNodesElements","cloneContents","cleaner","clear","collapseToStart","collapseToEnd","saveActiveComponent","savedComponent","restoreActiveComponent","_clearSaved","saved","savedElement","caret","saveMarkers","_getNextNode","hasChildNodes","startNode","endNode","$editor","getChildNodes","commonAncestorContainer","skip","keepbr","passtexts","nodeTag","isFirst","isCellParent","escapeRegExp","$element","_buildType","isType","getType","scrolltop","pasting","isFocus","_isContenteditableFocus","startFocus","endFocus","isPasting","enablePasting","disablePasting","_getScrollTarget","scrolltopin","$noneditables","isSourceMode","keeplists","isEmptyHtml","$active","activeElement","setEmpty","editableElement","$target","$container","$source","content","_buildName","_buildStartedContent","getCode","getName","getStartedContent","setCode","insertion","isNameGenerated","rebuildStartedContent","sourceElement","$statusbar","items","update","$item","getItems","removeItems","dropdownOpened","buttonsObservers","_extendActiveButtons","stopObservers","$toolbar","button","observer","setButtonsInactive","getButton","_inlinesToTags","detector","isMobile","isAir","isFixed","isContextBar","isTarget","getWrapper","getDropdown","getTargetElement","$btn","_findButton","getButtons","_findButtons","getButtonsKeys","addButton","btnObj","$button","addButtonFirst","addButtonAfter","addButtonBefore","addButtonObserver","setButtons","setDropdown","$buttons","setInactive","setButtonsActive","disable","enable","_init","isDisabled","hasIcon","message","setMessage","setApi","setTitle","alt","aria-label","setTooltip","setIcon","$icon","_buildTooltip","hideTooltip","preventDefault","_parseTitle","_parseTooltip","_buildCallback","_buildAttributes","_buildObserver","_buildIcon","href","rel","role","isHtml","isDesktop","created","$items","isOpened","$dropdown","getItem","getItemsByClass","classname","_closeAll","_observe","_handleKeyboard","updatePosition","_isButton","_close","btnHeight","btnWidth","topOffset","leftPos","cropHeight","_buildDom","_buildItems","_buildFormattingItems","which","$span","getTitle","storedComponents","storedComments","storedImages","storedLinks","deniedTags","convertRules","unconvertRules","reComments","reSpacedEmpty","reScriptTag","addConvertRules","addUnconvertRules","storeComments","encodeCode","buildWrapper","imageattrs","getWrapperHtml","convert","storeComponents","_setSpanAttr","_setStyleCache","removeTags","_removeScriptTag","_replaceScriptTag","_isSpacedEmpty","restoreComponents","_cleanWrapped","restoreComments","removeMarkers","removeInvisibleSpaces","_isParagraphEmpty","removeServiceTagsAndAttrs","removeSpanWithoutAttributes","removeFirstBlockBreaklineInHtml","_unreplaceScriptTag","_setPreClass","_setLinkNofollow","cleanNewLines","unconvert","removeEmptyAttributes","cleanSpacesInPre","tidy","paste","isMsWord","_isHtmlMsWord","_cleanGDocs","_cleanMsWord","lastChild","exceptedTags","removeTagsExcept","$elms","filterStyle","filterClass","filterAttrs","$li","storeLinks","storeImages","getPlainText","_replaceNlToBr","restoreLinks","restoreImages","comments","getFlatText","$div","innerText","replaceToTag","replaceNbspToSpaces","replaceBlocksToBr","removeNl","removeBrAtEnd","denied","re","$0","except","encodeHtml","encodeEntities","_encodeCode","_encodeNode","encoded","decodeEntities","_encodeNodeHtml","encodePhpCode","String","matched","getElementsFromHtml","_storeMatched","_restoreMatched","spaces","floor","$parent","exec","parseInt","_parseWordLists","hasAttribute","lines","space","lastLevel","$list","$listChild","level","txt","listTag","stored","rules","_convertImage","_convertLine","_convertIframe","_convertTable","_convertForm","_convertCode","_convertWidget","_setContenteditableCode","isIe","_acceptExtraRules","_unconvertWidget","_unconvertForm","_unconvertTable","_unconvertImages","_removeTypes","_unconvertBreakTag","_isNonEditable","getRandomId","$link","$figure","_setFigure","_wrapFigure","src","isVideo","encodeURI","$next","decodeURI","hasFigcaption","hasStyle","$code","remStart","remEnd","paragraphizeTags","_isConverted","_convert","tablemarkup","_storeTags","_trimLinks","_restoreTags","_convertCell","replacement","createTextNode","outerHTML","_trimLink","_isDisabled","_isEmptyHtml","userAgent","navigator","isWebkit","isFirefox","v","documentMode","ie","isIpad","trimmed","_getString","_setComponentOffset","charIndex","nodeStack","foundStart","pop","nextCharIndex","_isFigcaptionNext","nodeValue","_extendTags","_isTag","isHeadingTag","$component","getComponentType","isComponentActive","isPre","getPre","isCode","_getLastOrFirstListItem","isLastListItem","_getLastOrFirstTableCell","isHeading","getHeading","isBlockquote","getBlockquote","isDl","getDl","isParagraph","getParagraph","isLink","getLink","isFile","getFile","hasParent","_getClosestNode","getParentList","_getClosestUpNode","getListItem","getTableCell","$td","getImageElement","_getClosestElement","list","id","_getPos","buildHtml","side","atStart","cloned","setEndBefore","$context","$marker","_restoreInject","activeClass","findSiblings","cell","_find","$caret","_buildCaret","setOnEvent","contextmenu","executeScripts","scripts","$script","instgrm","Embeds","process","head","eval","fragment","isFragment","createFragment","_collapseSelection","_insertFragment","_sendNodes","insertBreakLine","insertNewline","insertText","insertHtml","insertChar","charhtml","insertRaw","insertToEnd","lastNode","$lastNode","$newNode","insertPoint","markerInserted","x","clientX","y","clientY","caretPositionFromPoint","offsetNode","caretRangeFromPoint","insertToPoint","point","insertToOffset","parsedInput","parseHtml","_insertToAllSelected","dataCurrent","_getCleanedInput","isFigure","_isFigure","isComponentSpan","_isComponentSpan","isInsertedText","_insertToEmptyEditor","_insertToWidget","_insertToInline","splitNode","_insertToCode","_insertToPre","deleteContents","_hasBlocksAndImages","_isPlainHtml","_containsTags","_buildList","insertedHtml","dataInserted","normalizeTextNodes","isLastInline","_isLastInline","ucfirst","isPreformatted","_getContainer","createTmpContainer","parentListTag","_hasFigureOrTable","_hasBlocks","_isHtmlString","_format","_apply","clearFormat","_clear","_getBlocks","_isToggleFormatType","replacedTag","_getReplacedTag","_replaceBlocks","_buildNodes","_restoreSelection","_getElements","finalBlocks","_isStandardParagraph","_isStandardDiv","_isBreaklineBlock","count","_isCurrentBlockOneAndEmpty","_applyArgs","_combinePre","_cleanBlocks","combinedNodes","$current","newline","headings","_cleanEmptyClass","_cleanEmptyStyle","keepStyleAndClass","keepAttrs","_isFormat","arrangeTag","formatCollapsed","formatUncollapsed","replaced","$secondPart","extractedContent","$inline","dataInline","hasSameArgs","insertInline","extractHtmlFromCaret","cloneAttributes","$breaked","$last","same","nodeAttrValue","origRules","styleToObj","innerCount","ruleName","ruleValue","_convertTags","_convertToStrike","execCommand","_clearDecoration","_revertToInlines","_clearEmptyStyle","_normalizeBlocks","_revertTags","_replaceToStrike","_forceRemoveClass","removeFromArrayByValue","textDecoration","textDecorationLine","_clearEmptyStyleAttr","$objects","$object","_isKey","reTags","imagesMatches","$video","_formatLinks","_restoreReplaced","enter","_convertToRegExp","$img","setSrc","$cloned","linkProtocol","regexB","substring","decodeURIComponent","observeImages","_addImage","observeFiles","_addFile","setStatus","getChanges","searchInvisibleChars","trimInvisibleChars","firstNode","n","div","extractContents","createMarkup","createMarkupBefore","exclude","elems","thisArg","newArr","recursive","nestedNodes","getChildElements","_getFirst","_getLast","$replaced","ax","a","elFrom","elTo","rule","extendData","serializedData","_setData","normalize","rgb","possible","random","$box","$bar","_is","_destroy","onstart","_startStop","onstop","onenable","ondisable","_buildModes","_buildMarkup","_redefineOptions","_isRootOption","autoparser","onenablefocus","_enableFocus","oncontextmenu","onclick","onkeyup","onenablereadonly","_enableReadOnly","ondisablereadonly","_disableReadOnly","onautoparseobserve","onplaceholder","_buildPlaceholder","_togglePlacehodler","_buildEvents","_buildOptions","_buildAccesibility","classesEditor","_destroyEvents","contenteditable","_disableBrowsersEditing","max-width","margin","aria-labelledby","_enableFocusSource","_enableFocusEditor","setSelectionRange","attachEvent","returnValue","destroy","_getEditables","blurNamespace","eventsList","isFocused","isBlured","blur","targets","stopBlur","cut","_passSelectionToClipboard","drop","originalEvent","stopPropagation","_removeOverClass","$dragComponent","dataTransfer","getData","dragenter","dragstart","_setDragData","dragover","dragleave","detail","pad","pageY","keydown","keyup","mouseup","touchstart","_passAllToClipboard","clipboard","clipboardData","setData","dt","effectAllowed","$label","aria-hidden","syncedHtml","onstartcode","sourceContent","startContent","syncContent","onstartcodeshow","ontrytosync","sync","onhardsync","_syncing","_buildClasses","editorHeight","_onChangedSource","_onTabKey","_onFocus","codemirror","codemirrorSrc","CodeMirror","fromTextArea","setSize","cm","changeObj","_disableButtons","_setActiveSourceButton","getValue","toTextArea","_enableButtons","_setInactiveSourceButton","_isSync","timeout","clearTimeout","keyCode","selectionStart","selectionEnd","observerUnit","MutationObserver","subtree","childList","characterData","characterDataOldValue","disconnect","mutations","mutation","onstartclicktoedit","_isEnabled","buttonSave","buttonCancel","_setFocus","objected","enabled","statusbar","oncontextbar","$contextbar","_buildPosition","barWidth","barHeight","docScrollTop","targetOffset","leftFix","topFix","_buildTitle","_buildMessage","_toggle","toolbarModule","onsource","resetPosition","opened","createSourceHelper","destroySourceHelper","closed","openSelected","ontoolbar","removeexternal","onobserve","onfocus","_setExternalOnFocus","onsourcefocus","onempty","_buildButtons","_initToolbar","_initButtons","_buildImageButton","_buildFileButton","_buildSourceButton","_buildAdditionalButtons","_buildHiddenButtons","imageManagerJson","btns","_removeExistButtons","setExternal","clicks","$airHelper","_isSelection","_open","_openCmd","_isOpened","dataTarget","isModalTarget","isButtonCall","_doOpen","containerOffset","winWidth","toolbarWidth","isDropdownCall","$fixedTarget","reset","_doFixed","isHeight","toolbarHeight","boxOffset","boxEnd","scrollOffset","bsFix","fixedScrollTimeout","isExternalMultiple","_findToolbars","$toolbars","$external","_buildExternal","_buildFixed","_initExternal","_hideToolbarsExceptFirst","contextbar","_buildWrapper","_buildElement","_initWrapper","data-redactor-type","isCurrentLink","currentText","onmodal","$modal","$form","_setFormData","_setFormFocus","_validateData","_update","_insert","_unlink","onbutton","_observeButton","ondropdown","_observeUnlink","_observeEdit","_getCurrent","$point","_truncateText","_buildCurrent","_getModalData","_getLinks","_resetCurrent","_setLinkData","links","_insertSingle","_removeInSelection","_insertMultiple","$clonedLink","_isCurrentTextChanged","_deleteContents","textContext","isTextChanged","linkData","commands","_isLink","handle","currentLink","setError","getField","reUrl","_get","_get_target","_get_url","_get_title","_get_text","_findDeepestChild","_set_target","_set_text","_set_title","_set_url","_cleanUrl","_isMailto","_isUrl","depth","child","childResult","selectionMarkers","$overlay","resize","setWidth","_buildDefaults","_openUrl","_openTemplate","template","_createModal","_buildModalBox","_buildOverlay","_buildModal","_buildModalForm","_buildModalCommands","_broadcast","_buildModalTabs","_opened","_handleEscape","getBody","_handleEnter","_needToClose","_closed","$modalForm","setHeight","$footer","getFooter","_handleCommand","$tabs","_showTab","getForm","isCloseNode","command","getHeader","$modalHeader","$modalBody","$modalFooter","margin-left","windowHeight","$modalClose","_buildClose","_buildHeader","_buildBody","_buildFooter","_buildTemplate","_getFieldEventName","_clearError","clearformat","clearstyle","clearclass","clearattr","onsynced","_send","_complete","lastShiftKey","onpaste","onkeydown","ctrlKey","metaKey","altKey","_selectAll","arrowKeys","isKeys","isArrowKeys","isXKey","isAlphaKeys","shiftKey","_isArrowKey","_isDeleteKey","_isRightLeftKey","_isExitVariable","_isRightDownKey","_isExitOnDownRight","_selectComponent","_isLeftUpKey","_isExitOnUpLeft","_exitPrevElement","isEndEditor","_exitNextElement","isNext","siblingBlock","_selectComponentItem","_removeActiveComponent","_removeAllSelectedTable","_detectVariableOrNonEditable","_traverseBackspace","_traverseDelete","_removeUnwantedStyles","_removeEmptySpans","_removeSpanTagsInHeadings","_removeInlineTagsInPre","isBlockStart","isBlockEnd","isCurrentStart","isCurrentEnd","isCurrentStartSpace","isCurrentEndSpace","_isVariable","_getBlock","dataNext","isNextBlock","$currentList","$first","$lists","$prev","dataPrev","isPrevBlock","$newnode","_replaceBlock","$block","_isNeedToReplaceBlock","_insertBreak","_isExit","_traverse","_disable","isParagraphExit","_isExitableBlock","isBreaklineExit","_isExitableDblBreak","_exitFromElement","blockTag","$variable","_traverseDl","nextDd","nextDt","dd","_clearBlock","_isNeedToCleanBlockStyle","pasteHtml","pointInserted","dropPasted","isRawCode","_isPlainText","files","getAsFile","_insertFiles","returned","isImage","isClipboard","worked","hotkeys","8","9","10","13","16","17","18","19","20","27","32","33","34","35","36","37","38","39","40","45","46","59","61","96","97","98","99","100","101","102","103","104","105","106","107","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","144","145","173","186","187","188","189","190","191","192","219","220","221","222","hotkeysShiftNums","`","1","2","3","4","5","6","7","0","-","=",";","'",",",".","/","\\","_handler","special","character","fromCharCode","modif","cmdKeys","specialKey","_insertHardTab","_tabCode","progress","paramName","_buildInput","_buildBox","$uploadbox","box","_onDropBox","_onDragOver","_onDragLeave","$placeholder","_onChange","_onClick","_onDrop","_setStatusDrop","_setStatusHover","_removeStatusHover","_setStatusError","_setStatusSuccess","_getUploadParam","_buildData","_sendData","Promise","$pre","_initElement","onform","_remove","imageedit","storage","justResized","oninsert","_observeImages","onstarted","resizer","ondropimage","onbottomclick","onimageresizer","onupload","_uploadError","_change","imagedrop","imagereplace","_setUpload","$image","_save","onimage","resized","_isImage","multiple","_createImageAndStore","inserted","_removeSpaceBeforeFigure","img","_removeInvisibleSpace","align","modal","changeImage","$previewBox","_setReplaceUpload","_buildPreview","_buildPreviewUpload","$preview","$previewImg","$desc","_set_src","_set_id","_set_caption","$figcaption","_set_align","imageFloat","imageMargin","textAlign","positions","alignClass","float","text-align","_set_link","_findLink","_get_src","_get_id","_get_caption","_get_align","_get_link","_setResizerPosition","$resizableBox","$resizableImage","$resizer","leftOffset","resizerWidth","resizerHeight","resizeHandle","pageX","ratio","h","targetTouches","_start","_move","_stop","_getResizableBoxWidth","ondropfile","filedrop","$file","_createFileAndStore","_insertAsAttachment","wrapAttachment","modalFormData","_truncateUrl","$remover","removeAttachment","$a","state","passed","keyPressed","undoStorage","redoStorage","_listen","onsyncing","onbuffer","onstate","_isUndo","_isRedo","_saveState","_setUndo","_getUndo","_getRedo","ctrl","cmd","_hasUndo","_removeOverStorage","_setRedo","buffer","_hasRedo","_observeDropdown","_isUnformat","_unformat","$prevChild","$newList","nextItems","nextList","$listItem","$liItem","isTop","isMiddle","isBottom","_getAllNext","_createUnformatContainer","$childList","countLists","_uniteBlocks","_createList","_createListItem","$oldList","lastcell","$cell","_isUniteBlock","selectedItems","_unformatEntire","_getItemsPosition","_unformatAtSide","ci","$secondList","$innerLists","sFirst","sLast","_observeButtonsList","itemOutdent","itemIndent","_observeIndent","isIndent","param","_getHtml","Redactor","exports"],"mappings":"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","file":"redactor.min.js","sourcesContent":["/*\n    Redactor\n    Version 3.4.3\n    Updated: Semtember 18, 2020\n\n    http://imperavi.com/redactor/\n\n    Copyright (c) 2009-2020, Imperavi Ltd.\n    License: http://imperavi.com/redactor/license/\n*/\n(function() {\nvar Ajax = {};\n\nAjax.settings = {};\nAjax.post = function(options) { return new AjaxRequest('post', options); };\nAjax.get = function(options) { return new AjaxRequest('get', options); };\n\nvar AjaxRequest = function(method, options)\n{\n    var defaults = {\n        method: method,\n        url: '',\n        before: function() {},\n        success: function() {},\n        error: function() {},\n        data: false,\n        async: true,\n        headers: {}\n    };\n\n    this.p = this.extend(defaults, options);\n    this.p = this.extend(this.p, Ajax.settings);\n    this.p.method = this.p.method.toUpperCase();\n\n    this.prepareData();\n\n    this.xhr = new XMLHttpRequest();\n    this.xhr.open(this.p.method, this.p.url, this.p.async);\n\n    this.setHeaders();\n\n    var before = (typeof this.p.before === 'function') ? this.p.before(this.xhr) : true;\n    if (before !== false)\n    {\n        this.send();\n    }\n};\n\nAjaxRequest.prototype = {\n    extend: function(obj1, obj2)\n    {\n        if (obj2) for (var name in obj2) { obj1[name] = obj2[name]; }\n        return obj1;\n    },\n    prepareData: function()\n    {\n        if (this.p.method === 'POST' && !this.isFormData()) this.p.headers['Content-Type'] = 'application/x-www-form-urlencoded';\n        if (typeof this.p.data === 'object' && !this.isFormData()) this.p.data = this.toParams(this.p.data);\n        if (this.p.method === 'GET') this.p.url = (this.p.data) ? this.p.url + '?' + this.p.data : this.p.url;\n    },\n    setHeaders: function()\n    {\n        this.xhr.setRequestHeader('X-Requested-With', this.p.headers['X-Requested-With'] || 'XMLHttpRequest');\n        for (var name in this.p.headers)\n        {\n            this.xhr.setRequestHeader(name, this.p.headers[name]);\n        }\n    },\n    isFormData: function()\n    {\n        return (typeof window.FormData !== 'undefined' && this.p.data instanceof window.FormData);\n    },\n    isComplete: function()\n    {\n        return !(this.xhr.status < 200 || this.xhr.status >= 300 && this.xhr.status !== 304);\n    },\n    send: function()\n    {\n        if (this.p.async)\n        {\n            this.xhr.onload = this.loaded.bind(this);\n            this.xhr.send(this.p.data);\n        }\n        else\n        {\n            this.xhr.send(this.p.data);\n            this.loaded.call(this);\n        }\n    },\n    loaded: function()\n    {\n        if (this.isComplete())\n        {\n            var response = this.xhr.response;\n            var json = this.parseJson(response);\n            response = (json) ? json : response;\n\n            if (typeof this.p.success === 'function') this.p.success(response, this.xhr);\n        }\n        else\n        {\n            if (typeof this.p.error === 'function') this.p.error(this.xhr.statusText);\n        }\n    },\n    parseJson: function(str)\n    {\n        try {\n            var o = JSON.parse(str);\n            if (o && typeof o === 'object')\n            {\n                return o;\n            }\n\n        } catch (e) {}\n\n        return false;\n    },\n    toParams: function (obj)\n    {\n        return Object.keys(obj).map(\n            function(k){ return encodeURIComponent(k) + '=' + encodeURIComponent(obj[k]); }\n        ).join('&');\n    }\n};\nvar DomCache = [0];\nvar DomExpando = 'data' + new Date().getTime();\nvar DomHClass = 'is-hidden';\nvar DomHMClass = 'is-hidden-mobile';\n\nvar Dom = function(selector, context)\n{\n    return this.parse(selector, context);\n};\n\nDom.ready = function(fn)\n{\n    if (document.readyState != 'loading') fn();\n    else document.addEventListener('DOMContentLoaded', fn);\n};\n\nDom.prototype = {\n    get sdom()\n    {\n        return true;\n    },\n    get length()\n    {\n        return this.nodes.length;\n    },\n    parse: function(selector, context)\n    {\n        var nodes;\n        var reHtmlTest = /^\\s*<(\\w+|!)[^>]*>/;\n\n        if (!selector)\n        {\n            nodes = [];\n        }\n        else if (selector.sdom)\n        {\n            this.nodes = selector.nodes;\n            return selector;\n        }\n        else if (typeof selector !== 'string')\n        {\n            if (selector.nodeType && selector.nodeType === 11)\n            {\n                nodes = selector.childNodes;\n            }\n            else\n            {\n                nodes = (selector.nodeType || selector === window) ? [selector] : selector;\n            }\n        }\n        else if (reHtmlTest.test(selector))\n        {\n            nodes = this.create(selector);\n        }\n        else\n        {\n            nodes = this._query(selector, context);\n        }\n\n        this.nodes = this._slice(nodes);\n    },\n    create: function(html)\n    {\n        if (/^<(\\w+)\\s*\\/?>(?:<\\/\\1>|)$/.test(html))\n        {\n            return [document.createElement(RegExp.$1)];\n        }\n\n        var elements = [];\n        var container = document.createElement('div');\n        var children = container.childNodes;\n\n        container.innerHTML = html;\n\n        for (var i = 0, l = children.length; i < l; i++)\n        {\n            elements.push(children[i]);\n        }\n\n        return elements;\n    },\n\n    // add\n    add: function(nodes)\n    {\n        this.nodes = this.nodes.concat(this._toArray(nodes));\n    },\n\n    // get\n    get: function(index)\n    {\n        return this.nodes[(index || 0)] || false;\n    },\n    getAll: function()\n    {\n        return this.nodes;\n    },\n    eq: function(index)\n    {\n        return new Dom(this.nodes[index]);\n    },\n    first: function()\n    {\n        return new Dom(this.nodes[0]);\n    },\n    last: function()\n    {\n        return new Dom(this.nodes[this.nodes.length - 1]);\n    },\n    contents: function()\n    {\n        return this.get().childNodes;\n    },\n\n    // loop\n    each: function(callback)\n    {\n        var len = this.nodes.length;\n        for (var i = 0; i < len; i++)\n        {\n            callback.call(this, (this.nodes[i].sdom) ? this.nodes[i].get() : this.nodes[i], i);\n        }\n\n        return this;\n    },\n\n    // traversing\n    is: function(selector)\n    {\n        return (this.filter(selector).length > 0);\n    },\n    filter: function (selector)\n    {\n        var callback;\n        if (selector === undefined)\n        {\n            return this;\n        }\n        else if (typeof selector === 'function')\n        {\n            callback = selector;\n        }\n        else\n        {\n            callback = function(node)\n            {\n                if (selector instanceof Node)\n                {\n                    return (selector === node);\n                }\n                else if (selector && selector.sdom)\n                {\n                    return ((selector.nodes).indexOf(node) !== -1);\n                }\n                else\n                {\n                    node.matches = node.matches || node.msMatchesSelector || node.webkitMatchesSelector;\n                    return (node.nodeType === 1) ? node.matches(selector || '*') : false;\n                }\n            };\n        }\n\n        return new Dom(this.nodes.filter(callback));\n    },\n    not: function(filter)\n    {\n        return this.filter(function(node)\n        {\n            return !new Dom(node).is(filter || true);\n        });\n    },\n    find: function(selector)\n    {\n        var nodes = [];\n        this.each(function(node)\n        {\n            var ns = this._query(selector || '*', node);\n            for (var i = 0; i < ns.length; i++)\n            {\n                nodes.push(ns[i]);\n            }\n        });\n\n        return new Dom(nodes);\n    },\n    children: function(selector)\n    {\n        var nodes = [];\n        this.each(function(node)\n        {\n            if (node.children)\n            {\n                var ns = node.children;\n                for (var i = 0; i < ns.length; i++)\n                {\n                    nodes.push(ns[i]);\n                }\n            }\n        });\n\n        return new Dom(nodes).filter(selector);\n    },\n    parent: function(selector)\n    {\n        var nodes = [];\n        this.each(function(node)\n        {\n            if (node.parentNode) nodes.push(node.parentNode);\n        });\n\n        return new Dom(nodes).filter(selector);\n    },\n    parents: function(selector, context)\n    {\n        context = this._getContext(context);\n\n        var nodes = [];\n        this.each(function(node) {\n            var parent = node.parentNode;\n            while (parent && parent !== context) {\n                if (selector) {\n                    if (new Dom(parent).is(selector)) { nodes.push(parent); }\n                }\n                else {\n                    nodes.push(parent);\n                }\n                parent = parent.parentNode;\n            }\n        });\n\n        return new Dom(nodes);\n\n    },\n    closest: function(selector, context)\n    {\n        context = this._getContext(context);\n        selector = (selector.sdom) ? selector.get() : selector;\n\n        var nodes = [];\n        var isNode = (selector && selector.nodeType);\n        this.each(function(node)\n        {\n            do {\n                if ((isNode && node === selector) || new Dom(node).is(selector)) return nodes.push(node);\n            } while ((node = node.parentNode) && node !== context);\n        });\n\n        return new Dom(nodes);\n    },\n    next: function(selector)\n    {\n         return this._getSibling(selector, 'nextSibling');\n    },\n    nextElement: function(selector)\n    {\n        return this._getSibling(selector, 'nextElementSibling');\n    },\n    prev: function(selector)\n    {\n        return this._getSibling(selector, 'previousSibling');\n    },\n    prevElement: function(selector)\n    {\n        return this._getSibling(selector, 'previousElementSibling');\n    },\n\n    // css\n    css: function(name, value)\n    {\n        if (value === undefined && (typeof name !== 'object'))\n        {\n            var node = this.get();\n            if (name === 'width' || name === 'height')\n            {\n                return (node.style) ? this._getHeightOrWidth(name, node, false) + 'px' : undefined;\n            }\n            else\n            {\n                return (node.style) ? getComputedStyle(node, null)[name] : undefined;\n            }\n        }\n\n        // set\n        return this.each(function(node)\n        {\n            var obj = {};\n            if (typeof name === 'object') obj = name;\n            else obj[name] = value;\n\n            for (var key in obj)\n            {\n                if (node.style) node.style[key] = obj[key];\n            }\n        });\n    },\n\n    // attr\n    attr: function(name, value, data)\n    {\n        data = (data) ? 'data-' : '';\n\n        if (value === undefined && (typeof name !== 'object'))\n        {\n            var node = this.get();\n            if (node && node.nodeType !== 3)\n            {\n                return (name === 'checked') ? node.checked : this._getBooleanFromStr(node.getAttribute(data + name));\n            }\n            else return;\n        }\n\n        // set\n        return this.each(function(node)\n        {\n            var obj = {};\n            if (typeof name === 'object') obj = name;\n            else obj[name] = value;\n\n            for (var key in obj)\n            {\n                if (node.nodeType !== 3)\n                {\n                    if (key === 'checked') node.checked = obj[key];\n                    else node.setAttribute(data + key, obj[key]);\n                }\n            }\n        });\n    },\n    data: function(name, value)\n    {\n        if (name === undefined)\n        {\n            var reDataAttr = /^data\\-(.+)$/;\n            var attrs = this.get().attributes;\n\n            var data = {};\n            var replacer = function (g) { return g[1].toUpperCase(); };\n\n            for (var key in attrs)\n            {\n                if (attrs[key] && reDataAttr.test(attrs[key].nodeName))\n                {\n                    var dataName = attrs[key].nodeName.match(reDataAttr)[1];\n                    var val = attrs[key].value;\n                    dataName = dataName.replace(/-([a-z])/g, replacer);\n\n                    if (this._isObjectString(val)) val = this._toObject(val);\n                    else val = (this._isNumber(val)) ? parseFloat(val) : this._getBooleanFromStr(val);\n\n                    data[dataName] = val;\n                }\n            }\n\n            return data;\n        }\n\n        return this.attr(name, value, true);\n    },\n    val: function(value)\n    {\n        if (value === undefined)\n        {\n            var el = this.get();\n            if (el.type && el.type === 'checkbox') return el.checked;\n            else return el.value;\n        }\n\n        return this.each(function(node)\n        {\n            node.value = value;\n        });\n    },\n    removeAttr: function(value)\n    {\n        return this.each(function(node)\n        {\n            var rmAttr = function(name) { if (node.nodeType !== 3) node.removeAttribute(name); };\n            value.split(' ').forEach(rmAttr);\n        });\n    },\n    removeData: function(value)\n    {\n        return this.each(function(node)\n        {\n            var rmData = function(name) { if (node.nodeType !== 3) node.removeAttribute('data-' + name); };\n            value.split(' ').forEach(rmData);\n        });\n    },\n\n    // dataset/dataget\n    dataset: function(key, value)\n    {\n        return this.each(function(node)\n        {\n            DomCache[this.dataindex(node)][key] = value;\n        });\n    },\n    dataget: function(key)\n    {\n        return DomCache[this.dataindex(this.get())][key];\n    },\n    dataindex: function(el)\n    {\n        var cacheIndex = el[DomExpando];\n        var nextCacheIndex = DomCache.length;\n\n        if (!cacheIndex)\n        {\n            cacheIndex = el[DomExpando] = nextCacheIndex;\n            DomCache[cacheIndex] = {};\n        }\n\n        return cacheIndex;\n    },\n\n\n    // class\n    addClass: function(value)\n    {\n        return this._eachClass(value, 'add');\n    },\n    removeClass: function(value)\n    {\n        return this._eachClass(value, 'remove');\n    },\n    toggleClass: function(value)\n    {\n        return this._eachClass(value, 'toggle');\n    },\n    hasClass: function(value)\n    {\n        return this.nodes.some(function(node)\n        {\n            return (node.classList) ? node.classList.contains(value) : false;\n        });\n    },\n\n    // html & text\n    empty: function()\n    {\n        return this.each(function(node)\n        {\n            node.innerHTML = '';\n        });\n    },\n    html: function(html)\n    {\n        return (html === undefined) ? (this.get().innerHTML || '') : this.empty().append(html);\n    },\n    text: function(text)\n    {\n        return (text === undefined) ? (this.get().textContent || '') : this.each(function(node) { node.textContent = text; });\n    },\n\n    // manipulation\n    after: function(html)\n    {\n        return this._inject(html, function(frag, node)\n        {\n            if (typeof frag === 'string')\n            {\n                node.insertAdjacentHTML('afterend', frag);\n            }\n            else\n            {\n                if (node.parentNode !== null) {\n                    for (var i = frag instanceof Node ? [frag] : this._toArray(frag).reverse(), s = 0; s < i.length; s++) {\n                        node.parentNode.insertBefore(i[s], node.nextSibling);\n                    }\n                }\n            }\n\n            return node;\n\n        });\n    },\n    before: function(html)\n    {\n        return this._inject(html, function(frag, node)\n        {\n            if (typeof frag === 'string')\n            {\n                node.insertAdjacentHTML('beforebegin', frag);\n            }\n            else\n            {\n                var elms = (frag instanceof Node) ? [frag] : this._toArray(frag);\n                for (var i = 0; i < elms.length; i++)\n                {\n                    node.parentNode.insertBefore(elms[i], node);\n                }\n            }\n\n            return node;\n        });\n    },\n    append: function(html)\n    {\n        return this._inject(html, function(frag, node)\n        {\n            if (typeof frag === 'string' || typeof frag === 'number')\n            {\n                node.insertAdjacentHTML('beforeend', frag);\n            }\n            else\n            {\n                var elms = (frag instanceof Node) ? [frag] : this._toArray(frag);\n                for (var i = 0; i < elms.length; i++)\n                {\n                    node.appendChild(elms[i]);\n                }\n            }\n\n            return node;\n        });\n    },\n    prepend: function(html)\n    {\n        return this._inject(html, function(frag, node)\n        {\n            if (typeof frag === 'string' || typeof frag === 'number')\n            {\n                node.insertAdjacentHTML('afterbegin', frag);\n            }\n            else\n            {\n                var elms = (frag instanceof Node) ? [frag] : this._toArray(frag).reverse();\n                for (var i = 0; i < elms.length; i++)\n                {\n                    node.insertBefore(elms[i], node.firstChild);\n                }\n            }\n\n            return node;\n        });\n    },\n    wrap: function(html)\n    {\n        return this._inject(html, function(frag, node)\n        {\n            var wrapper = (typeof frag === 'string' || typeof frag === 'number') ? this.create(frag)[0] : (frag instanceof Node) ? frag : this._toArray(frag)[0];\n\n            if (node.parentNode)\n            {\n                node.parentNode.insertBefore(wrapper, node);\n            }\n\n            wrapper.appendChild(node);\n\n            return new Dom(wrapper);\n\n        });\n    },\n    unwrap: function()\n    {\n        return this.each(function(node)\n        {\n            var $node = new Dom(node);\n\n            return $node.replaceWith($node.contents());\n        });\n    },\n    replaceWith: function(html)\n    {\n        return this._inject(html, function(frag, node)\n        {\n            var docFrag = document.createDocumentFragment();\n            var elms = (typeof frag === 'string' || typeof frag === 'number') ? this.create(frag) : (frag instanceof Node) ? [frag] : this._toArray(frag);\n\n            for (var i = 0; i < elms.length; i++)\n            {\n                docFrag.appendChild(elms[i]);\n            }\n\n            var result = docFrag.childNodes[0];\n            if (node.parentNode) {\n                node.parentNode.replaceChild(docFrag, node);\n            }\n\n            return result;\n\n        });\n    },\n    remove: function()\n    {\n        return this.each(function(node)\n        {\n            if (node.parentNode) node.parentNode.removeChild(node);\n        });\n    },\n    clone: function(events)\n    {\n        var nodes = [];\n        this.each(function(node)\n        {\n            var copy = this._clone(node);\n            if (events) copy = this._cloneEvents(node, copy);\n            nodes.push(copy);\n        });\n\n        return new Dom(nodes);\n    },\n\n    // show/hide\n    show: function()\n    {\n        return this.each(function(node)\n        {\n            if (!node.style || !this._hasDisplayNone(node)) return;\n\n            var target = node.getAttribute('domTargetShow');\n            var isHidden = (node.classList) ? node.classList.contains(DomHClass) : false;\n            var isHiddenMobile = (node.classList) ? node.classList.contains(DomHMClass) : false;\n            var type;\n\n            if (isHidden)\n            {\n                type = DomHClass;\n                node.classList.remove(DomHClass);\n            }\n            else if (isHiddenMobile)\n            {\n                type = DomHMClass;\n                node.classList.remove(DomHMClass);\n            }\n            else\n            {\n                node.style.display = (target) ? target : 'block';\n            }\n\n            if (type) node.setAttribute('domTargetHide', type);\n            node.removeAttribute('domTargetShow');\n\n        }.bind(this));\n    },\n    hide: function()\n    {\n        return this.each(function(node)\n        {\n            if (!node.style || this._hasDisplayNone(node)) return;\n\n            var display = node.style.display;\n            var target = node.getAttribute('domTargetHide');\n\n            if (target === DomHClass)\n            {\n                node.classList.add(DomHClass);\n            }\n            else if (target === DomHMClass)\n            {\n                node.classList.add(DomHMClass);\n            }\n            else\n            {\n                if (display !== 'block') node.setAttribute('domTargetShow', display);\n                node.style.display = 'none';\n            }\n\n            node.removeAttribute('domTargetHide');\n\n        });\n    },\n\n    // dimensions\n    scrollTop: function(value)\n    {\n        var node = this.get();\n        var isWindow = (node === window);\n        var isDocument = (node.nodeType === 9);\n        var el = (isDocument) ? (document.scrollingElement || document.body.parentNode || document.body || document.documentElement) : node;\n\n        if (value !== undefined)\n        {\n            if (isWindow) window.scrollTo(0, value);\n            else el.scrollTop = value;\n            return;\n        }\n\n        if (isDocument)\n        {\n            return (typeof window.pageYOffset != 'undefined') ? window.pageYOffset : ((document.documentElement.scrollTop) ? document.documentElement.scrollTop : ((document.body.scrollTop) ? document.body.scrollTop : 0));\n        }\n        else\n        {\n            return (isWindow) ? window.pageYOffset : el.scrollTop;\n        }\n    },\n    offset: function()\n    {\n        return this._getDim('Offset');\n    },\n    position: function()\n    {\n        return this._getDim('Position');\n    },\n    width: function(value, adjust)\n    {\n        return this._getSize('width', 'Width', value, adjust);\n    },\n    height: function(value, adjust)\n    {\n        return this._getSize('height', 'Height', value, adjust);\n    },\n    outerWidth: function()\n    {\n        return this._getInnerOrOuter('width', 'outer');\n    },\n    outerHeight: function()\n    {\n        return this._getInnerOrOuter('height', 'outer');\n    },\n    innerWidth: function()\n    {\n        return this._getInnerOrOuter('width', 'inner');\n    },\n    innerHeight: function()\n    {\n        return this._getInnerOrOuter('height', 'inner');\n    },\n\n    // events\n    click: function()\n    {\n        return this._triggerEvent('click');\n    },\n    focus: function()\n    {\n        return this._triggerEvent('focus');\n    },\n    trigger: function(names)\n    {\n        return this.each(function(node)\n        {\n            var events = names.split(' ');\n            for (var i = 0; i < events.length; i++)\n            {\n                var ev;\n                var opts = { bubbles: true, cancelable: true };\n\n                try {\n                    ev = new window.CustomEvent(events[i], opts);\n                } catch(e) {\n                    ev = document.createEvent('CustomEvent');\n                    ev.initCustomEvent(events[i], true, true);\n                }\n\n                node.dispatchEvent(ev);\n            }\n        });\n    },\n    on: function(names, handler, one)\n    {\n        return this.each(function(node)\n        {\n            var events = names.split(' ');\n            for (var i = 0; i < events.length; i++)\n            {\n                var event = this._getEventName(events[i]);\n                var namespace = this._getEventNamespace(events[i]);\n\n                handler = (one) ? this._getOneHandler(handler, names) : handler;\n                node.addEventListener(event, handler);\n\n                node._e = node._e || {};\n                node._e[namespace] = node._e[namespace] || {};\n                node._e[namespace][event] = node._e[namespace][event] || [];\n                node._e[namespace][event].push(handler);\n            }\n\n        });\n    },\n    one: function(events, handler)\n    {\n        return this.on(events, handler, true);\n    },\n    off: function(names, handler)\n    {\n        var testEvent = function(name, key, event) { return (name === event); };\n        var testNamespace = function(name, key, event, namespace) { return (key === namespace); };\n        var testEventNamespace = function(name, key, event, namespace) { return (name === event && key === namespace); };\n        var testPositive = function() { return true; };\n\n        if (names === undefined)\n        {\n            // ALL\n            return this.each(function(node)\n            {\n                this._offEvent(node, false, false, handler, testPositive);\n            });\n        }\n\n        return this.each(function(node)\n        {\n            var events = names.split(' ');\n\n            for (var i = 0; i < events.length; i++)\n            {\n                var event = this._getEventName(events[i]);\n                var namespace = this._getEventNamespace(events[i]);\n\n                // 1) event without namespace\n                if (namespace === '_events') this._offEvent(node, event, namespace, handler, testEvent);\n                // 2) only namespace\n                else if (!event && namespace !== '_events') this._offEvent(node, event, namespace, handler, testNamespace);\n                // 3) event + namespace\n                else this._offEvent(node, event, namespace, handler, testEventNamespace);\n            }\n        });\n    },\n\n    // form\n    serialize: function(asObject)\n    {\n        var obj = {};\n        var elms = this.get().elements;\n        for (var i = 0; i < elms.length; i++)\n        {\n            var el = elms[i];\n            if (/(checkbox|radio)/.test(el.type) && !el.checked) continue;\n            if (!el.name || el.disabled || el.type === 'file') continue;\n\n            if (el.type === 'select-multiple')\n            {\n                for (var z = 0; z < el.options.length; z++)\n                {\n                    var opt = el.options[z];\n                    if (opt.selected) obj[el.name] = opt.value;\n                }\n            }\n\n            obj[el.name] = (this._isNumber(el.value)) ? parseFloat(el.value) : this._getBooleanFromStr(el.value);\n        }\n\n        return (asObject) ? obj : this._toParams(obj);\n    },\n    ajax: function(success, error)\n    {\n        if (typeof AjaxRequest !== 'undefined')\n        {\n            var method = this.attr('method') || 'post';\n            var options = {\n                url: this.attr('action'),\n                data: this.serialize(),\n                success: success,\n                error: error\n            };\n\n            return new AjaxRequest(method, options);\n        }\n    },\n\n    // private\n    _queryContext: function(selector, context)\n    {\n        context = this._getContext(context);\n\n        return (context.nodeType !== 3 && typeof context.querySelectorAll === 'function') ? context.querySelectorAll(selector) : [];\n    },\n    _query: function(selector, context)\n    {\n        if (context)\n        {\n            return this._queryContext(selector, context);\n        }\n        else if (/^[.#]?[\\w-]*$/.test(selector))\n        {\n            if (selector[0] === '#')\n            {\n                var element = document.getElementById(selector.slice(1));\n                return element ? [element] : [];\n            }\n\n            if (selector[0] === '.')\n            {\n                return document.getElementsByClassName(selector.slice(1));\n            }\n\n            return document.getElementsByTagName(selector);\n        }\n\n        return document.querySelectorAll(selector);\n    },\n    _getContext: function(context)\n    {\n        context = (typeof context === 'string') ? document.querySelector(context) : context;\n\n        return (context && context.sdom) ? context.get() : (context || document);\n    },\n    _inject: function(html, fn)\n    {\n        var len = this.nodes.length;\n        var nodes = [];\n        while (len--)\n        {\n            var res = (typeof html === 'function') ? html.call(this, this.nodes[len]) : html;\n            var el = (len === 0) ? res : this._clone(res);\n            var node = fn.call(this, el, this.nodes[len]);\n\n            if (node)\n            {\n                if (node.sdom) nodes.push(node.get());\n                else nodes.push(node);\n            }\n        }\n\n        return new Dom(nodes);\n    },\n    _cloneEvents: function(node, copy)\n    {\n        var events = node._e;\n        if (events)\n        {\n            copy._e = events;\n            for (var name in events._events)\n            {\n                for (var i = 0; i < events._events[name].length; i++)\n                {\n                    copy.addEventListener(name, events._events[name][i]);\n                }\n            }\n        }\n\n        return copy;\n    },\n    _clone: function(node)\n    {\n        if (typeof node === 'undefined') return;\n        if (typeof node === 'string') return node;\n        else if (node instanceof Node || node.nodeType) return node.cloneNode(true);\n        else if ('length' in node)\n        {\n            return [].map.call(this._toArray(node), function(el) { return el.cloneNode(true); });\n        }\n    },\n    _slice: function(obj)\n    {\n        return (!obj || obj.length === 0) ? [] : (obj.length) ? [].slice.call(obj.nodes || obj) : [obj];\n    },\n    _eachClass: function(value, type)\n    {\n        return this.each(function(node)\n        {\n            if (value)\n            {\n                var setClass = function(name) { if (node.classList) node.classList[type](name); };\n                value.split(' ').forEach(setClass);\n            }\n        });\n    },\n    _triggerEvent: function(name)\n    {\n        var node = this.get();\n        if (node && node.nodeType !== 3) node[name]();\n        return this;\n    },\n    _getOneHandler: function(handler, events)\n    {\n        var self = this;\n        return function()\n        {\n            handler.apply(this, arguments);\n            self.off(events);\n        };\n    },\n    _getEventNamespace: function(event)\n    {\n        var arr = event.split('.');\n        var namespace = (arr[1]) ? arr[1] : '_events';\n        return (arr[2]) ? namespace + arr[2] : namespace;\n    },\n    _getEventName: function(event)\n    {\n        return event.split('.')[0];\n    },\n    _offEvent: function(node, event, namespace, handler, condition)\n    {\n        for (var key in node._e)\n        {\n            for (var name in node._e[key])\n            {\n                if (condition(name, key, event, namespace))\n                {\n                    var handlers = node._e[key][name];\n                    for (var i = 0; i < handlers.length; i++)\n                    {\n                        if (typeof handler !== 'undefined' && handlers[i].toString() !== handler.toString())\n                        {\n                            continue;\n                        }\n\n                        node.removeEventListener(name, handlers[i]);\n                        node._e[key][name].splice(i, 1);\n\n                        if (node._e[key][name].length === 0) delete node._e[key][name];\n                        if (Object.keys(node._e[key]).length === 0) delete node._e[key];\n                    }\n                }\n            }\n        }\n    },\n    _getInnerOrOuter: function(method, type)\n    {\n        return this[method](undefined, type);\n    },\n    _getDocSize: function(node, type)\n    {\n        var body = node.body, html = node.documentElement;\n        return Math.max(body['scroll' + type], body['offset' + type], html['client' + type], html['scroll' + type], html['offset' + type]);\n    },\n    _getSize: function(type, captype, value, adjust)\n    {\n        if (value === undefined)\n        {\n            var el = this.get();\n            if (el.nodeType === 3)      value = 0;\n            else if (el.nodeType === 9) value = this._getDocSize(el, captype);\n            else if (el === window)     value = window['inner' + captype];\n            else                        value = this._getHeightOrWidth(type, el, adjust || 'normal');\n\n            return Math.round(value);\n        }\n\n        return this.each(function(node)\n        {\n            value = parseFloat(value);\n            value = value + this._adjustResultHeightOrWidth(type, node, adjust || 'normal');\n\n            new Dom(node).css(type, value + 'px');\n\n        }.bind(this));\n    },\n    _getHeightOrWidth: function(type, el, adjust)\n    {\n        if (!el) return 0;\n\n        var name = type.charAt(0).toUpperCase() + type.slice(1);\n        var result = 0;\n        var style = getComputedStyle(el, null);\n        var $el = new Dom(el);\n        var $targets = $el.parents().filter(function(node)\n        {\n            return (node.nodeType === 1 && getComputedStyle(node, null).display === 'none') ? node : false;\n        });\n\n        if (style.display === 'none') $targets.add(el);\n        if ($targets.length !== 0)\n        {\n            var fixStyle = 'visibility: hidden !important; display: block !important;';\n            var tmp = [];\n\n            $targets.each(function(node)\n            {\n                var $node = new Dom(node);\n                var thisStyle = $node.attr('style');\n                if (thisStyle !== null) tmp.push(thisStyle);\n                $node.attr('style', (thisStyle !== null) ? thisStyle + ';' + fixStyle : fixStyle);\n            });\n\n            result = $el.get()['offset' + name] - this._adjustResultHeightOrWidth(type, el, adjust);\n\n            $targets.each(function(node, i)\n            {\n                var $node = new Dom(node);\n                if (tmp[i] === undefined) $node.removeAttr('style');\n                else $node.attr('style', tmp[i]);\n            });\n        }\n        else\n        {\n            result = el['offset' + name] - this._adjustResultHeightOrWidth(type, el, adjust);\n        }\n\n        return result;\n    },\n    _adjustResultHeightOrWidth: function(type, el, adjust)\n    {\n        if (!el || adjust === false) return 0;\n\n        var fix = 0;\n        var style = getComputedStyle(el, null);\n        var isBorderBox = (style.boxSizing === \"border-box\");\n\n        if (type === 'height')\n        {\n            if (adjust === 'inner' || (adjust === 'normal' && isBorderBox))\n            {\n                fix += (parseFloat(style.borderTopWidth) || 0) + (parseFloat(style.borderBottomWidth) || 0);\n            }\n\n            if (adjust === 'outer') fix -= (parseFloat(style.marginTop) || 0) + (parseFloat(style.marginBottom) || 0);\n        }\n        else\n        {\n            if (adjust === 'inner' || (adjust === 'normal' && isBorderBox))\n            {\n                fix += (parseFloat(style.borderLeftWidth) || 0) + (parseFloat(style.borderRightWidth) || 0);\n            }\n\n            if (adjust === 'outer') fix -= (parseFloat(style.marginLeft) || 0) + (parseFloat(style.marginRight) || 0);\n        }\n\n        return fix;\n    },\n    _getDim: function(type)\n    {\n        var node = this.get();\n        return (node.nodeType === 3) ? { top: 0, left: 0 } : this['_get' + type](node);\n    },\n    _getPosition: function(node)\n    {\n        return { top: node.offsetTop, left: node.offsetLeft };\n    },\n    _getOffset: function(node)\n    {\n        var rect = node.getBoundingClientRect();\n        var doc = node.ownerDocument;\n\t\tvar docElem = doc.documentElement;\n\t\tvar win = doc.defaultView;\n\n\t\treturn {\n\t\t\ttop: rect.top + win.pageYOffset - docElem.clientTop,\n\t\t\tleft: rect.left + win.pageXOffset - docElem.clientLeft\n\t\t};\n    },\n    _getSibling: function(selector, method)\n    {\n        selector = (selector && selector.sdom) ? selector.get() : selector;\n\n        var isNode = (selector && selector.nodeType);\n        var sibling;\n\n        this.each(function(node)\n        {\n            while (node = node[method])\n            {\n                if ((isNode && node === selector) || new Dom(node).is(selector))\n                {\n                    sibling = node;\n                    return;\n                }\n            }\n        });\n\n        return new Dom(sibling);\n    },\n    _toArray: function(obj)\n    {\n        if (obj instanceof NodeList)\n        {\n            var arr = [];\n            for (var i = 0; i < obj.length; i++)\n            {\n                arr[i] = obj[i];\n            }\n\n            return arr;\n        }\n        else if (obj === undefined) return [];\n        else\n        {\n            return (obj.sdom) ? obj.nodes : obj;\n        }\n    },\n    _toParams: function(obj)\n    {\n        var params = '';\n        for (var key in obj)\n        {\n            params += '&' + this._encodeUri(key) + '=' + this._encodeUri(obj[key]);\n        }\n\n        return params.replace(/^&/, '');\n    },\n    _toObject: function(str)\n    {\n        return (new Function(\"return \" + str))();\n    },\n    _encodeUri: function(str)\n    {\n        return encodeURIComponent(str).replace(/!/g, '%21').replace(/'/g, '%27').replace(/\\(/g, '%28').replace(/\\)/g, '%29').replace(/\\*/g, '%2A').replace(/%20/g, '+');\n    },\n    _isNumber: function(str)\n    {\n        return !isNaN(str) && !isNaN(parseFloat(str));\n    },\n    _isObjectString: function(str)\n    {\n        return (str.search(/^{/) !== -1);\n    },\n    _getBooleanFromStr: function(str)\n    {\n        if (str === 'true') return true;\n        else if (str === 'false') return false;\n\n        return str;\n    },\n    _hasDisplayNone: function(el)\n    {\n        return (el.style.display === 'none') || ((el.currentStyle) ? el.currentStyle.display : getComputedStyle(el, null).display) === 'none';\n    }\n};\n// Unique ID\nvar uuid = 0;\n\n// Wrapper\nvar $R = function(selector, options)\n{\n    return RedactorApp(selector, options, [].slice.call(arguments, 2));\n};\n\n// Globals\n$R.app = [];\n$R.version = '3.4.3';\n$R.options = {};\n$R.modules = {};\n$R.services = {};\n$R.classes = {};\n$R.plugins = {};\n$R.mixins = {};\n$R.modals = {};\n$R.lang = {};\n$R.dom = function(selector, context) { return new Dom(selector, context); };\n$R.ajax = Ajax;\n$R.Dom = Dom;\n$R.keycodes = {\n\tBACKSPACE: 8,\n\tDELETE: 46,\n\tUP: 38,\n\tDOWN: 40,\n\tENTER: 13,\n\tSPACE: 32,\n\tESC: 27,\n\tTAB: 9,\n\tCTRL: 17,\n\tMETA: 91,\n\tSHIFT: 16,\n\tALT: 18,\n\tRIGHT: 39,\n\tLEFT: 37\n};\n$R.env = {\n    'plugin': 'plugins',\n    'module': 'modules',\n    'service': 'services',\n    'class': 'classes',\n    'mixin': 'mixins'\n};\n\n// jQuery Wrapper\n/*eslint-env jquery*/\nif (typeof jQuery !== 'undefined')\n{\n    (function($) { $.fn.redactor = function(options) { return RedactorApp(this.toArray(), options, [].slice.call(arguments, 1)); }; })(jQuery);\n}\n\n// Class\nvar RedactorApp = function(selector, options, args)\n{\n    var namespace = 'redactor';\n    var nodes = (Array.isArray(selector)) ? selector : (selector && selector.nodeType) ? [selector] : document.querySelectorAll(selector);\n    var isApi = (typeof options === 'string' || typeof options === 'function');\n    var value = [];\n    var instance;\n\n    for (var i = 0; i < nodes.length; i++)\n    {\n        var el = nodes[i];\n        var $el = $R.dom(el);\n\n        instance = $el.dataget(namespace);\n        if (!instance && !isApi)\n        {\n            // Initialization\n            instance = new App(el, options, uuid);\n            $el.dataset(namespace, instance);\n            $R.app[uuid] = instance;\n            uuid++;\n        }\n\n        // API\n        if (instance && isApi)\n        {\n            var isDestroy = (options === 'destroy');\n            options = (isDestroy) ? 'stop' : options;\n\n            var methodValue;\n            if (typeof options === 'function')\n            {\n                methodValue = options.apply(instance, args);\n            }\n            else\n            {\n                args.unshift(options);\n                methodValue = instance.api.apply(instance, args);\n            }\n            if (methodValue !== undefined) value.push(methodValue);\n\n            if (isDestroy) $el.dataset(namespace, false);\n        }\n    }\n\n    return (value.length === 0 || value.length === 1) ? ((value.length === 0) ? instance : value[0]) : value;\n};\n\n// add\n$R.add = function(type, name, obj)\n{\n    if (typeof $R.env[type] === 'undefined') return;\n\n    // translations\n    if (obj.translations)\n    {\n        $R.lang = $R.extend(true, {}, $R.lang, obj.translations);\n    }\n\n    // modals\n    if (obj.modals)\n    {\n        $R.modals = $R.extend(true, {}, $R.modals, obj.modals);\n    }\n\n    // mixin\n    if (type === 'mixin')\n    {\n        $R[$R.env[type]][name] = obj;\n    }\n    else\n    {\n        // prototype\n        var F = function() {};\n        F.prototype = obj;\n\n        // mixins\n        if (obj.mixins)\n        {\n            for (var i = 0; i < obj.mixins.length; i++)\n            {\n                $R.inherit(F, $R.mixins[obj.mixins[i]]);\n            }\n        }\n\n        $R[$R.env[type]][name] = F;\n    }\n};\n\n// add lang\n$R.addLang = function(lang, obj)\n{\n    if (typeof $R.lang[lang] === 'undefined')\n    {\n        $R.lang[lang] = {};\n    }\n\n    $R.lang[lang] = $R.extend($R.lang[lang], obj);\n};\n\n// create\n$R.create = function(name)\n{\n    var arr = name.split('.');\n    var args = [].slice.call(arguments, 1);\n\n    var type = 'classes';\n    if (typeof $R.env[arr[0]] !== 'undefined')\n    {\n        type = $R.env[arr[0]];\n        name = arr.slice(1).join('.');\n    }\n\n    // construct\n    var instance = new $R[type][name]();\n\n    // init\n    if (instance.init)\n    {\n        var res = instance.init.apply(instance, args);\n\n        return (res) ? res : instance;\n    }\n\n    return instance;\n};\n\n// inherit\n$R.inherit = function(current, parent)\n{\n    var F = function () {};\n    F.prototype = parent;\n    var f = new F();\n\n    for (var prop in current.prototype)\n    {\n        if (current.prototype.__lookupGetter__(prop)) f.__defineGetter__(prop, current.prototype.__lookupGetter__(prop));\n        else f[prop] = current.prototype[prop];\n    }\n\n    current.prototype = f;\n    current.prototype.super = parent;\n\n    return current;\n};\n\n// error\n$R.error = function(exception)\n{\n    throw exception;\n};\n\n// extend\n$R.extend = function()\n{\n    var extended = {};\n    var deep = false;\n    var i = 0;\n    var length = arguments.length;\n\n    if (Object.prototype.toString.call( arguments[0] ) === '[object Boolean]')\n    {\n        deep = arguments[0];\n        i++;\n    }\n\n    var merge = function(obj)\n    {\n        for (var prop in obj)\n        {\n            if (Object.prototype.hasOwnProperty.call(obj, prop))\n            {\n                if (deep && Object.prototype.toString.call(obj[prop]) === '[object Object]') extended[prop] = $R.extend(true, extended[prop], obj[prop]);\n                else extended[prop] = obj[prop];\n            }\n        }\n    };\n\n    for (; i < length; i++ )\n    {\n        var obj = arguments[i];\n        merge(obj);\n    }\n\n    return extended;\n};\n$R.opts = {\n    animation: true,\n    lang: 'en',\n    direction: 'ltr',\n    spellcheck: true,\n    structure: false,\n    scrollTarget: false,\n    styles: true,\n    stylesClass: 'redactor-styles',\n    placeholder: false,\n\n    source: true,\n    showSource: false,\n\n    inline: false,\n\n    breakline: false,\n    markup: 'p',\n    enterKey: true,\n\n    clickToEdit: false,\n    clickToSave: false,\n    clickToCancel: false,\n\n    focus: false,\n    focusEnd: false,\n\n    minHeight: false, // string, '100px'\n    maxHeight: false, // string, '100px'\n    maxWidth: false, // string, '700px'\n\n    plugins: [], // array\n    callbacks: {},\n\n    // pre & tab\n    preClass: false, // string\n    preSpaces: 4, // or false\n    tabindex: false, // int\n    tabAsSpaces: false, // true or number of spaces\n    tabKey: true,\n\n    // autosave\n    autosave: false, // false or url\n    autosaveName: false,\n    autosaveData: false,\n\n    // toolbar\n    toolbar: true,\n    toolbarFixed: true,\n    toolbarFixedTarget: document,\n    toolbarFixedTopOffset: 0, // pixels\n    toolbarExternal: false, // ID selector\n    toolbarContext: true,\n\n    // air\n    air: false,\n\n    // formatting\n    formatting: ['p', 'blockquote', 'pre', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6'],\n    formattingAdd: false,\n    formattingHide: false,\n\n    // buttons\n    buttons: ['html', 'format', 'bold', 'italic', 'deleted', 'lists', 'image', 'file', 'link'],\n    // + 'line', 'redo', 'undo', 'underline', 'ol', 'ul', 'indent', 'outdent'\n    buttonsTextLabeled: false,\n    buttonsAdd: [],\n    buttonsAddFirst: [],\n    buttonsAddAfter: false,\n    buttonsAddBefore: false,\n    buttonsHide: [],\n    buttonsHideOnMobile: [],\n\n    // image\n    imageUpload: false,\n    imageUploadParam: 'file',\n    imageData: false,\n    imageEditable: true,\n    imageCaption: true,\n    imageLink: true,\n    imagePosition: false,\n    imageResizable: false,\n    imageFloatMargin: '10px',\n    imageFigure: true,\n    imageObserve: true,\n\n    // file\n    fileUpload: false,\n    fileUploadParam: 'file',\n    fileData: false,\n    fileAttachment: false,\n\n    // upload opts\n    uploadData: false,\n    dragUpload: true,\n    multipleUpload: true,\n    clipboardUpload: true,\n    uploadBase64: false,\n\n    // link\n    linkTarget: false,\n    linkTitle: false,\n    linkNewTab: true,\n    linkNofollow: false,\n    linkSize: 30,\n    linkValidation: true,\n\n    // clean\n    cleanOnEnter: true,\n    cleanInlineOnEnter: false,\n    paragraphize: true,\n    removeScript: true,\n    removeNewLines: false,\n    removeComments: true,\n    replaceTags: {\n        'b': 'strong',\n        'i': 'em',\n        'strike': 'del'\n    },\n\n    // paste\n    pastePlainText: false,\n    pasteLinkTarget: false,\n    pasteImages: true,\n    pasteLinks: true,\n    pasteClean: true,\n    pasteKeepStyle: [],\n    pasteKeepClass: [],\n    pasteKeepAttrs: ['td', 'th'],\n    pasteBlockTags: ['pre', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'table', 'tbody', 'thead', 'tfoot', 'th', 'tr', 'td', 'ul', 'ol', 'li', 'blockquote', 'p', 'figure', 'figcaption'],\n    pasteInlineTags: ['a', 'img', 'br', 'strong', 'ins', 'code', 'del', 'span', 'samp', 'kbd', 'sup', 'sub', 'mark', 'var', 'cite', 'small', 'b', 'u', 'em', 'i', 'abbr'],\n\n    // active buttons\n    activeButtons: {\n        b: 'bold',\n        strong: 'bold',\n        i: 'italic',\n        em: 'italic',\n        del: 'deleted',\n        strike: 'deleted',\n        u: 'underline'\n    },\n    activeButtonsAdd: {},\n    activeButtonsObservers: {},\n\n    // autoparser\n    autoparse: true,\n    autoparseStart: true,\n    autoparsePaste: true,\n    autoparseLinks: true,\n    autoparseImages: true,\n    autoparseVideo: true,\n\n    // shortcodes\n    shortcodes: {\n        'p.': { format: 'p' },\n        'quote.': { format: 'blockquote' },\n        'pre.': { format: 'pre' },\n        'h1.': { format: 'h1' },\n        'h2.': { format: 'h2' },\n        'h3.': { format: 'h3' },\n        'h4.': { format: 'h4' },\n        'h5.': { format: 'h5' },\n        'h6.': { format: 'h6' },\n        //'1.': { format: 'ol' },\n        '*.': { format: 'ul' }\n    },\n    shortcodesAdd: false, // object\n\n    // shortcuts\n    shortcuts: {\n        'ctrl+shift+m, meta+shift+m': { api: 'module.inline.clearformat' },\n        'ctrl+b, meta+b': { api: 'module.inline.format', args: 'b' },\n        'ctrl+i, meta+i': { api: 'module.inline.format', args: 'i' },\n        'ctrl+u, meta+u': { api: 'module.inline.format', args: 'u' },\n        'ctrl+h, meta+h': { api: 'module.inline.format', args: 'sup' },\n        'ctrl+l, meta+l': { api: 'module.inline.format', args: 'sub' },\n        'ctrl+k, meta+k': { api: 'module.link.open' },\n        'ctrl+alt+0, meta+alt+0': { api: 'module.block.format', args: 'p' },\n        'ctrl+alt+1, meta+alt+1': { api: 'module.block.format', args: 'h1' },\n        'ctrl+alt+2, meta+alt+2': { api: 'module.block.format', args: 'h2' },\n        'ctrl+alt+3, meta+alt+3': { api: 'module.block.format', args: 'h3' },\n        'ctrl+alt+4, meta+alt+4': { api: 'module.block.format', args: 'h4' },\n        'ctrl+alt+5, meta+alt+5': { api: 'module.block.format', args: 'h5' },\n        'ctrl+alt+6, meta+alt+6': { api: 'module.block.format', args: 'h6' },\n        'ctrl+shift+7, meta+shift+7': { api: 'module.list.toggle', args: 'ol' },\n        'ctrl+shift+8, meta+shift+8': { api: 'module.list.toggle', args: 'ul' }\n    },\n    shortcutsAdd: false, // object\n\n    // misc\n    grammarly: true,\n    notranslate: false,\n\n    // private\n    bufferLimit: 100,\n    emptyHtml: '<p></p>',\n    markerChar: '\\ufeff',\n    imageTypes: ['image/png', 'image/jpeg', 'image/gif'],\n    imageAttrs: ['alt', 'title', 'src', 'class', 'width', 'height', 'srcset'],\n    inlineTags: ['a', 'span', 'strong', 'strike', 'b', 'u', 'em', 'i', 'code', 'del', 'ins', 'samp', 'kbd', 'sup', 'sub', 'mark', 'var', 'cite', 'small', 'abbr'],\n    blockTags: ['pre', 'ul', 'ol', 'li', 'p', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6',  'dl', 'dt', 'dd', 'div', 'table', 'tbody', 'thead', 'tfoot', 'tr', 'th', 'td', 'blockquote', 'output', 'figcaption', 'figure', 'address', 'section', 'header', 'footer', 'aside', 'article', 'iframe'],\n    regex: {\n        youtube: /https?:\\/\\/(?:[0-9A-Z-]+\\.)?(?:youtu\\.be\\/|youtube\\.com\\S*[^\\w\\-\\s])([\\w\\-]{11})(?=[^\\w\\-]|$)(?![?=&+%\\w.-]*(?:['\"][^<>]*>|<\\/a>))[?=&+%\\w.-]*/gi,\n        vimeo: /(http|https)?:\\/\\/(?:www.|player.)?vimeo.com\\/(?:channels\\/(?:\\w+\\/)?|groups\\/(?:[^\\/]*)\\/videos\\/|album\\/(?:\\d+)\\/video\\/|video\\/|)(\\d+)(?:\\/[a-zA-Z0-9_-]+)?/gi,\n        imageurl: /((https?|www)[^\\s]+\\.)(jpe?g|png|gif)(\\?[^\\s-]+)?/gi,\n        url: /https?:\\/\\/(www\\.)?[-a-zA-Z0-9@:%._\\+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b([-a-zA-Z0-9()@:%_\\+.~#?&//=]*)/gi\n    },\n    input: true,\n    zindex: false,\n    modes: {\n        \"inline\": {\n            pastePlainText: true,\n            pasteImages: false,\n            enterKey: false,\n            toolbar: false,\n            autoparse: false,\n            source: false,\n            showSource: false,\n            styles: false,\n            air: false\n        },\n        \"original\": {\n            styles: false\n        }\n    }\n};\n$R.lang['en'] = {\n    \"format\": \"Format\",\n    \"image\": \"Image\",\n    \"file\": \"File\",\n    \"link\": \"Link\",\n    \"bold\": \"Bold\",\n    \"italic\": \"Italic\",\n    \"deleted\": \"Strikethrough\",\n    \"underline\": \"Underline\",\n    \"superscript\": \"Superscript\",\n    \"subscript\": \"Subscript\",\n    \"bold-abbr\": \"B\",\n    \"italic-abbr\": \"I\",\n    \"deleted-abbr\": \"S\",\n    \"underline-abbr\": \"U\",\n    \"superscript-abbr\": \"Sup\",\n    \"subscript-abbr\": \"Sub\",\n    \"lists\": \"Lists\",\n    \"link-insert\": \"Insert Link\",\n    \"link-edit\": \"Edit Link\",\n    \"link-in-new-tab\": \"Open link in new tab\",\n    \"unlink\": \"Unlink\",\n    \"cancel\": \"Cancel\",\n    \"close\": \"Close\",\n    \"insert\": \"Insert\",\n    \"save\": \"Save\",\n    \"delete\": \"Delete\",\n    \"text\": \"Text\",\n    \"edit\": \"Edit\",\n    \"title\": \"Alt\",\n    \"paragraph\": \"Normal text\",\n    \"quote\": \"Quote\",\n    \"code\": \"Code\",\n    \"heading1\": \"Heading 1\",\n    \"heading2\": \"Heading 2\",\n    \"heading3\": \"Heading 3\",\n    \"heading4\": \"Heading 4\",\n    \"heading5\": \"Heading 5\",\n    \"heading6\": \"Heading 6\",\n    \"filename\": \"Name\",\n    \"optional\": \"optional\",\n    \"unorderedlist\": \"Unordered List\",\n    \"orderedlist\": \"Ordered List\",\n    \"outdent\": \"Outdent\",\n    \"indent\": \"Indent\",\n    \"horizontalrule\": \"Line\",\n    \"upload\": \"Upload\",\n    \"upload-label\": \"Drop files here or click to upload\",\n    \"accessibility-help-label\": \"Rich text editor\",\n    \"caption\": \"Caption\",\n    \"bulletslist\": \"Bullets\",\n    \"numberslist\": \"Numbers\",\n    \"image-position\": \"Position\",\n    \"none\": \"None\",\n    \"left\": \"Left\",\n    \"right\": \"Right\",\n    \"center\": \"Center\",\n    \"undo\": \"Undo\",\n    \"redo\": \"Redo\"\n};\n$R.buttons = {\n    html: {\n        title: 'HTML',\n        icon: true,\n        api: 'module.source.toggle'\n    },\n    undo: {\n        title: '## undo ##',\n        icon: true,\n        api: 'module.buffer.undo'\n    },\n    redo: {\n        title: '## redo ##',\n        icon: true,\n        api: 'module.buffer.redo'\n    },\n    format: {\n        title: '## format ##',\n        icon: true,\n        dropdown: {\n            p: {\n                title: '## paragraph ##',\n                api: 'module.block.format',\n                args: {\n                    tag: 'p'\n                }\n            },\n            blockquote: {\n                title: '## quote ##',\n                api: 'module.block.format',\n                args: {\n                    tag: 'blockquote'\n                }\n            },\n            pre: {\n                title: '## code ##',\n                api: 'module.block.format',\n                args: {\n                    tag: 'pre'\n                }\n            },\n            h1: {\n                title: '## heading1 ##',\n                api: 'module.block.format',\n                args: {\n                    tag: 'h1'\n                }\n            },\n            h2: {\n                title: '## heading2 ##',\n                api: 'module.block.format',\n                args: {\n                    tag: 'h2'\n                }\n            },\n            h3: {\n                title: '## heading3 ##',\n                api: 'module.block.format',\n                args: {\n                    tag: 'h3'\n                }\n            },\n            h4: {\n                title: '## heading4 ##',\n                api: 'module.block.format',\n                args: {\n                    tag: 'h4'\n                }\n            },\n            h5: {\n                title: '## heading5 ##',\n                api: 'module.block.format',\n                args: {\n                    tag: 'h5'\n                }\n            },\n            h6: {\n                title: '## heading6 ##',\n                api: 'module.block.format',\n                args: {\n                    tag: 'h6'\n                }\n            }\n        }\n    },\n    bold: {\n        title: '## bold-abbr ##',\n        icon: true,\n        tooltip: '## bold ##',\n        api: 'module.inline.format',\n        args: {\n            tag: 'b'\n        }\n    },\n    italic: {\n        title: '## italic-abbr ##',\n        icon: true,\n        tooltip: '## italic ##',\n        api: 'module.inline.format',\n        args: {\n            tag: 'i'\n        }\n    },\n    deleted: {\n        title: '## deleted-abbr ##',\n        icon: true,\n        tooltip: '## deleted ##',\n        api: 'module.inline.format',\n        args: {\n            tag: 'del'\n        }\n    },\n    underline: {\n        title: '## underline-abbr ##',\n        icon: true,\n        tooltip: '## underline ##',\n        api: 'module.inline.format',\n        args: {\n            tag: 'u'\n        }\n    },\n    sup: {\n        title: '## superscript-abbr ##',\n        icon: true,\n        tooltip: '## superscript ##',\n        api: 'module.inline.format',\n        args: {\n            tag: 'sup'\n        }\n    },\n    sub: {\n        title: '## subscript-abbr ##',\n        icon: true,\n        tooltip: '## subscript ##',\n        api: 'module.inline.format',\n        args: {\n            tag: 'sub'\n        }\n    },\n    lists: {\n        title: '## lists ##',\n        icon: true,\n        observe: 'list',\n        dropdown: {\n            observe: 'list',\n            unorderedlist: {\n                title: '&bull; ## unorderedlist ##',\n                api: 'module.list.toggle',\n                args: 'ul'\n            },\n            orderedlist: {\n                title: '1. ## orderedlist ##',\n                api: 'module.list.toggle',\n                args: 'ol'\n            },\n            outdent: {\n                title: '< ## outdent ##',\n                api: 'module.list.outdent'\n            },\n            indent: {\n                title: '> ## indent ##',\n                api: 'module.list.indent'\n            }\n        }\n    },\n    ul: {\n        title: '&bull; ## bulletslist ##',\n        icon: true,\n        api: 'module.list.toggle',\n        observe: 'list',\n        args: 'ul'\n    },\n    ol: {\n        title: '1. ## numberslist ##',\n        icon: true,\n        api: 'module.list.toggle',\n        observe: 'list',\n        args: 'ol'\n    },\n    outdent: {\n        title: '## outdent ##',\n        icon: true,\n        api: 'module.list.outdent',\n        observe: 'list'\n    },\n    indent: {\n        title: '## indent ##',\n        icon: true,\n        api: 'module.list.indent',\n        observe: 'list'\n    },\n    image: {\n        title: '## image ##',\n        icon: true,\n        api: 'module.image.open'\n    },\n    file: {\n        title: '## file ##',\n        icon: true,\n        api: 'module.file.open'\n    },\n    link: {\n        title: '## link ##',\n        icon: true,\n        observe: 'link',\n        dropdown: {\n            observe: 'link',\n            link: {\n                title: '## link-insert ##',\n                api: 'module.link.open'\n            },\n            unlink: {\n                title: '## unlink ##',\n                api: 'module.link.unlink'\n            }\n        }\n    },\n    line: {\n        title: '## horizontalrule ##',\n        icon: true,\n        api: 'module.line.insert'\n    }\n};\nvar App = function(element, options, uuid)\n{\n    this.module = {};\n    this.plugin = {};\n    this.instances = {};\n\n    // start/stop\n    this.started = false;\n    this.stopped = false;\n\n    // environment\n    this.uuid = uuid;\n    this.rootElement = element;\n    this.rootOpts = options;\n    this.dragInside = false;\n    this.dragComponentInside = false;\n    this.keycodes = $R.keycodes;\n    this.namespace = 'redactor';\n    this.$win = $R.dom(window);\n    this.$doc = $R.dom(document);\n    this.$body = $R.dom('body');\n    this.editorReadOnly = false;\n\n    // core services\n    this.opts = $R.create('service.options', options, element);\n    this.lang = $R.create('service.lang', this);\n\n    // build\n    this.buildServices();\n    this.buildModules();\n    this.buildPlugins();\n\n    // start\n    this.start();\n};\n\nApp.prototype = {\n    start: function()\n    {\n        // start\n        this.stopped = false;\n        this.broadcast('start');\n        this.broadcast('startcode');\n\n        if (this.opts.clickToEdit)\n        {\n            this.broadcast('startclicktoedit');\n        }\n        else\n        {\n            this.broadcast('enable');\n            if (this.opts.showSource) this.broadcast('startcodeshow');\n            this.broadcast('enablefocus');\n        }\n\n        // started\n        this.broadcast('started');\n        this.started = true;\n    },\n    stop: function()\n    {\n        this.started = false;\n        this.stopped = true;\n\n        this.broadcast('stop');\n        this.broadcast('disable');\n        this.broadcast('stopped');\n    },\n\n    // started & stopped\n    isStarted: function()\n    {\n        return this.started;\n    },\n    isStopped: function()\n    {\n        return this.stopped;\n    },\n\n    // build\n    buildServices: function()\n    {\n        var core = ['options', 'lang'];\n        var bindable = ['uuid', 'keycodes', 'opts', 'lang', '$win', '$doc', '$body'];\n        var services = [];\n        for (var name in $R.services)\n        {\n            if (core.indexOf(name) === -1)\n            {\n                this[name] = $R.create('service.' + name, this);\n                services.push(name);\n                bindable.push(name);\n            }\n        }\n\n        // binding\n        for (var i = 0; i < services.length; i++)\n        {\n            var service = services[i];\n            for (var z = 0; z < bindable.length; z++)\n            {\n                var inj = bindable[z];\n                if (service !== inj)\n                {\n                    this[service][inj] = this[inj];\n                }\n            }\n        }\n    },\n    buildModules: function()\n    {\n        for (var name in $R.modules)\n        {\n            this.module[name] = $R.create('module.' + name, this);\n            this.instances[name] = this.module[name];\n        }\n    },\n    buildPlugins: function()\n    {\n        var plugins = this.opts.plugins;\n        for (var i = 0; i < plugins.length; i++)\n        {\n            var name = plugins[i];\n            if (typeof $R.plugins[name] !== 'undefined')\n            {\n                this.plugin[name] = $R.create('plugin.' + name, this);\n                this.instances[name] = this.plugin[name];\n            }\n        }\n    },\n\n    // draginside\n    isDragInside: function()\n    {\n        return this.dragInside;\n    },\n    setDragInside: function(dragInside)\n    {\n        this.dragInside = dragInside;\n    },\n    isDragComponentInside: function()\n    {\n        return this.dragComponentInside;\n    },\n    setDragComponentInside: function(dragInside)\n    {\n        this.dragComponentInside = dragInside;\n    },\n    getDragComponentInside: function()\n    {\n        return this.dragComponentInside;\n    },\n\n    // readonly\n    isReadOnly: function()\n    {\n        return this.editorReadOnly;\n    },\n    enableReadOnly: function()\n    {\n        this.editorReadOnly = true;\n        this.broadcast('enablereadonly');\n        this.component.clearActive();\n        this.toolbar.disableButtons();\n    },\n    disableReadOnly: function()\n    {\n        this.editorReadOnly = false;\n        this.broadcast('disablereadonly');\n        this.toolbar.enableButtons();\n    },\n\n    // messaging\n    callMessageHandler: function(instance, name, args)\n    {\n        var arr = name.split('.');\n        if (arr.length === 1)\n        {\n            if (typeof instance['on' + name] === 'function')\n            {\n                instance['on' + name].apply(instance, args);\n            }\n        }\n        else\n        {\n            arr[0] = 'on' + arr[0];\n\n            var func = this.utils.checkProperty(instance, arr);\n            if (typeof func === 'function')\n            {\n                func.apply(instance, args);\n            }\n        }\n    },\n    broadcast: function(name)\n    {\n        var args = [].slice.call(arguments, 1);\n        for (var moduleName in this.instances)\n        {\n            this.callMessageHandler(this.instances[moduleName], name, args);\n        }\n\n        // callback\n        return this.callback.trigger(name, args);\n    },\n\n    // callback\n    on: function(name, func)\n    {\n        this.callback.add(name, func);\n    },\n    off: function(name, func)\n    {\n        this.callback.remove(name, func);\n    },\n\n    // api\n    api: function(name)\n    {\n        if (!this.isStarted() && name !== 'start') return;\n        if (this.isReadOnly() && name !== 'disableReadOnly') return;\n\n        this.broadcast('state');\n\n        var args = [].slice.call(arguments, 1);\n        var arr = name.split('.');\n\n        var isApp = (arr.length === 1);\n        var isCallback = (arr[0] === 'on' || arr[0] === 'off');\n        var isService = (!isCallback && arr.length === 2);\n        var isPlugin = (arr[0] === 'plugin');\n        var isModule = (arr[0] === 'module');\n\n        // app\n        if (isApp)\n        {\n            if (typeof this[arr[0]] === 'function')\n            {\n                return this.callInstanceMethod(this, arr[0], args);\n            }\n        }\n        // callback\n        else if (isCallback)\n        {\n            return (arr[0] === 'on') ? this.on(arr[1], args[0]) : this.off(arr[1], args[0] || undefined);\n        }\n        // service\n        else if (isService)\n        {\n            if (this.isInstanceExists(this, arr[0]))\n            {\n                return this.callInstanceMethod(this[arr[0]], arr[1], args);\n            }\n            else\n            {\n                $R.error(new Error('Service \"' + arr[0] + '\" not found'));\n            }\n        }\n        // plugin\n        else if (isPlugin)\n        {\n            if (this.isInstanceExists(this.plugin, arr[1]))\n            {\n                return this.callInstanceMethod(this.plugin[arr[1]], arr[2], args);\n            }\n            else\n            {\n                $R.error(new Error('Plugin \"' + arr[1] + '\" not found'));\n            }\n        }\n        // module\n        else if (isModule)\n        {\n            if (this.isInstanceExists(this.module, arr[1]))\n            {\n                return this.callInstanceMethod(this.module[arr[1]], arr[2], args);\n            }\n            else\n            {\n                $R.error(new Error('Module \"' + arr[1] + '\" not found'));\n            }\n        }\n\n    },\n    isInstanceExists: function(obj, name)\n    {\n        return (typeof obj[name] !== 'undefined');\n    },\n    callInstanceMethod: function(instance, method, args)\n    {\n        if (typeof instance[method] === 'function')\n        {\n            return instance[method].apply(instance, args);\n        }\n    }\n};\n$R.add('mixin', 'formatter', {\n\n    // public\n    buildArgs: function(args)\n    {\n        this.args = {\n            'class': args['class'] || false,\n            'style': args['style'] || false,\n            'attr': args['attr'] || false\n        };\n\n        if (!this.args['class'] && !this.args['style'] && !this.args['attr'])\n        {\n            this.args = false;\n        }\n    },\n    applyArgs: function(nodes, selection)\n    {\n        if (this.args)\n        {\n            nodes = this[this.type](this.args, false, nodes, selection);\n        }\n        else\n        {\n            nodes = this._clearAll(nodes, selection);\n        }\n\n        return nodes;\n    },\n    clearClass: function(tags, nodes)\n    {\n        this.selection.save();\n\n        var $elements = (nodes) ? $R.dom(nodes) : this.getElements(tags, true);\n        $elements.removeAttr('class');\n\n        nodes = this._unwrapSpanWithoutAttr($elements.getAll());\n\n        this.selection.restore();\n\n        return nodes;\n    },\n    clearStyle: function(tags, nodes)\n    {\n        this.selection.save();\n\n        var $elements = (nodes) ? $R.dom(nodes) : this.getElements(tags, true);\n        $elements.removeAttr('style');\n\n        nodes = this._unwrapSpanWithoutAttr($elements.getAll());\n\n        this.selection.restore();\n\n        return nodes;\n    },\n    clearAttr: function(tags, nodes)\n    {\n        this.selection.save();\n\n        var $elements = (nodes) ? $R.dom(nodes) : this.getElements(tags, true);\n        this._removeAllAttr($elements);\n\n        nodes = this._unwrapSpanWithoutAttr($elements.getAll());\n\n        this.selection.restore();\n\n        return nodes;\n    },\n    set: function(args, tags, nodes, selection)\n    {\n        if (selection !== false) this.selection.save();\n\n        var $elements = (nodes) ? $R.dom(nodes) : this.getElements(tags);\n\n        if (args['class'])\n        {\n            $elements.removeAttr('class');\n            $elements.addClass(args['class']);\n        }\n\n        if (args['style'])\n        {\n            $elements.removeAttr('style');\n            $elements.css(args['style']);\n            $elements.each(function(node)\n            {\n                var $node = $R.dom(node);\n                $node.attr('data-redactor-style-cache', $node.attr('style'));\n            });\n        }\n\n        if (args['attr'])\n        {\n            this._removeAllAttr($elements);\n            $elements.attr(args['attr']);\n        }\n\n        if (selection !== false) this.selection.restore();\n\n        return $elements.getAll();\n    },\n    toggle: function(args, tags, nodes, selection)\n    {\n        if (selection !== false) this.selection.save();\n\n        var $elements = (nodes) ? $R.dom(nodes) : this.getElements(tags);\n\n        if (args['class'])\n        {\n            $elements.toggleClass(args['class']);\n            $elements.each(function(node)\n            {\n                if (node.className === '') node.removeAttribute('class');\n            });\n        }\n\n        var params;\n        if (args['style'])\n        {\n            params = args['style'];\n            $elements.each(function(node)\n            {\n                var $node = $R.dom(node);\n                for (var key in params)\n                {\n                    var newVal = params[key];\n                    var oldVal = $node.css(key);\n\n                    oldVal = (this.utils.isRgb(oldVal)) ? this.utils.rgb2hex(oldVal) : oldVal.replace(/\"/g, '');\n                    newVal = (this.utils.isRgb(newVal)) ? this.utils.rgb2hex(newVal) : newVal.replace(/\"/g, '');\n\n                    oldVal = this.utils.hex2long(oldVal);\n                    newVal = this.utils.hex2long(newVal);\n\n                    var compareNew = (typeof newVal === 'string') ? newVal.toLowerCase() : newVal;\n                    var compareOld = (typeof oldVal === 'string') ? oldVal.toLowerCase() : oldVal;\n\n                    if (compareNew === compareOld) $node.css(key, '');\n                    else $node.css(key, newVal);\n                }\n\n                this._convertStyleQuotes($node);\n                if (this.utils.removeEmptyAttr(node, 'style'))\n                {\n                    $node.removeAttr('data-redactor-style-cache');\n                }\n                else\n                {\n                    $node.attr('data-redactor-style-cache', $node.attr('style'));\n                }\n\n            }.bind(this));\n        }\n\n        if (args['attr'])\n        {\n            params = args['attr'];\n            $elements.each(function(node)\n            {\n                var $node = $R.dom(node);\n                for (var key in params)\n                {\n                    if ($node.attr(key)) $node.removeAttr(key);\n                    else $node.attr(key, params[key]);\n                }\n            });\n\n        }\n\n        if (selection !== false) this.selection.restore();\n\n        return $elements.getAll();\n    },\n    add: function(args, tags, nodes, selection)\n    {\n        if (selection !== false) this.selection.save();\n\n        var $elements = (nodes) ? $R.dom(nodes) : this.getElements(tags);\n\n        if (args['class'])\n        {\n            $elements.addClass(args['class']);\n        }\n\n        if (args['style'])\n        {\n            var params = args['style'];\n            $elements.each(function(node)\n            {\n                var $node = $R.dom(node);\n                $node.css(params);\n                $node.attr('data-redactor-style-cache', $node.attr('style'));\n\n                this._convertStyleQuotes($node);\n\n            }.bind(this));\n        }\n\n        if (args['attr'])\n        {\n            $elements.attr(args['attr']);\n        }\n\n        if (selection !== false) this.selection.restore();\n\n        return $elements.getAll();\n    },\n    remove: function(args, tags, nodes, selection)\n    {\n        if (selection !== false) this.selection.save();\n\n        var $elements = (nodes) ? $R.dom(nodes) : this.getElements(tags);\n\n        if (args['class'])\n        {\n            $elements.removeClass(args['class']);\n            $elements.each(function(node)\n            {\n                if (node.className === '') node.removeAttribute('class');\n            });\n        }\n\n        if (args['style'])\n        {\n            var name = args['style'];\n            $elements.each(function(node)\n            {\n                var $node = $R.dom(node);\n                $node.css(name, '');\n\n                if (this.utils.removeEmptyAttr(node, 'style'))\n                {\n                    $node.removeAttr('data-redactor-style-cache');\n                }\n                else\n                {\n                    $node.attr('data-redactor-style-cache', $node.attr('style'));\n                }\n\n            }.bind(this));\n        }\n\n        if (args['attr'])\n        {\n            $elements.removeAttr(args['attr']);\n        }\n\n        nodes = this._unwrapSpanWithoutAttr($elements.getAll());\n\n        if (selection !== false) this.selection.restore();\n\n        return nodes;\n    },\n\n    // private\n    _removeAllAttr: function($elements)\n    {\n        $elements.each(function(node)\n        {\n            for (var i = node.attributes.length; i-->0;)\n            {\n                var nodeAttr = node.attributes[i];\n                var name = nodeAttr.name;\n                if (name !== 'style' && name !== 'class')\n                {\n                    node.removeAttributeNode(nodeAttr);\n                }\n            }\n        });\n    },\n    _convertStyleQuotes: function($node)\n    {\n        var style = $node.attr('style');\n        if (style) $node.attr('style', style.replace(/\"/g, '\\''));\n    },\n    _clearAll: function(nodes, selection)\n    {\n        if (selection !== false) this.selection.save();\n\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var node = nodes[i];\n            while (node.attributes.length > 0)\n            {\n                node.removeAttribute(node.attributes[0].name);\n            }\n        }\n\n        nodes = this._unwrapSpanWithoutAttr(nodes);\n\n        if (selection !== false) this.selection.restore();\n\n        return nodes;\n    },\n    _unwrapSpanWithoutAttr: function(nodes)\n    {\n        var finalNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var node = nodes[i];\n            var len = node.attributes.length;\n            if (len <= 0 && node.nodeType !== 3 && node.tagName === 'SPAN')\n            {\n                $R.dom(node).unwrap();\n            }\n            else\n            {\n                finalNodes.push(node);\n            }\n        }\n\n        return finalNodes;\n    }\n});\n$R.add('mixin', 'dom', $R.Dom.prototype);\n$R.add('mixin', 'component', {\n    get cmnt()\n    {\n        return true;\n    }\n});\n$R.add('service', 'options', {\n    init: function(options, element)\n    {\n        var $el = $R.dom(element);\n        var opts = $R.extend({}, $R.opts, (element) ? $el.data() : {}, $R.options);\n        opts = $R.extend(true, opts, options);\n\n        return opts;\n    }\n});\n$R.add('service', 'lang', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n\n        // build\n        this.vars = this._build(this.opts.lang);\n    },\n\n    // public\n    rebuild: function(lang)\n    {\n        this.opts.lang = lang;\n        this.vars = this._build(lang);\n    },\n    extend: function(obj)\n    {\n        this.vars = $R.extend(this.vars, obj);\n    },\n    parse: function(str)\n    {\n        if (str === undefined)\n        {\n            return '';\n        }\n\n        var matches = str.match(/## (.*?) ##/g);\n        if (matches)\n        {\n            for (var i = 0; i < matches.length; i++)\n            {\n                var key = matches[i].replace(/^##\\s/g, '').replace(/\\s##$/g, '');\n                str = str.replace(matches[i], this.get(key));\n            }\n        }\n\n        return str;\n    },\n    get: function(name)\n    {\n        var str = '';\n        if (typeof this.vars[name] !== 'undefined')\n        {\n            str = this.vars[name];\n        }\n        else if (this.opts.lang !== 'en' && typeof $R.lang['en'][name] !== 'undefined')\n        {\n            str = $R.lang['en'][name];\n        }\n\n        return str;\n    },\n\n    // private\n    _build: function(lang)\n    {\n        var vars = $R.lang['en'];\n        if (lang !== 'en')\n        {\n            vars = ($R.lang[lang] !== undefined) ? $R.lang[lang] : vars;\n        }\n\n        return vars;\n    }\n});\n$R.add('service', 'callback', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n\n        // local\n        this.callbacks = {};\n\n        // build\n        if (this.opts.callbacks)\n        {\n            this._set(this.opts.callbacks, '');\n        }\n    },\n    stop: function()\n    {\n        this.callbacks = {};\n    },\n    add: function(name, handler)\n    {\n        if (!this.callbacks[name]) this.callbacks[name] = [];\n        this.callbacks[name].push(handler);\n    },\n    remove: function(name, handler)\n    {\n        if (handler === undefined)\n        {\n            delete this.callbacks[name];\n        }\n        else\n        {\n            for (var i = 0; i < this.callbacks[name].length; i++)\n            {\n                this.callbacks[name].splice(i, 1);\n            }\n\n            if (Object.keys(this.callbacks[name]).length === 0) delete this.callbacks[name];\n        }\n    },\n    trigger: function(name, args)\n    {\n        var value = this._loop(name, args, this.callbacks);\n        return (typeof value === 'undefined' && args && args[0] !== false) ? args[0] : value;\n    },\n\n    // private\n    _set: function(obj, name)\n    {\n        for (var key in obj)\n        {\n            var path = (name === '') ? key : name + '.' + key;\n            if (typeof obj[key] === 'object')\n            {\n                this._set(obj[key], path);\n            }\n            else\n            {\n                this.callbacks[path] = [];\n                this.callbacks[path].push(obj[key]);\n            }\n        }\n    },\n    _loop: function(name, args, obj)\n    {\n        var value;\n        for (var key in obj)\n        {\n            if (name === key)\n            {\n                for (var i = 0; i < obj[key].length; i++)\n                {\n                    value = obj[key][i].apply(this.app, args);\n                }\n            }\n        }\n\n        return value;\n    }\n});\n$R.add('service', 'animate', {\n    init: function(app)\n    {\n        this.animationOpt = app.opts.animation;\n    },\n    start: function(element, animation, options, callback)\n    {\n        var defaults = {\n            duration: false,\n            iterate: false,\n            delay: false,\n            timing: false,\n            prefix: 'redactor-'\n        };\n\n        defaults = (typeof options === 'function') ? defaults : $R.extend(defaults, options);\n        callback = (typeof options === 'function') ? options : callback;\n\n        // play\n        return new $R.AnimatePlay(element, animation, defaults, callback, this.animationOpt);\n    },\n    stop: function(element)\n    {\n        this.$el = $R.dom(element);\n        this.$el.removeClass('redactor-animated');\n\n        var effect = this.$el.attr('redactor-animate-effect');\n        this.$el.removeClass(effect);\n\n        this.$el.removeAttr('redactor-animate-effect');\n        var hide = this.$el.attr('redactor-animate-hide');\n        if (hide)\n        {\n            this.$el.addClass(hide).removeAttr('redactor-animate-hide');\n        }\n\n        this.$el.off('animationend webkitAnimationEnd');\n    }\n});\n\n$R.AnimatePlay = function(element, animation, defaults, callback, animationOpt)\n{\n    this.hidableEffects = ['fadeOut', 'flipOut', 'slideUp', 'zoomOut', 'slideOutUp', 'slideOutRight', 'slideOutLeft'];\n    this.prefixes = ['', '-webkit-'];\n\n    this.$el = $R.dom(element);\n    this.$body = $R.dom('body');\n    this.callback = callback;\n    this.animation = (!animationOpt) ? this.buildAnimationOff(animation) : animation;\n    this.defaults = defaults;\n\n    if (this.animation === 'slideUp')\n    {\n        this.$el.height(this.$el.height());\n    }\n\n    // animate\n    return (this.isInanimate()) ? this.inanimate() : this.animate();\n};\n\n$R.AnimatePlay.prototype = {\n    buildAnimationOff: function(animation)\n    {\n        return (this.isHidable(animation)) ? 'hide' : 'show';\n    },\n    buildHideClass: function()\n    {\n        return 'redactor-animate-hide';\n    },\n    isInanimate: function()\n    {\n        return (this.animation === 'show' || this.animation === 'hide');\n    },\n    isAnimated: function()\n    {\n        return this.$el.hasClass('redactor-animated');\n    },\n    isHidable: function(effect)\n    {\n        return (this.hidableEffects.indexOf(effect) !== -1);\n    },\n    inanimate: function()\n    {\n        this.defaults.timing = 'linear';\n\n        var hide;\n        if (this.animation === 'show')\n        {\n            hide = this.buildHideClass();\n            this.$el.attr('redactor-animate-hide', hide);\n            this.$el.removeClass(hide);\n        }\n        else\n        {\n            hide = this.$el.attr('redactor-animate-hide');\n            this.$el.addClass(hide).removeAttr('redactor-animate-hide');\n        }\n\n        if (typeof this.callback === 'function') this.callback(this);\n\n        return this;\n    },\n    animate: function()\n    {\n        var delay = (this.defaults.delay) ? this.defaults.delay : 0;\n        setTimeout(function()\n        {\n            this.$body.addClass('no-scroll-x');\n            this.$el.addClass('redactor-animated');\n            if (!this.$el.attr('redactor-animate-hide'))\n            {\n                var hide = this.buildHideClass();\n                this.$el.attr('redactor-animate-hide', hide);\n                this.$el.removeClass(hide);\n            }\n\n            this.$el.addClass(this.defaults.prefix + this.animation);\n            this.$el.attr('redactor-animate-effect', this.defaults.prefix + this.animation);\n\n            this.set(this.defaults.duration + 's', this.defaults.iterate, this.defaults.timing);\n            this.complete();\n\n        }.bind(this), delay * 1000);\n\n        return this;\n    },\n    set: function(duration, iterate, timing)\n    {\n        var len = this.prefixes.length;\n\n        while (len--)\n        {\n            if (duration !== false || duration === '') this.$el.css(this.prefixes[len] + 'animation-duration', duration);\n            if (iterate !== false || iterate === '') this.$el.css(this.prefixes[len] + 'animation-iteration-count', iterate);\n            if (timing !== false || timing === '') this.$el.css(this.prefixes[len] + 'animation-timing-function', timing);\n        }\n    },\n    clean: function()\n    {\n        this.$body.removeClass('no-scroll-x');\n        this.$el.removeClass('redactor-animated');\n        this.$el.removeClass(this.defaults.prefix + this.animation);\n        this.$el.removeAttr('redactor-animate-effect');\n\n        this.set('', '', '');\n    },\n    complete: function()\n    {\n        this.$el.one('animationend webkitAnimationEnd', function()\n        {\n            if (this.$el.hasClass(this.defaults.prefix + this.animation)) this.clean();\n            if (this.isHidable(this.animation))\n            {\n                var hide = this.$el.attr('redactor-animate-hide');\n                this.$el.addClass(hide).removeAttr('redactor-animate-hide');\n            }\n\n            if (this.animation === 'slideUp') this.$el.height('');\n            if (typeof this.callback === 'function') this.callback(this.$el);\n\n        }.bind(this));\n    }\n};\n$R.add('service', 'caret', {\n    init: function(app)\n    {\n        this.app = app;\n    },\n\n    // set\n    setStart: function(el)\n    {\n        this._setCaret('Start', el);\n    },\n    setEnd: function(el)\n    {\n        this._setCaret('End', el);\n    },\n    setBefore: function(el)\n    {\n        this._setCaret('Before', el);\n    },\n    setAfter: function(el)\n    {\n        this._setCaret('After', el);\n    },\n\n    // is\n    isStart: function(el)\n    {\n        return this._isStartOrEnd(el, 'First');\n    },\n    isEnd: function(el)\n    {\n        return this._isStartOrEnd(el, 'Last');\n    },\n\n    // set side\n    setAtEnd: function(node)\n    {\n        var data = this.inspector.parse(node);\n        var tag = data.getTag();\n        var range = document.createRange();\n        if (this._isInPage(node))\n        {\n            if (tag === 'a')\n            {\n                var textNode = this.utils.createInvisibleChar();\n                $R.dom(node).after(textNode);\n\n                range.selectNodeContents(textNode);\n                range.collapse(true);\n            }\n            else\n            {\n                range.selectNodeContents(node);\n                range.collapse(false);\n            }\n\n            this.selection.setRange(range);\n        }\n    },\n    setAtStart: function(node)\n    {\n\t\tvar range = document.createRange();\n\t\tvar data = this.inspector.parse(node);\n        if (this._isInPage(node))\n        {\n            range.setStart(node, 0);\n            range.collapse(true);\n\n            if (data.isInline() || this.utils.isEmpty(node))\n            {\n                var textNode = this.utils.createInvisibleChar();\n                range.insertNode(textNode);\n                range.selectNodeContents(textNode);\n                range.collapse(false);\n            }\n\n            this.selection.setRange(range);\n        }\n    },\n    setAtBefore: function(node)\n    {\n        var data = this.inspector.parse(node);\n        var range = document.createRange();\n        if (this._isInPage(node))\n        {\n            range.setStartBefore(node);\n            range.collapse(true);\n\n            if (data.isInline())\n            {\n                var textNode = this.utils.createInvisibleChar();\n                node.parentNode.insertBefore(textNode, node);\n                range.selectNodeContents(textNode);\n                range.collapse(false);\n            }\n\n            this.selection.setRange(range);\n        }\n    },\n    setAtAfter: function(node)\n    {\n\n        var range = document.createRange();\n        if (this._isInPage(node))\n        {\n            range.setStartAfter(node);\n            range.collapse(true);\n\n            var textNode = this.utils.createInvisibleChar();\n            range.insertNode(textNode);\n            range.selectNodeContents(textNode);\n            range.collapse(false);\n\n            this.selection.setRange(range);\n        }\n    },\n    setAtPrev: function(node)\n    {\n        var prev = node.previousSibling;\n        if (prev)\n        {\n            prev = (prev.nodeType === 3 && this._isEmptyTextNode(prev)) ? prev.previousElementSibling : prev;\n            if (prev) this.setEnd(prev);\n        }\n    },\n    setAtNext: function(node)\n    {\n        var next = node.nextSibling;\n        if (next)\n        {\n            next = (next.nodeType === 3 && this._isEmptyTextNode(next)) ? next.nextElementSibling : next;\n            if (next) this.setStart(next);\n        }\n    },\n\n    // private\n    _setCaret: function(type, el)\n    {\n        var data = this.inspector.parse(el);\n        var node = data.getNode();\n\n        if (node)\n        {\n            this.component.clearActive();\n            this['_set' + type](node, data, data.getTag());\n        }\n    },\n    _setStart: function(node, data, tag)\n    {\n        // 1. text\n        if (data.isText())\n        {\n            this.editor.focus();\n            return this.setAtStart(node);\n        }\n        // 2. ul, ol\n        else if (tag === 'ul' || tag === 'ol')\n        {\n            node = data.findFirstNode('li');\n\n            var item = this.utils.getFirstElement(node);\n            var dataItem = this.inspector.parse(item);\n            if (item && dataItem.isComponent())\n            {\n                return this.setStart(dataItem.getComponent());\n            }\n        }\n        // 3. dl\n        else if (tag === 'dl')\n        {\n            node = data.findFirstNode('dt');\n        }\n        // 4. br / hr\n        else if (tag === 'br' || tag === 'hr')\n        {\n            return this.setBefore(node);\n        }\n        // 5. th, td\n        else if (tag === 'td' || tag === 'th')\n        {\n            var el = data.getFirstElement(node);\n            if (el)\n            {\n                return this.setStart(el);\n            }\n        }\n        // 6. table\n        else if (tag === 'table' || tag === 'tr')\n        {\n            return this.setStart(data.findFirstNode('th, td'));\n        }\n        // 7. figure code\n        else if (data.isComponentType('code') && !data.isFigcaption())\n        {\n            var code = data.findLastNode('pre, code');\n\n            this.editor.focus();\n            return this.setAtStart(code);\n        }\n        // 8. table component\n        else if (tag === 'figure' && data.isComponentType('table'))\n        {\n            var table = data.getTable();\n            var tableData = this.inspector.parse(table);\n\n            return this.setStart(tableData.findFirstNode('th, td'));\n        }\n        // 9. non editable components\n        else if (!data.isComponentType('table') && data.isComponent() && !data.isFigcaption())\n        {\n            return this.component.setActive(node);\n        }\n\n        this.editor.focus();\n\n        // set\n        if (!this._setInline(node, 'Start'))\n        {\n            this.setAtStart(node);\n        }\n    },\n    _setEnd: function(node, data, tag)\n    {\n        // 1. text\n        if (data.isText())\n        {\n            this.editor.focus();\n            return this.setAtEnd(node);\n        }\n        // 2. ul, ol\n        else if (tag === 'ul' || tag === 'ol')\n        {\n            node = data.findLastNode('li');\n\n            var item = this.utils.getLastElement(node);\n            var dataItem = this.inspector.parse(item);\n            if (item && dataItem.isComponent())\n            {\n                return this.setEnd(dataItem.getComponent());\n            }\n        }\n        // 3. dl\n        else if (tag === 'dl')\n        {\n            node = data.findLastNode('dd');\n        }\n        // 4. br / hr\n        else if (tag === 'br' || tag === 'hr')\n        {\n            return this.setAfter(node);\n        }\n        // 5. th, td\n        else if (tag === 'td' || tag === 'th')\n        {\n            var el = data.getLastElement();\n            if (el)\n            {\n                return this.setEnd(el);\n            }\n        }\n        // 6. table\n        else if (tag === 'table' || tag === 'tr')\n        {\n            return this.setEnd(data.findLastNode('th, td'));\n        }\n        // 7. figure code\n        else if (data.isComponentType('code') && !data.isFigcaption())\n        {\n            var code = data.findLastNode('pre, code');\n\n            this.editor.focus();\n            return this.setAtEnd(code);\n        }\n        // 8. table component\n        else if (tag === 'figure' && data.isComponentType('table'))\n        {\n            var table = data.getTable();\n            var tableData = this.inspector.parse(table);\n\n            return this.setEnd(tableData.findLastNode('th, td'));\n        }\n        // 9. non editable components\n        else if (!data.isComponentType('table') && data.isComponent() && !data.isFigcaption())\n        {\n            return this.component.setActive(node);\n        }\n\n        this.editor.focus();\n\n        // set\n        if (!this._setInline(node, 'End'))\n        {\n            // is element empty\n            if (this.utils.isEmpty(node))\n            {\n                return this.setStart(node);\n            }\n\n            this.setAtEnd(node);\n        }\n    },\n    _setBefore: function(node, data, tag)\n    {\n        // text\n        if (node.nodeType === 3)\n        {\n            return this.setAtBefore(node);\n        }\n        // inline\n        else if (data.isInline())\n        {\n            return this.setAtBefore(node);\n        }\n        // td / th\n        else if (data.isFirstTableCell())\n        {\n            return this.setAtPrev(data.getComponent());\n        }\n        else if (tag === 'td' || tag === 'th')\n        {\n            return this.setAtPrev(node);\n        }\n        // li\n        else if (data.isFirstListItem())\n        {\n            return this.setAtPrev(data.getList());\n        }\n        // figcaption\n        else if (data.isFigcaption())\n        {\n            return this.setStart(data.getComponent());\n        }\n        // component\n        else if (!data.isComponentType('table') && data.isComponent())\n        {\n            return this.setAtPrev(data.getComponent());\n        }\n        // block\n        else if (data.isBlock())\n        {\n            return this.setAtPrev(node);\n        }\n\n        this.editor.focus();\n        this.setAtBefore(node);\n\n    },\n    _setAfter: function(node, data, tag)\n    {\n        // text\n        if (node.nodeType === 3)\n        {\n            return this.setAtAfter(node);\n        }\n        // inline\n        else if (data.isInline())\n        {\n            return this.setAtAfter(node);\n        }\n        // td / th\n        else if (data.isLastTableCell())\n        {\n            return this.setAtNext(data.getComponent());\n        }\n        else if (tag === 'td' || tag === 'th')\n        {\n            return this.setAtNext(node);\n        }\n        // li\n        else if (data.isFirstListItem())\n        {\n            return this.setAtNext(data.getList());\n        }\n        // component\n        else if (!data.isComponentType('table') && data.isComponent())\n        {\n            return this.setAtNext(data.getComponent());\n        }\n        // block\n        else if (data.isBlock())\n        {\n            return this.setAtNext(node);\n        }\n\n        this.editor.focus();\n        this.setAtAfter(node);\n    },\n    _setInline: function(node, type)\n    {\n        // is first element inline (FF only)\n        var inline = this._hasInlineChild(node, (type === 'Start') ? 'first' : 'last');\n        if (inline)\n        {\n            if (type === 'Start')\n            {\n                this.setStart(inline);\n            }\n            else\n            {\n                this.setEnd(inline);\n            }\n\n            return true;\n        }\n    },\n    _isStartOrEnd: function(el, type)\n    {\n        var node = this.utils.getNode(el);\n        if (!node) return false;\n\n        var data = this.inspector.parse(node);\n        node = this._getStartEndNode(node, data, type);\n\n        if (node && (node.nodeType !== 3 && node.tagName !== 'LI'))\n        {\n            var html = (node.nodeType === 3) ? node.textContent : node.innerHTML;\n            html = this.utils.trimSpaces(html);\n            if (html === '') return true;\n        }\n\n        if (!data.isFigcaption() && data.isComponent() && !data.isComponentEditable())\n        {\n            return true;\n        }\n\n        var offset = this.offset.get(node, true);\n        if (offset)\n        {\n            return (type === 'First') ? (offset.start === 0) : (offset.end === this.offset.size(node, true));\n        }\n        else\n        {\n            return false;\n        }\n    },\n    _isInPage: function(node)\n    {\n        if (node && node.nodeType)\n        {\n            return (node === document.body) ? false : document.body.contains(node);\n        }\n        else\n        {\n            return false;\n        }\n    },\n    _hasInlineChild: function(el, pos)\n    {\n        var data = this.inspector.parse(el);\n        var node = (pos === 'first') ? data.getFirstNode() : data.getLastNode();\n        var $node = $R.dom(node);\n\n        if (node && node.nodeType !== 3\n            && this.inspector.isInlineTag(node.tagName)\n            && !$node.hasClass('redactor-component')\n             && !$node.hasClass('non-editable'))\n        {\n            return node;\n        }\n    },\n    _isEmptyTextNode: function(node)\n    {\n        var text = node.textContent.trim().replace(/\\n/, '');\n        text = this.utils.removeInvisibleChars(text);\n\n        return (text === '');\n    },\n    _getStartEndNode: function(node, data, type)\n    {\n        if (data.isFigcaption())\n        {\n            node = data.getFigcaption();\n        }\n        else if (data.isTable())\n        {\n            node = data['find' + type + 'Node']('th, td');\n        }\n        else if (data.isList())\n        {\n            node = data['find' + type + 'Node']('li');\n        }\n        else if (data.isComponentType('code'))\n        {\n            node = data.findLastNode('pre, code');\n        }\n\n        return node;\n    }\n});\nvar containsNode = function containsNode(node) {\n    return document.getSelection().containsNode(node, true);\n};\n\nif (!('containsNode' in Selection.prototype)) {\n    containsNode = containsNodePolyfill;\n}\n\nvar containsNodePolyfill = function polyfill(node) {\n    var selection = document.getSelection();\n    var start = selection.anchorNode.parentNode;\n    var finalnode = selection.focusNode.parentNode;\n    var rectSelection = selection.getRangeAt(0).getBoundingClientRect();\n    var rectBlock = node.getBoundingClientRect();\n\n    if ($R.dom(start).closest(node).length) {\n        return true;\n    }\n\n    if ($R.dom(finalnode).closest(node).length) {\n        return true;\n    }\n\n    if (rectSelection.top < rectBlock.top && rectSelection.height > rectBlock.height) {\n        return true;\n    }\n\n    return false;\n};\n\n\n$R.add('service', 'selection', {\n    init: function(app)\n    {\n        this.app = app;\n    },\n    // is\n    is: function()\n    {\n        var sel = this.get();\n        if (sel)\n        {\n            var node = sel.anchorNode;\n            var data = this.inspector.parse(node);\n\n            return (data.isInEditor() || data.isEditor());\n        }\n\n        return false;\n    },\n    isCollapsed: function()\n    {\n        var sel = this.get();\n        var range = this.getRange();\n\n        if (sel && sel.isCollapsed) return true;\n        else if (range && range.toString().length === 0) return true;\n\n        return false;\n    },\n    isBackwards: function()\n    {\n        var backwards = false;\n        var sel = this.get();\n\n        if (sel && !sel.isCollapsed)\n        {\n            var range = document.createRange();\n            range.setStart(sel.anchorNode, sel.anchorOffset);\n            range.setEnd(sel.focusNode, sel.focusOffset);\n            backwards = range.collapsed;\n            range.detach();\n        }\n\n        return backwards;\n    },\n    isIn: function(el)\n    {\n        var node = $R.dom(el).get();\n        var current = this.getCurrent();\n\n        return (current && node) ? node.contains(current) : false;\n    },\n    isText: function()\n    {\n        var sel = this.get();\n        if (sel)\n        {\n            var el = sel.anchorNode;\n            var block = this.getBlock(el);\n            var blocks = this.getBlocks();\n\n            // td, th or hasn't block\n            if ((block && this.inspector.isTableCellTag(block.tagName)) || (block === false && blocks.length === 0))\n            {\n                return true;\n            }\n        }\n\n        return false;\n    },\n    isAll: function(el)\n    {\n        var node = this.utils.getNode(el);\n        if (!node) return false;\n\n        var isEditor = this.editor.isEditor(node);\n        var data = this.inspector.parse(node);\n\n        // component\n        if (!data.isFigcaption() && this.component.isNonEditable(node) && this.component.isActive(node))\n        {\n            return true;\n        }\n\n        if (isEditor)\n        {\n            var $editor = this.editor.getElement();\n            var output = $editor.html().replace(/<p><\\/p>$/i, '');\n            var htmlLen = this.getHtml(false).length;\n            var outputLen = output.length;\n\n            if (htmlLen !== outputLen)\n            {\n                return false;\n            }\n        }\n\n        // editor empty or collapsed\n        if ((isEditor && this.editor.isEmpty()) || this.isCollapsed())\n        {\n            return false;\n        }\n\n        // all\n        var offset = this.offset.get(node, true);\n        var size = this.offset.size(node, true);\n\n        // pre, table, or pre/code in figure\n        if (!isEditor && data.isComponentType('code'))\n        {\n            size = this.getText().trim().length;\n        }\n\n        if (offset && offset.start === 0 && offset.end === size)\n        {\n            return true;\n        }\n\n        return false;\n    },\n\n    // has\n    hasNonEditable: function()\n    {\n        var selected = this.getHtml();\n        var $wrapper = $R.dom('<div>').html(selected);\n\n        return (!this.isCollapsed() && $wrapper.find('.non-editable').length !== 0);\n    },\n\n    // set\n    setRange: function(range)\n    {\n        var sel = window.getSelection();\n        sel.removeAllRanges();\n        sel.addRange(range);\n    },\n    setAll: function(el)\n    {\n        var node = this.utils.getNode(el);\n        if (!node) return;\n\n        var data = this.inspector.parse(node);\n\n        this.component.clearActive();\n\n        this.editor.focus();\n        this.editor.saveScroll();\n        this.editor.disableNonEditables();\n\n        if (node && node.tagName === 'TABLE')\n        {\n            var first = data.findFirstNode('td, th');\n            var last = data.findLastNode('td, th');\n\n            $R.dom(first).prepend(this.marker.build('start'));\n            $R.dom(last).append(this.marker.build('end'));\n\n            this.restoreMarkers();\n        }\n        else if (!data.isFigcaption() && this.component.isNonEditable(node))\n        {\n            this.component.setActive(node);\n        }\n        else\n        {\n            if (data.isComponentType('code'))\n            {\n                node = data.getComponentCodeElement();\n                node.focus();\n            }\n\n            var range = document.createRange();\n            range.selectNodeContents(node);\n\n            this.setRange(range);\n        }\n\n        this.editor.enableNonEditables();\n        this.editor.restoreScroll();\n    },\n\n    // get\n    get: function()\n    {\n        var sel = window.getSelection();\n        return (sel.rangeCount > 0) ? sel : null;\n    },\n    getRange: function()\n    {\n        var sel = this.get();\n        return (sel) ? ((sel.getRangeAt(0)) ? sel.getRangeAt(0) : null) : null;\n    },\n    getTextBeforeCaret: function(num)\n    {\n        num = (typeof num === 'undefined') ? 1 : num;\n\n        var el = this.editor.getElement().get();\n        var range = this.getRange();\n        var text = false;\n        if (range)\n        {\n            range = range.cloneRange();\n            range.collapse(true);\n            range.setStart(el, 0);\n            text = range.toString().slice(-num);\n        }\n\n        return text;\n    },\n    getTextAfterCaret: function(num)\n    {\n        num = (typeof num === 'undefined') ? 1 : num;\n\n        var el = this.editor.getElement().get();\n        var range = this.getRange();\n        var text = false;\n        if (range)\n        {\n            var clonedRange = range.cloneRange();\n            clonedRange.selectNodeContents(el);\n            clonedRange.setStart(range.endContainer, range.endOffset);\n\n            text = clonedRange.toString().slice(0, num);\n        }\n\n        return text;\n    },\n    getPosition: function()\n    {\n        var range = this.getRange();\n        var pos = { top: 0, left: 0, width: 0, height: 0 };\n        if (window.getSelection && range.getBoundingClientRect)\n        {\n            range = range.cloneRange();\n            var offset = (range.startOffset-1);\n            range.setStart(range.startContainer, (offset < 0) ? 0 : offset);\n            var rect = range.getBoundingClientRect();\n            pos = { top: rect.top, left: rect.left, width: (rect.right - rect.left) , height: (rect.bottom - rect.top) };\n        }\n\n        return pos;\n    },\n    getCurrent: function()\n    {\n        var node = false;\n        var sel = this.get();\n        var component = this.component.getActive();\n\n        if (component)\n        {\n            node = component;\n        }\n        else if (sel && this.is())\n        {\n            var data = this.inspector.parse(sel.anchorNode);\n            node = (!data.isEditor()) ? sel.anchorNode : false;\n        }\n\n        return node;\n    },\n    getParent: function()\n    {\n        var node = false;\n        var current = this.getCurrent();\n        if (current)\n        {\n            var parent = current.parentNode;\n            var data = this.inspector.parse(parent);\n\n            node = (!data.isEditor()) ? parent : false;\n        }\n\n        return node;\n    },\n    getElement: function(el)\n    {\n        var node = el || this.getCurrent();\n        while (node)\n        {\n            var data = this.inspector.parse(node);\n            if (data.isElement() && data.isInEditor())\n            {\n                return node;\n            }\n\n            node = node.parentNode;\n        }\n\n        return false;\n    },\n    getInline: function(el)\n    {\n        var node = el || this.getCurrent();\n        var inline = false;\n        while (node)\n        {\n            if (this._isInlineNode(node))\n            {\n                inline = node;\n            }\n\n            node = node.parentNode;\n        }\n\n        return inline;\n    },\n    getInlineFirst: function(el)\n    {\n        var node = el || this.getCurrent();\n        while (node)\n        {\n            if (this._isInlineNode(node))\n            {\n                return node;\n            }\n\n            node = node.parentNode;\n        }\n\n        return false;\n    },\n    getInlineAll: function(el)\n    {\n        var node = el || this.getCurrent();\n        var inlines = [];\n        while (node)\n        {\n            if (this._isInlineNode(node))\n            {\n                inlines.push(node);\n            }\n\n            node = node.parentNode;\n        }\n\n        return inlines;\n    },\n    getBlock: function(el)\n    {\n        var node = el || this.getCurrent();\n        while (node)\n        {\n            var data = this.inspector.parse(node);\n            var isBlock = this.inspector.isBlockTag(node.tagName);\n\n            if (isBlock && data.isInEditor(node))\n            {\n                return node;\n            }\n\n            node = node.parentNode;\n        }\n\n        return false;\n    },\n    getInlinesAllSelected: function(options)\n    {\n        if (this.isAll()) return [];\n\n        var inlines = this.getInlines({ all: true });\n        var textNodes = this.getNodes({ textnodes: true, inline: false });\n        var selected = this.getText().replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, \"\\\\$&\");\n        var finalNodes = [];\n\n        if (textNodes.length !== 0)\n        {\n            return finalNodes;\n        }\n\n        if (selected === '')\n        {\n            finalNodes = inlines;\n        }\n        else if (inlines.length > 1)\n        {\n            for (var i = 0; i < inlines.length; i++)\n            {\n                if (this._isTextSelected(inlines[i], selected))\n                {\n                    finalNodes.push(inlines[i]);\n                }\n            }\n        }\n        else if (inlines.length === 1)\n        {\n            if (this._isTextSelected(inlines[0], selected))\n            {\n                finalNodes = inlines;\n            }\n        }\n\n        finalNodes = (options && options.tags) ? this._filterNodesByTags(finalNodes, options.tags) : finalNodes;\n\n        return finalNodes;\n    },\n    getInlines: function(options)\n    {\n        var nodes = this.getNodes();\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var node;\n            if (options && options.all)\n            {\n                node = nodes[i];\n                while (node)\n                {\n                    if (this._isInlineNode(node) && !this._isInNodesArray(filteredNodes, node))\n                    {\n                        filteredNodes.push(node);\n                    }\n\n                    node = node.parentNode;\n                }\n            }\n            else\n            {\n                node = this.getInline(nodes[i]);\n                if (node && !this._isInNodesArray(filteredNodes, node))\n                {\n                    filteredNodes.push(node);\n                }\n            }\n        }\n\n        // filter\n        filteredNodes = (options && options.tags) ? this._filterNodesByTags(filteredNodes, options.tags) : filteredNodes;\n        filteredNodes = (options && options.inside) ? this._filterInlinesInside(filteredNodes, options) : filteredNodes;\n\n        return filteredNodes;\n    },\n    getBlocks: function(options)\n    {\n        var nodes = this.getNodes();\n        var block = this.getBlock();\n        nodes = (nodes.length === 0 && block) ? [block] : nodes;\n\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var node = this.getBlock(nodes[i]);\n            var $node = $R.dom(node);\n            if ($node.hasClass('non-editable')) continue;\n\n            if (node && !this._isInNodesArray(filteredNodes, node))\n            {\n                filteredNodes.push(node);\n            }\n        }\n\n        // filter\n        filteredNodes = (options && options.tags) ? this._filterNodesByTags(filteredNodes, options.tags) : filteredNodes;\n        filteredNodes = (options && options.first) ? this._filterBlocksFirst(filteredNodes, options) : filteredNodes;\n\n        return filteredNodes;\n    },\n    getElements: function(options)\n    {\n        var nodes = this.getNodes({ textnodes: false });\n        var block = this.getBlock();\n        nodes = (nodes.length === 0 && block) ? [block] : nodes;\n\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            if (!this._isInNodesArray(filteredNodes, nodes[i]))\n            {\n                filteredNodes.push(nodes[i]);\n            }\n        }\n\n        // filter\n        filteredNodes = (options && options.tags) ? this._filterNodesByTags(filteredNodes, options.tags) : filteredNodes;\n\n        return filteredNodes;\n    },\n    getNodes: function(options)\n    {\n        var nodes = [];\n        var activeComponent = this.component.getActive();\n        if (activeComponent)\n        {\n            nodes = this._getNodesComponent(activeComponent);\n        }\n        else if (this.isCollapsed())\n        {\n            var current = this.getCurrent();\n            nodes = (current) ? [current] : [];\n        }\n        else if (this.is() && !activeComponent)\n        {\n            nodes = this._getRangeSelectedNodes();\n        }\n\n        // filter\n        nodes = this._filterServicesNodes(nodes);\n        nodes = this._filterEditor(nodes);\n\n        // options\n        nodes = (options && options.tags) ? this._filterNodesByTags(nodes, options.tags) : nodes;\n        nodes = (options && options.textnodes) ? this._filterNodesTexts(nodes, options) : nodes;\n        nodes = (options && !options.textnodes) ? this._filterNodesElements(nodes) : nodes;\n\n        return nodes;\n    },\n\n    // text & html\n    getText: function()\n    {\n        var sel = this.get();\n        return (sel) ? this.utils.removeInvisibleChars(sel.toString()) : '';\n    },\n    getHtml: function(clean)\n    {\n        var html = '';\n        var sel = this.get();\n        if (sel)\n        {\n            var container = document.createElement('div');\n            var len = sel.rangeCount;\n            for (var i = 0; i < len; ++i)\n            {\n                container.appendChild(sel.getRangeAt(i).cloneContents());\n            }\n\n            html = container.innerHTML;\n            html = (clean !== false) ? this.cleaner.output(html) : html;\n            html = html.replace(/<p><\\/p>$/i, '');\n        }\n\n        return html;\n    },\n\n    // clear\n    clear: function()\n    {\n        this.component.clearActive();\n        this.get().removeAllRanges();\n    },\n\n    // collapse\n    collapseToStart: function()\n    {\n        var sel = this.get();\n        if (sel && !sel.isCollapsed) sel.collapseToStart();\n    },\n    collapseToEnd: function()\n    {\n        var sel = this.get();\n        if (sel && !sel.isCollapsed) sel.collapseToEnd();\n    },\n\n    // save\n    saveActiveComponent: function()\n    {\n        var activeComponent = this.component.getActive();\n        if (activeComponent)\n        {\n            this.savedComponent = activeComponent;\n            return true;\n        }\n\n        return false;\n    },\n    restoreActiveComponent: function()\n    {\n        if (this.savedComponent)\n        {\n            this.component.setActive(this.savedComponent);\n            return true;\n        }\n\n        return false;\n    },\n    save: function()\n    {\n        this._clearSaved();\n\n        var el = this.getElement();\n        var tags = ['TD', 'TH', 'P', 'DIV', 'PRE', 'H1', 'H2', 'H3', 'H4', 'H5', 'H6', 'LI', 'BLOCKQUOTE'];\n        if (el && (tags.indexOf(el.tagName) !== -1) && (el.innerHTML === '' || el.innerHTML === '<br>'))\n        {\n            this.savedElement = el;\n        }\n        else if (!this.saveActiveComponent())\n        {\n            this.saved = this.offset.get();\n        }\n    },\n    restore: function()\n    {\n        if (!this.saved && !this.savedComponent && !this.savedElement) return;\n\n        this.editor.saveScroll();\n\n        if (this.savedElement)\n        {\n            this.caret.setStart(this.savedElement);\n        }\n        else if (!this.restoreActiveComponent())\n        {\n            this.offset.set(this.saved);\n        }\n\n        this._clearSaved();\n        this.editor.restoreScroll();\n    },\n    saveMarkers: function()\n    {\n        this._clearSaved();\n\n        if (!this.saveActiveComponent())\n        {\n            this.marker.insert();\n        }\n    },\n    restoreMarkers: function()\n    {\n        this.editor.saveScroll();\n\n        if (!this.restoreActiveComponent())\n        {\n            this.marker.restore();\n        }\n\n        this._clearSaved();\n        this.editor.restoreScroll();\n    },\n\n    // private\n    _getNextNode: function(node)\n    {\n        if (node.hasChildNodes()) return node.firstChild;\n\n        while (node && !node.nextSibling)\n        {\n            node = node.parentNode;\n        }\n\n        if (!node) return null;\n\n        return node.nextSibling;\n    },\n    _getNodesComponent: function(component)\n    {\n        var current = this.getCurrent();\n        var data = this.inspector.parse(current);\n\n        return (data.isFigcaption()) ? [data.getFigcaption()] : [component];\n    },\n    _getRangeSelectedNodes: function()\n    {\n        var nodes = [];\n        var range = this.getRange();\n        var node = range.startContainer;\n        var startNode = range.startContainer;\n        var endNode = range.endContainer;\n        var $editor = this.editor.getElement();\n\n        // editor\n        if (startNode === $editor.get() && this.isAll())\n        {\n            nodes = this.utils.getChildNodes($editor);\n        }\n        // single node\n        else if (node == endNode)\n        {\n            nodes = [node];\n        }\n        else\n        {\n            while (node && node != endNode)\n            {\n                nodes.push(node = this._getNextNode(node));\n            }\n\n            node = range.startContainer;\n            while (node && node != range.commonAncestorContainer)\n            {\n                nodes.unshift(node);\n                node = node.parentNode;\n            }\n        }\n\n        return nodes;\n    },\n    _isInNodesArray: function(nodes, node)\n    {\n        return (nodes.indexOf(node) !== -1);\n    },\n    _filterEditor: function(nodes)\n    {\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var data = this.inspector.parse(nodes[i]);\n            if (data.isInEditor())\n            {\n                filteredNodes.push(nodes[i]);\n            }\n        }\n\n        return filteredNodes;\n    },\n    _filterServicesNodes: function(nodes)\n    {\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var $el = $R.dom(nodes[i]);\n            var skip = false;\n\n            if (nodes[i] && nodes[i].nodeType === 3 && this.utils.isEmpty(nodes[i])) skip = true;\n            if ($el.hasClass('redactor-script-tag')\n                || $el.hasClass('redactor-component-caret')\n                || $el.hasClass('redactor-selection-marker')\n                || $el.hasClass('non-editable')) skip = true;\n\n            if (!skip)\n            {\n                filteredNodes.push(nodes[i]);\n            }\n        }\n\n        return filteredNodes;\n    },\n    _filterNodesTexts: function(nodes, options)\n    {\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            if (nodes[i].nodeType === 3 || (options.keepbr && nodes[i].tagName === 'BR'))\n            {\n                var inline = this.getInline(nodes[i]);\n                var isInline = (inline && options && options.inline === false);\n                if (!isInline)\n                {\n                    filteredNodes.push(nodes[i]);\n                }\n            }\n        }\n\n        return filteredNodes;\n    },\n    _filterNodesElements: function(nodes)\n    {\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            if (nodes[i].nodeType !== 3)\n            {\n                filteredNodes.push(nodes[i]);\n            }\n        }\n\n        return filteredNodes;\n    },\n    _filterNodesByTags: function(nodes, tags, passtexts)\n    {\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            if (passtexts && nodes[i].nodeType === 3)\n            {\n                filteredNodes.push(nodes[i]);\n            }\n            else if (nodes[i].nodeType !== 3)\n            {\n                var nodeTag = nodes[i].tagName.toLowerCase();\n                if (tags.indexOf(nodeTag.toLowerCase()) !== -1)\n                {\n                    filteredNodes.push(nodes[i]);\n                }\n            }\n        }\n\n        return filteredNodes;\n    },\n    _filterBlocksFirst: function(nodes)\n    {\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var $node = $R.dom(nodes[i]);\n            var parent = $node.parent().get();\n            var isFirst = ($node.parent().hasClass('redactor-in'));\n            var isCellParent = (parent && (parent.tagName === 'TD' || parent.tagName === 'TH'));\n            if (isFirst || isCellParent)\n            {\n                filteredNodes.push(nodes[i]);\n            }\n        }\n\n        return filteredNodes;\n    },\n    _filterInlinesInside: function(nodes)\n    {\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            if (containsNode(nodes[i], true))\n            {\n                filteredNodes.push(nodes[i]);\n            }\n        }\n\n        return filteredNodes;\n    },\n    _isTextSelected: function(node, selected)\n    {\n        var text = this.utils.removeInvisibleChars(node.textContent);\n\n        return (\n            selected === text\n            || text.search(selected) !== -1\n            || selected.search(new RegExp('^' + this.utils.escapeRegExp(text))) !== -1\n            || selected.search(new RegExp(this.utils.escapeRegExp(text) + '$')) !== -1\n        );\n    },\n    _isInlineNode: function(node)\n    {\n        var data = this.inspector.parse(node);\n\n        return (this.inspector.isInlineTag(node.tagName) && data.isInEditor());\n    },\n    _clearSaved: function()\n    {\n        this.saved = false;\n        this.savedComponent = false;\n        this.savedElement = false;\n    }\n});\n$R.add('service', 'element', {\n    init: function(app)\n    {\n        this.app = app;\n        this.rootElement = app.rootElement;\n\n        // local\n        this.$element = {};\n        this.type = 'inline';\n    },\n    start: function()\n    {\n        this._build();\n        this._buildType();\n    },\n\n    // public\n    isType: function(type)\n    {\n        return (type === this.type);\n    },\n    getType: function()\n    {\n        return this.type;\n    },\n    getElement: function()\n    {\n        return this.$element;\n    },\n\n    // private\n    _build: function()\n    {\n        this.$element = $R.dom(this.rootElement);\n    },\n    _buildType: function()\n    {\n        var tag = this.$element.get().tagName;\n\n        this.type = (tag === 'TEXTAREA') ? 'textarea' : this.type;\n        this.type = (tag === 'DIV') ? 'div' : this.type;\n        this.type = (this.opts.inline) ? 'inline' : this.type;\n    }\n});\n$R.add('service', 'editor', {\n    init: function(app)\n    {\n        this.app = app;\n\n        // local\n        this.scrolltop = false;\n        this.pasting = false;\n    },\n\n    // start\n    start: function()\n    {\n        this._build();\n    },\n\n    // focus\n    focus: function()\n    {\n        if (!this.isFocus() && !this._isContenteditableFocus())\n        {\n            this.saveScroll();\n            this.$editor.focus();\n            this.restoreScroll();\n        }\n    },\n    startFocus: function()\n    {\n        this.caret.setStart(this.getFirstNode());\n    },\n    endFocus: function()\n    {\n        this.caret.setEnd(this.getLastNode());\n    },\n\n    // pasting\n    isPasting: function()\n    {\n        return this.pasting;\n    },\n    enablePasting: function()\n    {\n        this.pasting = true;\n    },\n    disablePasting: function()\n    {\n        this.pasting = false;\n    },\n\n    // scroll\n    saveScroll: function()\n    {\n        this.scrolltop = this._getScrollTarget().scrollTop();\n        if (this.opts.maxHeight) {\n            this.scrolltopin = this.$editor.scrollTop();\n        }\n\n    },\n    restoreScroll: function()\n    {\n        if (this.scrolltop !== false)\n        {\n            this._getScrollTarget().scrollTop(this.scrolltop);\n            this.scrolltop = false;\n        }\n\n        if (this.scrolltopin) {\n            this.$editor.scrollTop(this.scrolltopin);\n            this.scrolltopin = false;\n        }\n    },\n\n    // non editables\n    disableNonEditables: function()\n    {\n        this.$noneditables = this.$editor.find('[contenteditable=false]');\n        this.$noneditables.attr('contenteditable', true);\n    },\n    enableNonEditables: function()\n    {\n        if (this.$noneditables)\n        {\n            setTimeout(function() { this.$noneditables.attr('contenteditable', false); }.bind(this), 1);\n        }\n    },\n\n    // nodes\n    getFirstNode: function()\n    {\n        return this.$editor.contents()[0];\n    },\n    getLastNode: function()\n    {\n        var nodes = this.$editor.contents();\n\n        return nodes[nodes.length-1];\n    },\n\n    // utils\n    isSourceMode: function()\n    {\n        var $source = this.source.getElement();\n\n        return $source.hasClass('redactor-source-open');\n    },\n    isEditor: function(el)\n    {\n        var node = $R.dom(el).get();\n\n        return (node === this.$editor.get());\n    },\n    isEmpty: function(keeplists)\n    {\n        return this.utils.isEmptyHtml(this.$editor.html(), false, keeplists);\n    },\n    isFocus: function()\n    {\n        var $active = $R.dom(document.activeElement);\n        var isComponentSelected = (this.$editor.find('.redactor-component-active').length !== 0);\n\n        return (isComponentSelected || $active.closest('.redactor-in-' + this.uuid).length !== 0);\n    },\n    setEmpty: function()\n    {\n        this.$editor.html(this.opts.emptyHtml);\n    },\n\n    // element\n    getElement: function()\n    {\n        return this.$editor;\n    },\n\n    // private\n    _build: function()\n    {\n        var $element = this.element.getElement();\n        var editableElement = (this.element.isType('textarea')) ? '<div>' : $element.get();\n\n        this.$editor = $R.dom(editableElement);\n    },\n    _getScrollTarget: function()\n    {\n        var $target = this.$doc;\n        if (this.opts.toolbarFixedTarget !== document)\n        {\n            $target = $R.dom(this.opts.toolbarFixedTarget);\n        }\n        else\n        {\n            $target = (this.opts.scrollTarget) ? $R.dom(this.opts.scrollTarget) : $target;\n        }\n\n        return $target;\n    },\n    _isContenteditableFocus: function()\n    {\n        var block = this.selection.getBlock();\n        var $blockParent = (block) ? $R.dom(block).closest('[contenteditable=true]').not('.redactor-in') : [];\n\n        return ($blockParent.length !== 0);\n    }\n});\n$R.add('service', 'container', {\n    init: function(app)\n    {\n        this.app = app;\n    },\n    // public\n    start: function()\n    {\n        this._build();\n    },\n    getElement: function()\n    {\n        return this.$container;\n    },\n\n    // private\n    _build: function()\n    {\n        var tag = (this.element.isType('inline')) ? '<span>' : '<div>';\n        this.$container = $R.dom(tag);\n    }\n});\n$R.add('service', 'source', {\n    init: function(app)\n    {\n        this.app = app;\n\n        // local\n        this.$source = {};\n        this.content = '';\n    },\n    // public\n    start: function()\n    {\n        this._build();\n        this._buildName();\n        this._buildStartedContent();\n    },\n    getElement: function()\n    {\n        return this.$source;\n    },\n    getCode: function()\n    {\n        return this.$source.val();\n    },\n    getName: function()\n    {\n        return this.$source.attr('name');\n    },\n    getStartedContent: function()\n    {\n        return this.content;\n    },\n    setCode: function(html)\n    {\n        return this.insertion.set(html, true, false);\n    },\n    isNameGenerated: function()\n    {\n        return (this.name);\n    },\n    rebuildStartedContent: function()\n    {\n        this._buildStartedContent();\n    },\n\n    // private\n    _build: function()\n    {\n        var $element = this.element.getElement();\n        var isTextarea = this.element.isType('textarea');\n        var sourceElement = (isTextarea) ? $element.get() : '<textarea>';\n\n        this.$source = $R.dom(sourceElement);\n    },\n    _buildName: function()\n    {\n        var $element = this.element.getElement();\n\n        this.name = $element.attr('name');\n        this.$source.attr('name', (this.name) ? this.name : 'content-' + this.uuid);\n    },\n    _buildStartedContent: function()\n    {\n        var $element = this.element.getElement();\n        var content = (this.element.isType('textarea')) ? $element.val() : $element.html();\n\n        this.content = content.trim();\n    }\n});\n$R.add('service', 'statusbar', {\n    init: function(app)\n    {\n        this.app = app;\n\n        // local\n        this.$statusbar = {};\n        this.items = [];\n    },\n    // public\n    start: function()\n    {\n        this.$statusbar = $R.dom('<ul>');\n        this.$statusbar.attr('dir', this.opts.direction);\n    },\n    add: function(name, html)\n    {\n        return this.update(name, html);\n    },\n    update: function(name, html)\n    {\n        var $item;\n        if (typeof this.items[name] !== 'undefined')\n        {\n            $item = this.items[name];\n        }\n        else\n        {\n            $item = $R.dom('<li>');\n            this.$statusbar.append($item);\n            this.items[name] = $item;\n        }\n\n        return $item.html(html);\n    },\n    get: function(name)\n    {\n        return (this.items[name]) ? this.items[name] : false;\n    },\n    remove: function(name)\n    {\n        if (this.items[name])\n        {\n            this.items[name].remove();\n            delete this.items[name];\n        }\n    },\n    getItems: function()\n    {\n        return this.items;\n    },\n    removeItems: function()\n    {\n        this.items = {};\n        this.$statusbar.html('');\n    },\n    getElement: function()\n    {\n        return this.$statusbar;\n    }\n});\n$R.add('service', 'toolbar', {\n    init: function(app)\n    {\n        this.app = app;\n\n        // local\n        this.buttons = [];\n        this.dropdownOpened = false;\n        this.buttonsObservers = {};\n    },\n    // public\n    start: function()\n    {\n        if (this.is())\n        {\n            this.opts.activeButtons = (this.opts.activeButtonsAdd) ? this._extendActiveButtons() : this.opts.activeButtons;\n            this.create();\n        }\n    },\n    stopObservers: function()\n    {\n        this.buttonsObservers = {};\n    },\n    create: function()\n    {\n        this.$wrapper = $R.dom('<div>');\n        this.$toolbar = $R.dom('<div>');\n    },\n    observe: function()\n    {\n        if (!this.is()) return;\n\n        this.setButtonsInactive();\n\n        var button, observer;\n\n        // observers\n        for (var name in this.buttonsObservers)\n        {\n            observer = this.buttonsObservers[name];\n            button = this.getButton(name);\n            this.app.broadcast('button.' + observer + '.observe', button);\n        }\n\n        // inline buttons\n        var buttons = this.opts.activeButtons;\n        var inlines = this.selection.getInlinesAllSelected();\n        var current = this.selection.getInline();\n        if (this.selection.isCollapsed() && current)\n        {\n            inlines.push(current);\n        }\n\n        var tags = this._inlinesToTags(inlines);\n        for (var key in buttons)\n        {\n            if (tags.indexOf(key) !== -1)\n            {\n                button = this.getButton(buttons[key]);\n                if (button) {\n                    button.setActive();\n                }\n            }\n\n        }\n    },\n\n    // is\n    is: function()\n    {\n        return !(!this.opts.toolbar || (this.detector.isMobile() && this.opts.air));\n    },\n    isAir: function()\n    {\n        return (this.is()) ? this.$toolbar.hasClass('redactor-air') : false;\n    },\n    isFixed: function()\n    {\n        return (this.is()) ? this.$toolbar.hasClass('redactor-toolbar-fixed') : false;\n    },\n    isContextBar: function()\n    {\n        var $bar = this.$body.find('#redactor-context-toolbar-' + this.uuid);\n        return $bar.hasClass('open');\n    },\n    isTarget: function()\n    {\n        return (this.opts.toolbarFixedTarget !== document);\n    },\n\n    // get\n    getElement: function()\n    {\n        return this.$toolbar;\n    },\n    getWrapper: function()\n    {\n        return this.$wrapper;\n    },\n    getDropdown: function()\n    {\n        return this.dropdownOpened;\n    },\n    getTargetElement: function()\n    {\n        return $R.dom(this.opts.toolbarFixedTarget);\n    },\n    getButton: function(name)\n    {\n        var $btn = this._findButton('.re-' + name);\n\n        return ($btn.length !== 0) ? $btn.dataget('data-button-instance') : false;\n    },\n    getButtons: function()\n    {\n        var buttons = [];\n        this._findButtons().each(function(node)\n        {\n            var $node = $R.dom(node);\n            buttons.push($node.dataget('data-button-instance'));\n        });\n\n        return buttons;\n    },\n    getButtonsKeys: function()\n    {\n        var keys = [];\n        this._findButtons().each(function(node)\n        {\n            var $node = $R.dom(node);\n            keys.push($node.attr('data-re-name'));\n        });\n\n        return keys;\n    },\n\n    // add\n    addButton: function(name, btnObj, position, $el, start)\n    {\n        position = position || 'end';\n\n        var $button = $R.create('toolbar.button', this.app, name, btnObj);\n        if (btnObj.observe)\n        {\n            this.opts.activeButtonsObservers[name] = { observe: btnObj.observe, button: $button };\n        }\n\n        if (this.is())\n        {\n            if (position === 'first') this.$toolbar.prepend($button);\n            else if (position === 'after') $el.after($button);\n            else if (position === 'before') $el.before($button);\n            else this.$toolbar.append($button);\n        }\n\n        return $button;\n    },\n    addButtonFirst: function(name, btnObj)\n    {\n        return this.addButton(name, btnObj, 'first');\n    },\n    addButtonAfter: function(after, name, btnObj)\n    {\n        var $btn = this.getButton(after);\n\n        return ($btn) ? this.addButton(name, btnObj, 'after', $btn) : this.addButton(name, btnObj);\n    },\n    addButtonBefore: function(before, name, btnObj)\n    {\n        var $btn = this.getButton(before);\n\n        return ($btn) ? this.addButton(name, btnObj, 'before', $btn) : this.addButton(name, btnObj);\n    },\n    addButtonObserver: function(name, observer)\n    {\n        this.buttonsObservers[name] = observer;\n    },\n\n    // set\n    setButtons: function(buttons)\n    {\n        this.buttons = buttons;\n    },\n    setDropdown: function(dropdown)\n    {\n        this.dropdownOpened = dropdown;\n    },\n    setButtonsInactive: function()\n    {\n        var $buttons = this.getButtons();\n        for (var i = 0; i < $buttons.length; i++)\n        {\n            $buttons[i].setInactive();\n        }\n    },\n    setButtonsActive: function()\n    {\n        var $buttons = this.getButtons();\n        for (var i = 0; i < $buttons.length; i++)\n        {\n            $buttons[i].setActive();\n        }\n    },\n\n    // disable & enable\n    disableButtons: function()\n    {\n        var $buttons = this.getButtons();\n        for (var i = 0; i < $buttons.length; i++)\n        {\n            $buttons[i].disable();\n        }\n    },\n    enableButtons: function()\n    {\n        var $buttons = this.getButtons();\n        for (var i = 0; i < $buttons.length; i++)\n        {\n            $buttons[i].enable();\n        }\n\n    },\n\n    // private\n    _findButton: function(selector)\n    {\n        return (this.is()) ? this.$toolbar.find(selector) : $R.dom();\n    },\n    _findButtons: function()\n    {\n        return (this.is()) ? this.$toolbar.find('.re-button') : $R.dom();\n    },\n    _extendActiveButtons: function()\n    {\n        return $R.extend({}, this.opts.activeButtons, this.opts.activeButtonsAdd);\n    },\n    _inlinesToTags: function(inlines)\n    {\n        var tags = [];\n        for (var i = 0; i < inlines.length; i++)\n        {\n            tags.push(inlines[i].tagName.toLowerCase());\n        }\n\n        return tags;\n    }\n});\n$R.add('class', 'toolbar.button', {\n    mixins: ['dom'],\n    init: function(app, name, btnObj)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.lang = app.lang;\n        this.$body = app.$body;\n        this.toolbar = app.toolbar;\n        this.detector = app.detector;\n\n        // local\n        this.obj = btnObj;\n        this.name = name;\n        this.dropdown = false;\n        this.tooltip = false;\n\n        // init\n        this._init();\n    },\n    // is\n    isActive: function()\n    {\n        return this.hasClass('redactor-button-active');\n    },\n    isDisabled: function()\n    {\n        return this.hasClass('redactor-button-disabled');\n    },\n\n    // has\n    hasIcon: function()\n    {\n        return (this.obj.icon && !this.opts.buttonsTextLabeled);\n    },\n\n    // set\n    setDropdown: function(dropdown)\n    {\n        this.obj.dropdown = dropdown;\n        this.obj.message = false;\n        this.dropdown = $R.create('toolbar.dropdown', this.app, this.name, this.obj.dropdown);\n        this.attr('data-dropdown', true);\n    },\n    setMessage: function(message, args)\n    {\n        this.obj.message = message;\n        this.obj.args = args;\n        this.obj.dropdown = false;\n    },\n    setApi: function(api, args)\n    {\n        this.obj.api = api;\n        this.obj.args = args;\n        this.obj.dropdown = false;\n    },\n    setTitle: function(title)\n    {\n        this.obj.title = this.lang.parse(title);\n        this.obj.tooltip = this.obj.title;\n\n        this.attr({ 'alt': this.obj.tooltip, 'aria-label': this.obj.tooltip });\n        if (!this.attr('data-re-icon')) this.html(this.obj.title);\n    },\n    setTooltip: function(tooltip)\n    {\n        this.obj.tooltip = this.lang.parse(tooltip);\n        this.attr({ 'alt': this.obj.tooltip, 'aria-label': this.obj.tooltip });\n    },\n    setIcon: function(icon)\n    {\n        if (this.opts.buttonsTextLabeled) return;\n\n        this.obj.icon = true;\n        this.$icon = $R.dom(icon);\n\n        this.html('');\n        this.append(this.$icon);\n        this.attr('data-re-icon', true);\n        this.addClass('re-button-icon');\n        this.setTooltip(this.obj.title);\n        this._buildTooltip();\n    },\n    setActive: function()\n    {\n        this.addClass('redactor-button-active');\n    },\n    setInactive: function()\n    {\n        this.removeClass('redactor-button-active');\n    },\n\n    // hide\n    hideTooltip: function()\n    {\n        this.$body.find('.re-button-tooltip').remove();\n    },\n\n    // get\n    getDropdown: function()\n    {\n        return this.dropdown;\n    },\n\n    // enable & disable\n    disable: function()\n    {\n        this.addClass('redactor-button-disabled');\n    },\n    enable: function()\n    {\n        this.removeClass('redactor-button-disabled');\n    },\n\n    // toggle\n    toggle: function(e)\n    {\n        if (e) e.preventDefault();\n        if (this.isDisabled()) return;\n\n        if (this.obj.dropdown)\n        {\n            this.dropdown.toggle(e);\n        }\n        else if (this.obj.api)\n        {\n            // broadcast\n            this.app.api(this.obj.api, this.obj.args, this.name);\n        }\n        else if (this.obj.message)\n        {\n            // broadcast\n            this.app.broadcast(this.obj.message, this.obj.args, this.name);\n        }\n\n        this.hideTooltip();\n    },\n\n    // private\n    _init: function()\n    {\n        // parse\n        this._parseTitle();\n        this._parseTooltip();\n\n        // build\n        this._build();\n        this._buildCallback();\n        this._buildAttributes();\n        this._buildObserver();\n\n        if (this.hasIcon())\n        {\n            this._buildIcon();\n            this._buildTooltip();\n        }\n        else\n        {\n            this.html(this.obj.title);\n        }\n    },\n    _parseTooltip: function()\n    {\n        this.obj.tooltip = (this.obj.tooltip) ? this.lang.parse(this.obj.tooltip) : this.obj.title;\n    },\n    _parseTitle: function()\n    {\n        this.obj.title = this.lang.parse(this.obj.title);\n    },\n    _build: function()\n    {\n        this.parse('<a>');\n        this.addClass('re-button re-' + this.name);\n        this.attr('data-re-name', this.name);\n        this.dataset('data-button-instance', this);\n\n        if (this.obj.dropdown) this.setDropdown(this.obj.dropdown);\n    },\n    _buildCallback: function()\n    {\n        this.on('click', this.toggle.bind(this));\n    },\n    _buildAttributes: function()\n    {\n        var attrs = {\n            'href': '#',\n            'alt': this.obj.tooltip,\n            'rel': this.name,\n            'role': 'button',\n            'aria-label': this.obj.tooltip,\n            'tabindex': '-1'\n        };\n\n        this.attr(attrs);\n    },\n    _buildObserver: function()\n    {\n        if (typeof this.obj.observe !== 'undefined')\n        {\n            this.toolbar.addButtonObserver(this.name, this.obj.observe);\n        }\n    },\n    _buildIcon: function()\n    {\n        var icon = this.obj.icon;\n        var isHtml = (/(<([^>]+)>)/ig.test(icon));\n\n        this.$icon = (isHtml) ? $R.dom(icon) : $R.dom('<i>');\n        if (!isHtml) this.$icon.addClass('re-icon-' + this.name);\n\n        this.append(this.$icon);\n        this.attr('data-re-icon', true);\n        this.addClass('re-button-icon');\n    },\n    _buildTooltip: function()\n    {\n        if (this.detector.isDesktop())\n        {\n            this.tooltip = $R.create('toolbar.button.tooltip', this.app, this);\n        }\n    }\n});\n$R.add('class', 'toolbar.button.tooltip', {\n    mixins: ['dom'],\n    init: function(app, $button)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.opts = app.opts;\n        this.$body = app.$body;\n        this.toolbar = app.toolbar;\n\n        // local\n        this.$button = $button;\n        this.created = false;\n\n        // init\n        this._init();\n    },\n    open: function()\n    {\n        if (this.$button.hasClass('redactor-button-disabled') || this.$button.hasClass('redactor-button-active')) return;\n\n        this.created = true;\n        this.parse('<span>');\n        this.addClass('re-button-tooltip re-button-tooltip-' + this.uuid);\n        this.$body.append(this);\n        this.html(this.$button.attr('alt'));\n\n        var offset = this.$button.offset();\n        var position = 'absolute';\n        var height = this.$button.height();\n        var width = this.$button.width();\n        var arrowOffset = 4;\n\n        this.css({\n            top: (offset.top + height + arrowOffset) + 'px',\n            left: (offset.left + width/2 - this.width()/2) + 'px',\n            position: position\n        });\n\n        this.show();\n    },\n    close: function()\n    {\n        if (!this.created || this.$button.hasClass('redactor-button-disabled')) return;\n\n        this.remove();\n        this.created = false;\n    },\n\n    // private\n    _init: function()\n    {\n        this.$button.on('mouseover', this.open.bind(this));\n        this.$button.on('mouseout', this.close.bind(this));\n    }\n});\n$R.add('class', 'toolbar.dropdown', {\n    mixins: ['dom'],\n    init: function(app, name, items)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.opts = app.opts;\n        this.$win = app.$win;\n        this.$doc = app.$doc;\n        this.$body = app.$body;\n        this.animate = app.animate;\n        this.toolbar = app.toolbar;\n\n        // local\n        this.name = name;\n        this.started = false;\n        this.items = (name === 'format') ? $R.extend({}, true, items) : items;\n        this.$items = [];\n    },\n    // public\n    toggle: function(e)\n    {\n        if (!this.started)\n        {\n            this._build();\n        }\n\n        // toggle\n        if (this.isOpened() && this.isActive())\n        {\n            this.close(false);\n        }\n        else\n        {\n            this.open(e);\n        }\n    },\n    isOpened: function()\n    {\n        var $dropdown = this.$body.find('.redactor-dropdown-' + this.uuid + '.open');\n\n        return ($dropdown.length !== 0 && $dropdown.attr('data-re-name') === this.name);\n    },\n    isActive: function()\n    {\n        var $dropdown = this.$body.find('#redactor-dropdown-' + this.uuid + '-' + this.name + '.open');\n        return ($dropdown.length !== 0);\n    },\n    getName: function()\n    {\n        return this.attr('data-re-name');\n    },\n    getItem: function(name)\n    {\n        return this.$items[name];\n    },\n    getItemsByClass: function(classname)\n    {\n        var result = [];\n        for (var key in this.$items) {\n            var item = this.$items[key];\n            if (typeof item === 'object' && item.attr('data-re-name') && item.hasClass(classname)) {\n                result.push(item);\n            }\n        }\n\n        return result;\n    },\n    open: function(e)\n    {\n        this._closeAll();\n\n        this.$btn = this.toolbar.getButton(this.name);\n        this.app.broadcast('dropdown.open', e, this, this.$btn);\n        this.toolbar.setDropdown(this);\n\n        this.show();\n        this.removeClass('redactor-animate-hide');\n        this.addClass('open');\n        this._observe();\n\n        this.$btn.hideTooltip();\n        this.$btn.setActive();\n\n        this.$doc.on('keyup.redactor.dropdown-' + this.uuid, this._handleKeyboard.bind(this));\n        this.$doc.on('click.redactor.dropdown-' + this.uuid, this.close.bind(this));\n\n        this.updatePosition();\n        this.app.broadcast('dropdown.opened', e, this, this.$btn);\n\n    },\n    close: function(e, animate)\n    {\n        if (e)\n        {\n            var $el = $R.dom(e.target);\n            if (this._isButton(e) || $el.hasClass('redactor-dropdown-not-close') || $el.hasClass('redactor-dropdown-item-disabled'))\n            {\n                e.preventDefault();\n                return;\n            }\n        }\n\n        this.app.broadcast('dropdown.close', this, this.$btn);\n        this.toolbar.setDropdown(false);\n\n        this.$btn.setInactive();\n        if (animate === false)\n        {\n            this._close();\n        }\n        else\n        {\n            this.animate.start(this, 'fadeOut', this._close.bind(this));\n        }\n    },\n    updatePosition: function()\n    {\n        var isFixed = this.toolbar.isFixed();\n        var isTarget = this.toolbar.isTarget();\n\n        var btnHeight = this.$btn.height();\n        var btnWidth = this.$btn.width();\n\n        var pos = this.$btn.offset();\n        var position = 'absolute';\n        var topOffset = 2;\n\n        if (isFixed) {\n            pos.top = (isTarget) ? this.$btn.offset().top : this.$btn.position().top;\n            position = 'fixed';\n            topOffset = topOffset + this.opts.toolbarFixedTopOffset;\n        }\n\n\n        var leftOffset = 0;\n        var left = (pos.left + leftOffset);\n        var width = parseFloat(this.css('width'));\n        var winWidth = this.$win.width();\n        var leftFix = (winWidth < (left + width)) ? (width - btnWidth) : 0;\n        var leftPos = (left - leftFix);\n        var top = (pos.top + btnHeight + topOffset);\n        leftPos = (leftPos < 0) ? 4 : leftPos;\n\n        this.css({\n            maxHeight: '',\n            position: position,\n            top: top + 'px',\n            left: leftPos + 'px'\n        });\n\n        // height adaptive\n        var heightTolerance = 10;\n        var winHeight = this.$win.height();\n        var scrollTop = this.$doc.scrollTop();\n        var cropHeight = winHeight - (top - scrollTop) - heightTolerance;\n\n        this.css('max-height', cropHeight + 'px');\n    },\n\n    // private\n    _build: function()\n    {\n        this.parse('<div>');\n        this.attr('dir', this.opts.direction);\n        this.attr('id', 'redactor-dropdown-' + this.uuid + '-' + this.name);\n        this.attr('data-re-name', this.name);\n\n        this.addClass('redactor-dropdown redactor-dropdown-' + this.uuid + ' redactor-dropdown-' + this.name);\n        this.dataset('data-dropdown-instance', this);\n        var isDom = (this.items.sdom || typeof this.items === 'string');\n\n        if (isDom) this._buildDom();\n        else this._buildItems();\n\n        this.$body.append(this);\n        this.started = true;\n    },\n    _buildDom: function()\n    {\n        this.html('').append($R.dom(this.items));\n    },\n    _buildItems: function()\n    {\n        this.items = (this.name === 'format') ? this._buildFormattingItems() : this.items;\n\n        for (var key in this.items)\n        {\n            var obj = this.items[key];\n\n            if (key === 'observe')\n            {\n                this.attr('data-observe', this.items[key]);\n            }\n            else\n            {\n                var $item = $R.create('toolbar.dropdown.item', this.app, key, obj, this);\n\n                this.$items[key] = $item;\n                this.append($item);\n            }\n        }\n    },\n    _buildFormattingItems: function()\n    {\n        // build the format set\n        for (var key in this.items)\n        {\n            if (this.opts.formatting.indexOf(key) === -1) delete this.items[key];\n        }\n\n        // remove from the format set\n        if (this.opts.formattingHide)\n        {\n            for (var key in this.items)\n            {\n                if (this.opts.formattingHide.indexOf(key) !== -1) delete this.items[key];\n            }\n        }\n\n        // add to the format set\n        if (this.opts.formattingAdd)\n        {\n            for (var key in this.opts.formattingAdd)\n            {\n                this.items[key] = this.opts.formattingAdd[key];\n            }\n        }\n\n        return this.items;\n    },\n    _handleKeyboard: function(e)\n    {\n        if (e.which === 27) this.close();\n    },\n    _isButton: function(e)\n    {\n        var $el = $R.dom(e.target);\n        var $btn = $el.closest('.re-button');\n\n        return ($btn.get() === this.$btn.get());\n    },\n    _close: function()\n    {\n        this.$btn.setInactive();\n        this.$doc.off('.redactor.dropdown-' + this.uuid);\n        this.removeClass('open');\n        this.addClass('redactor-animate-hide');\n        this.app.broadcast('dropdown.closed', this, this.$btn);\n    },\n    _closeAll: function()\n    {\n        this.$body.find('.redactor-dropdown-' + this.uuid + '.open').each(function(node)\n        {\n            var $node = $R.dom(node);\n            var instance =  $node.dataget('data-dropdown-instance');\n            instance._close();\n        });\n    },\n    _observe: function()\n    {\n        var observer = this.attr('data-observe');\n        if (observer)\n        {\n            this.app.broadcast('dropdown.' + observer + '.observe', this);\n        }\n    }\n});\n$R.add('class', 'toolbar.dropdown.item', {\n    mixins: ['dom'],\n    init: function(app, name, obj, dropdown)\n    {\n        this.app = app;\n        this.lang = app.lang;\n\n        // local\n        this.dropdown = dropdown;\n        this.name = name;\n        this.obj = obj;\n\n        // init\n        this._init();\n    },\n    setTitle: function(html)\n    {\n        this.$span.html(html);\n    },\n    getTitle: function()\n    {\n        return this.$span.html();\n    },\n    enable: function()\n    {\n        this.removeClass('redactor-dropdown-item-disabled');\n    },\n    disable: function()\n    {\n        this.addClass('redactor-dropdown-item-disabled');\n    },\n    toggle: function(e)\n    {\n        if (e) e.preventDefault();\n        if (this.hasClass('redactor-dropdown-item-disabled')) return;\n\n        if (this.obj.message)\n        {\n            // broadcast\n            this.app.broadcast(this.obj.message, this.obj.args, this.name);\n        }\n        else if (this.obj.api)\n        {\n            this.app.api(this.obj.api, this.obj.args, this.name);\n        }\n    },\n\n    // private\n    _init: function()\n    {\n        this.parse('<a>');\n        this.attr('href', '#');\n        this.addClass('redactor-dropdown-item-' + this.name);\n\n        if (this.obj.classname)\n        {\n            this.addClass(this.obj.classname);\n        }\n\n        this.attr('data-re-name', this.name);\n        this.on('click', this.toggle.bind(this));\n\n        this.$span = $R.dom('<span>');\n        this.append(this.$span);\n        this.setTitle(this.lang.parse(this.obj.title));\n    }\n});\n$R.add('service', 'cleaner', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n\n        // local\n        this.storedComponents = [];\n        this.storedComments = [];\n        this.storedImages = [];\n        this.storedLinks = [];\n        this.deniedTags = ['font', 'html', 'head', 'link', 'title', 'body', 'meta', 'applet'];\n        this.convertRules = {};\n        this.unconvertRules = {};\n\n        // regex\n        this.reComments = /<!--[\\s\\S]*?-->\\n?/g;\n        this.reSpacedEmpty = /^(||\\s||<br\\s?\\/?>||&nbsp;)$/i;\n        this.reScriptTag = /<script(.*?[^>]?)>([\\w\\W]*?)<\\/script>/gi;\n    },\n    // public\n    addConvertRules: function(name, func)\n    {\n        this.convertRules[name] = func;\n    },\n    addUnconvertRules: function(name, func)\n    {\n        this.unconvertRules[name] = func;\n    },\n    input: function(html, paragraphize, started)\n    {\n        // store\n        var storedComments = [];\n        html = this.storeComments(html, storedComments);\n\n        // pre/code\n        html = this.encodeCode(html);\n\n        // sanitize\n        var $wrapper = this.utils.buildWrapper(html);\n        $wrapper.find('img, svg, details').removeAttr('onload onerror ontoggle');\n        var imageattrs = ['alt', 'title', 'src', 'class', 'width', 'height', 'srcset', 'style', 'usemap'];\n        $wrapper.find('img').each(function(node) {\n            if (node.attributes.length > 0) {\n                var attrs = node.attributes;\n                for (var i = attrs.length - 1; i >= 0; i--) {\n                    if (attrs[i].name.search(/^data\\-/) === -1 && imageattrs.indexOf(attrs[i].name) === -1) {\n                        node.removeAttribute(attrs[i].name);\n                    }\n                }\n            }\n        });\n\n        // get wrapper html\n        html = this.utils.getWrapperHtml($wrapper);\n\n        // converting entity\n        html = html.replace(/\\$/g, '&#36;');\n        html = html.replace(/&amp;/g, '&');\n\n        // convert to figure\n        var converter = $R.create('cleaner.figure', this.app);\n        html = converter.convert(html, this.convertRules);\n\n        // store components\n        html = this.storeComponents(html);\n\n        // clean\n        html = this.replaceTags(html, this.opts.replaceTags);\n        html = this._setSpanAttr(html);\n        html = this._setStyleCache(html);\n        html = this.removeTags(html, this.deniedTags);\n        html = (this.opts.removeScript) ? this._removeScriptTag(html) : this._replaceScriptTag(html);\n        //html = (this.opts.removeScript) ? this._removeScriptTag(html) : html;\n        html = (this.opts.removeComments) ? this.removeComments(html) : html;\n        html = (this._isSpacedEmpty(html)) ? this.opts.emptyHtml : html;\n\n        // restore components\n        html = this.restoreComponents(html);\n\n        // clear wrapped components\n        html = this._cleanWrapped(html);\n\n        // restore comments\n        html = this.restoreComments(html, storedComments);\n\n        // paragraphize\n        html = (paragraphize) ? this.paragraphize(html) : html;\n\n        return html;\n    },\n    output: function(html, removeMarkers)\n    {\n        html = this.removeInvisibleSpaces(html);\n\n        if (this.opts.breakline) {\n            html = html.replace(/<\\/(span|strong|b|i|em)><br\\s?\\/?><\\/div>/gi, \"</$1></div>\");\n            html = html.replace(/<br\\s?\\/?><\\/(span|strong|b|i|em)><\\/div>/gi, \"</$1></div>\");\n        }\n\n        html = html.replace(/&#36;/g, '$');\n\n        // empty\n        if (this._isSpacedEmpty(html)) return '';\n        if (this._isParagraphEmpty(html)) return '';\n\n        html = this.removeServiceTagsAndAttrs(html, removeMarkers);\n\n        // store components\n        html = this.storeComponents(html);\n\n        html = this.removeSpanWithoutAttributes(html);\n        html = this.removeFirstBlockBreaklineInHtml(html);\n\n        html = (this.opts.removeScript) ? html : this._unreplaceScriptTag(html);\n        html = (this.opts.preClass) ? this._setPreClass(html) : html;\n        html = (this.opts.linkNofollow) ? this._setLinkNofollow(html) : html;\n        html = (this.opts.removeNewLines) ? this.cleanNewLines(html) : html;\n\n        // restore components\n        html = this.restoreComponents(html);\n\n        // convert to figure\n        var converter = $R.create('cleaner.figure', this.app);\n        html = converter.unconvert(html, this.unconvertRules);\n\n        // final clean up\n        html = this.removeEmptyAttributes(html, ['style', 'class', 'rel', 'alt', 'title']);\n        html = this.cleanSpacesInPre(html);\n        html = this.tidy(html);\n\n        // converting entity\n        html = html.replace(/&amp;/g, '&');\n\n        // breakline tidy\n        if (this.opts.breakline) {\n            html = html.replace(/<br\\s?\\/?>/gi, \"<br>\\n\");\n            html = html.replace(/<br\\s?\\/?>\\n+/gi, \"<br>\\n\");\n        }\n\n        // check whitespaces\n        html = (html.replace(/\\n/g, '') === '') ? '' : html;\n\n        return html;\n    },\n    paste: function(html)\n    {\n        // store components\n        html = this.storeComponents(html);\n\n        // remove tags\n        var deniedTags = this.deniedTags.concat(['iframe']);\n        html = this.removeTags(html, deniedTags);\n\n        // remove doctype tag\n        html = html.replace(new RegExp(\"<\\!doctype([\\\\s\\\\S]+?)>\", 'gi'), '');\n\n        // remove style tag\n        html = html.replace(new RegExp(\"<style([\\\\s\\\\S]+?)</style>\", 'gi'), '');\n\n        // remove br between\n        html = html.replace(new RegExp(\"</p><br /><p\", 'gi'), '</p><p');\n\n        // gdocs & word\n        var isMsWord = this._isHtmlMsWord(html);\n\n        html = this._cleanGDocs(html);\n        html = (isMsWord) ? this._cleanMsWord(html) : html;\n\n        // do not clean\n        if (!this.opts.pasteClean)\n        {\n            // restore components\n            html = this.restoreComponents(html);\n\n            return html;\n        }\n\n        // plain text\n        if (this.opts.pastePlainText)\n        {\n            // restore components\n            html = this.restoreComponents(html);\n\n            return this.pastePlainText(html);\n        }\n\n        // unconvert data redactor tag\n        var $wrapper = this.utils.buildWrapper(html);\n        $wrapper.find('*').removeAttr('style');\n        $wrapper.find('[data-redactor-tag]').each(function(node) {\n            var $node = $R.dom(node);\n            $node.removeAttr('data-redactor-tag');\n\n            if (this.utils.isEmptyHtml($node.html())) {\n                $node.html('<br>').unwrap();\n            }\n            else if (node.lastChild && node.lastChild.tagName === 'BR') {\n                $node.unwrap();\n            }\n            else {\n                $node.append('<br>').unwrap();\n            }\n        }.bind(this));\n        html = this.utils.getWrapperHtml($wrapper);\n        html = html.replace(/<br\\s?\\/?>$/, '');\n        html = html.replace(/<br\\s?\\/?><\\/(td|th)>/, '</$1>');\n\n        // remove tags\n        var exceptedTags = this.opts.pasteBlockTags.concat(this.opts.pasteInlineTags);\n        html = this.removeTagsExcept(html, exceptedTags);\n\n        // links & images\n        html = (this.opts.pasteLinks) ? html : this.removeTags(html, ['a']);\n        html = (this.opts.pasteImages) ? html : this.removeTags(html, ['img']);\n\n        // build wrapper\n        var $wrapper = this.utils.buildWrapper(html);\n\n        // clean attrs\n        var $elms = $wrapper.find('*');\n\n        // remove style\n        var filterStyle = (this.opts.pasteKeepStyle.length !== 0) ? ',' + this.opts.pasteKeepStyle.join(',') : '';\n        $elms.not('[data-redactor-style-cache]' + filterStyle).removeAttr('style');\n\n        // remove class\n        var filterClass = (this.opts.pasteKeepClass.length !== 0) ? ',' + this.opts.pasteKeepClass.join(',') : '';\n        $elms.not('[data-redactor-style-cache], span.redactor-component' + filterClass).removeAttr('class');\n\n        // remove attrs\n        var filterAttrs = (this.opts.pasteKeepAttrs.length !== 0) ? ',' + this.opts.pasteKeepAttrs.join(',') : '';\n        $elms.not('img, a, span.redactor-component, [data-redactor-style-cache]' + filterAttrs).each(function(node)\n        {\n            var attrs = node.attributes;\n            for (var i = attrs.length - 1; i >= 0; i--) {\n                if (node.attributes[0].name !== 'class') {\n                    node.removeAttribute(attrs[i].name);\n                }\n            }\n        });\n\n        // paste link target\n        if (this.opts.pasteLinks && this.opts.pasteLinkTarget !== false)\n        {\n            $wrapper.find('a').attr('target', this.opts.pasteLinkTarget);\n        }\n\n        // keep style\n        $wrapper.find('[data-redactor-style-cache]').each(function(node)\n        {\n            var style = node.getAttribute('data-redactor-style-cache');\n            node.setAttribute('style', style);\n        });\n\n        // remove image attributes\n        var imageattrs = this.opts.imageAttrs;\n        $wrapper.find('img').each(function(node) {\n            if (node.attributes.length > 0) {\n                var attrs = node.attributes;\n                for (var i = attrs.length - 1; i >= 0; i--) {\n                    if (imageattrs.indexOf(attrs[i].name) === -1) {\n                        node.removeAttribute(attrs[i].name);\n                    }\n                }\n            }\n        });\n\n        // remove empty span\n        $wrapper.find('span').each(function(node)\n        {\n            if (node.attributes.length === 0)\n            {\n                $R.dom(node).unwrap();\n            }\n        });\n\n        // remove empty inline\n        $wrapper.find(this.opts.inlineTags.join(',')).each(function(node)\n        {\n            if (node.attributes.length === 0 && this.utils.isEmptyHtml(node.innerHTML))\n            {\n                $R.dom(node).unwrap();\n            }\n\n        }.bind(this));\n\n        // place ul/ol into li\n        $wrapper.find('ul, ol').each(function(node)\n        {\n            var prev = node.previousSibling;\n            if (prev && prev.tagName === 'LI')\n            {\n                var $li = $R.dom(prev);\n                $li.find('p').unwrap();\n                $li.append(node);\n            }\n        });\n\n        // get wrapper\n        html = this.utils.getWrapperHtml($wrapper);\n\n        // remove paragraphs form lists (google docs bug)\n        html = html.replace(/<li><p>/gi, '<li>');\n        html = html.replace(/<\\/p><\\/li>/gi, '</li>');\n\n        // gmail list paste\n        html = html.replace(/^<li/gi, '<ul><li');\n        html = html.replace(/<\\/li>$/gi, '</li></ul>');\n\n        // convert lines to br\n        if (this.opts.breakline) {\n            html = html.replace(/\\n/g, '<br>');\n        }\n\n        // clean empty p\n        html = html.replace(/<p>&nbsp;<\\/p>/gi, '<p></p>');\n        html = html.replace(/<p><br\\s?\\/?><\\/p>/gi, '<p></p>');\n\n        if (isMsWord)\n        {\n            html = html.replace(/<p><\\/p>/gi, '');\n            html = html.replace(/<p>\\s<\\/p>/gi, '');\n        }\n\n        // restore components\n        html = this.restoreComponents(html);\n\n        return html;\n    },\n    pastePlainText: function(html)\n    {\n        html = (this.opts.pasteLinks) ? this.storeLinks(html) : html;\n        html = (this.opts.pasteImages) ? this.storeImages(html) : html;\n\n        html = this.getPlainText(html);\n        html = this._replaceNlToBr(html);\n\n        html = (this.opts.pasteLinks) ? this.restoreLinks(html) : html;\n        html = (this.opts.pasteImages) ? this.restoreImages(html) : html;\n\n        return html;\n    },\n    tidy: function(html)\n    {\n        return html;\n    },\n    paragraphize: function(html)\n    {\n        var paragraphize = $R.create('cleaner.paragraphize', this.app);\n        html = paragraphize.convert(html);\n        return html;\n    },\n    storeComments: function(html, storedComments) {\n        var comments = html.match(new RegExp('<!--([\\\\w\\\\W]*?)-->', 'gi'));\n        if (comments !== null) {\n            for (var i = 0; i < comments.length; i++) {\n                html = html.replace(comments[i], '#####xstarthtmlcommentzz' + i + 'xendhtmlcommentzz#####');\n                storedComments.push(comments[i]);\n            }\n        }\n\n        return html;\n    },\n    restoreComments: function(html, storedComments) {\n        for (var i = 0; i < storedComments.length; i++) {\n            html = html.replace('#####xstarthtmlcommentzz' + i + 'xendhtmlcommentzz#####', storedComments[i]);\n        }\n\n        return html;\n    },\n\n    // get\n    getFlatText: function(html)\n    {\n        var $div = $R.dom('<div>');\n\n        if (!html.nodeType && !html.dom)\n        {\n            html = html.toString();\n            html = html.trim();\n            $div.html(html);\n        }\n        else\n        {\n            $div.append(html);\n        }\n\n        html = $div.get().textContent || $div.get().innerText || '';\n\n        return (html === undefined) ? '' : html;\n    },\n\tgetPlainText: function(html)\n\t{\n\t\thtml = html.replace(/<!--[\\s\\S]*?-->/gi, '');\n\t\thtml = html.replace(/<style[\\s\\S]*?style>/gi, '');\n        html = html.replace(/<p><\\/p>/g, '');\n\t\thtml = html.replace(/<\\/div>|<\\/li>|<\\/td>/gi, '\\n');\n\t\thtml = html.replace(/<\\/p>/gi, '\\n\\n');\n\t\thtml = html.replace(/<\\/H[1-6]>/gi, '\\n\\n');\n\n\t\tvar tmp = document.createElement('div');\n\t\ttmp.innerHTML = html;\n\n\t\thtml = tmp.textContent || tmp.innerText;\n\n\t\treturn html.trim();\n\t},\n\n    // replace\n    replaceTags: function(html, tags)\n    {\n        if (tags)\n        {\n            var self = this;\n            var keys = Object.keys(tags);\n            var $wrapper = this.utils.buildWrapper(html);\n            $wrapper.find(keys.join(',')).each(function(node)\n            {\n                self.utils.replaceToTag(node, tags[node.tagName.toLowerCase()]);\n            });\n\n            html = this.utils.getWrapperHtml($wrapper);\n        }\n\n        return html;\n    },\n    replaceNbspToSpaces: function(html)\n    {\n        return html.replace('&nbsp;', ' ');\n    },\n    replaceBlocksToBr: function(html)\n    {\n        html = html.replace(/<\\/div>|<\\/li>|<\\/td>|<\\/p>|<\\/H[1-6]>/gi, '<br>');\n\n        return html;\n    },\n\n    // clean\n    cleanNewLines: function(html)\n    {\n        return html.replace(/\\r?\\n/g, \"\");\n    },\n    cleanSpacesInPre: function(html)\n    {\n        return html.replace('&nbsp;&nbsp;&nbsp;&nbsp;', '    ');\n    },\n\n    // remove\n    removeInvisibleSpaces: function(html)\n    {\n        html = this.utils.removeInvisibleChars(html);\n        html = html.replace(/&#65279;/gi, '');\n\n        return html;\n    },\n    removeNl: function(html)\n    {\n        html = html.replace(/\\n/g, \" \");\n        html = html.replace(/\\s+/g, \"\\s\");\n\n        return html;\n    },\n    removeBrAtEnd: function(html)\n    {\n        html = html.replace(/<br\\s?\\/?>$/gi, ' ');\n        html = html.replace(/<br\\s?\\/?><li/gi, '<li');\n\n        return html;\n    },\n    removeTags: function(input, denied)\n    {\n        var re = (denied) ? /<\\/?([a-z][a-z0-9]*)\\b[^>]*>/gi : /(<([^>]+)>)/gi;\n        var replacer = (!denied) ? '' : function ($0, $1)\n        {\n            return denied.indexOf($1.toLowerCase()) === -1 ? $0 : '';\n        };\n\n        return input.replace(re, replacer);\n    },\n    removeTagsExcept: function(input, except)\n    {\n        if (except === undefined) return input.replace(/(<([^>]+)>)/gi, '');\n\n        var tags = /<\\/?([a-z][a-z0-9]*)\\b[^>]*>/gi;\n        return input.replace(tags, function($0, $1)\n        {\n            return except.indexOf($1.toLowerCase()) === -1 ? '' : $0;\n        });\n    },\n    removeComments: function(html)\n    {\n        return html.replace(this.reComments, '');\n    },\n    removeServiceTagsAndAttrs: function(html, removeMarkers)\n    {\n        var $wrapper = this.utils.buildWrapper(html);\n        var self = this;\n        if (removeMarkers !== false)\n        {\n            $wrapper.find('.redactor-selection-marker').each(function(node)\n            {\n                var $el = $R.dom(node);\n                var text = self.utils.removeInvisibleChars($el.text());\n\n                return (text === '') ? $el.remove() : $el.unwrap();\n            });\n        }\n\n        $wrapper.find('[data-redactor-style-cache]').removeAttr('data-redactor-style-cache');\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n    removeSpanWithoutAttributes: function(html)\n    {\n        var $wrapper = this.utils.buildWrapper(html);\n        $wrapper.find('span').removeAttr('data-redactor-span data-redactor-style-cache').each(function(node)\n        {\n            if (node.attributes.length === 0) $R.dom(node).unwrap();\n        });\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n    removeFirstBlockBreaklineInHtml: function(html)\n    {\n        return html.replace(new RegExp('</li><br\\\\s?/?>', 'gi'), '</li>');\n    },\n    removeEmptyAttributes: function(html, attrs)\n    {\n        var $wrapper = this.utils.buildWrapper(html);\n        for (var i = 0; i < attrs.length; i++)\n        {\n            $wrapper.find('[' + attrs[i] + '=\"\"]').removeAttr(attrs[i]);\n        }\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n\n    // encode / decode\n    encodeHtml: function(html)\n    {\n        html = html.replace(/<br\\s?\\/?>/g, \"\\n\");\n        html = html.replace(/&nbsp;/g, ' ');\n        html = html.replace(//g, '\"');\n        html = html.replace(//g, '\"');\n        html = html.replace(//g, '\\'');\n        html = html.replace(//g, '\\'');\n        html = this.encodeEntities(html);\n        html = html.replace(/\\$/g, '&#36;');\n\n        if (this.opts.preSpaces)\n        {\n            html = html.replace(/\\t/g, new Array(this.opts.preSpaces + 1).join(' '));\n        }\n\n        return html;\n    },\n\n    encodeCode: function(html) {\n        // replace all tags\n        html = html.replace(/<(.*?)>/gi, 'xtagstartz$1xtagendz');\n\n        // revert pre / code\n        html = html.replace(/xtagstartzpre(.*?)xtagendz/g, '<pre$1>');\n        html = html.replace(/xtagstartzcode(.*?)xtagendz/g, '<code$1>');\n        html = html.replace(/xtagstartz\\/codextagendz/g, '</code>');\n        html = html.replace(/xtagstartz\\/prextagendz/g, '</pre>');\n\n        // encode\n        html = this._encodeCode(html);\n\n        // revert all tags\n        html = html.replace(/xtagstartz(.*?)xtagendz/g, '<$1>');\n        html = html.replace(/xtagstartz\\/(.*?)xtagendz/g, '</$1>');\n\n        return html;\n    },\n    _encodeCode: function(html) {\n        var $wrapper = this.utils.buildWrapper(html);\n        $wrapper.find('pre code, pre, code').each(this._encodeNode.bind(this));\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n    _encodeNode: function(node) {\n        var first = node.firstChild;\n        var html = node.innerHTML;\n        if (node.tagName === 'PRE' && first && first.tagName === 'CODE') {\n            return;\n        }\n\n        html = html.replace(/xtagstartz/g, '<');\n        html = html.replace(/xtagendz/g, '>');\n\n        var encoded = this.decodeEntities(html);\n        node.textContent = this._encodeNodeHtml(encoded);\n    },\n    _encodeNodeHtml: function(html) {\n        html = html.replace(/&nbsp;/g, ' ').replace(/<br\\s?\\/?>/g, '\\n');\n        html = (this.opts.preSpaces) ? html.replace(/\\t/g, new Array(this.opts.preSpaces + 1).join(' ')) : html;\n\n        return html;\n    },\n\n    encodeEntities: function(str)\n    {\n        str = this.decodeEntities(str);\n        str = str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;');\n\n        return str;\n    },\n    encodePhpCode: function(html)\n    {\n        html = html.replace('<?php', '&lt;?php');\n        html = html.replace('<?', '&lt;?');\n        html = html.replace('?>', '?&gt;');\n\n        return html;\n    },\n    decodeEntities: function(str)\n    {\n        return String(str).replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&quot;/g, '\"').replace(/&amp;/g, '&');\n    },\n\n    // store / restore\n    storeComponents: function(html)\n    {\n        var matched = this.utils.getElementsFromHtml(html, 'figure', 'table');\n\n        return this._storeMatched(html, matched, 'Components', 'figure');\n    },\n    restoreComponents: function(html)\n    {\n        return this._restoreMatched(html, 'Components', 'figure');\n    },\n    storeLinks: function(html)\n    {\n        var matched = this.utils.getElementsFromHtml(html, 'a');\n\n        return this._storeMatched(html, matched, 'Links', 'a');\n    },\n    storeImages: function(html)\n    {\n        var matched = this.utils.getElementsFromHtml(html, 'img');\n\n        return this._storeMatched(html, matched, 'Images', 'img');\n    },\n    restoreLinks: function(html)\n    {\n        return this._restoreMatched(html, 'Links', 'a');\n    },\n    restoreImages: function(html)\n    {\n        return this._restoreMatched(html, 'Images', 'img');\n    },\n\n    // PRIVATE\n\n    // clean\n    _cleanWrapped: function(html)\n    {\n        html = html.replace(new RegExp('<p><figure([\\\\w\\\\W]*?)</figure></p>', 'gi'), '<figure$1</figure>');\n\n        return html;\n    },\n    _cleanGDocs: function(html)\n    {\n        // remove google docs markers\n        html = html.replace(/<b\\sid=\"internal-source-marker(.*?)\">([\\w\\W]*?)<\\/b>/gi, \"$2\");\n        html = html.replace(/<b(.*?)id=\"docs-internal-guid(.*?)\">([\\w\\W]*?)<\\/b>/gi, \"$3\");\n\n        html = html.replace(/<span[^>]*(font-style:\\s?italic;\\s?font-weight:\\s?bold|font-weight:\\s?bold;\\s?font-style:\\s?italic)[^>]*>([\\w\\W]*?)<\\/span>/gi, '<b><i>$2</i></b>');\n        html = html.replace(/<span[^>]*(font-style:\\s?italic;\\s?font-weight:\\s?600|font-weight:\\s?600;\\s?font-style:\\s?italic)[^>]*>([\\w\\W]*?)<\\/span>/gi, '<b><i>$2</i></b>');\n        html = html.replace(/<span[^>]*(font-style:\\s?italic;\\s?font-weight:\\s?700|font-weight:\\s?700;\\s?font-style:\\s?italic)[^>]*>([\\w\\W]*?)<\\/span>/gi, '<b><i>$2</i></b>');\n        html = html.replace(/<span[^>]*font-style:\\s?italic[^>]*>([\\w\\W]*?)<\\/span>/gi, '<i>$1</i>');\n        html = html.replace(/<span[^>]*font-weight:\\s?bold[^>]*>([\\w\\W]*?)<\\/span>/gi, '<b>$1</b>');\n        html = html.replace(/<span[^>]*font-weight:\\s?700[^>]*>([\\w\\W]*?)<\\/span>/gi, '<b>$1</b>');\n        html = html.replace(/<span[^>]*font-weight:\\s?600[^>]*>([\\w\\W]*?)<\\/span>/gi, '<b>$1</b>');\n\n        return html;\n    },\n    _cleanMsWord: function(html)\n    {\n        html = html.replace(/<!--[\\s\\S]+?-->/gi, '');\n        html = html.replace(/<(!|script[^>]*>.*?<\\/script(?=[>\\s])|\\/?(\\?xml(:\\w+)?|img|meta|link|style|\\w:\\w+)(?=[\\s\\/>]))[^>]*>/gi, '');\n        html = html.replace(/<(\\/?)s>/gi, \"<$1strike>\");\n        html = html.replace(/&nbsp;/gi, ' ');\n        html = html.replace(/<span\\s+style\\s*=\\s*\"\\s*mso-spacerun\\s*:\\s*yes\\s*;?\\s*\"\\s*>([\\s\\u00a0]*)<\\/span>/gi, function(str, spaces) {\n            return (spaces.length > 0) ? spaces.replace(/./, \" \").slice(Math.floor(spaces.length/2)).split(\"\").join(\"\\u00a0\") : '';\n        });\n\n        // build wrapper\n        var $wrapper = this.utils.buildWrapper(html);\n\n        // footnote fix\n        $wrapper.find('.MsoFootnoteText').each(function(node) {\n            var $node = $R.dom(node);\n            var $parent = $node.parent();\n            if ($parent.length !== 0 && $parent.attr('style').search(/mso-element:footnote/) !== -1) {\n                $node.find('a').attr('id', '_' + $parent.attr('id'));\n            }\n\n        });\n\n        $wrapper.find('.MsoFootnoteReference').each(function(node) {\n            var $node = $R.dom(node);\n            var $parent = $node.parent();\n            if ($parent.length !== 0 && $parent.get().tagName === 'A') {\n                $parent.attr('id', $parent.attr('name'));\n            }\n\n        });\n\n        // build lists\n        $wrapper.find('p').each(function(node)\n        {\n            var $node = $R.dom(node);\n            var str = $node.attr('style');\n            var matches = /mso-list:\\w+ \\w+([0-9]+)/.exec(str);\n            if (matches)\n            {\n                $node.attr('data-listLevel',  parseInt(matches[1], 10));\n            }\n        });\n\n        // parse Lists\n        this._parseWordLists($wrapper);\n\n        $wrapper.find('[align]').removeAttr('align');\n        $wrapper.find('[name]').removeAttr('name');\n        $wrapper.find('span').each(function(node)\n        {\n            var $node = $R.dom(node);\n            var str = $node.attr('style');\n            var matches = /mso-list:Ignore/.exec(str);\n\n            if (matches) $node.remove();\n            else $node.unwrap();\n\n        });\n        $wrapper.find('[style]').removeAttr('style');\n        $wrapper.find(\"[class^='Mso']\").removeAttr('class');\n        $wrapper.find('a').filter(function(node) { return !node.hasAttribute('href'); }).unwrap();\n\n        // get wrapper\n        html = this.utils.getWrapperHtml($wrapper);\n        html = html.replace(/<p[^>]*><\\/p>/gi, '');\n        html = html.replace(/<li>/gi, '<li>');\n        html = html.trim();\n\n        // remove spaces between\n        html = html.replace(/\\/(p|ul|ol|h1|h2|h3|h4|h5|h6|blockquote)>\\s+<(p|ul|ol|h1|h2|h3|h4|h5|h6|blockquote)/gi, '/$1>\\n<$2');\n\n        var result = '';\n        var lines = html.split(/\\n/);\n        for (var i = 0; i < lines.length; i++)\n        {\n            var space = (lines[i] !== '' && lines[i].search(/>$/) === -1) ? ' ' : '\\n';\n\n            result += lines[i] + space;\n        }\n\n        return result;\n    },\n    _parseWordLists: function($wrapper)\n    {\n        var lastLevel = 0;\n        var $item = null;\n        var $list = null;\n        var $listChild = null;\n\n        $wrapper.find('p').each(function(node) {\n            var $node = $R.dom(node);\n            var level = $node.attr('data-listLevel');\n            if (level === null && $node.hasClass('MsoListParagraphCxSpMiddle')) {\n                level = 1;\n            }\n\n            if (level !== null) {\n                var txt = $node.text();\n                var listTag = (/^\\s*\\w+\\./.test(txt)) ? '<ol></ol>' : '<ul></ul>';\n\n                // new parent list\n                if ($node.hasClass('MsoListParagraphCxSpFirst') || $node.hasClass('MsoNormal')) {\n                    $list = $R.dom(listTag);\n                    $node.before($list);\n                }\n                // new child list\n                else if (level > lastLevel && lastLevel !== 0) {\n                    $listChild = $R.dom(listTag);\n                    $item.append($listChild);\n                    $list = $listChild;\n                }\n                // level up\n                if (level < lastLevel) {\n                    var len = lastLevel - level + 1;\n                    for (var i = 0; i < len; i++) {\n                        $list = $list.parent();\n                    }\n                }\n\n                // create item\n                $node.find('span').first().unwrap();\n                $item = $R.dom('<li>' + $node.html().trim() + '</li>');\n                if ($list === null) {\n                    $node.before(listTag);\n                    $list = $node.prev();\n                }\n\n                // append\n                $list.append($item);\n                $node.remove();\n\n                lastLevel = level;\n            }\n            else {\n                $list = null;\n                lastLevel = 0;\n            }\n        });\n    },\n\n    // is\n    _isSpacedEmpty: function(html)\n    {\n        return (html.search(this.reSpacedEmpty) !== -1);\n    },\n    _isParagraphEmpty: function(html)\n    {\n        return (html.search(/^<p><\\/p>$/i) !== -1);\n    },\n    _isHtmlMsWord: function(html)\n    {\n        return html.match(/class=\"?Mso|style=\"[^\"]*\\bmso-|style='[^'']*\\bmso-|w:WordDocument/i);\n    },\n\n    // set\n    _setSpanAttr: function(html)\n    {\n        var $wrapper = this.utils.buildWrapper(html);\n        $wrapper.find('span').attr('data-redactor-span', true);\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n    _setStyleCache: function(html)\n    {\n        var $wrapper = this.utils.buildWrapper(html);\n        $wrapper.find('[style]').each(function(node)\n        {\n            var $el = $R.dom(node);\n            $el.attr('data-redactor-style-cache', $el.attr('style'));\n        });\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n    _setPreClass: function(html)\n    {\n        var $wrapper = this.utils.buildWrapper(html);\n        $wrapper.find('pre').addClass(this.opts.preClass);\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n    _setLinkNofollow: function(html)\n    {\n        var $wrapper = this.utils.buildWrapper(html);\n        $wrapper.find('a').attr('rel', 'nofollow');\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n\n    // replace\n    _replaceScriptTag: function(html)\n    {\n        return html.replace(this.reScriptTag, '<script class=\"redactor-script-tag\" $1>$2</script>');\n    },\n    _unreplaceScriptTag: function(html)\n    {\n        return html.replace(/<script class=\"redactor-script-tag\"(.*?[^>]?)>([\\w\\W]*?)<\\/script>/gi, '<script$1>$2</script>');\n    },\n\t_replaceNlToBr: function(html)\n\t{\n\t\treturn html.replace(/\\n/g, '<br />');\n\t},\n\n    // remove\n    _removeScriptTag: function(html)\n    {\n        return html.replace(this.reScriptTag, '');\n    },\n\n    // private\n    _storeMatched: function(html, matched, stored, name)\n    {\n        this['stored' + stored] = [];\n        if (matched)\n        {\n            for (var i = 0; i < matched.length; i++)\n            {\n                this['stored' + stored][i] = matched[i];\n                html = html.replace(matched[i], '####' + name + i + '####');\n            }\n        }\n\n        return html;\n    },\n    _restoreMatched: function(html, stored, name)\n    {\n        if (this['stored' + stored])\n        {\n            for (var i = 0; i < this['stored' + stored].length; i++)\n            {\n                html = html.replace('####' + name + i + '####', this['stored' + stored][i]);\n            }\n        }\n\n        return html;\n    }\n});\n$R.add('class', 'cleaner.figure', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.detector = app.detector;\n    },\n    // public\n    convert: function(html, rules)\n    {\n        var $wrapper = this.utils.buildWrapper(html);\n\n        // convert\n        $wrapper.find('img').each(this._convertImage.bind(this));\n        $wrapper.find('hr').each(this._convertLine.bind(this));\n        $wrapper.find('iframe').each(this._convertIframe.bind(this));\n        $wrapper.find('table').each(this._convertTable.bind(this));\n        $wrapper.find('form').each(this._convertForm.bind(this));\n        $wrapper.find('figure pre').each(this._convertCode.bind(this));\n\n        // variables\n        $wrapper.find('[data-redactor-type=variable]').addClass('redactor-component');\n\n        // widgets\n        $wrapper.find('figure').not('.redactor-component, .redactor-figure-code').each(this._convertWidget.bind(this));\n\n        // contenteditable\n        $wrapper.find('figure pre').each(this._setContenteditableCode.bind(this));\n        $wrapper.find('.redactor-component, .non-editable').attr('contenteditable', false);\n\n        if (this.detector.isIe())\n        {\n            $wrapper.find('[data-redactor-type=table]').removeAttr('contenteditable');\n        }\n\n        $wrapper.find('figcaption, td, th').attr('contenteditable', true);\n        $wrapper.find('.redactor-component, figcaption').attr('tabindex', '-1');\n\n        // extra rules\n        this._acceptExtraRules($wrapper, rules);\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n    unconvert: function(html, rules)\n    {\n        html = html.replace(/<\\/([^>]+)><div data-redactor-tag/g, '</$1>\\n<div data-redactor-tag');\n        html = html.replace(/<\\/([^>]+)><p/g, '</$1>\\n<p');\n\n        var $wrapper = this.utils.buildWrapper(html);\n\n        // contenteditable\n        $wrapper.find('th, td, figcaption, figure, pre, code, .redactor-component').removeAttr('contenteditable tabindex');\n\n        // remove class\n        $wrapper.find('figure').removeClass('redactor-component redactor-component-active redactor-uploaded-figure');\n\n        // unconvert\n        $wrapper.find('[data-redactor-type=variable]').removeClass('redactor-component redactor-component-active');\n        $wrapper.find('figure[data-redactor-type=line]').unwrap();\n        $wrapper.find('figure[data-redactor-type=widget]').each(this._unconvertWidget.bind(this));\n        $wrapper.find('figure[data-redactor-type=form]').each(this._unconvertForm.bind(this));\n        $wrapper.find('figure[data-redactor-type=table]').each(this._unconvertTable.bind(this));\n        $wrapper.find('figure[data-redactor-type=image]').removeAttr('rel').each(this._unconvertImages.bind(this));\n\n        $wrapper.find('img').removeAttr('data-redactor-type').removeClass('redactor-component');\n        $wrapper.find('.non-editable').removeAttr('contenteditable');\n\n        // remove types\n        $wrapper.find('figure').each(this._removeTypes.bind(this));\n\n        // remove caret\n        $wrapper.find('span.redactor-component-caret').remove();\n\n        // break div\n        $wrapper = this._unconvertBreakTag($wrapper);\n\n        // extra rules\n        this._acceptExtraRules($wrapper, rules);\n\n        html = this.utils.getWrapperHtml($wrapper);\n        html = html.replace(/<br\\s?\\/?>$/, '');\n        html = html.replace(/<br\\s?\\/?><\\/(td|th)>/, '</$1>');\n\n        return html;\n    },\n\n    // private\n    _convertImage: function(node)\n    {\n        var $node = $R.dom(node);\n        if (this._isNonEditable($node)) return;\n\n        // set id\n        if (this.opts.imageObserve && !$node.attr('data-image'))\n        {\n            $node.attr('data-image', this.utils.getRandomId());\n        }\n\n        var $link = $node.closest('a');\n        var $figure = $node.closest('figure');\n        var isImage = ($figure.children().not('a, img, br, figcaption').length === 0);\n        if (!isImage) return;\n\n        if ($figure.length === 0)\n        {\n            var $parent = ($link.length !== 0) ? $link.closest('p') : $node.closest('p');\n            if (this.opts.imageFigure === false && $parent.length !== 0)\n            {\n                var $el = this.utils.replaceToTag($parent, 'figure');\n                $figure = $el;\n                $figure.addClass('redactor-replace-figure');\n            }\n            else\n            {\n                if ($parent.length !== 0) {\n                    $parent.unwrap();\n                }\n\n                $figure = ($link.length !== 0) ? $link.wrap('<figure>') : $node.wrap('<figure>');\n            }\n        }\n        else\n        {\n            if ($figure.hasClass('redactor-uploaded-figure'))\n            {\n                $figure.removeClass('redactor-uploaded-figure');\n            }\n            else\n            {\n                $figure.addClass('redactor-keep-figure');\n            }\n        }\n\n        this._setFigure($figure, 'image');\n    },\n    _convertTable: function(node)\n    {\n        if (this._isNonEditable(node)) return;\n\n        var $figure = this._wrapFigure(node);\n        this._setFigure($figure, 'table');\n    },\n    _convertLine: function(node)\n    {\n        if (this._isNonEditable(node)) return;\n\n        var $figure = this._wrapFigure(node);\n        this._setFigure($figure, 'line');\n    },\n    _convertForm: function(node)\n    {\n        if (this._isNonEditable(node)) return;\n\n        var $figure = this.utils.replaceToTag(node, 'figure');\n        this._setFigure($figure, 'form');\n    },\n    _convertIframe: function(node)\n    {\n        if (this._isNonEditable(node)) return;\n\n        var $node = $R.dom(node);\n        if ($node.closest('.redactor-component').length !== 0) return;\n\n        var src = node.getAttribute('src');\n        var isVideo = (src && (src.match(this.opts.regex.youtube) || src.match(this.opts.regex.vimeo)));\n        var $figure = this._wrapFigure(node);\n\n        if (isVideo)\n        {\n            this._setFigure($figure, 'video');\n        }\n    },\n    _convertCode: function(node)\n    {\n        if (this._isNonEditable(node)) return;\n\n        var $figure = this._wrapFigure(node);\n        this._setFigure($figure, 'code');\n    },\n    _convertWidget: function(node)\n    {\n        if (this._isNonEditable(node)) return;\n\n        var $node = $R.dom(node);\n        $node.addClass('redactor-component');\n        $node.attr('data-redactor-type', 'widget');\n        $node.attr('data-widget-code', encodeURI(node.innerHTML.trim()));\n    },\n\n    // unconvert\n    _unconvertBreakTag: function($wrapper) {\n        $wrapper.find('[data-redactor-tag]').each(function(node) {\n            var $node = $R.dom(node);\n            $node.removeAttr('data-redactor-tag');\n\n            if (this.utils.isEmptyHtml($node.html())) {\n                $node.unwrap();\n            }\n            else if (node.lastChild && node.lastChild.tagName === 'BR') {\n                $node.unwrap();\n            }\n            else {\n                var $next = $node.nextElement();\n                if ($next.length !== 0 && $next.attr('data-redactor-tag')) {\n                    node.appendChild(document.createElement('br'));\n                }\n\n                $node.unwrap();\n            }\n        }.bind(this));\n        return $wrapper;\n    },\n    _unconvertForm: function(node)\n    {\n        this.utils.replaceToTag(node, 'form');\n    },\n    _unconvertTable: function(node)\n    {\n        var $node = $R.dom(node);\n        $node.unwrap();\n    },\n    _unconvertWidget: function(node)\n    {\n        var $node = $R.dom(node);\n        $node.html(decodeURI($node.attr('data-widget-code')));\n        $node.removeAttr('data-widget-code');\n    },\n    _unconvertImages: function(node)\n    {\n        var $node = $R.dom(node);\n        $node.removeClass('redactor-component');\n\n        var isList = ($node.closest('li').length !== 0);\n        var isTable = ($node.closest('table').length !== 0);\n        var hasFigcaption = ($node.find('figcaption').length !== 0);\n\n        var style = $node.attr('style');\n        var hasStyle = !(style === null || style === '');\n        var hasClass = ($node.attr('class') !== '');\n\n        if (isList || (isTable && !hasFigcaption && !hasStyle && !hasClass))\n        {\n            $node.unwrap();\n        }\n    },\n    _removeTypes: function(node)\n    {\n        var $node = $R.dom(node);\n        var type = $node.attr('data-redactor-type');\n        var removed = ['image', 'widget', 'line', 'video', 'code', 'form', 'table'];\n        if (type && removed.indexOf(type) !== -1)\n        {\n            $node.removeAttr('data-redactor-type');\n        }\n\n        // keep figure\n        if ($node.hasClass('redactor-keep-figure'))\n        {\n            $node.removeClass('redactor-keep-figure');\n        }\n\n        // unwrap figure\n        else if (type === 'image' && this.opts.imageFigure === false)\n        {\n            var hasFigcaption = ($node.find('figcaption').length !== 0);\n            if (!hasFigcaption)\n            {\n                // replace\n                if ($node.hasClass('redactor-replace-figure'))\n                {\n                    $node.removeClass('redactor-replace-figure');\n                    this.utils.replaceToTag($node, 'p');\n                }\n                else\n                {\n                    $node.unwrap();\n                }\n            }\n        }\n\n        $node.removeClass('redactor-replace-figure');\n    },\n\n    // wrap\n    _wrapFigure: function(node)\n    {\n        var $node = $R.dom(node);\n        var $figure = $node.closest('figure');\n\n        return ($figure.length === 0) ? $node.wrap('<figure>') : $figure;\n    },\n\n    // set\n    _setFigure: function($figure, type)\n    {\n        $figure.addClass('redactor-component');\n        $figure.attr('data-redactor-type', type);\n    },\n    _setContenteditableCode: function(node)\n    {\n        if (this._isNonEditable(node)) return;\n\n        var $node = $R.dom(node);\n        var $code = $node.children('code').first();\n\n        var $el = ($code.length !== 0) ? $code : $node;\n        $el.attr('contenteditable', true).attr('tabindex', '-1');\n    },\n\n    // utils\n    _acceptExtraRules: function($wrapper, rules)\n    {\n        for (var key in rules)\n        {\n            if (typeof rules[key] === 'function')\n            {\n                rules[key]($wrapper);\n            }\n        }\n    },\n    _isNonEditable: function(node)\n    {\n        return ($R.dom(node).closest('.non-editable').length !== 0);\n    }\n});\n$R.add('class', 'cleaner.paragraphize', {\n    init: function(app) {\n        this.app = app;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.cleaner = app.cleaner;\n        this.element = app.element;\n\n        // local\n        this.stored = [];\n        this.remStart = '#####replace';\n        this.remEnd = '#####';\n        this.paragraphizeTags = ['table', 'div', 'pre', 'form', 'ul', 'ol', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'dl', 'blockquote', 'figcaption',\n                'address', 'section', 'header', 'footer', 'aside', 'article', 'object', 'style', 'script', 'iframe', 'select', 'input', 'textarea',\n                'button', 'option', 'map', 'area', 'math', 'hr', 'fieldset', 'legend', 'hgroup', 'nav', 'figure', 'details', 'menu', 'summary', 'p'];\n    },\n    // public\n    convert: function(html) {\n\n        var value = this._isConverted(html);\n\n        value = (value === true) ? this._convert(html) : value;\n        value = this._convertTable(value);\n\n        return value;\n    },\n\n    // private\n    _convert: function(html, tablemarkup) {\n        // build markup tag\n        var tag = (this.opts.breakline || tablemarkup) ? 'sdivtag' : this.opts.markup;\n        var attr = (tablemarkup) ? 'tbr' : 'br';\n\n        // store\n        html = this._storeTags(html);\n\n        var storedComments = [];\n        html = this.cleaner.storeComments(html, storedComments);\n\n        // trim\n        html = html.trim();\n        html = this._trimLinks(html);\n\n        // replace new lines\n        html = html.replace(/xparagraphmarkerz(?:\\r\\n|\\r|\\n)$/g, '');\n        html = html.replace(/xparagraphmarkerz$/g, '');\n        html = html.replace(/xparagraphmarkerz(?:\\r\\n|\\r|\\n)/g, '\\n');\n        html = html.replace(/xparagraphmarkerz/g, '\\n');\n\n        if (this.opts.breakline) {\n            html = html.replace(/<br\\s?\\/?>(?:\\r\\n|\\r|\\n)/gi, 'xbreakmarkerz\\n');\n            html = html.replace(/<br\\s?\\/?>/gi, 'xbreakmarkerz\\n');\n            html = html.replace(/xbreakmarkerz\\n<\\//gi, 'xbreakmarkerz</');\n\n        }\n        else {\n            html = html.replace(/[\\n]+/g, \"\\n\");\n        }\n\n        // wrap to tag\n        var str = '';\n        var arr = html.split(\"\\n\");\n        for (var i = 0; i < arr.length; i++) {\n            str += '<' + tag + '>' + arr[i] + '</' + tag + '>\\n';\n        }\n\n        html = str.replace(/\\n$/, '');\n\n        // clean\n        html = html.replace(new RegExp('<' + tag + '>\\\\s+#####', 'gi'), '#####');\n        html = html.replace(new RegExp('<' + tag + '>#####', 'gi'), '#####');\n        html = html.replace(new RegExp('#####</' + tag + '>', 'gi'), '#####');\n\n        // replace marker\n        html = (this.opts.breakline) ? html.replace(/xbreakmarkerz/gi, \"<br>\") : html;\n\n        // restore\n        html = this._restoreTags(html);\n        html = this.cleaner.restoreComments(html, storedComments);\n\n        // remove empty\n        if (this.opts.breakline) {\n            html = html.replace(new RegExp('<' + tag + '></' + tag + '>', 'gi'), '<' + tag + '><br></' + tag + '>');\n        }\n        else {\n            //html = html.replace(new RegExp('<' + tag + '><br\\\\s?/?></' + tag + '>', 'gi'), '');\n            //html = html.replace(new RegExp('<' + tag + '></' + tag + '>', 'gi'), '');\n        }\n\n        // clean restored\n        html = html.replace(new RegExp('<sdivtag>', 'gi'), '<div data-redactor-tag=\"' + attr + '\">');\n        html = html.replace(new RegExp('sdivtag', 'gi'), 'div');\n        html = html.replace(/<\\/([^>]+)><div data-redactor-tag/g, '</$1>\\n<div data-redactor-tag');\n\n        return html;\n    },\n    _convertTable: function(html) {\n        var $wrapper = this.utils.buildWrapper(html);\n        $wrapper.find('td, th').each(this._convertCell.bind(this));\n        html = this.utils.getWrapperHtml($wrapper);\n\n        return html;\n    },\n    _convertCell: function(node) {\n        var $node = $R.dom(node);\n        this.stored = [];\n        var code = this._convert($node.html(), true);\n        $node.html(code);\n    },\n    _storeTags: function(html) {\n        var self = this;\n        var $wrapper = this.utils.buildWrapper(html);\n        $wrapper.find(this.paragraphizeTags.join(', ')).each(function(node, i) {\n            var replacement = document.createTextNode(self.remStart + i + self.remEnd + 'xparagraphmarkerz'); //  + \"\\n\"\n            self.stored.push(node.outerHTML);\n            node.parentNode.replaceChild(replacement, node);\n        });\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n    _restoreTags: function(html) {\n        for (var i = 0; i < this.stored.length; i++) {\n            this.stored[i] = this.stored[i].replace(/\\$/g, '&#36;');\n            html = html.replace(this.remStart + i + this.remEnd, this.stored[i]);\n        }\n\n        return html;\n    },\n    _trimLinks: function(html) {\n        var $wrapper = this.utils.buildWrapper(html);\n        $wrapper.find('a').each(this._trimLink.bind(this));\n        html = this.utils.getWrapperHtml($wrapper);\n\n        return html;\n    },\n    _trimLink: function(node) {\n        var $node = $R.dom(node);\n        $node.html($node.html().trim());\n    },\n    _isConverted: function(html) {\n        if (this._isDisabled(html)) return html;\n        else if (this._isEmptyHtml(html)) return this.opts.emptyHtml;\n        else return true;\n    },\n    _isDisabled: function() {\n        return (this.opts.paragraphize === false || this.element.isType('inline'));\n    },\n    _isEmptyHtml: function(html) {\n        return (html === '' || html === '<p></p>' || html === '<div></div>');\n    }\n});\n$R.add('service', 'detector', {\n    init: function(app)\n    {\n        this.app = app;\n\n        // local\n        this.userAgent = navigator.userAgent.toLowerCase();\n    },\n\tisWebkit: function()\n\t{\n\t\treturn /webkit/.test(this.userAgent);\n\t},\n\tisFirefox: function()\n\t{\n\t\treturn (this.userAgent.indexOf('firefox') > -1);\n\t},\n\tisIe: function(v)\n\t{\n        if (document.documentMode || /Edge/.test(navigator.userAgent)) return 'edge';\n\n\t\tvar ie;\n\t\tie = RegExp('msie' + (!isNaN(v)?('\\\\s'+v):''), 'i').test(navigator.userAgent);\n\t\tif (!ie) ie = !!navigator.userAgent.match(/Trident.*rv[ :]*11\\./);\n\n\t\treturn ie;\n\t},\n\tisMobile: function()\n\t{\n\t\treturn /(iPhone|iPod|Android)/.test(navigator.userAgent);\n\t},\n\tisDesktop: function()\n\t{\n\t\treturn !/(iPhone|iPod|iPad|Android)/.test(navigator.userAgent);\n\t},\n\tisIpad: function()\n\t{\n\t\treturn /iPad/.test(navigator.userAgent);\n\t}\n});\n$R.add('service', 'offset', {\n    init: function(app)\n    {\n        this.app = app;\n    },\n    get: function(el, trimmed)\n    {\n        var offset = { start: 0, end: 0 };\n        var node = this.utils.getNode(el);\n        if (!node) return false;\n\n        var isEditor = this.editor.isEditor(node);\n        var isIn = (isEditor) ? true : this.selection.isIn(node);\n        var range = this.selection.getRange();\n\n        if (!isEditor && !isIn)\n        {\n            offset = false;\n        }\n        else if (this.selection.is() && isIn)\n        {\n            var $startNode = $R.dom(range.startContainer);\n            var fix = ($startNode.hasClass('redactor-component')) ? range.startOffset : 0;\n            var clonedRange = range.cloneRange();\n\n            clonedRange.selectNodeContents(node);\n            clonedRange.setEnd(range.startContainer, range.startOffset);\n\n            var selection = this._getString(range, trimmed);\n\n            offset.start = this._getString(clonedRange, trimmed).length - fix;\n            offset.end = offset.start + selection.length + fix;\n        }\n\n        return offset;\n    },\n    set: function(offset, el)\n    {\n        if (this._setComponentOffset(el)) return;\n\n        this.component.clearActive();\n        var node = this.utils.getNode(el);\n        if (!node) return;\n\n        var size = this.size(node);\n        var charIndex = 0, range = document.createRange();\n\n        offset.end = (offset.end > size) ? size : offset.end;\n\n        range.setStart(node, 0);\n        range.collapse(true);\n\n        var nodeStack = [node], foundStart = false, stop = false;\n        while (!stop && (node = nodeStack.pop()))\n        {\n            if (node.nodeType == 3)\n            {\n                var nextCharIndex = charIndex + node.length;\n\n                if (!foundStart && !this._isFigcaptionNext(node) && offset.start >= charIndex && offset.start <= nextCharIndex)\n                {\n                    range.setStart(node, offset.start - charIndex);\n                    foundStart = true;\n                }\n\n                if (foundStart && offset.end >= charIndex && offset.end <= nextCharIndex)\n                {\n                    range.setEnd(node, offset.end - charIndex);\n                    stop = true;\n                }\n\n                charIndex = nextCharIndex;\n            }\n            else\n            {\n                var i = node.childNodes.length;\n                while (i--)\n                {\n                    nodeStack.push(node.childNodes[i]);\n                }\n            }\n        }\n\n        this.selection.setRange(range);\n    },\n    size: function(el, trimmed)\n    {\n        var node = this.utils.getNode(el);\n        if (node)\n        {\n            var range = document.createRange();\n\n            var clonedRange = range.cloneRange();\n            clonedRange.selectNodeContents(node);\n\n            return this._getString(clonedRange, trimmed).length;\n        }\n\n        return 0;\n    },\n\n    // private\n    _getString: function(obj, trimmed)\n    {\n        var str = obj.toString();\n        str = (this.editor.isEmpty()) ? str.replace(/\\uFEFF/g, '') : str;\n        str = (trimmed) ? str.trim() : str;\n\n        return str;\n    },\n    _setComponentOffset: function(el)\n    {\n        return (this.component.isNonEditable(el)) ? this.component.setActive(el) : false;\n    },\n    _isFigcaptionNext: function(node)\n    {\n        var next = node.nextSibling;\n        return (node.nodeValue.trim() === '' && next && next.tagName === 'FIGCAPTION');\n    }\n});\n$R.add('service', 'inspector', {\n    init: function(app)\n    {\n        this.app = app;\n    },\n    // parse\n    parse: function(el)\n    {\n        return $R.create('inspector.parser', this.app, this, el);\n    },\n\n    // text detection\n    isText: function(el)\n    {\n        if (typeof el === 'string' && !/^\\s*<(\\w+|!)[^>]*>/.test(el))\n        {\n            return true;\n        }\n\n        var node = $R.dom(el).get();\n        return (node && node.nodeType === 3); //  && !this.selection.getBlock(el)\n    },\n\n    // tag detection\n    isInlineTag: function(tag, extend)\n    {\n        var tags = this._extendTags(this.opts.inlineTags, extend);\n\n        return (this._isTag(tag) && tags.indexOf(tag.toLowerCase()) !== -1);\n    },\n    isBlockTag: function(tag, extend)\n    {\n        var tags = this._extendTags(this.opts.blockTags, extend);\n\n        return (this._isTag(tag) && tags.indexOf(tag.toLowerCase()) !== -1);\n    },\n    isTableCellTag: function(tag)\n    {\n        return (['td', 'th'].indexOf(tag.toLowerCase()) !== -1);\n    },\n    isHeadingTag: function(tag)\n    {\n        return (['h1', 'h2', 'h3', 'h4', 'h5', 'h6'].indexOf(tag.toLowerCase()) !== -1);\n    },\n\n\n    _isTag: function(tag)\n    {\n        return (tag !== undefined && tag);\n    },\n    _extendTags: function(tags, extend)\n    {\n        tags = tags.concat(tags);\n\n        if (extend)\n        {\n            for (var i = 0 ; i < extend.length; i++)\n            {\n                tags.push(extend[i]);\n            }\n        }\n\n        return tags;\n    }\n});\n$R.add('class', 'inspector.parser', {\n    init: function(app, inspector, el)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.editor = app.editor;\n        this.selection = app.selection;\n        this.inspector = inspector;\n\n        // local\n        this.el = el;\n        this.$el = $R.dom(this.el, '.redactor-in-' + this.uuid);\n        this.node = this.$el.get();\n\n        // comment node\n        if (this.node && this.node.nodeType === 8)\n        {\n            this.node = false;\n        }\n\n        this.$component = this.$el.closest('.redactor-component', '.redactor-in');\n    },\n    // is\n    isEditor: function()\n    {\n        return (this.node === this.editor.getElement().get());\n    },\n    isInEditor: function()\n    {\n        return (this.$el.parents('.redactor-in-' + this.uuid).length !== 0);\n    },\n    isComponent: function()\n    {\n        return (this.$component.length !== 0);\n    },\n    isComponentType: function(type)\n    {\n        return (this.getComponentType() === type);\n    },\n    isComponentActive: function()\n    {\n        return (this.isComponent() && this.$component.hasClass('redactor-component-active'));\n    },\n    isComponentEditable: function()\n    {\n        var types = ['code', 'table'];\n        var type = this.getComponentType();\n\n        return (this.isComponent() && types.indexOf(type) !== -1);\n    },\n    isFigcaption: function()\n    {\n        return this.getFigcaption();\n    },\n    isPre: function()\n    {\n        return this.getPre();\n    },\n    isCode: function()\n    {\n        var $code = this.$el.closest('code');\n        var $parent = $code.parent('pre');\n\n        return ($code.length !== 0 && $parent.length === 0);\n    },\n    isList: function()\n    {\n        return this.getList();\n    },\n    isFirstListItem: function()\n    {\n        return this._getLastOrFirstListItem('first');\n    },\n    isLastListItem: function()\n    {\n        return this._getLastOrFirstListItem('last');\n    },\n    isFirstTableCell: function()\n    {\n        return this._getLastOrFirstTableCell('first');\n    },\n    isLastTableCell: function()\n    {\n        return this._getLastOrFirstTableCell('last');\n    },\n    isTable: function()\n    {\n        return (this.isComponentType('table') || this.getTable());\n    },\n    isHeading: function()\n    {\n        return this.getHeading();\n    },\n    isBlockquote: function()\n    {\n        return this.getBlockquote();\n    },\n    isDl: function()\n    {\n        return this.getDl();\n    },\n    isParagraph: function()\n    {\n        return this.getParagraph();\n    },\n    isLink: function()\n    {\n        return this.getLink();\n    },\n    isFile: function()\n    {\n        return this.getFile();\n    },\n    isText: function()\n    {\n        return this.inspector.isText(this.el);\n    },\n    isInline: function()\n    {\n        var tags = this.opts.inlineTags;\n\n        return (this.isElement()) ? (tags.indexOf(this.node.tagName.toLowerCase()) !== -1) : false;\n    },\n    isBlock: function()\n    {\n        var tags = this.opts.blockTags;\n\n        return (this.isElement()) ? (tags.indexOf(this.node.tagName.toLowerCase()) !== -1) : false;\n    },\n    isElement: function()\n    {\n        return (this.node && this.node.nodeType && this.node.nodeType !== 3);\n    },\n\n    // has\n    hasParent: function(tags)\n    {\n        return (this.$el.closest(tags.join(',')).length !== 0);\n    },\n\n    // get\n    getNode: function()\n    {\n        return this.node;\n    },\n    getTag: function()\n    {\n        return (this.isElement()) ? this.node.tagName.toLowerCase() : false;\n    },\n    getComponent: function()\n    {\n        return (this.isComponent()) ? this.$component.get() : false;\n    },\n    getComponentType: function()\n    {\n        return (this.isComponent()) ? this.$component.attr('data-redactor-type') : false;\n    },\n    getFirstNode: function()\n    {\n        return this.utils.getFirstNode(this.node);\n    },\n    getLastNode: function()\n    {\n        return this.utils.getLastNode(this.node);\n    },\n    getFirstElement: function()\n    {\n        return this.utils.getFirstElement(this.node);\n    },\n    getLastElement: function()\n    {\n        return this.utils.getLastElement(this.node);\n    },\n    getFigcaption: function()\n    {\n        return this._getClosestNode('figcaption');\n    },\n    getPre: function()\n    {\n        return this._getClosestNode('pre');\n    },\n    getCode: function()\n    {\n        return this._getClosestNode('code');\n    },\n    getList: function()\n    {\n        return this._getClosestNode('ul, ol');\n    },\n    getParentList: function()\n    {\n        return this._getClosestUpNode('ul, ol');\n    },\n    getListItem: function()\n    {\n        return this._getClosestNode('li');\n    },\n    getTable: function()\n    {\n        if (this.getComponentType('table'))\n        {\n            return this.$component.find('table').get();\n        }\n        else\n        {\n            return this._getClosestNode('table');\n        }\n    },\n    getTableCell: function()\n    {\n        var $td = this.$el.closest('td, th');\n\n        return ($td.length !== 0) ? $td.get() : false;\n    },\n    getComponentCodeElement: function()\n    {\n        return (this.isComponentType('code')) ? this.$component.find('pre code, pre').last().get() : false;\n    },\n    getImageElement: function()\n    {\n        return (this.isComponentType('image')) ? this.$component.find('img').get() : false;\n    },\n    getParagraph: function()\n    {\n        return this._getClosestNode('p');\n    },\n    getHeading: function()\n    {\n        return this._getClosestNode('h1, h2, h3, h4, h5, h6');\n    },\n    getDl: function()\n    {\n        return this._getClosestNode('dl');\n    },\n    getBlockquote: function()\n    {\n        return this._getClosestNode('blockquote');\n    },\n    getLink: function()\n    {\n        var isComponent = (this.isComponent() && !this.isFigcaption());\n        var isTable = this.isComponentType('table');\n\n        if (isTable || !isComponent)\n        {\n            var $el = this._getClosestElement('a');\n\n            return ($el && !$el.attr('data-file')) ? $el.get() : false;\n        }\n\n        return false;\n    },\n    getFile: function()\n    {\n        var isComponent = this.isComponent();\n        var isTable = this.isComponentType('table');\n\n        if (isTable || !isComponent)\n        {\n            var $el = this._getClosestElement('a');\n\n            return ($el && $el.attr('data-file')) ? $el.get() : false;\n        }\n\n        return false;\n    },\n\n    // find\n    findFirstNode: function(selector)\n    {\n        return this.$el.find(selector).first().get();\n    },\n    findLastNode: function(selector)\n    {\n        return this.$el.find(selector).last().get();\n    },\n\n    // private\n    _getLastOrFirstListItem: function(type)\n    {\n        var list = this.getList();\n        var tag = this.getTag();\n        if (list && tag === 'li')\n        {\n            var item = $R.dom(list).find('li')[type]().get();\n            if (item && this.node === item)\n            {\n                return true;\n            }\n        }\n\n        return false;\n    },\n    _getLastOrFirstTableCell: function(type)\n    {\n        var table = this.getTable();\n        var tag = this.getTag();\n        if (table && (tag === 'td' || tag === 'th'))\n        {\n            var item = $R.dom(table).find('td, th')[type]().get();\n            if (item && this.node === item)\n            {\n                return true;\n            }\n        }\n\n        return false;\n    },\n    _getClosestUpNode: function(selector)\n    {\n        var $el = this.$el.parents(selector, '.redactor-in-' + this.uuid).last();\n\n        return ($el.length !== 0) ? $el.get() : false;\n    },\n    _getClosestNode: function(selector)\n    {\n        var $el = this.$el.closest(selector, '.redactor-in-' + this.uuid);\n\n        return ($el.length !== 0) ? $el.get() : false;\n    },\n    _getClosestElement: function(selector)\n    {\n        var $el = this.$el.closest(selector, '.redactor-in-' + this.uuid);\n\n        return ($el.length !== 0) ? $el : false;\n    }\n});\n$R.add('service', 'marker', {\n    init: function(app)\n    {\n        this.app = app;\n    },\n    build: function(pos, html)\n    {\n        var marker = document.createElement('span');\n\n        marker.id = 'selection-marker-' + this._getPos(pos);\n        marker.className = 'redactor-selection-marker';\n        marker.innerHTML = this.opts.markerChar;\n\n        return (html) ? marker.outerHTML : marker;\n    },\n    buildHtml: function(pos)\n    {\n        return this.build(pos, true);\n    },\n    insert: function(side)\n    {\n        this.remove();\n\n        var atStart = (side !== 'both' && (side === 'start' || this.selection.isCollapsed()));\n\n        if (!this.selection.is()) this.editor.focus();\n\n        var range = this.selection.getRange();\n        if (range)\n        {\n            var start = this.build('start');\n            var end = this.build('end');\n\n            var cloned = range.cloneRange();\n\n            if (!atStart)\n            {\n                cloned.collapse(false);\n                cloned.insertNode(end);\n            }\n\n            cloned.setStart(range.startContainer, range.startOffset);\n            cloned.collapse(true);\n            cloned.insertNode(start);\n\n            range.setStartAfter(start);\n\n            if (!atStart)\n            {\n                range.setEndBefore(end);\n            }\n\n            this.selection.setRange(range);\n\n            return start;\n        }\n    },\n    find: function(pos, $context)\n    {\n        var $editor = this.editor.getElement();\n        var $marker = ($context || $editor).find('span#selection-marker-' + this._getPos(pos));\n\n        return ($marker.length !== 0) ? $marker.get() : false;\n    },\n    restore: function()\n    {\n        var start = this.find('start');\n        var end = this.find('end');\n\n        var range = this.selection.getRange();\n        if (!range || !this.selection.is())\n        {\n            this.editor.focus();\n            range = document.createRange();\n        }\n\n        if (start)\n        {\n            var prev = (end) ? end.previousSibling : false;\n            var next = start.nextSibling;\n            next = (next && next.nodeType === 3 && next.textContent.replace(/[\\n\\t]/g, '') === '') ? false : next;\n\n            if (!end)\n            {\n                if (next)\n                {\n                    range.selectNodeContents(next);\n                    range.collapse(true);\n                }\n                else\n                {\n                    this._restoreInject(range, start);\n                }\n            }\n            else if (next && next.id === 'selection-marker-end')\n            {\n                this._restoreInject(range, start);\n            }\n            else\n            {\n                if (prev && next)\n                {\n                    range.selectNodeContents(prev);\n                    range.collapse(false);\n                    range.setStart(next, 0);\n                }\n                else if (prev && !next)\n                {\n                    range.selectNodeContents(prev);\n                    range.collapse(false);\n                    range.setStartAfter(start);\n                }\n                else\n                {\n                    range.setStartAfter(start);\n                    range.setEndBefore(end);\n                }\n            }\n\n            this.selection.setRange(range);\n\n            if (start) start.parentNode.removeChild(start);\n            if (end) end.parentNode.removeChild(end);\n        }\n    },\n    remove: function()\n    {\n        var start = this.find('start');\n        var end = this.find('end');\n\n        if (start) start.parentNode.removeChild(start);\n        if (end) end.parentNode.removeChild(end);\n    },\n\n    // private\n    _getPos: function(pos)\n    {\n        return (pos === undefined) ? 'start' : pos;\n    },\n    _restoreInject: function(range, start)\n    {\n        var textNode = this.utils.createInvisibleChar();\n        $R.dom(start).after(textNode);\n\n        range.selectNodeContents(textNode);\n        range.collapse(false);\n    }\n});\n$R.add('service', 'component', {\n    init: function(app)\n    {\n        this.app = app;\n\n        // local\n        this.activeClass = 'redactor-component-active';\n    },\n    create: function(type, el)\n    {\n        return $R.create(type + '.component', this.app, el);\n    },\n    build: function(el)\n    {\n        var $el = $R.dom(el);\n        var component;\n        var type = $el.attr('data-redactor-type');\n        if (type)\n        {\n            component = this.create(type, el);\n        }\n\n        return (component) ? component : el;\n    },\n    remove: function(el, caret)\n    {\n        var $component = $R.dom(el).closest('.redactor-component');\n        var type = $component.attr('data-redactor-type');\n        var current = $component.parent();\n        var data = this.inspector.parse(current);\n        var prev = this.utils.findSiblings($component, 'prev');\n        var next = this.utils.findSiblings($component, 'next');\n        var stop = this.app.broadcast(type + '.delete', $component);\n        if (stop !== false)\n        {\n            $component.remove();\n\n            // callback\n            this.app.broadcast(type + '.deleted', $component);\n            this.app.broadcast('contextbar.close');\n            this.app.broadcast('imageresizer.stop');\n\n            if (caret !== false)\n            {\n                var cell = data.getTableCell();\n                if (cell && this.utils.isEmptyHtml(cell.innerHTML))\n                {\n                    this.caret.setStart(cell);\n                }\n                else if (next) this.caret.setStart(next);\n                else if (prev) this.caret.setEnd(prev);\n                else\n                {\n                    this.editor.startFocus();\n                }\n            }\n\n            // is empty\n            if (this.editor.isEmpty())\n            {\n                this.editor.setEmpty();\n                this.editor.startFocus();\n                this.app.broadcast('empty');\n            }\n        }\n    },\n    isNonEditable: function(el)\n    {\n        var data = this.inspector.parse(el);\n        return (data.isComponent() && !data.isComponentEditable());\n    },\n    isActive: function(el)\n    {\n        var $component;\n        if (el)\n        {\n            var data = this.inspector.parse(el);\n            $component = $R.dom(data.getComponent());\n\n            return $component.hasClass(this.activeClass);\n        }\n        else\n        {\n            $component = this._find();\n\n            return ($component.length !== 0);\n        }\n    },\n    getActive: function(dom)\n    {\n        var $component = this._find();\n\n        return ($component.length !== 0) ? ((dom) ? $component : $component.get()) : false;\n    },\n    setActive: function(el)\n    {\n        this.clearActive();\n        this.editor.focus();\n\n        var data = this.inspector.parse(el);\n        var component = data.getComponent();\n        var $component = $R.dom(component);\n\n        if (!data.isFigcaption())\n        {\n            var $caret = $component.find('.redactor-component-caret');\n            if ($caret.length === 0)\n            {\n                $caret = this._buildCaret();\n                $component.prepend($caret);\n            }\n\n            this.caret.setAtStart($caret.get());\n        }\n\n        $component.addClass(this.activeClass);\n    },\n    clearActive: function()\n    {\n        var $component = this._find();\n\n        $component.removeClass(this.activeClass);\n        $component.find('.redactor-component-caret').remove();\n\n        this.app.broadcast('imageresizer.stop');\n    },\n    setOnEvent: function(e, contextmenu)\n    {\n        this.clearActive();\n\n        var data = this.inspector.parse(e.target);\n        if (data.isFigcaption() || data.isComponentEditable())\n        {\n            return;\n        }\n\n        // component\n        if (data.isComponent())\n        {\n            this.setActive(e.target);\n            if (contextmenu !== true) e.preventDefault();\n        }\n    },\n    executeScripts: function(scripts)\n    {\n        if (scripts === undefined)\n        {\n            var $editor = this.editor.getElement();\n            var scripts = $editor.find('[data-redactor-type]').find(\"script\").getAll();\n            this.executeScripts.call(this, scripts);\n        }\n        else\n        {\n            for (var i = 0; i < scripts.length; i++)\n            {\n                if (scripts[i].src !== '')\n                {\n                    var src = scripts[i].src;\n                    this.$doc.find('head script[src=\"' + src + '\"]').remove();\n\n                    var $script = $R.dom('<script>');\n                    $script.attr('src', src);\n                    $script.attr('async defer');\n                    $script.get().onload = function()\n                    {\n                        if (src.search('instagram') !== -1) window.instgrm.Embeds.process();\n                        this.executeScripts(scripts.slice(i + 1));\n                    }.bind(this);\n\n                    var head = document.getElementsByTagName('head')[0];\n                    if (head) head.appendChild($script.get());\n\n                    break;\n                }\n                else\n                {\n                    try {\n                        eval(scripts[i].innerHTML);\n                    } catch (e) {}\n                }\n            }\n        }\n    },\n\n    // private\n    _find: function()\n    {\n        return this.editor.getElement().find('.' + this.activeClass);\n    },\n    _buildCaret: function()\n    {\n        var $caret = $R.dom('<span>');\n        $caret.addClass('redactor-component-caret');\n        $caret.attr('contenteditable', true);\n\n        return $caret;\n    }\n});\n$R.add('service', 'insertion', {\n    init: function(app)\n    {\n        this.app = app;\n    },\n    set: function(html, clean, focus)\n    {\n        if (html === null) {\n            html = '';\n        }\n\n        html = (clean !== false) ? this.cleaner.input(html) : html;\n        html = (clean !== false) ? this.cleaner.paragraphize(html) : html;\n\n        // set html\n        var $editor = this.editor.getElement();\n        $editor.html(html);\n\n        // set focus at the end\n        if (focus !== false) this.editor.endFocus();\n\n        return html;\n    },\n    insertNode: function(node, caret)\n    {\n        this.editor.focus();\n        var fragment = (this.utils.isFragment(node)) ? node : this.utils.createFragment(node);\n\n        this._collapseSelection();\n        this._insertFragment(fragment);\n        this._setCaret(caret, fragment);\n\n        return this._sendNodes(fragment.nodes);\n    },\n    insertBreakLine: function()\n    {\n        return this.insertNode(document.createElement('br'), 'after');\n    },\n    insertNewline: function()\n    {\n        return this.insertNode(document.createTextNode('\\n'), 'after');\n    },\n    insertText: function(text)\n    {\n        return this.insertHtml(this.cleaner.getFlatText(text));\n    },\n    insertChar: function(charhtml)\n    {\n        return this.insertNode(charhtml, 'after');\n    },\n    insertRaw: function(html)\n    {\n        return this.insertHtml(html, false);\n    },\n    insertToEnd: function(lastNode, type)\n    {\n        if (!lastNode) return;\n        if (lastNode.nodeType === 3 && lastNode.nodeValue.search(/^\\n/) !== -1)\n        {\n            lastNode = lastNode.previousElementSibling;\n        }\n\n        var $lastNode = $R.dom(lastNode);\n        if ($lastNode.attr('data-redactor-type') === type)\n        {\n            var tag = (this.opts.breakline) ? '<br>' : '<p>';\n            var $newNode = $R.dom(tag);\n\n            $lastNode.after($newNode);\n            this.caret.setStart($newNode);\n        }\n    },\n    insertPoint: function(e)\n    {\n        var range, data;\n        var marker = this.marker.build('start');\n        var markerInserted = false;\n        var x = e.clientX, y = e.clientY;\n\n        if (document.caretPositionFromPoint)\n        {\n            var pos = document.caretPositionFromPoint(x, y);\n            var sel = document.getSelection();\n\n            data = this.inspector.parse(pos.offsetNode);\n            if (data.isInEditor())\n            {\n                range = sel.getRangeAt(0);\n                range.setStart(pos.offsetNode, pos.offset);\n                range.collapse(true);\n                range.insertNode(marker);\n                markerInserted = true;\n            }\n        }\n        else if (document.caretRangeFromPoint)\n        {\n            range = document.caretRangeFromPoint(x, y);\n\n            data = this.inspector.parse(range.startContainer);\n            if (data.isInEditor())\n            {\n                range.insertNode(marker);\n                markerInserted = true;\n            }\n        }\n\n        return markerInserted;\n    },\n    insertToPoint: function(e, html, point, clean)\n    {\n        var pointInserted = (point === true) ? true : this.insertPoint(e);\n        if (!pointInserted)\n        {\n            var lastNode = this.editor.getLastNode();\n            $R.dom(lastNode).after(this.marker.build('start'));\n        }\n\n        this.component.clearActive();\n        this.selection.restoreMarkers();\n\n        return this.insertHtml(html, clean);\n    },\n    insertToOffset: function(start, html)\n    {\n        this.offset.set({ start: start, end: start });\n\n        return this.insertHtml(html);\n    },\n    insertHtml: function(html, clean)\n    {\n        if (!this.opts.input) return;\n\n        // parse\n        var parsedInput = this.utils.parseHtml(html);\n\n        // all selection\n        if (this.selection.isAll())\n        {\n            return this._insertToAllSelected(parsedInput);\n        }\n\n        // there is no selection\n        if (!this.selection.is())\n        {\n            var $el = $R.dom('<p>');\n            var $editor = this.editor.getElement();\n\n            $editor.append($el);\n            this.caret.setStart($el);\n        }\n\n        // environment\n        var isCollapsed = this.selection.isCollapsed();\n        var isText = this.selection.isText();\n        var current = this.selection.getCurrent();\n        var block = this.selection.getBlock();\n        var dataCurrent = this.inspector.parse(current);\n\n        // collapse air\n        this._collapseSelection();\n\n        // clean\n        parsedInput = this._getCleanedInput(parsedInput, dataCurrent, clean);\n\n        // input is figure or component span\n        var isFigure = this._isFigure(parsedInput.html);\n        var isComponentSpan = this._isComponentSpan(parsedInput.html);\n        var isInsertedText = this.inspector.isText(parsedInput.html);\n        var fragment, except;\n\n        // empty editor\n        if (this.editor.isEmpty())\n        {\n            return this._insertToEmptyEditor(parsedInput.html);\n        }\n        // to component\n        else if (dataCurrent.isComponent() && !dataCurrent.isComponentEditable())\n        {\n            return this._insertToWidget(current, dataCurrent, parsedInput.html);\n        }\n        // component span\n        else if (isComponentSpan)\n        {\n            return this.insertNode(parsedInput.nodes, 'end');\n        }\n        // inserting figure & split node\n        else if (isFigure && !isText && !dataCurrent.isList())\n        {\n            if (dataCurrent.isInline())\n            {\n                return this._insertToInline(current, parsedInput);\n            }\n\n            fragment = this.utils.createFragment(parsedInput.html);\n            this.utils.splitNode(current, fragment);\n            this.caret.setEnd(fragment.last);\n\n            return this._sendNodes(fragment.nodes);\n        }\n        // to code\n        else if (dataCurrent.isCode())\n        {\n            return this._insertToCode(parsedInput, current, clean);\n        }\n        // to pre\n        else if (dataCurrent.isPre())\n        {\n            return this._insertToPre(parsedInput, clean);\n        }\n        // to h1-h6 & figcaption\n        else if (dataCurrent.isHeading() || dataCurrent.isFigcaption())\n        {\n            parsedInput.html = (clean !== false) ? this.cleaner.removeTagsExcept(parsedInput.html, ['a']) : parsedInput.html;\n            parsedInput.html = (clean !== false) ? this.cleaner.replaceNbspToSpaces(parsedInput.html) : parsedInput.html;\n\n            fragment = this.utils.createFragment(parsedInput.html);\n\n            return this.insertNode(fragment, 'end');\n        }\n        // breakline div\n        else if (this.opts.breakline && block && block.tagName === 'DIV') {\n\n            parsedInput.html = (clean !== false) ? this.cleaner.paragraphize(parsedInput.html) : parsedInput.html;\n\n            fragment = this.utils.createFragment(parsedInput.html);\n\n            var range = this.selection.getRange();\n            if (range && this.selection.isCollapsed()) {\n                range.deleteContents();\n            }\n\n            this.utils.splitNode(current, fragment);\n            this.caret.setEnd(fragment.last);\n\n            return this._sendNodes(fragment.nodes);\n        }\n        // text inserting\n        else if (isInsertedText)\n        {\n            if (!isText && this.opts.markup !== 'br' && this._hasBlocksAndImages(parsedInput.nodes))\n            {\n                parsedInput.html = (clean !== false) ? this.cleaner.paragraphize(parsedInput.html) : parsedInput.html;\n\n                fragment = this.utils.createFragment(parsedInput.html);\n\n                this.utils.splitNode(current, fragment);\n                this.caret.setEnd(fragment.last);\n                return this._sendNodes(fragment.nodes);\n            }\n\n            parsedInput.html = (clean !== false) ? parsedInput.html.replace(/\\n/g, '<br>') : parsedInput.html;\n\n            fragment = this.utils.createFragment(parsedInput.html);\n\n            return this.insertNode(fragment.nodes, 'end');\n        }\n        // uncollapsed\n        else if (!isCollapsed && !isFigure)\n        {\n            parsedInput.html = (clean !== false) ? this.cleaner.paragraphize(parsedInput.html) : parsedInput.html;\n\n            fragment = this.utils.createFragment(parsedInput.html);\n\n            return this.insertNode(fragment, 'end');\n        }\n        // to inline tag\n        else if (dataCurrent.isInline() && !this._isPlainHtml(parsedInput.html))\n        {\n            return this._insertToInline(current, parsedInput);\n        }\n        // to blockquote or dt, dd\n        else if (dataCurrent.isBlockquote() || dataCurrent.isDl())\n        {\n            except = this.opts.inlineTags;\n            except.concat(['br']);\n\n            parsedInput.html = (clean !== false) ? this.cleaner.replaceBlocksToBr(parsedInput.html) : parsedInput.html;\n            parsedInput.html = (clean !== false) ? this.cleaner.removeTagsExcept(parsedInput.html, except) : parsedInput.html;\n\n            fragment = this.utils.createFragment(parsedInput.html);\n\n            return this.insertNode(fragment, 'end');\n        }\n        // to p\n        else if (dataCurrent.isParagraph())\n        {\n            if (this._isPlainHtml(parsedInput.html))\n            {\n                return this.insertNode(parsedInput.nodes, 'end');\n            }\n\n            parsedInput.html = (clean !== false) ? this.cleaner.paragraphize(parsedInput.html) : parsedInput.html;\n\n            fragment = this.utils.createFragment(parsedInput.html);\n\n            this.utils.splitNode(current, fragment);\n            this.caret.setEnd(fragment.last);\n\n            return this._sendNodes(fragment.nodes);\n        }\n        // to li\n        else if (dataCurrent.isList())\n        {\n            except = this.opts.inlineTags;\n            except = except.concat(['br', 'li', 'ul', 'ol', 'img']);\n\n            parsedInput.html = (clean !== false) ? this.cleaner.replaceBlocksToBr(parsedInput.html) : parsedInput.html;\n            parsedInput.html = (clean !== false) ? this.cleaner.removeTagsExcept(parsedInput.html, except) : parsedInput.html;\n            parsedInput.html = (clean !== false) ? this.cleaner.removeBrAtEnd(parsedInput.html) : parsedInput.html;\n\n            fragment = this.utils.createFragment(parsedInput.html);\n            parsedInput.nodes = fragment.nodes;\n\n            if (this._containsTags(parsedInput.html, ['ul', 'ol', 'li']))\n            {\n                var element = this.selection.getElement(current);\n                if (element && element.tagName === 'LI' && this.caret.isStart(element))\n                {\n                    parsedInput.nodes = $R.dom(fragment.nodes).unwrap('ul, ol').getAll();\n                    $R.dom(element).before(parsedInput.nodes);\n\n                    var lastNode = parsedInput.nodes[parsedInput.nodes.length-1];\n                    this.caret.setEnd(lastNode);\n\n                    return this._sendNodes(parsedInput.nodes);\n                }\n                else if (this._isPlainHtml(parsedInput.html))\n                {\n                    return this.insertNode(fragment, 'end');\n                }\n                else\n                {\n                    fragment = this._buildList(parsedInput, element, fragment);\n\n                    this.utils.splitNode(current, fragment, true);\n                    this.caret.setEnd(fragment.last);\n\n                    return this._sendNodes(fragment.nodes);\n                }\n            }\n        }\n\n        // other cases\n        return this.insertNode(parsedInput.nodes, 'end');\n    },\n\n    // private\n    _insertToAllSelected: function(parsedInput)\n    {\n        var insertedHtml = this.set(parsedInput.html);\n        var dataInserted = this.utils.parseHtml(insertedHtml);\n\n        return this._sendNodes(dataInserted.nodes);\n    },\n    _insertToEmptyEditor: function(html)\n    {\n        html = this.cleaner.paragraphize(html);\n\n        var fragment = this.utils.createFragment(html);\n        var $editor = this.editor.getElement();\n\n        $editor.html('');\n        $editor.append(fragment.frag);\n\n        this.caret.setEnd(fragment.last);\n\n        return this._sendNodes(fragment.nodes);\n    },\n    _insertToInline: function(current, parsedInput)\n    {\n        var fragment = this.utils.createFragment(parsedInput.html);\n        this.utils.splitNode(current, fragment, false, true);\n        this.caret.setEnd(fragment.last);\n\n        return this._sendNodes(fragment.nodes);\n    },\n    _insertToCode: function(parsedInput, current, clean)\n    {\n        parsedInput.html = (clean !== false) ? this.cleaner.encodeHtml(parsedInput.html) : parsedInput.html;\n        parsedInput.html = (clean !== false) ? this.cleaner.removeNl(parsedInput.html) : parsedInput.html;\n\n        var fragment = this.utils.createFragment(parsedInput.html);\n        var nodes = this.insertNode(fragment, 'end');\n\n        this.utils.normalizeTextNodes(current);\n\n        return nodes;\n    },\n    _insertToPre: function(parsedInput, clean)\n    {\n        parsedInput.html = (clean !== false) ? this.cleaner.encodeHtml(parsedInput.html) : parsedInput.html;\n\n        var fragment = this.utils.createFragment(parsedInput.html);\n\n        return this.insertNode(fragment, 'end');\n    },\n    _insertToWidget: function(current, dataCurrent, html)\n    {\n        html = (this._isComponentSpan(html)) ? html : this.cleaner.paragraphize(html);\n\n        var fragment = this.utils.createFragment(html);\n        var component = dataCurrent.getComponent();\n        var $component = $R.dom(component);\n\n        $component.after(fragment.frag);\n        $component.remove();\n\n        this.caret.setEnd(fragment.last);\n\n        return this._sendNodes(fragment.nodes);\n    },\n    _insertFragment: function(fragment)\n    {\n        var range = this.selection.getRange();\n        if (range)\n        {\n            if (this.selection.isCollapsed())\n            {\n                var startNode = range.startContainer;\n                if (startNode.nodeType !== 3 && startNode.tagName === 'BR')\n                {\n                    this.caret.setAfter(startNode);\n                    startNode.parentNode.removeChild(startNode);\n                }\n            }\n            else\n            {\n                range.deleteContents();\n            }\n\n            range.insertNode(fragment.frag);\n        }\n    },\n    _sendNodes: function(nodes)\n    {\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var el = nodes[i];\n            var type = (el.nodeType !== 3 && typeof el.getAttribute === 'function') ? el.getAttribute('data-redactor-type') : false;\n            if (type)\n            {\n                this.app.broadcast(type + '.inserted', this.component.build(el));\n            }\n        }\n\n        if (this.detector.isIe())\n        {\n            this.editor.getElement().find('[data-redactor-type=table]').attr('contenteditable', true);\n        }\n\n        // callback\n        this.app.broadcast('inserted', nodes);\n\n        // widget's scripts\n        this.component.executeScripts();\n\n        return nodes;\n    },\n    _setCaret: function(caret, fragment)\n    {\n        var isLastInline = this._isLastInline(fragment);\n\n        if (caret)\n        {\n            caret = (isLastInline && caret === 'end') ? 'after' : caret;\n            this.caret['set' + this.utils.ucfirst(caret)](fragment.last);\n        }\n        else if (caret !== false)\n        {\n            if (isLastInline) this.caret.setAfter(fragment.last);\n        }\n    },\n    _isLastInline: function(fragment)\n    {\n        if (fragment.last)\n        {\n            var data = this.inspector.parse(fragment.last);\n\n            return data.isInline();\n        }\n\n        return false;\n    },\n    _getCleanedInput: function(parsedInput, dataCurrent, clean)\n    {\n        var isPreformatted = (dataCurrent.isCode() || dataCurrent.isPre());\n\n        parsedInput.html = parsedInput.html.replace(/&nbsp;/g, ' ');\n        parsedInput.html = (!isPreformatted && clean !== false) ? this.cleaner.input(parsedInput.html) : parsedInput.html;\n        parsedInput = (!isPreformatted && clean !== false) ? this.utils.parseHtml(parsedInput.html) : parsedInput;\n\n        return parsedInput;\n    },\n    _getContainer: function(nodes)\n    {\n        return $R.dom(this.utils.createTmpContainer(nodes));\n    },\n    _buildList: function(parsedInput, list, fragment)\n    {\n        var nodes = parsedInput.nodes;\n        var first = nodes[0];\n\n        if (first && first.nodeType !== 3 && first.tagName === 'li')\n        {\n            var $parent = $R.dom(list);\n            var parentListTag = $parent.get().tagName.toLowerCase();\n            var $list = $R.dom('<' + parentListTag + ' />');\n            $list.append(fragment.nodes);\n\n            return this.utils.createFragment($list.get().outerHTML);\n        }\n\n        return fragment;\n    },\n    _containsTags: function(html, tags)\n    {\n        return (this._getContainer(html).find(tags.join(',')).length !== 0);\n    },\n    _collapseSelection: function()\n    {\n        //if (this.app.isAirToolbar()) this.selection.collapseToEnd();\n    },\n    _hasFigureOrTable: function(nodes)\n    {\n        return (this._getContainer(nodes).find('figure, table').length !== 0);\n    },\n    _hasBlocks: function(nodes)\n    {\n        return (this._getContainer(nodes).find(this.opts.blockTags.join(',')).length !== 0);\n    },\n    _hasBlocksAndImages: function(nodes)\n    {\n        return (this._getContainer(nodes).find(this.opts.blockTags.join(',') + ',img').length !== 0);\n    },\n    _isPlainHtml: function(html)\n    {\n        return (this._getContainer(html).find(this.opts.blockTags.join(',') + ', img').length === 0);\n    },\n    _isFigure: function(html)\n    {\n        if (this._isHtmlString(html))\n        {\n            return ($R.dom(html).closest('figure').length !== 0);\n        }\n    },\n    _isComponentSpan: function(html)\n    {\n        if (this._isHtmlString(html))\n        {\n            return ($R.dom(html).closest('span.redactor-component').length !== 0);\n        }\n    },\n    _isHtmlString: function(html)\n    {\n        return !(typeof html === 'string' && !/^\\s*<(\\w+|!)[^>]*>/.test(html));\n    }\n});\n$R.add('service', 'block', {\n    init: function(app) {\n        this.app = app;\n        this.tags = ['p', 'div', 'blockquote', 'pre', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6'];\n    },\n    // format\n    format: function(args) {\n\n        // params\n        this.params = {\n            args: false\n        };\n\n        // type of applying styles and attributes\n        this.params.type = (args.type) ? args.type : 'set'; // add, remove, toggle\n\n        // tag\n        this.params.tag = (typeof args === 'string') ? args : (args.tag || this.opts.markup);\n        this.params.tag = this.params.tag.toLowerCase();\n\n        // args\n        this.params.args = {\n            'class': args['class'] || false,\n            'style': args['style'] || false,\n            'attr': args['attr'] || false\n        };\n\n        if (!args['class'] && !args['style'] && !args['attr']) {\n            this.params.args = false;\n        }\n\n        // format\n        return this._format();\n    },\n\n    // funcs\n    add: function(args, tags) {\n        return this._apply('add', args, tags);\n    },\n    set: function(args, tags) {\n        return this._apply('set', args, tags);\n    },\n    toggle: function(args, tags) {\n        return this._apply('toggle', args, tags);\n    },\n    remove: function(args, tags) {\n        return this._apply('remove', args, tags);\n    },\n\n    // clear\n    clearFormat: function(tags) {\n        return this._clear(tags, 'all');\n    },\n    clearStyle: function(tags) {\n        return this._clear(tags, 'style');\n    },\n    clearClass: function(tags) {\n        return this._clear(tags, 'class');\n    },\n    clearAttr: function(tags) {\n        return this._clear(tags, 'attr');\n    },\n\n    // format\n    _format: function() {\n\n        var nodes = [];\n\n        // collapsed\n        this.collapsed = this.selection.isCollapsed();\n\n        // save selection\n        this.selection.save();\n\n        // blocks\n        var block = this.selection.getBlock();\n        var blocks = this._getBlocks();\n        var type = (this._isToggleFormatType(blocks)) ? 'toggle' : 'set';\n        var replacedTag = this._getReplacedTag(type);\n\n        nodes = this._replaceBlocks(blocks, replacedTag);\n\n        // apply args & clean\n        nodes = this._buildNodes(nodes);\n\n        // restore selection\n        this._restoreSelection(nodes);\n\n        return nodes;\n    },\n\n\n    // clear\n    _clear: function(tags, type, selection, nodes) {\n        // save selection\n        if (selection !== false) {\n\t\t    this.selection.save();\n\t\t}\n\n        // get elements\n        var $elements = this._getElements(tags, nodes);\n\n        // remove all format\n        if (type === 'all') {\n            this._removeAllAttr($elements, false);\n        }\n        // remove style\n        else if (type === 'style') {\n            $elements.removeAttr('style');\n            $elements.removeAttr('data-redactor-style-cache');\n        }\n        // remove class\n        else if (type === 'class') {\n            $elements.removeAttr('class');\n        }\n        // remove attrs\n        else if (type === 'attr') {\n            this._removeAllAttr($elements);\n        }\n\n        // get nodes\n        nodes = $elements.getAll();\n\n        // restore selection\n        if (selection !== false) {\n            this._restoreSelection(nodes);\n        }\n\n        return nodes;\n    },\n\n    // get\n    _getElements: function(tags, nodes) {\n        return (nodes) ? $R.dom(nodes) : $R.dom(this._getBlocks(tags));\n    },\n    _getBlocks: function(tags) {\n        var blocks = this.selection.getBlocks({ tags: tags || this.tags });\n        var finalBlocks = [];\n        for (var i = 0; i < blocks.length; i++) {\n            if (blocks[i].tagName === 'DIV' && !blocks[i].getAttribute('data-redactor-tag')) {\n                continue;\n            }\n            else {\n                finalBlocks.push(blocks[i]);\n            }\n        }\n\n        return finalBlocks;\n    },\n\n    _getReplacedTag: function(type) {\n        if (this.opts.breakline) {\n            return (type === 'toggle') ? 'div' : (this.params.tag === 'p') ? 'div' : this.params.tag;\n        }\n        else {\n            return (type === 'toggle') ? this.opts.markup : this.params.tag;\n        }\n    },\n\n    // is\n    _isStandardParagraph: function() {\n        return (!this.opts.breakline && this.opts.markup === 'p');\n    },\n    _isStandardDiv: function() {\n        return (!this.opts.breakline && this.opts.markup === 'div');\n    },\n    _isBreaklineBlock: function(block) {\n        return (block && block.tagName === 'DIV' && block.getAttribute('data-redactor-tag') === 'br');\n    },\n    _isToggleFormatType: function(blocks) {\n        var count = 0;\n        var len = blocks.length;\n        for (var i = 0; i < len; i++) {\n            if (blocks[i] && this.params.tag === blocks[i].tagName.toLowerCase()) count++;\n        }\n\n        return (count === len);\n    },\n    _isCurrentBlockOneAndEmpty: function(nodes) {\n        return (this.collapsed && nodes.length === 1 && this.utils.isEmpty(nodes[0]));\n    },\n\n    // build\n    _buildNodes: function(nodes) {\n        if (nodes.length > 0) {\n            // clean & appliyng styles and attributes\n            nodes = this._applyArgs(nodes, false);\n            nodes = this._combinePre(nodes);\n            nodes = this._cleanBlocks(nodes);\n        }\n\n        return nodes;\n    },\n\n    // replace\n    _replaceBlocks: function(blocks, replacedTag) {\n        var nodes = [];\n\n        for (var i = 0; i < blocks.length; i++) {\n            var $node = this.utils.replaceToTag(blocks[i], replacedTag);\n            nodes.push($node.get());\n        }\n\n        return nodes;\n    },\n\n    // combine\n    _combinePre: function(nodes) {\n        var combinedNodes = [];\n        for (var i = 0; i < nodes.length; i++) {\n            var next = nodes[i].nextElementSibling;\n            if (next && nodes[i].tagName === 'PRE' && next.tagName === 'PRE') {\n                var $current = $R.dom(nodes[i]);\n                var $next = $R.dom(next);\n                var newline = document.createTextNode('\\n');\n\n                $current.append(newline);\n                $current.append($next);\n                $next.unwrap('pre');\n            }\n\n            combinedNodes.push(nodes[i]);\n        }\n\n        return combinedNodes;\n    },\n\n    // clean\n    _cleanBlocks: function(nodes) {\n        var headings = ['h1', 'h2', 'h3', 'h4', 'h5', 'h6'];\n        var tags = this.opts.inlineTags;\n        for (var i = 0; i < nodes.length; i++) {\n            var tag = nodes[i].tagName.toLowerCase();\n            var $node = $R.dom(nodes[i]);\n\n            // remove all spans in headings\n            if (headings.indexOf(tag) !== - 1) {\n                $node.find('span').not('.redactor-component, .non-editable, .redactor-selection-marker').unwrap();\n            }\n            // remove all inlines in pre\n            else if (tag === 'pre') {\n                $node.find(tags.join(',')).not('.redactor-selection-marker').unwrap();\n            }\n\n\n            if (this.params.args === false && this.params.tag === 'p') {\n                $node.removeAttr('class');\n            }\n\n            // breakline attr\n            if (this.opts.breakline && tag === 'div') {\n                $node.attr('data-redactor-tag', 'br');\n            }\n            else {\n                $node.removeAttr('data-redactor-tag');\n            }\n\n            // normalize\n            this.utils.normalizeTextNodes(nodes[i]);\n        }\n\n        return nodes;\n    },\n    _cleanEmptyClass: function($elements) {\n        $elements.each(function(node) {\n            if (node.className === '') node.removeAttribute('class');\n        });\n    },\n    _cleanEmptyStyle: function($node) {\n         if (this.utils.removeEmptyAttr($node.get(), 'style')) {\n            $node.removeAttr('data-redactor-style-cache');\n        }\n        else {\n            $node.attr('data-redactor-style-cache', $node.attr('style'));\n        }\n    },\n\n    // apply\n    _apply: function(type, args, tags, selection, nodes) {\n        // save selection\n        if (selection !== false) {\n\t\t    this.selection.save();\n\t\t}\n\n        // get elements\n        var $elements = this._getElements(tags, nodes);\n\n        // class\n        if (args['class']) {\n            if (type === 'set') {\n                $elements.removeAttr('class');\n                $elements.addClass(args['class']);\n            }\n            else if (type === 'add') {\n                $elements.addClass(args['class']);\n            }\n            else if (type === 'toggle') {\n                $elements.toggleClass(args['class']);\n            }\n            else if (type === 'remove') {\n                $elements.removeClass(args['class']);\n            }\n\n            this._cleanEmptyClass($elements);\n        }\n\n        // attr\n        if (args['attr']) {\n            if (type === 'set') {\n                this._removeAllAttr($elements);\n                $elements.attr(args['attr']);\n            }\n            else if (type === 'add') {\n                $elements.attr(args['attr']);\n            }\n            else if (type === 'toggle') {\n                params = args['attr'];\n                $elements.each(function(node) {\n                    var $node = $R.dom(node);\n                    for (var key in params) {\n                        if ($node.attr(key)) $node.removeAttr(key);\n                        else $node.attr(key, params[key]);\n                    }\n                });\n            }\n            else if (type === 'remove') {\n                $elements.removeAttr(args['attr']);\n            }\n        }\n\n        // style\n        if (args['style']) {\n            if (type === 'set') {\n                $elements.removeAttr('style');\n                $elements.css(args['style']);\n                $elements.each(function(node) {\n                    var $node = $R.dom(node);\n                    $node.attr('data-redactor-style-cache', $node.attr('style'));\n                });\n            }\n            else if (type === 'add') {\n                var params = args['style'];\n                $elements.each(function(node) {\n                    var $node = $R.dom(node);\n                    $node.css(params);\n                    $node.attr('data-redactor-style-cache', $node.attr('style'));\n                    this._convertStyleQuotes($node);\n                }.bind(this));\n            }\n            else if (type === 'toggle') {\n                var params = args['style'];\n                $elements.each(function(node) {\n                    var $node = $R.dom(node);\n                    for (var key in params) {\n                        var newVal = params[key];\n                        var oldVal = $node.css(key);\n\n                        oldVal = (this.utils.isRgb(oldVal)) ? this.utils.rgb2hex(oldVal) : oldVal.replace(/\"/g, '');\n                        newVal = (this.utils.isRgb(newVal)) ? this.utils.rgb2hex(newVal) : newVal.replace(/\"/g, '');\n\n                        oldVal = this.utils.hex2long(oldVal);\n                        newVal = this.utils.hex2long(newVal);\n\n                        var compareNew = (typeof newVal === 'string') ? newVal.toLowerCase() : newVal;\n                        var compareOld = (typeof oldVal === 'string') ? oldVal.toLowerCase() : oldVal;\n\n                        if (compareNew === compareOld) $node.css(key, '');\n                        else $node.css(key, newVal);\n                    }\n\n                    this._convertStyleQuotes($node);\n                    this._cleanEmptyStyle($node);\n                }.bind(this));\n            }\n            else if (type === 'remove') {\n                var name = args['style'];\n                $elements.each(function(node) {\n                    var $node = $R.dom(node);\n                    $node.css(name, '');\n                    this._cleanEmptyStyle($node);\n                }.bind(this));\n            }\n        }\n\n        // get nodes\n        nodes = $elements.getAll();\n\n        // restore selection\n        if (selection !== false) {\n            this._restoreSelection(nodes);\n        }\n\n        return nodes;\n    },\n    _applyArgs: function(nodes) {\n        if (this.params.args) {\n            nodes = this._apply(this.params.type, this.params.args, false, false, nodes);\n        }\n        else {\n            nodes = this._clear(false, 'all', false, nodes);\n        }\n\n        return nodes;\n    },\n\n    // remove\n    _removeAllAttr: function($elements, keepStyleAndClass) {\n        $elements.each(function(node) {\n            var keepAttrs = ['data-redactor-tag', 'data-redactor-style-cache'];\n            if (keepStyleAndClass === false) {\n                keepAttrs.push('style');\n                keepAttrs.push('class');\n            }\n\n            for (var i = node.attributes.length; i--> 0;) {\n                var nodeAttr = node.attributes[i];\n                var name = nodeAttr.name;\n                if (keepAttrs.indexOf(name) === -1) {\n                    node.removeAttributeNode(nodeAttr);\n                }\n            }\n        });\n    },\n\n    // selection\n    _restoreSelection: function(nodes) {\n        if (this._isCurrentBlockOneAndEmpty(nodes)) {\n            this.caret.setStart(nodes[0]);\n        }\n        else {\n            setTimeout(function() { this.selection.restore(); }.bind(this), 1);\n        }\n    },\n\n    // convert\n    _convertStyleQuotes: function($node) {\n        var style = $node.attr('style');\n        if (style) $node.attr('style', style.replace(/\"/g, '\\''));\n    }\n});\n$R.add('service', 'inline', {\n    mixins: ['formatter'],\n    init: function(app)\n    {\n        this.app = app;\n\n        this.count = 0;\n    },\n    // public\n    format: function(args)\n    {\n        if (!this._isFormat()) return [];\n\n        // type of applying styles and attributes\n        this.type = (args.type) ? args.type : 'set'; // add, remove, toggle\n        // tag\n        this.tag = (typeof args === 'string') ? args : args.tag;\n        this.tag = this.tag.toLowerCase();\n        this.tag = this.arrangeTag(this.tag);\n\n        if (typeof args === 'string') this.args = false;\n        else this.buildArgs(args);\n\n        if (!this.detector.isIe())\n        {\n            this.editor.disableNonEditables();\n        }\n\n        // format\n        var nodes = (this.selection.isCollapsed()) ? this.formatCollapsed() : this.formatUncollapsed();\n\n        if (!this.detector.isIe())\n        {\n            this.editor.enableNonEditables();\n        }\n\n        return nodes;\n    },\n\n    // private\n    _isFormat: function()\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var isComponent = (data.isComponent() && !data.isComponentType('table') && !data.isFigcaption());\n\n        if (current === false && this.selection.isAll())\n        {\n            return true;\n        }\n        else if (!current || data.isPre() || data.isCode() || isComponent)\n        {\n            return false;\n        }\n\n        return true;\n    },\n    arrangeTag: function(tag)\n    {\n        var replaced = this.opts.replaceTags;\n        for (var key in replaced)\n        {\n            if (tag === key) tag = replaced[key];\n        }\n\n        return tag;\n    },\n    formatCollapsed: function()\n    {\n        var nodes = [];\n        var inline = this.selection.getInlineFirst();\n        var inlines = this.selection.getInlines({ all: true });\n        var $inline = $R.dom(inline);\n        var $parent, parent, $secondPart, extractedContent;\n\n        // 1) not inline\n        if (!inline)\n        {\n            nodes = this.insertInline(nodes);\n        }\n        else\n        {\n            var dataInline = this.inspector.parse(inline);\n            var isEmpty = this.utils.isEmptyHtml(inline.innerHTML);\n\n            // 2) inline is empty\n            if (isEmpty)\n            {\n                // 2.1) has same tag\n                if (inline.tagName.toLowerCase() === this.tag)\n                {\n                    // 2.1.1) has same args or hasn't args\n                    if (this.hasSameArgs(inline))\n                    {\n                        this.caret.setAfter(inline);\n                        $inline.remove();\n\n                        var el = this.selection.getElement();\n                        this.utils.normalizeTextNodes(el);\n                    }\n                    // 2.1.2) has different args and it is span tag\n                    else if (this.tag === 'span')\n                    {\n                        nodes = this.applyArgs([inline], false);\n                        this.caret.setStart(inline);\n                    }\n                    // 2.1.3) has different args and it is not span tag\n                    else\n                    {\n                       nodes = this.insertInline(nodes);\n                    }\n\n                }\n                // 2.2) has another tag\n                else\n                {\n                    // 2.2.1) has parent\n                    if (dataInline.hasParent([this.tag]))\n                    {\n                        $parent = $inline.closest(this.tag);\n                        parent = $parent.get();\n                        if (this.hasSameArgs(parent))\n                        {\n                            $parent.unwrap();\n                            this.caret.setStart(inline);\n                        }\n                        else\n                        {\n                            nodes = this.insertInline(nodes);\n                        }\n                    }\n                    // 2.2.2) hasn't parent\n                    else\n                    {\n                        nodes = this.insertInline(nodes);\n                    }\n                }\n            }\n            // 3) inline isn't empty\n            else\n            {\n                // 3.1) has same tag\n                if (inline.tagName.toLowerCase() === this.tag)\n                {\n                    // 3.1.1) has same args or hasn't args\n                    if (this.hasSameArgs(inline))\n                    {\n                        // insert break\n                        extractedContent = this.utils.extractHtmlFromCaret(inline);\n                        $secondPart = $R.dom('<' + this.tag + ' />');\n                        $secondPart = this.utils.cloneAttributes(inline, $secondPart);\n\n                        $inline.after($secondPart.append(extractedContent));\n\n                        if ($secondPart.html().trim() === '') {\n                            $secondPart.remove();\n                        }\n\n                        this.caret.setAfter(inline);\n                    }\n                    else\n                    {\n                        nodes = this.insertInline(nodes);\n                    }\n                }\n                // 3.2) has another tag\n                else\n                {\n                    // 3.2.1) has parent\n                    if (dataInline.hasParent([this.tag]))\n                    {\n                        $parent = $inline.closest(this.tag);\n                        parent = $parent.get();\n                        if (this.hasSameArgs(parent))\n                        {\n                            // insert break\n                            extractedContent = this.utils.extractHtmlFromCaret(parent, parent);\n                            $secondPart = $R.dom('<' + this.tag + ' />');\n                            $secondPart = this.utils.cloneAttributes(parent, $secondPart);\n\n                            var $breaked, $last;\n                            var z = 0;\n                            inlines = inlines.reverse();\n                            for (var i = 0; i < inlines.length; i++)\n                            {\n                                if (inlines[i] !== parent)\n                                {\n                                    $last = $R.dom('<' + inlines[i].tagName.toLowerCase() + '>');\n                                    if (z === 0)\n                                    {\n                                        $breaked = $last;\n                                    }\n                                    else\n                                    {\n                                        $breaked.append($last);\n                                    }\n\n                                    z++;\n                                }\n                            }\n\n                            $parent.after($secondPart.append(extractedContent));\n                            $parent.after($breaked);\n\n                            this.caret.setStart($last);\n                        }\n                        else\n                        {\n                            nodes = this.insertInline(nodes);\n                        }\n                    }\n                    // 3.2.2) hasn't parent\n                    else\n                    {\n                        nodes = this.insertInline(nodes);\n                    }\n                }\n            }\n        }\n\n        return nodes;\n    },\n    insertInline: function(nodes)\n    {\n        var node = document.createElement(this.tag);\n        nodes = this.insertion.insertNode(node, 'start');\n\n        return this.applyArgs(nodes, false);\n    },\n    hasSameArgs: function(inline)\n    {\n        if (inline.attributes.length === 0 && this.args === false)\n        {\n            return true;\n        }\n        else\n        {\n            var same = true;\n            if (this.args)\n            {\n                var count = 0;\n                for (var key in this.args)\n                {\n                    var $node = $R.dom(inline);\n                    var args = (this.args[key]);\n                    var value = this.utils.toParams(args);\n                    var nodeAttrValue = $node.attr(key);\n\n                    if (args)\n                    {\n                        if (key === 'style')\n                        {\n                            value = value.trim().replace(/;$/, '');\n\n                            var origRules = this.utils.styleToObj($node.attr('style'));\n                            var rules = value.split(';');\n                            var innerCount = 0;\n\n                            for (var i = 0; i < rules.length; i++)\n                            {\n                                var arr = rules[i].split(':');\n                                var ruleName = arr[0].trim();\n                                var ruleValue = arr[1].trim();\n\n                                if (ruleName.search(/color/) !== -1)\n                                {\n                                    var val = $node.css(ruleName);\n                                    if (val && (val === ruleValue || this.utils.rgb2hex(val) === ruleValue))\n                                    {\n                                        innerCount++;\n                                    }\n                                }\n                                else if ($node.css(ruleName) === ruleValue)\n                                {\n                                    innerCount++;\n                                }\n                            }\n\n                            if (innerCount === rules.length && Object.keys(origRules).length === rules.length)\n                            {\n                                count++;\n                            }\n                        }\n                        else\n                        {\n                            if (nodeAttrValue === value)\n                            {\n                                count++;\n                            }\n                        }\n                    }\n                    else\n                    {\n                        if (!nodeAttrValue || nodeAttrValue === '')\n                        {\n                            count++;\n                        }\n                    }\n                }\n\n                same = (count === Object.keys(this.args).length);\n            }\n\n            return same;\n        }\n    },\n    formatUncollapsed: function()\n    {\n        var inlines = this.selection.getInlines({ all: true, inside: true });\n\n        if (this.detector.isIe()) this.selection.saveMarkers();\n        else this.selection.save();\n\n        // convert del / u\n        this._convertTags('u');\n        this._convertTags('del');\n\n        // convert target tags\n        this._convertToStrike(inlines);\n\n        if (this.detector.isIe()) this.selection.restoreMarkers();\n        else this.selection.restore();\n\n        // apply strike\n        document.execCommand('strikethrough');\n\n        // clear decoration\n        this._clearDecoration();\n\n        this.selection.save();\n\n        // revert and set style\n        var nodes = this._revertToInlines();\n        nodes = this.applyArgs(nodes, false);\n\n        // unwrap if attributes was removed\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var node = nodes[i];\n            var tag = node.tagName.toLowerCase();\n            var len = node.attributes.length;\n\n            if (tag === this.tag && len === 0 && this.args)\n            {\n                $R.dom(node).unwrap();\n                nodes.splice(i, 1);\n            }\n        }\n\n        this.selection.restore();\n\n        // clear and normalize\n        this._clearEmptyStyle();\n        nodes = this._normalizeBlocks(nodes);\n\n        return nodes;\n    },\n    _convertTags: function(tag)\n    {\n        if (this.tag !== tag)\n        {\n            var $editor = this.editor.getElement();\n            $editor.find(tag).each(function(node)\n            {\n                var $el = this.utils.replaceToTag(node, 'span');\n                $el.addClass('redactor-convertable-' + tag);\n            }.bind(this));\n        }\n    },\n    _revertTags: function(tag)\n    {\n        var $editor = this.editor.getElement();\n\n        $editor.find('span.redactor-convertable-' + tag).each(function(node)\n        {\n            var $el = this.utils.replaceToTag(node, tag);\n            $el.removeClass('redactor-convertable-' + tag);\n            if (this.utils.removeEmptyAttr($el, 'class')) $el.removeAttr('class');\n\n        }.bind(this));\n    },\n    _convertToStrike: function(inlines)\n    {\n        var selected = this.selection.getText().replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, \"\\\\$&\");\n\n        for (var i = 0; i < inlines.length; i++)\n        {\n            var tag = this.arrangeTag(inlines[i].tagName.toLowerCase());\n            var inline = inlines[i];\n            var $inline = $R.dom(inline);\n            var hasSameArgs = this.hasSameArgs(inline);\n\n            if (tag === this.tag)\n            {\n                if (this.tag === 'span' && this._isTextSelected(inline, selected))\n                {\n                    $inline.addClass('redactor-convertable-apply');\n                }\n                else if (hasSameArgs && this.tag !== 'a')\n                {\n                    this._replaceToStrike($inline);\n                }\n                else if (this.tag === 'span')\n                {\n                    $inline.addClass('redactor-unconvertable-apply');\n                }\n                else if (!hasSameArgs)\n                {\n                    $inline.addClass('redactor-convertable-apply');\n                }\n            }\n        }\n    },\n    _replaceToStrike: function($el)\n    {\n        $el.replaceWith(function()\n        {\n            return $R.dom('<strike>').append($el.contents());\n        });\n    },\n    _revertToInlines: function()\n    {\n        var nodes = [];\n        var $editor = this.editor.getElement();\n\n        if (this.tag !== 'u') $editor.find('u').unwrap();\n\n        $editor.find('.redactor-convertable-u').each(function(node)\n        {\n             nodes.push(node);\n\n        }.bind(this));\n\n        // span convertable\n        $editor.find('.redactor-convertable-apply').each(function(node)\n        {\n            var $node = $R.dom(node);\n            $node.find('strike').unwrap();\n\n            this._forceRemoveClass($node, 'redactor-convertable-apply');\n            nodes.push(node);\n\n        }.bind(this));\n\n        // span unconvertable\n        $editor.find('span.redactor-unconvertable-apply').each(function(node)\n        {\n            var $node = $R.dom(node);\n            this._forceRemoveClass($node, 'redactor-unconvertable-apply');\n\n        }.bind(this));\n\n        // strike\n        $editor.find('strike').each(function(node)\n        {\n            var $node = this.utils.replaceToTag(node, this.tag);\n            nodes.push($node.get());\n\n        }.bind(this));\n\n\n        this._revertTags('u');\n        this._revertTags('del');\n\n        return nodes;\n    },\n    _normalizeBlocks: function(nodes)\n    {\n        var tags = this.opts.inlineTags;\n        var blocks = this.selection.getBlocks();\n        if (blocks)\n        {\n            for (var i = 0; i < blocks.length; i++)\n            {\n                if (blocks[i].tagName === 'PRE')\n                {\n                    var $node = $R.dom(blocks[i]);\n                    $node.find(tags.join(',')).not('.redactor-selection-marker').each(function(inline)\n                    {\n                        if (nodes.indexOf(inline) !== -1)\n                        {\n                            nodes = this.utils.removeFromArrayByValue(nodes, inline);\n                        }\n\n                        $R.dom(inline).unwrap();\n                    }.bind(this));\n                }\n            }\n        }\n\n        return nodes;\n    },\n    _clearDecoration: function()\n    {\n        var $editor = this.editor.getElement();\n        $editor.find(this.opts.inlineTags.join(',')).each(function(node)\n        {\n            if (node.style.textDecoration === 'line-through' || node.style.textDecorationLine === 'line-through')\n            {\n                var $el = $R.dom(node);\n                $el.css('textDecorationLine', '');\n                $el.css('textDecoration', '');\n                $el.wrap('<strike>');\n            }\n        });\n    },\n    _clearEmptyStyle: function()\n    {\n        var inlines = this.getInlines();\n        for (var i = 0; i < inlines.length; i++)\n        {\n            this._clearEmptyStyleAttr(inlines[i]);\n\n            var childNodes = inlines[i].childNodes;\n            if (childNodes)\n            {\n                for (var z = 0; z < childNodes.length; z++)\n                {\n                    this._clearEmptyStyleAttr(childNodes[z]);\n                }\n            }\n        }\n    },\n    _clearEmptyStyleAttr: function(node)\n    {\n        if (node.nodeType !== 3 && this.utils.removeEmptyAttr(node, 'style'))\n        {\n            node.removeAttribute('style');\n            node.removeAttribute('data-redactor-style-cache');\n        }\n    },\n    _forceRemoveClass: function($node, classname)\n    {\n        $node.removeClass(classname);\n        if (this.utils.removeEmptyAttr($node, 'class')) $node.removeAttr('class');\n    },\n    _isTextSelected: function(node, selected)\n    {\n        var text = this.utils.removeInvisibleChars(node.textContent);\n\n        return (selected === text || selected.search(new RegExp('^' + this.utils.escapeRegExp(text) + '$')) !== -1);\n    },\n\n    getInlines: function(tags)\n    {\n        return (tags) ? this.selection.getInlines({ tags: tags, all: true }) : this.selection.getInlines({ all: true });\n    },\n    getElements: function(tags)\n    {\n        return $R.dom(this.getInlines(tags));\n    },\n    clearFormat: function()\n    {\n        this.selection.save();\n\n        var nodes = this.selection.getInlines({ all: true });\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var $el = $R.dom(nodes[i]);\n            var inline = this.selection.getInline(nodes[i]);\n            if (inline)\n            {\n                $el.unwrap();\n            }\n        }\n\n        this.selection.restore();\n    }\n});\n$R.add('service', 'autoparser', {\n    init: function(app)\n    {\n        this.app = app;\n        this.cleaner = this.app.cleaner;\n    },\n    observe: function()\n    {\n        var $editor = this.editor.getElement();\n        var $objects = $editor.find('.redactor-autoparser-object').each(function(node)\n        {\n           var $node = $R.dom(node);\n           $node.removeClass('redactor-autoparser-object');\n           if ($node.attr('class') === '') $node.removeAttr('class');\n        });\n\n        if ($objects.length > 0)\n        {\n            $objects.each(function(node)\n            {\n                var type;\n                var $object = false;\n                var tag = node.tagName;\n\n                if (tag === 'A') type = 'link';\n                else if (tag === 'IMG') type = 'image';\n                else if (tag === 'IFRAME') type = 'video';\n\n                if (type)\n                {\n                    $object = $R.create(type + '.component', this.app, node);\n                    this.app.broadcast(type + '.inserted', $object);\n                    this.app.broadcast('autoparse', type, $object);\n                }\n\n            }.bind(this));\n        }\n    },\n    format: function(e, key)\n    {\n        if (this._isKey(key))\n        {\n            this._format(key === this.keycodes.ENTER);\n        }\n    },\n    parse: function(html)\n    {\n        var tags = ['figure', 'form', 'pre', 'iframe', 'code', 'a', 'img'];\n        var stored = [];\n        var z = 0;\n\n        // store\n        var storedComments = [];\n        html = this.cleaner.storeComments(html, storedComments);\n\n        // encode\n        html = this.cleaner.encodeCode(html);\n\n        // converting entity\n        html = html.replace(/\\$/g, '&#36;');\n        html = html.replace(/&amp;/g, '&');\n\n        // store tags\n        for (var i = 0; i < tags.length; i++)\n        {\n            var reTags = (tags[i] === 'img') ? '<' + tags[i] + '[^>]*>' : '<' + tags[i] + '([\\\\w\\\\W]*?)</' + tags[i] + '>';\n            var matched = html.match(new RegExp(reTags, 'gi'));\n\n            if (matched !== null)\n            {\n                for (var y = 0; y < matched.length; y++)\n                {\n                    html = html.replace(matched[y], '#####replaceparse' + z + '#####');\n                    stored.push(matched[y]);\n                    z++;\n                }\n            }\n        }\n\n        // images\n        if (this.opts.autoparseImages && html.match(this.opts.regex.imageurl))\n        {\n            var imagesMatches = html.match(this.opts.regex.imageurl);\n            for (var i = 0; i < imagesMatches.length; i++)\n            {\n                html = html.replace(imagesMatches[i], '<img class=\"redactor-autoparser-object\" src=\"' + imagesMatches[i] + '\">');\n            }\n        }\n\n        // video\n        if (this.opts.autoparseVideo && (html.match(this.opts.regex.youtube) || html.match(this.opts.regex.vimeo)))\n        {\n            var iframeStart = '<iframe width=\"500\" height=\"281\" src=\"';\n            var iframeEnd = '\" frameborder=\"0\" allowfullscreen></iframe>';\n\n            var str, re;\n            if (html.match(this.opts.regex.youtube))\n            {\n                str = '//www.youtube.com/embed/$1';\n                re = this.opts.regex.youtube;\n            }\n            else if (html.match(this.opts.regex.vimeo))\n            {\n                str = '//player.vimeo.com/video/$2';\n                re = this.opts.regex.vimeo;\n            }\n\n            var $video = this.component.create('video', iframeStart + str + iframeEnd);\n\n            html = html.replace(re, $video.get().outerHTML);\n        }\n\n        // store tags\n        for (var i = 0; i < tags.length; i++)\n        {\n            var reTags = (tags[i] === 'img') ? '<' + tags[i] + '[^>]*>' : '<' + tags[i] + '([\\\\w\\\\W]*?)</' + tags[i] + '>';\n            var matched = html.match(new RegExp(reTags, 'gi'));\n\n            if (matched !== null)\n            {\n                for (var y = 0; y < matched.length; y++)\n                {\n                    html = html.replace(matched[y], '#####replaceparse' + z + '#####');\n                    stored.push(matched[y]);\n                    z++;\n                }\n            }\n        }\n\n        // links\n        if (this.opts.autoparseLinks && html.match(this.opts.regex.url))\n        {\n            html = this._formatLinks(html);\n        }\n\n        // restore\n        html = this._restoreReplaced(stored, html);\n\n        // repeat for nested tags\n        html = this._restoreReplaced(stored, html);\n\n        // restore comments\n        html = this.cleaner.restoreComments(html, storedComments);\n\n        return html;\n    },\n\n    // private\n    _isKey: function(key)\n    {\n        return (key === this.keycodes.ENTER || key === this.keycodes.SPACE);\n    },\n    _format: function(enter)\n    {\n        var parent = this.selection.getParent();\n        var $parent = $R.dom(parent);\n\n        var isNotFormatted = (parent && $parent.closest('figure, pre, code, img, a, iframe').length !== 0);\n        if (isNotFormatted || !this.selection.isCollapsed())\n        {\n            return;\n        }\n\n        // add split marker\n        var marker = this.utils.createInvisibleChar();\n        var range = this.selection.getRange();\n        range.insertNode(marker);\n\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var $current = $R.dom(current);\n\n        // remove split marker\n        marker.parentNode.removeChild(marker);\n\n        if (current && current.nodeType === 3)\n        {\n            var content = current.textContent;\n            var type;\n\n            // images\n            if (this.opts.autoparseImages && content.match(this._convertToRegExp(this.opts.regex.imageurl)))\n            {\n                var isList = data.isList();\n                var matches = content.match(this.opts.regex.imageurl);\n                var el = (isList) ? undefined : '<figure><img></figure>';\n\n                var $img = this.component.create('image', el);\n                $img.setSrc(matches[0]);\n                $img.addClass('redactor-autoparser-object');\n\n                content = content.replace(matches[0], $img.get().outerHTML);\n                type = 'image';\n            }\n            // video\n            else if (this.opts.autoparseVideo && (content.match(this._convertToRegExp(this.opts.regex.youtube)) || content.match(this._convertToRegExp(this.opts.regex.vimeo))))\n            {\n                var iframeStart = '<iframe width=\"500\" height=\"281\" src=\"';\n                var iframeEnd = '\" frameborder=\"0\" allowfullscreen></iframe>';\n                var str, re;\n\n                if (content.match(this.opts.regex.youtube))\n                {\n                    str = '//www.youtube.com/embed/$1';\n                    re = this.opts.regex.youtube;\n                }\n                else if (content.match(this.opts.regex.vimeo))\n                {\n                    str = '//player.vimeo.com/video/$2';\n                    re = this.opts.regex.vimeo;\n                }\n\n                var $video = this.component.create('video', iframeStart + str + iframeEnd);\n                $video.addClass('redactor-autoparser-object');\n\n                content = content.replace(re, $video.get().outerHTML);\n                type = 'video';\n            }\n            // links\n            else if (this.opts.autoparseLinks && content.match(this._convertToRegExp(this.opts.regex.url)))\n            {\n                content = this._formatLinks(content, enter);\n                type = 'link';\n            }\n\n            // replace\n            if (type)\n            {\n                if (enter)\n                {\n                    this.selection.save();\n                    $current.replaceWith(content);\n                    this.selection.restore();\n                }\n                else\n                {\n                    $current.replaceWith(content);\n                }\n\n                // object\n                var $editor = this.editor.getElement();\n                var $object = $editor.find('.redactor-autoparser-object').removeClass('redactor-autoparser-object');\n                $object = (type === 'link') ? $R.create('link.component', this.app, $object) : $object;\n\n                // caret\n                if (type === 'link')\n                {\n                    if (!enter) this.caret.setAfter($object);\n                    this.app.broadcast('link.inserted', $object);\n                }\n                else\n                {\n                    this.caret.setAfter($object);\n\n                    var $cloned = $object.clone();\n                    $object.remove();\n                    $object = this.insertion.insertHtml($cloned);\n                    $object = this.component.build($object);\n                }\n\n                // callback\n                this.app.broadcast('autoparse', type, $object);\n            }\n        }\n    },\n    _formatLinks: function(content, enter)\n    {\n        var matches = content.match(this.opts.regex.url);\n        var obj = {};\n        for (var i = 0; i < matches.length; i++)\n        {\n            if (enter && matches[i].search(/\\.$/) !== -1)\n            {\n                matches[i] = matches[i].replace(/\\.$/, '');\n            }\n\n            var href = matches[i], text = href;\n            var linkProtocol = (href.match(/(https?|ftp):\\/\\//i) !== null) ? '' : 'http://';\n            var regexB = ([\"/\", \"&\", \"=\"].indexOf(href.slice(-1)) !== -1) ? \"\" : \"\\\\b\";\n            var target = (this.opts.pasteLinkTarget !== false) ? ' target=\"' + this.opts.pasteLinkTarget + '\"' : '';\n\n            text = (text.length > this.opts.linkSize) ? text.substring(0, this.opts.linkSize) + '...' : text;\n            text = (text.search('%') === -1) ? decodeURIComponent(text) : text;\n\n            // escaping url\n            var regexp = '(' + href.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, \"\\\\$&\") + regexB + ')';\n            var classstr = ' class=\"redactor-autoparser-object\"';\n\n            obj[regexp] = '<a href=\"' + linkProtocol + href.trim() + '\"' + target + classstr + '>' + text.trim() + '</a>';\n        }\n\n        // replace\n        for (var key in obj)\n        {\n            content = content.replace(new RegExp(key, 'g'), obj[key]);\n        }\n\n        return content;\n    },\n    _restoreReplaced: function(stored, html)\n    {\n        for (var i = 0; i < stored.length; i++)\n        {\n            html = html.replace('#####replaceparse' + i + '#####', stored[i]);\n        }\n\n        return html;\n    },\n    _convertToRegExp: function(str)\n    {\n        return new RegExp(String(str).replace(/^\\//, '').replace(/\\/ig$/, '').replace(/\\/gi$/, '') + '$', 'gi');\n    }\n});\n$R.add('service', 'storage', {\n    init: function(app)\n    {\n        this.app = app;\n\n        // local\n        this.data = [];\n    },\n    // public\n    observeImages: function()\n    {\n        if (this.opts.imageObserve) {\n            var $editor = this.editor.getElement();\n            var $images = $editor.find('[data-image]');\n            $images.each(this._addImage.bind(this));\n        }\n    },\n    observeFiles: function()\n    {\n        var $editor = this.editor.getElement();\n        var $files = $editor.find('[data-file]');\n\n\t\t$files.each(this._addFile.bind(this));\n    },\n\tsetStatus: function(url, status)\n\t{\n\t\tthis.data[url].status = status;\n\t},\n    getChanges: function()\n    {\n        var $editor = this.editor.getElement();\n\n        // check status\n        for (var key in this.data)\n\t\t{\n\t\t\tvar data = this.data[key];\n\t\t\tvar $el = $editor.find('[data-' + data.type + '=\"' + data.id + '\"]');\n\n\t\t\tthis.setStatus(data.id, ($el.length === 0) ? false : true);\n\t\t}\n\n        return this.data;\n    },\n\tadd: function(type, node)\n\t{\n        var $node = $R.dom(node);\n        var id = $node.attr('data-' + type);\n\n        this.data[id] = { type: type, status: true, node: $node.get(), id: $node.attr('data-' + type) };\n\t},\n\n    // private\n    _addImage: function(node)\n    {\n        this.add('image', node);\n    },\n    _addFile: function(node)\n    {\n        this.add('file', node);\n    }\n});\n$R.add('service', 'utils', {\n    init: function(app)\n    {\n        this.app = app;\n    },\n    // empty\n    isEmpty: function(el)\n    {\n        var isEmpty = false;\n        el = $R.dom(el).get();\n        if (el)\n        {\n            isEmpty = (el.nodeType === 3) ? (el.textContent.trim().replace(/\\n/, '') === '') : (el.innerHTML === '');\n        }\n\n        return isEmpty;\n    },\n    isEmptyHtml: function(html, keepbr, keeplists)\n    {\n        html = this.removeInvisibleChars(html);\n        html = html.replace(/&nbsp;/gi, '');\n        html = html.replace(/<\\/?br\\s?\\/?>/g, ((keepbr) ? 'br' : ''));\n        html = html.replace(/\\s/g, '');\n        html = html.replace(/^<p>[^\\W\\w\\D\\d]*?<\\/p>$/i, '');\n        html = html.replace(/^<div>[^\\W\\w\\D\\d]*?<\\/div>$/i, '');\n\n        if (keeplists)\n        {\n            html = html.replace(/<ul(.*?[^>])>$/i, 'ul');\n            html = html.replace(/<ol(.*?[^>])>$/i, 'ol');\n        }\n\n        html = html.replace(/<hr(.*?[^>])>$/i, 'hr');\n        html = html.replace(/<iframe(.*?[^>])>$/i, 'iframe');\n        html = html.replace(/<source(.*?[^>])>$/i, 'source');\n\n        // remove empty tags\n        html = html.replace(/<[^\\/>][^>]*><\\/[^>]+>/gi, '');\n        html = html.replace(/<[^\\/>][^>]*><\\/[^>]+>/gi, '');\n\n        // trim\n        html = html.trim();\n\n        return html === '';\n    },\n    trimSpaces: function(html)\n    {\n        return html = this.removeInvisibleChars(html.trim());\n    },\n\n    // invisible chars\n    createInvisibleChar: function()\n    {\n        return document.createTextNode(this.opts.markerChar);\n    },\n    searchInvisibleChars: function(str)\n    {\n        return str.search(/^\\uFEFF$/g);\n    },\n    removeInvisibleChars: function(html)\n    {\n        return html.replace(/\\uFEFF/g, '');\n    },\n    trimInvisibleChars: function(direction)\n    {\n        if (!this.selection.isCollapsed()) return;\n\n        var current = this.selection.getCurrent();\n        var side = (direction === 'left') ? this.selection.getTextBeforeCaret() : this.selection.getTextAfterCaret();\n        var isSpace = (current && current.nodeType === 3 && this.searchInvisibleChars(side) === 0);\n\n        if (isSpace)\n        {\n            if (direction === 'left')\n            {\n                $R.dom(current).replaceWith(current.textContent.trim());\n            }\n            else\n            {\n                var offset = this.offset.get();\n                this.offset.set({ start: offset.start + 1, end: offset.end + 1 });\n            }\n        }\n    },\n\n    // wrapper\n    buildWrapper: function(html)\n    {\n        return $R.dom('<div>').html(html);\n    },\n    getWrapperHtml: function($wrapper)\n    {\n        var html = $wrapper.html();\n        $wrapper.remove();\n\n        return html;\n    },\n\n    // fragment\n    createTmpContainer: function(html)\n    {\n        var $div = $R.dom('<div>');\n\n        if (typeof html === 'string')\n        {\n            $div.html(html);\n        }\n        else\n        {\n            $div.append($R.dom(html).clone(true));\n        }\n\n        return $div.get();\n    },\n    createFragment: function(html)\n    {\n        var el = this.createTmpContainer(html);\n        var frag = document.createDocumentFragment(), node, firstNode, lastNode;\n        var nodes = [];\n        var i = 0;\n        while ((node = el.firstChild))\n        {\n            i++;\n            var n = frag.appendChild(node);\n            if (i === 1) firstNode = n;\n\n            nodes.push(n);\n            lastNode = n;\n        }\n\n        return { frag: frag, first: firstNode, last: lastNode, nodes: nodes };\n    },\n    isFragment: function(obj)\n    {\n        return (typeof obj === 'object' && obj.frag);\n    },\n    parseHtml: function(html)\n    {\n        var div = this.createTmpContainer(html);\n\n        return { html: div.innerHTML, nodes: div.childNodes };\n    },\n\n    splitNode: function(current, nodes, isList, inline)\n    {\n        nodes = (this.isFragment(nodes)) ? nodes.frag : nodes;\n\n        var element;\n        if (inline)\n        {\n            element = (this.inspector.isInlineTag(current.tagName)) ? current : this.selection.getInline(current);\n        }\n        else\n        {\n            element = (this.inspector.isBlockTag(current.tagName)) ? current : this.selection.getBlock(current);\n        }\n\n        var $element = $R.dom(element);\n\n        // replace is empty\n        if (!inline && this.isEmptyHtml(element.innerHTML, true))\n        {\n            $element.after(nodes);\n            $element.remove();\n\n            return nodes;\n        }\n\n        var tag = $element.get().tagName.toLowerCase();\n        var isEnd = this.caret.isEnd(element);\n        var isStart = this.caret.isStart(element);\n\n        if (!isEnd && !isStart)\n        {\n            var extractedContent = this.extractHtmlFromCaret(inline);\n\n            var $secondPart = $R.dom('<' + tag + ' />');\n            $secondPart = this.cloneAttributes(element, $secondPart);\n\n            $element.after($secondPart.append(extractedContent));\n        }\n\n        if (isStart)\n        {\n            return $element.before(nodes);\n        }\n        else\n        {\n            if (isList)\n            {\n                return $element.append(nodes);\n            }\n            else\n            {\n                nodes = $element.after(nodes);\n\n                var html = $element.html();\n                html = this.removeInvisibleChars(html);\n                html = html.replace(/&nbsp;/gi, '');\n\n                if (html === '') $element.remove();\n\n                return nodes;\n            }\n        }\n    },\n    extractHtmlFromCaret: function(inline, element)\n    {\n        var range = this.selection.getRange();\n        if (range)\n        {\n            element = (element) ? element : ((inline) ? this.selection.getInline() : this.selection.getBlock());\n            if (element)\n            {\n                var clonedRange = range.cloneRange();\n                clonedRange.selectNodeContents(element);\n                clonedRange.setStart(range.endContainer, range.endOffset);\n\n                return clonedRange.extractContents();\n            }\n        }\n    },\n    createMarkup: function(el)\n    {\n        var markup = document.createElement(this.opts.markup);\n        if (this.opts.breakline) markup.setAttribute('data-redactor-tag', 'br');\n\n        var $el = $R.dom(el);\n\n        $el.after(markup);\n        this.caret.setStart(markup);\n    },\n    createMarkupBefore: function(el)\n    {\n        var markup = document.createElement(this.opts.markup);\n        if (this.opts.breakline) markup.setAttribute('data-redactor-tag', 'br');\n\n        var $el = $R.dom(el);\n\n        $el.before(markup);\n        this.caret.setEnd(markup);\n    },\n    getNode: function(el)\n    {\n        var node = $R.dom(el).get();\n        var editor = this.editor.getElement().get();\n\n        return (typeof el === 'undefined') ? editor : ((node) ? node : false);\n    },\n    findSiblings: function(node, type)\n    {\n        node = $R.dom(node).get();\n        type = (type === 'next') ? 'nextSibling' : 'previousSibling';\n\n        while (node = node[type])\n        {\n            if ((node.nodeType === 3 && node.textContent.trim() === '') || node.tagName === 'BR')\n            {\n                continue;\n            }\n\n            return node;\n        }\n\n        return false;\n    },\n    getElementsFromHtml: function(html, selector, exclude)\n    {\n        var div = document.createElement(\"div\");\n        div.innerHTML = html;\n\n        var elems = div.querySelectorAll(selector);\n\n        // array map polyfill\n        var mapping = function(callback, thisArg)\n        {\n            if (typeof this.length !== 'number') return;\n            if (typeof callback !== 'function') return;\n\n            var newArr = [];\n            if (typeof this == 'object')\n            {\n                for (var i = 0; i < this.length; i++)\n                {\n                    if (i in this) newArr[i] = callback.call(thisArg || this, this[i], i, this);\n                    else return;\n                }\n            }\n\n            return newArr;\n        };\n\n        return mapping.call(elems, function(el)\n        {\n            var type = el.getAttribute('data-redactor-type');\n            if (exclude && type && type === exclude) {}\n            else return el.outerHTML;\n        });\n    },\n\n    // childnodes\n    getChildNodes: function(el, recursive, elements)\n    {\n        el = (el && el.nodeType && el.nodeType === 11) ? el : $R.dom(el).get();\n\n        var nodes = el.childNodes;\n        var result = [];\n        if (nodes)\n        {\n            for (var i = 0; i < nodes.length; i++)\n            {\n                if (elements === true && nodes[i].nodeType === 3) continue;\n                else if (nodes[i].nodeType === 3 && this.isEmpty(nodes[i])) continue;\n\n                result.push(nodes[i]);\n\n                if (recursive !== false)\n                {\n                    var nestedNodes = this.getChildNodes(nodes[i], elements);\n                    if (nestedNodes.length > 0)\n                    {\n                        result = result.concat(nestedNodes);\n                    }\n                }\n            }\n        }\n\n        return result;\n    },\n    getChildElements: function(el)\n    {\n        return this.getChildNodes(el, true, true);\n    },\n    getFirstNode: function(el)\n    {\n        return this._getFirst(this.getChildNodes(el, false));\n    },\n    getLastNode: function(el)\n    {\n        return this._getLast(this.getChildNodes(el, false));\n    },\n    getFirstElement: function(el)\n    {\n        return this._getFirst(this.getChildNodes(el, false, true));\n    },\n    getLastElement: function(el)\n    {\n        return this._getLast(this.getChildNodes(el, false, true));\n    },\n\n    // replace\n    replaceToTag: function(node, tag)\n    {\n        var $node = $R.dom(node);\n        return $node.replaceWith(function(node)\n        {\n            var $replaced = $R.dom('<' + tag + '>').append($R.dom(node).contents());\n            if (node.attributes)\n            {\n                var attrs = node.attributes;\n                for (var i = 0; i < attrs.length; i++)\n                {\n                    $replaced.attr(attrs[i].nodeName, attrs[i].value);\n                }\n            }\n\n            return $replaced;\n\n        });\n    },\n\n    // string\n    ucfirst: function(str)\n    {\n        return str.charAt(0).toUpperCase() + str.slice(1);\n    },\n\n    // array\n    removeFromArrayByValue: function(arr, value)\n    {\n        var a = arguments, len = a.length, ax;\n        while (len > 1 && arr.length)\n        {\n            value = a[--len];\n            while ((ax= arr.indexOf(value)) !== -1)\n            {\n                arr.splice(ax, 1);\n            }\n        }\n\n        return arr;\n    },\n\n    // attributes\n    removeEmptyAttr: function(el, attr)\n    {\n        var $el = $R.dom(el);\n\n        if (typeof $el.attr(attr) === 'undefined' || $el.attr(attr) === null) return true;\n        else if ($el.attr(attr) === '')\n        {\n            $el.removeAttr(attr);\n            return true;\n        }\n\n        return false;\n    },\n    cloneAttributes: function(elFrom, elTo)\n    {\n        elFrom = $R.dom(elFrom).get();\n        elTo = $R.dom(elTo);\n\n        var attrs = elFrom.attributes;\n        var len = attrs.length;\n        while (len--)\n        {\n            var attr = attrs[len];\n            elTo.attr(attr.name, attr.value);\n        }\n\n        return elTo;\n    },\n\n    // object\n    toParams: function(obj)\n    {\n        if (typeof obj !== 'object') return obj;\n\n        var keys = Object.keys(obj);\n        if (!keys.length) return '';\n        var result = '';\n\n        for (var i = 0; i < keys.length; i++)\n        {\n            var key = keys[i];\n            result += key + ':' + obj[key] + ';';\n        }\n\n        return result;\n    },\n    styleToObj: function(str)\n    {\n        var obj = {};\n\n        if (str)\n        {\n            var style = str.replace(/;$/, '').split(';');\n            for (var i = 0; i < style.length; i++)\n            {\n                var rule = style[i].split(':');\n                obj[rule[0].trim()] = rule[1].trim();\n            }\n        }\n\n        return obj;\n    },\n    checkProperty: function(obj)\n    {\n        var args = (arguments[1] && Array.isArray(arguments[1])) ? arguments[1] : [].slice.call(arguments, 1);\n\n        for (var i = 0; i < args.length; i++)\n        {\n            if (!obj || (typeof obj[args[i]] === 'undefined'))\n            {\n                return false;\n            }\n\n            obj = obj[args[i]];\n        }\n\n        return obj;\n    },\n\n    // data\n    extendData: function(data, obj)\n    {\n        for (var key in obj)\n        {\n            if (key === 'elements')\n            {\n                var $elms = $R.dom(obj[key]);\n                $elms.each(function(node)\n                {\n                    var $node = $R.dom(node);\n                    if (node.tagName === 'FORM')\n                    {\n                        var serializedData = $node.serialize(true);\n                        for (var z in serializedData)\n                        {\n                            data = this._setData(data, z, serializedData[z]);\n                        }\n                    }\n                    else\n                    {\n                        var name = ($node.attr('name')) ? $node.attr('name') : $node.attr('id');\n                        data = this._setData(data, name, $node.val());\n                    }\n                }.bind(this));\n            }\n            else\n            {\n                data = this._setData(data, key, obj[key]);\n            }\n        }\n\n        return data;\n    },\n    _setData: function(data, name, value)\n    {\n        if (data instanceof FormData) data.append(name, value);\n        else data[name] = value;\n\n        return data;\n    },\n\n    // normalize\n    normalizeTextNodes: function(el)\n    {\n        el = $R.dom(el).get();\n        if (el) el.normalize();\n    },\n\n    // color\n    isRgb: function(str)\n    {\n        return (str.search(/^rgb/i) === 0);\n    },\n    rgb2hex: function(rgb)\n    {\n        rgb = rgb.match(/^rgba?[\\s+]?\\([\\s+]?(\\d+)[\\s+]?,[\\s+]?(\\d+)[\\s+]?,[\\s+]?(\\d+)[\\s+]?/i);\n\n        return (rgb && rgb.length === 4) ? \"#\" +\n        (\"0\" + parseInt(rgb[1],10).toString(16)).slice(-2) +\n        (\"0\" + parseInt(rgb[2],10).toString(16)).slice(-2) +\n        (\"0\" + parseInt(rgb[3],10).toString(16)).slice(-2) : '';\n    },\n    hex2long: function(val)\n    {\n        if (val.search(/^#/) !== -1 && val.length === 4)\n        {\n            val = '#' + val[1] + val[1] + val[2] + val[2] + val[3] + val[3];\n        }\n\n        return val;\n    },\n\n    // escape\n    escapeRegExp: function(s)\n    {\n        return s.replace(/[-\\/\\\\^$*~+?.()|[\\]{}]/g, '\\\\$&');\n    },\n\n    // random\n    getRandomId: function()\n    {\n        var id = '';\n        var possible = 'abcdefghijklmnopqrstuvwxyz0123456789';\n\n        for (var i = 0; i < 12; i++)\n        {\n            id += possible.charAt(Math.floor(Math.random() * possible.length));\n        }\n\n        return id;\n    },\n\n    // private\n    _getFirst: function(nodes)\n    {\n        return (nodes.length !== 0) ? nodes[0] : false;\n    },\n    _getLast: function(nodes)\n    {\n        return (nodes.length !== 0) ? nodes[nodes.length-1] : false;\n    }\n});\n$R.add('service', 'progress', {\n    init: function(app)\n    {\n        this.app = app;\n\n        // local\n        this.$box = null;\n        this.$bar = null;\n    },\n\n    // public\n    show: function()\n    {\n        if (!this._is()) this._build();\n        this.$box.show();\n    },\n    hide: function()\n    {\n        if (this._is())\n        {\n            this.animate.start(this.$box, 'fadeOut', this._destroy.bind(this));\n        }\n    },\n    update: function(value)\n    {\n        this.show();\n        this.$bar.css('width', value + '%');\n    },\n\n    // private\n    _is: function()\n    {\n        return (this.$box !== null);\n    },\n    _build: function()\n    {\n        this.$bar = $R.dom('<span />');\n        this.$box = $R.dom('<div id=\"redactor-progress\" />');\n\n        this.$box.append(this.$bar);\n        this.$body.append(this.$box);\n    },\n    _destroy: function()\n    {\n        if (this._is()) this.$box.remove();\n\n        this.$box = null;\n        this.$bar = null;\n    }\n});\n$R.add('module', 'starter', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.plugin = app.plugin;\n        this.module = app.module;\n    },\n    // messages\n    onstart: function()\n    {\n        var services = ['element', 'container', 'source', 'editor', 'statusbar', 'toolbar'];\n        var modules = ['element', 'container', 'source', 'editor', 'statusbar', 'contextbar', 'input'];\n\n        this._startStop('start', this.app, services);\n        this._startStop('start', this.module, modules);\n    },\n    onstop: function()\n    {\n        var modules = ['observer', 'element', 'container', 'source', 'editor', 'contextbar'];\n\n        this._startStop('stop', this.module, modules);\n    },\n    onenable: function()\n    {\n        var modules = ['observer', 'toolbar'];\n        var plugins = this.opts.plugins;\n\n        this._startStop('start', this.module, modules);\n        this._startStop('start', this.plugin, plugins);\n    },\n    ondisable: function()\n    {\n        var modules = ['observer', 'toolbar'];\n        var plugins = this.opts.plugins;\n\n        this._startStop('stop', this.module, modules);\n        this._startStop('stop', this.plugin, plugins);\n    },\n\n    // private\n    _startStop: function(type, obj, arr)\n    {\n        for (var i = 0; i < arr.length; i++)\n        {\n            if (typeof obj[arr[i]] !== 'undefined')\n            {\n                this.app.callInstanceMethod(obj[arr[i]], type);\n            }\n        }\n    }\n});\n$R.add('module', 'element', {\n    init: function(app)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.opts = app.opts;\n        this.namespace = app.namespace;\n        this.element = app.element;\n        this.rootOpts = $R.extend({}, true, $R.options, app.rootOpts);\n    },\n    // public\n    start: function()\n    {\n        this._build();\n        this._buildModes();\n        this._buildMarkup();\n    },\n    stop: function()\n    {\n        var $element = this.element.getElement();\n        $element.removeData(this.namespace + '-uuid');\n    },\n\n    // private\n    _build: function()\n    {\n        var $element = this.element.getElement();\n        $element.data(this.namespace + '-uuid', this.uuid);\n    },\n    _buildModes: function()\n    {\n        var type = this.element.getType();\n\n        if (type === 'inline') this._redefineOptions(this.opts.modes['inline']);\n        if (type === 'div') this._redefineOptions(this.opts.modes['original']);\n\n        if (type !== 'inline')\n        {\n            if (this._isRootOption('styles') && this.rootOpts.styles) this.opts.styles = true;\n            if (this._isRootOption('source') && !this.rootOpts.source) this.opts.showSource = false;\n        }\n    },\n    _buildMarkup: function()\n    {\n        var type = this.element.getType();\n\n        if (type === 'inline')\n        {\n            this.opts.emptyHtml = '';\n        }\n        else if (this.opts.breakline)\n        {\n            this.opts.markup = 'div';\n            this.opts.emptyHtml = '<div data-redactor-tag=\"br\">' + this.opts.markerChar + '</div>';\n        }\n        else\n        {\n            this.opts.emptyHtml = '<' + this.opts.markup + '></' + this.opts.markup + '>';\n        }\n    },\n    _redefineOptions: function(opts)\n    {\n        for (var key in opts)\n        {\n            this.opts[key] = opts[key];\n        }\n    },\n    _isRootOption: function()\n    {\n        return (typeof this.rootOpts['styles'] !== 'undefined');\n    }\n});\n$R.add('module', 'editor', {\n    init: function(app)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.opts = app.opts;\n        this.editor = app.editor;\n        this.source = app.source;\n        this.element = app.element;\n        this.component = app.component;\n        this.container = app.container;\n        this.inspector = app.inspector;\n        this.autoparser = app.autoparser;\n\n        // local\n        this.placeholder = false;\n        this.events = false;\n    },\n    // messages\n    onenable: function()\n    {\n        this.enable();\n    },\n    ondisable: function()\n    {\n        this.disable();\n    },\n    onenablefocus: function()\n    {\n        this._enableFocus();\n    },\n    oncontextmenu: function(e)\n    {\n        this.component.setOnEvent(e, true);\n    },\n    onclick: function(e)\n    {\n        this.component.setOnEvent(e);\n    },\n    onkeyup: function(e)\n    {\n        var data = this.inspector.parse(e.target);\n        if (!data.isComponent())\n        {\n            this.component.clearActive();\n        }\n    },\n    onenablereadonly: function()\n    {\n        this._enableReadOnly();\n    },\n    ondisablereadonly: function()\n    {\n        this._disableReadOnly();\n    },\n    onautoparseobserve: function()\n    {\n        this.autoparser.observe();\n    },\n    onplaceholder: {\n        build: function()\n        {\n            this._buildPlaceholder();\n        },\n        toggle: function()\n        {\n            this._togglePlacehodler();\n        }\n    },\n\n    // public\n    start: function()\n    {\n        this._build();\n        this._buildEvents();\n        this._buildOptions();\n        this._buildAccesibility();\n    },\n    stop: function()\n    {\n        var $editor = this.editor.getElement();\n        var $container = this.container.getElement();\n\n        var classesEditor = ['redactor-in', 'redactor-in-' + this.uuid, 'redactor-structure', 'redactor-placeholder', 'notranslate'];\n        if (this.opts.stylesClass !== '') {\n            classesEditor.push(this.opts.stylesClass);\n        }\n\n        var classesContainer = ['redactor-focus', 'redactor-blur', 'redactor-over', 'redactor-styles-on',\n                                'redactor-styles-off', 'redactor-toolbar-on', 'redactor-text-labeled-on', 'redactor-source-view'];\n\n        $editor.removeAttr('spellcheck');\n        $editor.removeAttr('dir');\n        $editor.removeAttr('contenteditable');\n        $editor.removeAttr('placeholder');\n        $editor.removeAttr('data-gramm_editor');\n        $editor.removeClass(classesEditor.join(' '));\n\n        $container.removeClass(classesContainer.join(' '));\n\n        this._destroyEvents();\n\n        if ($editor.get().classList.length === 0) $editor.removeAttr('class');\n    },\n    enable: function()\n    {\n        var $editor = this.editor.getElement();\n        var $container = this.container.getElement();\n\n        $editor.addClass('redactor-in redactor-in-' + this.uuid);\n        $editor.attr({ 'contenteditable': true });\n\n        if (this.opts.structure)\n        {\n            $editor.addClass('redactor-structure');\n        }\n\n        if (this.opts.toolbar && !this.opts.air && !this.opts.toolbarExternal)\n        {\n            $container.addClass('redactor-toolbar-on');\n        }\n\n        // prevent editing\n        this._disableBrowsersEditing();\n    },\n    disable: function()\n    {\n        var $editor = this.editor.getElement();\n        var $container = this.container.getElement();\n\n        $editor.removeClass('redactor-in redactor-in-' + this.uuid);\n        $editor.removeClass('redactor-structure');\n        $editor.removeAttr('contenteditable');\n\n        $container.addClass('redactor-toolbar-on');\n    },\n\n    // private\n    _build: function()\n    {\n        var $editor = this.editor.getElement();\n        var $element = this.element.getElement();\n        var $container = this.container.getElement();\n\n        $container.addClass('redactor-blur');\n\n        if (!this.opts.grammarly)\n        {\n            $editor.attr('data-gramm_editor', false);\n        }\n\n        if (this.opts.notranslate)\n        {\n            $editor.addClass('notranslate');\n        }\n\n        if (this.opts.styles)\n        {\n            $editor.addClass(this.opts.stylesClass);\n            $container.addClass('redactor-styles-on');\n        }\n        else\n        {\n            $container.addClass('redactor-styles-off');\n        }\n\n        if (this.opts.buttonsTextLabeled)\n        {\n            $container.addClass('redactor-text-labeled-on');\n        }\n\n        if (this.element.isType('textarea')) $element.before($editor);\n    },\n    _buildEvents: function()\n    {\n        this.events = $R.create('editor.events', this.app);\n    },\n    _buildOptions: function()\n    {\n        var $editor = this.editor.getElement();\n\n        $editor.attr('dir', this.opts.direction);\n\n        if (!this.opts.spellcheck) $editor.attr('spellcheck', false);\n        if (this.opts.tabindex) $editor.attr('tabindex', this.opts.tabindex);\n        if (this.opts.minHeight) $editor.css('min-height', this.opts.minHeight);\n        if (this.opts.maxHeight) $editor.css('max-height', this.opts.maxHeight);\n        if (this.opts.maxWidth) $editor.css({ 'max-width': this.opts.maxWidth, 'margin': 'auto' });\n    },\n    _buildAccesibility: function()\n    {\n        var $editor = this.editor.getElement();\n\n        $editor.attr({ 'aria-labelledby': 'redactor-voice-' + this.uuid, 'role': 'presentation' });\n    },\n    _buildPlaceholder: function()\n    {\n        this.placeholder = $R.create('editor.placeholder', this.app);\n    },\n    _enableFocus: function()\n    {\n        if (this.opts.showSource) this._enableFocusSource();\n        else this._enableFocusEditor();\n    },\n    _enableFocusSource: function()\n    {\n        var $source = this.source.getElement();\n\n        if (this.opts.focus)\n        {\n            $source.focus();\n            $source.get().setSelectionRange(0, 0);\n        }\n        else if (this.opts.focusEnd)\n        {\n            $source.focus();\n        }\n    },\n    _enableFocusEditor: function()\n    {\n        if (this.opts.focus)\n        {\n            setTimeout(this.editor.startFocus.bind(this.editor), 100);\n        }\n        else if (this.opts.focusEnd)\n        {\n            setTimeout(this.editor.endFocus.bind(this.editor), 100);\n        }\n    },\n    _togglePlacehodler: function()\n    {\n        if (this.placeholder) this.placeholder.toggle();\n    },\n    _disableBrowsersEditing: function()\n    {\n        try {\n            // FF fix\n            document.execCommand('enableObjectResizing', false, false);\n            document.execCommand('enableInlineTableEditing', false, false);\n            // IE prevent converting links\n            document.execCommand(\"AutoUrlDetect\", false, false);\n\n            // IE disable image resizing\n            var $editor = this.editor.getElement();\n            var el = $editor.get();\n            if (el.addEventListener) el.addEventListener('mscontrolselect', function(e) { e.preventDefault(); });\n            else el.attachEvent('oncontrolselect', function(e) { e.returnValue = false; });\n\n        } catch (e) {}\n    },\n    _destroyEvents: function()\n    {\n        if (this.events)\n        {\n            this.events.destroy();\n        }\n    },\n    _enableReadOnly: function()\n    {\n        var $editor = this.editor.getElement();\n\n        this._getEditables($editor).removeAttr('contenteditable');\n        $editor.removeAttr('contenteditable');\n        $editor.addClass('redactor-read-only');\n\n        if (this.events) this.events.destroy();\n    },\n    _disableReadOnly: function()\n    {\n        var $editor = this.editor.getElement();\n\n        this._getEditables($editor).attr({ 'contenteditable': true });\n        $editor.removeClass('redactor-read-only');\n        $editor.attr({ 'contenteditable': true });\n\n        this._buildEvents();\n    },\n    _getEditables: function($editor)\n    {\n        return $editor.find('figcaption, td, th');\n    }\n});\n$R.add('class', 'editor.placeholder', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.editor = app.editor;\n        this.element = app.element;\n\n        // build\n        this.build();\n    },\n    build: function()\n    {\n        var $element = this.element.getElement();\n        var $editor = this.editor.getElement();\n\n        if (this.opts.placeholder !== false || $element.attr('placeholder'))\n        {\n            var text = (this.opts.placeholder !== false) ? this.opts.placeholder : $element.attr('placeholder');\n            $editor.attr('placeholder', text);\n            this.toggle();\n        }\n    },\n    toggle: function()\n    {\n        return (this.editor.isEmpty(true)) ? this.show() : this.hide();\n    },\n    show: function()\n    {\n        var $editor = this.editor.getElement();\n        $editor.addClass('redactor-placeholder');\n    },\n    hide: function()\n    {\n        var $editor = this.editor.getElement();\n        $editor.removeClass('redactor-placeholder');\n    }\n});\n$R.add('class', 'editor.events', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.$doc = app.$doc;\n        this.uuid = app.uuid;\n        this.source = app.source;\n        this.editor = app.editor;\n        this.cleaner = app.cleaner;\n        this.container = app.container;\n        this.insertion = app.insertion;\n        this.inspector = app.inspector;\n        this.selection = app.selection;\n        this.component = app.component;\n\n        // local\n        this.blurNamespace = '.redactor-blur.' + this.uuid;\n        this.eventsList = ['paste', 'click', 'contextmenu', 'keydown', 'keyup', 'mouseup', 'touchstart',\n                           'cut', 'copy', 'dragenter', 'dragstart', 'drop', 'dragover', 'dragleave'];\n\n        // init\n        this._init();\n    },\n    destroy: function()\n    {\n        var $editor = this.editor.getElement();\n\n        $editor.off('.redactor-focus');\n        this.$doc.off('keyup' + this.blurNamespace + ' mousedown' + this.blurNamespace);\n\n        // all events\n        this._loop('off');\n    },\n    focus: function(e)\n    {\n        var $container = this.container.getElement();\n\n        if (this.editor.isPasting() || $container.hasClass('redactor-focus')) return;\n\n        $container.addClass('redactor-focus');\n        $container.removeClass('redactor-blur');\n\n        this.app.broadcast('observe', e);\n        this.app.broadcast('focus', e);\n\n        this.isFocused = true;\n        this.isBlured = false;\n    },\n    blur: function(e)\n    {\n        var $container = this.container.getElement();\n        var $target = $R.dom(e.target);\n        var targets = ['.redactor-in-' + this.uuid,  '.redactor-toolbar', '.redactor-dropdown',\n        '.redactor-context-toolbar', '#redactor-modal', '#redactor-image-resizer'];\n\n        this.app.broadcast('originalblur', e);\n        if (this.app.stopBlur) return;\n\n        if (!this.app.isStarted() || this.editor.isPasting()) return;\n        if ($target.closest(targets.join(',')).length !== 0) return;\n\n        if (!this.isBlured && !$container.hasClass('redactor-blur'))\n        {\n            $container.removeClass('redactor-focus');\n            $container.addClass('redactor-blur');\n            this.app.broadcast('blur', e);\n\n            this.isFocused = false;\n            this.isBlured = true;\n        }\n    },\n    cut: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n\n        this.app.broadcast('state', e);\n\n        if (this.component.isNonEditable(current))\n        {\n            this._passSelectionToClipboard(e, data, true);\n            e.preventDefault();\n        }\n    },\n    copy: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n\n        this.app.broadcast('state', e);\n\n        if (this.component.isNonEditable(current))\n        {\n            this._passSelectionToClipboard(e, data, false);\n            e.preventDefault();\n        }\n    },\n    drop: function(e)\n    {\n        e = e.originalEvent || e;\n        e.stopPropagation();\n        this._removeOverClass();\n\n        if (this.opts.dragUpload === false)\n        {\n            e.preventDefault();\n            return;\n        }\n\n\n        if (this.app.isDragComponentInside())\n        {\n            var $dragComponent = $R.dom(this.app.getDragComponentInside());\n            var $component = $dragComponent.clone(true);\n            this.insertion.insertToPoint(e, $component);\n\n            $dragComponent.remove();\n\n            this.app.setDragComponentInside(false);\n            this.app.broadcast('state', e);\n            this.app.broadcast('drop', e);\n            this.app.broadcast('image.observe', e);\n\n            e.preventDefault();\n\n            return;\n        }\n        else if (this.app.isDragInside() && this.opts.input)\n        {\n            this.insertion.insertPoint(e);\n\n            var dt = e.dataTransfer;\n            var html = dt.getData('text/html');\n\n            // clear selected\n            var range = this.selection.getRange();\n            if (range)\n            {\n                var blocks = this.selection.getBlocks();\n                range.deleteContents();\n\n                // remove empty blocks\n                for (var i = 0; i < blocks.length; i++)\n                {\n                    if (blocks[i].innerHTML === '') $R.dom(blocks[i]).remove();\n                }\n            }\n\n            // paste\n            $R.create('input.paste', this.app, e, true, html, true);\n\n            this.app.broadcast('state', e);\n            this.app.broadcast('drop', e);\n\n            this.app.setDragInside(false);\n            e.preventDefault();\n\n            return;\n        }\n\n        this.app.broadcast('state', e);\n        this.app.broadcast('paste', e, e.dataTransfer);\n        this.app.broadcast('drop', e);\n\n    },\n    dragenter: function(e)\n    {\n        e.preventDefault();\n    },\n    dragstart: function(e)\n    {\n        this.app.setDragComponentInside(false);\n        this.app.setDragInside(false);\n\n        var data = this.inspector.parse(e.target);\n        if (data.isComponent() && !data.isComponentEditable() && !data.isFigcaption())\n        {\n            this.app.setDragComponentInside(data.getComponent());\n        }\n        else if (this.selection.is() && !this.selection.isCollapsed())\n        {\n            // drag starts inside editor\n            this.app.setDragInside(true);\n            this._setDragData(e);\n        }\n\n        this.app.broadcast('dragstart', e);\n    },\n    dragover: function(e)\n    {\n        this.app.broadcast('dragover', e);\n    },\n    dragleave: function(e)\n    {\n        this.app.broadcast('dragleave', e);\n    },\n    paste: function(e)\n    {\n        this.app.broadcast('paste', e);\n    },\n    contextmenu: function(e)\n    {\n        // chrome crashes fix\n        //this.editor.disableNonEditables();\n\n        //setTimeout(function()\n        //{\n          //  this.editor.enableNonEditables();\n           // this.app.broadcast('contextmenu', e);\n\n        //}.bind(this), 0);\n    },\n    click: function(e)\n    {\n        // triple click selection\n        if (e.detail === 3)\n        {\n            e.preventDefault();\n\n            var block = this.selection.getBlock();\n            if (block) {\n                var range = document.createRange();\n                range.selectNodeContents(block);\n                this.selection.setRange(range)\n            }\n        }\n\n        // observe bottom click & start click & outside click\n        var $target = $R.dom(e.target);\n        if ($target.hasClass('redactor-in'))\n        {\n            var top = $target.offset().top;\n            var pad = parseFloat($target.css('padding-bottom'));\n            var height = $target.height();\n            var posHeight = top + height - pad*2;\n\n            if (posHeight < e.pageY)\n            {\n                this.app.broadcast('bottomclick', e);\n            }\n            else if ($target.hasClass('redactor-placeholder')) {\n                this.editor.startFocus(this.editor);\n            }\n        }\n\n        this.app.broadcast('state', e);\n        this.app.broadcast('click', e);\n    },\n    keydown: function(e)\n    {\n        this.app.broadcast('state', e);\n        var stop = this.app.broadcast('keydown', e);\n        if (stop === false)\n        {\n            return e.preventDefault();\n        }\n    },\n    keyup: function(e)\n    {\n        this.app.broadcast('keyup', e);\n    },\n    mouseup: function(e)\n    {\n        this.app.broadcast('observe', e);\n        this.app.broadcast('state', e);\n    },\n    touchstart: function(e)\n    {\n        this.app.broadcast('observe', e);\n        this.app.broadcast('state', e);\n    },\n\n    // private\n    _init: function()\n    {\n        var $editor = this.editor.getElement();\n\n        $editor.on('focus.redactor-focus click.redactor-focus', this.focus.bind(this));\n        this.$doc.on('keyup' + this.blurNamespace + ' mousedown' + this.blurNamespace, this.blur.bind(this));\n\n        // all events\n        this._loop('on');\n    },\n    _removeOverClass: function()\n    {\n        var $editor = this.editor.getElement();\n        $editor.removeClass('over');\n    },\n    _loop: function(func)\n    {\n        var $editor = this.editor.getElement();\n        for (var i = 0; i < this.eventsList.length; i++)\n        {\n            var event = this.eventsList[i] + '.redactor-events';\n            var method = this.eventsList[i];\n\n            $editor[func](event, this[method].bind(this));\n        }\n    },\n    _passAllToClipboard: function(e)\n    {\n        var clipboard = e.clipboardData;\n        var content = this.source.getCode();\n\n        clipboard.setData('text/html', content);\n        clipboard.setData('text/plain', content.toString().replace(/\\n$/, \"\"));\n    },\n    _passSelectionToClipboard: function(e, data, remove)\n    {\n        var clipboard = e.clipboardData;\n        var node = data.getComponent();\n        var $node = $R.dom(node);\n        var $cloned = $node.clone();\n\n        // clean\n        $cloned.find('.redactor-component-caret').remove();\n        $cloned.removeClass('redactor-component-active');\n        $cloned.removeAttr('contenteditable');\n        $cloned.removeAttr('tabindex');\n\n        // html\n        var content = $cloned.get().outerHTML;\n\n        if (remove) this.component.remove(node);\n\n        clipboard.setData('text/html', content);\n        clipboard.setData('text/plain', content.toString().replace(/\\n$/, \"\"));\n    },\n    _setDragData: function(e)\n    {\n        e = e.originalEvent || e;\n\n        var dt = e.dataTransfer;\n        dt.effectAllowed = 'move';\n        dt.setData('text/Html', this.selection.getHtml());\n    }\n});\n$R.add('module', 'container', {\n    init: function(app)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.opts = app.opts;\n        this.lang = app.lang;\n        this.element = app.element;\n        this.container = app.container;\n    },\n    // public\n    start: function()\n    {\n        this._build();\n        this._buildAccesibility();\n    },\n    stop: function()\n    {\n        var $element = this.element.getElement();\n        var $container = this.container.getElement();\n\n        $container.after($element);\n        $container.remove();\n        $element.show();\n    },\n\n    // private\n    _build: function()\n    {\n        var $element = this.element.getElement();\n        var $container = this.container.getElement();\n\n        $container.addClass('redactor-box');\n        $container.attr('dir', this.opts.direction);\n\n        if (this.element.isType('inline')) $container.addClass('redactor-inline');\n\n        $element.after($container);\n        $container.append($element);\n    },\n    _buildAccesibility: function()\n    {\n        var $container = this.container.getElement();\n        var $label = $R.dom('<span />');\n\n        $label.addClass('redactor-voice-label');\n        $label.attr({ 'id': 'redactor-voice-' + this.uuid, 'aria-hidden': false });\n        $label.html(this.lang.get('accessibility-help-label'));\n\n        $container.prepend($label);\n    }\n});\n$R.add('module', 'source', {\n    init: function(app)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.element = app.element;\n        this.source = app.source;\n        this.editor = app.editor;\n        this.toolbar = app.toolbar;\n        this.cleaner = app.cleaner;\n        this.component = app.component;\n        this.container = app.container;\n        this.autoparser = app.autoparser;\n        this.selection = app.selection;\n\n        // local\n        this.syncedHtml = '';\n    },\n    // messages\n    onstartcode: function()\n    {\n        var sourceContent = this.source.getStartedContent();\n        var $editor = this.editor.getElement();\n        var $source = this.source.getElement();\n\n        // autoparse\n        if (this.opts.autoparse && this.opts.autoparseStart)\n        {\n            sourceContent = this.autoparser.parse(sourceContent);\n        }\n\n        // started content\n        var startContent = this.cleaner.input(sourceContent, true, true);\n        var syncContent = this.cleaner.output(startContent);\n\n\n        // set content\n        $editor.html(startContent);\n        $source.val(syncContent);\n\n        this.syncedHtml = syncContent;\n        this.app.broadcast('placeholder.build');\n        this.app.broadcast('autoparseobserve');\n\n        // widget's scripts\n        this.component.executeScripts();\n    },\n    onstartcodeshow: function()\n    {\n        this.show();\n    },\n    ontrytosync: function()\n    {\n        this.sync();\n    },\n    onhardsync: function()\n    {\n        var $editor = this.editor.getElement();\n        var html = $editor.html();\n\n        html = this.app.broadcast('syncBefore', html);\n        html = this.cleaner.output(html);\n\n        this._syncing(html);\n    },\n\n    // public\n    start: function()\n    {\n        this._build();\n        this._buildClasses();\n    },\n    stop: function()\n    {\n        var $element = this.element.getElement();\n        var $source = this.source.getElement();\n\n        $element.removeClass('redactor-source redactor-source-open');\n        $source.off('input.redactor-source');\n        $source.removeAttr('data-gramm_editor');\n\n        if ($source.get().classList.length === 0) $source.removeAttr('class');\n        if (!this.source.isNameGenerated()) $element.removeAttr('name');\n        if (!this.element.isType('textarea')) $source.remove();\n\n    },\n    getCode: function()\n    {\n        return this.source.getCode();\n    },\n\n    // public\n    toggle: function()\n    {\n        if (!this.opts.source) return;\n\n        var $source = this.source.getElement();\n\n        return ($source.hasClass('redactor-source-open')) ? this.hide() : this.show();\n    },\n    show: function()\n    {\n        if (!this.opts.source) return;\n\n        var $editor = this.editor.getElement();\n        var $source = this.source.getElement();\n        var $container = this.container.getElement();\n\n        var html = $source.val();\n\n        if (this.app.isStarted()) html = this.app.broadcast('source.open', html);\n\n        // get height\n        var editorHeight = $editor.height();\n\n        $editor.hide();\n        $source.height(editorHeight);\n        $source.val(html.trim());\n        $source.show();\n        $source.addClass('redactor-source-open');\n        $source.on('input.redactor-source-events', this._onChangedSource.bind(this));\n        $source.on('keydown.redactor-source-events', this._onTabKey.bind(this));\n        $source.on('focus.redactor-source-events', this._onFocus.bind(this));\n\n        if (this.opts.source.hasOwnProperty('codemirror')) {\n            var opts = (typeof this.opts.source.codemirror === 'object') ? this.opts.source.codemirror : {};\n            var codemirrorSrc = (typeof this.opts.source.codemirrorSrc !== 'undefined') ? this.opts.source.codemirrorSrc : CodeMirror;\n            this.codemirror = codemirrorSrc.fromTextArea($source.get(), opts);\n            this.codemirror.setSize(null, editorHeight);\n            this.codemirror.on('change', function(cm, changeObj){ cm.save() });\n            this.codemirror.on('change', this._onChangedSource.bind(this));\n        }\n        else {\n            $container.addClass('redactor-source-view');\n        }\n\n        // buttons\n        setTimeout(function()\n        {\n            this._disableButtons();\n            this._setActiveSourceButton();\n\n        }.bind(this), 100);\n\n        if (this.app.isStarted()) this.app.broadcast('source.opened');\n    },\n    hide: function()\n    {\n        if (!this.opts.source) return;\n\n        var $editor = this.editor.getElement();\n        var $source = this.source.getElement();\n        var $container = this.container.getElement();\n\n        var html = $source.val();\n        if (this.opts.source.hasOwnProperty('codemirror')) {\n            html = this.codemirror.getValue();\n            this.codemirror.toTextArea();\n        }\n\n\n        // clean\n        html = this.cleaner.input(html, true);\n        html = (this.utils.isEmptyHtml(html)) ? this.opts.emptyHtml : html;\n        html = this.app.broadcast('source.close', html);\n\n        // buttons\n        this._enableButtons();\n        this._setInactiveSourceButton();\n\n        $source.hide();\n        $source.removeClass('redactor-source-open');\n        $source.off('.redactor-source-events');\n        $editor.show();\n        $editor.html(html);\n\n        $container.removeClass('redactor-source-view');\n\n        setTimeout(function()\n        {\n            this.editor.startFocus();\n\n            // widget's scripts\n            this.component.executeScripts();\n\n        }.bind(this), 0);\n\n        this.app.broadcast('source.closed');\n    },\n    sync: function()\n    {\n        var self = this;\n        var $editor = this.editor.getElement();\n        var html = $editor.html();\n\n        html = this.app.broadcast('syncBefore', html);\n        html = this.cleaner.output(html);\n\n        if (this._isSync(html))\n        {\n            if (this.timeout) clearTimeout(this.timeout);\n            this.timeout = setTimeout(function() { self._syncing(html); }, 200);\n        }\n    },\n\n    // private\n    _build: function()\n    {\n        var $source = this.source.getElement();\n        var $element = this.element.getElement();\n\n        $source.hide();\n\n        if (!this.opts.grammarly)\n        {\n            $source.attr('data-gramm_editor', false);\n        }\n\n        if (!this.element.isType('textarea'))\n        {\n            $element.after($source);\n        }\n    },\n    _buildClasses: function()\n    {\n        var $source = this.source.getElement();\n\n        $source.addClass('redactor-source');\n    },\n    _syncing: function(html)\n    {\n        html = this.app.broadcast('syncing', html);\n\n        var $source = this.source.getElement();\n        $source.val(html);\n\n        this.app.broadcast('synced', html);\n        this.app.broadcast('changed', html);\n    },\n    _isSync: function(html)\n    {\n        if (this.syncedHtml !== html)\n        {\n            this.syncedHtml = html;\n            return true;\n        }\n\n        return false;\n    },\n    _onChangedSource: function()\n    {\n        var $source = this.source.getElement();\n        var html = $source.val();\n\n        this.app.broadcast('changed', html);\n        this.app.broadcast('source.changed', html);\n    },\n    _onTabKey: function(e)\n    {\n        if (e.keyCode !== 9) return true;\n\n        e.preventDefault();\n\n        var $source = this.source.getElement();\n        var el = $source.get();\n        var start = el.selectionStart;\n\n        $source.val($source.val().substring(0, start) + \"    \" + $source.val().substring(el.selectionEnd));\n        el.selectionStart = el.selectionEnd = start + 4;\n    },\n    _onFocus: function()\n    {\n        this.app.broadcast('sourcefocus');\n    },\n    _disableButtons: function()\n    {\n        this.toolbar.disableButtons();\n    },\n    _enableButtons: function()\n    {\n        this.toolbar.enableButtons();\n    },\n    _setActiveSourceButton: function()\n    {\n        var $btn = this.toolbar.getButton('html');\n        $btn.enable();\n        $btn.setActive();\n    },\n    _setInactiveSourceButton: function()\n    {\n        var $btn = this.toolbar.getButton('html');\n        $btn.setInactive();\n    }\n});\n$R.add('module', 'observer', {\n    init: function(app)\n    {\n        this.app = app;\n        this.editor = app.editor;\n\n        // local\n        this.observerUnit = false;\n    },\n    // public\n    start: function()\n    {\n        if (window.MutationObserver)\n        {\n            var $editor = this.editor.getElement();\n            var el = $editor.get();\n            this.observerUnit = this._build(el);\n            this.observerUnit.observe(el, {\n                 attributes: true,\n                 subtree: true,\n                 childList: true,\n                 characterData: true,\n                 characterDataOldValue: true\n            });\n        }\n    },\n    stop: function()\n    {\n        if (this.observerUnit) this.observerUnit.disconnect();\n    },\n\n    // private\n    _build: function(el)\n    {\n        var self = this;\n        return new MutationObserver(function(mutations)\n        {\n            self._observe(mutations[mutations.length-1], el);\n        });\n    },\n    _observe: function(mutation, el)\n    {\n        if (this.app.isReadOnly() || (mutation.type === 'attributes' && mutation.target === el))\n        {\n            return;\n        }\n\n        this.app.broadcast('observe');\n        this.app.broadcast('trytosync');\n        this.app.broadcast('placeholder.toggle');\n    }\n});\n$R.add('module', 'clicktoedit', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.source = app.source;\n        this.editor = app.editor;\n        this.container = app.container;\n        this.selection = app.selection;\n    },\n    // messages\n    onstartclicktoedit: function()\n    {\n        this.start();\n    },\n    onenablereadonly: function()\n    {\n        if (!this.opts.clickToEdit) return;\n        if (!this._isEnabled()) this.stop();\n    },\n    ondisablereadonly: function()\n    {\n        if (!this.opts.clickToEdit) return;\n        if (!this._isEnabled()) this.start();\n    },\n    onstop: function()\n    {\n        this.stop();\n    },\n\n    // public\n    start: function()\n    {\n        this._build();\n    },\n    stop: function()\n    {\n        if (this.buttonSave) this.buttonSave.stop();\n        if (this.buttonCancel) this.buttonCancel.stop();\n\n        this._destroy();\n        this.app.broadcast('disable');\n    },\n    enable: function()\n    {\n        this.app.broadcast('clickStart');\n\n        var isEmpty = this.editor.isEmpty();\n        if (!isEmpty) this.selection.saveMarkers();\n\n        this._setFocus();\n        this._destroy();\n        this.app.broadcast('enable');\n        this.buttonSave.enable();\n        this.buttonCancel.enable();\n\n        if (!isEmpty) this.selection.restoreMarkers();\n        if (isEmpty) this.editor.focus();\n\n        var $container = this.container.getElement();\n        $container.addClass('redactor-clicktoedit-enabled');\n\n        this.source.rebuildStartedContent();\n\n        this.app.broadcast('startcode');\n        this.app.broadcast('image.observe');\n    },\n    save: function(e)\n    {\n        if (e) e.preventDefault();\n\n        var html = this.source.getCode();\n\n        this.app.broadcast('disable');\n        this.app.broadcast('clickSave', html);\n        this.app.broadcast('clickStop');\n        this.app.broadcast('toolbar.removeexternal');\n        this._build();\n    },\n    cancel: function(e)\n    {\n        if (e) e.preventDefault();\n\n        var html = this.saved;\n        var $editor = this.editor.getElement();\n        $editor.html(html);\n\n        this.saved = '';\n\n        this.app.broadcast('disable');\n        this.app.broadcast('clickCancel', html);\n        this.app.broadcast('clickStop');\n        this.app.broadcast('toolbar.removeexternal');\n        this._build();\n    },\n\n    // private\n    _build: function()\n    {\n        // buttons\n        this.buttonSave = $R.create('clicktoedit.button', 'save', this.app, this);\n        this.buttonCancel = $R.create('clicktoedit.button', 'cancel', this.app, this);\n\n        this.buttonSave.stop();\n        this.buttonCancel.stop();\n\n        var $editor = this.editor.getElement();\n        var $container = this.container.getElement();\n\n        $editor.on('click.redactor-click-to-edit mouseup.redactor-click-to-edit', this.enable.bind(this));\n        $container.addClass('redactor-over');\n        $container.removeClass('redactor-clicktoedit-enabled');\n    },\n    _isEnabled: function()\n    {\n        return this.container.getElement().hasClass('redactor-clicktoedit-enabled');\n    },\n    _destroy: function()\n    {\n        var $editor = this.editor.getElement();\n        var $container = this.container.getElement();\n\n        $editor.off('.redactor-click-to-edit');\n        $container.removeClass('redactor-over redactor-clicktoedit-enabled');\n    },\n    _setFocus: function()\n    {\n        this.saved = this.source.getCode();\n\n        this.buttonSave.start();\n        this.buttonCancel.start();\n    }\n});\n$R.add('class', 'clicktoedit.button', {\n    init: function(type, app, context)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.toolbar = app.toolbar;\n        this.context = context;\n\n        // local\n        this.type = type;\n        this.name = (type === 'save') ? 'clickToSave' : 'clickToCancel';\n        this.objected = false;\n        this.enabled = false;\n        this.namespace = '.redactor-click-to-edit';\n\n        // build\n        this._build();\n    },\n    enable: function()\n    {\n        if (!this.objected) return;\n\n        var data = this.opts[this.name];\n        data.api = 'module.clicktoedit.' + this.type;\n\n        this.toolbar.addButton(this.type, data);\n        this.enabled = true;\n    },\n    start: function()\n    {\n        if (this.objected) return;\n\n        this.$button.off(this.namespace);\n        this.$button.show();\n        this.$button.on('click' + this.namespace, this.context[this.type].bind(this.context));\n    },\n    stop: function()\n    {\n        if (this.objected || !this.enabled) return;\n\n        this.$button.hide();\n    },\n\n    // private\n    _build: function()\n    {\n        this.objected = (typeof this.opts[this.name] === 'object');\n\n        if (!this.objected)\n        {\n            this.$button = $R.dom(this.opts[this.name]);\n            this.enabled = true;\n        }\n    }\n});\n$R.add('module', 'statusbar', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.element = app.element;\n        this.statusbar = app.statusbar;\n        this.container = app.container;\n    },\n    // public\n    start: function()\n    {\n        if (!this.element.isType('inline'))\n        {\n            var $statusbar = this.statusbar.getElement();\n            var $container = this.container.getElement();\n\n            $statusbar.addClass('redactor-statusbar');\n            $container.append($statusbar);\n        }\n    }\n});\n$R.add('module', 'contextbar', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.uuid = app.uuid;\n        this.$win = app.$win;\n        this.$doc = app.$doc;\n        this.$body = app.$body;\n        this.editor = app.editor;\n        this.toolbar = app.toolbar;\n        this.detector = app.detector;\n\n        // local\n        this.$target = (this.toolbar.isTarget()) ? this.toolbar.getTargetElement() : this.$body;\n    },\n    // messages\n    onstop: function() {\n        this.stop();\n    },\n    onenablereadonly: function()\n    {\n        this.stop();\n    },\n    ondisablereadonly: function()\n    {\n        this.start();\n    },\n    oncontextbar: {\n        close: function()\n        {\n            this.close();\n        }\n    },\n\n    // public\n    start: function()\n    {\n        if (this.opts.toolbarContext)\n        {\n            var $editor = this.editor.getElement();\n\n            this._build();\n            $editor.on('click.redactor-context mouseup.redactor-context', this.open.bind(this));\n\n            if (this.opts.scrollTarget)\n            {\n                $R.dom(this.opts.scrollTarget).on('scroll.redactor-context', this.close.bind(this));\n            }\n            else if (this.opts.maxHeight !== false)\n            {\n                $editor.on('scroll.redactor-context', this.close.bind(this));\n            }\n        }\n    },\n    stop: function()\n    {\n        var $editor = this.editor.getElement();\n        $editor.off('.redactor-context');\n\n        this.$doc.off('.redactor-context');\n        this.$win.off('.redactor-context');\n\n        if (this.$contextbar) this.$contextbar.remove();\n        if (this.opts.scrollTarget)\n        {\n            $R.dom(this.opts.scrollTarget).off('.redactor-context');\n        }\n    },\n    is: function()\n    {\n        return (this.$contextbar && this.$contextbar.hasClass('open'));\n    },\n    set: function(e, node, buttons, position)\n    {\n        this.$contextbar.html('');\n        this.$el = $R.dom(node);\n\n        // buttons\n        for (var key in buttons)\n        {\n            var $btn = $R.create('contextbar.button', this.app, buttons[key]);\n            if ($btn.html() !== '')\n            {\n                this.$contextbar.append($btn);\n            }\n        }\n\n        // show\n        var pos = this._buildPosition(e, this.$el, position);\n\n        this.$contextbar.css(pos);\n        this.$contextbar.show();\n        this.$contextbar.addClass('open');\n        this.$doc.on('click.redactor-context mouseup.redactor-context', this.close.bind(this));\n        this.$win.on('resize.redactor-context', this.close.bind(this));\n    },\n    open: function(e)\n    {\n        setTimeout(function()\n        {\n            this.app.broadcast('contextbar', e, this);\n        }.bind(this), 0);\n    },\n    close: function(e)\n    {\n        if (!this.$contextbar) return;\n        if (e)\n        {\n            var $target = $R.dom(e.target);\n            if (this.$el && $target.closest(this.$el).length !== 0)\n            {\n                return;\n            }\n        }\n\n        this.$contextbar.hide();\n        this.$contextbar.removeClass('open');\n        this.$doc.off('.redactor.context');\n    },\n\n    // private\n    _build: function()\n    {\n        this.$contextbar = $R.dom('<div>');\n        this.$contextbar.attr('id', 'redactor-context-toolbar-' + this.uuid);\n        this.$contextbar.attr('dir', this.opts.direction);\n        this.$contextbar.addClass('redactor-context-toolbar');\n        this.$contextbar.hide();\n\n        this.$target.append(this.$contextbar);\n    },\n    _buildPosition: function(e, $el, position)\n    {\n        var top, left;\n        var isTarget = this.toolbar.isTarget();\n        var offset = (isTarget) ? $el.position() : $el.offset();\n\n        var width = $el.width();\n        var height = $el.height();\n\n        var barWidth = this.$contextbar.width();\n        var barHeight = this.$contextbar.height();\n        var docScrollTop = (isTarget) ? (this.$target.scrollTop() + this.$doc.scrollTop()) : this.$doc.scrollTop();\n\n        var targetOffset = this.$target.offset();\n        var leftFix = (isTarget) ? targetOffset.left : 0;\n        var topFix = (isTarget) ? targetOffset.top : 0;\n\n        if (!position)\n        {\n            top = (e.clientY + docScrollTop - barHeight);\n            left = (e.clientX - barWidth/2);\n        }\n        else if (position === 'top')\n        {\n            top = (offset.top - barHeight);\n            left = (offset.left + width/2 - barWidth/2);\n        }\n        else if (position === 'bottom')\n        {\n            top = (offset.top + height);\n            left = (offset.left + width/2 - barWidth/2);\n        }\n\n        if (left < 0) left = 0;\n\n        return { top: (top - topFix) + 'px', left: (left - leftFix) + 'px' };\n    }\n});\n$R.add('class', 'contextbar.button', {\n    mixins: ['dom'],\n    init: function(app, obj)\n    {\n        this.app = app;\n\n        // local\n        this.obj = obj;\n\n        // init\n        this._init();\n    },\n    // private\n    _init: function()\n    {\n        this.parse('<a>');\n\n        if (typeof this.obj.title !== 'string')\n        {\n            var url = this.obj.title.attr('href');\n            this.attr('href', url);\n\n            if (url.search(/^#/) === -1) {\n                this.attr('target', '_blank');\n            }\n\n            this.text(this.obj.html || url);\n        }\n        else\n        {\n            this.attr('href', '#');\n\n            this._buildTitle();\n            this._buildMessage();\n        }\n    },\n    _buildTitle: function()\n    {\n        this.html(this.obj.title);\n    },\n    _buildMessage: function()\n    {\n        if (typeof this.obj.message !== 'undefined' || typeof this.obj.api !== 'undefined')\n        {\n            this.on('click', this._toggle.bind(this));\n        }\n    },\n    _toggle: function(e)\n    {\n        e.preventDefault();\n\n        if (this.obj.message)\n        {\n            this.app.broadcast(this.obj.message, this.obj.args);\n        }\n        else if (this.obj.api)\n        {\n            this.app.api(this.obj.api, this.obj.args);\n        }\n    }\n});\n$R.add('module', 'toolbar', {\n    init: function(app)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.toolbar = app.toolbar;\n        this.detector = app.detector;\n\n        // local\n        this.buttons = [];\n        this.toolbarModule = false;\n    },\n    // messages\n    onsource: {\n        open: function()\n        {\n            if (!this.toolbar.isAir() && this.toolbar.isFixed())\n            {\n                this.toolbarModule.resetPosition();\n            }\n        },\n        opened: function()\n        {\n            if (this.toolbar.isAir() && this.toolbarModule)\n            {\n                this.toolbarModule.createSourceHelper();\n            }\n\n            // hide tooltips\n            setTimeout(function()\n            {\n                $R.dom('.re-button-tooltip-' + this.uuid).remove();\n            }.bind(this), 100)\n\n        },\n        close: function()\n        {\n            if (this.toolbar.isAir() && this.toolbarModule)\n            {\n                this.toolbarModule.destroySourceHelper();\n            }\n        },\n        closed: function()\n        {\n            if (this.toolbar.is() && this.opts.air)\n            {\n                this.toolbarModule.openSelected();\n            }\n        }\n    },\n    ontoolbar: {\n        removeexternal: function() {\n            if (!this.opts.air && this.opts.toolbarExternal && this.opts.clickToEdit) {\n                $R.dom(this.opts.toolbarExternal).html('');\n            }\n        }\n    },\n    onobserve: function()\n    {\n        if (this.toolbar.is())\n        {\n            this.toolbar.observe();\n        }\n    },\n    onfocus: function()\n    {\n        this._setExternalOnFocus();\n    },\n    onsourcefocus: function()\n    {\n        this._setExternalOnFocus();\n    },\n    onempty: function()\n    {\n        if (this.toolbar.isFixed())\n        {\n            this.toolbarModule.resetPosition();\n        }\n    },\n    onenablereadonly: function()\n    {\n        if (this.toolbar.isAir())\n        {\n            this.toolbarModule.close();\n        }\n    },\n\n    // public\n    start: function()\n    {\n        if (this.toolbar.is())\n        {\n            this._buildButtons();\n            this._initToolbar();\n            this._initButtons();\n        }\n    },\n    stop: function()\n    {\n        if (this.toolbarModule)\n        {\n            this.toolbarModule.stop();\n        }\n\n        // stop dropdowns\n        $R.dom('.redactor-dropdown-' + this.uuid).remove();\n    },\n\n    // private\n    _buildButtons: function()\n    {\n        this.buttons = this.opts.buttons.concat();\n\n        this._buildImageButton();\n        this._buildFileButton();\n        this._buildSourceButton();\n        this._buildAdditionalButtons();\n        this._buildHiddenButtons();\n    },\n    _buildImageButton: function()\n    {\n        if (!this.opts.imageUpload && !this.opts.imageManagerJson) this.utils.removeFromArrayByValue(this.buttons, 'image');\n    },\n    _buildFileButton: function()\n    {\n        if (!this.opts.fileUpload) this.utils.removeFromArrayByValue(this.buttons, 'file');\n    },\n    _buildSourceButton: function()\n    {\n        if (!this.opts.source) this.utils.removeFromArrayByValue(this.buttons, 'html');\n    },\n    _buildAdditionalButtons: function()\n    {\n        // end\n        if (this.opts.buttonsAdd.length !== 0)\n        {\n            this.opts.buttonsAdd = this._removeExistButtons(this.opts.buttonsAdd);\n            this.buttons = this.buttons.concat(this.opts.buttonsAdd);\n        }\n\n        // beginning\n        if (this.opts.buttonsAddFirst.length !== 0)\n        {\n            this.opts.buttonsAddFirst = this._removeExistButtons(this.opts.buttonsAddFirst);\n            this.buttons.unshift(this.opts.buttonsAddFirst);\n        }\n\n        var index, btns;\n\n        // after\n        if (this.opts.buttonsAddAfter !== false)\n        {\n            index = this.buttons.indexOf(this.opts.buttonsAddAfter.after) + 1;\n            btns = this.opts.buttonsAddAfter.buttons;\n            for (var i = 0; i < btns.length; i++)\n            {\n                this.buttons.splice(index+i, 0, btns[i]);\n            }\n        }\n\n        // before\n        if (this.opts.buttonsAddBefore !== false)\n        {\n            index = this.buttons.indexOf(this.opts.buttonsAddBefore.before)+1;\n            btns = this.opts.buttonsAddBefore.buttons;\n            for (var i = 0; i < btns.length; i++)\n            {\n                this.buttons.splice(index-(1-i), 0, btns[i]);\n            }\n        }\n    },\n    _buildHiddenButtons: function()\n    {\n        if (this.opts.buttonsHide.length !== 0) {\n            var buttons = this.opts.buttonsHide;\n            for (var i = 0; i < buttons.length; i++) {\n                this.utils.removeFromArrayByValue(this.buttons, buttons[i]);\n            }\n        }\n\n        if (this.detector.isMobile() && this.opts.buttonsHideOnMobile.length !== 0) {\n            var buttons = this.opts.buttonsHideOnMobile;\n            for (var i = 0; i < buttons.length; i++) {\n                this.utils.removeFromArrayByValue(this.buttons, buttons[i]);\n            }\n        }\n    },\n    _removeExistButtons: function(buttons)\n    {\n        for (var i = 0; i < buttons.length; i++)\n        {\n            if (this.opts.buttons.indexOf(buttons[i]) !== -1)\n            {\n                this.utils.removeFromArrayByValue(buttons, buttons[i]);\n            }\n        }\n\n        return buttons;\n    },\n    _setExternalOnFocus: function()\n    {\n        if (!this.opts.air && this.opts.toolbarExternal)\n        {\n            this.toolbarModule.setExternal();\n        }\n    },\n    _initToolbar: function()\n    {\n        this.toolbarModule = (this.opts.air) ? $R.create('toolbar.air', this.app) : $R.create('toolbar.standard', this.app);\n    },\n    _initButtons: function()\n    {\n        this.toolbar.setButtons(this.buttons);\n\n        for (var i = 0; i < this.buttons.length; i++)\n        {\n            var name = this.buttons[i];\n            if ($R.buttons[name])\n            {\n                this.toolbar.addButton(name, $R.buttons[name], false, false, true);\n            }\n        }\n    }\n});\n$R.add('class', 'toolbar.air', {\n    init: function(app)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.$doc = app.$doc;\n        this.$win = app.$win;\n        this.utils = app.utils;\n        this.editor = app.editor;\n        this.animate = app.animate;\n        this.toolbar = app.toolbar;\n        this.container = app.container;\n        this.inspector = app.inspector;\n        this.selection = app.selection;\n\n        // local\n        this.clicks = 0;\n\n        // init\n        this._init();\n    },\n    // public\n    stop: function()\n    {\n        var $wrapper = this.toolbar.getWrapper();\n        $wrapper.remove();\n\n        var $editor = this.editor.getElement();\n        $editor.off('.redactor-air-trigger-' + this.uuid);\n\n        this.$doc.off('.redactor-air-' + this.uuid);\n        this.$doc.off('.redactor-air-trigger-' + this.uuid);\n\n        this.toolbar.stopObservers();\n    },\n    createSourceHelper: function()\n    {\n        this.$airHelper = $R.dom('<span>');\n        this.$airHelper.addClass('redactor-air-helper');\n        this.$airHelper.html('<i class=\"re-icon-html\"></i>');\n        this.$airHelper.on('click', function(e)\n        {\n            e.preventDefault();\n            this.app.api('module.source.hide');\n\n        }.bind(this));\n\n        var $container = this.container.getElement();\n        $container.append(this.$airHelper);\n    },\n    destroySourceHelper: function()\n    {\n        if (this.$airHelper) this.$airHelper.remove();\n    },\n    openSelected: function()\n    {\n        setTimeout(function()\n        {\n            if (this._isSelection()) this._open(false);\n\n        }.bind(this), 0);\n    },\n    close: function()\n    {\n        this.$doc.off('.redactor-air-' + this.uuid);\n\n        var $toolbar = this.toolbar.getElement();\n        $toolbar.removeClass('open');\n        $toolbar.hide();\n    },\n\n    // private\n    _init: function()\n    {\n        this.toolbar.create();\n\n        var $wrapper = this.toolbar.getWrapper();\n        var $toolbar = this.toolbar.getElement();\n        var $editor = this.editor.getElement();\n        var $container = this.container.getElement();\n\n        $wrapper.addClass('redactor-toolbar-wrapper-air');\n        $toolbar.addClass('redactor-air');\n        //$toolbar.addClass('redactor-animate-hide');\n        $toolbar.hide();\n\n        $wrapper.append($toolbar);\n        $container.prepend($wrapper);\n\n        // open selected\n        this.openSelected();\n\n        // events\n        this.$doc.on('mouseup.redactor-air-trigger-' + this.uuid, this._open.bind(this));\n        $editor.on('keyup.redactor-air-trigger-' + this.uuid, this._openCmd.bind(this));\n    },\n    _isSelection: function()\n    {\n        return (this.selection.is() && !this.selection.isCollapsed());\n    },\n    _isOpened: function()\n    {\n        var $toolbar = this.toolbar.getElement();\n\n        return $toolbar.hasClass('open');\n    },\n    _open: function(e)\n    {\n        var target = (e) ? e.target : false;\n        var $el = (e) ? $R.dom(e.target) : false;\n        var dataTarget = this.inspector.parse(target);\n        var isComponent = (dataTarget.isComponent() && !dataTarget.isComponentType('table'));\n        var isFigcaption = (dataTarget.isFigcaption());\n        var isModalTarget = ($el && $el.closest('.redactor-modal').length !== 0);\n        var isButtonCall = (e && $el.closest('.re-button').length !== 0);\n        var isDropdownCall = (e && $el.closest('.redactor-dropdown').length !== 0);\n\n        if (isDropdownCall || isButtonCall || isModalTarget || isFigcaption || isComponent || this.toolbar.isContextBar() || !this._isSelection())\n        {\n            return;\n        }\n\n        var pos = this.selection.getPosition();\n\n        setTimeout(function()\n        {\n            if (this.app.isReadOnly()) return;\n            if (this._isSelection()) this._doOpen(pos);\n\n        }.bind(this), 1);\n\n    },\n    _openCmd: function()\n    {\n        if (this.selection.isAll())\n        {\n            var $toolbar = this.toolbar.getElement();\n            var pos = this.selection.getPosition();\n\n            pos.top = (pos.top < 20) ? 0 : pos.top - $toolbar.height();\n            pos.height = 0;\n\n            this._doOpen(pos);\n        }\n    },\n    _doOpen: function(pos)\n    {\n        var $wrapper = this.toolbar.getWrapper();\n        var $toolbar = this.toolbar.getElement();\n        var $container = this.container.getElement();\n        var containerOffset = $container.offset();\n        var leftFix = 0;\n        var winWidth = this.$win.width();\n        var toolbarWidth = $toolbar.width();\n\n        if (winWidth < (pos.left + toolbarWidth))\n        {\n            var selPos = this.selection.getPosition();\n            leftFix = toolbarWidth - selPos.width;\n        }\n\n        $wrapper.css({\n            left: (pos.left - containerOffset.left - leftFix) + 'px',\n            top: (pos.top - containerOffset.top + pos.height + this.$doc.scrollTop()) + 'px'\n        });\n\n        this.app.broadcast('airOpen');\n        $toolbar.addClass('open');\n        $toolbar.show();\n\n        this.$doc.on('click.redactor-air-' + this.uuid, this._close.bind(this));\n        this.$doc.on('keydown.redactor-air-' + this.uuid, this._close.bind(this));\n        this.app.broadcast('airOpened');\n    },\n    _close: function(e)\n    {\n        var $el = (e) ? $R.dom(e.target) : false;\n        var isDropdownCall = (e && $el.closest('[data-dropdown], .redactor-dropdown-not-close').length !== 0);\n        var isButtonCall = (!isDropdownCall && e && $el.closest('.re-button').length !== 0);\n\n        if (!isButtonCall && (isDropdownCall || !this._isOpened()))\n        {\n            return;\n        }\n\n        // close\n        this.app.broadcast('airClose');\n\n        this.close();\n        this.app.broadcast('airClosed');\n    }\n});\n$R.add('class', 'toolbar.fixed', {\n    init: function(app)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.opts = app.opts;\n        this.$doc = app.$doc;\n        this.$win = app.$win;\n        this.editor = app.editor;\n        this.toolbar = app.toolbar;\n        this.detector = app.detector;\n        this.container = app.container;\n\n        // init\n        this._init();\n    },\n    // public\n    stop: function()\n    {\n        this.$fixedTarget.off('.redactor-toolbar-' + this.uuid);\n        this.$win.off('.redactor-toolbar-' + this.uuid);\n    },\n    reset: function()\n    {\n        var $toolbar = this.toolbar.getElement();\n        var $wrapper = this.toolbar.getWrapper();\n\n        $wrapper.css('height', '');\n        $toolbar.removeClass('redactor-toolbar-fixed');\n        $toolbar.css({ position: '', top: '', left: '', width: '' });\n\n        var dropdown = this.toolbar.getDropdown();\n        if (dropdown) dropdown.updatePosition();\n    },\n\n    // private\n    _init: function()\n    {\n        this.$fixedTarget = (this.toolbar.isTarget()) ? this.toolbar.getTargetElement() : this.$win;\n        this._doFixed();\n\n        if (this.toolbar.isTarget())\n        {\n            this.$win.on('scroll.redactor-toolbar-' + this.uuid, this._doFixed.bind(this));\n            this.$win.on('resize.redactor-toolbar-' + this.uuid, this._doFixed.bind(this));\n        }\n\n        this.$fixedTarget.on('scroll.redactor-toolbar-' + this.uuid, this._doFixed.bind(this));\n        this.$fixedTarget.on('resize.redactor-toolbar-' + this.uuid, this._doFixed.bind(this));\n    },\n    _doFixed: function()\n    {\n        var $editor = this.editor.getElement();\n        var $container = this.container.getElement();\n        var $toolbar = this.toolbar.getElement();\n        var $wrapper = this.toolbar.getWrapper();\n\n        if (this.editor.isSourceMode())\n        {\n            return;\n        }\n\n        var $targets = $container.parents().filter(function(node)\n        {\n            return (getComputedStyle(node, null).display === 'none') ? node : false;\n        });\n\n        // has hidden parent\n        if ($targets.length !== 0) return;\n\n        var isHeight = ($editor.height() < 100);\n        var isEmpty = this.editor.isEmpty();\n\n        if (isHeight || isEmpty) {\n            this.reset();\n            return;\n        }\n\n        if (this.editor.isSourceMode()) {\n            return;\n        }\n\n        var toolbarHeight = $toolbar.height();\n        var toleranceEnd = 60;\n        var containerOffset = (this.toolbar.isTarget()) ? $container.position() : $container.offset();\n        var boxOffset = containerOffset.top;\n        var boxEnd = boxOffset + $container.height() - toleranceEnd;\n        var scrollOffset = this.$fixedTarget.scrollTop() + this.opts.toolbarFixedTopOffset;\n        var top = (!this.toolbar.isTarget()) ? 0 : this.$fixedTarget.offset().top - this.$win.scrollTop();\n        if (this.toolbar.isTarget() && this.$fixedTarget.css('position') === 'fixed') {\n            var bs = (this.$fixedTarget.hasClass('modal') && this.$fixedTarget.hasClass('fade'));\n            var bsFix = (bs) ? $container.closest('.modal-dialog').position().top : 0;\n            top = this.$fixedTarget.scrollTop() - bsFix;\n        }\n\n\n        if (scrollOffset > boxOffset && scrollOffset < boxEnd)\n        {\n            var position = (this.detector.isDesktop()) ? 'fixed' : 'absolute';\n            top = (this.detector.isDesktop()) ? top : (scrollOffset - boxOffset);\n\n            if (this.detector.isMobile())\n            {\n                if (this.fixedScrollTimeout)\n                {\n                    clearTimeout(this.fixedScrollTimeout);\n                }\n\n                $toolbar.hide();\n                this.fixedScrollTimeout = setTimeout(function()\n                {\n                    $toolbar.show();\n                }, 250);\n            }\n\n            $wrapper.height(toolbarHeight);\n            $toolbar.addClass('redactor-toolbar-fixed');\n\n            if ($container.hasClass('redactor-box-fullscreen'))\n            {\n                $toolbar.css({\n                    position: position,\n                    top: '0px',\n                    width: $container.width() + 'px'\n                });\n            }\n            else\n            {\n                $toolbar.css({\n                    position: position,\n                    top: (top + this.opts.toolbarFixedTopOffset) + 'px',\n                    width: $container.width() + 'px'\n                });\n            }\n\n            var dropdown = this.toolbar.getDropdown();\n            if (dropdown) dropdown.updatePosition();\n\n            this.app.broadcast('toolbar.fixed');\n        }\n        else\n        {\n            this.reset();\n            this.app.broadcast('toolbar.unfixed');\n        }\n    }\n});\n$R.add('class', 'toolbar.standard', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.uuid = app.uuid;\n        this.$body = app.$body;\n        this.toolbar = app.toolbar;\n        this.container = app.container;\n\n        // local\n        this.isExternalMultiple = false;\n        this.toolbarFixed = false;\n\n        // init\n        this._init();\n    },\n    // public\n    stop: function()\n    {\n        var $wrapper = this.toolbar.getWrapper();\n        $wrapper.remove();\n\n        if (this.toolbarFixed) this.toolbarFixed.stop();\n        if (this.opts.toolbarExternal) this._findToolbars();\n\n        this.toolbar.stopObservers();\n        this.$body.find('.re-button-tooltip-' + this.uuid).remove();\n    },\n    setExternal: function()\n    {\n        this._findToolbars();\n        if (this.isExternalMultiple)\n        {\n            this.$toolbars.hide();\n            var $current = this.$external.find('.redactor-toolbar-external-' + this.uuid);\n            $current.show();\n        }\n    },\n    resetPosition: function()\n    {\n        if (this.toolbarFixed) this.toolbarFixed.reset();\n    },\n\n    // private\n    _init: function()\n    {\n        this._build();\n\n        if (this.opts.toolbarExternal)\n        {\n            this._buildExternal();\n        }\n        else\n        {\n            this._buildFixed();\n\n            var $toolbar = this.toolbar.getElement();\n            $toolbar.show();\n        }\n    },\n    _build: function()\n    {\n        this.toolbar.create();\n\n        var $wrapper = this.toolbar.getWrapper();\n        var $toolbar = this.toolbar.getElement();\n\n        $wrapper.addClass('redactor-toolbar-wrapper');\n        $toolbar.addClass('redactor-toolbar');\n        $toolbar.hide();\n        $wrapper.append($toolbar);\n\n        if (!this.opts.toolbarExternal)\n        {\n            var $container = this.container.getElement();\n            $container.prepend($wrapper);\n        }\n    },\n    _buildExternal: function()\n    {\n        this._initExternal();\n        this._findToolbars();\n\n        if (this.isExternalMultiple)\n        {\n            this._hideToolbarsExceptFirst();\n        }\n        else\n        {\n            var $toolbar = this.toolbar.getElement();\n            $toolbar.show();\n        }\n    },\n    _buildFixed: function()\n    {\n        if (this.opts.toolbarFixed)\n        {\n            this.toolbarFixed = $R.create('toolbar.fixed', this.app);\n        }\n    },\n    _initExternal: function()\n    {\n        var $toolbar = this.toolbar.getElement();\n        var $wrapper = this.toolbar.getElement();\n\n        $toolbar.addClass('redactor-toolbar-external redactor-toolbar-external-' + this.uuid);\n\n        this.$external = $R.dom(this.opts.toolbarExternal);\n        this.$external.append($wrapper);\n\n    },\n    _findToolbars: function()\n    {\n        this.$toolbars = this.$external.find('.redactor-toolbar-external');\n        this.isExternalMultiple = (this.$toolbars.length > 1);\n    },\n    _hideToolbarsExceptFirst: function()\n    {\n        this.$toolbars.hide();\n        var $first = this.$toolbars.first();\n        $first.show();\n    }\n});\n$R.add('module', 'line', {\n    init: function(app)\n    {\n        this.app = app;\n        this.lang = app.lang;\n        this.component = app.component;\n        this.inspector = app.inspector;\n        this.insertion = app.insertion;\n    },\n    // messages\n    oncontextbar: function(e, contextbar)\n    {\n        var data = this.inspector.parse(e.target);\n        if (data.isComponentType('line'))\n        {\n            var node = data.getComponent();\n            var buttons = {\n                \"remove\": {\n                    title: this.lang.get('delete'),\n                    api: 'module.line.remove',\n                    args: node\n                }\n            };\n\n            contextbar.set(e, node, buttons, 'bottom');\n        }\n\n    },\n\n    // public\n    insert: function()\n    {\n        var line = this.component.create('line');\n        this.insertion.insertRaw(line);\n    },\n    remove: function(node)\n    {\n        this.component.remove(node);\n    }\n});\n$R.add('class', 'line.component', {\n    mixins: ['dom', 'component'],\n    init: function(app, el)\n    {\n        this.app = app;\n\n        // init\n        return (el && el.cmnt !== undefined) ? el : this._init(el);\n    },\n    // private\n    _init: function(el)\n    {\n        var wrapper, element;\n        if (typeof el !== 'undefined')\n        {\n            var $node = $R.dom(el);\n            var node = $node.get();\n\n            if (node.tagName === 'HR') element = node;\n            else if (node.tagName === 'FIGURE')\n            {\n                wrapper = node;\n                element = $node.find('hr').get();\n            }\n        }\n\n        this._buildWrapper(wrapper);\n        this._buildElement(element);\n        this._initWrapper();\n    },\n    _buildElement: function(node)\n    {\n        if (node)\n        {\n            this.$element = $R.dom(node);\n        }\n        else\n        {\n            this.$element = $R.dom('<hr>');\n            this.append(this.$element);\n        }\n    },\n    _buildWrapper: function(node)\n    {\n        node = node || '<figure>';\n\n        this.parse(node);\n    },\n    _initWrapper: function()\n    {\n        this.addClass('redactor-component');\n        this.attr({\n            'data-redactor-type': 'line',\n            'tabindex': '-1',\n            'contenteditable': false\n        });\n    }\n});\n$R.add('module', 'link', {\n    modals: {\n        'link':\n            '<form action=\"\"> \\\n                <div class=\"form-item\"> \\\n                    <label for=\"modal-link-url\">URL <span class=\"req\">*</span></label> \\\n                    <input type=\"text\" id=\"modal-link-url\" name=\"url\"> \\\n                </div> \\\n                <div class=\"form-item\"> \\\n                    <label for=\"modal-link-text\">## text ##</label> \\\n                    <input type=\"text\" id=\"modal-link-text\" name=\"text\"> \\\n                </div> \\\n                <div class=\"form-item form-item-title\"> \\\n                    <label for=\"modal-link-title\">## title ##</label> \\\n                    <input type=\"text\" id=\"modal-link-title\" name=\"title\"> \\\n                </div> \\\n                <div class=\"form-item form-item-target\"> \\\n                    <label class=\"checkbox\"> \\\n                        <input type=\"checkbox\" name=\"target\"> ## link-in-new-tab ## \\\n                    </label> \\\n                </div> \\\n            </form>'\n    },\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.lang = app.lang;\n        this.caret = app.caret;\n        this.utils = app.utils;\n        this.inline = app.inline;\n        this.editor = app.editor;\n        this.inspector = app.inspector;\n        this.insertion = app.insertion;\n        this.selection = app.selection;\n\n        // local\n        this.isCurrentLink = false;\n        this.currentText = false;\n    },\n    // messages\n    onmodal: {\n        link: {\n            open: function($modal, $form)\n            {\n                this._setFormData($form, $modal);\n            },\n            opened: function($modal, $form)\n            {\n                this._setFormFocus($form);\n            },\n            update: function($modal, $form)\n            {\n                var data = $form.getData();\n                if (this._validateData($form, data))\n                {\n                    this._update(data);\n                }\n            },\n            insert: function($modal, $form)\n            {\n                var data = $form.getData();\n                if (this._validateData($form, data))\n                {\n                    this._insert(data);\n                }\n            },\n            unlink: function()\n            {\n                this._unlink();\n            }\n        }\n    },\n    onbutton: {\n        link: {\n            observe: function(button)\n            {\n                this._observeButton(button);\n            }\n        }\n    },\n    ondropdown: {\n        link: {\n            observe: function(dropdown)\n            {\n                this._observeUnlink(dropdown);\n                this._observeEdit(dropdown);\n            }\n        }\n    },\n    oncontextbar: function(e, contextbar)\n    {\n        var current = this._getCurrent();\n        var data = this.inspector.parse(current);\n        if (data.isLink() || data.isFile())\n        {\n            var node = (data.isFile()) ? data.getFile() : data.getLink();\n            var $el = $R.dom(node);\n\n            var $point = $R.dom('<a>');\n            var url = $el.attr('href');\n\n            $point.text(this._truncateText(url));\n            $point.attr('href', url);\n            $point.attr('target', '_blank');\n\n            var buttons = {\n                \"link\": {\n                    title: $point,\n                    html: this._truncateText(url)\n                },\n                \"edit\": {\n                    title: this.lang.get('edit'),\n                    api: 'module.link.open'\n                },\n                \"unlink\": {\n                    title: this.lang.get('unlink'),\n                    api: 'module.link.unlink'\n                }\n            };\n\n            contextbar.set(e, node, buttons, 'bottom');\n        }\n    },\n\n    // public\n    open: function()\n    {\n        this.$link = this._buildCurrent();\n        this.app.api('module.modal.build', this._getModalData());\n    },\n    insert: function(data)\n    {\n        this._insert(data);\n    },\n    update: function(data)\n    {\n        this._update(data);\n    },\n    unlink: function()\n    {\n        this._unlink();\n    },\n\n    // private\n    _observeButton: function(button)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n\n        if (data.isPre() || data.isCode())\n        {\n            button.disable();\n        }\n        else\n        {\n            button.enable();\n        }\n    },\n    _observeUnlink: function(dropdown)\n    {\n        var $item = dropdown.getItem('unlink');\n        var links = this._getLinks();\n\n        if (links.length === 0) $item.disable();\n        else                    $item.enable();\n    },\n    _observeEdit: function(dropdown)\n    {\n        var current = this._getCurrent();\n        var $item = dropdown.getItem('link');\n\n        var data = this.inspector.parse(current);\n        var title = (data.isLink() || data.isFile()) ? this.lang.get('link-edit') : this.lang.get('link-insert');\n\n        $item.setTitle(title);\n    },\n    _unlink: function()\n    {\n        this.app.api('module.modal.close');\n\n        var elms = [];\n        var nodes = this._getLinks();\n\n        this.selection.save();\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var $link = $R.create('link.component', this.app, nodes[i]);\n            elms.push(this.selection.getElement(nodes[i]));\n\n            $link.unwrap();\n\n            // callback\n            this.app.broadcast('link.deleted', $link);\n        }\n        this.selection.restore();\n\n        // normalize\n        for (var i = 0; i < elms.length; i++)\n        {\n            var el = (elms[i]) ? elms[i] : this.editor.getElement();\n            this.utils.normalizeTextNodes(el);\n        }\n\n        this._resetCurrent();\n    },\n    _update: function(data)\n    {\n        this.app.api('module.modal.close');\n\n        var nodes = this._getLinks();\n        this._setLinkData(nodes, data, 'updated');\n        this._resetCurrent();\n\n        // callback\n        this.app.broadcast('link.changed', nodes);\n    },\n    _insert: function(data)\n    {\n        this.app.api('module.modal.close');\n\n        var links = this._getLinks();\n\n        if (!this._insertSingle(links, data))\n        {\n            this._removeInSelection(links);\n            this._insertMultiple(data);\n        }\n\n        this._resetCurrent();\n    },\n    _removeInSelection: function(links)\n    {\n        this.selection.save();\n        for (var i = 0; i < links.length; i++)\n        {\n            var $link = $R.create('link.component', this.app, links[i]);\n            var $clonedLink = $link.clone();\n            $link.unwrap();\n\n            // callback\n            this.app.broadcast('link.deleted', $clonedLink);\n        }\n        this.selection.restore();\n    },\n    _insertMultiple: function(data)\n    {\n        var range = this.selection.getRange();\n        if (range && this._isCurrentTextChanged(data))\n        {\n            this._deleteContents(range);\n        }\n\n        var nodes = this.inline.format({ tag: 'a' });\n\n        this._setLinkData(nodes, data, 'inserted');\n    },\n    _insertSingle: function(links, data)\n    {\n        var inline = this.selection.getInline();\n        if (links.length === 1 && (links[0].textContext === this.selection.getText()) || (inline && inline.tagName === 'A'))\n        {\n            var $link = $R.create('link.component', this.app, links[0]);\n\n            $link.setData(data);\n            this.caret.setAfter($link);\n\n            // callback\n            this.app.broadcast('link.inserted', $link);\n\n            return true;\n        }\n\n        return false;\n    },\n    _setLinkData: function(nodes, data, type)\n    {\n        data.text = (data.text.trim() === '') ? this._truncateText(data.url) : data.text;\n\n        var isTextChanged = (!this.currentText || this.currentText !== data.text);\n\n        this.selection.save();\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var $link = $R.create('link.component', this.app, nodes[i]);\n            var linkData = {};\n\n            if (data.text && isTextChanged) linkData.text = data.text;\n            if (data.url) linkData.url = data.url;\n            if (data.title !== undefined) linkData.title = data.title;\n            if (data.target !== undefined) linkData.target = data.target;\n\n            $link.setData(linkData);\n\n            // callback\n            this.app.broadcast('link.' + type, $link);\n        }\n\n        setTimeout(this.selection.restore.bind(this.selection), 0);\n    },\n    _deleteContents: function(range)\n    {\n        var html = this.selection.getHtml();\n        var parsed = this.utils.parseHtml(html);\n        var first = parsed.nodes[0];\n\n        if (first && first.nodeType !== 3)\n        {\n            var tag = first.tagName.toLowerCase();\n            var container = document.createElement(tag);\n\n            this.insertion.insertNode(container, 'start');\n        }\n        else\n        {\n            range.deleteContents();\n        }\n    },\n    _getModalData: function()\n    {\n        var commands;\n        if (this._isLink())\n        {\n           commands = {\n                update: { title: this.lang.get('save') },\n                unlink: { title: this.lang.get('unlink'), type: 'danger' },\n                cancel: { title: this.lang.get('cancel') }\n            };\n        }\n        else\n        {\n            commands = {\n                insert: { title: this.lang.get('insert') },\n                cancel: { title: this.lang.get('cancel') }\n            };\n        }\n\n        var modalData = {\n            name: 'link',\n            title: (this._isLink()) ? this.lang.get('link-edit') : this.lang.get('link-insert'),\n            handle: (this._isLink()) ? 'update' : 'insert',\n            commands: commands\n        };\n\n\n        return modalData;\n    },\n    _isLink: function()\n    {\n        return this.currentLink;\n    },\n    _isCurrentTextChanged: function(data)\n    {\n        return (this.currentText && this.currentText !== data.text);\n    },\n    _buildCurrent: function()\n    {\n        var current = this._getCurrent();\n        var data = this.inspector.parse(current);\n        var $link;\n\n        if (data.isLink() || data.isFile())\n        {\n            this.currentLink = true;\n\n            $link = (data.isFile()) ? data.getFile() : data.getLink();\n            $link = $R.create('link.component', this.app, $link);\n        }\n        else\n        {\n            this.currentLink = false;\n\n            $link = $R.create('link.component', this.app);\n            var linkData = {\n                text: this.selection.getText()\n            };\n\n            $link.setData(linkData);\n        }\n\n        return $link;\n    },\n    _getCurrent: function()\n    {\n        return this.selection.getInlinesAllSelected({ tags: ['a'] })[0];\n    },\n    _getLinks: function()\n    {\n        var links = this.selection.getInlines({ all: true, tags: ['a'] });\n        var arr = [];\n        for (var i = 0; i < links.length; i++)\n        {\n            var data = this.inspector.parse(links[i]);\n            if (data.isLink() || data.isFile())\n            {\n                arr.push(links[i]);\n            }\n        }\n\n        return arr;\n    },\n    _resetCurrent: function()\n    {\n        this.isCurrentLink = false;\n        this.currentText = false;\n    },\n    _truncateText: function(url)\n    {\n        return (url && url.length > this.opts.linkSize) ? url.substring(0, this.opts.linkSize) + '...' : url;\n    },\n    _validateData: function($form, data)\n    {\n        return (data.url.trim() === '') ? $form.setError('url') : true;\n    },\n    _setFormFocus: function($form)\n    {\n        $form.getField('url').focus();\n    },\n    _setFormData: function($form, $modal)\n    {\n        var linkData = this.$link.getData();\n        var data = {\n            url: linkData.url,\n            text: linkData.text,\n            title: linkData.title,\n            target: (this.opts.linkTarget || linkData.target)\n        };\n\n        if (!this.opts.linkNewTab) $modal.find('.form-item-target').hide();\n        if (!this.opts.linkTitle) $modal.find('.form-item-title').hide();\n\n        $form.setData(data);\n        this.currentText = $form.getField('text').val();\n    }\n});\n$R.add('class', 'link.component', {\n    mixins: ['dom', 'component'],\n    init: function(app, el)\n    {\n        this.app = app;\n        this.opts = app.opts;\n\n        // local\n        this.reUrl = /^(?:(?:(?:https?|ftp):)?\\/\\/)?(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))(?::\\d{2,5})?(?:[/?#]\\S*)?$/i;\n\n        // init\n        return (el && el.cmnt !== undefined) ? el :  this._init(el);\n    },\n\n    // public\n    setData: function(data)\n    {\n        for (var name in data)\n        {\n            this._set(name, data[name]);\n        }\n    },\n    getData: function()\n    {\n        var names = ['url', 'text', 'target', 'title'];\n        var data = {};\n\n        for (var i = 0; i < names.length; i++)\n        {\n            data[names[i]] = this._get(names[i]);\n        }\n\n        return data;\n    },\n\n    // private\n    _init: function(el)\n    {\n        var $el = $R.dom(el);\n        if (el === undefined)\n        {\n            this.parse('<a>');\n        }\n        else\n        {\n            this.parse($el);\n        }\n    },\n    _set: function(name, value)\n    {\n        this['_set_' + name](value);\n    },\n    _get: function(name)\n    {\n        return this['_get_' + name]();\n    },\n    _get_target: function()\n    {\n        return (this.attr('target')) ? this.attr('target') : false;\n    },\n    _get_url: function()\n    {\n        return this.attr('href');\n    },\n    _get_title: function()\n    {\n        return this.attr('title');\n    },\n    _get_text: function()\n    {\n        return this._getContext().text();\n    },\n    _getContext: function()\n    {\n        return this._findDeepestChild(this).element;\n    },\n    _set_target: function(target)\n    {\n        if (target === false) this.removeAttr('target');\n        else if (target)\n        {\n            this.attr('target', (target === true) ? '_blank' : target);\n        }\n    },\n    _set_text: function(text)\n    {\n        this._getContext().html(text);\n    },\n    _set_title: function(title)\n    {\n        if (!title || title === '') this.removeAttr('title');\n        else this.attr('title', title);\n    },\n    _set_url: function(url)\n    {\n        if (this.opts.linkValidation)\n        {\n            url = this._cleanUrl(url);\n\n            if (this._isMailto(url))\n            {\n                url = 'mailto:' + url.replace('mailto:', '');\n            }\n            else if (this._isUrl(url) && url.search(/^(ftp|https?)/i) === -1)\n            {\n                url = 'http://' + url.replace(/(ftp|https?):\\/\\//i, '');\n            }\n        }\n\n        this.attr('href', url);\n    },\n    _isMailto: function(url)\n    {\n        return (url.search('@') !== -1 && /(ftp|https?):\\/\\//i.test(url) === false);\n    },\n    _isUrl: function(url)\n    {\n        return this.reUrl.test(url);\n    },\n    _cleanUrl: function(url)\n    {\n        url = url.replace(/&/g, \"&amp;\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\").replace(/\"/g, \"&quot;\").replace(/'/g, \"&#039;\");\n\n        return url.trim().replace(/[^\\W\\w\\D\\d+&\\'@#/%?=~_|!:,.;\\(\\)]/gi, '');\n    },\n    _findDeepestChild: function(parent)\n    {\n        var result = {depth: 0, element: parent };\n\n        parent.children().each(function(node)\n        {\n            var child = $R.dom(node);\n\n            if (node.outerHTML !== parent.html())\n            {\n                return;\n            }\n            else\n            {\n                var childResult = this._findDeepestChild(child);\n                if (childResult.depth + 1 > result.depth)\n                {\n                    result = {\n                        depth: 1 + childResult.depth,\n                        element: childResult.element\n                    };\n                }\n            }\n        }.bind(this));\n\n        return result;\n    }\n});\n$R.add('module', 'modal', {\n    init: function(app)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.lang = app.lang;\n        this.$doc = app.$doc;\n        this.$win = app.$win;\n        this.$body = app.$body;\n        this.utils = app.utils;\n        this.editor = app.editor;\n        this.animate = app.animate;\n        this.detector = app.detector;\n        this.selection = app.selection;\n\n        // local\n        this.$box = false;\n        this.$modal = false;\n        this.selectionMarkers = false;\n\n        // defaults\n        this.defaults = {\n            name: false,\n            url: false,\n            title: false,\n            width: '600px',\n            height: false,\n            handle: false,\n            commands: false\n        };\n    },\n    // public\n    build: function(data)\n    {\n        this._open(data);\n    },\n    close: function()\n    {\n        this._close();\n    },\n    onstop: function() {\n        this.$body.find('#redactor-modal-' + this.uuid).remove();\n        this.$body.find('#redactor-overlay-' + this.uuid).remove();\n    },\n    stop: function()\n    {\n        if (this.$box)\n        {\n            this.$box.remove();\n            this.$box = false;\n            this.$modal = false;\n        }\n\n        if (this.$overlay) {\n            this.$overlay.remove();\n        }\n\n        this.$doc.off('.redactor.modal');\n        this.$win.off('.redactor.modal');\n    },\n    resize: function()\n    {\n        this.$modal.setWidth(this.p.width);\n        this.$modal.updatePosition();\n    },\n\n    // private\n    _isOpened: function()\n    {\n        return (this.$modal && this.$modal.hasClass('open'));\n    },\n    _open: function(data)\n    {\n        this._buildDefaults(data);\n\n        if (this.p.url) this._openUrl();\n        else this._openTemplate();\n    },\n    _openUrl: function()\n    {\n        $R.ajax.post({\n            url: this.p.url,\n            success: this._doOpen.bind(this)\n        });\n    },\n    _openTemplate: function()\n    {\n        if (typeof $R.modals[this.p.name] !== 'undefined')\n        {\n            var template = this.lang.parse($R.modals[this.p.name]);\n            this._doOpen(template);\n        }\n    },\n    _doOpen: function(template)\n    {\n        this.stop();\n\n        if (this.selection.isCollapsed())\n        {\n            this.selection.save();\n            this.selectionMarkers = false;\n        }\n        else\n        {\n            this.selection.saveMarkers();\n            this.selectionMarkers = true;\n        }\n\n        if (!this.detector.isDesktop())\n        {\n            document.activeElement.blur();\n        }\n\n        this._createModal(template);\n\n        this._buildModalBox();\n        this._buildOverlay();\n        this._buildModal();\n        this._buildModalForm();\n        this._buildModalCommands();\n\n        this._broadcast('open');\n\n        this.$modal.updatePosition();\n        this._buildModalTabs();\n\n        this.animate.start(this.$box, 'fadeIn', this._opened.bind(this));\n        this.animate.start(this.$overlay, 'fadeIn');\n\n    },\n    _opened: function()\n    {\n        this.$modal.addClass('open');\n        this.$box.on('mousedown.redactor.modal', this._close.bind(this));\n        this.$doc.on('keyup.redactor.modal', this._handleEscape.bind(this));\n        this.$win.on('resize.redactor.modal', this.resize.bind(this));\n        this.$modal.getBody().find('input[type=text],input[type=url],input[type=email]').on('keydown.redactor.modal', this._handleEnter.bind(this));\n\n        // fix bootstrap modal focus\n        if (window.jQuery) jQuery(document).off('focusin.modal');\n\n        this._broadcast('opened');\n    },\n    _close: function(e)\n    {\n        if (!this.$box || !this._isOpened()) return;\n\n        if (e)\n        {\n            if (!this._needToClose(e.target))\n            {\n                return;\n            }\n\n            e.stopPropagation();\n            e.preventDefault();\n        }\n\n        if (this.selectionMarkers) this.selection.restoreMarkers();\n        else this.selection.restore();\n\n\n        this.selectionMarkers = false;\n\n        this._broadcast('close');\n\n        this.animate.start(this.$box, 'fadeOut', this._closed.bind(this));\n        this.animate.start(this.$overlay, 'fadeOut');\n    },\n    _closed: function()\n    {\n        this.$modal.removeClass('open');\n        this.$box.off('.redactor.modal');\n        this.$doc.off('.redactor.modal');\n        this.$win.off('.redactor.modal');\n\n        this._broadcast('closed');\n    },\n    _createModal: function(template)\n    {\n        this.$modal = $R.create('modal.element', this.app, template);\n    },\n    _broadcast: function(message)\n    {\n        this.app.broadcast('modal.' + message, this.$modal, this.$modalForm);\n        this.app.broadcast('modal.' + this.p.name + '.' + message, this.$modal, this.$modalForm);\n    },\n    _buildDefaults: function(data)\n    {\n         this.p = $R.extend({}, this.defaults, data);\n    },\n    _buildModalBox: function()\n    {\n        this.$box = $R.dom('<div>');\n        this.$box.attr('id', 'redactor-modal-' + this.uuid);\n        this.$box.addClass('redactor-modal-box redactor-animate-hide');\n        this.$box.html('');\n        this.$body.append(this.$box);\n    },\n    _buildOverlay: function()\n    {\n        this.$overlay = $R.dom('#redactor-overlay-' + this.uuid);\n        if (this.$overlay.length === 0)\n        {\n            this.$overlay = $R.dom('<div>');\n            this.$overlay.attr('id', 'redactor-overlay-' + this.uuid);\n            this.$overlay.addClass('redactor-overlay redactor-animate-hide');\n            this.$body.prepend(this.$overlay);\n        }\n    },\n    _buildModal: function()\n    {\n        this.$box.append(this.$modal);\n\n        this.$modal.setTitle(this.p.title);\n        this.$modal.setHeight(this.p.height);\n        this.$modal.setWidth(this.p.width);\n    },\n    _buildModalCommands: function()\n    {\n        if (this.p.commands)\n        {\n            var commands = this.p.commands;\n            var $footer = this.$modal.getFooter();\n            for (var key in commands)\n            {\n                var $btn = $R.dom('<button>');\n\n                $btn.html(commands[key].title);\n                $btn.attr('data-command', key);\n\n                // cancel\n                if (key === 'cancel')\n                {\n                    $btn.attr('data-action', 'close');\n                    $btn.addClass('redactor-button-unstyled');\n                }\n\n                // danger\n                if (typeof commands[key].type !== 'undefined' && commands[key].type === 'danger')\n                {\n                    $btn.addClass('redactor-button-danger');\n                }\n\n                $btn.on('click', this._handleCommand.bind(this));\n\n                $footer.append($btn);\n            }\n        }\n    },\n    _buildModalTabs: function()\n    {\n        var $body = this.$modal.getBody();\n        var $tabs = $body.find('.redactor-modal-tab');\n        var $box = $body.find('.redactor-modal-tabs');\n\n\n        if ($tabs.length > 1)\n        {\n            $box = ($box.length === 0) ? $R.dom('<div>') : $box.html('');\n            $box.addClass('redactor-modal-tabs');\n\n            $tabs.each(function(node, i)\n            {\n                var $node = $R.dom(node);\n                var $item = $R.dom('<a>');\n                $item.attr('href', '#');\n                $item.attr('rel', i);\n                $item.text($node.attr('data-title'));\n                $item.on('click', this._showTab.bind(this));\n\n                if (i === 0)\n                {\n                    $item.addClass('active');\n                }\n\n                $box.append($item);\n\n            }.bind(this));\n\n            $body.prepend($box);\n        }\n\n        if ($tabs.length === 1) {\n            $tabs.show();\n        }\n    },\n    _buildModalForm: function()\n    {\n        this.$modalForm = $R.create('modal.form', this.app, this.$modal.getForm());\n    },\n    _showTab: function(e)\n    {\n        e.preventDefault();\n\n        var $el = $R.dom(e.target);\n        var index = $el.attr('rel');\n        var $body = this.$modal.getBody();\n        var $tabs = $body.find('.redactor-modal-tab');\n\n        $tabs.hide();\n        $tabs.eq(index).show();\n\n        $body.find('.redactor-modal-tabs a').removeClass('active');\n        $el.addClass('active');\n\n    },\n    _needToClose: function(el)\n    {\n        var $target = $R.dom(el);\n        if ($target.attr('data-action') === 'close' || this.$modal.isCloseNode(el) || $target.closest('.redactor-modal').length === 0)\n        {\n            return true;\n        }\n\n        return false;\n    },\n    _handleCommand: function(e)\n    {\n        var $btn = $R.dom(e.target).closest('button');\n        var command = $btn.attr('data-command');\n\n        if (command !== 'cancel') e.preventDefault();\n\n        this._broadcast(command);\n    },\n    _handleEnter: function(e)\n    {\n        if (e.which === 13)\n        {\n            if (this.p.handle)\n            {\n                e.preventDefault();\n                this._broadcast(this.p.handle);\n            }\n        }\n    },\n    _handleEscape: function(e)\n    {\n        if (e.which === 27) this._close();\n    }\n});\n$R.add('class', 'modal.element', {\n    mixins: ['dom'],\n    init: function(app, template)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.$win = app.$win;\n\n        // init\n        this._init(template);\n    },\n\n    // get\n    getForm: function()\n    {\n        return this.find('form');\n    },\n    getHeader: function()\n    {\n        return this.$modalHeader;\n    },\n    getBody: function()\n    {\n        return this.$modalBody;\n    },\n    getFooter: function()\n    {\n        return this.$modalFooter;\n    },\n\n    // set\n    setTitle: function(title)\n    {\n        if (title) this.$modalHeader.html(title);\n    },\n    setWidth: function(width)\n    {\n        width = (parseInt(width) >= this.$win.width()) ? '96%' : width;\n\n        this.css('max-width', width);\n    },\n    setHeight: function(height)\n    {\n        if (height !== false) this.$modalBody.css('height', height);\n    },\n\n    // update\n    updatePosition: function()\n    {\n        var width = this.width();\n        this.css({ 'left': '50%', 'margin-left': '-' + (width/2) + 'px' });\n\n        var windowHeight = this.$win.height();\n        var height = this.height();\n        var marginTop = (windowHeight/2 - height/2);\n\n        if (height < windowHeight && marginTop !== 0)\n        {\n            this.css('margin-top', marginTop + 'px');\n        }\n    },\n\n    // is\n    isCloseNode: function(el)\n    {\n        return (el === this.$modalClose.get());\n    },\n\n    // private\n    _init: function(template)\n    {\n        this._build();\n        this._buildClose();\n        this._buildHeader();\n        this._buildBody();\n        this._buildFooter();\n        this._buildTemplate(template);\n    },\n    _build: function()\n    {\n        this.parse('<div>');\n        this.addClass('redactor-modal');\n        this.attr('dir', this.opts.direction);\n    },\n    _buildClose: function()\n    {\n        this.$modalClose = $R.dom('<span>');\n        this.$modalClose.addClass('redactor-close');\n\n        this.append(this.$modalClose);\n    },\n    _buildHeader: function()\n    {\n        this.$modalHeader = $R.dom('<div>');\n        this.$modalHeader.addClass('redactor-modal-header');\n\n        this.append(this.$modalHeader);\n    },\n    _buildBody: function()\n    {\n        this.$modalBody = $R.dom('<div>');\n        this.$modalBody.addClass('redactor-modal-body');\n\n        this.append(this.$modalBody);\n    },\n    _buildFooter: function()\n    {\n        this.$modalFooter = $R.dom('<div>');\n        this.$modalFooter.addClass('redactor-modal-footer');\n\n        this.append(this.$modalFooter);\n    },\n    _buildTemplate: function(template)\n    {\n        this.$modalBody.html(template);\n    }\n});\n$R.add('class', 'modal.form', {\n    mixins: ['dom'],\n    init: function(app, element)\n    {\n        this.app = app;\n\n        // build\n        this.build(element);\n    },\n\n    // public\n    build: function(element)\n    {\n        this.parse(element);\n    },\n    getData: function()\n    {\n        var data = {};\n        this.find('[name]').each(function(node)\n        {\n            var $node = $R.dom(node);\n            data[$node.attr('name')] = $node.val();\n        });\n\n        return data;\n    },\n    setData: function(data)\n    {\n        this.find('[name]').each(function(node)\n        {\n            var $node = $R.dom(node);\n            var name = $node.attr('name');\n            if (data.hasOwnProperty(name))\n            {\n                if (node.type && node.type === 'checkbox') node.checked = data[name];\n                else $node.val(data[name]);\n            }\n        });\n    },\n    getField: function(name)\n    {\n        return this.find('[name=' + name + ']');\n    },\n    setError: function(name)\n    {\n        var $el = this.getField(name);\n\n        $el.addClass('error');\n        $el.one(this._getFieldEventName($el.get()), this._clearError);\n\n        return false;\n    },\n\n    // private\n    _clearError: function()\n    {\n        return $R.dom(this).removeClass('error');\n    },\n    _getFieldEventName: function(el)\n    {\n        return (el.tagName === 'SELECT' || el.type === 'checkbox' || el.type === 'radio') ? 'change' : 'keyup';\n    }\n});\n$R.add('module', 'block', {\n    init: function(app)\n    {\n        this.app = app;\n        this.block = app.block;\n    },\n    // public\n    format: function(args)\n    {\n        var nodes = this.block.format(args);\n\n        // callback\n        this.app.broadcast('format', 'block', nodes);\n    },\n    clearformat: function()\n    {\n        this.block.clearFormat();\n    },\n    clearstyle: function()\n    {\n        this.block.clearStyle();\n    },\n    clearclass: function()\n    {\n        this.block.clearClass();\n    },\n    clearattr: function()\n    {\n        this.block.clearAttr();\n    },\n    add: function(args, tags)\n    {\n        this.block.add(args, tags);\n    },\n    toggle: function(args, tags)\n    {\n        this.block.toggle(args, tags);\n    },\n    set: function(args, tags)\n    {\n        this.block.set(args, tags);\n    },\n    remove: function(args, tags)\n    {\n        this.block.remove(args, tags);\n    }\n});\n$R.add('module', 'inline', {\n    init: function(app)\n    {\n        this.app = app;\n        this.inline = app.inline;\n    },\n    format: function(args)\n    {\n        var nodes = this.inline.format(args);\n\n        // callback\n        this.app.broadcast('format', 'inline', nodes);\n    },\n    clearformat: function()\n    {\n        this.inline.clearFormat();\n    },\n    clearstyle: function()\n    {\n        this.inline.clearStyle();\n    },\n    clearclass: function()\n    {\n        this.inline.clearClass();\n    },\n    clearattr: function()\n    {\n        this.inline.clearAttr();\n    },\n    add: function(args, tags)\n    {\n        this.inline.add(args, tags);\n    },\n    toggle: function(args, tags)\n    {\n        this.inline.toggle(args, tags);\n    },\n    set: function(args, tags)\n    {\n        this.inline.set(args, tags);\n    },\n    remove: function(args, tags)\n    {\n        this.inline.remove(args, tags);\n    }\n});\n$R.add('module', 'autosave', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.source = app.source;\n    },\n    // messages\n    onsynced: function()\n    {\n        if (this.opts.autosave)\n        {\n            this._send();\n        }\n    },\n\n    // private\n    _send: function()\n    {\n        var name = (this.opts.autosaveName) ? this.opts.autosaveName : this.source.getName();\n\n        var data = {};\n        data[name] = this.source.getCode();\n        data = this.utils.extendData(data, this.opts.autosaveData);\n\n        $R.ajax.post({\n            url: this.opts.autosave,\n            data: data,\n            success: function(response)\n            {\n                this._complete(response, name, data);\n            }.bind(this)\n        });\n    },\n    _complete: function(response, name, data)\n    {\n        var callback = (response && response.error) ? 'autosaveError' : 'autosave';\n        this.app.broadcast(callback, name, data, response);\n    }\n});\n$R.add('module', 'input', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.editor = app.editor;\n        this.keycodes = app.keycodes;\n        this.element = app.element;\n        this.selection = app.selection;\n        this.insertion = app.insertion;\n        this.inspector = app.inspector;\n        this.autoparser = app.autoparser;\n\n        // local\n        this.lastShiftKey = false;\n    },\n    // messages\n    onpaste: function(e, dataTransfer)\n    {\n        if (!this.opts.input) return;\n\n        return $R.create('input.paste', this.app, e, dataTransfer);\n    },\n    onkeydown: function(e)\n    {\n        if (!this.opts.input) return;\n\n        // key\n        var key = e.which;\n\n        // shortcuts\n        var shortcut = $R.create('input.shortcut', this.app, e);\n        if (shortcut.is()) return;\n\n        // select all\n        if ((e.ctrlKey || e.metaKey) && !e.altKey && key === 65)\n        {\n            e.preventDefault();\n            return this._selectAll();\n        }\n\n        // set empty if all selected\n        var keys = [this.keycodes.ENTER, this.keycodes.SPACE, this.keycodes.BACKSPACE, this.keycodes.DELETE];\n        var arrowKeys = [this.keycodes.UP, this.keycodes.DOWN, this.keycodes.LEFT, this.keycodes.RIGHT];\n        var isKeys = (keys.indexOf(key) !== -1);\n        var isArrowKeys = (arrowKeys.indexOf(key) !== -1);\n        var isXKey = ((e.ctrlKey || e.metaKey) && key === 88); // x\n        var isAlphaKeys = ((!e.ctrlKey && !e.metaKey) && ((key >= 48 && key <= 57) || (key >= 65 && key <= 90)));\n\n        if (this.selection.isAll() && isArrowKeys && (isXKey || (!e.ctrlKey && !e.metaKey && !e.altKey && !e.shiftKey)))\n        {\n            if (isXKey)\n            {\n                this.editor.disableNonEditables();\n                this.app.broadcast('empty');\n                return;\n            }\n\n            if (this._isArrowKey(key)) return true;\n            if (isKeys) e.preventDefault();\n\n            if (this.element.isType('inline'))\n            {\n                var $editor = this.editor.getElement();\n                $editor.html('');\n\n                this.editor.startFocus();\n            }\n            else\n            {\n                this.insertion.set(this.opts.emptyHtml);\n            }\n\n            if (isKeys) return;\n            else this.app.broadcast('empty');\n        }\n\n        // autoparse\n        if (this.opts.autoparse)\n        {\n            this.autoparser.format(e, key);\n        }\n\n        // a-z, 0-9 - non editable\n        if (isAlphaKeys)\n        {\n            // has non-editable\n            if (this.selection.hasNonEditable())\n            {\n                e.preventDefault();\n                return;\n            }\n        }\n\n        // enter, shift/ctrl + enter\n        if (key === this.keycodes.ENTER)\n        {\n            return $R.create('input.enter', this.app, e, key);\n        }\n        // cmd + [\n        else if (e.metaKey && key === 219)\n        {\n            e.preventDefault();\n            this.app.api('module.list.outdent');\n            return;\n        }\n        // tab or cmd + ]\n        else if (key === this.keycodes.TAB || e.metaKey && key === 221)\n        {\n            return $R.create('input.tab', this.app, e, key);\n        }\n        // space\n        else if (key === this.keycodes.SPACE)\n        {\n            return $R.create('input.space', this.app, e, key, this.lastShiftKey);\n        }\n        // backspace or delete\n        else if (this._isDeleteKey(key))\n        {\n            return $R.create('input.delete', this.app, e, key);\n        }\n        else if (this._isArrowKey(key))\n        {\n            return $R.create('input.arrow', this.app, e, key);\n        }\n    },\n    onkeyup: function(e)\n    {\n        if (!this.opts.input) return;\n\n        // key\n        var key = e.which;\n\n        // shift key\n        this.lastShiftKey = e.shiftKey;\n\n        // hide context toolbar\n        this.app.broadcast('contextbar.close');\n\n        // shortcode\n        var shortcode = $R.create('input.shortcode', this.app, e, key);\n        if (shortcode.is()) return;\n\n        // is empty\n        if (key === this.keycodes.BACKSPACE)\n        {\n            var $editor = this.editor.getElement();\n            var html = this.utils.trimSpaces($editor.html());\n            html = html.replace(/<br\\s?\\/?>/g, '');\n            html = html.replace(/<div><\\/div>/, '');\n\n            if (html === '')\n            {\n                e.preventDefault();\n                this.editor.setEmpty();\n                this.editor.startFocus();\n                return;\n            }\n        }\n\n        if (this.editor.isEmpty())\n        {\n            this.app.broadcast('empty');\n        }\n    },\n\n    // public\n    start: function()\n    {\n        // extend shortcuts\n        if (this.opts.shortcutsAdd)\n        {\n            this.opts.shortcuts = $R.extend({}, true, this.opts.shortcuts, this.opts.shortcutsAdd);\n        }\n    },\n\n    // private\n    _selectAll: function()\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var el;\n\n        if (data.isComponentType('table'))\n        {\n            el = data.getTable();\n            this.selection.setAll(el);\n            return;\n        }\n        else if (data.isComponentType('code'))\n        {\n            el = data.getComponentCodeElement();\n            this.selection.setAll(el);\n            return;\n        }\n\n        this.selection.setAll();\n    },\n    _isArrowKey: function(key)\n    {\n        return ([this.keycodes.UP, this.keycodes.DOWN, this.keycodes.RIGHT, this.keycodes.LEFT].indexOf(key) !== -1);\n    },\n    _isDeleteKey: function(key)\n    {\n        return (key === this.keycodes.BACKSPACE || key === this.keycodes.DELETE);\n    }\n});\n$R.add('class', 'input.arrow', {\n    init: function(app, e, key)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.caret = app.caret;\n        this.offset = app.offset;\n        this.marker = app.marker;\n        this.editor = app.editor;\n        this.keycodes = app.keycodes;\n        this.component = app.component;\n        this.inspector = app.inspector;\n        this.selection = app.selection;\n\n        // local\n        this.key = key;\n\n        // init\n        this._init(e);\n    },\n    // private\n    _init: function(e)\n    {\n        if (this._isRightLeftKey() && this._isExitVariable(e)) return;\n\n        if (this._isRightDownKey())\n        {\n            if (this._isExitOnDownRight(e)) return;\n            if (this._selectComponent(e, 'End', 'next')) return;\n        }\n\n        if (this._isLeftUpKey())\n        {\n            if (this._isExitOnUpLeft(e)) return;\n            if (this._selectComponent(e, 'Start', 'prev')) return;\n        }\n\n        if (this.key === this.keycodes.LEFT) this.utils.trimInvisibleChars('left');\n        else if (this.key === this.keycodes.RIGHT) this.utils.trimInvisibleChars('right');\n\n    },\n    _isRightDownKey: function()\n    {\n        return ([this.keycodes.DOWN, this.keycodes.RIGHT].indexOf(this.key) !== -1);\n    },\n    _isLeftUpKey: function()\n    {\n        return ([this.keycodes.UP, this.keycodes.LEFT].indexOf(this.key) !== -1);\n    },\n    _isRightLeftKey: function()\n    {\n        return ([this.keycodes.RIGHT, this.keycodes.LEFT].indexOf(this.key) !== -1);\n    },\n    _isExitVariable: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var component = data.getComponent();\n        if (data.isComponentType('variable') && data.isComponentActive())\n        {\n            e.preventDefault();\n            var func = (this.key === this.keycodes.LEFT) ? 'setBefore' : 'setAfter';\n            this.caret[func](component);\n            return;\n        }\n    },\n    _isExitOnUpLeft: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var block = this.selection.getBlock(current);\n        var data = this.inspector.parse(current);\n        var prev = block.previousElementSibling;\n        var isStart = this.caret.isStart(block);\n\n        // prev table\n        if (isStart && prev && prev.tagName === 'TABLE')\n        {\n            e.preventDefault();\n            this.caret.setEnd(prev);\n            return true;\n        }\n        // figcaption\n        else if (data.isFigcaption())\n        {\n            block = data.getFigcaption();\n            isStart = this.caret.isStart(block);\n\n            var $component = $R.dom(block).closest('.redactor-component');\n            if (isStart && $component.length !== 0)\n            {\n                e.preventDefault();\n                this.caret.setEnd($component);\n                return true;\n            }\n        }\n        // exit table\n        else if (data.isTable() && isStart)\n        {\n            e.preventDefault();\n            this.caret.setEnd(block.previousElementSibling);\n            return true;\n        }\n        // component\n        else if (!data.isComponentEditable() && data.isComponent() && !data.isComponentType('variable'))\n        {\n            var component = data.getComponent();\n            if (!component.previousElementSibling)\n            {\n                e.preventDefault();\n                this.component.clearActive();\n\n                return this._exitPrevElement(e, data.getComponent());\n            }\n            else if (component.previousElementSibling)\n            {\n                e.preventDefault();\n                this.component.clearActive();\n                this.caret.setEnd(component.previousElementSibling);\n                return true;\n            }\n        }\n    },\n    _isExitOnDownRight: function(e)\n    {\n        var $editor = this.editor.getElement();\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var isEndEditor = this.caret.isEnd();\n        var block, isEnd;\n\n        // table\n        if (data.isTable())\n        {\n            block = data.getTable();\n            isEnd = this.caret.isEnd(block);\n\n            if (isEnd || isEndEditor)\n            {\n                return this._exitNextElement(e, data.getComponent());\n            }\n        }\n        // figcaption\n        else if (data.isFigcaption())\n        {\n            block = data.getFigcaption();\n            isEnd = this.caret.isEnd(block);\n\n            if (isEnd || isEndEditor)\n            {\n                return this._exitNextElement(e, data.getComponent());\n            }\n        }\n        // figure/code\n        else if (data.isComponentType('code'))\n        {\n            var component = data.getComponent();\n            var pre = $R.dom(data.getComponentCodeElement()).closest('pre');\n\n            isEnd = this.caret.isEnd(block);\n\n            var isNext = (pre && pre.get().nextElementSibling);\n            if (isEnd && !isNext)\n            {\n                return this._exitNextElement(e, component);\n            }\n        }\n        // pre & blockquote & dl\n        else if (data.isPre() || data.isBlockquote() || data.isDl())\n        {\n            if (isEndEditor)\n            {\n                if (data.isPre()) return this._exitNextElement(e, data.getPre());\n                else if (data.isBlockquote()) return this._exitNextElement(e, data.getBlockquote());\n                else if (data.isDl()) return this._exitNextElement(e, data.getDl());\n            }\n        }\n        // li\n        else if (data.isList())\n        {\n            var $list = $R.dom(current).parents('ul, ol', $editor).last();\n            isEnd = this.caret.isEnd($list);\n\n            if (isEnd || isEndEditor)\n            {\n                return this._exitNextElement(e, $list.get());\n            }\n        }\n        // component\n        else if (data.isComponent() && !data.isComponentType('variable') && data.getTag() !== 'span')\n        {\n            this.component.clearActive();\n            return this._exitNextElement(e, data.getComponent());\n        }\n    },\n    _exitPrevElement: function(e, node)\n    {\n        e.preventDefault();\n\n        if (node.previousElementSibling) this.caret.setEnd(node.previousElementSibling);\n        else this.utils.createMarkupBefore(node);\n\n        return true;\n    },\n    _exitNextElement: function(e, node)\n    {\n        e.preventDefault();\n\n        if (node.nextElementSibling) this.caret.setStart(node.nextElementSibling);\n        else this.utils.createMarkup(node);\n\n        return true;\n    },\n    _selectComponent: function(e, caret, type)\n    {\n        var current = this.selection.getCurrent();\n        var block = this.selection.getBlock(current);\n        var sibling = this.utils.findSiblings(current, type);\n        var siblingBlock = this.utils.findSiblings(block, type);\n\n        if (sibling && this.caret['is' + caret](current))\n        {\n            this._selectComponentItem(e, sibling, caret);\n        }\n        else if (siblingBlock && this.caret['is' + caret](block))\n        {\n            this._selectComponentItem(e, siblingBlock, caret);\n        }\n    },\n    _selectComponentItem: function(e, item, caret)\n    {\n        if (this.component.isNonEditable(item))\n        {\n            e.preventDefault();\n            this.caret['set' + caret](item);\n            return true;\n        }\n    }\n});\n$R.add('class', 'input.delete', {\n    init: function(app, e, key)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.caret = app.caret;\n        this.utils = app.utils;\n        this.editor = app.editor;\n        this.marker = app.marker;\n        this.keycodes = app.keycodes;\n        this.component = app.component;\n        this.inspector = app.inspector;\n        this.selection = app.selection;\n        this.insertion = app.insertion;\n\n        // local\n        this.key = key;\n\n        // init\n        this._init(e);\n    },\n    // private\n    _init: function(e)\n    {\n        if (this._removeActiveComponent(e)) return;\n        if (this._removeAllSelectedTable(e)) return;\n\n        // is empty\n        if (this.key === this.keycodes.BACKSPACE)\n        {\n            var $editor = this.editor.getElement();\n            var html = this.utils.trimSpaces($editor.html());\n\n            if (html === this.opts.emptyHtml)\n            {\n                e.preventDefault();\n                return;\n            }\n        }\n\n        // variable or non editable prev/next or selection\n        if (this._detectVariableOrNonEditable() || this.selection.hasNonEditable())\n        {\n            e.preventDefault();\n            return;\n        }\n\n        // all selected\n        if (this.selection.isAll())\n        {\n            e.preventDefault();\n            this.insertion.set(this.opts.emptyHtml);\n            return;\n        }\n\n        // collapsed\n        if (this.selection.isCollapsed())\n        {\n            // next / prev\n            if (this.key === this.keycodes.BACKSPACE) this._traverseBackspace(e);\n            else if (this.key === this.keycodes.DELETE) this._traverseDelete(e);\n        }\n\n        if (this.key === this.keycodes.BACKSPACE) this.utils.trimInvisibleChars('left');\n\n        this._removeUnwantedStyles();\n        this._removeEmptySpans();\n        this._removeSpanTagsInHeadings();\n        this._removeInlineTagsInPre();\n    },\n    _detectVariableOrNonEditable: function()\n    {\n        var block = this.selection.getBlock();\n        var isBlockStart = this.caret.isStart(block);\n        var isBlockEnd = this.caret.isEnd(block);\n        var el;\n\n        // backspace\n        if (this.key === this.keycodes.BACKSPACE && isBlockStart)\n        {\n            el = block.previousSibling;\n            if (this._isNonEditable(el)) return true;\n        }\n        // delete\n        else if (this.key === this.keycodes.DELETE && isBlockEnd)\n        {\n            el = block.nextSibling;\n            if (this._isNonEditable(el)) return true;\n        }\n\n        var current = this.selection.getCurrent();\n        var isCurrentStart = this.caret.isStart(current);\n        var isCurrentEnd = this.caret.isEnd(current);\n        var isCurrentStartSpace = (this.selection.getTextBeforeCaret().trim() === '');\n        var isCurrentEndSpace = (this.selection.getTextAfterCaret().trim() === '');\n\n        // backspace\n        if (this.key === this.keycodes.BACKSPACE && isCurrentStart && !isCurrentStartSpace)\n        {\n            el = current.previousSibling;\n            if (this._isVariable(el))\n            {\n                this.caret.setEnd(el);\n                return true;\n            }\n            else if (this._isNonEditable(el)) return true;\n        }\n        // delete\n        else if (this.key === this.keycodes.DELETE && isCurrentEnd && !isCurrentEndSpace)\n        {\n            el = current.nextSibling;\n            if (this._isVariable(el))\n            {\n                this.caret.setStart(el);\n                return true;\n            }\n            else if (this._isNonEditable(el)) return true;\n        }\n    },\n    _isVariable: function(node)\n    {\n        return ($R.dom(node).closest('[data-redactor-type=\"variable\"]').length !== 0);\n    },\n    _isNonEditable: function(node)\n    {\n        return ($R.dom(node).closest('.non-editable').length !== 0);\n    },\n    _getBlock: function()\n    {\n        var $editor = this.editor.getElement();\n        var block = this.selection.getBlock();\n        var data = this.inspector.parse(block);\n\n        block = (data.isList()) ? $R.dom(block).parents('ul, ol', $editor).last().get() : block;\n        block = (data.isDl()) ? data.getDl() : block;\n        block = (data.isTable()) ? data.getTable() : block;\n\n        return block;\n    },\n    _traverseDelete: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var block, isEnd, $next;\n\n        // figcaption\n        if (data.isFigcaption())\n        {\n            block = data.getFigcaption();\n            isEnd = this.caret.isEnd(block);\n\n            if (isEnd)\n            {\n                e.preventDefault();\n                return;\n            }\n        }\n        // figure/code\n        else if (data.isComponentType('code'))\n        {\n            block = data.getComponent();\n            isEnd = this.caret.isEnd(block);\n\n            if (isEnd)\n            {\n                e.preventDefault();\n                return;\n            }\n        }\n\n        // next\n        block = this._getBlock();\n        var next = this.utils.findSiblings(block, 'next');\n        if (!next) return;\n\n        isEnd = this.caret.isEnd(block);\n        var dataNext = this.inspector.parse(next);\n        var isNextBlock = (next.tagName === 'P' || next.tagName === 'DIV');\n\n        // figure/code or table\n        if (isEnd && dataNext.isComponentEditable())\n        {\n            e.preventDefault();\n            this.component.remove(next, false);\n            return;\n        }\n        // component\n        else if (isEnd && dataNext.isComponent())\n        {\n            e.preventDefault();\n\n            // select component\n            this.caret.setStart(next);\n\n            // remove current if empty\n            if (this.utils.isEmptyHtml(block.innerHTML))\n            {\n                $R.dom(block).remove();\n            }\n\n            return;\n        }\n        // combine list\n        else if (isEnd && dataNext.isList())\n        {\n            var $currentList = $R.dom(block);\n            $next = $R.dom(next);\n\n            // current list\n            if (data.isList())\n            {\n                e.preventDefault();\n\n                $currentList.append($next);\n                $next.unwrap();\n\n                return;\n            }\n            else\n            {\n                var $first = $next.children('li').first();\n                var $lists = $first.find('ul, ol');\n\n                if ($lists.length !== 0)\n                {\n                    e.preventDefault();\n\n                    $next.prepend($lists);\n                    $lists.unwrap();\n\n                    $currentList.append($first);\n                    $first.unwrap();\n\n                    return;\n                }\n            }\n        }\n        // block\n        else if (isEnd && !data.isList() && !data.isTable() && isNextBlock && !this.utils.isEmptyHtml(block.innerHTML))\n        {\n            e.preventDefault();\n\n            var $current = $R.dom(block);\n            $next = $R.dom(next);\n\n            $current.append($next);\n            $next.unwrap();\n\n            return;\n        }\n    },\n    _traverseBackspace: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var block, isStart, $prev, $currentList;\n\n        // figcaption\n        if (data.isFigcaption())\n        {\n            block = data.getFigcaption();\n            isStart = this.caret.isStart(block);\n\n            if (isStart)\n            {\n                e.preventDefault();\n                return;\n            }\n        }\n        // figure/code\n        else if (data.isComponentType('code'))\n        {\n            block = data.getComponent();\n            isStart = this.caret.isStart(block);\n\n            if (isStart && block.previousElementSibling)\n            {\n                e.preventDefault();\n                this.caret.setEnd(block.previousElementSibling);\n                return true;\n            }\n        }\n\n        // prev\n        block = this._getBlock();\n        var prev = this.utils.findSiblings(block, 'prev');\n\n        if (!prev)\n        {\n            setTimeout(this._replaceBlock.bind(this), 1);\n            return;\n        }\n\n        isStart = this.caret.isStart(block);\n        var dataPrev = this.inspector.parse(prev);\n        var isPrevBlock = (prev.tagName === 'P' || prev.tagName === 'DIV');\n\n        // figure/code or table\n        if (isStart && dataPrev.isComponentEditable())\n        {\n            e.preventDefault();\n            this.component.remove(prev, false);\n            return;\n        }\n        // component\n        else if (isStart && dataPrev.isComponent())\n        {\n            e.preventDefault();\n\n            // select component\n            this.caret.setStart(prev);\n\n            // remove current if empty\n            if (this.utils.isEmptyHtml(block.innerHTML))\n            {\n                $R.dom(block).remove();\n            }\n\n            return;\n        }\n        // lists\n        else if (isStart && data.isList())\n        {\n            e.preventDefault();\n\n            $currentList = $R.dom(block);\n            $prev = $R.dom(prev);\n\n            if (dataPrev.isList())\n            {\n                $currentList.children('li').first().prepend(this.marker.build('start'));\n                $prev.append($currentList);\n                $currentList.unwrap();\n\n                this.selection.restoreMarkers();\n            }\n            else\n            {\n                var $first = $currentList.children('li').first();\n                var first = $first.get();\n                var $lists = $first.find('ul, ol');\n\n                var $newnode = this.utils.replaceToTag(first, this.opts.markup);\n                if (this.opts.breakline) $newnode.attr('data-redactor-tag', 'br');\n                $currentList.before($newnode);\n                this.caret.setStart($newnode);\n\n                if ($lists.length !== 0)\n                {\n                    $currentList.prepend($lists);\n                    $lists.unwrap();\n                }\n            }\n\n            return;\n        }\n        // block\n        else if (isStart && isPrevBlock)\n        {\n            e.preventDefault();\n\n            if (this.utils.isEmpty(prev)) {\n                $prev = $R.dom(prev);\n                $prev.remove();\n                return;\n            }\n\n            var textNode = this.utils.createInvisibleChar();\n            var $current = $R.dom(block);\n            $prev = $R.dom(prev);\n\n            this.caret.setEnd($prev);\n\n            $current.prepend(textNode);\n            $prev.append($current.contents());\n            $current.remove();\n\n            return;\n        }\n    },\n    _replaceBlock: function()\n    {\n        var block = this.selection.getBlock();\n        var $block = $R.dom(block);\n\n        if (this.opts.markup === 'p' && block && this._isNeedToReplaceBlock(block))\n        {\n            var markup = document.createElement(this.opts.markup);\n\n            $block.replaceWith(markup);\n            this.caret.setStart(markup);\n        }\n\n        if (this.opts.breakline && block && block.tagName === 'DIV')\n        {\n            $block.attr('data-redactor-tag', 'br');\n        }\n    },\n    _isNeedToReplaceBlock: function(block)\n    {\n        return (block.tagName === 'DIV' && this.utils.isEmptyHtml(block.innerHTML));\n    },\n    _removeActiveComponent: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var component = data.getComponent();\n        if (data.isComponent() && this.component.isActive(component))\n        {\n            e.preventDefault();\n            this.component.remove(component);\n            return true;\n        }\n    },\n    _removeAllSelectedTable: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var table = data.getTable();\n        if (table && this.selection.isAll(table))\n        {\n            e.preventDefault();\n            this.component.remove(table);\n            return true;\n        }\n    },\n    _removeUnwantedStyles: function()\n    {\n        var $editor = this.editor.getElement();\n\n        setTimeout(function()\n        {\n            var $tags = $editor.find('*[style]');\n            $tags.not('img, figure, iframe, [data-redactor-style-cache], [data-redactor-span]').removeAttr('style');\n\n        }, 0);\n    },\n    _removeEmptySpans: function()\n    {\n        var $editor = this.editor.getElement();\n\n        setTimeout(function()\n        {\n            $editor.find('span').each(function(node)\n            {\n                if (node.attributes.length === 0)\n                {\n                    $R.dom(node).replaceWith(node.childNodes);\n                }\n            });\n\n        }, 0);\n    },\n    _removeSpanTagsInHeadings: function()\n    {\n        var $editor = this.editor.getElement();\n\n        setTimeout(function()\n        {\n            $editor.find('h1, h2, h3, h4, h5, h6').each(function(node)\n            {\n                var $node = $R.dom(node);\n                if ($node.closest('figure').length === 0)\n                {\n                    $node.find('span').not('.redactor-component, .non-editable, .redactor-selection-marker, [data-redactor-style-cache], [data-redactor-span]').unwrap();\n                }\n            });\n\n        }, 1);\n    },\n    _removeInlineTagsInPre: function()\n    {\n        var $editor = this.editor.getElement();\n        var tags = this.opts.inlineTags;\n\n        setTimeout(function()\n        {\n            $editor.find('pre').each(function(node)\n            {\n                var $node = $R.dom(node);\n                if ($node.closest('figure').length === 0)\n                {\n                    $node.find(tags.join(',')).not('code, .redactor-selection-marker').unwrap();\n                }\n            });\n\n        }, 1);\n    }\n});\n$R.add('class', 'input.enter', {\n    init: function(app, e)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.caret = app.caret;\n        this.editor = app.editor;\n        this.insertion = app.insertion;\n        this.selection = app.selection;\n        this.inspector = app.inspector;\n\n        // init\n        this._init(e);\n    },\n    // private\n    _init: function(e)\n    {\n        // turn off\n        if (!this.opts.enterKey) return this._disable(e);\n\n        // callback\n        var stop = this.app.broadcast('enter', e);\n        if (stop === false) return e.preventDefault();\n\n        // has non-editable\n        if (this.selection.hasNonEditable())\n        {\n            e.preventDefault();\n            return;\n        }\n\n        // shift enter\n        if (e.ctrlKey || e.shiftKey) return this._insertBreak(e);\n\n        // enter & exit\n        if (this._isExit(e)) return;\n\n        // traverse\n        this._traverse(e);\n    },\n    _disable: function(e)\n    {\n        e.preventDefault();\n        var range = this.selection.getRange();\n        if (range && !range.collapsed) range.deleteContents();\n    },\n    _insertBreak: function(e)\n    {\n        e.preventDefault();\n\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n\n        if ((data.isComponent() && !data.isComponentEditable()) || data.isCode()) return;\n        else if (data.isPre()) this.insertion.insertNewline();\n        else this.insertion.insertBreakLine();\n    },\n    _isExit: function(e)\n    {\n        var $editor = this.editor.getElement();\n        var block = this.selection.getBlock();\n        var data = this.inspector.parse(block);\n        var isEnd = this.caret.isEnd(block);\n        var current = this.selection.getCurrent();\n        var prev = current.previousSibling;\n\n        // blockquote\n        if (data.isBlockquote())\n        {\n            var isParagraphExit = (isEnd && this._isExitableBlock(block, 'P'));\n            var isBreaklineExit = (isEnd && this._isExitableDblBreak(prev));\n\n            if (isParagraphExit || isBreaklineExit)\n            {\n                return this._exitFromElement(e, ((isBreaklineExit) ? prev : block), data.getBlockquote());\n            }\n        }\n        // pre\n        else if (!data.isComponentType('code') && data.isPre())\n        {\n            if (isEnd)\n            {\n                var html = block.innerHTML;\n                html = this.utils.removeInvisibleChars(html);\n                if (html.match(/(\\n\\n\\n)$/) !== null)\n                {\n                    $R.dom(prev.previousSibling.previousSibling).remove();\n                    return this._exitFromElement(e, prev, block);\n                }\n            }\n        }\n        // dl\n        else if (data.isDl())\n        {\n            if (isEnd && this._isExitableBlock(block, 'DT'))\n            {\n                return this._exitFromElement(e, block, data.getDl());\n            }\n        }\n        // li\n        else if (data.isList())\n        {\n            var list = $R.dom(current).parents('ul, ol', $editor).last();\n\n            isEnd = this.caret.isEnd(list);\n            if (isEnd && this._isExitableBlock(block, 'LI'))\n            {\n                return this._exitFromElement(e, block, list);\n            }\n        }\n        else if (data.isComponent() && data.isComponentActive() && !data.isFigcaption() && !data.isComponentEditable())\n        {\n            return this._exitFromElement(e, false, data.getComponent());\n        }\n    },\n    _isExitableDblBreak: function(prev)\n    {\n        var next = (prev) ? prev.nextSibling : false;\n        if (next)\n        {\n            var text = this.utils.removeInvisibleChars(next.textContent);\n\n            return (next.nodeType === 3 && text.trim() === '');\n        }\n    },\n    _isExitableBlock: function(block, tag)\n    {\n        return (block && block.tagName === tag && this.utils.isEmptyHtml(block.innerHTML));\n    },\n    _exitFromElement: function(e, prev, el)\n    {\n        e.preventDefault();\n        if (prev) $R.dom(prev).remove();\n        this.utils.createMarkup(el);\n\n        return true;\n    },\n    _exitNextElement: function(e, node)\n    {\n        e.preventDefault();\n\n        if (node.nextSibling) this.caret.setStart(node.nextSibling);\n        else this.utils.createMarkup(node);\n\n        return true;\n    },\n    _traverse: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var isText = this.selection.isText();\n        var block = this.selection.getBlock();\n        var data = this.inspector.parse(current);\n        var blockTag = (block) ? block.tagName.toLowerCase() : false;\n        var $variable = $R.dom(current).closest('[data-redactor-type=variable]');\n        // variable parent\n        if ($variable.length !== 0) {\n            this.caret.setAfter($variable);\n        }\n\n        // pre\n        if (data.isPre())\n        {\n            e.preventDefault();\n            return this.insertion.insertNewline();\n        }\n        // blockquote\n        else if (data.isBlockquote())\n        {\n            block = this.selection.getBlock(current);\n            if (block && block.tagName === 'BLOCKQUOTE')\n            {\n                e.preventDefault();\n                return this.insertion.insertBreakLine();\n            }\n        }\n        // figcaption\n        else if (data.isFigcaption())\n        {\n            block = data.getFigcaption();\n            var isEnd = this.caret.isEnd(block);\n            var isEndEditor = this.caret.isEnd();\n            if (isEnd || isEndEditor)\n            {\n                return this._exitNextElement(e, data.getComponent());\n            }\n            else\n            {\n                e.preventDefault();\n                return;\n            }\n        }\n        // dl\n        else if (data.isDl())\n        {\n            e.preventDefault();\n            return this._traverseDl(current);\n        }\n        // breakline\n        else if (this.opts.breakline && blockTag === 'div') {\n            setTimeout(this._replaceBlock.bind(this), 1);\n            return;\n        }\n        // text\n        else if (isText)\n        {\n            e.preventDefault();\n            return this.insertion.insertBreakLine();\n        }\n        // list\n        else if (data.isList()) {\n            return;\n        }\n        // div / p\n        else\n        {\n            setTimeout(this._replaceBlock.bind(this), 1);\n            return;\n        }\n    },\n    _traverseDl: function(current)\n    {\n        var block = this.selection.getBlock(current);\n        var data = this.inspector.parse(block);\n        var tag = data.getTag();\n        var $el = $R.dom(block);\n        var next = $el.get().nextSibling || false;\n        var $next = $R.dom(next);\n        var nextDd = (next && $next.is('dd'));\n        var nextDt = (next && $next.is('dt'));\n        var isEnd = this.caret.isEnd(block);\n\n        if (tag === 'dt' && !nextDd && isEnd)\n        {\n            var dd = document.createElement('dd');\n            $el.after(dd);\n\n            this.caret.setStart(dd);\n            return;\n        }\n        else if (tag === 'dd' && !nextDt && isEnd)\n        {\n            var dt = document.createElement('dt');\n            $el.after(dt);\n\n            this.caret.setStart(dt);\n            return;\n        }\n\n        return this.insertion.insertBreakLine();\n    },\n    _replaceBlock: function()\n    {\n        var block = this.selection.getBlock();\n        var $block = $R.dom(block);\n\n        if (this.opts.markup === 'p' && block && this._isNeedToReplaceBlock(block))\n        {\n            var markup = document.createElement(this.opts.markup);\n\n            $block.replaceWith(markup);\n            this.caret.setStart(markup);\n        }\n        else\n        {\n            if (block)\n            {\n                if (this.utils.isEmptyHtml(block.innerHTML))\n                {\n                    this._clearBlock($block, block);\n                }\n                else\n                {\n                    var first = this.utils.getFirstNode(block);\n                    if (first && first.tagName === 'BR')\n                    {\n                        $R.dom(first).remove();\n                        this.caret.setStart(block);\n                    }\n                }\n            }\n        }\n\n        if (block && this._isNeedToCleanBlockStyle(block) && this.opts.cleanOnEnter)\n        {\n            $block.removeAttr('class style');\n        }\n\n        if (this.opts.breakline && block && block.tagName === 'DIV')\n        {\n            //$block.append(document.createElement('br'));\n            //$block.attr('data-redactor-tag', 'br');\n        }\n    },\n    _clearBlock: function($block, block)\n    {\n        if (block.tagName === 'DIV') {\n            $block.find('br').remove();\n        }\n\n        if (this.opts.cleanInlineOnEnter || block.innerHTML === '<br>')\n        {\n            $block.html('');\n        }\n\n        this.caret.setStart(block);\n    },\n    _isNeedToReplaceBlock: function(block)\n    {\n        return (block.tagName === 'DIV' && this.utils.isEmptyHtml(block.innerHTML));\n    },\n    _isNeedToCleanBlockStyle: function(block)\n    {\n        return (block.tagName === 'P' && this.utils.isEmptyHtml(block.innerHTML));\n    }\n});\n$R.add('class', 'input.paste', {\n    init: function(app, e, dataTransfer, html, point)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.editor = app.editor;\n        this.cleaner = app.cleaner;\n        this.container = app.container;\n        this.inspector = app.inspector;\n        this.insertion = app.insertion;\n        this.selection = app.selection;\n        this.autoparser = app.autoparser;\n\n        // local\n        this.pasteHtml = html;\n        this.pointInserted = point;\n        this.dataTransfer = dataTransfer;\n\n        // init\n        this._init(e);\n    },\n    // private\n    _init: function(e)\n    {\n        var clipboard = this.dataTransfer || e.clipboardData;\n        var current = this.selection.getCurrent();\n        var dataCurrent = this.inspector.parse(current);\n\n        this.dropPasted = this.dataTransfer;\n        //this.isRawCode = (this.dropPasted) ? (dataCurrent.isPre() || dataCurrent.isCode()) : this._isPlainText(clipboard);\n        this.isRawCode = (dataCurrent.isPre() || dataCurrent.isCode());\n\n        this.editor.enablePasting();\n        this.editor.saveScroll();\n\n        if (!this.dropPasted)\n        {\n            this.selection.saveMarkers();\n        }\n\n        if (this.isRawCode || !clipboard)\n        {\n\n            var text;\n            if (!this.isRawCode && !clipboard && window.clipboardData)\n            {\n                text = window.clipboardData.getData(\"text\");\n            }\n            else\n            {\n                text = clipboard.getData(\"text/plain\");\n            }\n\n            e.preventDefault();\n            this._insert(e, text);\n            return;\n        }\n        else if (this.pasteHtml)\n        {\n            e.preventDefault();\n            this._insert(e, this.pasteHtml);\n        }\n        else\n        {\n            // html / text\n            var url = clipboard.getData('URL');\n            var html = (this._isPlainText(clipboard)) ? this.cleaner.encodeEntities(clipboard.getData(\"text/plain\")) : clipboard.getData(\"text/html\");\n\n            // safari anchor links\n            html = (!url || url === '') ? html : url;\n\n            // file\n            if (clipboard.files !== null && clipboard.files.length > 0 && html === '')\n            {\n                var files = [];\n                for (var i = 0; i < clipboard.files.length; i++)\n                {\n                    var file = clipboard.files[i] || clipboard.items[i].getAsFile();\n                    if (file) files.push(file);\n                }\n\n                if (files.length > 0)\n                {\n                    e.preventDefault();\n                    this._insertFiles(e, files);\n                    return;\n                }\n            }\n\n\n            e.preventDefault();\n            this._insert(e, html);\n        }\n    },\n    _isPlainText: function(clipboard)\n    {\n        var text = clipboard.getData(\"text/plain\");\n        var html = clipboard.getData(\"text/html\");\n\n        if (text && html)\n        {\n            var element = document.createElement(\"div\");\n            element.innerHTML = html;\n\n            if (element.textContent === text)\n            {\n                return !element.querySelector(\":not(meta)\");\n            }\n        }\n        else\n        {\n            return (text !== null);\n        }\n    },\n    _restoreSelection: function()\n    {\n        this.editor.restoreScroll();\n        this.editor.disablePasting();\n        if (!this.dropPasted)\n        {\n            this.selection.restoreMarkers();\n        }\n    },\n    _insert: function(e, html)\n    {\n        // pasteBefore callback\n        var returned = this.app.broadcast('pasteBefore', html);\n        html = (returned === undefined) ? html : returned;\n\n        // clean\n        html = html.trim();\n        html = (this.isRawCode) ? html : this.cleaner.paste(html);\n        html = html.trim();\n        html = (this.isRawCode) ? this.cleaner.encodePhpCode(html) : html;\n\n        // paste callback\n        returned = this.app.broadcast('pasting', html);\n        html = (returned === undefined) ? html : returned;\n\n        this._restoreSelection();\n\n        // stop input\n        if (!this.opts.input) return;\n\n        this.app.broadcast('state', false);\n\n        // insert\n        var nodes = [];\n        if (this.isRawCode) {\n            html = html.replace('&lt;?php', '<?php');\n\n            var textNode = document.createTextNode(html);\n            nodes = this.insertion.insertNode(textNode, 'after');\n\n            this.app.broadcast('pasted', nodes);\n        }\n        else {\n\n            // autoparse\n            if (this.opts.autoparse && this.opts.autoparsePaste)\n            {\n                html = this.autoparser.parse(html);\n            }\n\n            nodes = (this.dropPasted) ? this.insertion.insertToPoint(e, html, this.pointInserted) : this.insertion.insertHtml(html);\n\n            // pasted callback\n            this.app.broadcast('pasted', nodes);\n            this.app.broadcast('autoparseobserve');\n        }\n\n    },\n    _insertFiles: function(e, files)\n    {\n        this._restoreSelection();\n\n        // drop or clipboard\n        var isImage = (this.opts.imageTypes.indexOf(files[0].type) !== -1);\n        var isClipboard = (typeof this.dropPasted === 'undefined');\n\n        if (isImage) this.app.broadcast('dropimage', e, files, isClipboard);\n        else this.app.broadcast('dropfile', e, files, isClipboard);\n    }\n});\n$R.add('class', 'input.shortcode', {\n    init: function(app, e, key)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.marker = app.marker;\n        this.keycodes = app.keycodes;\n        this.selection = app.selection;\n\n        // local\n        this.worked = false;\n\n        // init\n        if (key === this.keycodes.SPACE) this._init();\n    },\n    // public\n    is: function()\n    {\n        return this.worked;\n    },\n    // private\n    _init: function()\n    {\n        var current = this.selection.getCurrent();\n        if (current && current.nodeType === 3)\n        {\n            var text = this.utils.removeInvisibleChars(current.textContent);\n            var shortcodes = this.opts.shortcodes;\n            for (var name in shortcodes)\n            {\n                var re = new RegExp('^' + this.utils.escapeRegExp(name));\n                var match = text.match(re);\n                if (match !== null)\n                {\n                    if (typeof shortcodes[name].format !== 'undefined')\n                    {\n                        return this._format(shortcodes[name].format, current, re);\n                    }\n                }\n            }\n        }\n    },\n    _format: function(tag, current, re)\n    {\n        var marker = this.marker.insert('start');\n        current = marker.previousSibling;\n\n        var text = current.textContent;\n        text = this.utils.trimSpaces(text);\n        text = text.replace(re, '');\n        current.textContent = text;\n\n        var api = (tag === 'ul' || tag === 'ol') ? 'module.list.toggle' : 'module.block.format';\n\n        this.app.api(api, tag);\n        this.selection.restoreMarkers();\n\n        this.worked = true;\n    }\n});\n$R.add('class', 'input.shortcut', {\n    init: function(app, e)\n    {\n        this.app = app;\n        this.opts = app.opts;\n\n        // local\n        this.worked = false;\n\n        // based on https://github.com/jeresig/jquery.hotkeys\n        this.hotkeys = {\n            8: \"backspace\", 9: \"tab\", 10: \"return\", 13: \"return\", 16: \"shift\", 17: \"ctrl\", 18: \"alt\", 19: \"pause\",\n            20: \"capslock\", 27: \"esc\", 32: \"space\", 33: \"pageup\", 34: \"pagedown\", 35: \"end\", 36: \"home\",\n            37: \"left\", 38: \"up\", 39: \"right\", 40: \"down\", 45: \"insert\", 46: \"del\", 59: \";\", 61: \"=\",\n            96: \"0\", 97: \"1\", 98: \"2\", 99: \"3\", 100: \"4\", 101: \"5\", 102: \"6\", 103: \"7\",\n            104: \"8\", 105: \"9\", 106: \"*\", 107: \"+\", 109: \"-\", 110: \".\", 111 : \"/\",\n            112: \"f1\", 113: \"f2\", 114: \"f3\", 115: \"f4\", 116: \"f5\", 117: \"f6\", 118: \"f7\", 119: \"f8\",\n            120: \"f9\", 121: \"f10\", 122: \"f11\", 123: \"f12\", 144: \"numlock\", 145: \"scroll\", 173: \"-\", 186: \";\", 187: \"=\",\n            188: \",\", 189: \"-\", 190: \".\", 191: \"/\", 192: \"`\", 219: \"[\", 220: \"\\\\\", 221: \"]\", 222: \"'\"\n        };\n\n        this.hotkeysShiftNums = {\n            \"`\": \"~\", \"1\": \"!\", \"2\": \"@\", \"3\": \"#\", \"4\": \"$\", \"5\": \"%\", \"6\": \"^\", \"7\": \"&\",\n            \"8\": \"*\", \"9\": \"(\", \"0\": \")\", \"-\": \"_\", \"=\": \"+\", \";\": \": \", \"'\": \"\\\"\", \",\": \"<\",\n            \".\": \">\",  \"/\": \"?\",  \"\\\\\": \"|\"\n        };\n\n        // init\n        this._init(e);\n    },\n    // public\n    is: function()\n    {\n        return this.worked;\n    },\n    // private\n    _init: function(e)\n    {\n        // disable browser's hot keys for bold and italic if shortcuts off\n        if (this.opts.shortcuts === false)\n        {\n            if ((e.ctrlKey || e.metaKey) && (e.which === 66 || e.which === 73)) e.preventDefault();\n            return;\n        }\n\n        // build\n        for (var key in this.opts.shortcuts)\n        {\n            this._build(e, key, this.opts.shortcuts[key]);\n        }\n    },\n    _build: function(e, str, command)\n    {\n        var keys = str.split(',');\n        var len = keys.length;\n        for (var i = 0; i < len; i++)\n        {\n            if (typeof keys[i] === 'string')\n            {\n                this._handler(e, keys[i].trim(), command);\n            }\n        }\n    },\n    _handler: function(e, keys, command)\n    {\n        keys = keys.toLowerCase().split(\" \");\n\n        var special = this.hotkeys[e.keyCode];\n        var character = String.fromCharCode(e.which).toLowerCase();\n        var modif = \"\", possible = {};\n        var cmdKeys = [\"meta\", \"ctrl\", \"alt\", \"shift\"];\n\n        for (var i = 0; i < cmdKeys.length; i++)\n        {\n            var specialKey = cmdKeys[i];\n            if (e[specialKey + 'Key'] && special !== specialKey)\n            {\n                modif += specialKey + '+';\n            }\n        }\n\n        if (special) possible[modif + special] = true;\n        if (character)\n        {\n            possible[modif + character] = true;\n            possible[modif + this.hotkeysShiftNums[character]] = true;\n\n            // \"$\" can be triggered as \"Shift+4\" or \"Shift+$\" or just \"$\"\n            if (modif === \"shift+\")\n            {\n                possible[this.hotkeysShiftNums[character]] = true;\n            }\n        }\n\n        var len = keys.length;\n        for (var i = 0; i < len; i++)\n        {\n            if (possible[keys[i]])\n            {\n\n                e.preventDefault();\n                this.worked = true;\n\n                if (command.message)\n                {\n                    this.app.broadcast(command.message, command.args);\n                    this.app.broadcast('buffer.trigger');\n                }\n                else if (command.api)\n                {\n                    this.app.api(command.api, command.args);\n                    this.app.broadcast('buffer.trigger');\n                }\n\n                return;\n            }\n        }\n    }\n});\n$R.add('class', 'input.space', {\n    init: function(app, e, key, lastShiftKey)\n    {\n        this.app = app;\n        this.keycodes = app.keycodes;\n        this.insertion = app.insertion;\n        this.selection = app.selection;\n\n        // local\n        this.key = key;\n        this.lastShiftKey = lastShiftKey;\n\n        // init\n        this._init(e);\n    },\n    // private\n    _init: function(e)\n    {\n        // has non-editable\n        if (this.selection.hasNonEditable())\n        {\n            e.preventDefault();\n            return;\n        }\n\n        // shift/ctrl + space\n        if (!this.lastShiftKey && this.key === this.keycodes.SPACE && (e.ctrlKey || e.shiftKey) && !e.metaKey)\n        {\n            e.preventDefault();\n            this.insertion.insertChar('&nbsp;');\n            return;\n        }\n    }\n});\n$R.add('class', 'input.tab', {\n    init: function(app, e)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.inspector = app.inspector;\n        this.insertion = app.insertion;\n        this.selection = app.selection;\n\n        // init\n        this._init(e);\n    },\n    // private\n    _init: function(e)\n    {\n        // turn off tab\n        if (!this.opts.tabKey) return;\n\n        // callback\n        var stop = this.app.broadcast('tab', e);\n        if (stop === false) return e.preventDefault();\n\n        // traverse\n        this._traverse(e);\n    },\n    _traverse: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n\n        // hard tab\n        if (!data.isComponent() && e.shiftKey)\n        {\n            return this._insertHardTab(e, 4);\n        }\n\n        // list\n        if (data.isList())\n        {\n            e.preventDefault();\n            return this.app.api('module.list.indent');\n        }\n        // pre\n        if (data.isPre() || (data.isComponentType('code') && !data.isFigcaption()))\n        {\n            return this._tabCode(e);\n        }\n\n        // tab as spaces\n        if (this.opts.tabAsSpaces !== false)\n        {\n            return this._insertHardTab(e, this.opts.tabAsSpaces);\n        }\n    },\n    _insertHardTab: function(e, num)\n    {\n        e.preventDefault();\n        var node = document.createTextNode(Array(num + 1).join('\\u00a0'));\n        return this.insertion.insertNode(node, 'end');\n    },\n    _tabCode: function(e)\n    {\n        e.preventDefault();\n\n        var node = (this.opts.preSpaces) ? document.createTextNode(Array(this.opts.preSpaces + 1).join('\\u00a0')) : document.createTextNode('\\t');\n\n        return this.insertion.insertNode(node, 'end');\n    }\n});\n$R.add('module', 'upload', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.lang = app.lang;\n        this.utils = app.utils;\n        this.editor = app.editor;\n        this.progress = app.progress;\n\n        // local\n        this.defaults = {\n            event: false,\n            element: false,\n            name: false,\n            files: false,\n            url: false,\n            data: false,\n            paramName: false\n        };\n    },\n    // public\n    build: function(options)\n    {\n        this.p = $R.extend(this.defaults, options);\n        this.$el = $R.dom(this.p.element);\n\n        if (this.$el.get().tagName === 'INPUT') this._buildInput();\n        else                                    this._buildBox();\n    },\n    send: function(options)\n    {\n        this.p = $R.extend(this.defaults, options);\n        this.$uploadbox = this.editor.getElement();\n        this._send(this.p.event, this.p.files);\n    },\n    complete: function(response, e)\n    {\n        this._complete(response, e);\n    },\n\n    // private\n    _buildInput: function()\n    {\n        this.box = false;\n        this.prefix = '';\n\n        this.$uploadbox = $R.dom('<div class=\"upload-redactor-box\" />');\n\n        this.$el.hide();\n        this.$el.after(this.$uploadbox);\n\n        if (this.opts.multipleUpload) this.$el.attr('multiple', 'multiple');\n        else this.$el.removeAttr('multiple');\n\n        if (this.p.name !== 'file')\n        {\n            this.$el.attr('accept', 'image/*');\n        }\n\n        this._buildPlaceholder();\n        this._buildEvents();\n    },\n    _buildBox: function()\n    {\n        this.box = true;\n        this.prefix = 'box-';\n\n        this.$uploadbox = this.$el;\n        this.$uploadbox.attr('ondragstart', 'return false;');\n\n        // events\n        this.$uploadbox.on('drop.redactor.upload', this._onDropBox.bind(this));\n        this.$uploadbox.on('dragover.redactor.upload', this._onDragOver.bind(this));\n        this.$uploadbox.on('dragleave.redactor.upload', this._onDragLeave.bind(this));\n    },\n    _buildPlaceholder: function()\n    {\n        this.$placeholder = $R.dom('<div class=\"upload-redactor-placeholder\" />');\n        this.$placeholder.html(this.lang.get('upload-label'));\n        this.$uploadbox.append(this.$placeholder);\n    },\n    _buildEvents: function()\n    {\n        this.$el.on('change.redactor.upload', this._onChange.bind(this));\n        this.$uploadbox.on('click.redactor.upload', this._onClick.bind(this));\n        this.$uploadbox.on('drop.redactor.upload', this._onDrop.bind(this));\n        this.$uploadbox.on('dragover.redactor.upload', this._onDragOver.bind(this));\n        this.$uploadbox.on('dragleave.redactor.upload', this._onDragLeave.bind(this));\n    },\n    _onClick: function(e)\n    {\n        e.preventDefault();\n        this.$el.click();\n    },\n    _onChange: function(e)\n    {\n        this._send(e, this.$el.get().files);\n    },\n    _onDrop: function(e)\n    {\n        e.preventDefault();\n\n        this._clear();\n        this._setStatusDrop();\n        this._send(e);\n    },\n    _onDragOver: function(e)\n    {\n        e.preventDefault();\n        this._setStatusHover();\n\n        return false;\n    },\n    _onDragLeave: function(e)\n    {\n        e.preventDefault();\n        this._removeStatusHover();\n\n        return false;\n    },\n    _onDropBox: function(e)\n    {\n        e.preventDefault();\n\n        this._clear();\n        this._setStatusDrop();\n        this._send(e);\n    },\n    _removeStatusHover: function()\n    {\n        this.$uploadbox.removeClass('upload-redactor-' + this.prefix + 'hover');\n    },\n    _setStatusDrop: function()\n    {\n        this.$uploadbox.addClass('upload-redactor-' + this.prefix + 'drop');\n    },\n    _setStatusHover: function()\n    {\n        this.$uploadbox.addClass('upload-redactor-' + this.prefix + 'hover');\n    },\n    _setStatusError: function()\n    {\n        this.$uploadbox.addClass('upload-redactor-' + this.prefix + 'error');\n    },\n    _setStatusSuccess: function()\n    {\n        this.$uploadbox.addClass('upload-redactor-' + this.prefix + 'success');\n    },\n    _clear: function()\n    {\n        var classes = ['drop', 'hover', 'error', 'success'];\n        for (var i = 0; i < classes.length; i++)\n        {\n            this.$uploadbox.removeClass('upload-redactor-' + this.prefix + classes[i]);\n        }\n\n        this.$uploadbox.removeAttr('ondragstart');\n    },\n    _send: function(e, files)\n    {\n        e = e.originalEvent || e;\n\n        files = (files) ? files : e.dataTransfer.files;\n\n        var data = new FormData();\n        var name = this._getUploadParam();\n\n        data = this._buildData(name, files, data);\n        data = this.utils.extendData(data, this.p.data);\n\n        var stop = this.app.broadcast('upload.start', e, data, files);\n        if (stop !== false)\n        {\n            this._sendData(data, files, e);\n        }\n    },\n    _sendData: function(data, files, e)\n    {\n        this.progress.show();\n        if (typeof this.p.url === 'function')\n        {\n            var res = this.p.url(data, files, e, this);\n            if (!(res instanceof Promise))\n            {\n                this._complete(res, e);\n            }\n        }\n        else\n        {\n            $R.ajax.post({\n                url: this.p.url,\n                data: data,\n                before: function(xhr)\n                {\n                    return this.app.broadcast('upload.beforeSend', xhr);\n\n                }.bind(this),\n                success: function(response)\n                {\n                    this._complete(response, e);\n                }.bind(this)\n            });\n        }\n    },\n    _getUploadParam: function()\n    {\n        return (this.p.paramName) ? this.p.paramName : 'file';\n    },\n    _buildData: function(name, files, data)\n    {\n        if (files.length === 1)\n        {\n            data.append(name + '[]', files[0]);\n        }\n        else if (files.length > 1 && this.opts.multipleUpload !== false)\n        {\n            for (var i = 0; i < files.length; i++)\n            {\n                data.append(name + '[]', files[i]);\n            }\n        }\n\n        return data;\n    },\n    _complete: function(response, e)\n    {\n        this._clear();\n        this.progress.hide();\n\n        if (response && response.error)\n        {\n            this._setStatusError();\n\n            this.app.broadcast('upload.' + this.p.name + '.error', response, e);\n            this.app.broadcast('upload.error', response);\n        }\n        else\n        {\n            this._setStatusSuccess();\n\n            this.app.broadcast('upload.' + this.p.name + '.complete', response, e);\n            this.app.broadcast('upload.complete', response);\n\n            setTimeout(this._clear.bind(this), 500);\n        }\n    }\n});\n$R.add('class', 'code.component', {\n    mixins: ['dom', 'component'],\n    init: function(app, el)\n    {\n        this.app = app;\n\n        // init\n        return (el && el.cmnt !== undefined) ? el : this._init(el);\n    },\n\n    // private\n   _init: function(el)\n    {\n        var $pre;\n        if (typeof el !== 'undefined')\n        {\n            var $node = $R.dom(el);\n            var $wrapper = $node.closest('figure');\n            if ($wrapper.length !== 0)\n            {\n                this.parse($wrapper);\n            }\n            else\n            {\n                this.parse('<figure>');\n                this.append(el);\n            }\n\n            $pre = this.find('pre code, pre').last();\n        }\n        else\n        {\n            $pre = $R.dom('<pre>');\n\n            this.parse('<figure>');\n            this.append($pre);\n        }\n\n        this._initElement($pre);\n        this._initWrapper();\n    },\n    _initElement: function($pre)\n    {\n        $pre.attr({\n            'tabindex': '-1',\n            'contenteditable': true\n        });\n    },\n    _initWrapper: function()\n    {\n        this.addClass('redactor-component');\n        this.attr({\n            'data-redactor-type': 'code',\n            'tabindex': '-1',\n            'contenteditable': false\n        });\n    }\n});\n$R.add('module', 'form', {\n    init: function(app)\n    {\n        this.app = app;\n        this.lang = app.lang;\n        this.component = app.component;\n        this.inspector = app.inspector;\n    },\n    // messages\n    onform: {\n        remove: function(node)\n        {\n            this._remove(node);\n        }\n    },\n    oncontextbar: function(e, contextbar)\n    {\n        var data = this.inspector.parse(e.target);\n        if (data.isComponentType('form'))\n        {\n            var node = data.getComponent();\n            var buttons = {\n                \"remove\": {\n                    title: this.lang.get('delete'),\n                    api: 'module.form.remove',\n                    args: node\n                }\n            };\n\n            contextbar.set(e, node, buttons, 'top');\n        }\n\n    },\n\n    // private\n    _remove: function(node)\n    {\n        this.component.remove(node);\n    }\n});\n$R.add('class', 'form.component', {\n    mixins: ['dom', 'component'],\n    init: function(app, el)\n    {\n        this.app = app;\n        this.utils = app.utils;\n\n        // init\n        return (el && el.cmnt !== undefined) ? el : this._init(el);\n    },\n    // private\n    _init: function(el)\n    {\n        if (typeof el !== 'undefined')\n        {\n            var $node = $R.dom(el);\n            var $wrapper = $node.closest('form');\n            if ($wrapper.length !== 0)\n            {\n                var $figure = this.utils.replaceToTag(el, 'figure');\n                this.parse($figure);\n            }\n            else\n            {\n                this.parse('<figure>');\n                this.append(el);\n            }\n        }\n        else\n        {\n            this.parse('<figure>');\n        }\n\n        this._initWrapper();\n    },\n    _initWrapper: function()\n    {\n        this.addClass('redactor-component');\n        this.attr({\n            'data-redactor-type': 'form',\n            'tabindex': '-1',\n            'contenteditable': false\n        });\n    }\n});\n$R.add('module', 'image', {\n    modals: {\n        'image':\n            '<div class=\"redactor-modal-tab redactor-modal-tab-upload\" data-title=\"## upload ##\"><form action=\"\"> \\\n                <input type=\"file\" name=\"file\"> \\\n            </form></div>',\n        'imageedit':\n            '<div class=\"redactor-modal-group\"> \\\n                <div id=\"redactor-modal-image-preview\" class=\"redactor-modal-side\"></div> \\\n                <form action=\"\" class=\"redactor-modal-area\"> \\\n                    <div class=\"form-item\"> \\\n                        <label for=\"modal-image-title\"> ## title ##</label> \\\n                        <input type=\"text\" id=\"modal-image-title\" name=\"title\" /> \\\n                    </div> \\\n                    <div class=\"form-item form-item-caption\"> \\\n                        <label for=\"modal-image-caption\">## caption ##</label> \\\n                        <input type=\"text\" id=\"modal-image-caption\" name=\"caption\" aria-label=\"## caption ##\" /> \\\n                    </div> \\\n                    <div class=\"form-item form-item-align\"> \\\n                        <label>## image-position ##</label> \\\n                        <select name=\"align\" aria-label=\"## image-position ##\"> \\\n                            <option value=\"none\">## none ##</option> \\\n                            <option value=\"left\">## left ##</option> \\\n                            <option value=\"center\">## center ##</option> \\\n                            <option value=\"right\">## right ##</option> \\\n                        </select> \\\n                    </div> \\\n                    <div class=\"form-item form-item-link\"> \\\n                        <label for=\"modal-image-url\">## link ##</label> \\\n                        <input type=\"text\" id=\"modal-image-url\" name=\"url\" aria-label=\"## link ##\" /> \\\n                    </div> \\\n                    <div class=\"form-item form-item-link\"> \\\n                        <label class=\"checkbox\"><input type=\"checkbox\" name=\"target\" aria-label=\"## link-in-new-tab ##\"> ## link-in-new-tab ##</label> \\\n                    </div> \\\n                </form> \\\n            </div>'\n    },\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.lang = app.lang;\n        this.caret = app.caret;\n        this.utils = app.utils;\n        this.editor = app.editor;\n        this.storage = app.storage;\n        this.component = app.component;\n        this.inspector = app.inspector;\n        this.insertion = app.insertion;\n        this.selection = app.selection;\n\n        // local\n        this.justResized = false;\n    },\n    // messages\n    oninsert: function()\n    {\n        this._observeImages();\n    },\n    onstarted: function()\n    {\n        // storage observe\n        this.storage.observeImages();\n\n        // resize\n        if (this.opts.imageResizable)\n        {\n            this.resizer = $R.create('image.resize', this.app);\n        }\n\n        // observe\n        this._observeImages();\n    },\n    ondropimage: function(e, files, clipboard)\n    {\n        if (!this.opts.imageUpload) return;\n\n        var options = {\n            url: this.opts.imageUpload,\n            event: (clipboard) ? false : e,\n            files: files,\n            name: 'imagedrop',\n            data: this.opts.imageData,\n            paramName: this.opts.imageUploadParam\n        };\n\n        this.app.api('module.upload.send', options);\n    },\n    onstop: function()\n    {\n        if (this.resizer) this.resizer.stop();\n    },\n    onbottomclick: function()\n    {\n        this.insertion.insertToEnd(this.editor.getLastNode(), 'image');\n    },\n    onimageresizer: {\n        stop: function()\n        {\n            if (this.resizer) this.resizer.hide();\n        }\n    },\n    onsource: {\n        open: function()\n        {\n            if (this.resizer) this.resizer.hide();\n        },\n        closed: function()\n        {\n            this._observeImages();\n            if (this.resizer) this.resizer.rebuild();\n        }\n    },\n    onupload: {\n        complete: function()\n        {\n            this._observeImages();\n        },\n        image: {\n            complete: function(response)\n            {\n                this._insert(response);\n            },\n            error: function(response)\n            {\n                this._uploadError(response);\n            }\n        },\n        imageedit: {\n            complete: function(response)\n            {\n                this._change(response);\n            },\n            error: function(response)\n            {\n                this._uploadError(response);\n            }\n        },\n        imagedrop: {\n            complete: function(response, e)\n            {\n                this._insert(response, e);\n            },\n            error: function(response)\n            {\n                this._uploadError(response);\n            }\n        },\n        imagereplace: {\n            complete: function(response)\n            {\n                this._change(response, false);\n            },\n            error: function(response)\n            {\n                this._uploadError(response);\n            }\n        }\n    },\n    onmodal: {\n        image: {\n            open: function($modal, $form)\n            {\n                this._setUpload($modal, $form);\n            }\n        },\n        imageedit: {\n            open: function($modal, $form)\n            {\n                this._setFormData($modal, $form);\n            },\n            opened: function($modal, $form)\n            {\n                this._setFormFocus($form);\n            },\n            remove: function()\n            {\n                this._remove(this.$image);\n            },\n            save: function($modal, $form)\n            {\n                this._save($modal, $form);\n            }\n        }\n    },\n    onimage: {\n        observe: function()\n        {\n            this._observeImages();\n        },\n        resized: function()\n        {\n            this.justResized = true;\n        }\n    },\n    oncontextbar: function(e, contextbar)\n    {\n        if (this.justResized)\n        {\n            this.justResized = false;\n            return;\n        }\n\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var $img = $R.dom(current).closest('img');\n\n        if (!data.isFigcaption() && data.isComponentType('image') || $img.length !== 0)\n        {\n            var node = ($img.length !== 0) ? $img.get() : data.getComponent();\n            var buttons = {\n                \"edit\": {\n                    title: this.lang.get('edit'),\n                    api: 'module.image.open'\n                },\n                \"remove\": {\n                    title: this.lang.get('delete'),\n                    api: 'module.image.remove',\n                    args: node\n                }\n            };\n\n            contextbar.set(e, node, buttons);\n        }\n    },\n\n    // public\n    open: function()\n    {\n        this.$image = this._getCurrent();\n        this.app.api('module.modal.build', this._getModalData());\n    },\n    insert: function(data)\n    {\n        this._insert(data);\n    },\n    remove: function(node)\n    {\n        this._remove(node);\n    },\n\n    // private\n    _getModalData: function()\n    {\n        var modalData;\n        if (this._isImage() && this.opts.imageEditable)\n        {\n            modalData = {\n                name: 'imageedit',\n                width: '800px',\n                title: this.lang.get('edit'),\n                handle: 'save',\n                commands: {\n                    save: { title: this.lang.get('save') },\n                    remove: { title: this.lang.get('delete'), type: 'danger' },\n                    cancel: { title: this.lang.get('cancel') }\n                }\n            };\n        }\n        else\n        {\n            modalData = {\n                name: 'image',\n                title: this.lang.get('image')\n            };\n        }\n\n        return modalData;\n    },\n    _isImage: function()\n    {\n        return this.$image;\n    },\n    _getCurrent: function()\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var $img = $R.dom(current).closest('img');\n\n        if ($img.length !== 0) {\n            return this.component.create('image', $img);\n        }\n        else {\n            return (data.isComponentType('image') && data.isComponentActive()) ? this.component.create('image', data.getComponent()) : false;\n        }\n    },\n    _insert: function(response, e)\n    {\n        this.app.api('module.modal.close');\n\n        if (Array.isArray(response))\n        {\n            var obj = {};\n            for (var i = 0; i < response.length; i++)\n            {\n                obj = $R.extend(obj, response[i]);\n            }\n\n            response = obj;\n        }\n        else if (typeof response === 'string')\n        {\n            response = { \"file\": { url: response }};\n        }\n\n        if (typeof response === 'object')\n        {\n\n            var multiple = 0;\n            for (var key in response)\n            {\n                if (typeof response[key] === 'object') multiple++;\n            }\n\n            if (multiple > 1)\n            {\n                this._insertMultiple(response, e);\n            }\n            else\n            {\n                this._insertSingle(response, e);\n            }\n        }\n    },\n    _insertSingle: function(response, e)\n    {\n        for (var key in response)\n        {\n            if (typeof response[key] === 'object')\n            {\n                var $img = this._createImageAndStore(response[key]);\n                var inserted = (e) ? this.insertion.insertToPoint(e, $img, false, false) : this.insertion.insertHtml($img, false);\n\n                this._removeSpaceBeforeFigure(inserted[0]);\n\n                // set is active\n                this.component.setActive(inserted[0]);\n                this.app.broadcast('image.uploaded', inserted[0], response);\n            }\n        }\n    },\n    _insertMultiple: function(response, e)\n    {\n        var z = 0;\n        var inserted = [];\n        var last;\n        for (var key in response)\n        {\n            if (typeof response[key] === 'object')\n            {\n                z++;\n\n                var $img = this._createImageAndStore(response[key]);\n\n                if (z === 1)\n                {\n                    inserted = (e) ? this.insertion.insertToPoint(e, $img, false, false) : this.insertion.insertHtml($img, false);\n                }\n                else\n                {\n                    var $inserted = $R.dom(inserted[0]);\n                    $inserted.after($img);\n                    inserted = [$img.get()];\n\n                    this.app.broadcast('image.inserted', $img);\n                }\n\n                last = inserted[0];\n\n                this._removeSpaceBeforeFigure(inserted[0]);\n                this.app.broadcast('image.uploaded', inserted[0], response);\n            }\n        }\n\n        // set last is active\n        this.component.setActive(last);\n    },\n    _createImageAndStore: function(item)\n    {\n        var $img = this.component.create('image');\n\n        $img.addClass('redactor-uploaded-figure');\n        $img.setData({\n            src: item.url,\n            id: (item.id) ? item.id : this.utils.getRandomId()\n        });\n\n        // add to storage\n        this.storage.add('image', $img.getElement());\n\n        return $img;\n    },\n    _removeSpaceBeforeFigure: function(img)\n    {\n        if (!img) return;\n\n        var prev = img.previousSibling;\n        var next = img.nextSibling;\n        var $prev = $R.dom(prev);\n        var $next = $R.dom(next);\n\n        if (this.opts.breakline) {\n            if (next && $next.attr('data-redactor-tag') === 'br') {\n                $next.find('br').first().remove();\n            }\n            if (prev && $prev.attr('data-redactor-tag') === 'br') {\n                $prev.find('br').last().remove();\n            }\n        }\n\n        if (prev)\n        {\n            this._removeInvisibleSpace(prev);\n            this._removeInvisibleSpace(prev.previousSibling);\n        }\n    },\n    _removeInvisibleSpace: function(el)\n    {\n        if (el && el.nodeType === 3 && this.utils.searchInvisibleChars(el.textContent) !== -1)\n        {\n            el.parentNode.removeChild(el);\n        }\n    },\n    _save: function($modal, $form)\n    {\n        var data = $form.getData();\n        var imageData = {\n            title: data.title\n        };\n\n        if (this.opts.imageLink) imageData.link = { url: data.url, target: data.target };\n        if (this.opts.imageCaption) imageData.caption = data.caption;\n        if (this.opts.imagePosition) imageData.align = data.align;\n\n        this.$image.setData(imageData);\n        if (this.resizer) this.resizer.rebuild();\n\n        this.app.broadcast('image.changed', this.$image);\n        this.app.api('module.modal.close');\n    },\n    _change: function(response, modal)\n    {\n        if (typeof response === 'string')\n        {\n            response = { \"file\": { url: response }};\n        }\n\n        if (typeof response === 'object')\n        {\n            var $img;\n            for (var key in response)\n            {\n                if (typeof response[key] === 'object')\n                {\n                    $img = $R.dom('<img>');\n                    $img.attr('src', response[key].url);\n\n                    this.$image.changeImage(response[key]);\n\n                    this.app.broadcast('image.changed', this.$image, response);\n                    this.app.broadcast('image.uploaded', this.$image, response);\n\n                    this.app.broadcast('hardsync');\n\n                    break;\n                }\n            }\n\n            if (modal !== false)\n            {\n                $img.on('load', function() { this.$previewBox.html($img); }.bind(this));\n            }\n        }\n    },\n    _uploadError: function(response)\n    {\n        this.app.broadcast('image.uploadError', response);\n    },\n    _remove: function(node)\n    {\n        this.app.api('module.modal.close');\n        this.component.remove(node);\n    },\n    _observeImages: function()\n    {\n        var $editor = this.editor.getElement();\n        var self = this;\n        $editor.find('img').each(function(node)\n        {\n            var $node = $R.dom(node);\n\n            $node.off('.drop-to-replace');\n            $node.on('dragover.drop-to-replace dragenter.drop-to-replace', function(e)\n            {\n                e.preventDefault();\n                return;\n            });\n\n            $node.on('drop.drop-to-replace', function(e)\n            {\n                if (!self.app.isDragComponentInside())\n                {\n                    return self._setReplaceUpload(e, $node);\n                }\n            });\n        });\n    },\n    _setFormData: function($modal, $form)\n    {\n        this._buildPreview($modal);\n        this._buildPreviewUpload();\n\n        var imageData = this.$image.getData();\n        var data = {\n            title: imageData.title\n        };\n\n        // caption\n        if (this.opts.imageCaption) data.caption = imageData.caption;\n        else $modal.find('.form-item-caption').hide();\n\n        // position\n        if (this.opts.imagePosition) data.align = imageData.align;\n        else $modal.find('.form-item-align').hide();\n\n        // link\n        if (this.opts.imageLink)\n        {\n            if (imageData.link)\n            {\n                data.url = imageData.link.url;\n                if (imageData.link.target) data.target = true;\n            }\n        }\n        else $modal.find('.form-item-link').hide();\n\n        $form.setData(data);\n    },\n    _setFormFocus: function($form)\n    {\n        $form.getField('title').focus();\n    },\n    _setReplaceUpload: function(e, $node)\n    {\n        e = e.originalEvent || e;\n        e.stopPropagation();\n        e.preventDefault();\n\n        if (!this.opts.imageUpload) return;\n\n        this.$image = this.component.create('image', $node);\n\n        var options = {\n            url: this.opts.imageUpload,\n            files: e.dataTransfer.files,\n            name: 'imagereplace',\n            data: this.opts.imageData,\n            paramName: this.opts.imageUploadParam\n        };\n\n        this.app.api('module.upload.send', options);\n\n        return;\n    },\n    _setUpload: function($modal, $form)\n    {\n        if (!this.opts.imageUpload) {\n            var $body = $modal.getBody();\n            var $tab = $body.find('.redactor-modal-tab-upload');\n            $tab.remove();\n        }\n\n        var options = {\n            url: this.opts.imageUpload,\n            element: $form.getField('file'),\n            name: 'image',\n            data: this.opts.imageData,\n            paramName: this.opts.imageUploadParam\n        };\n\n        this.app.api('module.upload.build', options);\n    },\n    _buildPreview: function($modal)\n    {\n        this.$preview = $modal.find('#redactor-modal-image-preview');\n\n        var imageData = this.$image.getData();\n        var $previewImg = $R.dom('<img>');\n        $previewImg.attr('src', imageData.src);\n\n        this.$previewBox = $R.dom('<div>');\n        this.$previewBox.append($previewImg);\n\n        this.$preview.html('');\n        this.$preview.append(this.$previewBox);\n    },\n    _buildPreviewUpload: function()\n    {\n        if (!this.opts.imageUpload) return;\n\n        var $desc = $R.dom('<div class=\"desc\">');\n        $desc.html(this.lang.get('upload-change-label'));\n\n        this.$preview.append($desc);\n\n        var options = {\n            url: this.opts.imageUpload,\n            element: this.$previewBox,\n            name: 'imageedit',\n            data: this.opts.imageData,\n            paramName: this.opts.imageUploadParam\n        };\n\n        this.app.api('module.upload.build', options);\n    }\n});\n$R.add('class', 'image.component', {\n    mixins: ['dom', 'component'],\n    init: function(app, el)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.selection = app.selection;\n\n        // init\n        return (el && el.cmnt !== undefined) ? el : this._init(el);\n    },\n    setData: function(data)\n    {\n        for (var name in data)\n        {\n            this._set(name, data[name]);\n        }\n    },\n    getData: function()\n    {\n        var names = ['src', 'title', 'caption', 'align', 'link', 'id'];\n        var data = {};\n\n        for (var i = 0; i < names.length; i++)\n        {\n            data[names[i]] = this._get(names[i]);\n        }\n\n        return data;\n    },\n    getElement: function()\n    {\n        return this.$element;\n    },\n    changeImage: function(data)\n    {\n        this.$element.attr('src', data.url);\n    },\n\n\n    // private\n    _init: function(el)\n    {\n        var $el = $R.dom(el);\n        var $figure = $el.closest('figure');\n\n        if (el === undefined)\n        {\n            this.$element = $R.dom('<img>');\n            this.parse('<figure>');\n            this.append(this.$element);\n        }\n        else if ($figure.length === 0)\n        {\n            this.parse('<figure>');\n            this.$element = $el;\n            this.$element.wrap(this);\n        }\n        else\n        {\n            this.parse($figure);\n            this.$element = this.find('img');\n        }\n\n        this._initWrapper();\n    },\n    _set: function(name, value)\n    {\n        this['_set_' + name](value);\n    },\n    _get: function(name)\n    {\n        return this['_get_' + name]();\n    },\n    _set_src: function(src)\n    {\n       this.$element.attr('src', src);\n    },\n    _set_id: function(id)\n    {\n        if (this.opts.imageObserve) {\n            this.$element.attr('data-image', id);\n        }\n    },\n    _set_title: function(title)\n    {\n        title = title.trim().replace(/(<([^>]+)>)/ig,\"\");\n\n        if (title === '')\n        {\n            this.$element.removeAttr('alt');\n        }\n        else\n        {\n            this.$element.attr('alt', title);\n        }\n\n    },\n    _set_caption: function(caption)\n    {\n        var $figcaption = this.find('figcaption');\n        if ($figcaption.length === 0)\n        {\n            $figcaption = $R.dom('<figcaption>');\n            $figcaption.attr('contenteditable', 'true');\n\n            this.append($figcaption);\n        }\n\n        if (caption === '') $figcaption.remove();\n        else $figcaption.html(caption);\n\n        return $figcaption;\n    },\n    _set_align: function(align)\n    {\n        var imageFloat = '';\n        var imageMargin = '';\n        var textAlign = '';\n        var $el = this;\n        var $img = this.find('img');\n        var $figcaption = this.find('figcaption');\n\n        if (typeof this.opts.imagePosition === 'object')\n        {\n            var positions = this.opts.imagePosition;\n            for (var key in positions)\n            {\n                $el.removeClass(positions[key]);\n            }\n\n            var alignClass = (typeof positions[align] !== 'undefined') ? positions[align] : false;\n            if (alignClass)\n            {\n                $el.addClass(alignClass);\n            }\n        }\n        else\n        {\n            var width = $img.width();\n\n            switch (align)\n            {\n                case 'left':\n                    imageFloat = 'left';\n                    imageMargin = '0 ' + this.opts.imageFloatMargin + ' ' + this.opts.imageFloatMargin + ' 0';\n                break;\n                case 'right':\n                    imageFloat = 'right';\n                    imageMargin = '0 0 ' + this.opts.imageFloatMargin + ' ' + this.opts.imageFloatMargin;\n                break;\n                case 'center':\n                    textAlign = 'center';\n                    imageMargin = 'auto';\n                break;\n            }\n\n            $el.css({ 'float': imageFloat, width: width + 'px', maxWidth: width + 'px', 'margin': imageMargin, 'text-align': textAlign });\n            $el.attr('rel', $el.attr('style'));\n\n            if (align === 'none') {\n                $el.css('max-width', '');\n                $el.css('width', '');\n            }\n\n            if (align === 'center')\n            {\n                $el.css('max-width', '');\n                $el.css('width', '');\n                $figcaption.css('text-align', 'center');\n            }\n            else\n            {\n                $figcaption.css('text-align', '');\n            }\n        }\n    },\n    _set_link: function(data)\n    {\n        var $link = this._findLink();\n        if (data.url === '')\n        {\n            if ($link) $link.unwrap();\n\n            return;\n        }\n\n        if (!$link)\n        {\n            $link = $R.dom('<a>');\n            this.$element.wrap($link);\n        }\n\n        $link.attr('href', data.url);\n\n        if (data.target) $link.attr('target', (data.target === true) ? '_blank' : data.target);\n        else $link.removeAttr('target');\n\n        return $link;\n    },\n    _get_src: function()\n    {\n        return this.$element.attr('src');\n    },\n    _get_id: function()\n    {\n        return this.$element.attr('data-image');\n    },\n    _get_title: function()\n    {\n        var alt = this.$element.attr('alt');\n\n        return (alt) ? alt : '';\n    },\n    _get_caption: function()\n    {\n        var $figcaption = this.find('figcaption');\n\n        if ($figcaption.length === 0)\n        {\n            return '';\n        }\n        else\n        {\n            return $figcaption.html();\n        }\n    },\n    _get_align: function()\n    {\n        var align = '';\n        if (typeof this.opts.imagePosition === 'object')\n        {\n            align = 'none';\n            var positions = this.opts.imagePosition;\n            for (var key in positions)\n            {\n                if (this.hasClass(positions[key]))\n                {\n                    align = key;\n                    break;\n                }\n            }\n        }\n        else\n        {\n            align = (this.css('text-align') === 'center') ? 'center' : this.css('float');\n        }\n\n        return align;\n    },\n    _get_link: function()\n    {\n        var $link = this._findLink();\n        if ($link)\n        {\n            var target = ($link.attr('target')) ? true : false;\n\n            return {\n                url: $link.attr('href'),\n                target: target\n            };\n        }\n    },\n    _initWrapper: function()\n    {\n        this.addClass('redactor-component');\n        this.attr({\n            'data-redactor-type': 'image',\n            'tabindex': '-1',\n            'contenteditable': false\n        });\n    },\n    _findLink: function()\n    {\n        var $link = this.find('a').filter(function(node)\n        {\n            return ($R.dom(node).closest('figcaption').length === 0);\n        });\n\n        if ($link.length !== 0)\n        {\n            return $link;\n        }\n\n        return false;\n    }\n});\n$R.add('class', 'image.resize', {\n    init: function(app)\n    {\n        this.app = app;\n        this.$doc = app.$doc;\n        this.$win = app.$win;\n        this.$body = app.$body;\n        this.editor = app.editor;\n        this.toolbar = app.toolbar;\n        this.inspector = app.inspector;\n\n        // init\n        this.$target = (this.toolbar.isTarget()) ? this.toolbar.getTargetElement() : this.$body;\n        this._init();\n    },\n    // public\n    rebuild: function()\n    {\n        this._setResizerPosition();\n    },\n    hide: function()\n    {\n        this.$target.find('#redactor-image-resizer').remove();\n    },\n    stop: function()\n    {\n        var $editor = this.editor.getElement();\n        $editor.off('.redactor.image-resize');\n\n        this.$doc.off('.redactor.image-resize');\n        this.$win.off('resize.redactor.image-resize');\n        this.hide();\n    },\n\n    // private\n    _init: function()\n    {\n        var $editor = this.editor.getElement();\n        $editor.on('click.redactor.image-resize', this._build.bind(this));\n\n        this.$win.on('resize.redactor.image-resize', this._setResizerPosition.bind(this));\n    },\n    _build: function(e)\n    {\n        this.$target.find('#redactor-image-resizer').remove();\n\n        if (this.app.isReadOnly()) return;\n\n        var data = this.inspector.parse(e.target);\n        var $editor = this.editor.getElement();\n\n        if (data.isComponentType('image'))\n        {\n            this.$resizableBox = $editor;\n            this.$resizableImage = $R.dom(data.getImageElement());\n\n            this.$resizer = $R.dom('<span>');\n            this.$resizer.attr('id', 'redactor-image-resizer');\n\n            this.$target.append(this.$resizer);\n\n            this._setResizerPosition();\n            this.$resizer.on('mousedown touchstart', this._set.bind(this));\n        }\n    },\n    _setResizerPosition: function()\n    {\n        if (this.$resizer)\n        {\n            var isTarget = this.toolbar.isTarget();\n            var targetOffset = this.$target.offset();\n            var offsetFix = 7;\n            var topOffset = (isTarget) ? (offsetFix - targetOffset.top + this.$target.scrollTop()) : offsetFix;\n            var leftOffset = (isTarget) ? (offsetFix - targetOffset.left) : offsetFix;\n            var pos = this.$resizableImage.offset();\n            var width = this.$resizableImage.width();\n            var height = this.$resizableImage.height();\n            var resizerWidth =  this.$resizer.width();\n            var resizerHeight =  this.$resizer.height();\n\n            this.$resizer.css({ top: Math.round(pos.top + height - resizerHeight + topOffset) + 'px', left: Math.round(pos.left + width - resizerWidth + leftOffset) + 'px' });\n        }\n    },\n    _set: function(e)\n    {\n        e.preventDefault();\n\n        this.resizeHandle = {\n            x : e.pageX,\n            y : e.pageY,\n            el : this.$resizableImage,\n            $figure: this.$resizableImage.closest('figure'),\n            ratio: this.$resizableImage.width() / this.$resizableImage.height(),\n            h: this.$resizableImage.height()\n        };\n\n        e = e.originalEvent || e;\n\n        if (e.targetTouches)\n        {\n             this.resizeHandle.x = e.targetTouches[0].pageX;\n             this.resizeHandle.y = e.targetTouches[0].pageY;\n        }\n\n        this.app.broadcast('contextbar.close');\n        this.app.broadcast('image.resize', this.$resizableImage);\n        this._start();\n    },\n    _start: function()\n    {\n        this.$doc.on('mousemove.redactor.image-resize touchmove.redactor.image-resize', this._move.bind(this));\n        this.$doc.on('mouseup.redactor.image-resize touchend.redactor.image-resize', this._stop.bind(this));\n    },\n    _stop: function()\n    {\n        this.$doc.off('.redactor.image-resize');\n        this.app.broadcast('image.resized', this.$resizableImage);\n    },\n    _move: function(e)\n    {\n        e.preventDefault();\n\n        e = e.originalEvent || e;\n\n        var height = this.resizeHandle.h;\n\n        if (e.targetTouches) height += (e.targetTouches[0].pageY -  this.resizeHandle.y);\n        else height += (e.pageY -  this.resizeHandle.y);\n\n        var width = height * this.resizeHandle.ratio;\n\n        width = Math.round(width);\n        height = Math.round(height);\n\n        if (height < 20 || width < 100) return;\n        if (this._getResizableBoxWidth() <= width) return;\n\n        if (this.resizeHandle.$figure.length !== 0 && this.resizeHandle.$figure.css('max-width') !== '') {\n            this.resizeHandle.$figure.css('max-width', width + 'px');\n        }\n\n        this.resizeHandle.el.attr({ width: width, height: height });\n        this.resizeHandle.el.width(width);\n        this.resizeHandle.el.css('max-width', width + 'px');\n        this.resizeHandle.el.height(height);\n        this._setResizerPosition();\n    },\n    _getResizableBoxWidth: function()\n    {\n        var width = this.$resizableBox.width();\n        return width - parseInt(this.$resizableBox.css('padding-left')) - parseInt(this.$resizableBox.css('padding-right'));\n    }\n});\n$R.add('module', 'file', {\n    modals: {\n        'file':\n            '<div class=\"redactor-modal-tab\" data-title=\"## upload ##\"><form action=\"\"> \\\n                <div class=\"form-item form-item-title\"> \\\n                    <label for=\"modal-file-title\"> ## filename ## <span class=\"desc\">(## optional ##)</span></label> \\\n                    <input type=\"text\" id=\"modal-file-title\" name=\"title\" /> \\\n                </div> \\\n                <input type=\"file\" name=\"file\"> \\\n            </form></div>'\n    },\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.lang = app.lang;\n        this.caret = app.caret;\n        this.utils = app.utils;\n        this.storage = app.storage;\n        this.component = app.component;\n        this.inspector = app.inspector;\n        this.insertion = app.insertion;\n        this.selection = app.selection;\n    },\n    // messages\n    onstarted: function()\n    {\n        // storage observe\n        this.storage.observeFiles();\n    },\n    ondropfile: function(e, files, clipboard)\n    {\n        if (!this.opts.fileUpload) return;\n\n        var options = {\n            url: this.opts.fileUpload,\n            event: (clipboard) ? false : e,\n            files: files,\n            name: 'filedrop',\n            data: this.opts.fileData\n        };\n\n        this.app.api('module.upload.send', options);\n    },\n    onmodal: {\n        file: {\n            open: function($modal, $form)\n            {\n                this._setFormData($modal, $form);\n                this._setUpload($form);\n            },\n            opened: function($modal, $form)\n            {\n                this._setFormFocus($form);\n\n                this.$form = $form;\n            }\n        }\n    },\n    onupload: {\n        file: {\n            complete: function(response)\n            {\n                this._insert(response);\n            },\n            error: function(response)\n            {\n                this._uploadError(response);\n            }\n        },\n        filedrop: {\n            complete: function(response, e)\n            {\n                this._insert(response, e);\n            },\n            error: function(response)\n            {\n                this._uploadError(response);\n            }\n        }\n    },\n\n    // public\n    open: function()\n    {\n        this._open();\n    },\n    insert: function(data)\n    {\n        this._insert(data);\n    },\n    remove: function(node)\n    {\n        this._remove(node);\n    },\n\n    // private\n    _open: function()\n    {\n        this.app.api('module.modal.build', this._getModalData());\n    },\n    _getModalData: function()\n    {\n        var modalData = {\n            name: 'file',\n            title: this.lang.get('file')\n        };\n\n        return modalData;\n    },\n    _insert: function(response, e)\n    {\n        this.app.api('module.modal.close');\n        if (typeof response !== 'object') return;\n\n        if (Array.isArray(response))\n        {\n            var obj = {};\n            for (var i = 0; i < response.length; i++)\n            {\n                obj = $R.extend(obj, response[i]);\n            }\n\n            response = obj;\n        }\n\n        var multiple = (Object.keys(response).length  > 1);\n\n        if (multiple)\n        {\n            this._insertMultiple(response, e);\n        }\n        else\n        {\n            this._insertSingle(response, e);\n        }\n\n        this.$form = false;\n    },\n    _insertSingle: function(response, e)\n    {\n        var inserted = [];\n        for (var key in response)\n        {\n            var $file = this._createFileAndStore(response[key]);\n\n            if (this.opts.fileAttachment)\n            {\n                inserted = this._insertAsAttachment($file);\n            }\n            else\n            {\n                inserted = (e) ? this.insertion.insertToPoint(e, $file) : this.insertion.insertRaw($file);\n            }\n\n            this.app.broadcast('file.uploaded', inserted[0], response);\n        }\n    },\n    _insertMultiple: function(response, e)\n    {\n        var z = 0;\n        var inserted = [];\n        var $last;\n        for (var key in response)\n        {\n            z++;\n\n            var $file = this._createFileAndStore(response[key]);\n\n            if (this.opts.fileAttachment)\n            {\n                inserted = this._insertAsAttachment($file, response);\n            }\n            else\n            {\n                if (z === 1)\n                {\n                    inserted = (e) ? this.insertion.insertToPoint(e, $file) : this.insertion.insertRaw($file);\n                }\n                else\n                {\n                    var $inserted = $R.dom(inserted[0]);\n                    $inserted.after($file).after(' ');\n                    inserted = [$file.get()];\n\n                    this.app.broadcast('file.inserted', $file);\n                }\n            }\n\n            $last = $file;\n            this.app.broadcast('file.uploaded', inserted[0], response);\n        }\n\n        // set caret after last\n        if (!this.opts.fileAttachment)\n        {\n            this.caret.setAfter($last);\n        }\n    },\n    _insertAsAttachment: function($file, response)\n    {\n        var $box = $R.dom(this.opts.fileAttachment);\n        var $wrapper = $file.wrapAttachment();\n        $box.append($wrapper);\n\n        var inserted = [$wrapper.get()];\n        this.app.broadcast('file.appended', inserted[0], response);\n\n        return inserted;\n    },\n    _createFileAndStore: function(item)\n    {\n        var modalFormData = (this.$form) ? this.$form.getData() : false;\n        var name = (item.name) ? item.name : item.url;\n        var title = (!this.opts.fileAttachment && modalFormData && modalFormData.title !== '') ? modalFormData.title : this._truncateUrl(name);\n\n        var $file = this.component.create('file');\n        $file.attr('href', item.url);\n        $file.attr('data-file', (item.id) ? item.id : this.utils.getRandomId());\n        $file.attr('data-name', item.name);\n        $file.html(title);\n\n        // add to storage\n        this.storage.add('file', $file);\n\n        return $file;\n    },\n    _remove: function(node)\n    {\n        this.selection.save();\n\n        var $file = this.component.create('file', node);\n        var stop = this.app.broadcast('file.delete', $file);\n        if (stop !== false)\n        {\n            $file.unwrap();\n\n            this.selection.restore();\n\n            // callback\n            this.app.broadcast('file.deleted', $file);\n        }\n        else\n        {\n            this.selection.restore();\n        }\n    },\n    _truncateUrl: function(url)\n    {\n        return (url.search(/^http/) !== -1 && url.length > 20) ? url.substring(0, 20) + '...' : url;\n    },\n    _setUpload: function($form)\n    {\n        var options = {\n            url: this.opts.fileUpload,\n            element: $form.getField('file'),\n            name: 'file',\n            data: this.opts.fileData,\n            paramName: this.opts.fileUploadParam\n        };\n\n        this.app.api('module.upload.build', options);\n    },\n    _setFormData: function($modal, $form)\n    {\n        if (this.opts.fileAttachment)\n        {\n            $modal.find('.form-item-title').hide();\n        }\n        else\n        {\n            $form.setData({ title: this.selection.getText() });\n        }\n    },\n    _setFormFocus: function($form)\n    {\n        $form.getField('title').focus();\n    },\n    _uploadError: function(response)\n    {\n        this.app.broadcast('file.uploadError', response);\n    }\n});\n$R.add('class', 'file.component', {\n    mixins: ['dom', 'component'],\n    init: function(app, el)\n    {\n        this.app = app;\n        this.opts = app.opts;\n\n        // init\n        return (el && el.cmnt !== undefined) ? el : this._init(el);\n    },\n    wrapAttachment: function()\n    {\n        this.$wrapper = $R.dom('<span class=\"redactor-file-item\">');\n        this.$remover = $R.dom('<span class=\"redactor-file-remover\">');\n        this.$remover.html('&times;');\n        this.$remover.on('click', this.removeAttachment.bind(this));\n\n        this.$wrapper.append(this);\n        this.$wrapper.append(this.$remover);\n\n        return this.$wrapper;\n    },\n    removeAttachment: function(e)\n    {\n        e.preventDefault();\n\n        var stop = this.app.broadcast('file.delete', this, this.$wrapper);\n        if (stop !== false)\n        {\n            this.$wrapper.remove();\n            this.app.broadcast('file.deleted', this);\n            this.app.broadcast('file.removeAttachment', this);\n        }\n    },\n\n    // private\n    _init: function(el)\n    {\n        if (el === undefined)\n        {\n            this.parse('<a>');\n        }\n        else\n        {\n            var $a = $R.dom(el).closest('a');\n            this.parse($a);\n        }\n    }\n});\n$R.add('module', 'buffer', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.editor = app.editor;\n        this.offset = app.offset;\n        this.keycodes = app.keycodes;\n        this.selection = app.selection;\n\n        // local\n        this.state = false;\n        this.passed = false;\n        this.keyPressed = false;\n        this.undoStorage = [];\n        this.redoStorage = [];\n    },\n    // messages\n    onkeydown: function(e)\n    {\n        this._listen(e);\n    },\n    onsyncing: function()\n    {\n        if (!this.keyPressed)\n        {\n            this.trigger();\n        }\n\n        this.keyPressed = false;\n    },\n    onbuffer: {\n        trigger: function()\n        {\n            this.trigger();\n        }\n    },\n    onstate: function(e, html, offset)\n    {\n        if ((e && (e.ctrlKey || e.metaKey)) || (e && (this._isUndo(e) || this._isRedo(e))))\n        {\n            return;\n        }\n\n        this.passed = false;\n        this._saveState(html, offset);\n\n        if (e === false) {\n            this._setUndo();\n        }\n    },\n    onenable: function()\n    {\n        this.clear();\n    },\n\n    // public\n    clear: function()\n    {\n        this.state = false;\n        this.undoStorage = [];\n        this.redoStorage = [];\n    },\n    undo: function()\n    {\n        this._getUndo();\n    },\n    redo: function()\n    {\n        this._getRedo();\n    },\n    trigger: function()\n    {\n        if (this.state && this.passed === false) this._setUndo();\n    },\n\n    // private\n    _saveState: function(html, offset)\n    {\n\n        var $editor = this.editor.getElement();\n\n        this.state = {\n            html: html || $editor.html(),\n            offset: offset || this.offset.get()\n        };\n    },\n    _listen: function(e)\n    {\n        var key = e.which;\n        var ctrl = e.ctrlKey || e.metaKey;\n        var cmd = ctrl || e.shiftKey || e.altKey;\n        var keys = [this.keycodes.SPACE, this.keycodes.ENTER, this.keycodes.BACKSPACE, this.keycodes.DELETE, this.keycodes.TAB,\n                    this.keycodes.LEFT, this.keycodes.RIGHT, this.keycodes.UP, this.keycodes.DOWN];\n        // undo\n        if (this._isUndo(e)) // z key\n        {\n            e.preventDefault();\n            this.undo();\n            return;\n        }\n        // redo\n        else if (this._isRedo(e))\n        {\n            e.preventDefault();\n            this.redo();\n            return;\n        }\n        // spec keys\n        else if (!ctrl && keys.indexOf(key) !== -1)\n        {\n            cmd = true;\n            this.trigger();\n        }\n        // cut & copy\n        else if (ctrl && (key === 88 || key === 67))\n        {\n            cmd = true;\n            this.trigger();\n        }\n\n\n        // empty buffer\n        if (!cmd && !this._hasUndo())\n        {\n            this.trigger();\n        }\n\n        this.keyPressed = true;\n    },\n    _isUndo: function(e)\n    {\n        var key = e.which;\n        var ctrl = e.ctrlKey || e.metaKey;\n\n        return (ctrl && key === 90 && !e.shiftKey && !e.altKey);\n    },\n    _isRedo: function(e)\n    {\n        var key = e.which;\n        var ctrl = e.ctrlKey || e.metaKey;\n\n        return (ctrl && (key === 90 && e.shiftKey || key === 89 && !e.shiftKey) && !e.altKey);\n    },\n    _setUndo: function()\n    {\n        var last = this.undoStorage[this.undoStorage.length-1];\n        if (typeof last === 'undefined' || last[0] !== this.state.html)\n        {\n            this.undoStorage.push([this.state.html, this.state.offset]);\n            this._removeOverStorage();\n        }\n    },\n    _setRedo: function()\n    {\n        var $editor = this.editor.getElement();\n        var offset = this.offset.get();\n        var html = $editor.html();\n\n        this.redoStorage.push([html, offset]);\n        this.redoStorage = this.redoStorage.slice(0, this.opts.bufferLimit);\n    },\n    _getUndo: function()\n    {\n        if (!this._hasUndo()) return;\n\n        this.passed = true;\n\n        var $editor = this.editor.getElement();\n        var buffer = this.undoStorage.pop();\n\n        this._setRedo();\n\n        $editor.html(buffer[0]);\n        this.offset.set(buffer[1]);\n        this._saveState(buffer[0], buffer[1]);\n        this.selection.restore();\n\n        this.app.broadcast('undo', buffer[0], buffer[1]);\n\n    },\n    _getRedo: function()\n    {\n        if (!this._hasRedo()) return;\n\n        this.passed = true;\n\n        var $editor = this.editor.getElement();\n        var buffer = this.redoStorage.pop();\n\n        this._setUndo();\n        $editor.html(buffer[0]);\n        this.offset.set(buffer[1]);\n        this._saveState(buffer[0], buffer[1]);\n\n        this.app.broadcast('redo', buffer[0], buffer[1]);\n    },\n    _removeOverStorage: function()\n    {\n        if (this.undoStorage.length > this.opts.bufferLimit)\n        {\n            this.undoStorage = this.undoStorage.slice(0, (this.undoStorage.length - this.opts.bufferLimit));\n        }\n    },\n    _hasUndo: function()\n    {\n        return (this.undoStorage.length !== 0);\n    },\n    _hasRedo: function()\n    {\n        return (this.redoStorage.length !== 0);\n    }\n});\n$R.add('module', 'list', {\n    init: function(app)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.block = app.block;\n        this.toolbar = app.toolbar;\n        this.inspector = app.inspector;\n        this.selection = app.selection;\n    },\n    // messages\n    onbutton: {\n        list: {\n            observe: function(button)\n            {\n                this._observeButton(button);\n            }\n        }\n    },\n    ondropdown: {\n        list: {\n            observe: function(dropdown)\n            {\n                this._observeDropdown(dropdown);\n            }\n        }\n    },\n\n    // public\n    toggle: function(type)\n    {\n        var nodes = this._getBlocks();\n        var block = this.selection.getBlock();\n        var $list = $R.dom(block).parents('ul, ol',  '.redactor-in-' + this.uuid).last();\n        if (nodes.length === 0 && $list.length !== 0)\n        {\n            nodes = [$list.get()];\n        }\n\n        if (block && (block.tagName === 'TD' || block.tagName === 'TH'))\n        {\n            nodes = this.block.format('div');\n        }\n\n        this.selection.saveMarkers();\n\n        nodes = (nodes.length !== 0 && this._isUnformat(type, nodes)) ? this._unformat(type, nodes) : this._format(type, nodes);\n\n        this.selection.restoreMarkers();\n\n        return nodes;\n    },\n    indent: function()\n    {\n        var isCollapsed = this.selection.isCollapsed();\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var item = (data.isList()) ? data.getListItem() : false;\n        var $item = $R.dom(item);\n        var $prev = $item.prevElement();\n        var prev = $prev.get();\n        var isIndent = (isCollapsed && item && prev && prev.tagName === 'LI');\n\n        if (isIndent)\n        {\n            this.selection.saveMarkers();\n\n            $prev = $R.dom(prev);\n            var $prevChild = $prev.children('ul, ol');\n            var $list = $item.closest('ul, ol');\n\n            if ($prevChild.length !== 0)\n            {\n                $prevChild.append($item);\n            }\n            else\n            {\n                var listTag = $list.get().tagName.toLowerCase();\n                var $newList = $R.dom('<' + listTag + '>');\n\n                $newList.append($item);\n                $prev.append($newList);\n            }\n\n            this.selection.restoreMarkers();\n        }\n    },\n    outdent: function()\n    {\n        var isCollapsed = this.selection.isCollapsed();\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var item = (data.isList()) ? data.getListItem() : false;\n        var $item = $R.dom(item);\n\n        if (isCollapsed && item)\n        {\n\n            var $listItem = $item.parent();\n            var $liItem = $listItem.closest('li', '.redactor-in-' + this.uuid);\n            var $prev = $item.prevElement();\n            var $next = $item.nextElement();\n            var prev = $prev.get();\n            var next = $next.get();\n            var nextItems, nextList, $newList, $nextList;\n            var isTop = (prev === false);\n            var isMiddle = (prev !== false && next !== false);\n            var isBottom = (!isTop && next === false);\n\n            this.selection.saveMarkers();\n\n            // out\n            if ($liItem.length !== 0)\n            {\n                if (isMiddle)\n                {\n                    nextItems = this._getAllNext($item.get());\n                    $newList = $R.dom('<' + $listItem.get().tagName.toLowerCase() + '>');\n\n                    for (var i = 0; i < nextItems.length; i++)\n                    {\n                        $newList.append(nextItems[i]);\n                    }\n\n                    $liItem.after($item);\n                    $item.append($newList);\n                }\n                else\n                {\n                    $liItem.after($item);\n\n                    if ($listItem.children().length === 0)\n                    {\n                        $listItem.remove();\n                    }\n                    else\n                    {\n                        if (isTop) $item.append($listItem);\n                    }\n                }\n            }\n            // unformat\n            else\n            {\n                var $container =  this._createUnformatContainer($item);\n                var $childList = $container.find('ul, ol').first();\n\n                if (isTop) $listItem.before($container);\n                else if (isBottom) $listItem.after($container);\n                else if (isMiddle)\n                {\n                    $newList = $R.dom('<' + $listItem.get().tagName.toLowerCase() + '>');\n                    nextItems = this._getAllNext($item.get());\n\n                    for (var i = 0; i < nextItems.length; i++)\n                    {\n                        $newList.append(nextItems[i]);\n                    }\n\n                    $listItem.after($container);\n                    $container.after($newList);\n                }\n\n                if ($childList.length !== 0)\n                {\n                    $nextList = $container.nextElement();\n                    nextList = $nextList.get();\n                    if (nextList && nextList.tagName === $listItem.get().tagName)\n                    {\n                        $R.dom(nextList).prepend($childList);\n                        $childList.unwrap();\n                    }\n                    else\n                    {\n                        $container.after($childList);\n                    }\n                }\n\n                $item.remove();\n            }\n\n            this.selection.restoreMarkers();\n        }\n    },\n\n    // private\n    _getAllNext: function(next)\n    {\n        var nodes = [];\n\n        while (next)\n        {\n            var $next = $R.dom(next).nextElement();\n            next = $next.get();\n\n            if (next) nodes.push(next);\n            else return nodes;\n        }\n\n        return nodes;\n    },\n    _isUnformat: function(type, nodes)\n    {\n        var countLists = 0;\n        for (var i = 0; i < nodes.length; i++)\n        {\n            if (nodes[i].nodeType !== 3)\n            {\n                var tag = nodes[i].tagName.toLowerCase();\n                if (tag === type || tag === 'figure')\n                {\n                    countLists++;\n                }\n            }\n        }\n\n        return (countLists === nodes.length);\n    },\n    _format: function(type, nodes)\n    {\n        var tags = ['p', 'div', 'blockquote', 'pre', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'ul', 'ol'];\n        var blocks = this._uniteBlocks(nodes, tags);\n        var lists = [];\n\n        for (var key in blocks)\n        {\n            var items = blocks[key];\n            var $list = this._createList(type, blocks[key]);\n\n            for (var i = 0; i < items.length; i++)\n            {\n                var $item;\n\n                // lists\n                if (items[i].nodeType !== 3 && (items[i].tagName === 'UL' || items[i].tagName === 'OL'))\n                {\n                    var $oldList = $R.dom(items[i]);\n\n                    $item = $oldList.contents();\n                    $list.append($item);\n\n                    // old is empty\n                    if (this.utils.isEmpty($oldList)) $oldList.remove();\n                }\n                // other blocks or texts\n                else\n                {\n                    $item = this._createListItem(items[i]);\n                    var last = $item.get().lastChild;\n                    if (last && last.tagName === 'BR') {\n                        $R.dom(last).remove();\n                    }\n\n                    this.utils.normalizeTextNodes($item);\n                    $list.append($item);\n                }\n            }\n\n            lists.push($list.get());\n        }\n\n        return lists;\n    },\n    _uniteBlocks: function(nodes, tags)\n    {\n        var z = 0;\n        var blocks = { 0: [] };\n        var lastcell = false;\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var $node = $R.dom(nodes[i]);\n            var $cell = $node.closest('th, td');\n\n            if ($cell.length !== 0)\n            {\n                if ($cell.get() !== lastcell)\n                {\n                    // create block\n                    z++;\n                    blocks[z] = [];\n                }\n\n                if (this._isUniteBlock(nodes[i], tags))\n                {\n                    blocks[z].push(nodes[i]);\n                }\n            }\n            else\n            {\n                if (this._isUniteBlock(nodes[i], tags))\n                {\n                    blocks[z].push(nodes[i]);\n                }\n                else\n                {\n                    // create block\n                    z++;\n                    blocks[z] = [];\n                }\n            }\n\n            lastcell = $cell.get();\n        }\n\n        return blocks;\n    },\n    _isUniteBlock: function(node, tags)\n    {\n        return (node.nodeType === 3 || tags.indexOf(node.tagName.toLowerCase()) !== -1);\n    },\n    _createList: function(type, blocks)\n    {\n        var last = blocks[blocks.length-1];\n        var $last = $R.dom(last);\n        var $list = $R.dom('<' + type + '>');\n        $last.after($list);\n\n        return $list;\n    },\n    _createListItem: function(item)\n    {\n        var $item = $R.dom('<li>');\n        if (item.nodeType === 3)\n        {\n            $item.append(item);\n        }\n        else\n        {\n            var $el = $R.dom(item);\n            $item.append($el.contents());\n            $el.remove();\n        }\n\n        return $item;\n    },\n    _unformat: function(type, nodes)\n    {\n        if (nodes.length === 1)\n        {\n            // one list\n            var $list = $R.dom(nodes[0]);\n            var $items = $list.find('li');\n\n            var selectedItems = this.selection.getNodes({ tags: ['li'] });\n            var block = this.selection.getBlock();\n            var $li = $R.dom(block).closest('li');\n            if (selectedItems.length === 0 && $li.length !== 0)\n            {\n                selectedItems = [$li.get()];\n            }\n\n\n            // 1) entire\n            if (selectedItems.length === $items.length)\n            {\n                return this._unformatEntire(nodes[0]);\n            }\n\n            var pos = this._getItemsPosition($items, selectedItems);\n\n            // 2) top\n            if (pos === 'Top')\n            {\n                return this._unformatAtSide('before', selectedItems, $list);\n            }\n\n            // 3) bottom\n            else if (pos === 'Bottom')\n            {\n                selectedItems.reverse();\n                return this._unformatAtSide('after', selectedItems, $list);\n            }\n\n            // 4) middle\n            else if (pos === 'Middle')\n            {\n                var $last = $R.dom(selectedItems[selectedItems.length-1]);\n\n                var ci = false;\n\n                var $parent = false;\n                var $secondList = $R.dom('<' + $list.get().tagName.toLowerCase() + '>');\n                $items.each(function(node)\n                {\n                    if (ci)\n                    {\n                        var $node = $R.dom(node);\n                        if ($node.closest('.redactor-split-item').length === 0 && ($parent === false || $node.closest($parent).length === 0))\n                        {\n                            $node.addClass('redactor-split-item');\n                        }\n\n                        $parent = $node;\n                    }\n\n                    if (node === $last.get())\n                    {\n                        ci = true;\n                    }\n                });\n\n                $items.filter('.redactor-split-item').each(function(node)\n                {\n                    var $node = $R.dom(node);\n                    $node.removeClass('redactor-split-item');\n                    $secondList.append(node);\n                });\n\n                $list.after($secondList);\n\n                selectedItems.reverse();\n                for (var i = 0; i < selectedItems.length; i++)\n                {\n                    var $item = $R.dom(selectedItems[i]);\n                    var $container = this._createUnformatContainer($item);\n\n                    $list.after($container);\n                    $container.find('ul, ol').remove();\n                    $item.remove();\n                }\n\n\n                return;\n            }\n\n        }\n        else\n        {\n            // unformat all\n            for (var i = 0; i < nodes.length; i++)\n            {\n                if (nodes[i].nodeType !== 3 && nodes[i].tagName.toLowerCase() === type)\n                {\n                    this._unformatEntire(nodes[i]);\n                }\n            }\n        }\n    },\n    _unformatEntire: function(list)\n    {\n        var $list = $R.dom(list);\n        var $items = $list.find('li');\n        $items.each(function(node)\n        {\n            var $item = $R.dom(node);\n            var $container = this._createUnformatContainer($item);\n\n            $item.remove();\n            $list.before($container);\n\n        }.bind(this));\n\n        $list.remove();\n    },\n    _unformatAtSide: function(type, selectedItems, $list)\n    {\n        for (var i = 0; i < selectedItems.length; i++)\n        {\n            var $item = $R.dom(selectedItems[i]);\n            var $container = this._createUnformatContainer($item);\n\n            $list[type]($container);\n\n            var $innerLists = $container.find('ul, ol').first();\n            $item.append($innerLists);\n\n            $innerLists.each(function(node)\n            {\n                var $node = $R.dom(node);\n                var $parent = $node.closest('li');\n\n                if ($parent.get() === selectedItems[i])\n                {\n                    $node.unwrap();\n                    $parent.addClass('r-unwrapped');\n                }\n\n            });\n\n            if (this.utils.isEmptyHtml($item.html())) $item.remove();\n        }\n\n        // clear empty\n        $list.find('.r-unwrapped').each(function(node)\n        {\n            var $node = $R.dom(node);\n            if ($node.html().trim() === '') $node.remove();\n            else $node.removeClass('r-unwrapped');\n        });\n    },\n    _getItemsPosition: function($items, selectedItems)\n    {\n        var pos = 'Middle';\n\n        var sFirst = selectedItems[0];\n        var sLast = selectedItems[selectedItems.length-1];\n\n        var first = $items.first().get();\n        var last = $items.last().get();\n\n        if (first === sFirst && last !== sLast)\n        {\n            pos = 'Top';\n        }\n        else if (first !== sFirst && last === sLast)\n        {\n            pos = 'Bottom';\n        }\n\n        return pos;\n    },\n    _createUnformatContainer: function($item)\n    {\n        var $container = $R.dom('<' + this.opts.markup + '>');\n        if (this.opts.breakline) $container.attr('data-redactor-tag', 'br');\n\n        $container.append($item.contents());\n\n        return $container;\n    },\n    _getBlocks: function()\n    {\n        return this.selection.getBlocks({ first: true });\n    },\n    _observeButton: function()\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var isDisabled = (data.isPre() || data.isCode() || data.isFigcaption());\n\n        this._observeButtonsList(isDisabled, ['lists', 'ul', 'ol', 'outdent', 'indent']);\n\n        var itemOutdent = this.toolbar.getButton('outdent');\n        var itemIndent = this.toolbar.getButton('indent');\n\n        this._observeIndent(itemIndent, itemOutdent);\n    },\n    _observeDropdown: function(dropdown)\n    {\n        var itemOutdent = dropdown.getItem('outdent');\n        var itemIndent = dropdown.getItem('indent');\n\n        this._observeIndent(itemIndent, itemOutdent);\n    },\n    _observeIndent: function(itemIndent, itemOutdent)\n    {\n        var isCollapsed = this.selection.isCollapsed();\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var item = (data.isList()) ? data.getListItem() : false;\n        var $item = $R.dom(item);\n        var $prev = $item.prevElement();\n        var prev = $prev.get();\n        var isIndent = (isCollapsed && item && prev && prev.tagName === 'LI');\n\n        if (itemOutdent)\n        {\n            if (item && isCollapsed) itemOutdent.enable();\n            else itemOutdent.disable();\n        }\n\n        if (itemIndent)\n        {\n            if (item && isIndent) itemIndent.enable();\n            else itemIndent.disable();\n        }\n    },\n    _observeButtonsList: function(param, buttons)\n    {\n        for (var i = 0; i < buttons.length; i++)\n        {\n            var button = this.toolbar.getButton(buttons[i]);\n            if (button)\n            {\n                if (param) button.disable();\n                else button.enable();\n            }\n        }\n    }\n});\n$R.add('class', 'video.component', {\n    mixins: ['dom', 'component'],\n    init: function(app, el)\n    {\n        this.app = app;\n\n        // init\n        return (el && el.cmnt !== undefined) ? el : this._init(el);\n    },\n\n    // private\n    _init: function(el)\n    {\n        if (typeof el !== 'undefined')\n        {\n            var $node = $R.dom(el);\n            var $wrapper = $node.closest('figure');\n            if ($wrapper.length !== 0)\n            {\n                this.parse($wrapper);\n            }\n            else\n            {\n                this.parse('<figure>');\n                this.append(el);\n            }\n        }\n        else\n        {\n            this.parse('<figure>');\n        }\n\n\n        this._initWrapper();\n    },\n    _initWrapper: function()\n    {\n        this.addClass('redactor-component');\n        this.attr({\n            'data-redactor-type': 'video',\n            'tabindex': '-1',\n            'contenteditable': false\n        });\n    }\n});\n\n$R.add('class', 'widget.component', {\n    mixins: ['dom', 'component'],\n    init: function(app, el)\n    {\n        this.app = app;\n\n        // init\n        return (el && el.cmnt !== undefined) ? el : this._init(el);\n    },\n    getData: function()\n    {\n        return {\n            html: this._getHtml()\n        };\n    },\n\n    // private\n    _init: function(el)\n    {\n        if (typeof el !== 'undefined')\n        {\n            var $node = $R.dom(el);\n            var $figure = $node.closest('figure');\n            if ($figure.length !== 0)\n            {\n                this.parse($figure);\n            }\n            else\n            {\n                this.parse('<figure>');\n                this.html(el);\n            }\n        }\n        else\n        {\n            this.parse('<figure>');\n        }\n\n\n        this._initWrapper();\n    },\n    _getHtml: function()\n    {\n        var $wrapper = $R.dom('<div>');\n        $wrapper.html(this.html());\n        $wrapper.find('.redactor-component-caret').remove();\n\n        return $wrapper.html();\n    },\n    _initWrapper: function()\n    {\n        this.addClass('redactor-component');\n        this.attr({\n            'data-redactor-type': 'widget',\n            'tabindex': '-1',\n            'contenteditable': false\n        });\n    }\n});\n\n    window.Redactor = window.$R = $R;\n\n    // Data attribute load\n    window.addEventListener('load', function()\n    {\n        $R('[data-redactor]');\n    });\n\n    // Export for webpack\n    if (typeof module === 'object' && module.exports) {\n        module.exports = Redactor;\n        module.exports.Redactor = Redactor;\n    }\n}());"]}