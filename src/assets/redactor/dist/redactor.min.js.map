{"version":3,"sources":["redactor.js"],"names":["CodeMirror","undefined","jQuery","Ajax","settings","post","options","AjaxRequest","get","request","method","defaults","url","before","success","error","data","async","headers","this","p","extend","toUpperCase","prepareData","xhr","XMLHttpRequest","open","setHeaders","send","prototype","obj1","obj2","name","indexOf","isFormData","toParams","setRequestHeader","window","FormData","isComplete","status","onload","loaded","bind","call","response","parseResponse","json","parseJson","str","o","JSON","parse","e","obj","Object","keys","map","k","encodeURIComponent","join","DomCache","DomExpando","Date","getTime","DomHMClass","Dom","selector","context","ready","fn","document","readyState","addEventListener","sdom","length","nodes","nodeType","childNodes","test","create","_query","_slice","html","createElement","RegExp","$1","elements","container","children","innerHTML","i","l","push","add","concat","_toArray","index","getAll","eq","first","last","contents","each","callback","len","is","filter","node","Node","matches","msMatchesSelector","webkitMatchesSelector","not","find","ns","parent","parentNode","parents","_getContext","closest","isNode","next","_getSibling","nextElement","prev","prevElement","css","value","_getHeightOrWidth","getComputedStyle","key","style","attr","checked","_getBooleanFromStr","getAttribute","setAttribute","reDataAttr","attrs","attributes","replacer","g","nodeName","dataName","match","val","replace","_isObjectString","_toObject","_isNumber","parseFloat","el","type","removeAttr","split","forEach","removeAttribute","removeData","dataset","dataindex","dataget","cacheIndex","nextCacheIndex","addClass","_eachClass","removeClass","toggleClass","hasClass","some","classList","contains","empty","append","text","textContent","after","_inject","frag","insertAdjacentHTML","reverse","s","insertBefore","nextSibling","elms","appendChild","prepend","firstChild","wrap","wrapper","unwrap","$node","replaceWith","docFrag","createDocumentFragment","result","replaceChild","remove","removeChild","clone","events","copy","_clone","_cloneEvents","show","_hasDisplayNone","target","isHidden","isHiddenMobile","display","hide","scrollTop","isWindow","isDocument","scrollingElement","body","documentElement","pageYOffset","scrollTo","offset","_getDim","position","width","adjust","_getSize","height","outerWidth","_getInnerOrOuter","outerHeight","innerWidth","innerHeight","click","_triggerEvent","focus","trigger","names","ev","CustomEvent","bubbles","cancelable","createEvent","initCustomEvent","dispatchEvent","on","handler","one","event","_getEventName","namespace","_getEventNamespace","_getOneHandler","_e","off","testEvent","testNamespace","testEventNamespace","testPositive","_offEvent","serialize","asObject","disabled","z","opt","selected","_toParams","ajax","_queryContext","querySelectorAll","element","getElementById","slice","getElementsByClassName","getElementsByTagName","querySelector","res","_events","cloneNode","self","apply","arguments","arr","condition","handlers","toString","removeEventListener","splice","_getDocSize","Math","max","captype","round","_adjustResultHeightOrWidth","charAt","$el","$targets","fixStyle","tmp","thisStyle","fix","isBorderBox","boxSizing","borderTopWidth","borderBottomWidth","marginTop","marginBottom","borderLeftWidth","borderRightWidth","marginLeft","marginRight","top","left","_getPosition","offsetTop","offsetLeft","_getOffset","rect","getBoundingClientRect","doc","ownerDocument","docElem","win","defaultView","clientTop","pageXOffset","clientLeft","sibling","NodeList","params","_encodeUri","Function","isNaN","search","currentStyle","uuid","$R","RedactorApp","app","version","modules","services","classes","plugins","mixins","modals","lang","dom","keycodes","BACKSPACE","DELETE","UP","DOWN","ENTER","SPACE","ESC","TAB","CTRL","META","SHIFT","ALT","RIGHT","LEFT","env","plugin","module","service","class","mixin","redactor","toArray","args","instance","Array","isArray","isApi","App","methodValue","isDestroy","unshift","api","translations","F","inherit","addLang","init","current","f","prop","__lookupGetter__","__defineGetter__","super","exception","extended","deep","merge","hasOwnProperty","opts","animation","direction","spellcheck","structure","scrollTarget","styles","stylesClass","placeholder","source","showSource","inline","breakline","markup","enterKey","clickToEdit","clickToSave","clickToCancel","focusEnd","minHeight","maxHeight","maxWidth","callbacks","preClass","preSpaces","tabindex","tabAsSpaces","tabKey","autosave","autosaveName","autosaveData","autosaveMethod","toolbar","toolbarFixed","toolbarFixedTarget","toolbarFixedTopOffset","toolbarExternal","toolbarContext","air","formatting","formattingAdd","formattingHide","buttons","buttonsTextLabeled","buttonsAdd","buttonsAddFirst","buttonsAddAfter","buttonsAddBefore","buttonsHide","buttonsHideOnMobile","imageUpload","imageUploadParam","imageData","imageEditable","imageCaption","imageLink","imagePosition","imageResizable","imageFloatMargin","imageFigure","imageObserve","imageSrcData","fileUpload","fileUploadParam","fileData","fileAttachment","uploadData","dragUpload","multipleUpload","clipboardUpload","uploadBase64","linkTarget","linkTitle","linkNewTab","linkNofollow","linkSize","linkValidation","cleanOnEnter","cleanInlineOnEnter","paragraphize","removeScript","removeNewLines","removeComments","replaceTags","b","strike","pastePlainText","pasteLinkTarget","pasteImages","pasteLinks","pasteClean","pasteKeepStyle","pasteKeepClass","pasteKeepAttrs","pasteBlockTags","pasteInlineTags","activeButtons","strong","em","del","u","activeButtonsAdd","activeButtonsObservers","autoparse","autoparseStart","autoparsePaste","autoparseLinks","autoparseImages","autoparseVideo","autoparseHttps","shortcodes","p.","format","quote.","pre.","h1.","h2.","h3.","h4.","h5.","h6.","*.","shortcodesAdd","shortcuts","ctrl+shift+m, meta+shift+m","ctrl+b, meta+b","ctrl+i, meta+i","ctrl+u, meta+u","ctrl+h, meta+h","ctrl+l, meta+l","ctrl+k, meta+k","ctrl+alt+0, meta+alt+0","ctrl+alt+1, meta+alt+1","ctrl+alt+2, meta+alt+2","ctrl+alt+3, meta+alt+3","ctrl+alt+4, meta+alt+4","ctrl+alt+5, meta+alt+5","ctrl+alt+6, meta+alt+6","ctrl+shift+7, meta+shift+7","ctrl+shift+8, meta+shift+8","shortcutsAdd","grammarly","notranslate","bufferLimit","emptyHtml","markerChar","imageTypes","imageAttrs","inlineTags","blockTags","regex","youtube","vimeo","imageurl","aurl1","aurl2","input","zindex","modes","original","image","file","link","bold","italic","deleted","underline","superscript","subscript","bold-abbr","italic-abbr","deleted-abbr","underline-abbr","superscript-abbr","subscript-abbr","lists","link-insert","link-edit","link-in-new-tab","unlink","cancel","close","insert","save","delete","edit","title","paragraph","quote","code","heading1","heading2","heading3","heading4","heading5","heading6","filename","optional","unorderedlist","orderedlist","outdent","indent","horizontalrule","upload","upload-label","accessibility-help-label","caption","bulletslist","numberslist","image-position","none","right","center","undo","redo","icon","dropdown","tag","blockquote","pre","h1","h2","h3","h4","h5","h6","tooltip","sup","sub","observe","ul","ol","line","instances","started","stopped","rootElement","rootOpts","dragInside","dragComponentInside","$win","$doc","$body","editorReadOnly","buildServices","buildModules","buildPlugins","start","broadcast","stop","isStarted","isStopped","core","bindable","inj","isDragInside","setDragInside","isDragComponentInside","setDragComponentInside","getDragComponentInside","isReadOnly","enableReadOnly","component","clearActive","disableButtons","disableReadOnly","enableButtons","callMessageHandler","func","utils","checkProperty","returned","moduleName","cval","isApp","isCallback","isService","isPlugin","isModule","callInstanceMethod","isInstanceExists","Error","buildArgs","applyArgs","selection","_clearAll","clearClass","tags","$elements","getElements","_unwrapSpanWithoutAttr","restore","clearStyle","clearAttr","_removeAllAttr","set","toggle","className","newVal","oldVal","isRgb","rgb2hex","hex2long","toLowerCase","_convertStyleQuotes","removeEmptyAttr","nodeAttr","removeAttributeNode","finalNodes","tagName","cmnt","vars","_build","rebuild","_set","_loop","path","animationOpt","duration","iterate","delay","timing","prefix","AnimatePlay","effect","hidableEffects","prefixes","buildAnimationOff","isInanimate","inanimate","animate","isHidable","buildHideClass","isAnimated","setTimeout","complete","clean","setStart","_setCaret","setEnd","setBefore","setAfter","isStart","_isStartOrEnd","isEnd","setAtEnd","inspector","getTag","range","createRange","_isInPage","textNode","createInvisibleChar","selectNodeContents","collapse","setRange","setAtStart","isInline","insertNode","setAtBefore","setStartBefore","setAtAfter","setStartAfter","setAtPrev","previousSibling","_isEmptyTextNode","previousElementSibling","setAtNext","nextElementSibling","getNode","_setStart","isText","editor","findFirstNode","item","getFirstElement","dataItem","isComponent","getComponent","isComponentType","isFigcaption","findLastNode","table","getTable","tableData","setActive","_setInline","_setEnd","getLastElement","isEmpty","_setBefore","isFirstTableCell","isFirstListItem","getList","isBlock","_setAfter","isLastTableCell","_hasInlineChild","_getStartEndNode","trimSpaces","isComponentEditable","end","size","pos","getFirstNode","getLastNode","isInlineTag","trim","removeInvisibleChars","getFigcaption","isTable","isList","containsNode","getSelection","Selection","anchorNode","finalnode","focusNode","rectSelection","getRangeAt","rectBlock","sel","getElement","isCollapsed","getRange","isBackwards","backwards","anchorOffset","focusOffset","collapsed","detach","isIn","getCurrent","block","getBlock","blocks","getBlocks","isTableCellTag","isAll","isEditor","isNonEditable","isActive","output","getHtml","getText","hasNonEditable","$wrapper","removeAllRanges","addRange","setAll","saveScroll","disableNonEditables","marker","build","restoreMarkers","getComponentCodeElement","enableNonEditables","restoreScroll","rangeCount","getTextBeforeCaret","num","cloneRange","getTextAfterCaret","clonedRange","endContainer","endOffset","getPosition","startOffset","startContainer","bottom","getActive","getParent","isElement","isInEditor","getInline","_isInlineNode","getInlineFirst","getInlineAll","inlines","isBlockTag","getInlinesAllSelected","getInlines","all","inside","_isTextSelected","_filterNodesByTags","getNodes","filteredNodes","_isInNodesArray","_filterInlinesInside","_filterBlocksFirst","textnodes","activeComponent","_getNodesComponent","_getRangeSelectedNodes","_filterServicesNodes","_filterEditor","_filterNodesTexts","_filterNodesElements","cloneContents","cleaner","clear","collapseToStart","collapseToEnd","saveActiveComponent","savedComponent","restoreActiveComponent","_clearSaved","saved","savedElement","caret","saveMarkers","_getNextNode","hasChildNodes","startNode","endNode","$editor","getChildNodes","commonAncestorContainer","skip","keepbr","passtexts","nodeTag","isFirst","isCellParent","escapeRegExp","$element","_buildType","isType","getType","scrolltop","pasting","isFocus","_isContenteditableFocus","startFocus","endFocus","isPasting","enablePasting","disablePasting","_getScrollTarget","scrolltopin","$noneditables","isSourceMode","keeplists","isEmptyHtml","$active","activeElement","setEmpty","editableElement","$target","$container","$source","content","_buildName","_buildStartedContent","getCode","getName","getStartedContent","setCode","insertion","isNameGenerated","rebuildStartedContent","sourceElement","$statusbar","items","update","$item","getItems","removeItems","dropdownOpened","buttonsObservers","_extendActiveButtons","stopObservers","$toolbar","button","observer","setButtonsInactive","getButton","currents","_inlinesToTags","detector","isMobile","isAir","isFixed","isContextBar","isTarget","getWrapper","getDropdown","getTargetElement","$btn","_findButton","getButtons","_findButtons","getButtonsKeys","addButton","btnObj","$button","addButtonFirst","addButtonAfter","addButtonBefore","addButtonObserver","setButtons","setDropdown","$buttons","setInactive","setButtonsActive","disable","enable","_init","isDisabled","hasIcon","message","setMessage","setApi","setTitle","alt","aria-label","setTooltip","setIcon","$icon","_buildTooltip","hideTooltip","preventDefault","_parseTitle","_parseTooltip","_buildCallback","_buildAttributes","_buildObserver","_buildIcon","href","rel","role","isHtml","isDesktop","created","$items","isOpened","$dropdown","getItem","getItemsByClass","classname","_closeAll","_observe","_handleKeyboard","updatePosition","_isButton","_close","btnHeight","btnWidth","leftPos","cropHeight","_buildDom","_buildItems","_buildFormattingItems","which","$span","getTitle","storedComponents","storedComments","storedImages","storedLinks","deniedTags","convertRules","unconvertRules","reComments","reSpacedEmpty","reScriptTag","addConvertRules","addUnconvertRules","storeComments","encodeCode","buildWrapper","src","imageattrs","removeAttrs","removeDataSrc","getWrapperHtml","convert","storeComponents","_setSpanAttr","_setStyleCache","removeTags","_removeScriptTag","_replaceScriptTag","_isSpacedEmpty","restoreComponents","_cleanWrapped","restoreComments","removeMarkers","removeInvisibleSpaces","_isParagraphEmpty","removeServiceTagsAndAttrs","removeSpanWithoutAttributes","removeFirstBlockBreaklineInHtml","_unreplaceScriptTag","_setPreClass","_setLinkNofollow","cleanNewLines","unconvert","removeEmptyAttributes","cleanSpacesInPre","tidy","paste","isMsWord","_isHtmlMsWord","_cleanGDocs","_cleanMsWord","lastChild","exceptedTags","removeTagsExcept","$elms","filterStyle","filterClass","filterAttrs","$li","storeLinks","storeImages","getPlainText","_replaceNlToBr","restoreLinks","restoreImages","comments","getFlatText","$div","innerText","replaceToTag","replaceNbspToSpaces","replaceBlocksToBr","removeNl","removeBrAtEnd","denied","re","$0","except","encodeHtml","encodeEntities","encodeAttrSings","_encodeCode","decodeAttrSings","_encodeNode","encoded","decodeEntities","_encodeNodeHtml","encodePhpCode","String","matched","getElementsFromHtml","_storeMatched","_restoreMatched","spaces","floor","$parent","exec","parseInt","_parseWordLists","hasAttribute","lines","space","lastLevel","$list","$listChild","level","txt","listTag","stored","rules","_convertImage","_convertLine","_convertIframe","_convertTable","_convertForm","_convertCode","_convertWidget","_setContenteditableCode","isIe","_acceptExtraRules","_unconvertWidget","_unconvertForm","_unconvertTable","_unconvertImages","_removeTypes","_unconvertBreakTag","_isNonEditable","getRandomId","$link","$figure","_setFigure","_wrapFigure","isVideo","encodeURI","$next","decodeURI","hasFigcaption","hasStyle","$code","remStart","remEnd","paragraphizeTags","_isConverted","_convert","tablemarkup","_storeTags","_trimLinks","_restoreTags","_convertCell","replacement","createTextNode","outerHTML","_trimLink","_isDisabled","_isEmptyHtml","userAgent","navigator","isWebkit","isFirefox","v","documentMode","ie","isIpad","trimmed","_getString","_setComponentOffset","charIndex","nodeStack","foundStart","pop","nextCharIndex","_isFigcaptionNext","nodeValue","_extendTags","_isTag","isHeadingTag","$component","getComponentType","isComponentActive","isPre","getPre","isCode","_getLastOrFirstListItem","isLastListItem","_getLastOrFirstTableCell","isHeading","getHeading","isBlockquote","getBlockquote","isDl","getDl","isParagraph","getParagraph","isLink","getLink","isFile","getFile","hasParent","_getClosestNode","getParentList","_getClosestUpNode","getListItem","getTableCell","$td","getImageElement","_getClosestElement","list","id","_getPos","buildHtml","side","atStart","cloned","setEndBefore","$context","$marker","_restoreInject","activeClass","findSiblings","cell","_find","$caret","_buildCaret","setOnEvent","contextmenu","executeScripts","scripts","$script","instgrm","Embeds","process","head","fragment","isFragment","createFragment","_collapseSelection","_insertFragment","_sendNodes","insertBreakLine","insertNewline","insertText","insertHtml","insertChar","charhtml","insertRaw","insertToEnd","lastNode","$lastNode","$newNode","insertPoint","markerInserted","x","clientX","y","clientY","caretPositionFromPoint","offsetNode","caretRangeFromPoint","insertToPoint","point","insertToOffset","parsedInput","parseHtml","_insertToAllSelected","dataCurrent","_getCleanedInput","isFigure","_isFigure","isComponentSpan","_isComponentSpan","isInsertedText","_insertToEmptyEditor","_insertToWidget","_insertToInline","splitNode","_insertToCode","_insertToPre","_isPlainHtml","deleteContents","_hasBlocksAndImages","_containsTags","_buildList","insertedHtml","dataInserted","normalizeTextNodes","isLastInline","_isLastInline","ucfirst","isPreformatted","_getContainer","createTmpContainer","parentListTag","_hasFigureOrTable","_hasBlocks","_isHtmlString","_format","_apply","clearFormat","_clear","_getBlocks","_isToggleFormatType","replacedTag","_getReplacedTag","_replaceBlocks","_buildNodes","_restoreSelection","_getElements","finalBlocks","_isStandardParagraph","_isStandardDiv","_isBreaklineBlock","count","_isCurrentBlockOneAndEmpty","_applyArgs","_combinePre","_cleanBlocks","combinedNodes","$current","newline","headings","_cleanEmptyClass","_cleanEmptyStyle","keepStyleAndClass","keepAttrs","_isFormat","arrangeTag","formatCollapsed","formatUncollapsed","replaced","$secondPart","extractedContent","$inline","dataInline","hasSameArgs","insertInline","extractHtmlFromCaret","cloneAttributes","$breaked","$last","same","nodeAttrValue","origRules","styleToObj","innerCount","ruleName","ruleValue","_convertTags","_convertToStrike","execCommand","_clearDecoration","_revertToInlines","_clearEmptyStyle","_normalizeBlocks","_revertTags","_replaceToStrike","_forceRemoveClass","removeFromArrayByValue","textDecoration","textDecorationLine","_clearEmptyStyleAttr","$objects","$object","_isKey","reTags","imagesMatches","https","$video","_formatLinks","_restoreReplaced","enter","_convertToRegExp","$img","setSrc","$cloned","classstr","_subLinkText","substring","decodeURIComponent","observeImages","_addImage","observeFiles","_addFile","setStatus","getChanges","searchInvisibleChars","trimInvisibleChars","firstNode","n","div","extractContents","createMarkup","createMarkupBefore","exclude","elems","thisArg","newArr","recursive","nestedNodes","getChildElements","_getFirst","_getLast","$replaced","ax","a","elFrom","elTo","rule","extendData","serializedData","_setData","normalize","rgb","possible","random","$box","$bar","_is","_destroy","onstart","_startStop","onstop","onenable","ondisable","_buildModes","_buildMarkup","_redefineOptions","_isRootOption","autoparser","onenablefocus","_enableFocus","oncontextmenu","onclick","onkeyup","onenablereadonly","_enableReadOnly","ondisablereadonly","_disableReadOnly","onautoparseobserve","onplaceholder","_buildPlaceholder","_togglePlacehodler","_buildEvents","_buildOptions","_buildAccesibility","classesEditor","_destroyEvents","contenteditable","_disableBrowsersEditing","max-width","margin","aria-labelledby","_enableFocusSource","_enableFocusEditor","setSelectionRange","attachEvent","returnValue","destroy","_getEditables","blurNamespace","eventsList","isFocused","isBlured","blur","targets","stopBlur","cut","_passSelectionToClipboard","drop","originalEvent","stopPropagation","_removeOverClass","$dragComponent","dataTransfer","getData","dragenter","dragstart","_setDragData","dragover","dragleave","detail","pad","pageY","keydown","keyup","mouseup","touchstart","_passAllToClipboard","clipboard","clipboardData","setData","dt","effectAllowed","$label","aria-hidden","syncedHtml","onstartcode","sourceContent","startContent","syncContent","onstartcodeshow","ontrytosync","sync","onhardsync","_syncing","_buildClasses","editorHeight","_onChangedSource","_onTabKey","_onFocus","codemirror","codemirrorSrc","fromTextArea","setSize","cm","changeObj","_disableButtons","_setActiveSourceButton","getValue","toTextArea","_enableButtons","_setInactiveSourceButton","_isSync","timeout","clearTimeout","keyCode","selectionStart","selectionEnd","observerUnit","MutationObserver","subtree","childList","characterData","characterDataOldValue","disconnect","mutations","mutation","onstartclicktoedit","_isEnabled","buttonSave","buttonCancel","_setFocus","objected","enabled","statusbar","oncontextbar","$contextbar","_buildPosition","barWidth","barHeight","docScrollTop","targetOffset","leftFix","topFix","_buildTitle","_buildMessage","_toggle","toolbarModule","onsource","resetPosition","opened","createSourceHelper","destroySourceHelper","closed","openSelected","ontoolbar","removeexternal","onobserve","onfocus","_setExternalOnFocus","onsourcefocus","onempty","_buildButtons","_initToolbar","_initButtons","_buildImageButton","_buildFileButton","_buildSourceButton","_buildAdditionalButtons","_buildHiddenButtons","imageManagerJson","btns","_removeExistButtons","setExternal","clicks","$airHelper","_isSelection","_open","_openCmd","_isOpened","dataTarget","isModalTarget","isButtonCall","_doOpen","containerOffset","winWidth","toolbarWidth","isDropdownCall","$fixedTarget","reset","_doFixed","isHeight","toolbarHeight","boxOffset","boxEnd","scrollOffset","bsFix","fixedScrollTimeout","isExternalMultiple","_findToolbars","$toolbars","$external","_buildExternal","_buildFixed","_initExternal","_hideToolbarsExceptFirst","contextbar","_buildWrapper","_buildElement","_initWrapper","data-redactor-type","isCurrentLink","currentText","onmodal","$modal","$form","_setFormData","_setFormFocus","_validateData","_update","_insert","_unlink","onbutton","_observeButton","ondropdown","_observeUnlink","_observeEdit","_getCurrent","$point","_truncateText","_buildCurrent","_getModalData","_getLinks","_resetCurrent","_setLinkData","links","_insertSingle","_removeInSelection","_insertMultiple","$clonedLink","_isCurrentTextChanged","_deleteContents","textContext","isTextChanged","linkData","commands","_isLink","handle","currentLink","setError","getField","reUrl","_get","_get_target","_get_url","_get_title","_get_text","_findDeepestChild","_set_target","_set_text","_escapeHtml","_set_title","_set_url","_cleanUrl","_isMailto","_isUrl","depth","child","childResult","selectionMarkers","$overlay","resize","setWidth","_buildDefaults","_openUrl","_openTemplate","template","_createModal","_buildModalBox","_buildOverlay","_buildModal","_buildModalForm","_buildModalCommands","_broadcast","_buildModalTabs","_opened","_handleEscape","getBody","_handleEnter","_needToClose","_closed","$modalForm","setHeight","$footer","getFooter","_handleCommand","$tabs","_showTab","getForm","isCloseNode","command","getHeader","$modalHeader","$modalBody","$modalFooter","margin-left","windowHeight","$modalClose","_buildClose","_buildHeader","_buildBody","_buildFooter","_buildTemplate","_getFieldEventName","_clearError","clearformat","clearstyle","clearclass","clearattr","onsynced","_send","_complete","lastShiftKey","onpaste","onkeydown","ctrlKey","metaKey","altKey","_selectAll","arrowKeys","isKeys","isArrowKeys","isXKey","isAlphaKeys","shiftKey","_isArrowKey","_isDeleteKey","_isRightLeftKey","_isExitVariable","_isRightDownKey","_isExitOnDownRight","_selectComponent","_isLeftUpKey","_isExitOnUpLeft","_exitPrevElement","isEndEditor","_exitNextElement","isNext","siblingBlock","_selectComponentItem","_removeActiveComponent","_removeAllSelectedTable","_detectVariableOrNonEditable","_traverseBackspace","_traverseDelete","_removeUnwantedStyles","_removeEmptySpans","_removeSpanTagsInHeadings","_removeInlineTagsInPre","isBlockStart","isBlockEnd","isCurrentStart","isCurrentEnd","isCurrentStartSpace","isCurrentEndSpace","_isVariable","_getBlock","dataNext","isNextBlock","$currentList","$first","$lists","$prev","dataPrev","isPrevBlock","$newnode","_replaceBlock","$block","_isNeedToReplaceBlock","_insertBreak","_isExit","_traverse","_disable","$newBlock","isParagraphExit","_isExitableBlock","isBreaklineExit","_isExitableDblBreak","_exitFromElement","blockTag","$variable","_traverseDl","nextDd","nextDt","dd","_clearBlock","_isNeedToCleanBlockStyle","pasteHtml","pointInserted","dropPasted","isRawCode","_isPlainText","files","getAsFile","_insertFiles","isImage","isClipboard","worked","hotkeys","8","9","10","13","16","17","18","19","20","27","32","33","34","35","36","37","38","39","40","45","46","59","61","96","97","98","99","100","101","102","103","104","105","106","107","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","144","145","173","186","187","188","189","190","191","192","219","220","221","222","hotkeysShiftNums","`","1","2","3","4","5","6","7","0","-","=",";","'",",",".","/","\\","_handler","special","character","fromCharCode","modif","cmdKeys","specialKey","_insertHardTab","_tabCode","progress","paramName","_buildInput","_buildBox","$uploadbox","box","_onDropBox","_onDragOver","_onDragLeave","$placeholder","_onChange","_onClick","_onDrop","_setStatusDrop","_setStatusHover","_removeStatusHover","_setStatusError","_setStatusSuccess","_getUploadParam","_buildData","_sendData","Promise","$pre","_initElement","onform","_remove","imageedit","storage","justResized","oninsert","_observeImages","onstarted","resizer","ondropimage","onbottomclick","onimageresizer","onupload","_uploadError","_change","imagedrop","imagereplace","_setUpload","$image","_save","onimage","resized","_isImage","multiple","_createImageAndStore","inserted","_removeSpaceBeforeFigure","img","_removeInvisibleSpace","align","modal","changeImage","$previewBox","_setReplaceUpload","_buildPreview","_buildPreviewUpload","$preview","$previewImg","$desc","_set_src","_set_id","_set_caption","$figcaption","_set_align","imageFloat","imageMargin","textAlign","positions","alignClass","float","margin-right","text-align","_set_link","_findLink","_get_src","_get_id","_get_caption","_get_align","_get_link","_setResizerPosition","$resizableBox","$resizableImage","$resizer","topOffset","leftOffset","resizerWidth","resizerHeight","resizeHandle","pageX","ratio","h","targetTouches","_start","_move","_stop","_getResizableBoxWidth","ondropfile","filedrop","$file","_createFileAndStore","_insertAsAttachment","wrapAttachment","modalFormData","_truncateUrl","$remover","removeAttachment","$a","state","passed","keyPressed","undoStorage","redoStorage","_listen","onsyncing","onbuffer","onstate","_isUndo","_isRedo","_saveState","_setUndo","_getUndo","_getRedo","ctrl","cmd","_hasUndo","_removeOverStorage","_setRedo","buffer","_hasRedo","_observeDropdown","_isUnformat","_unformat","$prevChild","$newList","nextItems","nextList","$listItem","$liItem","isTop","isMiddle","isBottom","_getAllNext","_createUnformatContainer","$childList","countLists","_uniteBlocks","_createList","_createListItem","$oldList","lastcell","$cell","_isUniteBlock","selectedItems","_unformatEntire","_getItemsPosition","_unformatAtSide","ci","$secondList","$innerLists","sFirst","sLast","_observeButtonsList","itemOutdent","itemIndent","_observeIndent","isIndent","param","_getHtml","Redactor","exports"],"mappings":"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","file":"redactor.min.js","sourcesContent":["/*\n    Redactor\n    Version 3.5.2\n    Updated: October 7, 2021\n\n    http://imperavi.com/redactor/\n\n    Copyright (c) 2009-2021, Imperavi Ltd.\n    License: http://imperavi.com/redactor/license/\n*/\nif (typeof CodeMirror === 'undefined') { var CodeMirror = undefined; }\nif (typeof jQuery === 'undefined') { var jQuery = undefined; }\n(function() {\nvar Ajax = {};\n\nAjax.settings = {};\nAjax.post = function(options) { return new AjaxRequest('post', options); };\nAjax.get = function(options) { return new AjaxRequest('get', options); };\nAjax.request = function(method, options) { return new AjaxRequest(method, options); };\n\nvar AjaxRequest = function(method, options)\n{\n    var defaults = {\n        method: method,\n        url: '',\n        before: function() {},\n        success: function() {},\n        error: function() {},\n        data: false,\n        async: true,\n        headers: {}\n    };\n\n    this.p = this.extend(defaults, options);\n    this.p = this.extend(this.p, Ajax.settings);\n    this.p.method = this.p.method.toUpperCase();\n\n    this.prepareData();\n\n    this.xhr = new XMLHttpRequest();\n    this.xhr.open(this.p.method, this.p.url, this.p.async);\n\n    this.setHeaders();\n\n    var before = (typeof this.p.before === 'function') ? this.p.before(this.xhr) : true;\n    if (before !== false)\n    {\n        this.send();\n    }\n};\n\nAjaxRequest.prototype = {\n    extend: function(obj1, obj2)\n    {\n        if (obj2) for (var name in obj2) { obj1[name] = obj2[name]; }\n        return obj1;\n    },\n    prepareData: function()\n    {\n        if (['POST', 'PUT'].indexOf(this.p.method) !== -1 && !this.isFormData()) this.p.headers['Content-Type'] = 'application/x-www-form-urlencoded';\n        if (typeof this.p.data === 'object' && !this.isFormData()) this.p.data = this.toParams(this.p.data);\n        if (this.p.method === 'GET') this.p.url = (this.p.data) ? this.p.url + '?' + this.p.data : this.p.url;\n    },\n    setHeaders: function()\n    {\n        this.xhr.setRequestHeader('X-Requested-With', this.p.headers['X-Requested-With'] || 'XMLHttpRequest');\n        for (var name in this.p.headers)\n        {\n            this.xhr.setRequestHeader(name, this.p.headers[name]);\n        }\n    },\n    isFormData: function()\n    {\n        return (typeof window.FormData !== 'undefined' && this.p.data instanceof window.FormData);\n    },\n    isComplete: function()\n    {\n        return !(this.xhr.status < 200 || (this.xhr.status >= 300 && this.xhr.status !== 304));\n    },\n    send: function()\n    {\n        if (this.p.async)\n        {\n            this.xhr.onload = this.loaded.bind(this);\n            this.xhr.send(this.p.data);\n        }\n        else\n        {\n            this.xhr.send(this.p.data);\n            this.loaded.call(this);\n        }\n    },\n    loaded: function()\n    {\n        if (this.isComplete())\n        {\n            var response = this.parseResponse();\n            if (typeof this.p.success === 'function') this.p.success(response, this.xhr);\n        }\n        else\n        {\n            var response = this.parseResponse();\n            if (typeof this.p.error === 'function') this.p.error(response, this.xhr, this.xhr.status);\n        }\n    },\n    parseResponse: function() {\n        var response = this.xhr.response;\n        var json = this.parseJson(response);\n        return (json) ? json : response;\n    },\n    parseJson: function(str)\n    {\n        try {\n            var o = JSON.parse(str);\n            if (o && typeof o === 'object')\n            {\n                return o;\n            }\n\n        } catch (e) {}\n\n        return false;\n    },\n    toParams: function (obj)\n    {\n        return Object.keys(obj).map(\n            function(k){ return encodeURIComponent(k) + '=' + encodeURIComponent(obj[k]); }\n        ).join('&');\n    }\n};\nvar DomCache = [0];\nvar DomExpando = 'data' + new Date().getTime();\nvar DomHClass = 'is-hidden';\nvar DomHMClass = 'is-hidden-mobile';\n\nvar Dom = function(selector, context)\n{\n    return this.parse(selector, context);\n};\n\nDom.ready = function(fn)\n{\n    if (document.readyState !== 'loading') fn();\n    else document.addEventListener('DOMContentLoaded', fn);\n};\n\nDom.prototype = {\n    get sdom()\n    {\n        return true;\n    },\n    get length()\n    {\n        return this.nodes.length;\n    },\n    parse: function(selector, context)\n    {\n        var nodes;\n        var reHtmlTest = /^\\s*<(\\w+|!)[^>]*>/;\n\n        if (!selector)\n        {\n            nodes = [];\n        }\n        else if (selector.sdom)\n        {\n            this.nodes = selector.nodes;\n            return selector;\n        }\n        else if (typeof selector !== 'string')\n        {\n            if (selector.nodeType && selector.nodeType === 11)\n            {\n                nodes = selector.childNodes;\n            }\n            else\n            {\n                nodes = (selector.nodeType || selector === window) ? [selector] : selector;\n            }\n        }\n        else if (reHtmlTest.test(selector))\n        {\n            nodes = this.create(selector);\n        }\n        else\n        {\n            nodes = this._query(selector, context);\n        }\n\n        this.nodes = this._slice(nodes);\n    },\n    create: function(html)\n    {\n        if (/^<(\\w+)\\s*\\/?>(?:<\\/\\1>|)$/.test(html))\n        {\n            return [document.createElement(RegExp.$1)];\n        }\n\n        var elements = [];\n        var container = document.createElement('div');\n        var children = container.childNodes;\n\n        container.innerHTML = html;\n\n        for (var i = 0, l = children.length; i < l; i++)\n        {\n            elements.push(children[i]);\n        }\n\n        return elements;\n    },\n\n    // add\n    add: function(nodes)\n    {\n        this.nodes = this.nodes.concat(this._toArray(nodes));\n    },\n\n    // get\n    get: function(index)\n    {\n        return this.nodes[(index || 0)] || false;\n    },\n    getAll: function()\n    {\n        return this.nodes;\n    },\n    eq: function(index)\n    {\n        return new Dom(this.nodes[index]);\n    },\n    first: function()\n    {\n        return new Dom(this.nodes[0]);\n    },\n    last: function()\n    {\n        return new Dom(this.nodes[this.nodes.length - 1]);\n    },\n    contents: function()\n    {\n        return this.get().childNodes;\n    },\n\n    // loop\n    each: function(callback)\n    {\n        var len = this.nodes.length;\n        for (var i = 0; i < len; i++)\n        {\n            callback.call(this, (this.nodes[i].sdom) ? this.nodes[i].get() : this.nodes[i], i);\n        }\n\n        return this;\n    },\n\n    // traversing\n    is: function(selector)\n    {\n        return (this.filter(selector).length > 0);\n    },\n    filter: function (selector)\n    {\n        var callback;\n        if (selector === undefined)\n        {\n            return this;\n        }\n        else if (typeof selector === 'function')\n        {\n            callback = selector;\n        }\n        else\n        {\n            callback = function(node)\n            {\n                if (selector instanceof Node)\n                {\n                    return (selector === node);\n                }\n                else if (selector && selector.sdom)\n                {\n                    return ((selector.nodes).indexOf(node) !== -1);\n                }\n                else\n                {\n                    node.matches = node.matches || node.msMatchesSelector || node.webkitMatchesSelector;\n                    return (node.nodeType === 1) ? node.matches(selector || '*') : false;\n                }\n            };\n        }\n\n        return new Dom(this.nodes.filter(callback));\n    },\n    not: function(filter)\n    {\n        return this.filter(function(node)\n        {\n            return !new Dom(node).is(filter || true);\n        });\n    },\n    find: function(selector)\n    {\n        var nodes = [];\n        this.each(function(node)\n        {\n            var ns = this._query(selector || '*', node);\n            for (var i = 0; i < ns.length; i++)\n            {\n                nodes.push(ns[i]);\n            }\n        });\n\n        return new Dom(nodes);\n    },\n    children: function(selector)\n    {\n        var nodes = [];\n        this.each(function(node)\n        {\n            if (node.children)\n            {\n                var ns = node.children;\n                for (var i = 0; i < ns.length; i++)\n                {\n                    nodes.push(ns[i]);\n                }\n            }\n        });\n\n        return new Dom(nodes).filter(selector);\n    },\n    parent: function(selector)\n    {\n        var nodes = [];\n        this.each(function(node)\n        {\n            if (node.parentNode) nodes.push(node.parentNode);\n        });\n\n        return new Dom(nodes).filter(selector);\n    },\n    parents: function(selector, context)\n    {\n        context = this._getContext(context);\n\n        var nodes = [];\n        this.each(function(node) {\n            var parent = node.parentNode;\n            while (parent && parent !== context) {\n                if (selector) {\n                    if (new Dom(parent).is(selector)) { nodes.push(parent); }\n                }\n                else {\n                    nodes.push(parent);\n                }\n                parent = parent.parentNode;\n            }\n        });\n\n        return new Dom(nodes);\n\n    },\n    closest: function(selector, context)\n    {\n        context = this._getContext(context);\n        selector = (selector.sdom) ? selector.get() : selector;\n\n        var nodes = [];\n        var isNode = (selector && selector.nodeType);\n        this.each(function(node)\n        {\n            do {\n                if ((isNode && node === selector) || new Dom(node).is(selector)) return nodes.push(node);\n            } while ((node = node.parentNode) && node !== context);\n        });\n\n        return new Dom(nodes);\n    },\n    next: function(selector)\n    {\n         return this._getSibling(selector, 'nextSibling');\n    },\n    nextElement: function(selector)\n    {\n        return this._getSibling(selector, 'nextElementSibling');\n    },\n    prev: function(selector)\n    {\n        return this._getSibling(selector, 'previousSibling');\n    },\n    prevElement: function(selector)\n    {\n        return this._getSibling(selector, 'previousElementSibling');\n    },\n\n    // css\n    css: function(name, value)\n    {\n        if (value === undefined && (typeof name !== 'object'))\n        {\n            var node = this.get();\n            if (name === 'width' || name === 'height')\n            {\n                return (node.style) ? this._getHeightOrWidth(name, node, false) + 'px' : undefined;\n            }\n            else\n            {\n                return (node.style) ? getComputedStyle(node, null)[name] : undefined;\n            }\n        }\n\n        // set\n        return this.each(function(node)\n        {\n            var obj = {};\n            if (typeof name === 'object') obj = name;\n            else obj[name] = value;\n\n            for (var key in obj)\n            {\n                if (node.style) node.style[key] = obj[key];\n            }\n        });\n    },\n\n    // attr\n    attr: function(name, value, data)\n    {\n        data = (data) ? 'data-' : '';\n\n        if (value === undefined && (typeof name !== 'object'))\n        {\n            var node = this.get();\n            if (node && node.nodeType !== 3)\n            {\n                return (name === 'checked') ? node.checked : this._getBooleanFromStr(node.getAttribute(data + name));\n            }\n            else return;\n        }\n\n        // set\n        return this.each(function(node)\n        {\n            var obj = {};\n            if (typeof name === 'object') obj = name;\n            else obj[name] = value;\n\n            for (var key in obj)\n            {\n                if (node.nodeType !== 3)\n                {\n                    if (key === 'checked') node.checked = obj[key];\n                    else node.setAttribute(data + key, obj[key]);\n                }\n            }\n        });\n    },\n    data: function(name, value)\n    {\n        if (name === undefined)\n        {\n            var reDataAttr = /^data-(.+)$/;\n            var attrs = this.get().attributes;\n\n            var data = {};\n            var replacer = function (g) { return g[1].toUpperCase(); };\n\n            for (var key in attrs)\n            {\n                if (attrs[key] && reDataAttr.test(attrs[key].nodeName))\n                {\n                    var dataName = attrs[key].nodeName.match(reDataAttr)[1];\n                    var val = attrs[key].value;\n                    dataName = dataName.replace(/-([a-z])/g, replacer);\n\n                    if (this._isObjectString(val)) val = this._toObject(val);\n                    else val = (this._isNumber(val)) ? parseFloat(val) : this._getBooleanFromStr(val);\n\n                    data[dataName] = val;\n                }\n            }\n\n            return data;\n        }\n\n        return this.attr(name, value, true);\n    },\n    val: function(value)\n    {\n        if (value === undefined)\n        {\n            var el = this.get();\n            if (el.type && el.type === 'checkbox') return el.checked;\n            else return el.value;\n        }\n\n        return this.each(function(node)\n        {\n            node.value = value;\n        });\n    },\n    removeAttr: function(value)\n    {\n        return this.each(function(node)\n        {\n            var rmAttr = function(name) { if (node.nodeType !== 3) node.removeAttribute(name); };\n            value.split(' ').forEach(rmAttr);\n        });\n    },\n    removeData: function(value)\n    {\n        return this.each(function(node)\n        {\n            var rmData = function(name) { if (node.nodeType !== 3) node.removeAttribute('data-' + name); };\n            value.split(' ').forEach(rmData);\n        });\n    },\n\n    // dataset/dataget\n    dataset: function(key, value)\n    {\n        return this.each(function(node)\n        {\n            DomCache[this.dataindex(node)][key] = value;\n        });\n    },\n    dataget: function(key)\n    {\n        return DomCache[this.dataindex(this.get())][key];\n    },\n    dataindex: function(el)\n    {\n        var cacheIndex = el[DomExpando];\n        var nextCacheIndex = DomCache.length;\n\n        if (!cacheIndex)\n        {\n            cacheIndex = el[DomExpando] = nextCacheIndex;\n            DomCache[cacheIndex] = {};\n        }\n\n        return cacheIndex;\n    },\n\n\n    // class\n    addClass: function(value)\n    {\n        return this._eachClass(value, 'add');\n    },\n    removeClass: function(value)\n    {\n        return this._eachClass(value, 'remove');\n    },\n    toggleClass: function(value)\n    {\n        return this._eachClass(value, 'toggle');\n    },\n    hasClass: function(value)\n    {\n        return this.nodes.some(function(node)\n        {\n            return (node.classList) ? node.classList.contains(value) : false;\n        });\n    },\n\n    // html & text\n    empty: function()\n    {\n        return this.each(function(node)\n        {\n            node.innerHTML = '';\n        });\n    },\n    html: function(html)\n    {\n        return (html === undefined) ? (this.get().innerHTML || '') : this.empty().append(html);\n    },\n    text: function(text)\n    {\n        return (text === undefined) ? (this.get().textContent || '') : this.each(function(node) { node.textContent = text; });\n    },\n\n    // manipulation\n    after: function(html)\n    {\n        return this._inject(html, function(frag, node)\n        {\n            if (typeof frag === 'string')\n            {\n                node.insertAdjacentHTML('afterend', frag);\n            }\n            else\n            {\n                if (node.parentNode !== null) {\n                    for (var i = frag instanceof Node ? [frag] : this._toArray(frag).reverse(), s = 0; s < i.length; s++) {\n                        node.parentNode.insertBefore(i[s], node.nextSibling);\n                    }\n                }\n            }\n\n            return node;\n\n        });\n    },\n    before: function(html)\n    {\n        return this._inject(html, function(frag, node)\n        {\n            if (typeof frag === 'string')\n            {\n                node.insertAdjacentHTML('beforebegin', frag);\n            }\n            else\n            {\n                var elms = (frag instanceof Node) ? [frag] : this._toArray(frag);\n                for (var i = 0; i < elms.length; i++)\n                {\n                    node.parentNode.insertBefore(elms[i], node);\n                }\n            }\n\n            return node;\n        });\n    },\n    append: function(html)\n    {\n        return this._inject(html, function(frag, node)\n        {\n            if (typeof frag === 'string' || typeof frag === 'number')\n            {\n                node.insertAdjacentHTML('beforeend', frag);\n            }\n            else\n            {\n                var elms = (frag instanceof Node) ? [frag] : this._toArray(frag);\n                for (var i = 0; i < elms.length; i++)\n                {\n                    node.appendChild(elms[i]);\n                }\n            }\n\n            return node;\n        });\n    },\n    prepend: function(html)\n    {\n        return this._inject(html, function(frag, node)\n        {\n            if (typeof frag === 'string' || typeof frag === 'number')\n            {\n                node.insertAdjacentHTML('afterbegin', frag);\n            }\n            else\n            {\n                var elms = (frag instanceof Node) ? [frag] : this._toArray(frag).reverse();\n                for (var i = 0; i < elms.length; i++)\n                {\n                    node.insertBefore(elms[i], node.firstChild);\n                }\n            }\n\n            return node;\n        });\n    },\n    wrap: function(html)\n    {\n        return this._inject(html, function(frag, node)\n        {\n            var wrapper = (typeof frag === 'string' || typeof frag === 'number') ? this.create(frag)[0] : (frag instanceof Node) ? frag : this._toArray(frag)[0];\n\n            if (node.parentNode)\n            {\n                node.parentNode.insertBefore(wrapper, node);\n            }\n\n            wrapper.appendChild(node);\n\n            return new Dom(wrapper);\n\n        });\n    },\n    unwrap: function()\n    {\n        return this.each(function(node)\n        {\n            var $node = new Dom(node);\n\n            return $node.replaceWith($node.contents());\n        });\n    },\n    replaceWith: function(html)\n    {\n        return this._inject(html, function(frag, node)\n        {\n            var docFrag = document.createDocumentFragment();\n            var elms = (typeof frag === 'string' || typeof frag === 'number') ? this.create(frag) : (frag instanceof Node) ? [frag] : this._toArray(frag);\n\n            for (var i = 0; i < elms.length; i++)\n            {\n                docFrag.appendChild(elms[i]);\n            }\n\n            var result = docFrag.childNodes[0];\n            if (node.parentNode) {\n                node.parentNode.replaceChild(docFrag, node);\n            }\n\n            return result;\n\n        });\n    },\n    remove: function()\n    {\n        return this.each(function(node)\n        {\n            if (node.parentNode) node.parentNode.removeChild(node);\n        });\n    },\n    clone: function(events)\n    {\n        var nodes = [];\n        this.each(function(node)\n        {\n            var copy = this._clone(node);\n            if (events) copy = this._cloneEvents(node, copy);\n            nodes.push(copy);\n        });\n\n        return new Dom(nodes);\n    },\n\n    // show/hide\n    show: function()\n    {\n        return this.each(function(node)\n        {\n            if (!node.style || !this._hasDisplayNone(node)) return;\n\n            var target = node.getAttribute('domTargetShow');\n            var isHidden = (node.classList) ? node.classList.contains(DomHClass) : false;\n            var isHiddenMobile = (node.classList) ? node.classList.contains(DomHMClass) : false;\n            var type;\n\n            if (isHidden)\n            {\n                type = DomHClass;\n                node.classList.remove(DomHClass);\n            }\n            else if (isHiddenMobile)\n            {\n                type = DomHMClass;\n                node.classList.remove(DomHMClass);\n            }\n            else\n            {\n                node.style.display = (target) ? target : 'block';\n            }\n\n            if (type) node.setAttribute('domTargetHide', type);\n            node.removeAttribute('domTargetShow');\n\n        }.bind(this));\n    },\n    hide: function()\n    {\n        return this.each(function(node)\n        {\n            if (!node.style || this._hasDisplayNone(node)) return;\n\n            var display = node.style.display;\n            var target = node.getAttribute('domTargetHide');\n\n            if (target === DomHClass)\n            {\n                node.classList.add(DomHClass);\n            }\n            else if (target === DomHMClass)\n            {\n                node.classList.add(DomHMClass);\n            }\n            else\n            {\n                if (display !== 'block') node.setAttribute('domTargetShow', display);\n                node.style.display = 'none';\n            }\n\n            node.removeAttribute('domTargetHide');\n\n        });\n    },\n\n    // dimensions\n    scrollTop: function(value)\n    {\n        var node = this.get();\n        var isWindow = (node === window);\n        var isDocument = (node.nodeType === 9);\n        var el = (isDocument) ? (document.scrollingElement || document.body.parentNode || document.body || document.documentElement) : node;\n\n        if (value !== undefined)\n        {\n            if (isWindow) window.scrollTo(0, value);\n            else el.scrollTop = value;\n            return;\n        }\n\n        if (isDocument)\n        {\n            return (typeof window.pageYOffset != 'undefined') ? window.pageYOffset : ((document.documentElement.scrollTop) ? document.documentElement.scrollTop : ((document.body.scrollTop) ? document.body.scrollTop : 0));\n        }\n        else\n        {\n            return (isWindow) ? window.pageYOffset : el.scrollTop;\n        }\n    },\n    offset: function()\n    {\n        return this._getDim('Offset');\n    },\n    position: function()\n    {\n        return this._getDim('Position');\n    },\n    width: function(value, adjust)\n    {\n        return this._getSize('width', 'Width', value, adjust);\n    },\n    height: function(value, adjust)\n    {\n        return this._getSize('height', 'Height', value, adjust);\n    },\n    outerWidth: function()\n    {\n        return this._getInnerOrOuter('width', 'outer');\n    },\n    outerHeight: function()\n    {\n        return this._getInnerOrOuter('height', 'outer');\n    },\n    innerWidth: function()\n    {\n        return this._getInnerOrOuter('width', 'inner');\n    },\n    innerHeight: function()\n    {\n        return this._getInnerOrOuter('height', 'inner');\n    },\n\n    // events\n    click: function()\n    {\n        return this._triggerEvent('click');\n    },\n    focus: function()\n    {\n        return this._triggerEvent('focus');\n    },\n    trigger: function(names)\n    {\n        return this.each(function(node)\n        {\n            var events = names.split(' ');\n            for (var i = 0; i < events.length; i++)\n            {\n                var ev;\n                var opts = { bubbles: true, cancelable: true };\n\n                try {\n                    ev = new window.CustomEvent(events[i], opts);\n                } catch(e) {\n                    ev = document.createEvent('CustomEvent');\n                    ev.initCustomEvent(events[i], true, true);\n                }\n\n                node.dispatchEvent(ev);\n            }\n        });\n    },\n    on: function(names, handler, one)\n    {\n        return this.each(function(node)\n        {\n            var events = names.split(' ');\n            for (var i = 0; i < events.length; i++)\n            {\n                var event = this._getEventName(events[i]);\n                var namespace = this._getEventNamespace(events[i]);\n\n                handler = (one) ? this._getOneHandler(handler, names) : handler;\n                node.addEventListener(event, handler);\n\n                node._e = node._e || {};\n                node._e[namespace] = node._e[namespace] || {};\n                node._e[namespace][event] = node._e[namespace][event] || [];\n                node._e[namespace][event].push(handler);\n            }\n\n        });\n    },\n    one: function(events, handler)\n    {\n        return this.on(events, handler, true);\n    },\n    off: function(names, handler)\n    {\n        var testEvent = function(name, key, event) { return (name === event); };\n        var testNamespace = function(name, key, event, namespace) { return (key === namespace); };\n        var testEventNamespace = function(name, key, event, namespace) { return (name === event && key === namespace); };\n        var testPositive = function() { return true; };\n\n        if (names === undefined)\n        {\n            // ALL\n            return this.each(function(node)\n            {\n                this._offEvent(node, false, false, handler, testPositive);\n            });\n        }\n\n        return this.each(function(node)\n        {\n            var events = names.split(' ');\n\n            for (var i = 0; i < events.length; i++)\n            {\n                var event = this._getEventName(events[i]);\n                var namespace = this._getEventNamespace(events[i]);\n\n                // 1) event without namespace\n                if (namespace === '_events') this._offEvent(node, event, namespace, handler, testEvent);\n                // 2) only namespace\n                else if (!event && namespace !== '_events') this._offEvent(node, event, namespace, handler, testNamespace);\n                // 3) event + namespace\n                else this._offEvent(node, event, namespace, handler, testEventNamespace);\n            }\n        });\n    },\n\n    // form\n    serialize: function(asObject)\n    {\n        var obj = {};\n        var elms = this.get().elements;\n        for (var i = 0; i < elms.length; i++)\n        {\n            var el = elms[i];\n            if (/(checkbox|radio)/.test(el.type) && !el.checked) continue;\n            if (!el.name || el.disabled || el.type === 'file') continue;\n\n            if (el.type === 'select-multiple')\n            {\n                for (var z = 0; z < el.options.length; z++)\n                {\n                    var opt = el.options[z];\n                    if (opt.selected) obj[el.name] = opt.value;\n                }\n            }\n\n            obj[el.name] = (this._isNumber(el.value)) ? parseFloat(el.value) : this._getBooleanFromStr(el.value);\n        }\n\n        return (asObject) ? obj : this._toParams(obj);\n    },\n    ajax: function(success, error)\n    {\n        if (typeof AjaxRequest !== 'undefined')\n        {\n            var method = this.attr('method') || 'post';\n            var options = {\n                url: this.attr('action'),\n                data: this.serialize(),\n                success: success,\n                error: error\n            };\n\n            return new AjaxRequest(method, options);\n        }\n    },\n\n    // private\n    _queryContext: function(selector, context)\n    {\n        context = this._getContext(context);\n\n        return (context.nodeType !== 3 && typeof context.querySelectorAll === 'function') ? context.querySelectorAll(selector) : [];\n    },\n    _query: function(selector, context)\n    {\n        if (context)\n        {\n            return this._queryContext(selector, context);\n        }\n        else if (/^[.#]?[\\w-]*$/.test(selector))\n        {\n            if (selector[0] === '#')\n            {\n                var element = document.getElementById(selector.slice(1));\n                return element ? [element] : [];\n            }\n\n            if (selector[0] === '.')\n            {\n                return document.getElementsByClassName(selector.slice(1));\n            }\n\n            return document.getElementsByTagName(selector);\n        }\n\n        return document.querySelectorAll(selector);\n    },\n    _getContext: function(context)\n    {\n        context = (typeof context === 'string') ? document.querySelector(context) : context;\n\n        return (context && context.sdom) ? context.get() : (context || document);\n    },\n    _inject: function(html, fn)\n    {\n        var len = this.nodes.length;\n        var nodes = [];\n        while (len--)\n        {\n            var res = (typeof html === 'function') ? html.call(this, this.nodes[len]) : html;\n            var el = (len === 0) ? res : this._clone(res);\n            var node = fn.call(this, el, this.nodes[len]);\n\n            if (node)\n            {\n                if (node.sdom) nodes.push(node.get());\n                else nodes.push(node);\n            }\n        }\n\n        return new Dom(nodes);\n    },\n    _cloneEvents: function(node, copy)\n    {\n        var events = node._e;\n        if (events)\n        {\n            copy._e = events;\n            for (var name in events._events)\n            {\n                for (var i = 0; i < events._events[name].length; i++)\n                {\n                    copy.addEventListener(name, events._events[name][i]);\n                }\n            }\n        }\n\n        return copy;\n    },\n    _clone: function(node)\n    {\n        if (typeof node === 'undefined') return;\n        if (typeof node === 'string') return node;\n        else if (node instanceof Node || node.nodeType) return node.cloneNode(true);\n        else if ('length' in node)\n        {\n            return [].map.call(this._toArray(node), function(el) { return el.cloneNode(true); });\n        }\n    },\n    _slice: function(obj)\n    {\n        return (!obj || obj.length === 0) ? [] : (obj.length) ? [].slice.call(obj.nodes || obj) : [obj];\n    },\n    _eachClass: function(value, type)\n    {\n        return this.each(function(node)\n        {\n            if (value)\n            {\n                var setClass = function(name) { if (node.classList) node.classList[type](name); };\n                value.split(' ').forEach(setClass);\n            }\n        });\n    },\n    _triggerEvent: function(name)\n    {\n        var node = this.get();\n        if (node && node.nodeType !== 3) node[name]();\n        return this;\n    },\n    _getOneHandler: function(handler, events)\n    {\n        var self = this;\n        return function()\n        {\n            handler.apply(this, arguments);\n            self.off(events);\n        };\n    },\n    _getEventNamespace: function(event)\n    {\n        var arr = event.split('.');\n        var namespace = (arr[1]) ? arr[1] : '_events';\n        return (arr[2]) ? namespace + arr[2] : namespace;\n    },\n    _getEventName: function(event)\n    {\n        return event.split('.')[0];\n    },\n    _offEvent: function(node, event, namespace, handler, condition)\n    {\n        for (var key in node._e)\n        {\n            for (var name in node._e[key])\n            {\n                if (condition(name, key, event, namespace))\n                {\n                    var handlers = node._e[key][name];\n                    for (var i = 0; i < handlers.length; i++)\n                    {\n                        if (typeof handler !== 'undefined' && handlers[i].toString() !== handler.toString())\n                        {\n                            continue;\n                        }\n\n                        node.removeEventListener(name, handlers[i]);\n                        node._e[key][name].splice(i, 1);\n\n                        if (node._e[key][name].length === 0) delete node._e[key][name];\n                        if (Object.keys(node._e[key]).length === 0) delete node._e[key];\n                    }\n                }\n            }\n        }\n    },\n    _getInnerOrOuter: function(method, type)\n    {\n        return this[method](undefined, type);\n    },\n    _getDocSize: function(node, type)\n    {\n        var body = node.body, html = node.documentElement;\n        return Math.max(body['scroll' + type], body['offset' + type], html['client' + type], html['scroll' + type], html['offset' + type]);\n    },\n    _getSize: function(type, captype, value, adjust)\n    {\n        if (value === undefined)\n        {\n            var el = this.get();\n            if (el.nodeType === 3)      value = 0;\n            else if (el.nodeType === 9) value = this._getDocSize(el, captype);\n            else if (el === window)     value = window['inner' + captype];\n            else                        value = this._getHeightOrWidth(type, el, adjust || 'normal');\n\n            return Math.round(value);\n        }\n\n        return this.each(function(node)\n        {\n            value = parseFloat(value);\n            value = value + this._adjustResultHeightOrWidth(type, node, adjust || 'normal');\n\n            new Dom(node).css(type, value + 'px');\n\n        }.bind(this));\n    },\n    _getHeightOrWidth: function(type, el, adjust)\n    {\n        if (!el) return 0;\n\n        var name = type.charAt(0).toUpperCase() + type.slice(1);\n        var result = 0;\n        var style = getComputedStyle(el, null);\n        var $el = new Dom(el);\n        var $targets = $el.parents().filter(function(node)\n        {\n            return (node.nodeType === 1 && getComputedStyle(node, null).display === 'none') ? node : false;\n        });\n\n        if (style.display === 'none') $targets.add(el);\n        if ($targets.length !== 0)\n        {\n            var fixStyle = 'visibility: hidden !important; display: block !important;';\n            var tmp = [];\n\n            $targets.each(function(node)\n            {\n                var $node = new Dom(node);\n                var thisStyle = $node.attr('style');\n                if (thisStyle !== null) tmp.push(thisStyle);\n                $node.attr('style', (thisStyle !== null) ? thisStyle + ';' + fixStyle : fixStyle);\n            });\n\n            result = $el.get()['offset' + name] - this._adjustResultHeightOrWidth(type, el, adjust);\n\n            $targets.each(function(node, i)\n            {\n                var $node = new Dom(node);\n                if (tmp[i] === undefined) $node.removeAttr('style');\n                else $node.attr('style', tmp[i]);\n            });\n        }\n        else\n        {\n            result = el['offset' + name] - this._adjustResultHeightOrWidth(type, el, adjust);\n        }\n\n        return result;\n    },\n    _adjustResultHeightOrWidth: function(type, el, adjust)\n    {\n        if (!el || adjust === false) return 0;\n\n        var fix = 0;\n        var style = getComputedStyle(el, null);\n        var isBorderBox = (style.boxSizing === \"border-box\");\n\n        if (type === 'height')\n        {\n            if (adjust === 'inner' || (adjust === 'normal' && isBorderBox))\n            {\n                fix += (parseFloat(style.borderTopWidth) || 0) + (parseFloat(style.borderBottomWidth) || 0);\n            }\n\n            if (adjust === 'outer') fix -= (parseFloat(style.marginTop) || 0) + (parseFloat(style.marginBottom) || 0);\n        }\n        else\n        {\n            if (adjust === 'inner' || (adjust === 'normal' && isBorderBox))\n            {\n                fix += (parseFloat(style.borderLeftWidth) || 0) + (parseFloat(style.borderRightWidth) || 0);\n            }\n\n            if (adjust === 'outer') fix -= (parseFloat(style.marginLeft) || 0) + (parseFloat(style.marginRight) || 0);\n        }\n\n        return fix;\n    },\n    _getDim: function(type)\n    {\n        var node = this.get();\n        return (node.nodeType === 3) ? { top: 0, left: 0 } : this['_get' + type](node);\n    },\n    _getPosition: function(node)\n    {\n        return { top: node.offsetTop, left: node.offsetLeft };\n    },\n    _getOffset: function(node)\n    {\n        var rect = node.getBoundingClientRect();\n        var doc = node.ownerDocument;\n\t\tvar docElem = doc.documentElement;\n\t\tvar win = doc.defaultView;\n\n\t\treturn {\n\t\t\ttop: rect.top + win.pageYOffset - docElem.clientTop,\n\t\t\tleft: rect.left + win.pageXOffset - docElem.clientLeft\n\t\t};\n    },\n    _getSibling: function(selector, method)\n    {\n        selector = (selector && selector.sdom) ? selector.get() : selector;\n\n        var isNode = (selector && selector.nodeType);\n        var sibling;\n\n        this.each(function(node)\n        {\n            while (node = node[method])\n            {\n                if ((isNode && node === selector) || new Dom(node).is(selector))\n                {\n                    sibling = node;\n                    return;\n                }\n            }\n        });\n\n        return new Dom(sibling);\n    },\n    _toArray: function(obj)\n    {\n        if (obj instanceof NodeList)\n        {\n            var arr = [];\n            for (var i = 0; i < obj.length; i++)\n            {\n                arr[i] = obj[i];\n            }\n\n            return arr;\n        }\n        else if (obj === undefined) return [];\n        else\n        {\n            return (obj.sdom) ? obj.nodes : obj;\n        }\n    },\n    _toParams: function(obj)\n    {\n        var params = '';\n        for (var key in obj)\n        {\n            params += '&' + this._encodeUri(key) + '=' + this._encodeUri(obj[key]);\n        }\n\n        return params.replace(/^&/, '');\n    },\n    _toObject: function(str)\n    {\n        return (new Function(\"return \" + str))();\n    },\n    _encodeUri: function(str)\n    {\n        return encodeURIComponent(str).replace(/!/g, '%21').replace(/'/g, '%27').replace(/\\(/g, '%28').replace(/\\)/g, '%29').replace(/\\*/g, '%2A').replace(/%20/g, '+');\n    },\n    _isNumber: function(str)\n    {\n        return !isNaN(str) && !isNaN(parseFloat(str));\n    },\n    _isObjectString: function(str)\n    {\n        return (str.search(/^{/) !== -1);\n    },\n    _getBooleanFromStr: function(str)\n    {\n        if (str === 'true') return true;\n        else if (str === 'false') return false;\n\n        return str;\n    },\n    _hasDisplayNone: function(el)\n    {\n        return (el.style.display === 'none') || ((el.currentStyle) ? el.currentStyle.display : getComputedStyle(el, null).display) === 'none';\n    }\n};\n// Unique ID\nvar uuid = 0;\n\n// Wrapper\nvar $R = function(selector, options)\n{\n    return RedactorApp(selector, options, [].slice.call(arguments, 2));\n};\n\n// Globals\n$R.app = [];\n$R.version = '3.5.2';\n$R.options = {};\n$R.modules = {};\n$R.services = {};\n$R.classes = {};\n$R.plugins = {};\n$R.mixins = {};\n$R.modals = {};\n$R.lang = {};\n$R.dom = function(selector, context) { return new Dom(selector, context); };\n$R.ajax = Ajax;\n$R.Dom = Dom;\n$R.keycodes = {\n\tBACKSPACE: 8,\n\tDELETE: 46,\n\tUP: 38,\n\tDOWN: 40,\n\tENTER: 13,\n\tSPACE: 32,\n\tESC: 27,\n\tTAB: 9,\n\tCTRL: 17,\n\tMETA: 91,\n\tSHIFT: 16,\n\tALT: 18,\n\tRIGHT: 39,\n\tLEFT: 37\n};\n$R.env = {\n    'plugin': 'plugins',\n    'module': 'modules',\n    'service': 'services',\n    'class': 'classes',\n    'mixin': 'mixins'\n};\n\n// jQuery Wrapper\n/*eslint-env jquery*/\nif (typeof jQuery !== 'undefined')\n{\n    (function($) { $.fn.redactor = function(options) { return RedactorApp(this.toArray(), options, [].slice.call(arguments, 1)); }; })(jQuery);\n}\n\n// Class\nvar RedactorApp = function(selector, options, args)\n{\n    var namespace = 'redactor';\n    var nodes = (Array.isArray(selector)) ? selector : (selector && selector.nodeType) ? [selector] : document.querySelectorAll(selector);\n    var isApi = (typeof options === 'string' || typeof options === 'function');\n    var value = [];\n    var instance;\n\n    for (var i = 0; i < nodes.length; i++)\n    {\n        var el = nodes[i];\n        var $el = $R.dom(el);\n\n        instance = $el.dataget(namespace);\n        if (!instance && !isApi)\n        {\n            // Initialization\n            instance = new App(el, options, uuid);\n            $el.dataset(namespace, instance);\n            $R.app[uuid] = instance;\n            uuid++;\n        }\n\n        // API\n        if (instance && isApi)\n        {\n            var isDestroy = (options === 'destroy');\n            options = (isDestroy) ? 'stop' : options;\n\n            var methodValue;\n            if (typeof options === 'function')\n            {\n                methodValue = options.apply(instance, args);\n            }\n            else\n            {\n                args.unshift(options);\n                methodValue = instance.api.apply(instance, args);\n            }\n            if (methodValue !== undefined) value.push(methodValue);\n\n            if (isDestroy) $el.dataset(namespace, false);\n        }\n    }\n\n    return (value.length === 0 || value.length === 1) ? ((value.length === 0) ? instance : value[0]) : value;\n};\n\n// add\n$R.add = function(type, name, obj)\n{\n    if (typeof $R.env[type] === 'undefined') return;\n\n    // translations\n    if (obj.translations)\n    {\n        $R.lang = $R.extend(true, {}, $R.lang, obj.translations);\n    }\n\n    // modals\n    if (obj.modals)\n    {\n        $R.modals = $R.extend(true, {}, $R.modals, obj.modals);\n    }\n\n    // mixin\n    if (type === 'mixin')\n    {\n        $R[$R.env[type]][name] = obj;\n    }\n    else\n    {\n        // prototype\n        var F = function() {};\n        F.prototype = obj;\n\n        // mixins\n        if (obj.mixins)\n        {\n            for (var i = 0; i < obj.mixins.length; i++)\n            {\n                $R.inherit(F, $R.mixins[obj.mixins[i]]);\n            }\n        }\n\n        $R[$R.env[type]][name] = F;\n    }\n};\n\n// add lang\n$R.addLang = function(lang, obj)\n{\n    if (typeof $R.lang[lang] === 'undefined')\n    {\n        $R.lang[lang] = {};\n    }\n\n    $R.lang[lang] = $R.extend($R.lang[lang], obj);\n};\n\n// create\n$R.create = function(name)\n{\n    var arr = name.split('.');\n    var args = [].slice.call(arguments, 1);\n\n    var type = 'classes';\n    if (typeof $R.env[arr[0]] !== 'undefined')\n    {\n        type = $R.env[arr[0]];\n        name = arr.slice(1).join('.');\n    }\n\n    // construct\n    var instance = new $R[type][name]();\n\n    // init\n    if (instance.init)\n    {\n        var res = instance.init.apply(instance, args);\n\n        return (res) ? res : instance;\n    }\n\n    return instance;\n};\n\n// inherit\n$R.inherit = function(current, parent)\n{\n    var F = function () {};\n    F.prototype = parent;\n    var f = new F();\n\n    for (var prop in current.prototype)\n    {\n        if (current.prototype.__lookupGetter__(prop)) f.__defineGetter__(prop, current.prototype.__lookupGetter__(prop));\n        else f[prop] = current.prototype[prop];\n    }\n\n    current.prototype = f;\n    current.prototype.super = parent;\n\n    return current;\n};\n\n// error\n$R.error = function(exception)\n{\n    throw exception;\n};\n\n// extend\n$R.extend = function()\n{\n    var extended = {};\n    var deep = false;\n    var i = 0;\n    var length = arguments.length;\n\n    if (Object.prototype.toString.call( arguments[0] ) === '[object Boolean]')\n    {\n        deep = arguments[0];\n        i++;\n    }\n\n    var merge = function(obj)\n    {\n        for (var prop in obj)\n        {\n            if (Object.prototype.hasOwnProperty.call(obj, prop))\n            {\n                if (deep && Object.prototype.toString.call(obj[prop]) === '[object Object]') extended[prop] = $R.extend(true, extended[prop], obj[prop]);\n                else extended[prop] = obj[prop];\n            }\n        }\n    };\n\n    for (; i < length; i++ )\n    {\n        var obj = arguments[i];\n        merge(obj);\n    }\n\n    return extended;\n};\n$R.opts = {\n    animation: true,\n    lang: 'en',\n    direction: 'ltr',\n    spellcheck: true,\n    structure: false,\n    scrollTarget: false,\n    styles: true,\n    stylesClass: 'redactor-styles',\n    placeholder: false,\n\n    source: true,\n    showSource: false,\n\n    inline: false,\n\n    breakline: false,\n    markup: 'p',\n    enterKey: true,\n\n    clickToEdit: false,\n    clickToSave: false,\n    clickToCancel: false,\n\n    focus: false,\n    focusEnd: false,\n\n    minHeight: false, // string, '100px'\n    maxHeight: false, // string, '100px'\n    maxWidth: false, // string, '700px'\n\n    plugins: [], // array\n    callbacks: {},\n\n    // pre & tab\n    preClass: false, // string\n    preSpaces: 4, // or false\n    tabindex: false, // int\n    tabAsSpaces: false, // true or number of spaces\n    tabKey: true,\n\n    // autosave\n    autosave: false, // false or url\n    autosaveName: false,\n    autosaveData: false,\n    autosaveMethod: 'post',\n\n    // toolbar\n    toolbar: true,\n    toolbarFixed: true,\n    toolbarFixedTarget: document,\n    toolbarFixedTopOffset: 0, // pixels\n    toolbarExternal: false, // ID selector\n    toolbarContext: true,\n\n    // air\n    air: false,\n\n    // formatting\n    formatting: ['p', 'blockquote', 'pre', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6'],\n    formattingAdd: false,\n    formattingHide: false,\n\n    // buttons\n    buttons: ['html', 'format', 'bold', 'italic', 'deleted', 'lists', 'image', 'file', 'link'],\n    // + 'line', 'redo', 'undo', 'underline', 'ol', 'ul', 'indent', 'outdent'\n    buttonsTextLabeled: false,\n    buttonsAdd: [],\n    buttonsAddFirst: [],\n    buttonsAddAfter: false,\n    buttonsAddBefore: false,\n    buttonsHide: [],\n    buttonsHideOnMobile: [],\n\n    // image\n    imageUpload: false,\n    imageUploadParam: 'file',\n    imageData: false,\n    imageEditable: true,\n    imageCaption: true,\n    imageLink: true,\n    imagePosition: false,\n    imageResizable: false,\n    imageFloatMargin: '10px',\n    imageFigure: true,\n    imageObserve: true,\n    imageSrcData: false,\n\n    // file\n    fileUpload: false,\n    fileUploadParam: 'file',\n    fileData: false,\n    fileAttachment: false,\n\n    // upload opts\n    uploadData: false,\n    dragUpload: true,\n    multipleUpload: true,\n    clipboardUpload: true,\n    uploadBase64: false,\n\n    // link\n    linkTarget: false,\n    linkTitle: false,\n    linkNewTab: true,\n    linkNofollow: false,\n    linkSize: 30,\n    linkValidation: true,\n\n    // clean\n    cleanOnEnter: true,\n    cleanInlineOnEnter: false,\n    paragraphize: true,\n    removeScript: true,\n    removeNewLines: false,\n    removeComments: true,\n    replaceTags: {\n        'b': 'strong',\n        'i': 'em',\n        'strike': 'del'\n    },\n\n    // paste\n    pastePlainText: false,\n    pasteLinkTarget: false,\n    pasteImages: true,\n    pasteLinks: true,\n    pasteClean: true,\n    pasteKeepStyle: [],\n    pasteKeepClass: [],\n    pasteKeepAttrs: ['td', 'th'],\n    pasteBlockTags: ['pre', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'table', 'tbody', 'thead', 'tfoot', 'th', 'tr', 'td', 'ul', 'ol', 'li', 'blockquote', 'p', 'figure', 'figcaption'],\n    pasteInlineTags: ['a', 'img', 'br', 'strong', 'ins', 'code', 'del', 'span', 'samp', 'kbd', 'sup', 'sub', 'mark', 'var', 'cite', 'small', 'b', 'u', 'em', 'i', 'abbr'],\n\n    // active buttons\n    activeButtons: {\n        b: 'bold',\n        strong: 'bold',\n        i: 'italic',\n        em: 'italic',\n        del: 'deleted',\n        strike: 'deleted',\n        u: 'underline'\n    },\n    activeButtonsAdd: {},\n    activeButtonsObservers: {},\n\n    // autoparser\n    autoparse: true,\n    autoparseStart: true,\n    autoparsePaste: true,\n    autoparseLinks: true,\n    autoparseImages: true,\n    autoparseVideo: true,\n    autoparseHttps: false,\n\n    // shortcodes\n    shortcodes: {\n        'p.': { format: 'p' },\n        'quote.': { format: 'blockquote' },\n        'pre.': { format: 'pre' },\n        'h1.': { format: 'h1' },\n        'h2.': { format: 'h2' },\n        'h3.': { format: 'h3' },\n        'h4.': { format: 'h4' },\n        'h5.': { format: 'h5' },\n        'h6.': { format: 'h6' },\n        //'1.': { format: 'ol' },\n        '*.': { format: 'ul' }\n    },\n    shortcodesAdd: false, // object\n\n    // shortcuts\n    shortcuts: {\n        'ctrl+shift+m, meta+shift+m': { api: 'module.inline.clearformat' },\n        'ctrl+b, meta+b': { api: 'module.inline.format', args: 'b' },\n        'ctrl+i, meta+i': { api: 'module.inline.format', args: 'i' },\n        'ctrl+u, meta+u': { api: 'module.inline.format', args: 'u' },\n        'ctrl+h, meta+h': { api: 'module.inline.format', args: 'sup' },\n        'ctrl+l, meta+l': { api: 'module.inline.format', args: 'sub' },\n        'ctrl+k, meta+k': { api: 'module.link.open' },\n        'ctrl+alt+0, meta+alt+0': { api: 'module.block.format', args: 'p' },\n        'ctrl+alt+1, meta+alt+1': { api: 'module.block.format', args: 'h1' },\n        'ctrl+alt+2, meta+alt+2': { api: 'module.block.format', args: 'h2' },\n        'ctrl+alt+3, meta+alt+3': { api: 'module.block.format', args: 'h3' },\n        'ctrl+alt+4, meta+alt+4': { api: 'module.block.format', args: 'h4' },\n        'ctrl+alt+5, meta+alt+5': { api: 'module.block.format', args: 'h5' },\n        'ctrl+alt+6, meta+alt+6': { api: 'module.block.format', args: 'h6' },\n        'ctrl+shift+7, meta+shift+7': { api: 'module.list.toggle', args: 'ol' },\n        'ctrl+shift+8, meta+shift+8': { api: 'module.list.toggle', args: 'ul' }\n    },\n    shortcutsAdd: false, // object\n\n    // misc\n    grammarly: true,\n    notranslate: false,\n\n    // private\n    bufferLimit: 100,\n    emptyHtml: '<p></p>',\n    markerChar: '\\ufeff',\n    imageTypes: ['image/png', 'image/jpeg', 'image/gif'],\n    imageAttrs: ['alt', 'title', 'src', 'class', 'width', 'height', 'srcset'],\n    inlineTags: ['a', 'span', 'strong', 'strike', 'b', 'u', 'em', 'i', 'code', 'del', 'ins', 'samp', 'kbd', 'sup', 'sub', 'mark', 'var', 'cite', 'small', 'abbr'],\n    blockTags: ['pre', 'ul', 'ol', 'li', 'p', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6',  'dl', 'dt', 'dd', 'div', 'table', 'tbody', 'thead', 'tfoot', 'tr', 'th', 'td', 'blockquote', 'output', 'figcaption', 'figure', 'address', 'section', 'header', 'footer', 'aside', 'article', 'iframe'],\n    regex: {\n        youtube: /^https?\\:\\/\\/(?:www\\.youtube(?:\\-nocookie)?\\.com\\/|m\\.youtube\\.com\\/|youtube\\.com\\/)?(?:ytscreeningroom\\?vi?=|youtu\\.be\\/|vi?\\/|user\\/.+\\/u\\/\\w{1,2}\\/|embed\\/|watch\\?(?:.*\\&)?vi?=|\\&vi?=|\\?(?:.*\\&)?vi?=)([^#\\&\\?\\n\\/<>\"']*)/gi,\n        vimeo: /(http|https)?:\\/\\/(?:www.|player.)?vimeo.com\\/(?:channels\\/(?:\\w+\\/)?|groups\\/(?:[^/]*)\\/videos\\/|album\\/(?:\\d+)\\/video\\/|video\\/|)(\\d+)(?:\\/[a-zA-Z0-9_-]+)?/gi,\n        imageurl: /((https?|www)[^\\s]+\\.)(jpe?g|png|gif)(\\?[^\\s-]+)?/gi,\n        url: /https?:\\/\\/(www\\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b([-a-zA-Z\\u00F0-\\u02AF0-9()!@:%_+.~#?&//=]*)/gi,\n        aurl1: /(\\b(https?|ftp):\\/\\/[-A-Z0-9+&@#\\/%?=~_|!:,.;]*[-A-Z0-9+&@#\\/%=~_|])/gim,\n        aurl2: /(^|[^\\/])(www\\.[\\S]+(\\b|$))/gim\n    },\n    input: true,\n    zindex: false,\n    modes: {\n        \"inline\": {\n            pastePlainText: true,\n            pasteImages: false,\n            enterKey: false,\n            toolbar: false,\n            autoparse: false,\n            source: false,\n            showSource: false,\n            styles: false,\n            air: false\n        },\n        \"original\": {\n            styles: false\n        }\n    }\n};\n$R.lang['en'] = {\n    \"format\": \"Format\",\n    \"image\": \"Image\",\n    \"file\": \"File\",\n    \"link\": \"Link\",\n    \"bold\": \"Bold\",\n    \"italic\": \"Italic\",\n    \"deleted\": \"Strikethrough\",\n    \"underline\": \"Underline\",\n    \"superscript\": \"Superscript\",\n    \"subscript\": \"Subscript\",\n    \"bold-abbr\": \"B\",\n    \"italic-abbr\": \"I\",\n    \"deleted-abbr\": \"S\",\n    \"underline-abbr\": \"U\",\n    \"superscript-abbr\": \"Sup\",\n    \"subscript-abbr\": \"Sub\",\n    \"lists\": \"Lists\",\n    \"link-insert\": \"Insert Link\",\n    \"link-edit\": \"Edit Link\",\n    \"link-in-new-tab\": \"Open link in new tab\",\n    \"unlink\": \"Unlink\",\n    \"cancel\": \"Cancel\",\n    \"close\": \"Close\",\n    \"insert\": \"Insert\",\n    \"save\": \"Save\",\n    \"delete\": \"Delete\",\n    \"text\": \"Text\",\n    \"edit\": \"Edit\",\n    \"title\": \"Alt\",\n    \"paragraph\": \"Normal text\",\n    \"quote\": \"Quote\",\n    \"code\": \"Code\",\n    \"heading1\": \"Heading 1\",\n    \"heading2\": \"Heading 2\",\n    \"heading3\": \"Heading 3\",\n    \"heading4\": \"Heading 4\",\n    \"heading5\": \"Heading 5\",\n    \"heading6\": \"Heading 6\",\n    \"filename\": \"Name\",\n    \"optional\": \"optional\",\n    \"unorderedlist\": \"Unordered List\",\n    \"orderedlist\": \"Ordered List\",\n    \"outdent\": \"Outdent\",\n    \"indent\": \"Indent\",\n    \"horizontalrule\": \"Line\",\n    \"upload\": \"Upload\",\n    \"upload-label\": \"Drop files here or click to upload\",\n    \"accessibility-help-label\": \"Rich text editor\",\n    \"caption\": \"Caption\",\n    \"bulletslist\": \"Bullets\",\n    \"numberslist\": \"Numbers\",\n    \"image-position\": \"Position\",\n    \"none\": \"None\",\n    \"left\": \"Left\",\n    \"right\": \"Right\",\n    \"center\": \"Center\",\n    \"undo\": \"Undo\",\n    \"redo\": \"Redo\"\n};\n$R.buttons = {\n    html: {\n        title: 'HTML',\n        icon: true,\n        api: 'module.source.toggle'\n    },\n    undo: {\n        title: '## undo ##',\n        icon: true,\n        api: 'module.buffer.undo'\n    },\n    redo: {\n        title: '## redo ##',\n        icon: true,\n        api: 'module.buffer.redo'\n    },\n    format: {\n        title: '## format ##',\n        icon: true,\n        dropdown: {\n            p: {\n                title: '## paragraph ##',\n                api: 'module.block.format',\n                args: {\n                    tag: 'p'\n                }\n            },\n            blockquote: {\n                title: '## quote ##',\n                api: 'module.block.format',\n                args: {\n                    tag: 'blockquote'\n                }\n            },\n            pre: {\n                title: '## code ##',\n                api: 'module.block.format',\n                args: {\n                    tag: 'pre'\n                }\n            },\n            h1: {\n                title: '## heading1 ##',\n                api: 'module.block.format',\n                args: {\n                    tag: 'h1'\n                }\n            },\n            h2: {\n                title: '## heading2 ##',\n                api: 'module.block.format',\n                args: {\n                    tag: 'h2'\n                }\n            },\n            h3: {\n                title: '## heading3 ##',\n                api: 'module.block.format',\n                args: {\n                    tag: 'h3'\n                }\n            },\n            h4: {\n                title: '## heading4 ##',\n                api: 'module.block.format',\n                args: {\n                    tag: 'h4'\n                }\n            },\n            h5: {\n                title: '## heading5 ##',\n                api: 'module.block.format',\n                args: {\n                    tag: 'h5'\n                }\n            },\n            h6: {\n                title: '## heading6 ##',\n                api: 'module.block.format',\n                args: {\n                    tag: 'h6'\n                }\n            }\n        }\n    },\n    bold: {\n        title: '## bold-abbr ##',\n        icon: true,\n        tooltip: '## bold ##',\n        api: 'module.inline.format',\n        args: {\n            tag: 'b'\n        }\n    },\n    italic: {\n        title: '## italic-abbr ##',\n        icon: true,\n        tooltip: '## italic ##',\n        api: 'module.inline.format',\n        args: {\n            tag: 'i'\n        }\n    },\n    deleted: {\n        title: '## deleted-abbr ##',\n        icon: true,\n        tooltip: '## deleted ##',\n        api: 'module.inline.format',\n        args: {\n            tag: 'del'\n        }\n    },\n    underline: {\n        title: '## underline-abbr ##',\n        icon: true,\n        tooltip: '## underline ##',\n        api: 'module.inline.format',\n        args: {\n            tag: 'u'\n        }\n    },\n    sup: {\n        title: '## superscript-abbr ##',\n        icon: true,\n        tooltip: '## superscript ##',\n        api: 'module.inline.format',\n        args: {\n            tag: 'sup'\n        }\n    },\n    sub: {\n        title: '## subscript-abbr ##',\n        icon: true,\n        tooltip: '## subscript ##',\n        api: 'module.inline.format',\n        args: {\n            tag: 'sub'\n        }\n    },\n    lists: {\n        title: '## lists ##',\n        icon: true,\n        observe: 'list',\n        dropdown: {\n            observe: 'list',\n            unorderedlist: {\n                title: '&bull; ## unorderedlist ##',\n                api: 'module.list.toggle',\n                args: 'ul'\n            },\n            orderedlist: {\n                title: '1. ## orderedlist ##',\n                api: 'module.list.toggle',\n                args: 'ol'\n            },\n            outdent: {\n                title: '< ## outdent ##',\n                api: 'module.list.outdent'\n            },\n            indent: {\n                title: '> ## indent ##',\n                api: 'module.list.indent'\n            }\n        }\n    },\n    ul: {\n        title: '&bull; ## bulletslist ##',\n        icon: true,\n        api: 'module.list.toggle',\n        observe: 'list',\n        args: 'ul'\n    },\n    ol: {\n        title: '1. ## numberslist ##',\n        icon: true,\n        api: 'module.list.toggle',\n        observe: 'list',\n        args: 'ol'\n    },\n    outdent: {\n        title: '## outdent ##',\n        icon: true,\n        api: 'module.list.outdent',\n        observe: 'list'\n    },\n    indent: {\n        title: '## indent ##',\n        icon: true,\n        api: 'module.list.indent',\n        observe: 'list'\n    },\n    image: {\n        title: '## image ##',\n        icon: true,\n        api: 'module.image.open'\n    },\n    file: {\n        title: '## file ##',\n        icon: true,\n        api: 'module.file.open'\n    },\n    link: {\n        title: '## link ##',\n        icon: true,\n        observe: 'link',\n        dropdown: {\n            observe: 'link',\n            link: {\n                title: '## link-insert ##',\n                api: 'module.link.open'\n            },\n            unlink: {\n                title: '## unlink ##',\n                api: 'module.link.unlink'\n            }\n        }\n    },\n    line: {\n        title: '## horizontalrule ##',\n        icon: true,\n        api: 'module.line.insert'\n    }\n};\nvar App = function(element, options, uuid)\n{\n    this.module = {};\n    this.plugin = {};\n    this.instances = {};\n\n    // start/stop\n    this.started = false;\n    this.stopped = false;\n\n    // environment\n    this.uuid = uuid;\n    this.rootElement = element;\n    this.rootOpts = options;\n    this.dragInside = false;\n    this.dragComponentInside = false;\n    this.keycodes = $R.keycodes;\n    this.namespace = 'redactor';\n    this.$win = $R.dom(window);\n    this.$doc = $R.dom(document);\n    this.$body = $R.dom('body');\n    this.editorReadOnly = false;\n\n    // core services\n    this.opts = $R.create('service.options', options, element);\n    this.lang = $R.create('service.lang', this);\n\n    // build\n    this.buildServices();\n    this.buildModules();\n    this.buildPlugins();\n\n    // start\n    this.start();\n};\n\nApp.prototype = {\n    start: function()\n    {\n        // start\n        this.stopped = false;\n        this.broadcast('start');\n        this.broadcast('startcode');\n\n        if (this.opts.clickToEdit)\n        {\n            this.broadcast('startclicktoedit');\n        }\n        else\n        {\n            this.broadcast('enable');\n            if (this.opts.showSource) this.broadcast('startcodeshow');\n            this.broadcast('enablefocus');\n        }\n\n        // started\n        this.broadcast('started');\n        this.started = true;\n    },\n    stop: function()\n    {\n        this.started = false;\n        this.stopped = true;\n\n        this.broadcast('stop');\n        this.broadcast('disable');\n        this.broadcast('stopped');\n    },\n\n    // started & stopped\n    isStarted: function()\n    {\n        return this.started;\n    },\n    isStopped: function()\n    {\n        return this.stopped;\n    },\n\n    // build\n    buildServices: function()\n    {\n        var core = ['options', 'lang'];\n        var bindable = ['uuid', 'keycodes', 'opts', 'lang', '$win', '$doc', '$body'];\n        var services = [];\n        for (var name in $R.services)\n        {\n            if (core.indexOf(name) === -1)\n            {\n                this[name] = $R.create('service.' + name, this);\n                services.push(name);\n                bindable.push(name);\n            }\n        }\n\n        // binding\n        for (var i = 0; i < services.length; i++)\n        {\n            var service = services[i];\n            for (var z = 0; z < bindable.length; z++)\n            {\n                var inj = bindable[z];\n                if (service !== inj)\n                {\n                    this[service][inj] = this[inj];\n                }\n            }\n        }\n    },\n    buildModules: function()\n    {\n        for (var name in $R.modules)\n        {\n            this.module[name] = $R.create('module.' + name, this);\n            this.instances[name] = this.module[name];\n        }\n    },\n    buildPlugins: function()\n    {\n        var plugins = this.opts.plugins;\n        for (var i = 0; i < plugins.length; i++)\n        {\n            var name = plugins[i];\n            if (typeof $R.plugins[name] !== 'undefined')\n            {\n                this.plugin[name] = $R.create('plugin.' + name, this);\n                this.instances[name] = this.plugin[name];\n            }\n        }\n    },\n\n    // draginside\n    isDragInside: function()\n    {\n        return this.dragInside;\n    },\n    setDragInside: function(dragInside)\n    {\n        this.dragInside = dragInside;\n    },\n    isDragComponentInside: function()\n    {\n        return this.dragComponentInside;\n    },\n    setDragComponentInside: function(dragInside)\n    {\n        this.dragComponentInside = dragInside;\n    },\n    getDragComponentInside: function()\n    {\n        return this.dragComponentInside;\n    },\n\n    // readonly\n    isReadOnly: function()\n    {\n        return this.editorReadOnly;\n    },\n    enableReadOnly: function()\n    {\n        this.editorReadOnly = true;\n        this.broadcast('enablereadonly');\n        this.component.clearActive();\n        this.toolbar.disableButtons();\n    },\n    disableReadOnly: function()\n    {\n        this.editorReadOnly = false;\n        this.broadcast('disablereadonly');\n        this.toolbar.enableButtons();\n    },\n\n    // messaging\n    callMessageHandler: function(instance, name, args)\n    {\n        var arr = name.split('.');\n        var value;\n        if (arr.length === 1)\n        {\n            if (typeof instance['on' + name] === 'function')\n            {\n                value = instance['on' + name].apply(instance, args);\n            }\n        }\n        else\n        {\n            arr[0] = 'on' + arr[0];\n\n            var func = this.utils.checkProperty(instance, arr);\n            if (typeof func === 'function')\n            {\n                value = func.apply(instance, args);\n            }\n        }\n\n        return value;\n    },\n    broadcast: function(name)\n    {\n        var args = [].slice.call(arguments, 1);\n        var returned;\n        for (var moduleName in this.instances)\n        {\n            var value = this.callMessageHandler(this.instances[moduleName], name, args);\n            if (typeof value !== 'undefined') {\n                returned = value;\n            }\n        }\n\n        // callback\n        var cval = this.callback.trigger(name, args);\n\n        return (typeof returned !== 'undefined') ? returned : cval;\n    },\n\n    // callback\n    on: function(name, func)\n    {\n        this.callback.add(name, func);\n    },\n    off: function(name, func)\n    {\n        this.callback.remove(name, func);\n    },\n\n    // api\n    api: function(name)\n    {\n        if (!this.isStarted() && name !== 'start') return;\n        if (this.isReadOnly() && name !== 'disableReadOnly') return;\n\n        this.broadcast('state');\n\n        var args = [].slice.call(arguments, 1);\n        var arr = name.split('.');\n\n        var isApp = (arr.length === 1);\n        var isCallback = (arr[0] === 'on' || arr[0] === 'off');\n        var isService = (!isCallback && arr.length === 2);\n        var isPlugin = (arr[0] === 'plugin');\n        var isModule = (arr[0] === 'module');\n\n        // app\n        if (isApp)\n        {\n            if (typeof this[arr[0]] === 'function')\n            {\n                return this.callInstanceMethod(this, arr[0], args);\n            }\n        }\n        // callback\n        else if (isCallback)\n        {\n            return (arr[0] === 'on') ? this.on(arr[1], args[0]) : this.off(arr[1], args[0] || undefined);\n        }\n        // service\n        else if (isService)\n        {\n            if (this.isInstanceExists(this, arr[0]))\n            {\n                return this.callInstanceMethod(this[arr[0]], arr[1], args);\n            }\n            else\n            {\n                $R.error(new Error('Service \"' + arr[0] + '\" not found'));\n            }\n        }\n        // plugin\n        else if (isPlugin)\n        {\n            if (this.isInstanceExists(this.plugin, arr[1]))\n            {\n                return this.callInstanceMethod(this.plugin[arr[1]], arr[2], args);\n            }\n            else\n            {\n                $R.error(new Error('Plugin \"' + arr[1] + '\" not found'));\n            }\n        }\n        // module\n        else if (isModule)\n        {\n            if (this.isInstanceExists(this.module, arr[1]))\n            {\n                return this.callInstanceMethod(this.module[arr[1]], arr[2], args);\n            }\n            else\n            {\n                $R.error(new Error('Module \"' + arr[1] + '\" not found'));\n            }\n        }\n\n    },\n    isInstanceExists: function(obj, name)\n    {\n        return (typeof obj[name] !== 'undefined');\n    },\n    callInstanceMethod: function(instance, method, args)\n    {\n        if (typeof instance[method] === 'function')\n        {\n            return instance[method].apply(instance, args);\n        }\n    }\n};\n$R.add('mixin', 'formatter', {\n\n    // public\n    buildArgs: function(args)\n    {\n        this.args = {\n            'class': args['class'] || false,\n            'style': args['style'] || false,\n            'attr': args['attr'] || false\n        };\n\n        if (!this.args['class'] && !this.args['style'] && !this.args['attr'])\n        {\n            this.args = false;\n        }\n    },\n    applyArgs: function(nodes, selection)\n    {\n        if (this.args)\n        {\n            nodes = this[this.type](this.args, false, nodes, selection);\n        }\n        else\n        {\n            nodes = this._clearAll(nodes, selection);\n        }\n\n        return nodes;\n    },\n    clearClass: function(tags, nodes)\n    {\n        this.selection.save();\n\n        var $elements = (nodes) ? $R.dom(nodes) : this.getElements(tags, true);\n        $elements.removeAttr('class');\n\n        nodes = this._unwrapSpanWithoutAttr($elements.getAll());\n\n        this.selection.restore();\n\n        return nodes;\n    },\n    clearStyle: function(tags, nodes)\n    {\n        this.selection.save();\n\n        var $elements = (nodes) ? $R.dom(nodes) : this.getElements(tags, true);\n        $elements.removeAttr('style');\n\n        nodes = this._unwrapSpanWithoutAttr($elements.getAll());\n\n        this.selection.restore();\n\n        return nodes;\n    },\n    clearAttr: function(tags, nodes)\n    {\n        this.selection.save();\n\n        var $elements = (nodes) ? $R.dom(nodes) : this.getElements(tags, true);\n        this._removeAllAttr($elements);\n\n        nodes = this._unwrapSpanWithoutAttr($elements.getAll());\n\n        this.selection.restore();\n\n        return nodes;\n    },\n    set: function(args, tags, nodes, selection)\n    {\n        if (selection !== false) this.selection.save();\n\n        var $elements = (nodes) ? $R.dom(nodes) : this.getElements(tags);\n\n        if (args['class'])\n        {\n            $elements.removeAttr('class');\n            $elements.addClass(args['class']);\n        }\n\n        if (args['style'])\n        {\n            $elements.removeAttr('style');\n            $elements.css(args['style']);\n            $elements.each(function(node)\n            {\n                var $node = $R.dom(node);\n                $node.attr('data-redactor-style-cache', $node.attr('style'));\n            });\n        }\n\n        if (args['attr'])\n        {\n            this._removeAllAttr($elements);\n            $elements.attr(args['attr']);\n        }\n\n        if (selection !== false) this.selection.restore();\n\n        return $elements.getAll();\n    },\n    toggle: function(args, tags, nodes, selection)\n    {\n        if (selection !== false) this.selection.save();\n\n        var $elements = (nodes) ? $R.dom(nodes) : this.getElements(tags);\n\n        if (args['class'])\n        {\n            $elements.toggleClass(args['class']);\n            $elements.each(function(node)\n            {\n                if (node.className === '') node.removeAttribute('class');\n            });\n        }\n\n        var params;\n        if (args['style'])\n        {\n            params = args['style'];\n            $elements.each(function(node)\n            {\n                var $node = $R.dom(node);\n                for (var key in params)\n                {\n                    var newVal = params[key];\n                    var oldVal = $node.css(key);\n\n                    oldVal = (this.utils.isRgb(oldVal)) ? this.utils.rgb2hex(oldVal) : oldVal.replace(/\"/g, '');\n                    newVal = (this.utils.isRgb(newVal)) ? this.utils.rgb2hex(newVal) : newVal.replace(/\"/g, '');\n\n                    oldVal = this.utils.hex2long(oldVal);\n                    newVal = this.utils.hex2long(newVal);\n\n                    var compareNew = (typeof newVal === 'string') ? newVal.toLowerCase() : newVal;\n                    var compareOld = (typeof oldVal === 'string') ? oldVal.toLowerCase() : oldVal;\n\n                    if (compareNew === compareOld) $node.css(key, '');\n                    else $node.css(key, newVal);\n                }\n\n                this._convertStyleQuotes($node);\n                if (this.utils.removeEmptyAttr(node, 'style'))\n                {\n                    $node.removeAttr('data-redactor-style-cache');\n                }\n                else\n                {\n                    $node.attr('data-redactor-style-cache', $node.attr('style'));\n                }\n\n            }.bind(this));\n        }\n\n        if (args['attr'])\n        {\n            params = args['attr'];\n            $elements.each(function(node)\n            {\n                var $node = $R.dom(node);\n                for (var key in params)\n                {\n                    if ($node.attr(key)) $node.removeAttr(key);\n                    else $node.attr(key, params[key]);\n                }\n            });\n\n        }\n\n        if (selection !== false) this.selection.restore();\n\n        return $elements.getAll();\n    },\n    add: function(args, tags, nodes, selection)\n    {\n        if (selection !== false) this.selection.save();\n\n        var $elements = (nodes) ? $R.dom(nodes) : this.getElements(tags);\n\n        if (args['class'])\n        {\n            $elements.addClass(args['class']);\n        }\n\n        if (args['style'])\n        {\n            var params = args['style'];\n            $elements.each(function(node)\n            {\n                var $node = $R.dom(node);\n                $node.css(params);\n                $node.attr('data-redactor-style-cache', $node.attr('style'));\n\n                this._convertStyleQuotes($node);\n\n            }.bind(this));\n        }\n\n        if (args['attr'])\n        {\n            $elements.attr(args['attr']);\n        }\n\n        if (selection !== false) this.selection.restore();\n\n        return $elements.getAll();\n    },\n    remove: function(args, tags, nodes, selection)\n    {\n        if (selection !== false) this.selection.save();\n\n        var $elements = (nodes) ? $R.dom(nodes) : this.getElements(tags);\n\n        if (args['class'])\n        {\n            $elements.removeClass(args['class']);\n            $elements.each(function(node)\n            {\n                if (node.className === '') node.removeAttribute('class');\n            });\n        }\n\n        if (args['style'])\n        {\n            var name = args['style'];\n            $elements.each(function(node)\n            {\n                var $node = $R.dom(node);\n                $node.css(name, '');\n\n                if (this.utils.removeEmptyAttr(node, 'style'))\n                {\n                    $node.removeAttr('data-redactor-style-cache');\n                }\n                else\n                {\n                    $node.attr('data-redactor-style-cache', $node.attr('style'));\n                }\n\n            }.bind(this));\n        }\n\n        if (args['attr'])\n        {\n            $elements.removeAttr(args['attr']);\n        }\n\n        nodes = this._unwrapSpanWithoutAttr($elements.getAll());\n\n        if (selection !== false) this.selection.restore();\n\n        return nodes;\n    },\n\n    // private\n    _removeAllAttr: function($elements)\n    {\n        $elements.each(function(node)\n        {\n            for (var i = node.attributes.length; i-->0;)\n            {\n                var nodeAttr = node.attributes[i];\n                var name = nodeAttr.name;\n                if (name !== 'style' && name !== 'class')\n                {\n                    node.removeAttributeNode(nodeAttr);\n                }\n            }\n        });\n    },\n    _convertStyleQuotes: function($node)\n    {\n        var style = $node.attr('style');\n        if (style) $node.attr('style', style.replace(/\"/g, '\\''));\n    },\n    _clearAll: function(nodes, selection)\n    {\n        if (selection !== false) this.selection.save();\n\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var node = nodes[i];\n            while (node.attributes.length > 0)\n            {\n                node.removeAttribute(node.attributes[0].name);\n            }\n        }\n\n        nodes = this._unwrapSpanWithoutAttr(nodes);\n\n        if (selection !== false) this.selection.restore();\n\n        return nodes;\n    },\n    _unwrapSpanWithoutAttr: function(nodes)\n    {\n        var finalNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var node = nodes[i];\n            var len = node.attributes.length;\n            if (len <= 0 && node.nodeType !== 3 && node.tagName === 'SPAN')\n            {\n                $R.dom(node).unwrap();\n            }\n            else\n            {\n                finalNodes.push(node);\n            }\n        }\n\n        return finalNodes;\n    }\n});\n$R.add('mixin', 'dom', $R.Dom.prototype);\n$R.add('mixin', 'component', {\n    get cmnt()\n    {\n        return true;\n    }\n});\n$R.add('service', 'options', {\n    init: function(options, element)\n    {\n        var $el = $R.dom(element);\n        var opts = $R.extend({}, $R.opts, (element) ? $el.data() : {}, $R.options);\n        opts = $R.extend(true, opts, options);\n\n        return opts;\n    }\n});\n$R.add('service', 'lang', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n\n        // build\n        this.vars = this._build(this.opts.lang);\n    },\n\n    // public\n    rebuild: function(lang)\n    {\n        this.opts.lang = lang;\n        this.vars = this._build(lang);\n    },\n    extend: function(obj)\n    {\n        this.vars = $R.extend(this.vars, obj);\n    },\n    parse: function(str)\n    {\n        if (str === undefined)\n        {\n            return '';\n        }\n\n        var matches = str.match(/## (.*?) ##/g);\n        if (matches)\n        {\n            for (var i = 0; i < matches.length; i++)\n            {\n                var key = matches[i].replace(/^##\\s/g, '').replace(/\\s##$/g, '');\n                str = str.replace(matches[i], this.get(key));\n            }\n        }\n\n        return str;\n    },\n    get: function(name)\n    {\n        var str = '';\n        if (typeof this.vars[name] !== 'undefined')\n        {\n            str = this.vars[name];\n        }\n        else if (this.opts.lang !== 'en' && typeof $R.lang['en'][name] !== 'undefined')\n        {\n            str = $R.lang['en'][name];\n        }\n\n        return str;\n    },\n\n    // private\n    _build: function(lang)\n    {\n        var vars = $R.lang['en'];\n        if (lang !== 'en')\n        {\n            vars = ($R.lang[lang] !== undefined) ? $R.lang[lang] : vars;\n        }\n\n        return vars;\n    }\n});\n$R.add('service', 'callback', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n\n        // local\n        this.callbacks = {};\n\n        // build\n        if (this.opts.callbacks)\n        {\n            this._set(this.opts.callbacks, '');\n        }\n    },\n    stop: function()\n    {\n        this.callbacks = {};\n    },\n    add: function(name, handler)\n    {\n        if (!this.callbacks[name]) this.callbacks[name] = [];\n        this.callbacks[name].push(handler);\n    },\n    remove: function(name, handler)\n    {\n        if (handler === undefined)\n        {\n            delete this.callbacks[name];\n        }\n        else\n        {\n            for (var i = 0; i < this.callbacks[name].length; i++)\n            {\n                this.callbacks[name].splice(i, 1);\n            }\n\n            if (Object.keys(this.callbacks[name]).length === 0) delete this.callbacks[name];\n        }\n    },\n    trigger: function(name, args)\n    {\n        var value = this._loop(name, args, this.callbacks);\n        return (typeof value === 'undefined' && args && args[0] !== false) ? args[0] : value;\n    },\n\n    // private\n    _set: function(obj, name)\n    {\n        for (var key in obj)\n        {\n            var path = (name === '') ? key : name + '.' + key;\n            if (typeof obj[key] === 'object')\n            {\n                this._set(obj[key], path);\n            }\n            else\n            {\n                this.callbacks[path] = [];\n                this.callbacks[path].push(obj[key]);\n            }\n        }\n    },\n    _loop: function(name, args, obj)\n    {\n        var value;\n        for (var key in obj)\n        {\n            if (name === key)\n            {\n                for (var i = 0; i < obj[key].length; i++)\n                {\n                    value = obj[key][i].apply(this.app, args);\n\n                }\n            }\n        }\n\n        return value;\n    }\n});\n$R.add('service', 'animate', {\n    init: function(app)\n    {\n        this.animationOpt = app.opts.animation;\n    },\n    start: function(element, animation, options, callback)\n    {\n        var defaults = {\n            duration: false,\n            iterate: false,\n            delay: false,\n            timing: false,\n            prefix: 'redactor-'\n        };\n\n        defaults = (typeof options === 'function') ? defaults : $R.extend(defaults, options);\n        callback = (typeof options === 'function') ? options : callback;\n\n        // play\n        return new $R.AnimatePlay(element, animation, defaults, callback, this.animationOpt);\n    },\n    stop: function(element)\n    {\n        this.$el = $R.dom(element);\n        this.$el.removeClass('redactor-animated');\n\n        var effect = this.$el.attr('redactor-animate-effect');\n        this.$el.removeClass(effect);\n\n        this.$el.removeAttr('redactor-animate-effect');\n        var hide = this.$el.attr('redactor-animate-hide');\n        if (hide)\n        {\n            this.$el.addClass(hide).removeAttr('redactor-animate-hide');\n        }\n\n        this.$el.off('animationend webkitAnimationEnd');\n    }\n});\n\n$R.AnimatePlay = function(element, animation, defaults, callback, animationOpt)\n{\n    this.hidableEffects = ['fadeOut', 'flipOut', 'slideUp', 'zoomOut', 'slideOutUp', 'slideOutRight', 'slideOutLeft'];\n    this.prefixes = ['', '-webkit-'];\n\n    this.$el = $R.dom(element);\n    this.$body = $R.dom('body');\n    this.callback = callback;\n    this.animation = (!animationOpt) ? this.buildAnimationOff(animation) : animation;\n    this.defaults = defaults;\n\n    if (this.animation === 'slideUp')\n    {\n        this.$el.height(this.$el.height());\n    }\n\n    // animate\n    return (this.isInanimate()) ? this.inanimate() : this.animate();\n};\n\n$R.AnimatePlay.prototype = {\n    buildAnimationOff: function(animation)\n    {\n        return (this.isHidable(animation)) ? 'hide' : 'show';\n    },\n    buildHideClass: function()\n    {\n        return 'redactor-animate-hide';\n    },\n    isInanimate: function()\n    {\n        return (this.animation === 'show' || this.animation === 'hide');\n    },\n    isAnimated: function()\n    {\n        return this.$el.hasClass('redactor-animated');\n    },\n    isHidable: function(effect)\n    {\n        return (this.hidableEffects.indexOf(effect) !== -1);\n    },\n    inanimate: function()\n    {\n        this.defaults.timing = 'linear';\n\n        var hide;\n        if (this.animation === 'show')\n        {\n            hide = this.buildHideClass();\n            this.$el.attr('redactor-animate-hide', hide);\n            this.$el.removeClass(hide);\n        }\n        else\n        {\n            hide = this.$el.attr('redactor-animate-hide');\n            this.$el.addClass(hide).removeAttr('redactor-animate-hide');\n        }\n\n        if (typeof this.callback === 'function') this.callback(this);\n\n        return this;\n    },\n    animate: function()\n    {\n        var delay = (this.defaults.delay) ? this.defaults.delay : 0;\n        setTimeout(function()\n        {\n            this.$body.addClass('no-scroll-x');\n            this.$el.addClass('redactor-animated');\n            if (!this.$el.attr('redactor-animate-hide'))\n            {\n                var hide = this.buildHideClass();\n                this.$el.attr('redactor-animate-hide', hide);\n                this.$el.removeClass(hide);\n            }\n\n            this.$el.addClass(this.defaults.prefix + this.animation);\n            this.$el.attr('redactor-animate-effect', this.defaults.prefix + this.animation);\n\n            this.set(this.defaults.duration + 's', this.defaults.iterate, this.defaults.timing);\n            this.complete();\n\n        }.bind(this), delay * 1000);\n\n        return this;\n    },\n    set: function(duration, iterate, timing)\n    {\n        var len = this.prefixes.length;\n\n        while (len--)\n        {\n            if (duration !== false || duration === '') this.$el.css(this.prefixes[len] + 'animation-duration', duration);\n            if (iterate !== false || iterate === '') this.$el.css(this.prefixes[len] + 'animation-iteration-count', iterate);\n            if (timing !== false || timing === '') this.$el.css(this.prefixes[len] + 'animation-timing-function', timing);\n        }\n    },\n    clean: function()\n    {\n        this.$body.removeClass('no-scroll-x');\n        this.$el.removeClass('redactor-animated');\n        this.$el.removeClass(this.defaults.prefix + this.animation);\n        this.$el.removeAttr('redactor-animate-effect');\n\n        this.set('', '', '');\n    },\n    complete: function()\n    {\n        this.$el.one('animationend webkitAnimationEnd', function()\n        {\n            if (this.$el.hasClass(this.defaults.prefix + this.animation)) this.clean();\n            if (this.isHidable(this.animation))\n            {\n                var hide = this.$el.attr('redactor-animate-hide');\n                this.$el.addClass(hide).removeAttr('redactor-animate-hide');\n            }\n\n            if (this.animation === 'slideUp') this.$el.height('');\n            if (typeof this.callback === 'function') this.callback(this.$el);\n\n        }.bind(this));\n    }\n};\n$R.add('service', 'caret', {\n    init: function(app)\n    {\n        this.app = app;\n    },\n\n    // set\n    setStart: function(el)\n    {\n        this._setCaret('Start', el);\n    },\n    setEnd: function(el)\n    {\n        this._setCaret('End', el);\n    },\n    setBefore: function(el)\n    {\n        this._setCaret('Before', el);\n    },\n    setAfter: function(el)\n    {\n        this._setCaret('After', el);\n    },\n\n    // is\n    isStart: function(el)\n    {\n        return this._isStartOrEnd(el, 'First');\n    },\n    isEnd: function(el)\n    {\n        return this._isStartOrEnd(el, 'Last');\n    },\n\n    // set side\n    setAtEnd: function(node)\n    {\n        var data = this.inspector.parse(node);\n        var tag = data.getTag();\n        var range = document.createRange();\n        if (this._isInPage(node))\n        {\n            if (tag === 'a')\n            {\n                var textNode = this.utils.createInvisibleChar();\n                $R.dom(node).after(textNode);\n\n                range.selectNodeContents(textNode);\n                range.collapse(true);\n            }\n            else\n            {\n                range.selectNodeContents(node);\n                range.collapse(false);\n            }\n\n            this.selection.setRange(range);\n        }\n    },\n    setAtStart: function(node)\n    {\n\t\tvar range = document.createRange();\n\t\tvar data = this.inspector.parse(node);\n        if (this._isInPage(node))\n        {\n            range.setStart(node, 0);\n            range.collapse(true);\n\n            if (data.isInline())\n            {\n                var textNode = this.utils.createInvisibleChar();\n                range.insertNode(textNode);\n                range.selectNodeContents(textNode);\n                range.collapse(false);\n            }\n\n            this.selection.setRange(range);\n        }\n    },\n    setAtBefore: function(node)\n    {\n        var data = this.inspector.parse(node);\n        var range = document.createRange();\n        if (this._isInPage(node))\n        {\n            range.setStartBefore(node);\n            range.collapse(true);\n\n            if (data.isInline())\n            {\n                var textNode = this.utils.createInvisibleChar();\n                node.parentNode.insertBefore(textNode, node);\n                range.selectNodeContents(textNode);\n                range.collapse(false);\n            }\n\n            this.selection.setRange(range);\n        }\n    },\n    setAtAfter: function(node)\n    {\n\n        var range = document.createRange();\n        if (this._isInPage(node))\n        {\n            range.setStartAfter(node);\n            range.collapse(true);\n\n            var textNode = this.utils.createInvisibleChar();\n            range.insertNode(textNode);\n            range.selectNodeContents(textNode);\n            range.collapse(false);\n\n            this.selection.setRange(range);\n        }\n    },\n    setAtPrev: function(node)\n    {\n        var prev = node.previousSibling;\n        if (prev)\n        {\n            prev = (prev.nodeType === 3 && this._isEmptyTextNode(prev)) ? prev.previousElementSibling : prev;\n            if (prev) this.setEnd(prev);\n        }\n    },\n    setAtNext: function(node)\n    {\n        var next = node.nextSibling;\n        if (next)\n        {\n            next = (next.nodeType === 3 && this._isEmptyTextNode(next)) ? next.nextElementSibling : next;\n            if (next) this.setStart(next);\n        }\n    },\n\n    // private\n    _setCaret: function(type, el)\n    {\n        var data = this.inspector.parse(el);\n        var node = data.getNode();\n\n        if (node)\n        {\n            this.component.clearActive();\n            this['_set' + type](node, data, data.getTag());\n        }\n    },\n    _setStart: function(node, data, tag)\n    {\n        // 1. text\n        if (data.isText())\n        {\n            this.editor.focus();\n            return this.setAtStart(node);\n        }\n        // 2. ul, ol\n        else if (tag === 'ul' || tag === 'ol')\n        {\n            node = data.findFirstNode('li');\n\n            var item = this.utils.getFirstElement(node);\n            var dataItem = this.inspector.parse(item);\n            if (item && dataItem.isComponent())\n            {\n                return this.setStart(dataItem.getComponent());\n            }\n        }\n        // 3. dl\n        else if (tag === 'dl')\n        {\n            node = data.findFirstNode('dt');\n        }\n        // 4. br / hr\n        else if (tag === 'br' || tag === 'hr')\n        {\n            return this.setBefore(node);\n        }\n        // 5. th, td\n        else if (tag === 'td' || tag === 'th')\n        {\n            var el = data.getFirstElement(node);\n            if (el)\n            {\n                return this.setStart(el);\n            }\n        }\n        // 6. table\n        else if (tag === 'table' || tag === 'tr')\n        {\n            return this.setStart(data.findFirstNode('th, td'));\n        }\n        // 7. figure code\n        else if (data.isComponentType('code') && !data.isFigcaption())\n        {\n            var code = data.findLastNode('pre, code');\n\n            this.editor.focus();\n            return this.setAtStart(code);\n        }\n        // 8. table component\n        else if (tag === 'figure' && data.isComponentType('table'))\n        {\n            var table = data.getTable();\n            var tableData = this.inspector.parse(table);\n\n            return this.setStart(tableData.findFirstNode('th, td'));\n        }\n        // 9. non editable components\n        else if (!data.isComponentType('table') && data.isComponent() && !data.isFigcaption())\n        {\n            return this.component.setActive(node);\n        }\n\n        this.editor.focus();\n\n        // set\n        if (!this._setInline(node, 'Start'))\n        {\n            this.setAtStart(node);\n        }\n    },\n    _setEnd: function(node, data, tag)\n    {\n        // 1. text\n        if (data.isText())\n        {\n            this.editor.focus();\n            return this.setAtEnd(node);\n        }\n        // 2. ul, ol\n        else if (tag === 'ul' || tag === 'ol')\n        {\n            node = data.findLastNode('li');\n\n            var item = this.utils.getLastElement(node);\n            var dataItem = this.inspector.parse(item);\n            if (item && dataItem.isComponent())\n            {\n                return this.setEnd(dataItem.getComponent());\n            }\n        }\n        // 3. dl\n        else if (tag === 'dl')\n        {\n            node = data.findLastNode('dd');\n        }\n        // 4. br / hr\n        else if (tag === 'br' || tag === 'hr')\n        {\n            return this.setAfter(node);\n        }\n        // 5. th, td\n        else if (tag === 'td' || tag === 'th')\n        {\n            var el = data.getLastElement();\n            if (el)\n            {\n                return this.setEnd(el);\n            }\n        }\n        // 6. table\n        else if (tag === 'table' || tag === 'tr')\n        {\n            return this.setEnd(data.findLastNode('th, td'));\n        }\n        // 7. figure code\n        else if (data.isComponentType('code') && !data.isFigcaption())\n        {\n            var code = data.findLastNode('pre, code');\n\n            this.editor.focus();\n            return this.setAtEnd(code);\n        }\n        // 8. table component\n        else if (tag === 'figure' && data.isComponentType('table'))\n        {\n            var table = data.getTable();\n            var tableData = this.inspector.parse(table);\n\n            return this.setEnd(tableData.findLastNode('th, td'));\n        }\n        // 9. non editable components\n        else if (!data.isComponentType('table') && data.isComponent() && !data.isFigcaption())\n        {\n            return this.component.setActive(node);\n        }\n\n        this.editor.focus();\n\n        // set\n        if (!this._setInline(node, 'End'))\n        {\n            // is element empty\n            if (this.utils.isEmpty(node))\n            {\n                return this.setStart(node);\n            }\n\n            this.setAtEnd(node);\n        }\n    },\n    _setBefore: function(node, data, tag)\n    {\n        // text\n        if (node.nodeType === 3)\n        {\n            return this.setAtBefore(node);\n        }\n        // inline\n        else if (data.isInline())\n        {\n            return this.setAtBefore(node);\n        }\n        // td / th\n        else if (data.isFirstTableCell())\n        {\n            return this.setAtPrev(data.getComponent());\n        }\n        else if (tag === 'td' || tag === 'th')\n        {\n            return this.setAtPrev(node);\n        }\n        // li\n        else if (data.isFirstListItem())\n        {\n            return this.setAtPrev(data.getList());\n        }\n        // figcaption\n        else if (data.isFigcaption())\n        {\n            return this.setStart(data.getComponent());\n        }\n        // component\n        else if (!data.isComponentType('table') && data.isComponent())\n        {\n            return this.setAtPrev(data.getComponent());\n        }\n        // block\n        else if (data.isBlock())\n        {\n            return this.setAtPrev(node);\n        }\n\n        this.editor.focus();\n        this.setAtBefore(node);\n\n    },\n    _setAfter: function(node, data, tag)\n    {\n        // text\n        if (node.nodeType === 3)\n        {\n            return this.setAtAfter(node);\n        }\n        // inline\n        else if (data.isInline())\n        {\n            return this.setAtAfter(node);\n        }\n        // td / th\n        else if (data.isLastTableCell())\n        {\n            return this.setAtNext(data.getComponent());\n        }\n        else if (tag === 'td' || tag === 'th')\n        {\n            return this.setAtNext(node);\n        }\n        // li\n        else if (data.isFirstListItem())\n        {\n            return this.setAtNext(data.getList());\n        }\n        // component\n        else if (!data.isComponentType('table') && data.isComponent())\n        {\n            return this.setAtNext(data.getComponent());\n        }\n        // block\n        else if (data.isBlock())\n        {\n            return this.setAtNext(node);\n        }\n\n        this.editor.focus();\n        this.setAtAfter(node);\n    },\n    _setInline: function(node, type)\n    {\n        // is first element inline (FF only)\n        var inline = this._hasInlineChild(node, (type === 'Start') ? 'first' : 'last');\n        if (inline)\n        {\n            if (type === 'Start')\n            {\n                this.setStart(inline);\n            }\n            else\n            {\n                this.setEnd(inline);\n            }\n\n            return true;\n        }\n    },\n    _isStartOrEnd: function(el, type)\n    {\n        var node = this.utils.getNode(el);\n        if (!node) return false;\n\n        var data = this.inspector.parse(node);\n        node = this._getStartEndNode(node, data, type);\n\n        if (node && (node.nodeType !== 3 && node.tagName !== 'LI'))\n        {\n            var html = (node.nodeType === 3) ? node.textContent : node.innerHTML;\n            html = this.utils.trimSpaces(html);\n            if (html === '') return true;\n        }\n\n        if (!data.isFigcaption() && data.isComponent() && !data.isComponentEditable())\n        {\n            return true;\n        }\n\n        var offset = this.offset.get(node, true);\n        if (offset)\n        {\n            return (type === 'First') ? (offset.start === 0) : (offset.end === this.offset.size(node, true));\n        }\n        else\n        {\n            return false;\n        }\n    },\n    _isInPage: function(node)\n    {\n        if (node && node.nodeType)\n        {\n            return (node === document.body) ? false : document.body.contains(node);\n        }\n        else\n        {\n            return false;\n        }\n    },\n    _hasInlineChild: function(el, pos)\n    {\n        var data = this.inspector.parse(el);\n        var node = (pos === 'first') ? data.getFirstNode() : data.getLastNode();\n        var $node = $R.dom(node);\n\n        if (node && node.nodeType !== 3\n            && this.inspector.isInlineTag(node.tagName)\n            && !$node.hasClass('redactor-component')\n             && !$node.hasClass('non-editable'))\n        {\n            return node;\n        }\n    },\n    _isEmptyTextNode: function(node)\n    {\n        var text = node.textContent.trim().replace(/\\n/, '');\n        text = this.utils.removeInvisibleChars(text);\n\n        return (text === '');\n    },\n    _getStartEndNode: function(node, data, type)\n    {\n        if (data.isFigcaption())\n        {\n            node = data.getFigcaption();\n        }\n        else if (data.isTable())\n        {\n            node = data['find' + type + 'Node']('th, td');\n        }\n        else if (data.isList())\n        {\n            node = data['find' + type + 'Node']('li');\n        }\n        else if (data.isComponentType('code'))\n        {\n            node = data.findLastNode('pre, code');\n        }\n\n        return node;\n    }\n});\nvar containsNode = function containsNode(node) {\n    return document.getSelection().containsNode(node, true);\n};\n\nvar containsNodePolyfill = function polyfill(node) {\n    var selection = document.getSelection();\n    var start = selection.anchorNode.parentNode;\n    var finalnode = selection.focusNode.parentNode;\n    var rectSelection = selection.getRangeAt(0).getBoundingClientRect();\n    var rectBlock = node.getBoundingClientRect();\n\n    if ($R.dom(start).closest(node).length) {\n        return true;\n    }\n\n    if ($R.dom(finalnode).closest(node).length) {\n        return true;\n    }\n\n    if (rectSelection.top < rectBlock.top && rectSelection.height > rectBlock.height) {\n        return true;\n    }\n\n    return false;\n};\n\nif (!('containsNode' in Selection.prototype)) {\n    containsNode = containsNodePolyfill;\n}\n\n$R.add('service', 'selection', {\n    init: function(app)\n    {\n        this.app = app;\n    },\n    // is\n    is: function()\n    {\n        var sel = this.get();\n        if (sel)\n        {\n            var node = sel.anchorNode;\n\n            return ($R.dom(node).closest('.redactor-in-' + this.uuid).length !== 0 || node === this.editor.getElement().get());\n        }\n\n        return false;\n    },\n    isCollapsed: function()\n    {\n        var sel = this.get();\n        var range = this.getRange();\n\n        if (sel && sel.isCollapsed) return true;\n        else if (range && range.toString().length === 0) return true;\n\n        return false;\n    },\n    isBackwards: function()\n    {\n        var backwards = false;\n        var sel = this.get();\n\n        if (sel && !sel.isCollapsed)\n        {\n            var range = document.createRange();\n            range.setStart(sel.anchorNode, sel.anchorOffset);\n            range.setEnd(sel.focusNode, sel.focusOffset);\n            backwards = range.collapsed;\n            range.detach();\n        }\n\n        return backwards;\n    },\n    isIn: function(el)\n    {\n        var node = $R.dom(el).get();\n        var current = this.getCurrent();\n\n        return (current && node) ? node.contains(current) : false;\n    },\n    isText: function()\n    {\n        var sel = this.get();\n        if (sel)\n        {\n            var el = sel.anchorNode;\n            var block = this.getBlock(el);\n            var blocks = this.getBlocks();\n\n            // td, th or hasn't block\n            if ((block && this.inspector.isTableCellTag(block.tagName)) || (block === false && blocks.length === 0))\n            {\n                return true;\n            }\n        }\n\n        return false;\n    },\n    isAll: function(el)\n    {\n        var node = this.utils.getNode(el);\n        if (!node) return false;\n\n        var isEditor = this.editor.isEditor(node);\n        var data = this.inspector.parse(node);\n\n        // component\n        if (!data.isFigcaption() && this.component.isNonEditable(node) && this.component.isActive(node))\n        {\n            return true;\n        }\n\n        if (isEditor)\n        {\n            var $editor = this.editor.getElement();\n            var output = $editor.html().replace(/<p><\\/p>$/i, '');\n            var htmlLen = this.getHtml(false).length;\n            var outputLen = output.length;\n\n            if (htmlLen !== outputLen)\n            {\n                return false;\n            }\n        }\n\n        // editor empty or collapsed\n        if ((isEditor && this.editor.isEmpty()) || this.isCollapsed())\n        {\n            return false;\n        }\n\n        // all\n        var offset = this.offset.get(node, true);\n        var size = this.offset.size(node, true);\n\n        // pre, table, or pre/code in figure\n        if (!isEditor && data.isComponentType('code'))\n        {\n            size = this.getText().trim().length;\n        }\n\n        if (offset && offset.start === 0 && offset.end === size)\n        {\n            return true;\n        }\n\n        return false;\n    },\n\n    // has\n    hasNonEditable: function()\n    {\n        var selected = this.getHtml();\n        var $wrapper = $R.dom('<div>').html(selected);\n\n        return (!this.isCollapsed() && $wrapper.find('.non-editable').length !== 0);\n    },\n\n    // set\n    setRange: function(range)\n    {\n        var sel = window.getSelection();\n        sel.removeAllRanges();\n        sel.addRange(range);\n    },\n    setAll: function(el)\n    {\n        var node = this.utils.getNode(el);\n        if (!node) return;\n\n        var data = this.inspector.parse(node);\n\n        this.component.clearActive();\n\n        this.editor.focus();\n        this.editor.saveScroll();\n        this.editor.disableNonEditables();\n\n        if (node && node.tagName === 'TABLE')\n        {\n            var first = data.findFirstNode('td, th');\n            var last = data.findLastNode('td, th');\n\n            $R.dom(first).prepend(this.marker.build('start'));\n            $R.dom(last).append(this.marker.build('end'));\n\n            this.restoreMarkers();\n        }\n        else if (!data.isFigcaption() && this.component.isNonEditable(node))\n        {\n            this.component.setActive(node);\n        }\n        else\n        {\n            if (data.isComponentType('code'))\n            {\n                node = data.getComponentCodeElement();\n                node.focus();\n            }\n\n            var range = document.createRange();\n            range.selectNodeContents(node);\n\n            this.setRange(range);\n        }\n\n        this.editor.enableNonEditables();\n        this.editor.restoreScroll();\n    },\n\n    // get\n    get: function()\n    {\n        var sel = window.getSelection();\n        return (sel.rangeCount > 0) ? sel : null;\n    },\n    getRange: function()\n    {\n        var sel = this.get();\n        return (sel) ? ((sel.getRangeAt(0)) ? sel.getRangeAt(0) : null) : null;\n    },\n    getTextBeforeCaret: function(num)\n    {\n        num = (typeof num === 'undefined') ? 1 : num;\n\n        var el = this.editor.getElement().get();\n        var range = this.getRange();\n        var text = false;\n        if (range)\n        {\n            range = range.cloneRange();\n            range.collapse(true);\n            range.setStart(el, 0);\n            text = range.toString().slice(-num);\n        }\n\n        return text;\n    },\n    getTextAfterCaret: function(num)\n    {\n        num = (typeof num === 'undefined') ? 1 : num;\n\n        var el = this.editor.getElement().get();\n        var range = this.getRange();\n        var text = false;\n        if (range)\n        {\n            var clonedRange = range.cloneRange();\n            clonedRange.selectNodeContents(el);\n            clonedRange.setStart(range.endContainer, range.endOffset);\n\n            text = clonedRange.toString().slice(0, num);\n        }\n\n        return text;\n    },\n    getPosition: function()\n    {\n        var range = this.getRange();\n        var pos = { top: 0, left: 0, width: 0, height: 0 };\n        if (window.getSelection && range.getBoundingClientRect)\n        {\n            range = range.cloneRange();\n            var offset = (range.startOffset-1);\n            range.setStart(range.startContainer, (offset < 0) ? 0 : offset);\n            var rect = range.getBoundingClientRect();\n            pos = { top: rect.top, left: rect.left, width: (rect.right - rect.left) , height: (rect.bottom - rect.top) };\n        }\n\n        return pos;\n    },\n    getCurrent: function()\n    {\n        var node = false;\n        var sel = this.get();\n        var component = this.component.getActive();\n\n        if (component)\n        {\n            node = component;\n        }\n        else if (sel && this.is())\n        {\n            node = (sel.anchorNode !== this.editor.getElement().get()) ? sel.anchorNode : false;\n        }\n\n        return node;\n    },\n    getParent: function()\n    {\n        var node = false;\n        var current = this.getCurrent();\n        if (current)\n        {\n            var parent = current.parentNode;\n            node = (parent !== this.editor.getElement().get()) ? parent : false;\n        }\n\n        return node;\n    },\n    getElement: function(el)\n    {\n        var node = el || this.getCurrent();\n        while (node)\n        {\n            var data = this.inspector.parse(node);\n            if (data.isElement() && data.isInEditor())\n            {\n                return node;\n            }\n\n            node = node.parentNode;\n        }\n\n        return false;\n    },\n    getInline: function(el)\n    {\n        var node = el || this.getCurrent();\n        var inline = false;\n        while (node)\n        {\n            if (this._isInlineNode(node))\n            {\n                inline = node;\n            }\n\n            node = node.parentNode;\n        }\n\n        return inline;\n    },\n    getInlineFirst: function(el)\n    {\n        var node = el || this.getCurrent();\n        while (node)\n        {\n            if (this._isInlineNode(node))\n            {\n                return node;\n            }\n\n            node = node.parentNode;\n        }\n\n        return false;\n    },\n    getInlineAll: function(el)\n    {\n        var node = el || this.getCurrent();\n        var inlines = [];\n        while (node)\n        {\n            if (this._isInlineNode(node))\n            {\n                inlines.push(node);\n            }\n\n            node = node.parentNode;\n        }\n\n        return inlines;\n    },\n    getBlock: function(el)\n    {\n        var node = el || this.getCurrent();\n        while (node)\n        {\n            var data = this.inspector.parse(node);\n            var isBlock = this.inspector.isBlockTag(node.tagName);\n\n            if (isBlock && data.isInEditor(node))\n            {\n                return node;\n            }\n\n            node = node.parentNode;\n        }\n\n        return false;\n    },\n    getInlinesAllSelected: function(options)\n    {\n        if (this.isAll()) return [];\n\n        var inlines = this.getInlines({ all: true, inside: true });\n        //var textNodes = this.getNodes({ textnodes: true, inline: false });\n        var selected = this.getText().replace(/[-[\\]/{}()*+?.\\\\^$|]/g, \"\\\\$&\");\n        var finalNodes = [];\n\n        //if (textNodes.length !== 0)\n        // {\n        //     return finalNodes;\n        // }\n\n        if (selected === '')\n        {\n            finalNodes = inlines;\n        }\n        else if (inlines.length > 1)\n        {\n            for (var i = 0; i < inlines.length; i++)\n            {\n                if (this._isTextSelected(inlines[i], selected))\n                {\n                    finalNodes.push(inlines[i]);\n                }\n            }\n        }\n        else if (inlines.length === 1)\n        {\n            if (this._isTextSelected(inlines[0], selected))\n            {\n                finalNodes = inlines;\n            }\n        }\n\n        finalNodes = (options && options.tags) ? this._filterNodesByTags(finalNodes, options.tags) : finalNodes;\n\n        return finalNodes;\n    },\n    getInlines: function(options)\n    {\n        var nodes = this.getNodes();\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var node;\n            if (options && options.all)\n            {\n                node = nodes[i];\n                while (node)\n                {\n                    if (this._isInlineNode(node) && !this._isInNodesArray(filteredNodes, node))\n                    {\n                        filteredNodes.push(node);\n                    }\n\n                    node = node.parentNode;\n                }\n            }\n            else\n            {\n                node = this.getInline(nodes[i]);\n                if (node && !this._isInNodesArray(filteredNodes, node))\n                {\n                    filteredNodes.push(node);\n                }\n            }\n        }\n\n        // filter\n        filteredNodes = (options && options.tags) ? this._filterNodesByTags(filteredNodes, options.tags) : filteredNodes;\n        filteredNodes = (options && options.inside) ? this._filterInlinesInside(filteredNodes, options) : filteredNodes;\n\n        return filteredNodes;\n    },\n    getBlocks: function(options)\n    {\n        var nodes = this.getNodes();\n        var block = this.getBlock();\n        nodes = (nodes.length === 0 && block) ? [block] : nodes;\n\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var node = this.getBlock(nodes[i]);\n            var $node = $R.dom(node);\n            if ($node.hasClass('non-editable')) continue;\n\n            if (node && !this._isInNodesArray(filteredNodes, node))\n            {\n                filteredNodes.push(node);\n            }\n        }\n\n        // filter\n        filteredNodes = (options && options.tags) ? this._filterNodesByTags(filteredNodes, options.tags) : filteredNodes;\n        filteredNodes = (options && options.first) ? this._filterBlocksFirst(filteredNodes, options) : filteredNodes;\n\n        return filteredNodes;\n    },\n    getElements: function(options)\n    {\n        var nodes = this.getNodes({ textnodes: false });\n        var block = this.getBlock();\n        nodes = (nodes.length === 0 && block) ? [block] : nodes;\n\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            if (!this._isInNodesArray(filteredNodes, nodes[i]))\n            {\n                filteredNodes.push(nodes[i]);\n            }\n        }\n\n        // filter\n        filteredNodes = (options && options.tags) ? this._filterNodesByTags(filteredNodes, options.tags) : filteredNodes;\n\n        return filteredNodes;\n    },\n    getNodes: function(options)\n    {\n        var nodes = [];\n        var activeComponent = this.component.getActive();\n        if (activeComponent)\n        {\n            nodes = this._getNodesComponent(activeComponent);\n        }\n        else if (this.isCollapsed())\n        {\n            var current = this.getCurrent();\n            nodes = (current) ? [current] : [];\n        }\n        else if (this.is() && !activeComponent)\n        {\n            nodes = this._getRangeSelectedNodes();\n        }\n\n        // filter\n        nodes = this._filterServicesNodes(nodes);\n        nodes = this._filterEditor(nodes);\n\n        // options\n        nodes = (options && options.tags) ? this._filterNodesByTags(nodes, options.tags) : nodes;\n        nodes = (options && options.textnodes) ? this._filterNodesTexts(nodes, options) : nodes;\n        nodes = (options && !options.textnodes) ? this._filterNodesElements(nodes) : nodes;\n\n        return nodes;\n    },\n\n    // text & html\n    getText: function()\n    {\n        var sel = this.get();\n        return (sel) ? this.utils.removeInvisibleChars(sel.toString()) : '';\n    },\n    getHtml: function(clean)\n    {\n        var html = '';\n        var sel = this.get();\n        if (sel)\n        {\n            var container = document.createElement('div');\n            var len = sel.rangeCount;\n            for (var i = 0; i < len; ++i)\n            {\n                container.appendChild(sel.getRangeAt(i).cloneContents());\n            }\n\n            html = container.innerHTML;\n            html = (clean !== false) ? this.cleaner.output(html) : html;\n            html = html.replace(/<p><\\/p>$/i, '');\n        }\n\n        return html;\n    },\n\n    // clear\n    clear: function()\n    {\n        this.component.clearActive();\n        this.get().removeAllRanges();\n    },\n\n    // collapse\n    collapseToStart: function()\n    {\n        var sel = this.get();\n        if (sel && !sel.isCollapsed) sel.collapseToStart();\n    },\n    collapseToEnd: function()\n    {\n        var sel = this.get();\n        if (sel && !sel.isCollapsed) sel.collapseToEnd();\n    },\n\n    // save\n    saveActiveComponent: function()\n    {\n        var activeComponent = this.component.getActive();\n        if (activeComponent)\n        {\n            this.savedComponent = activeComponent;\n            return true;\n        }\n\n        return false;\n    },\n    restoreActiveComponent: function()\n    {\n        if (this.savedComponent)\n        {\n            this.component.setActive(this.savedComponent);\n            return true;\n        }\n\n        return false;\n    },\n    save: function()\n    {\n        this._clearSaved();\n\n        var el = this.getElement();\n        var tags = ['TD', 'TH', 'P', 'DIV', 'PRE', 'H1', 'H2', 'H3', 'H4', 'H5', 'H6', 'LI', 'BLOCKQUOTE'];\n        if (el && (tags.indexOf(el.tagName) !== -1) && (el.innerHTML === '' || el.innerHTML === '<br>'))\n        {\n            this.savedElement = el;\n        }\n        else if (!this.saveActiveComponent())\n        {\n            this.saved = this.offset.get();\n        }\n    },\n    restore: function()\n    {\n        if (!this.saved && !this.savedComponent && !this.savedElement) return;\n\n        this.editor.saveScroll();\n        if (this.savedElement)\n        {\n            this.caret.setStart(this.savedElement);\n        }\n        else if (!this.restoreActiveComponent())\n        {\n            this.offset.set(this.saved);\n        }\n\n        this._clearSaved();\n        this.editor.restoreScroll();\n    },\n    saveMarkers: function()\n    {\n        this._clearSaved();\n\n        if (!this.saveActiveComponent())\n        {\n            this.marker.insert();\n        }\n    },\n    restoreMarkers: function()\n    {\n        this.editor.saveScroll();\n\n        if (!this.restoreActiveComponent())\n        {\n            this.marker.restore();\n        }\n\n        this._clearSaved();\n        this.editor.restoreScroll();\n    },\n\n    // private\n    _getNextNode: function(node)\n    {\n        if (node.hasChildNodes()) return node.firstChild;\n\n        while (node && !node.nextSibling)\n        {\n            node = node.parentNode;\n        }\n\n        if (!node) return null;\n\n        return node.nextSibling;\n    },\n    _getNodesComponent: function(component)\n    {\n        var current = this.getCurrent();\n        var data = this.inspector.parse(current);\n\n        return (data.isFigcaption()) ? [data.getFigcaption()] : [component];\n    },\n    _getRangeSelectedNodes: function()\n    {\n        var nodes = [];\n        var range = this.getRange();\n        var node = range.startContainer;\n        var startNode = range.startContainer;\n        var endNode = range.endContainer;\n        var $editor = this.editor.getElement();\n\n        // editor\n        if (startNode === $editor.get() && this.isAll())\n        {\n            nodes = this.utils.getChildNodes($editor);\n        }\n        // single node\n        else if (node === endNode)\n        {\n            nodes = [node];\n        }\n        else\n        {\n            while (node && node !== endNode)\n            {\n                nodes.push(node = this._getNextNode(node));\n            }\n\n            node = range.startContainer;\n            while (node && node !== range.commonAncestorContainer)\n            {\n                nodes.unshift(node);\n                node = node.parentNode;\n            }\n        }\n\n        return nodes;\n    },\n    _isInNodesArray: function(nodes, node)\n    {\n        return (nodes.indexOf(node) !== -1);\n    },\n    _filterEditor: function(nodes)\n    {\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var data = this.inspector.parse(nodes[i]);\n            if (data.isInEditor())\n            {\n                filteredNodes.push(nodes[i]);\n            }\n        }\n\n        return filteredNodes;\n    },\n    _filterServicesNodes: function(nodes)\n    {\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var $el = $R.dom(nodes[i]);\n            var skip = false;\n\n            if (nodes[i] && nodes[i].nodeType === 3 && this.utils.isEmpty(nodes[i])) skip = true;\n            if ($el.hasClass('redactor-script-tag')\n                || $el.hasClass('redactor-component-caret')\n                || $el.hasClass('redactor-selection-marker')\n                || $el.hasClass('non-editable')) skip = true;\n\n            if (!skip)\n            {\n                filteredNodes.push(nodes[i]);\n            }\n        }\n\n        return filteredNodes;\n    },\n    _filterNodesTexts: function(nodes, options)\n    {\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            if (nodes[i].nodeType === 3 || (options.keepbr && nodes[i].tagName === 'BR'))\n            {\n                var inline = this.getInline(nodes[i]);\n                var isInline = (inline && options && options.inline === false);\n                if (!isInline)\n                {\n                    filteredNodes.push(nodes[i]);\n                }\n            }\n        }\n\n        return filteredNodes;\n    },\n    _filterNodesElements: function(nodes)\n    {\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            if (nodes[i].nodeType !== 3)\n            {\n                filteredNodes.push(nodes[i]);\n            }\n        }\n\n        return filteredNodes;\n    },\n    _filterNodesByTags: function(nodes, tags, passtexts)\n    {\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            if (passtexts && nodes[i].nodeType === 3)\n            {\n                filteredNodes.push(nodes[i]);\n            }\n            else if (nodes[i].nodeType !== 3)\n            {\n                var nodeTag = nodes[i].tagName.toLowerCase();\n                if (tags.indexOf(nodeTag.toLowerCase()) !== -1)\n                {\n                    filteredNodes.push(nodes[i]);\n                }\n            }\n        }\n\n        return filteredNodes;\n    },\n    _filterBlocksFirst: function(nodes)\n    {\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var $node = $R.dom(nodes[i]);\n            var parent = $node.parent().get();\n            var isFirst = ($node.parent().hasClass('redactor-in'));\n            var isCellParent = (parent && (parent.tagName === 'TD' || parent.tagName === 'TH'));\n            if (isFirst || isCellParent)\n            {\n                filteredNodes.push(nodes[i]);\n            }\n        }\n\n        return filteredNodes;\n    },\n    _filterInlinesInside: function(nodes)\n    {\n        var filteredNodes = [];\n        for (var i = 0; i < nodes.length; i++)\n        {\n            if (containsNode(nodes[i], true))\n            {\n                filteredNodes.push(nodes[i]);\n            }\n        }\n\n        return filteredNodes;\n    },\n    _isTextSelected: function(node, selected) {\n        var text = (node.nodeType !== 9) ? this.utils.removeInvisibleChars(node.textContent) : '';\n\n        return (\n            selected === text\n            || text.search(selected) !== -1\n            || selected.search(new RegExp('^' + this.utils.escapeRegExp(text) + '$')) !== -1\n        );\n    },\n    _isInlineNode: function(node)\n    {\n        var data = this.inspector.parse(node);\n\n        return (this.inspector.isInlineTag(node.tagName) && data.isInEditor());\n    },\n    _clearSaved: function()\n    {\n        this.saved = false;\n        this.savedComponent = false;\n        this.savedElement = false;\n    }\n});\n$R.add('service', 'element', {\n    init: function(app)\n    {\n        this.app = app;\n        this.rootElement = app.rootElement;\n\n        // local\n        this.$element = {};\n        this.type = 'inline';\n    },\n    start: function()\n    {\n        this._build();\n        this._buildType();\n    },\n\n    // public\n    isType: function(type)\n    {\n        return (type === this.type);\n    },\n    getType: function()\n    {\n        return this.type;\n    },\n    getElement: function()\n    {\n        return this.$element;\n    },\n\n    // private\n    _build: function()\n    {\n        this.$element = $R.dom(this.rootElement);\n    },\n    _buildType: function()\n    {\n        var tag = this.$element.get().tagName;\n\n        this.type = (tag === 'TEXTAREA') ? 'textarea' : this.type;\n        this.type = (tag === 'DIV') ? 'div' : this.type;\n        this.type = (this.opts.inline) ? 'inline' : this.type;\n    }\n});\n$R.add('service', 'editor', {\n    init: function(app)\n    {\n        this.app = app;\n\n        // local\n        this.scrolltop = false;\n        this.pasting = false;\n    },\n\n    // start\n    start: function()\n    {\n        this._build();\n    },\n\n    // focus\n    focus: function()\n    {\n        if (!this.isFocus() && !this._isContenteditableFocus())\n        {\n            this.saveScroll();\n            this.$editor.focus();\n            this.restoreScroll();\n        }\n    },\n    startFocus: function()\n    {\n        this.caret.setStart(this.getFirstNode());\n    },\n    endFocus: function()\n    {\n        this.caret.setEnd(this.getLastNode());\n    },\n\n    // pasting\n    isPasting: function()\n    {\n        return this.pasting;\n    },\n    enablePasting: function()\n    {\n        this.pasting = true;\n    },\n    disablePasting: function()\n    {\n        this.pasting = false;\n    },\n\n    // scroll\n    saveScroll: function()\n    {\n        this.scrolltop = this._getScrollTarget().scrollTop();\n        if (this.opts.maxHeight) {\n            this.scrolltopin = this.$editor.scrollTop();\n        }\n\n    },\n    restoreScroll: function()\n    {\n        if (this.scrolltop !== false)\n        {\n            this._getScrollTarget().scrollTop(this.scrolltop);\n            this.scrolltop = false;\n        }\n\n        if (this.scrolltopin) {\n            this.$editor.scrollTop(this.scrolltopin);\n            this.scrolltopin = false;\n        }\n    },\n\n    // non editables\n    disableNonEditables: function()\n    {\n        this.$noneditables = this.$editor.find('[contenteditable=false]');\n        this.$noneditables.attr('contenteditable', true);\n    },\n    enableNonEditables: function()\n    {\n        if (this.$noneditables)\n        {\n            setTimeout(function() { this.$noneditables.attr('contenteditable', false); }.bind(this), 1);\n        }\n    },\n\n    // nodes\n    getFirstNode: function()\n    {\n        return this.$editor.contents()[0];\n    },\n    getLastNode: function()\n    {\n        var nodes = this.$editor.contents();\n\n        return nodes[nodes.length-1];\n    },\n\n    // utils\n    isSourceMode: function()\n    {\n        var $source = this.source.getElement();\n\n        return $source.hasClass('redactor-source-open');\n    },\n    isEditor: function(el)\n    {\n        var node = $R.dom(el).get();\n\n        return (node === this.$editor.get());\n    },\n    isEmpty: function(keeplists)\n    {\n        return this.utils.isEmptyHtml(this.$editor.html(), false, keeplists);\n    },\n    isFocus: function()\n    {\n        var $active = $R.dom(document.activeElement);\n        var isComponentSelected = (this.$editor.find('.redactor-component-active').length !== 0);\n\n        return (isComponentSelected || $active.closest('.redactor-in-' + this.uuid).length !== 0);\n    },\n    setEmpty: function()\n    {\n        this.$editor.html(this.opts.emptyHtml);\n    },\n\n    // element\n    getElement: function()\n    {\n        return this.$editor;\n    },\n\n    // private\n    _build: function()\n    {\n        var $element = this.element.getElement();\n        var editableElement = (this.element.isType('textarea')) ? '<div>' : $element.get();\n\n        this.$editor = $R.dom(editableElement);\n    },\n    _getScrollTarget: function()\n    {\n        var $target = this.$doc;\n        if (this.opts.toolbarFixedTarget !== document)\n        {\n            $target = $R.dom(this.opts.toolbarFixedTarget);\n        }\n        else\n        {\n            $target = (this.opts.scrollTarget) ? $R.dom(this.opts.scrollTarget) : $target;\n        }\n\n        return $target;\n    },\n    _isContenteditableFocus: function()\n    {\n        var block = this.selection.getBlock();\n        var $blockParent = (block) ? $R.dom(block).closest('[contenteditable=true]').not('.redactor-in') : [];\n\n        return ($blockParent.length !== 0);\n    }\n});\n$R.add('service', 'container', {\n    init: function(app)\n    {\n        this.app = app;\n    },\n    // public\n    start: function()\n    {\n        this._build();\n    },\n    getElement: function()\n    {\n        return this.$container;\n    },\n\n    // private\n    _build: function()\n    {\n        var tag = (this.element.isType('inline')) ? '<span>' : '<div>';\n        this.$container = $R.dom(tag);\n    }\n});\n$R.add('service', 'source', {\n    init: function(app)\n    {\n        this.app = app;\n\n        // local\n        this.$source = {};\n        this.content = '';\n    },\n    // public\n    start: function()\n    {\n        this._build();\n        this._buildName();\n        this._buildStartedContent();\n    },\n    getElement: function()\n    {\n        return this.$source;\n    },\n    getCode: function()\n    {\n        return this.$source.val();\n    },\n    getName: function()\n    {\n        return this.$source.attr('name');\n    },\n    getStartedContent: function()\n    {\n        return this.content;\n    },\n    setCode: function(html)\n    {\n        return this.insertion.set(html, true, false);\n    },\n    isNameGenerated: function()\n    {\n        return (this.name);\n    },\n    rebuildStartedContent: function()\n    {\n        this._buildStartedContent();\n    },\n\n    // private\n    _build: function()\n    {\n        var $element = this.element.getElement();\n        var isTextarea = this.element.isType('textarea');\n        var sourceElement = (isTextarea) ? $element.get() : '<textarea>';\n\n        this.$source = $R.dom(sourceElement);\n    },\n    _buildName: function()\n    {\n        var $element = this.element.getElement();\n\n        this.name = $element.attr('name');\n        this.$source.attr('name', (this.name) ? this.name : 'content-' + this.uuid);\n    },\n    _buildStartedContent: function()\n    {\n        var $element = this.element.getElement();\n        var content = (this.element.isType('textarea')) ? $element.val() : $element.html();\n\n        this.content = content.trim();\n    }\n});\n$R.add('service', 'statusbar', {\n    init: function(app)\n    {\n        this.app = app;\n\n        // local\n        this.$statusbar = {};\n        this.items = [];\n    },\n    // public\n    start: function()\n    {\n        this.$statusbar = $R.dom('<ul>');\n        this.$statusbar.attr('dir', this.opts.direction);\n    },\n    add: function(name, html)\n    {\n        return this.update(name, html);\n    },\n    update: function(name, html)\n    {\n        var $item;\n        if (typeof this.items[name] !== 'undefined')\n        {\n            $item = this.items[name];\n        }\n        else\n        {\n            $item = $R.dom('<li>');\n            this.$statusbar.append($item);\n            this.items[name] = $item;\n        }\n\n        return $item.html(html);\n    },\n    get: function(name)\n    {\n        return (this.items[name]) ? this.items[name] : false;\n    },\n    remove: function(name)\n    {\n        if (this.items[name])\n        {\n            this.items[name].remove();\n            delete this.items[name];\n        }\n    },\n    getItems: function()\n    {\n        return this.items;\n    },\n    removeItems: function()\n    {\n        this.items = {};\n        this.$statusbar.html('');\n    },\n    getElement: function()\n    {\n        return this.$statusbar;\n    }\n});\n$R.add('service', 'toolbar', {\n    init: function(app)\n    {\n        this.app = app;\n\n        // local\n        this.buttons = [];\n        this.dropdownOpened = false;\n        this.buttonsObservers = {};\n    },\n    // public\n    start: function()\n    {\n        if (this.is())\n        {\n            this.opts.activeButtons = (this.opts.activeButtonsAdd) ? this._extendActiveButtons() : this.opts.activeButtons;\n            this.create();\n        }\n    },\n    stopObservers: function()\n    {\n        this.buttonsObservers = {};\n    },\n    create: function()\n    {\n        this.$wrapper = $R.dom('<div>');\n        this.$toolbar = $R.dom('<div>');\n    },\n    observe: function()\n    {\n        if (!this.is()) return;\n\n        this.setButtonsInactive();\n\n        var button, observer;\n\n        // observers\n        for (var name in this.buttonsObservers)\n        {\n            observer = this.buttonsObservers[name];\n            button = this.getButton(name);\n            this.app.broadcast('button.' + observer + '.observe', button);\n        }\n\n        // inline buttons\n        var buttons = this.opts.activeButtons;\n        var inlines = this.selection.getInlinesAllSelected();\n        var current = this.selection.getInline();\n        var currents = this.selection.getInlineAll();\n\n        if (this.selection.isCollapsed())\n        {\n            if (current) inlines.push(current);\n            if (currents.length !== 0) {\n                inlines = inlines.concat(currents);\n            }\n        }\n\n        var tags = this._inlinesToTags(inlines);\n        for (var key in buttons)\n        {\n            if (tags.indexOf(key) !== -1)\n            {\n                button = this.getButton(buttons[key]);\n                if (button) {\n                    button.setActive();\n                }\n            }\n\n        }\n    },\n\n    // is\n    is: function()\n    {\n        return !(!this.opts.toolbar || (this.detector.isMobile() && this.opts.air));\n    },\n    isAir: function()\n    {\n        return (this.is()) ? this.$toolbar.hasClass('redactor-air') : false;\n    },\n    isFixed: function()\n    {\n        return (this.is()) ? this.$toolbar.hasClass('redactor-toolbar-fixed') : false;\n    },\n    isContextBar: function()\n    {\n        var $bar = this.$body.find('#redactor-context-toolbar-' + this.uuid);\n        return $bar.hasClass('open');\n    },\n    isTarget: function()\n    {\n        return (this.opts.toolbarFixedTarget !== document);\n    },\n\n    // get\n    getElement: function()\n    {\n        return this.$toolbar;\n    },\n    getWrapper: function()\n    {\n        return this.$wrapper;\n    },\n    getDropdown: function()\n    {\n        return this.dropdownOpened;\n    },\n    getTargetElement: function()\n    {\n        return $R.dom(this.opts.toolbarFixedTarget);\n    },\n    getButton: function(name)\n    {\n        var $btn = this._findButton('.re-' + name);\n\n        return ($btn.length !== 0) ? $btn.dataget('data-button-instance') : false;\n    },\n    getButtons: function()\n    {\n        var buttons = [];\n        this._findButtons().each(function(node)\n        {\n            var $node = $R.dom(node);\n            buttons.push($node.dataget('data-button-instance'));\n        });\n\n        return buttons;\n    },\n    getButtonsKeys: function()\n    {\n        var keys = [];\n        this._findButtons().each(function(node)\n        {\n            var $node = $R.dom(node);\n            keys.push($node.attr('data-re-name'));\n        });\n\n        return keys;\n    },\n\n    // add\n    addButton: function(name, btnObj, position, $el, start)\n    {\n        position = position || 'end';\n\n        var $button = $R.create('toolbar.button', this.app, name, btnObj);\n        if (btnObj.observe)\n        {\n            this.opts.activeButtonsObservers[name] = { observe: btnObj.observe, button: $button };\n        }\n\n        if (this.is())\n        {\n            if (position === 'first') this.$toolbar.prepend($button);\n            else if (position === 'after') $el.after($button);\n            else if (position === 'before') $el.before($button);\n            else {\n                var index = this.opts.buttons.indexOf(name);\n                if (start !== true && index !== -1) {\n                    if (index === 0) {\n                        this.$toolbar.prepend($button);\n                    }\n                    else {\n                        var $btns = this._findButtons();\n                        var $btn = $btns.eq(index-1);\n                        if ($btn.length > 0) {\n                            $btn.after($button);\n                        }\n                        else {\n                            this.$toolbar.append($button);\n                        }\n                    }\n                }\n                else {\n                    this.$toolbar.append($button);\n                }\n            }\n        }\n\n        return $button;\n    },\n    addButtonFirst: function(name, btnObj)\n    {\n        return this.addButton(name, btnObj, 'first');\n    },\n    addButtonAfter: function(after, name, btnObj)\n    {\n        var $btn = this.getButton(after);\n\n        return ($btn) ? this.addButton(name, btnObj, 'after', $btn) : this.addButton(name, btnObj);\n    },\n    addButtonBefore: function(before, name, btnObj)\n    {\n        var $btn = this.getButton(before);\n\n        return ($btn) ? this.addButton(name, btnObj, 'before', $btn) : this.addButton(name, btnObj);\n    },\n    addButtonObserver: function(name, observer)\n    {\n        this.buttonsObservers[name] = observer;\n    },\n\n    // set\n    setButtons: function(buttons)\n    {\n        this.buttons = buttons;\n    },\n    setDropdown: function(dropdown)\n    {\n        this.dropdownOpened = dropdown;\n    },\n    setButtonsInactive: function()\n    {\n        var $buttons = this.getButtons();\n        for (var i = 0; i < $buttons.length; i++)\n        {\n            $buttons[i].setInactive();\n        }\n    },\n    setButtonsActive: function()\n    {\n        var $buttons = this.getButtons();\n        for (var i = 0; i < $buttons.length; i++)\n        {\n            $buttons[i].setActive();\n        }\n    },\n\n    // disable & enable\n    disableButtons: function()\n    {\n        var $buttons = this.getButtons();\n        for (var i = 0; i < $buttons.length; i++)\n        {\n            $buttons[i].disable();\n        }\n    },\n    enableButtons: function()\n    {\n        var $buttons = this.getButtons();\n        for (var i = 0; i < $buttons.length; i++)\n        {\n            $buttons[i].enable();\n        }\n\n    },\n\n    // private\n    _findButton: function(selector)\n    {\n        return (this.is()) ? this.$toolbar.find(selector) : $R.dom();\n    },\n    _findButtons: function()\n    {\n        return (this.is()) ? this.$toolbar.find('.re-button') : $R.dom();\n    },\n    _extendActiveButtons: function()\n    {\n        return $R.extend({}, this.opts.activeButtons, this.opts.activeButtonsAdd);\n    },\n    _inlinesToTags: function(inlines)\n    {\n        var tags = [];\n        for (var i = 0; i < inlines.length; i++)\n        {\n            tags.push(inlines[i].tagName.toLowerCase());\n        }\n\n        return tags;\n    }\n});\n$R.add('class', 'toolbar.button', {\n    mixins: ['dom'],\n    init: function(app, name, btnObj)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.lang = app.lang;\n        this.$body = app.$body;\n        this.toolbar = app.toolbar;\n        this.detector = app.detector;\n\n        // local\n        this.obj = btnObj;\n        this.name = name;\n        this.dropdown = false;\n        this.tooltip = false;\n\n        // init\n        this._init();\n    },\n    // is\n    isActive: function()\n    {\n        return this.hasClass('redactor-button-active');\n    },\n    isDisabled: function()\n    {\n        return this.hasClass('redactor-button-disabled');\n    },\n\n    // has\n    hasIcon: function()\n    {\n        return (this.obj.icon && !this.opts.buttonsTextLabeled);\n    },\n\n    // set\n    setDropdown: function(dropdown)\n    {\n        this.obj.dropdown = dropdown;\n        this.obj.message = false;\n        this.dropdown = $R.create('toolbar.dropdown', this.app, this.name, this.obj.dropdown);\n        this.attr('data-dropdown', true);\n    },\n    setMessage: function(message, args)\n    {\n        this.obj.message = message;\n        this.obj.args = args;\n        this.obj.dropdown = false;\n    },\n    setApi: function(api, args)\n    {\n        this.obj.api = api;\n        this.obj.args = args;\n        this.obj.dropdown = false;\n    },\n    setTitle: function(title)\n    {\n        this.obj.title = this.lang.parse(title);\n        this.obj.tooltip = this.obj.title;\n\n        this.attr({ 'alt': this.obj.tooltip, 'aria-label': this.obj.tooltip });\n        if (!this.attr('data-re-icon')) this.html(this.obj.title);\n    },\n    setTooltip: function(tooltip)\n    {\n        this.obj.tooltip = this.lang.parse(tooltip);\n        this.attr({ 'alt': this.obj.tooltip, 'aria-label': this.obj.tooltip });\n    },\n    setIcon: function(icon)\n    {\n        if (this.opts.buttonsTextLabeled) return;\n\n        this.obj.icon = true;\n        this.$icon = $R.dom(icon);\n\n        this.html('');\n        this.append(this.$icon);\n        this.attr('data-re-icon', true);\n        this.addClass('re-button-icon');\n        this.setTooltip(this.obj.title);\n        this._buildTooltip();\n    },\n    setActive: function()\n    {\n        this.addClass('redactor-button-active');\n    },\n    setInactive: function()\n    {\n        this.removeClass('redactor-button-active');\n    },\n\n    // hide\n    hideTooltip: function()\n    {\n        this.$body.find('.re-button-tooltip').remove();\n    },\n\n    // get\n    getDropdown: function()\n    {\n        return this.dropdown;\n    },\n\n    // enable & disable\n    disable: function()\n    {\n        this.addClass('redactor-button-disabled');\n    },\n    enable: function()\n    {\n        this.removeClass('redactor-button-disabled');\n    },\n\n    // toggle\n    toggle: function(e)\n    {\n        if (e) e.preventDefault();\n        if (this.isDisabled()) return;\n\n        if (this.obj.dropdown)\n        {\n            this.dropdown.toggle(e);\n        }\n        else if (this.obj.api)\n        {\n            // broadcast\n            this.app.api(this.obj.api, this.obj.args, this.name);\n        }\n        else if (this.obj.message)\n        {\n            // broadcast\n            this.app.broadcast(this.obj.message, this.obj.args, this.name);\n        }\n\n        this.hideTooltip();\n    },\n\n    // private\n    _init: function()\n    {\n        // parse\n        this._parseTitle();\n        this._parseTooltip();\n\n        // build\n        this._build();\n        this._buildCallback();\n        this._buildAttributes();\n        this._buildObserver();\n\n        if (this.hasIcon())\n        {\n            this._buildIcon();\n            this._buildTooltip();\n        }\n        else\n        {\n            this.html(this.obj.title);\n        }\n    },\n    _parseTooltip: function()\n    {\n        this.obj.tooltip = (this.obj.tooltip) ? this.lang.parse(this.obj.tooltip) : this.obj.title;\n    },\n    _parseTitle: function()\n    {\n        this.obj.title = this.lang.parse(this.obj.title);\n    },\n    _build: function()\n    {\n        this.parse('<a>');\n        this.addClass('re-button re-' + this.name);\n        this.attr('data-re-name', this.name);\n        this.dataset('data-button-instance', this);\n\n        if (this.obj.dropdown) this.setDropdown(this.obj.dropdown);\n    },\n    _buildCallback: function()\n    {\n        this.on('click', this.toggle.bind(this));\n    },\n    _buildAttributes: function()\n    {\n        var attrs = {\n            'href': '#',\n            'alt': this.obj.tooltip,\n            'rel': this.name,\n            'role': 'button',\n            'aria-label': this.obj.tooltip,\n            'tabindex': '-1'\n        };\n\n        this.attr(attrs);\n    },\n    _buildObserver: function()\n    {\n        if (typeof this.obj.observe !== 'undefined')\n        {\n            this.toolbar.addButtonObserver(this.name, this.obj.observe);\n        }\n    },\n    _buildIcon: function()\n    {\n        var icon = this.obj.icon;\n        var isHtml = (/(<([^>]+)>)/ig.test(icon));\n\n        this.$icon = (isHtml) ? $R.dom(icon) : $R.dom('<i>');\n        if (!isHtml) this.$icon.addClass('re-icon-' + this.name);\n\n        this.append(this.$icon);\n        this.attr('data-re-icon', true);\n        this.addClass('re-button-icon');\n    },\n    _buildTooltip: function()\n    {\n        if (this.detector.isDesktop())\n        {\n            this.tooltip = $R.create('toolbar.button.tooltip', this.app, this);\n        }\n    }\n});\n$R.add('class', 'toolbar.button.tooltip', {\n    mixins: ['dom'],\n    init: function(app, $button)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.opts = app.opts;\n        this.$body = app.$body;\n        this.toolbar = app.toolbar;\n\n        // local\n        this.$button = $button;\n        this.created = false;\n\n        // init\n        this._init();\n    },\n    open: function()\n    {\n        if (this.$button.hasClass('redactor-button-disabled') || this.$button.hasClass('redactor-button-active')) return;\n\n        this.created = true;\n        this.parse('<span>');\n        this.addClass('re-button-tooltip re-button-tooltip-' + this.uuid);\n        this.$body.append(this);\n        this.html(this.$button.attr('alt'));\n\n        var offset = this.$button.offset();\n        var position = 'absolute';\n        var height = this.$button.height();\n        var width = this.$button.width();\n        var arrowOffset = 4;\n\n        this.css({\n            top: (offset.top + height + arrowOffset) + 'px',\n            left: (offset.left + width/2 - this.width()/2) + 'px',\n            position: position\n        });\n\n        this.show();\n    },\n    close: function()\n    {\n        if (!this.created || this.$button.hasClass('redactor-button-disabled')) return;\n\n        this.remove();\n        this.created = false;\n    },\n\n    // private\n    _init: function()\n    {\n        this.$button.on('mouseover', this.open.bind(this));\n        this.$button.on('mouseout', this.close.bind(this));\n    }\n});\n$R.add('class', 'toolbar.dropdown', {\n    mixins: ['dom'],\n    init: function(app, name, items)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.opts = app.opts;\n        this.$win = app.$win;\n        this.$doc = app.$doc;\n        this.$body = app.$body;\n        this.animate = app.animate;\n        this.toolbar = app.toolbar;\n\n        // local\n        this.name = name;\n        this.started = false;\n        this.items = (name === 'format') ? $R.extend({}, true, items) : items;\n        this.$items = [];\n    },\n    // public\n    toggle: function(e)\n    {\n        if (!this.started)\n        {\n            this._build();\n        }\n\n        // toggle\n        if (this.isOpened() && this.isActive())\n        {\n            this.close(false);\n        }\n        else\n        {\n            this.open(e);\n        }\n    },\n    isOpened: function()\n    {\n        var $dropdown = this.$body.find('.redactor-dropdown-' + this.uuid + '.open');\n\n        return ($dropdown.length !== 0 && $dropdown.attr('data-re-name') === this.name);\n    },\n    isActive: function()\n    {\n        var $dropdown = this.$body.find('#redactor-dropdown-' + this.uuid + '-' + this.name + '.open');\n        return ($dropdown.length !== 0);\n    },\n    getName: function()\n    {\n        return this.attr('data-re-name');\n    },\n    getItem: function(name)\n    {\n        return this.$items[name];\n    },\n    getItemsByClass: function(classname)\n    {\n        var result = [];\n        for (var key in this.$items) {\n            var item = this.$items[key];\n            if (typeof item === 'object' && item.attr('data-re-name') && item.hasClass(classname)) {\n                result.push(item);\n            }\n        }\n\n        return result;\n    },\n    open: function(e)\n    {\n        this._closeAll();\n\n        this.$btn = this.toolbar.getButton(this.name);\n        this.app.broadcast('dropdown.open', e, this, this.$btn);\n        this.toolbar.setDropdown(this);\n\n        this.show();\n        this.removeClass('redactor-animate-hide');\n        this.addClass('open');\n        this._observe();\n\n        this.$btn.hideTooltip();\n        this.$btn.setActive();\n\n        this.$doc.on('keyup.redactor.dropdown-' + this.uuid, this._handleKeyboard.bind(this));\n        this.$doc.on('click.redactor.dropdown-' + this.uuid, this.close.bind(this));\n\n        this.updatePosition();\n        this.app.broadcast('dropdown.opened', e, this, this.$btn);\n\n    },\n    close: function(e, animate)\n    {\n        if (e)\n        {\n            var $el = $R.dom(e.target);\n            if (this._isButton(e) || $el.hasClass('redactor-dropdown-not-close') || $el.hasClass('redactor-dropdown-item-disabled'))\n            {\n                e.preventDefault();\n                return;\n            }\n        }\n\n        this.app.broadcast('dropdown.close', this, this.$btn);\n        this.toolbar.setDropdown(false);\n\n        this.$btn.setInactive();\n        if (animate === false)\n        {\n            this._close();\n        }\n        else\n        {\n            this.animate.start(this, 'fadeOut', this._close.bind(this));\n        }\n    },\n    updatePosition: function()\n    {\n        var isFixed = this.toolbar.isFixed();\n        var isTarget = this.toolbar.isTarget();\n\n        var btnHeight = this.$btn.height();\n        var btnWidth = this.$btn.width();\n\n        var pos = this.$btn.offset();\n        var position = 'absolute';\n        var topOffset = 2;\n\n\n        if (isFixed) {\n            //pos.top = (isTarget) ? this.$btn.offset().top : this.$btn.position().top;\n            //position = 'fixed';\n            //topOffset = topOffset + this.opts.toolbarFixedTopOffset;\n        }\n\n        var leftOffset = 0;\n        var left = (pos.left + leftOffset);\n        var width = parseFloat(this.css('width'));\n        var winWidth = this.$win.width();\n        var leftFix = (winWidth < (left + width)) ? (width - btnWidth) : 0;\n        var leftPos = (left - leftFix);\n        var top = (pos.top + btnHeight + topOffset);\n        leftPos = (leftPos < 0) ? 4 : leftPos;\n\n        this.css({\n            maxHeight: '',\n            position: position,\n            top: top + 'px',\n            left: leftPos + 'px'\n        });\n\n        // height adaptive\n        var heightTolerance = 10;\n        var winHeight = this.$win.height();\n        var scrollTop = this.$doc.scrollTop();\n        var cropHeight = winHeight - (top - scrollTop) - heightTolerance;\n\n        this.css('max-height', cropHeight + 'px');\n    },\n\n    // private\n    _build: function()\n    {\n        this.parse('<div>');\n        this.attr('dir', this.opts.direction);\n        this.attr('id', 'redactor-dropdown-' + this.uuid + '-' + this.name);\n        this.attr('data-re-name', this.name);\n\n        this.addClass('redactor-dropdown redactor-dropdown-' + this.uuid + ' redactor-dropdown-' + this.name);\n        this.dataset('data-dropdown-instance', this);\n        var isDom = (this.items.sdom || typeof this.items === 'string');\n\n        if (isDom) this._buildDom();\n        else this._buildItems();\n\n        this.$body.append(this);\n        this.started = true;\n    },\n    _buildDom: function()\n    {\n        this.html('').append($R.dom(this.items));\n    },\n    _buildItems: function()\n    {\n        this.items = (this.name === 'format') ? this._buildFormattingItems() : this.items;\n\n        for (var key in this.items)\n        {\n            var obj = this.items[key];\n\n            if (key === 'observe')\n            {\n                this.attr('data-observe', this.items[key]);\n            }\n            else\n            {\n                var $item = $R.create('toolbar.dropdown.item', this.app, key, obj, this);\n\n                this.$items[key] = $item;\n                this.append($item);\n            }\n        }\n    },\n    _buildFormattingItems: function()\n    {\n        // build the format set\n        for (var key in this.items)\n        {\n            if (this.opts.formatting.indexOf(key) === -1) delete this.items[key];\n        }\n\n        // remove from the format set\n        if (this.opts.formattingHide)\n        {\n            for (var key in this.items)\n            {\n                if (this.opts.formattingHide.indexOf(key) !== -1) delete this.items[key];\n            }\n        }\n\n        // add to the format set\n        if (this.opts.formattingAdd)\n        {\n            for (var key in this.opts.formattingAdd)\n            {\n                this.items[key] = this.opts.formattingAdd[key];\n            }\n        }\n\n        return this.items;\n    },\n    _handleKeyboard: function(e)\n    {\n        if (e.which === 27) this.close();\n    },\n    _isButton: function(e)\n    {\n        var $el = $R.dom(e.target);\n        var $btn = $el.closest('.re-button');\n\n        return ($btn.get() === this.$btn.get());\n    },\n    _close: function()\n    {\n        this.$btn.setInactive();\n        this.$doc.off('.redactor.dropdown-' + this.uuid);\n        this.removeClass('open');\n        this.addClass('redactor-animate-hide');\n        this.app.broadcast('dropdown.closed', this, this.$btn);\n    },\n    _closeAll: function()\n    {\n        this.$body.find('.redactor-dropdown-' + this.uuid + '.open').each(function(node)\n        {\n            var $node = $R.dom(node);\n            var instance =  $node.dataget('data-dropdown-instance');\n            instance._close();\n        });\n    },\n    _observe: function()\n    {\n        var observer = this.attr('data-observe');\n        if (observer)\n        {\n            this.app.broadcast('dropdown.' + observer + '.observe', this);\n        }\n    }\n});\n$R.add('class', 'toolbar.dropdown.item', {\n    mixins: ['dom'],\n    init: function(app, name, obj, dropdown)\n    {\n        this.app = app;\n        this.lang = app.lang;\n\n        // local\n        this.dropdown = dropdown;\n        this.name = name;\n        this.obj = obj;\n\n        // init\n        this._init();\n    },\n    setTitle: function(html)\n    {\n        this.$span.html(html);\n    },\n    getTitle: function()\n    {\n        return this.$span.html();\n    },\n    enable: function()\n    {\n        this.removeClass('redactor-dropdown-item-disabled');\n    },\n    disable: function()\n    {\n        this.addClass('redactor-dropdown-item-disabled');\n    },\n    toggle: function(e)\n    {\n        if (e) e.preventDefault();\n        if (this.hasClass('redactor-dropdown-item-disabled')) return;\n\n        if (this.obj.message)\n        {\n            // broadcast\n            this.app.broadcast(this.obj.message, this.obj.args, this.name);\n        }\n        else if (this.obj.api)\n        {\n            this.app.api(this.obj.api, this.obj.args, this.name);\n        }\n    },\n\n    // private\n    _init: function()\n    {\n        this.parse('<a>');\n        this.attr('href', '#');\n        this.addClass('redactor-dropdown-item-' + this.name);\n\n        if (this.obj.classname)\n        {\n            this.addClass(this.obj.classname);\n        }\n\n        this.attr('data-re-name', this.name);\n        this.on('click', this.toggle.bind(this));\n\n        this.$span = $R.dom('<span>');\n        this.append(this.$span);\n        this.setTitle(this.lang.parse(this.obj.title));\n    }\n});\n$R.add('service', 'cleaner', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n\n        // local\n        this.storedComponents = [];\n        this.storedComments = [];\n        this.storedImages = [];\n        this.storedLinks = [];\n        this.deniedTags = ['font', 'html', 'head', 'link', 'title', 'body', 'meta', 'applet'];\n        this.convertRules = {};\n        this.unconvertRules = {};\n\n        // regex\n        this.reComments = /<!--[\\s\\S]*?-->\\n?/g;\n        this.reSpacedEmpty = /^(||\\s||<br\\s?\\/?>||&nbsp;)$/i;\n        this.reScriptTag = /<script(.*?[^>]?)>([\\w\\W]*?)<\\/script>/gi;\n    },\n    // public\n    addConvertRules: function(name, func)\n    {\n        this.convertRules[name] = func;\n    },\n    addUnconvertRules: function(name, func)\n    {\n        this.unconvertRules[name] = func;\n    },\n    input: function(html, paragraphize, started)\n    {\n        // fix &curren; entity in the links\n        html = html.replace(/¤t/gi, '&current');\n\n        // store\n        var storedComments = [];\n        html = this.storeComments(html, storedComments);\n\n        // pre/code\n        html = this.encodeCode(html);\n\n        // sanitize\n        var $wrapper = this.utils.buildWrapper(html);\n        $wrapper.find('a, b, i, strong, em, img, svg, details, audio').removeAttr('onload onerror ontoggle onwheel onmouseover oncopy');\n        $wrapper.find('a, iframe, embed').each(function(node) {\n            var $node = $R.dom(node);\n            var href = $node.attr('href');\n            var src = $node.attr('src');\n            if (href && href.trim().search(/^data|javascript:/i) !== -1) $node.attr('href', '');\n            if (src && src.trim().search(/^data|javascript:/i) !== -1) $node.attr('src', '');\n        });\n\n        var imageattrs = ['alt', 'title', 'src', 'class', 'width', 'height', 'srcset', 'style', 'usemap'];\n        $wrapper.find('img').each(function(node) {\n            if (node.attributes.length > 0) {\n                var attrs = node.attributes;\n                for (var i = attrs.length - 1; i >= 0; i--) {\n                    var removeAttrs = (attrs[i].name.search(/^data-/) === -1 && imageattrs.indexOf(attrs[i].name) === -1);\n                    var removeDataSrc = (attrs[i].name === 'src' && attrs[i].value.search(/^data|javascript:/i) !== -1);\n                    if (this.opts.imageSrcData) removeDataSrc = false;\n\n                    if (removeAttrs || removeDataSrc) {\n                        node.removeAttribute(attrs[i].name);\n                    }\n                }\n            }\n        }.bind(this));\n\n        // get wrapper html\n        html = this.utils.getWrapperHtml($wrapper);\n\n        // converting entity\n        html = html.replace(/\\$/g, '&#36;');\n        html = html.replace(/&amp;/g, '&');\n\n        // convert to figure\n        var converter = $R.create('cleaner.figure', this.app);\n        html = converter.convert(html, this.convertRules);\n\n        // store components\n        html = this.storeComponents(html);\n\n        // clean\n        html = this.replaceTags(html, this.opts.replaceTags);\n        html = this._setSpanAttr(html);\n        html = this._setStyleCache(html);\n        html = this.removeTags(html, this.deniedTags);\n        html = (this.opts.removeScript) ? this._removeScriptTag(html) : this._replaceScriptTag(html);\n        //html = (this.opts.removeScript) ? this._removeScriptTag(html) : html;\n        html = (this.opts.removeComments) ? this.removeComments(html) : html;\n        html = (this._isSpacedEmpty(html)) ? this.opts.emptyHtml : html;\n\n\n        // restore components\n        html = this.restoreComponents(html);\n\n\n        // clear wrapped components\n        html = this._cleanWrapped(html);\n\n        // restore comments\n        html = this.restoreComments(html, storedComments);\n\n        // paragraphize\n        html = (paragraphize) ? this.paragraphize(html) : html;\n\n        return html;\n    },\n    output: function(html, removeMarkers)\n    {\n        html = this.removeInvisibleSpaces(html);\n\n        if (this.opts.breakline) {\n            html = html.replace(/<\\/(span|strong|b|i|em)><br\\s?\\/?><\\/div>/gi, \"</$1></div>\");\n            html = html.replace(/<br\\s?\\/?><\\/(span|strong|b|i|em)><\\/div>/gi, \"</$1></div>\");\n        }\n\n        html = html.replace(/&#36;/g, '$');\n\n        // empty\n        if (this._isSpacedEmpty(html)) return '';\n        if (this._isParagraphEmpty(html)) return '';\n\n        html = this.removeServiceTagsAndAttrs(html, removeMarkers);\n\n        // store components\n        html = this.storeComponents(html);\n\n        html = this.removeSpanWithoutAttributes(html);\n        html = this.removeFirstBlockBreaklineInHtml(html);\n\n        html = (this.opts.removeScript) ? html : this._unreplaceScriptTag(html);\n        html = (this.opts.preClass) ? this._setPreClass(html) : html;\n        html = (this.opts.linkNofollow) ? this._setLinkNofollow(html) : html;\n        html = (this.opts.removeNewLines) ? this.cleanNewLines(html) : html;\n\n        // restore components\n        html = this.restoreComponents(html);\n\n        // convert to figure\n        var converter = $R.create('cleaner.figure', this.app);\n        html = converter.unconvert(html, this.unconvertRules);\n\n        // final clean up\n        html = this.removeEmptyAttributes(html, ['style', 'class', 'rel', 'alt', 'title']);\n        html = this.cleanSpacesInPre(html);\n        html = this.tidy(html);\n\n        // converting entity\n        html = html.replace(/&amp;/g, '&');\n\n        // breakline tidy\n        if (this.opts.breakline) {\n            html = html.replace(/<br\\s?\\/?>/gi, \"<br>\\n\");\n            html = html.replace(/<br\\s?\\/?>\\n+/gi, \"<br>\\n\");\n        }\n\n        // check whitespaces\n        html = (html.replace(/\\n/g, '') === '') ? '' : html;\n\n        return html;\n    },\n    paste: function(html)\n    {\n        // store components\n        html = this.storeComponents(html);\n\n        // remove comments\n        html = html.replace(/<!--[\\s\\S]*?-->/g, '');\n\n        // remove tags\n        var deniedTags = this.deniedTags.concat(['iframe']);\n        html = this.removeTags(html, deniedTags);\n\n        // remove doctype tag\n        html = html.replace(new RegExp(\"<!doctype([\\\\s\\\\S]+?)>\", 'gi'), '');\n\n        // remove style tag\n        html = html.replace(new RegExp(\"<style([\\\\s\\\\S]+?)</style>\", 'gi'), '');\n\n        // remove br between\n        html = html.replace(new RegExp(\"</p><br /><p\", 'gi'), '</p><p');\n\n        // gdocs & word\n        var isMsWord = this._isHtmlMsWord(html);\n\n        html = (isMsWord) ? html : this._cleanGDocs(html);\n        html = (isMsWord) ? this._cleanMsWord(html) : html;\n\n        // do not clean\n        if (!this.opts.pasteClean)\n        {\n            // restore components\n            html = this.restoreComponents(html);\n\n            return html;\n        }\n\n        // plain text\n        if (this.opts.pastePlainText)\n        {\n            // restore components\n            html = this.restoreComponents(html);\n\n            return this.pastePlainText(html);\n        }\n\n        // unconvert data redactor tag\n        var $wrapper = this.utils.buildWrapper(html);\n        $wrapper.find('*').removeAttr('style');\n        $wrapper.find('[data-redactor-tag]').each(function(node) {\n            var $node = $R.dom(node);\n            $node.removeAttr('data-redactor-tag');\n\n            if (this.utils.isEmptyHtml($node.html())) {\n                $node.html('<br>').unwrap();\n            }\n            else if (node.lastChild && node.lastChild.tagName === 'BR') {\n                $node.unwrap();\n            }\n            else {\n                $node.append('<br>').unwrap();\n            }\n        }.bind(this));\n        html = this.utils.getWrapperHtml($wrapper);\n        html = html.replace(/<br\\s?\\/?>$/, '');\n        html = html.replace(/<br\\s?\\/?><\\/(td|th)>/, '</$1>');\n\n        // remove tags\n        var exceptedTags = this.opts.pasteBlockTags.concat(this.opts.pasteInlineTags);\n        html = this.removeTagsExcept(html, exceptedTags);\n\n        // links & images\n        html = (this.opts.pasteLinks) ? html : this.removeTags(html, ['a']);\n        html = (this.opts.pasteImages) ? html : this.removeTags(html, ['img']);\n\n        // build wrapper\n        var $wrapper = this.utils.buildWrapper(html);\n\n        // clean attrs\n        var $elms = $wrapper.find('*');\n\n        // remove style\n        var filterStyle = (this.opts.pasteKeepStyle.length !== 0) ? ',' + this.opts.pasteKeepStyle.join(',') : '';\n        $elms.not('[data-redactor-style-cache]' + filterStyle).removeAttr('style');\n\n        // remove class\n        var filterClass = (this.opts.pasteKeepClass.length !== 0) ? ',' + this.opts.pasteKeepClass.join(',') : '';\n        $elms.not('[data-redactor-style-cache], span.redactor-component' + filterClass).removeAttr('class');\n\n        // remove attrs\n        var filterAttrs = (this.opts.pasteKeepAttrs.length !== 0) ? ',' + this.opts.pasteKeepAttrs.join(',') : '';\n        $elms.not('img, a, span.redactor-component, [data-redactor-style-cache]' + filterAttrs).each(function(node)\n        {\n            var attrs = node.attributes;\n            for (var i = attrs.length - 1; i >= 0; i--) {\n                if (node.attributes[i].name !== 'class' && node.attributes[i].name !== 'dir') {\n                    node.removeAttribute(attrs[i].name);\n                }\n            }\n        });\n\n        // paste link target\n        if (this.opts.pasteLinks && this.opts.pasteLinkTarget !== false)\n        {\n            $wrapper.find('a').attr('target', this.opts.pasteLinkTarget);\n        }\n\n        // keep style\n        $wrapper.find('[data-redactor-style-cache]').each(function(node)\n        {\n            var style = node.getAttribute('data-redactor-style-cache');\n            node.setAttribute('style', style);\n        });\n\n        // remove image attributes\n        var imageattrs = this.opts.imageAttrs;\n        $wrapper.find('img').each(function(node) {\n            if (node.attributes.length > 0) {\n                var attrs = node.attributes;\n                for (var i = attrs.length - 1; i >= 0; i--) {\n                    if (imageattrs.indexOf(attrs[i].name) === -1) {\n                        node.removeAttribute(attrs[i].name);\n                    }\n                }\n            }\n        });\n\n        // remove empty span\n        $wrapper.find('span').each(function(node)\n        {\n            if (node.attributes.length === 0)\n            {\n                $R.dom(node).unwrap();\n            }\n        });\n\n        // remove empty inline\n        $wrapper.find(this.opts.inlineTags.join(',')).each(function(node)\n        {\n            if (node.attributes.length === 0 && this.utils.isEmptyHtml(node.innerHTML))\n            {\n                $R.dom(node).unwrap();\n            }\n\n        }.bind(this));\n\n        // place ul/ol into li\n        $wrapper.find('ul, ol').each(function(node)\n        {\n            var prev = node.previousSibling;\n            if (prev && prev.tagName === 'LI')\n            {\n                var $li = $R.dom(prev);\n                $li.find('p').unwrap();\n                $li.append(node);\n            }\n        });\n\n        // get wrapper\n        html = this.utils.getWrapperHtml($wrapper);\n\n        // remove paragraphs form lists (google docs bug)\n        html = html.replace(/<li><p>/gi, '<li>');\n        html = html.replace(/<\\/p><\\/li>/gi, '</li>');\n\n        // gmail list paste\n        html = html.replace(/^<li/gi, '<ul><li');\n        html = html.replace(/<\\/li>$/gi, '</li></ul>');\n\n        // convert lines to br\n        if (this.opts.breakline) {\n            html = html.replace(/\\n/g, '<br>');\n        }\n\n        // clean empty p\n        html = html.replace(/<p>&nbsp;<\\/p>/gi, '<p></p>');\n        html = html.replace(/<p><br\\s?\\/?><\\/p>/gi, '<p></p>');\n\n        if (isMsWord)\n        {\n            html = html.replace(/<p><\\/p>/gi, '');\n            html = html.replace(/<p>\\s<\\/p>/gi, '');\n            html = html.replace(/<td\\n/gi, '<td ');\n        }\n\n        // restore components\n        html = this.restoreComponents(html);\n\n        return html;\n    },\n    pastePlainText: function(html)\n    {\n        html = (this.opts.pasteLinks) ? this.storeLinks(html) : html;\n        html = (this.opts.pasteImages) ? this.storeImages(html) : html;\n\n        html = this.getPlainText(html);\n        html = this._replaceNlToBr(html);\n\n        html = (this.opts.pasteLinks) ? this.restoreLinks(html) : html;\n        html = (this.opts.pasteImages) ? this.restoreImages(html) : html;\n\n        return html;\n    },\n    tidy: function(html)\n    {\n        return html;\n    },\n    paragraphize: function(html)\n    {\n        var paragraphize = $R.create('cleaner.paragraphize', this.app);\n        html = paragraphize.convert(html);\n        return html;\n    },\n    storeComments: function(html, storedComments) {\n        var comments = html.match(new RegExp('<!--([\\\\w\\\\W]*?)-->', 'gi'));\n        if (comments !== null) {\n            for (var i = 0; i < comments.length; i++) {\n                html = html.replace(comments[i], '#####xstarthtmlcommentzz' + i + 'xendhtmlcommentzz#####');\n                storedComments.push(comments[i]);\n            }\n        }\n\n        return html;\n    },\n    restoreComments: function(html, storedComments) {\n        for (var i = 0; i < storedComments.length; i++) {\n            html = html.replace('#####xstarthtmlcommentzz' + i + 'xendhtmlcommentzz#####', storedComments[i]);\n        }\n\n        return html;\n    },\n\n    // get\n    getFlatText: function(html)\n    {\n        var $div = $R.dom('<div>');\n\n        if (!html.nodeType && !html.dom)\n        {\n            html = html.toString();\n            html = html.trim();\n            $div.html(html);\n        }\n        else\n        {\n            $div.append(html);\n        }\n\n        html = $div.get().textContent || $div.get().innerText || '';\n\n        return (html === undefined) ? '' : html;\n    },\n\tgetPlainText: function(html)\n\t{\n\t\thtml = html.replace(/<!--[\\s\\S]*?-->/gi, '');\n\t\thtml = html.replace(/<style[\\s\\S]*?style>/gi, '');\n        html = html.replace(/<p><\\/p>/g, '');\n\t\thtml = html.replace(/<\\/div>|<\\/li>|<\\/td>/gi, '\\n');\n\t\thtml = html.replace(/<\\/p>/gi, '\\n\\n');\n\t\thtml = html.replace(/<\\/H[1-6]>/gi, '\\n\\n');\n\n\t\tvar tmp = document.createElement('div');\n\t\ttmp.innerHTML = html;\n\n\t\thtml = tmp.textContent || tmp.innerText;\n\n\t\treturn html.trim();\n\t},\n\n    // replace\n    replaceTags: function(html, tags)\n    {\n        if (tags)\n        {\n            var self = this;\n            var keys = Object.keys(tags);\n            var $wrapper = this.utils.buildWrapper(html);\n            $wrapper.find(keys.join(',')).each(function(node)\n            {\n                self.utils.replaceToTag(node, tags[node.tagName.toLowerCase()]);\n            });\n\n            html = this.utils.getWrapperHtml($wrapper);\n        }\n\n        return html;\n    },\n    replaceNbspToSpaces: function(html)\n    {\n        return html.replace('&nbsp;', ' ');\n    },\n    replaceBlocksToBr: function(html)\n    {\n        html = html.replace(/<div[^>]*><\\/div>/gi, '');\n        html = html.replace(/<td[^>]*><\\/td>/gi, '');\n        html = html.replace(/<\\/div>|<\\/li>|<\\/td>|<\\/p>|<\\/H[1-6]>/gi, '<br>');\n\n        return html;\n    },\n\n    // clean\n    cleanNewLines: function(html)\n    {\n        return html.replace(/\\r?\\n/g, \"\");\n    },\n    cleanSpacesInPre: function(html)\n    {\n        return html.replace('&nbsp;&nbsp;&nbsp;&nbsp;', '    ');\n    },\n\n    // remove\n    removeInvisibleSpaces: function(html)\n    {\n        html = this.utils.removeInvisibleChars(html);\n        html = html.replace(/&#65279;/gi, '');\n\n        return html;\n    },\n    removeNl: function(html)\n    {\n        html = html.replace(/\\n/g, \" \");\n        html = html.replace(/\\s+/g, \"\\s\");\n\n        return html;\n    },\n    removeBrAtEnd: function(html)\n    {\n        html = html.replace(/<br\\s?\\/?>$/gi, ' ');\n        html = html.replace(/<br\\s?\\/?><li/gi, '<li');\n\n        return html;\n    },\n    removeTags: function(input, denied)\n    {\n        var re = (denied) ? /<\\/?([a-z][a-z0-9]*)\\b[^>]*>/gi : /(<([^>]+)>)/gi;\n        var replacer = (!denied) ? '' : function ($0, $1)\n        {\n            return denied.indexOf($1.toLowerCase()) === -1 ? $0 : '';\n        };\n\n        return input.replace(re, replacer);\n    },\n    removeTagsExcept: function(input, except)\n    {\n        if (except === undefined) return input.replace(/(<([^>]+)>)/gi, '');\n\n        var tags = /<\\/?([a-z][a-z0-9]*)\\b[^>]*>/gi;\n        return input.replace(tags, function($0, $1)\n        {\n            return except.indexOf($1.toLowerCase()) === -1 ? '' : $0;\n        });\n    },\n    removeComments: function(html)\n    {\n        return html.replace(this.reComments, '');\n    },\n    removeServiceTagsAndAttrs: function(html, removeMarkers)\n    {\n        var $wrapper = this.utils.buildWrapper(html);\n        var self = this;\n        if (removeMarkers !== false)\n        {\n            $wrapper.find('.redactor-selection-marker').each(function(node)\n            {\n                var $el = $R.dom(node);\n                var text = self.utils.removeInvisibleChars($el.text());\n\n                return (text === '') ? $el.remove() : $el.unwrap();\n            });\n        }\n\n        $wrapper.find('[data-redactor-style-cache]').removeAttr('data-redactor-style-cache');\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n    removeSpanWithoutAttributes: function(html)\n    {\n        var $wrapper = this.utils.buildWrapper(html);\n        $wrapper.find('span').removeAttr('data-redactor-span data-redactor-style-cache').each(function(node)\n        {\n            if (node.attributes.length === 0) $R.dom(node).unwrap();\n        });\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n    removeFirstBlockBreaklineInHtml: function(html)\n    {\n        return html.replace(new RegExp('</li><br\\\\s?/?>', 'gi'), '</li>');\n    },\n    removeEmptyAttributes: function(html, attrs)\n    {\n        var $wrapper = this.utils.buildWrapper(html);\n        for (var i = 0; i < attrs.length; i++)\n        {\n            $wrapper.find('[' + attrs[i] + '=\"\"]').removeAttr(attrs[i]);\n        }\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n\n    // encode / decode\n    encodeHtml: function(html)\n    {\n        html = html.replace(/<br\\s?\\/?>/g, \"\\n\");\n        html = html.replace(/&nbsp;/g, ' ');\n        html = html.replace(/”/g, '\"');\n        html = html.replace(/“/g, '\"');\n        html = html.replace(/‘/g, '\\'');\n        html = html.replace(/’/g, '\\'');\n        html = this.encodeEntities(html);\n        html = html.replace(/\\$/g, '&#36;');\n\n        if (this.opts.preSpaces)\n        {\n            html = html.replace(/\\t/g, new Array(this.opts.preSpaces + 1).join(' '));\n        }\n\n        return html;\n    },\n\n    encodeCode: function(html) {\n\n        html = this.encodeAttrSings(html);\n\n        // replace all tags\n        html = html.replace(/<\\s/gi, '&lt; ');\n        html = html.replace(/<([^>]+)</gi, '&lt;$1<');\n        html = html.replace(/<(.*?)>/gi, 'xtagstartz$1xtagendz');\n\n        // revert pre / code\n        html = html.replace(/xtagstartzpre(.*?)xtagendz/g, '<pre$1>');\n        html = html.replace(/xtagstartzcode(.*?)xtagendz/g, '<code$1>');\n        html = html.replace(/xtagstartz\\/codextagendz/g, '</code>');\n        html = html.replace(/xtagstartz\\/prextagendz/g, '</pre>');\n\n        // encode\n        html = this._encodeCode(html);\n\n        // revert all tags\n        html = html.replace(/xtagstartz([\\w\\W]*?)xtagendz/g, '<$1>');\n        html = html.replace(/xtagstartz\\/(.*?)xtagendz/g, '</$1>');\n\n        html = this.decodeAttrSings(html);\n\n        return html;\n    },\n    _encodeCode: function(html) {\n        var $wrapper = this.utils.buildWrapper(html);\n        $wrapper.find('pre code, pre, code').each(this._encodeNode.bind(this));\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n    _encodeNode: function(node) {\n        var first = node.firstChild;\n        var html = node.innerHTML;\n        if (node.tagName === 'PRE' && first && first.tagName === 'CODE') {\n            return;\n        }\n\n        html = html.replace(/xtagstartz/g, '<');\n        html = html.replace(/xtagendz/g, '>');\n\n        var encoded = this.decodeEntities(html);\n        node.textContent = this._encodeNodeHtml(encoded);\n    },\n    _encodeNodeHtml: function(html) {\n        html = html.replace(/&nbsp;/g, ' ').replace(/<br\\s?\\/?>/g, '\\n');\n        html = (this.opts.preSpaces) ? html.replace(/\\t/g, new Array(this.opts.preSpaces + 1).join(' ')) : html;\n\n        return html;\n    },\n\n    encodeAttrSings: function(html) {\n        var matches = html.match(/=\"(.*?)\"/g);\n        if (matches !== null) {\n            for (var i = 0; i < matches.length; i++) {\n                if (matches[i].search(/^\"</) !== -1 || matches[i].search(/>\"$/) !== -1) {\n                    continue;\n                }\n\n\n                var str = matches[i].replace('>', 'xmoresignz');\n                str = str.replace('<', 'xlesssignz');\n                html = html.replace(matches[i], str);\n            }\n        }\n\n        return html;\n    },\n    encodeEntities: function(str)\n    {\n        str = this.decodeEntities(str);\n        str = str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;');\n\n        return str;\n    },\n    encodePhpCode: function(html)\n    {\n        html = html.replace('<?php', '&lt;?php');\n        html = html.replace('<?', '&lt;?');\n        html = html.replace('?>', '?&gt;');\n\n        return html;\n    },\n    decodeAttrSings: function(html) {\n        html = html.replace(/xmoresignz/gi, '>');\n        html = html.replace(/xlesssignz/gi, '<');\n\n        return html;\n    },\n    decodeEntities: function(str)\n    {\n        return String(str).replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&quot;/g, '\"').replace(/&amp;/g, '&');\n    },\n\n    // store / restore\n    storeComponents: function(html)\n    {\n        var matched = this.utils.getElementsFromHtml(html, 'figure', 'table');\n\n        return this._storeMatched(html, matched, 'Components', 'figure');\n    },\n    restoreComponents: function(html)\n    {\n        return this._restoreMatched(html, 'Components', 'figure');\n    },\n    storeLinks: function(html)\n    {\n        var matched = this.utils.getElementsFromHtml(html, 'a');\n\n        return this._storeMatched(html, matched, 'Links', 'a');\n    },\n    storeImages: function(html)\n    {\n        var matched = this.utils.getElementsFromHtml(html, 'img');\n\n        return this._storeMatched(html, matched, 'Images', 'img');\n    },\n    restoreLinks: function(html)\n    {\n        return this._restoreMatched(html, 'Links', 'a');\n    },\n    restoreImages: function(html)\n    {\n        return this._restoreMatched(html, 'Images', 'img');\n    },\n\n    // PRIVATE\n\n    // clean\n    _cleanWrapped: function(html)\n    {\n        html = html.replace(new RegExp('<p><figure([\\\\w\\\\W]*?)</figure></p>', 'gi'), '<figure$1</figure>');\n\n        return html;\n    },\n    _cleanGDocs: function(html)\n    {\n        // remove google docs markers\n        html = html.replace(/<b\\sid=\"internal-source-marker(.*?)\">([\\w\\W]*?)<\\/b>/gi, \"$2\");\n        html = html.replace(/<b(.*?)id=\"docs-internal-guid(.*?)\">([\\w\\W]*?)<\\/b>/gi, \"$3\");\n\n        html = html.replace(/<span[^>]*(font-style:\\s?italic;\\s?font-weight:\\s?bold|font-weight:\\s?bold;\\s?font-style:\\s?italic)[^>]*>([\\w\\W]*?)<\\/span>/gi, '<b><i>$2</i></b>');\n        html = html.replace(/<span[^>]*(font-style:\\s?italic;\\s?font-weight:\\s?600|font-weight:\\s?600;\\s?font-style:\\s?italic)[^>]*>([\\w\\W]*?)<\\/span>/gi, '<b><i>$2</i></b>');\n        html = html.replace(/<span[^>]*(font-style:\\s?italic;\\s?font-weight:\\s?700|font-weight:\\s?700;\\s?font-style:\\s?italic)[^>]*>([\\w\\W]*?)<\\/span>/gi, '<b><i>$2</i></b>');\n        html = html.replace(/<span[^>]*font-style:\\s?italic[^>]*>([\\w\\W]*?)<\\/span>/gi, '<i>$1</i>');\n        html = html.replace(/<span[^>]*font-weight:\\s?bold[^>]*>([\\w\\W]*?)<\\/span>/gi, '<b>$1</b>');\n        html = html.replace(/<span[^>]*font-weight:\\s?700[^>]*>([\\w\\W]*?)<\\/span>/gi, '<b>$1</b>');\n        html = html.replace(/<span[^>]*font-weight:\\s?600[^>]*>([\\w\\W]*?)<\\/span>/gi, '<b>$1</b>');\n\n        return html;\n    },\n    _cleanMsWord: function(html)\n    {\n        html = html.replace(/<!--[\\s\\S]+?-->/gi, '');\n        html = html.replace(/<(!|script[^>]*>.*?<\\/script(?=[>\\s])|\\/?(\\?xml(:\\w+)?|img|meta|link|style|\\w:\\w+)(?=[\\s\\/>]))[^>]*>/gi, '');\n        html = html.replace(/<(\\/?)s>/gi, \"<$1strike>\");\n        html = html.replace(/&nbsp;/gi, ' ');\n        html = html.replace(/<span\\s+style\\s*=\\s*\"\\s*mso-spacerun\\s*:\\s*yes\\s*;?\\s*\"\\s*>([\\s\\u00a0]*)<\\/span>/gi, function(str, spaces) {\n            return (spaces.length > 0) ? spaces.replace(/./, \" \").slice(Math.floor(spaces.length/2)).split(\"\").join(\"\\u00a0\") : '';\n        });\n\n        // build wrapper\n        var $wrapper = this.utils.buildWrapper(html);\n\n        // footnote fix\n        $wrapper.find('.MsoFootnoteText').each(function(node) {\n            var $node = $R.dom(node);\n            var $parent = $node.parent();\n            if ($parent.length !== 0 && $parent.attr('style').search(/mso-element:footnote/) !== -1) {\n                $node.find('a').attr('id', '_' + $parent.attr('id'));\n            }\n\n        });\n\n        $wrapper.find('.MsoFootnoteReference').each(function(node) {\n            var $node = $R.dom(node);\n            var $parent = $node.parent();\n            if ($parent.length !== 0 && $parent.get().tagName === 'A') {\n                $parent.attr('id', $parent.attr('name'));\n            }\n\n        });\n\n        // build lists\n        $wrapper.find('p').each(function(node)\n        {\n            var $node = $R.dom(node);\n            var str = $node.attr('style');\n            var matches = /mso-list:\\w+ \\w+([0-9]+)/.exec(str);\n            if (matches)\n            {\n                $node.attr('data-listLevel',  parseInt(matches[1], 10));\n            }\n        });\n\n        // parse Lists\n        this._parseWordLists($wrapper);\n\n        $wrapper.find('[align]').removeAttr('align');\n        $wrapper.find('[name]').removeAttr('name');\n        $wrapper.find('span').each(function(node)\n        {\n            var $node = $R.dom(node);\n            var str = $node.attr('style');\n            var matches = /mso-list:Ignore/.exec(str);\n\n            if (matches) $node.remove();\n            else $node.unwrap();\n\n        });\n        $wrapper.find('[style]').removeAttr('style');\n        $wrapper.find(\"[class^='Mso']\").removeAttr('class');\n        $wrapper.find('a').filter(function(node) { return !node.hasAttribute('href'); }).unwrap();\n\n        // get wrapper\n        html = this.utils.getWrapperHtml($wrapper);\n        html = html.replace(/<p[^>]*><\\/p>/gi, '');\n        html = html.replace(/<li>·/gi, '<li>');\n        html = html.trim();\n\n        // remove spaces between\n        html = html.replace(/\\/(p|ul|ol|h1|h2|h3|h4|h5|h6|blockquote)>\\s+<(p|ul|ol|h1|h2|h3|h4|h5|h6|blockquote)/gi, '/$1>\\n<$2');\n\n        var result = '';\n        var lines = html.split(/\\n/);\n        for (var i = 0; i < lines.length; i++)\n        {\n            var space = (lines[i] !== '' && lines[i].search(/>$/) === -1) ? ' ' : '\\n';\n\n            result += lines[i] + space;\n        }\n\n        return result;\n    },\n    _parseWordLists: function($wrapper)\n    {\n        var lastLevel = 0;\n        var $item = null;\n        var $list = null;\n        var $listChild = null;\n\n        $wrapper.find('p').each(function(node) {\n            var $node = $R.dom(node);\n            var level = $node.attr('data-listLevel');\n            if (level === null && $node.hasClass('MsoListParagraphCxSpMiddle')) {\n                level = 1;\n            }\n\n            if (level !== null) {\n                var txt = $node.text();\n                var listTag = (/^\\s*\\w+\\./.test(txt)) ? '<ol></ol>' : '<ul></ul>';\n\n                // new parent list\n                if ($node.hasClass('MsoListParagraphCxSpFirst') || $node.hasClass('MsoNormal')) {\n                    $list = $R.dom(listTag);\n                    $node.before($list);\n                }\n                // new child list\n                else if (level > lastLevel && lastLevel !== 0) {\n                    $listChild = $R.dom(listTag);\n                    $item.append($listChild);\n                    $list = $listChild;\n                }\n                // level up\n                if (level < lastLevel) {\n                    var len = lastLevel - level + 1;\n                    for (var i = 0; i < len; i++) {\n                        $list = $list.parent();\n                    }\n                }\n\n                // create item\n                $node.find('span').first().unwrap();\n                $item = $R.dom('<li>' + $node.html().trim() + '</li>');\n                if ($list === null) {\n                    $node.before(listTag);\n                    $list = $node.prev();\n                }\n\n                // append\n                $list.append($item);\n                $node.remove();\n\n                lastLevel = level;\n            }\n            else {\n                $list = null;\n                lastLevel = 0;\n            }\n        });\n    },\n\n    // is\n    _isSpacedEmpty: function(html)\n    {\n        return (html.search(this.reSpacedEmpty) !== -1);\n    },\n    _isParagraphEmpty: function(html)\n    {\n        return (html.search(/^<p><\\/p>$/i) !== -1);\n    },\n    _isHtmlMsWord: function(html)\n    {\n        return html.match(/class=\"?Mso|style=\"[^\"]*\\bmso-|style='[^'']*\\bmso-|w:WordDocument/i);\n    },\n\n    // set\n    _setSpanAttr: function(html)\n    {\n        var $wrapper = this.utils.buildWrapper(html);\n        $wrapper.find('span').attr('data-redactor-span', true);\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n    _setStyleCache: function(html)\n    {\n        var $wrapper = this.utils.buildWrapper(html);\n        $wrapper.find('[style]').each(function(node)\n        {\n            var $el = $R.dom(node);\n            $el.attr('data-redactor-style-cache', $el.attr('style'));\n        });\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n    _setPreClass: function(html)\n    {\n        var $wrapper = this.utils.buildWrapper(html);\n        $wrapper.find('pre').addClass(this.opts.preClass);\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n    _setLinkNofollow: function(html)\n    {\n        var $wrapper = this.utils.buildWrapper(html);\n        $wrapper.find('a').attr('rel', 'nofollow');\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n\n    // replace\n    _replaceScriptTag: function(html)\n    {\n        return html.replace(this.reScriptTag, '<script class=\"redactor-script-tag\" $1>$2</script>');\n    },\n    _unreplaceScriptTag: function(html)\n    {\n        return html.replace(/<script class=\"redactor-script-tag\"(.*?[^>]?)>([\\w\\W]*?)<\\/script>/gi, '<script$1>$2</script>');\n    },\n\t_replaceNlToBr: function(html)\n\t{\n\t\treturn html.replace(/\\n/g, '<br />');\n\t},\n\n    // remove\n    _removeScriptTag: function(html)\n    {\n        return html.replace(this.reScriptTag, '');\n    },\n\n    // private\n    _storeMatched: function(html, matched, stored, name)\n    {\n        this['stored' + stored] = [];\n        if (matched)\n        {\n            for (var i = 0; i < matched.length; i++)\n            {\n                this['stored' + stored][i] = matched[i];\n                html = html.replace(matched[i], '####' + name + i + '####');\n            }\n        }\n\n        return html;\n    },\n    _restoreMatched: function(html, stored, name)\n    {\n        if (this['stored' + stored])\n        {\n            for (var i = 0; i < this['stored' + stored].length; i++)\n            {\n                html = html.replace('####' + name + i + '####', this['stored' + stored][i]);\n            }\n        }\n\n        return html;\n    }\n});\n$R.add('class', 'cleaner.figure', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.detector = app.detector;\n    },\n    // public\n    convert: function(html, rules)\n    {\n        var $wrapper = this.utils.buildWrapper(html);\n\n        // convert\n        $wrapper.find('img').each(this._convertImage.bind(this));\n        $wrapper.find('hr').each(this._convertLine.bind(this));\n        $wrapper.find('iframe').each(this._convertIframe.bind(this));\n        $wrapper.find('table').each(this._convertTable.bind(this));\n        $wrapper.find('form').each(this._convertForm.bind(this));\n        $wrapper.find('figure pre').each(this._convertCode.bind(this));\n\n        // variables\n        $wrapper.find('[data-redactor-type=variable]').addClass('redactor-component');\n\n        // widgets\n        $wrapper.find('figure').not('.redactor-component, .redactor-figure-code').each(this._convertWidget.bind(this));\n\n        // contenteditable\n        $wrapper.find('figure pre').each(this._setContenteditableCode.bind(this));\n        $wrapper.find('.redactor-component, .non-editable').attr('contenteditable', false);\n\n        if (this.detector.isIe())\n        {\n            $wrapper.find('[data-redactor-type=table]').removeAttr('contenteditable');\n        }\n\n        $wrapper.find('figcaption, td, th').attr('contenteditable', true);\n        $wrapper.find('.redactor-component, figcaption').attr('tabindex', '-1');\n\n        // extra rules\n        this._acceptExtraRules($wrapper, rules);\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n    unconvert: function(html, rules)\n    {\n        html = html.replace(/<\\/([^>]+)><div data-redactor-tag/g, '</$1>\\n<div data-redactor-tag');\n        html = html.replace(/<\\/([^>]+)><p/g, '</$1>\\n<p');\n\n        var $wrapper = this.utils.buildWrapper(html);\n\n        // contenteditable\n        $wrapper.find('th, td, figcaption, figure, pre, code, .redactor-component').removeAttr('contenteditable tabindex');\n\n        // remove class\n        $wrapper.find('figure').removeClass('redactor-component redactor-component-active redactor-uploaded-figure');\n\n        // unconvert\n        $wrapper.find('[data-redactor-type=variable]').removeClass('redactor-component redactor-component-active');\n        $wrapper.find('figure[data-redactor-type=line]').unwrap();\n        $wrapper.find('figure[data-redactor-type=widget]').each(this._unconvertWidget.bind(this));\n        $wrapper.find('figure[data-redactor-type=form]').each(this._unconvertForm.bind(this));\n        $wrapper.find('figure[data-redactor-type=table]').each(this._unconvertTable.bind(this));\n        $wrapper.find('figure[data-redactor-type=image]').removeAttr('rel').each(this._unconvertImages.bind(this));\n\n        $wrapper.find('img').removeAttr('data-redactor-type').removeClass('redactor-component');\n        $wrapper.find('.non-editable').removeAttr('contenteditable');\n\n        // remove types\n        $wrapper.find('figure').each(this._removeTypes.bind(this));\n\n        // remove caret\n        $wrapper.find('span.redactor-component-caret').remove();\n\n        // break div\n        $wrapper = this._unconvertBreakTag($wrapper);\n\n        // extra rules\n        this._acceptExtraRules($wrapper, rules);\n\n        html = this.utils.getWrapperHtml($wrapper);\n        html = html.replace(/<br\\s?\\/?>$/, '');\n        html = html.replace(/<br\\s?\\/?><\\/(td|th)>/, '</$1>');\n\n        return html;\n    },\n\n    // private\n    _convertImage: function(node)\n    {\n        var $node = $R.dom(node);\n        if (this._isNonEditable($node)) return;\n\n        // set id\n        if (this.opts.imageObserve && !$node.attr('data-image'))\n        {\n            $node.attr('data-image', this.utils.getRandomId());\n        }\n\n        var $link = $node.closest('a');\n        var $figure = $node.closest('figure');\n        var isImage = ($figure.children().not('a, img, br, figcaption').length === 0);\n        if (!isImage) return;\n\n        if ($figure.length === 0)\n        {\n            var $parent = ($link.length !== 0) ? $link.closest('p') : $node.closest('p');\n            if (this.opts.imageFigure === false && $parent.length !== 0)\n            {\n                var $el = this.utils.replaceToTag($parent, 'figure');\n                $figure = $el;\n                $figure.addClass('redactor-replace-figure');\n            }\n            else\n            {\n                if ($parent.length !== 0) {\n                    $parent.unwrap();\n                }\n\n                $figure = ($link.length !== 0) ? $link.wrap('<figure>') : $node.wrap('<figure>');\n            }\n        }\n        else\n        {\n            if ($figure.hasClass('redactor-uploaded-figure'))\n            {\n                $figure.removeClass('redactor-uploaded-figure');\n            }\n            else\n            {\n                $figure.addClass('redactor-keep-figure');\n            }\n        }\n\n        this._setFigure($figure, 'image');\n    },\n    _convertTable: function(node)\n    {\n        if (this._isNonEditable(node)) return;\n\n        var $figure = this._wrapFigure(node);\n        this._setFigure($figure, 'table');\n    },\n    _convertLine: function(node)\n    {\n        if (this._isNonEditable(node)) return;\n\n        var $figure = this._wrapFigure(node);\n        this._setFigure($figure, 'line');\n    },\n    _convertForm: function(node)\n    {\n        if (this._isNonEditable(node)) return;\n\n        var $figure = this.utils.replaceToTag(node, 'figure');\n        this._setFigure($figure, 'form');\n    },\n    _convertIframe: function(node)\n    {\n        if (this._isNonEditable(node)) return;\n\n        var $node = $R.dom(node);\n        if ($node.closest('.redactor-component').length !== 0) return;\n\n        var src = node.getAttribute('src');\n        var isVideo = (src && (src.match(this.opts.regex.youtube) || src.match(this.opts.regex.vimeo)));\n        var $figure = this._wrapFigure(node);\n\n        if (isVideo)\n        {\n            this._setFigure($figure, 'video');\n        }\n    },\n    _convertCode: function(node)\n    {\n        if (this._isNonEditable(node)) return;\n\n        var $figure = this._wrapFigure(node);\n        this._setFigure($figure, 'code');\n    },\n    _convertWidget: function(node)\n    {\n        if (this._isNonEditable(node)) return;\n\n        var $node = $R.dom(node);\n        $node.addClass('redactor-component');\n        $node.attr('data-redactor-type', 'widget');\n        $node.attr('data-widget-code', encodeURI(node.innerHTML.trim()));\n    },\n\n    // unconvert\n    _unconvertBreakTag: function($wrapper) {\n        $wrapper.find('[data-redactor-tag]').each(function(node) {\n            var $node = $R.dom(node);\n            $node.removeAttr('data-redactor-tag');\n            if (node.attributes.length !== 0) {\n                if (node.lastChild && node.lastChild.tagName === 'BR') $R.dom(node.lastChild).remove();\n                return;\n            }\n\n            if (node.lastChild && node.lastChild.tagName === 'BR') {\n                $node.unwrap();\n            }\n            else {\n                var $next = $node.nextElement();\n                if ($next.length !== 0 && $next.attr('data-redactor-tag')) {\n                    node.appendChild(document.createElement('br'));\n                }\n\n                $node.unwrap();\n            }\n        }.bind(this));\n        return $wrapper;\n    },\n    _unconvertForm: function(node)\n    {\n        this.utils.replaceToTag(node, 'form');\n    },\n    _unconvertTable: function(node)\n    {\n        var $node = $R.dom(node);\n        $node.unwrap();\n    },\n    _unconvertWidget: function(node)\n    {\n        var $node = $R.dom(node);\n        $node.html(decodeURI($node.attr('data-widget-code')));\n        $node.removeAttr('data-widget-code');\n    },\n    _unconvertImages: function(node)\n    {\n        var $node = $R.dom(node);\n        $node.removeClass('redactor-component');\n\n        var isList = ($node.closest('li').length !== 0);\n        var isTable = ($node.closest('table').length !== 0);\n        var hasFigcaption = ($node.find('figcaption').length !== 0);\n\n        var style = $node.attr('style');\n        var hasStyle = !(style === null || style === '');\n        var hasClass = ($node.attr('class') !== '');\n\n        if (isList || (isTable && !hasFigcaption && !hasStyle && !hasClass))\n        {\n            $node.unwrap();\n        }\n    },\n    _removeTypes: function(node)\n    {\n        var $node = $R.dom(node);\n        var type = $node.attr('data-redactor-type');\n        var removed = ['image', 'widget', 'line', 'video', 'code', 'form', 'table'];\n        if (type && removed.indexOf(type) !== -1)\n        {\n            $node.removeAttr('data-redactor-type');\n        }\n\n        // keep figure\n        if ($node.hasClass('redactor-keep-figure'))\n        {\n            $node.removeClass('redactor-keep-figure');\n        }\n\n        // unwrap figure\n        else if (type === 'image' && this.opts.imageFigure === false)\n        {\n            var hasFigcaption = ($node.find('figcaption').length !== 0);\n            if (!hasFigcaption)\n            {\n                // replace\n                if ($node.hasClass('redactor-replace-figure'))\n                {\n                    $node.removeClass('redactor-replace-figure');\n                    this.utils.replaceToTag($node, 'p');\n                }\n                else\n                {\n                    this.utils.replaceToTag($node, 'p');\n                }\n            }\n        }\n\n        $node.removeClass('redactor-replace-figure');\n    },\n\n    // wrap\n    _wrapFigure: function(node)\n    {\n        var $node = $R.dom(node);\n        var $figure = $node.closest('figure');\n\n        return ($figure.length === 0) ? $node.wrap('<figure>') : $figure;\n    },\n\n    // set\n    _setFigure: function($figure, type)\n    {\n        $figure.addClass('redactor-component');\n        $figure.attr('data-redactor-type', type);\n    },\n    _setContenteditableCode: function(node)\n    {\n        if (this._isNonEditable(node)) return;\n\n        var $node = $R.dom(node);\n        var $code = $node.children('code').first();\n\n        var $el = ($code.length !== 0) ? $code : $node;\n        $el.attr('contenteditable', true).attr('tabindex', '-1');\n    },\n\n    // utils\n    _acceptExtraRules: function($wrapper, rules)\n    {\n        for (var key in rules)\n        {\n            if (typeof rules[key] === 'function')\n            {\n                rules[key]($wrapper);\n            }\n        }\n    },\n    _isNonEditable: function(node)\n    {\n        return ($R.dom(node).closest('.non-editable').length !== 0);\n    }\n});\n$R.add('class', 'cleaner.paragraphize', {\n    init: function(app) {\n        this.app = app;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.cleaner = app.cleaner;\n        this.element = app.element;\n\n        // local\n        this.stored = [];\n        this.remStart = '#####replace';\n        this.remEnd = '#####';\n        this.paragraphizeTags = ['table', 'div', 'pre', 'form', 'ul', 'ol', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'dl', 'blockquote', 'figcaption',\n                'address', 'section', 'header', 'footer', 'aside', 'article', 'object', 'style', 'script', 'iframe', 'select', 'input', 'textarea',\n                'button', 'option', 'map', 'area', 'math', 'hr', 'fieldset', 'legend', 'hgroup', 'nav', 'figure', 'details', 'menu', 'summary', 'p'];\n    },\n    // public\n    convert: function(html) {\n\n        var value = this._isConverted(html);\n\n        value = (value === true) ? this._convert(html) : value;\n        value = this._convertTable(value);\n\n        return value;\n    },\n\n    // private\n    _convert: function(html, tablemarkup) {\n        // build markup tag\n        var tag = (this.opts.breakline || tablemarkup) ? 'sdivtag' : this.opts.markup;\n        var attr = (tablemarkup) ? 'tbr' : 'br';\n\n        // store\n        html = this._storeTags(html);\n\n        var storedComments = [];\n        html = this.cleaner.storeComments(html, storedComments);\n\n        // trim\n        html = html.trim();\n        html = this._trimLinks(html);\n\n        // trim new line in inline\n        var inlines = this.opts.inlineTags.join('|');\n        html = html.replace(new RegExp('<(' + inlines + ')(.*?[^>]?)>\\n</(' + inlines + ')>', 'gi'), '<$1$2></$3>');\n\n        // replace new lines\n        html = html.replace(/xparagraphmarkerz(?:\\r\\n|\\r|\\n)$/g, '');\n        html = html.replace(/xparagraphmarkerz$/g, '');\n        html = html.replace(/xparagraphmarkerz(?:\\r\\n|\\r|\\n)/g, '\\n');\n        html = html.replace(/xparagraphmarkerz/g, '\\n');\n\n        if (this.opts.breakline) {\n            html = html.replace(/<br\\s?\\/?>(?:\\r\\n|\\r|\\n)/gi, 'xbreakmarkerz\\n');\n            html = html.replace(/<br\\s?\\/?>/gi, 'xbreakmarkerz\\n');\n            html = html.replace(/xbreakmarkerz\\n<\\//gi, 'xbreakmarkerz</');\n\n        }\n        else {\n            html = html.replace(/[\\n]+/g, \"\\n\");\n        }\n\n        // wrap to tag\n        var str = '';\n        var arr = html.split(\"\\n\");\n        for (var i = 0; i < arr.length; i++) {\n            str += '<' + tag + '>' + arr[i] + '</' + tag + '>\\n';\n        }\n\n        html = str.replace(/\\n$/, '');\n\n\n        // clean\n        html = html.replace(new RegExp('<' + tag + '>\\\\s+#####', 'gi'), '#####');\n        html = html.replace(new RegExp('<' + tag + '>#####', 'gi'), '#####');\n        html = html.replace(new RegExp('#####</' + tag + '>', 'gi'), '#####');\n\n        // replace marker\n        html = (this.opts.breakline) ? html.replace(/xbreakmarkerz/gi, \"<br>\") : html;\n\n        // restore\n        html = this._restoreTags(html);\n        html = this.cleaner.restoreComments(html, storedComments);\n\n        // remove empty\n        if (this.opts.breakline) {\n            html = html.replace(new RegExp('<' + tag + '></' + tag + '>', 'gi'), '<' + tag + '><br></' + tag + '>');\n        }\n        else {\n            //html = html.replace(new RegExp('<' + tag + '><br\\\\s?/?></' + tag + '>', 'gi'), '');\n            //html = html.replace(new RegExp('<' + tag + '></' + tag + '>', 'gi'), '');\n        }\n\n        // clean restored\n        html = html.replace(new RegExp('<sdivtag>', 'gi'), '<div data-redactor-tag=\"' + attr + '\">');\n        html = html.replace(new RegExp('sdivtag', 'gi'), 'div');\n        html = html.replace(/<\\/([^>]+)><div data-redactor-tag/g, '</$1>\\n<div data-redactor-tag');\n\n        return html;\n    },\n    _convertTable: function(html) {\n        var $wrapper = this.utils.buildWrapper(html);\n        $wrapper.find('td, th').each(this._convertCell.bind(this));\n        html = this.utils.getWrapperHtml($wrapper);\n\n        return html;\n    },\n    _convertCell: function(node) {\n        var $node = $R.dom(node);\n        this.stored = [];\n        var code = this._convert($node.html(), true);\n        $node.html(code);\n    },\n    _storeTags: function(html) {\n        var self = this;\n        var $wrapper = this.utils.buildWrapper(html);\n        $wrapper.find(this.paragraphizeTags.join(', ')).each(function(node, i) {\n            var replacement = document.createTextNode(self.remStart + i + self.remEnd + 'xparagraphmarkerz'); //  + \"\\n\"\n            self.stored.push(node.outerHTML);\n            node.parentNode.replaceChild(replacement, node);\n        });\n\n        return this.utils.getWrapperHtml($wrapper);\n    },\n    _restoreTags: function(html) {\n        for (var i = 0; i < this.stored.length; i++) {\n            this.stored[i] = this.stored[i].replace(/\\$/g, '&#36;');\n            html = html.replace(this.remStart + i + this.remEnd, this.stored[i]);\n        }\n\n        return html;\n    },\n    _trimLinks: function(html) {\n        var $wrapper = this.utils.buildWrapper(html);\n        $wrapper.find('a').each(this._trimLink.bind(this));\n        html = this.utils.getWrapperHtml($wrapper);\n\n        return html;\n    },\n    _trimLink: function(node) {\n        var $node = $R.dom(node);\n        $node.html($node.html().trim());\n    },\n    _isConverted: function(html) {\n        if (this._isDisabled(html)) return html;\n        else if (this._isEmptyHtml(html)) return this.opts.emptyHtml;\n        else return true;\n    },\n    _isDisabled: function() {\n        return (this.opts.paragraphize === false || this.element.isType('inline'));\n    },\n    _isEmptyHtml: function(html) {\n        return (html === '' || html === '<p></p>' || html === '<div></div>');\n    }\n});\n$R.add('service', 'detector', {\n    init: function(app)\n    {\n        this.app = app;\n\n        // local\n        this.userAgent = navigator.userAgent.toLowerCase();\n    },\n\tisWebkit: function()\n\t{\n\t\treturn /webkit/.test(this.userAgent);\n\t},\n\tisFirefox: function()\n\t{\n\t\treturn (this.userAgent.indexOf('firefox') > -1);\n\t},\n\tisIe: function(v)\n\t{\n        if (document.documentMode || /Edge/.test(navigator.userAgent)) return 'edge';\n\n\t\tvar ie;\n\t\tie = RegExp('msie' + (!isNaN(v)?('\\\\s'+v):''), 'i').test(navigator.userAgent);\n\t\tif (!ie) ie = !!navigator.userAgent.match(/Trident.*rv[ :]*11\\./);\n\n\t\treturn ie;\n\t},\n\tisMobile: function()\n\t{\n\t\treturn /(iPhone|iPod|Android)/.test(navigator.userAgent);\n\t},\n\tisDesktop: function()\n\t{\n\t\treturn !/(iPhone|iPod|iPad|Android)/.test(navigator.userAgent);\n\t},\n\tisIpad: function()\n\t{\n\t\treturn /iPad/.test(navigator.userAgent);\n\t}\n});\n$R.add('service', 'offset', {\n    init: function(app)\n    {\n        this.app = app;\n    },\n    get: function(el, trimmed)\n    {\n        var offset = { start: 0, end: 0 };\n        var node = this.utils.getNode(el);\n        if (!node) return false;\n\n        var isEditor = this.editor.isEditor(node);\n        var isIn = (isEditor) ? true : this.selection.isIn(node);\n        var range = this.selection.getRange();\n\n        if (!isEditor && !isIn)\n        {\n            offset = false;\n        }\n        else if (this.selection.is() && isIn)\n        {\n            var $startNode = $R.dom(range.startContainer);\n            var fix = ($startNode.hasClass('redactor-component')) ? range.startOffset : 0;\n            var clonedRange = range.cloneRange();\n\n            clonedRange.selectNodeContents(node);\n            clonedRange.setEnd(range.startContainer, range.startOffset);\n\n            var selection = this._getString(range, trimmed);\n\n            offset.start = this._getString(clonedRange, trimmed).length - fix;\n            offset.end = offset.start + selection.length + fix;\n        }\n\n        return offset;\n    },\n    set: function(offset, el)\n    {\n        if (this._setComponentOffset(el)) return;\n\n        this.component.clearActive();\n        var node = this.utils.getNode(el);\n        if (!node) return;\n\n        var size = this.size(node);\n        var charIndex = 0, range = document.createRange();\n\n        offset.end = (offset.end > size) ? size : offset.end;\n\n        range.setStart(node, 0);\n        range.collapse(true);\n\n        var nodeStack = [node], foundStart = false, stop = false;\n        while (!stop && (node = nodeStack.pop()))\n        {\n            if (node.nodeType === 3)\n            {\n                var nextCharIndex = charIndex + node.length;\n\n                if (!foundStart && !this._isFigcaptionNext(node) && offset.start >= charIndex && offset.start <= nextCharIndex)\n                {\n                    range.setStart(node, offset.start - charIndex);\n                    foundStart = true;\n                }\n\n                if (foundStart && offset.end >= charIndex && offset.end <= nextCharIndex)\n                {\n                    range.setEnd(node, offset.end - charIndex);\n                    stop = true;\n                }\n\n                charIndex = nextCharIndex;\n            }\n            else\n            {\n                var i = node.childNodes.length;\n                while (i--)\n                {\n                    nodeStack.push(node.childNodes[i]);\n                }\n            }\n        }\n\n        this.selection.setRange(range);\n    },\n    size: function(el, trimmed)\n    {\n        var node = this.utils.getNode(el);\n        if (node)\n        {\n            var range = document.createRange();\n\n            var clonedRange = range.cloneRange();\n            clonedRange.selectNodeContents(node);\n\n            return this._getString(clonedRange, trimmed).length;\n        }\n\n        return 0;\n    },\n\n    // private\n    _getString: function(obj, trimmed)\n    {\n        var str = obj.toString();\n        str = (this.editor.isEmpty()) ? str.replace(/\\uFEFF/g, '') : str;\n        str = (trimmed) ? str.trim() : str;\n\n        return str;\n    },\n    _setComponentOffset: function(el)\n    {\n        return (this.component.isNonEditable(el)) ? this.component.setActive(el) : false;\n    },\n    _isFigcaptionNext: function(node)\n    {\n        var next = node.nextSibling;\n        return (node.nodeValue.trim() === '' && next && next.tagName === 'FIGCAPTION');\n    }\n});\n$R.add('service', 'inspector', {\n    init: function(app)\n    {\n        this.app = app;\n    },\n    // parse\n    parse: function(el)\n    {\n        return $R.create('inspector.parser', this.app, this, el);\n    },\n\n    // text detection\n    isText: function(el)\n    {\n        if (typeof el === 'string' && !/^\\s*<(\\w+|!)[^>]*>/.test(el))\n        {\n            return true;\n        }\n\n        var node = $R.dom(el).get();\n        return (node && node.nodeType === 3); //  && !this.selection.getBlock(el)\n    },\n\n    // tag detection\n    isInlineTag: function(tag, extend)\n    {\n        var tags = this._extendTags(this.opts.inlineTags, extend);\n\n        return (this._isTag(tag) && tags.indexOf(tag.toLowerCase()) !== -1);\n    },\n    isBlockTag: function(tag, extend)\n    {\n        var tags = this._extendTags(this.opts.blockTags, extend);\n\n        return (this._isTag(tag) && tags.indexOf(tag.toLowerCase()) !== -1);\n    },\n    isTableCellTag: function(tag)\n    {\n        return (['td', 'th'].indexOf(tag.toLowerCase()) !== -1);\n    },\n    isHeadingTag: function(tag)\n    {\n        return (['h1', 'h2', 'h3', 'h4', 'h5', 'h6'].indexOf(tag.toLowerCase()) !== -1);\n    },\n\n\n    _isTag: function(tag)\n    {\n        return (tag !== undefined && tag);\n    },\n    _extendTags: function(tags, extend)\n    {\n        tags = tags.concat(tags);\n\n        if (extend)\n        {\n            for (var i = 0 ; i < extend.length; i++)\n            {\n                tags.push(extend[i]);\n            }\n        }\n\n        return tags;\n    }\n});\n$R.add('class', 'inspector.parser', {\n    init: function(app, inspector, el)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.editor = app.editor;\n        this.selection = app.selection;\n        this.inspector = inspector;\n\n        // local\n        var $editor = this.editor.getElement();\n        this.el = el;\n        this.$el = $R.dom(this.el, $editor);\n        this.node = this.$el.get();\n\n        // comment node\n        if (this.node && this.node.nodeType === 8)\n        {\n            this.node = false;\n        }\n\n        this.$component = this.$el.closest('.redactor-component', $editor);\n    },\n    // is\n    isEditor: function()\n    {\n        return (this.node === this.editor.getElement().get());\n    },\n    isInEditor: function()\n    {\n        return (this.$el.parents('.redactor-in-' + this.uuid).length !== 0);\n    },\n    isComponent: function()\n    {\n        return (this.$component.length !== 0);\n    },\n    isComponentType: function(type)\n    {\n        return (this.getComponentType() === type);\n    },\n    isComponentActive: function()\n    {\n        return (this.isComponent() && this.$component.hasClass('redactor-component-active'));\n    },\n    isComponentEditable: function()\n    {\n        var types = ['code', 'table'];\n        var type = this.getComponentType();\n\n        return (this.isComponent() && types.indexOf(type) !== -1);\n    },\n    isFigcaption: function()\n    {\n        return this.getFigcaption();\n    },\n    isPre: function()\n    {\n        return this.getPre();\n    },\n    isCode: function()\n    {\n        var $code = this.$el.closest('code');\n        var $parent = $code.parent('pre');\n\n        return ($code.length !== 0 && $parent.length === 0);\n    },\n    isList: function()\n    {\n        return this.getList();\n    },\n    isFirstListItem: function()\n    {\n        return this._getLastOrFirstListItem('first');\n    },\n    isLastListItem: function()\n    {\n        return this._getLastOrFirstListItem('last');\n    },\n    isFirstTableCell: function()\n    {\n        return this._getLastOrFirstTableCell('first');\n    },\n    isLastTableCell: function()\n    {\n        return this._getLastOrFirstTableCell('last');\n    },\n    isTable: function()\n    {\n        return (this.isComponentType('table') || this.getTable());\n    },\n    isHeading: function()\n    {\n        return this.getHeading();\n    },\n    isBlockquote: function()\n    {\n        return this.getBlockquote();\n    },\n    isDl: function()\n    {\n        return this.getDl();\n    },\n    isParagraph: function()\n    {\n        return this.getParagraph();\n    },\n    isLink: function()\n    {\n        return this.getLink();\n    },\n    isFile: function()\n    {\n        return this.getFile();\n    },\n    isText: function()\n    {\n        return this.inspector.isText(this.el);\n    },\n    isInline: function()\n    {\n        var tags = this.opts.inlineTags;\n\n        return (this.isElement()) ? (tags.indexOf(this.node.tagName.toLowerCase()) !== -1) : false;\n    },\n    isBlock: function()\n    {\n        var tags = this.opts.blockTags;\n\n        return (this.isElement()) ? (tags.indexOf(this.node.tagName.toLowerCase()) !== -1) : false;\n    },\n    isElement: function()\n    {\n        return (this.node && this.node.nodeType && this.node.nodeType !== 3);\n    },\n\n    // has\n    hasParent: function(tags)\n    {\n        return (this.$el.closest(tags.join(',')).length !== 0);\n    },\n\n    // get\n    getNode: function()\n    {\n        return this.node;\n    },\n    getTag: function()\n    {\n        return (this.isElement()) ? this.node.tagName.toLowerCase() : false;\n    },\n    getComponent: function()\n    {\n        return (this.isComponent()) ? this.$component.get() : false;\n    },\n    getComponentType: function()\n    {\n        return (this.isComponent()) ? this.$component.attr('data-redactor-type') : false;\n    },\n    getFirstNode: function()\n    {\n        return this.utils.getFirstNode(this.node);\n    },\n    getLastNode: function()\n    {\n        return this.utils.getLastNode(this.node);\n    },\n    getFirstElement: function()\n    {\n        return this.utils.getFirstElement(this.node);\n    },\n    getLastElement: function()\n    {\n        return this.utils.getLastElement(this.node);\n    },\n    getFigcaption: function()\n    {\n        return this._getClosestNode('figcaption');\n    },\n    getPre: function()\n    {\n        return this._getClosestNode('pre');\n    },\n    getCode: function()\n    {\n        return this._getClosestNode('code');\n    },\n    getList: function()\n    {\n        return this._getClosestNode('ul, ol');\n    },\n    getParentList: function()\n    {\n        return this._getClosestUpNode('ul, ol');\n    },\n    getListItem: function()\n    {\n        return this._getClosestNode('li');\n    },\n    getTable: function()\n    {\n        if (this.getComponentType('table'))\n        {\n            return this.$component.find('table').get();\n        }\n        else\n        {\n            return this._getClosestNode('table');\n        }\n    },\n    getTableCell: function()\n    {\n        var $td = this.$el.closest('td, th');\n\n        return ($td.length !== 0) ? $td.get() : false;\n    },\n    getComponentCodeElement: function()\n    {\n        return (this.isComponentType('code')) ? this.$component.find('pre code, pre').last().get() : false;\n    },\n    getImageElement: function()\n    {\n        return (this.isComponentType('image')) ? this.$component.find('img').get() : false;\n    },\n    getParagraph: function()\n    {\n        return this._getClosestNode('p');\n    },\n    getHeading: function()\n    {\n        return this._getClosestNode('h1, h2, h3, h4, h5, h6');\n    },\n    getDl: function()\n    {\n        return this._getClosestNode('dl');\n    },\n    getBlockquote: function()\n    {\n        return this._getClosestNode('blockquote');\n    },\n    getLink: function()\n    {\n        var isComponent = (this.isComponent() && !this.isFigcaption());\n        var isTable = this.isComponentType('table');\n\n        if (isTable || !isComponent)\n        {\n            var $el = this._getClosestElement('a');\n\n            return ($el && !$el.attr('data-file')) ? $el.get() : false;\n        }\n\n        return false;\n    },\n    getFile: function()\n    {\n        var isComponent = this.isComponent();\n        var isTable = this.isComponentType('table');\n\n        if (isTable || !isComponent)\n        {\n            var $el = this._getClosestElement('a');\n\n            return ($el && $el.attr('data-file')) ? $el.get() : false;\n        }\n\n        return false;\n    },\n\n    // find\n    findFirstNode: function(selector)\n    {\n        return this.$el.find(selector).first().get();\n    },\n    findLastNode: function(selector)\n    {\n        return this.$el.find(selector).last().get();\n    },\n\n    // private\n    _getLastOrFirstListItem: function(type)\n    {\n        var list = this.getList();\n        var tag = this.getTag();\n        if (list && tag === 'li')\n        {\n            var item = $R.dom(list).find('li')[type]().get();\n            if (item && this.node === item)\n            {\n                return true;\n            }\n        }\n\n        return false;\n    },\n    _getLastOrFirstTableCell: function(type)\n    {\n        var table = this.getTable();\n        var tag = this.getTag();\n        if (table && (tag === 'td' || tag === 'th'))\n        {\n            var item = $R.dom(table).find('td, th')[type]().get();\n            if (item && this.node === item)\n            {\n                return true;\n            }\n        }\n\n        return false;\n    },\n    _getClosestUpNode: function(selector)\n    {\n        var $editor = this.editor.getElement();\n        var $el = this.$el.parents(selector, $editor).last();\n\n        return ($el.length !== 0) ? $el.get() : false;\n    },\n    _getClosestNode: function(selector)\n    {\n        var $editor = this.editor.getElement();\n        var $el = this.$el.closest(selector, $editor);\n\n        return ($el.length !== 0) ? $el.get() : false;\n    },\n    _getClosestElement: function(selector)\n    {\n        var $editor = this.editor.getElement();\n        var $el = this.$el.closest(selector, $editor);\n\n        return ($el.length !== 0) ? $el : false;\n    }\n});\n$R.add('service', 'marker', {\n    init: function(app)\n    {\n        this.app = app;\n    },\n    build: function(pos, html)\n    {\n        var marker = document.createElement('span');\n\n        marker.id = 'selection-marker-' + this._getPos(pos);\n        marker.className = 'redactor-selection-marker';\n        marker.innerHTML = this.opts.markerChar;\n\n        return (html) ? marker.outerHTML : marker;\n    },\n    buildHtml: function(pos)\n    {\n        return this.build(pos, true);\n    },\n    insert: function(side)\n    {\n        this.remove();\n\n        var atStart = (side !== 'both' && (side === 'start' || this.selection.isCollapsed()));\n\n        if (!this.selection.is()) this.editor.focus();\n\n        var range = this.selection.getRange();\n        if (range)\n        {\n            var start = this.build('start');\n            var end = this.build('end');\n\n            var cloned = range.cloneRange();\n\n            if (!atStart)\n            {\n                cloned.collapse(false);\n                cloned.insertNode(end);\n            }\n\n            cloned.setStart(range.startContainer, range.startOffset);\n            cloned.collapse(true);\n            cloned.insertNode(start);\n\n            range.setStartAfter(start);\n\n            if (!atStart)\n            {\n                range.setEndBefore(end);\n            }\n\n            this.selection.setRange(range);\n\n            return start;\n        }\n    },\n    find: function(pos, $context)\n    {\n        var $editor = this.editor.getElement();\n        var $marker = ($context || $editor).find('span#selection-marker-' + this._getPos(pos));\n\n        return ($marker.length !== 0) ? $marker.get() : false;\n    },\n    restore: function()\n    {\n        var start = this.find('start');\n        var end = this.find('end');\n\n        var range = this.selection.getRange();\n        if (!range || !this.selection.is())\n        {\n            this.editor.focus();\n            range = document.createRange();\n        }\n\n        if (start)\n        {\n            var prev = (end) ? end.previousSibling : false;\n            var next = start.nextSibling;\n            next = (next && next.nodeType === 3 && next.textContent.replace(/[\\n\\t]/g, '') === '') ? false : next;\n\n            if (!end)\n            {\n                if (next)\n                {\n                    range.selectNodeContents(next);\n                    range.collapse(true);\n                }\n                else\n                {\n                    this._restoreInject(range, start);\n                }\n            }\n            else if (next && next.id === 'selection-marker-end')\n            {\n                this._restoreInject(range, start);\n            }\n            else\n            {\n                if (prev && next)\n                {\n                    range.selectNodeContents(prev);\n                    range.collapse(false);\n                    range.setStart(next, 0);\n                }\n                else if (prev && !next)\n                {\n                    range.selectNodeContents(prev);\n                    range.collapse(false);\n                    range.setStartAfter(start);\n                }\n                else\n                {\n                    range.setStartAfter(start);\n                    range.setEndBefore(end);\n                }\n            }\n\n            this.selection.setRange(range);\n\n            if (start) start.parentNode.removeChild(start);\n            if (end) end.parentNode.removeChild(end);\n        }\n    },\n    remove: function()\n    {\n        var start = this.find('start');\n        var end = this.find('end');\n\n        if (start) start.parentNode.removeChild(start);\n        if (end) end.parentNode.removeChild(end);\n    },\n\n    // private\n    _getPos: function(pos)\n    {\n        return (pos === undefined) ? 'start' : pos;\n    },\n    _restoreInject: function(range, start)\n    {\n        var textNode = this.utils.createInvisibleChar();\n        $R.dom(start).after(textNode);\n\n        range.selectNodeContents(textNode);\n        range.collapse(false);\n    }\n});\n$R.add('service', 'component', {\n    init: function(app)\n    {\n        this.app = app;\n\n        // local\n        this.activeClass = 'redactor-component-active';\n    },\n    create: function(type, el)\n    {\n        return $R.create(type + '.component', this.app, el);\n    },\n    build: function(el)\n    {\n        var $el = $R.dom(el);\n        var component;\n        var type = $el.attr('data-redactor-type');\n        if (type)\n        {\n            component = this.create(type, el);\n        }\n\n        return (component) ? component : el;\n    },\n    remove: function(el, caret)\n    {\n        var $component = $R.dom(el).closest('.redactor-component');\n        var type = $component.attr('data-redactor-type');\n        var current = $component.parent();\n        var data = this.inspector.parse(current);\n        var prev = this.utils.findSiblings($component, 'prev');\n        var next = this.utils.findSiblings($component, 'next');\n        var stop = this.app.broadcast(type + '.delete', $component);\n        if (stop !== false)\n        {\n            $component.remove();\n\n            // callback\n            this.app.broadcast(type + '.deleted', $component);\n            this.app.broadcast('contextbar.close');\n            this.app.broadcast('imageresizer.stop');\n\n            if (caret !== false)\n            {\n                var cell = data.getTableCell();\n                if (cell && this.utils.isEmptyHtml(cell.innerHTML))\n                {\n                    this.caret.setStart(cell);\n                }\n                else if (next) this.caret.setStart(next);\n                else if (prev) this.caret.setEnd(prev);\n                else\n                {\n                    this.editor.startFocus();\n                }\n            }\n\n            // is empty\n            if (this.editor.isEmpty())\n            {\n                this.editor.setEmpty();\n                this.editor.startFocus();\n                this.app.broadcast('empty');\n            }\n        }\n    },\n    isNonEditable: function(el)\n    {\n        var data = this.inspector.parse(el);\n        return (data.isComponent() && !data.isComponentEditable());\n    },\n    isActive: function(el)\n    {\n        var $component;\n        if (el)\n        {\n            var data = this.inspector.parse(el);\n            $component = $R.dom(data.getComponent());\n\n            return $component.hasClass(this.activeClass);\n        }\n        else\n        {\n            $component = this._find();\n\n            return ($component.length !== 0);\n        }\n    },\n    getActive: function(dom)\n    {\n        var $component = this._find();\n\n        return ($component.length !== 0) ? ((dom) ? $component : $component.get()) : false;\n    },\n    setActive: function(el)\n    {\n        this.clearActive();\n        this.editor.focus();\n\n        var data = this.inspector.parse(el);\n        var component = data.getComponent();\n        var $component = $R.dom(component);\n\n        if (!data.isFigcaption())\n        {\n            var $caret = $component.find('.redactor-component-caret');\n            if ($caret.length === 0)\n            {\n                $caret = this._buildCaret();\n                $component.prepend($caret);\n            }\n\n            this.caret.setAtStart($caret.get());\n        }\n\n        $component.addClass(this.activeClass);\n    },\n    clearActive: function()\n    {\n        var $component = this._find();\n\n        $component.removeClass(this.activeClass);\n        $component.find('.redactor-component-caret').remove();\n\n        this.app.broadcast('imageresizer.stop');\n    },\n    setOnEvent: function(e, contextmenu)\n    {\n        this.clearActive();\n\n        var data = this.inspector.parse(e.target);\n        if (data.isFigcaption() || data.isComponentEditable())\n        {\n            return;\n        }\n\n        // component\n        if (data.isComponent())\n        {\n            this.setActive(e.target);\n            if (contextmenu !== true) e.preventDefault();\n        }\n    },\n    executeScripts: function(scripts)\n    {\n        if (scripts === undefined)\n        {\n            var $editor = this.editor.getElement();\n            var scripts = $editor.find('[data-redactor-type]').find(\"script\").getAll();\n            this.executeScripts.call(this, scripts);\n        }\n        else\n        {\n            for (var i = 0; i < scripts.length; i++)\n            {\n                if (scripts[i].src !== '')\n                {\n                    var src = scripts[i].src;\n                    this.$doc.find('head script[src=\"' + src + '\"]').remove();\n\n                    var $script = $R.dom('<script>');\n                    $script.attr('src', src);\n                    $script.attr('async defer');\n                    $script.get().onload = function()\n                    {\n                        if (src.search('instagram') !== -1) window.instgrm.Embeds.process();\n                        this.executeScripts(scripts.slice(i + 1));\n                    }.bind(this);\n\n                    var head = document.getElementsByTagName('head')[0];\n                    if (head) head.appendChild($script.get());\n\n                    break;\n                }\n            }\n        }\n    },\n\n    // private\n    _find: function()\n    {\n        return this.editor.getElement().find('.' + this.activeClass);\n    },\n    _buildCaret: function()\n    {\n        var $caret = $R.dom('<span>');\n        $caret.addClass('redactor-component-caret');\n        $caret.attr('contenteditable', true);\n\n        return $caret;\n    }\n});\n$R.add('service', 'insertion', {\n    init: function(app)\n    {\n        this.app = app;\n    },\n    set: function(html, clean, focus)\n    {\n        if (html === null) {\n            html = '';\n        }\n\n        html = (clean !== false) ? this.cleaner.input(html) : html;\n        html = (clean !== false) ? this.cleaner.paragraphize(html) : html;\n\n        // set html\n        var $editor = this.editor.getElement();\n        $editor.html(html);\n\n        // set focus at the end\n        if (focus !== false) this.editor.endFocus();\n\n        return html;\n    },\n    insertNode: function(node, caret)\n    {\n        this.editor.focus();\n        var fragment = (this.utils.isFragment(node)) ? node : this.utils.createFragment(node);\n\n        this._collapseSelection();\n        this._insertFragment(fragment);\n        this._setCaret(caret, fragment);\n\n        return this._sendNodes(fragment.nodes);\n    },\n    insertBreakLine: function()\n    {\n        return this.insertNode(document.createElement('br'), 'after');\n    },\n    insertNewline: function()\n    {\n        return this.insertNode(document.createTextNode('\\n'), 'after');\n    },\n    insertText: function(text)\n    {\n        return this.insertHtml(this.cleaner.getFlatText(text));\n    },\n    insertChar: function(charhtml)\n    {\n        return this.insertNode(charhtml, 'after');\n    },\n    insertRaw: function(html)\n    {\n        return this.insertHtml(html, false);\n    },\n    insertToEnd: function(lastNode, type)\n    {\n        if (!lastNode) return;\n        if (lastNode.nodeType === 3 && lastNode.nodeValue.search(/^\\n/) !== -1)\n        {\n            lastNode = lastNode.previousElementSibling;\n        }\n\n        var $lastNode = $R.dom(lastNode);\n        if ($lastNode.attr('data-redactor-type') === type)\n        {\n            var tag = (this.opts.breakline) ? '<br>' : '<p>';\n            var $newNode = $R.dom(tag);\n\n            $lastNode.after($newNode);\n            this.caret.setStart($newNode);\n        }\n    },\n    insertPoint: function(e)\n    {\n        var range, data;\n        var marker = this.marker.build('start');\n        var markerInserted = false;\n        var x = e.clientX, y = e.clientY;\n\n        if (document.caretPositionFromPoint)\n        {\n            var pos = document.caretPositionFromPoint(x, y);\n            var sel = document.getSelection();\n\n            data = this.inspector.parse(pos.offsetNode);\n            if (data.isInEditor())\n            {\n                range = sel.getRangeAt(0);\n                range.setStart(pos.offsetNode, pos.offset);\n                range.collapse(true);\n                range.insertNode(marker);\n                markerInserted = true;\n            }\n        }\n        else if (document.caretRangeFromPoint)\n        {\n            range = document.caretRangeFromPoint(x, y);\n\n            data = this.inspector.parse(range.startContainer);\n            if (data.isInEditor())\n            {\n                range.insertNode(marker);\n                markerInserted = true;\n            }\n        }\n\n        return markerInserted;\n    },\n    insertToPoint: function(e, html, point, clean)\n    {\n        var pointInserted = (point === true) ? true : this.insertPoint(e);\n        if (!pointInserted)\n        {\n            var lastNode = this.editor.getLastNode();\n            $R.dom(lastNode).after(this.marker.build('start'));\n        }\n\n        this.component.clearActive();\n        this.selection.restoreMarkers();\n\n        return this.insertHtml(html, clean);\n    },\n    insertToOffset: function(start, html)\n    {\n        this.offset.set({ start: start, end: start });\n\n        return this.insertHtml(html);\n    },\n    insertHtml: function(html, clean)\n    {\n        if (!this.opts.input) return;\n\n        // parse\n        var parsedInput = this.utils.parseHtml(html);\n\n        // all selection\n        if (this.selection.isAll())\n        {\n            return this._insertToAllSelected(parsedInput);\n        }\n\n        // there is no selection\n        if (!this.selection.is())\n        {\n            var $el = $R.dom('<p>');\n            var $editor = this.editor.getElement();\n\n            $editor.append($el);\n            this.caret.setStart($el);\n        }\n\n        // environment\n        var isCollapsed = this.selection.isCollapsed();\n        var isText = this.selection.isText();\n        var current = this.selection.getCurrent();\n        var block = this.selection.getBlock();\n        var dataCurrent = this.inspector.parse(current);\n\n        // collapse air\n        this._collapseSelection();\n\n        // clean\n        parsedInput = this._getCleanedInput(parsedInput, dataCurrent, clean);\n\n        // input is figure or component span\n        var isFigure = this._isFigure(parsedInput.html);\n        var isComponentSpan = this._isComponentSpan(parsedInput.html);\n        var isInsertedText = this.inspector.isText(parsedInput.html);\n        var fragment, except;\n\n        // multiple selection\n        //var blocks = this.selection.getBlocks();\n        //if (blocks && blocks.length > 1) {\n        //    parsedInput.html = (clean !== false) ? this.cleaner.paragraphize(parsedInput.html) : parsedInput.html;\n        //}\n\n        // empty editor\n        if (this.editor.isEmpty())\n        {\n            return this._insertToEmptyEditor(parsedInput.html);\n        }\n        // to component\n        else if (dataCurrent.isComponent() && !dataCurrent.isComponentEditable())\n        {\n            return this._insertToWidget(current, dataCurrent, parsedInput.html);\n        }\n        // component span\n        else if (isComponentSpan)\n        {\n            return this.insertNode(parsedInput.nodes, 'end');\n        }\n        // inserting figure & split node\n        else if (isFigure && !isText && !dataCurrent.isList())\n        {\n            if (dataCurrent.isInline())\n            {\n                return this._insertToInline(current, parsedInput);\n            }\n\n            fragment = this.utils.createFragment(parsedInput.html);\n            this.utils.splitNode(current, fragment);\n            this.caret.setEnd(fragment.last);\n\n            return this._sendNodes(fragment.nodes);\n        }\n        // to code\n        else if (dataCurrent.isCode())\n        {\n            return this._insertToCode(parsedInput, current, clean);\n        }\n        // to pre\n        else if (dataCurrent.isPre())\n        {\n            return this._insertToPre(parsedInput, clean);\n        }\n        // to h1-h6 & figcaption\n        else if (dataCurrent.isHeading() || dataCurrent.isFigcaption())\n        {\n            parsedInput.html = (clean !== false) ? this.cleaner.removeTagsExcept(parsedInput.html, ['a']) : parsedInput.html;\n            parsedInput.html = (clean !== false) ? this.cleaner.replaceNbspToSpaces(parsedInput.html) : parsedInput.html;\n\n            fragment = this.utils.createFragment(parsedInput.html);\n\n            return this.insertNode(fragment, 'end');\n        }\n        // breakline div\n        else if (this.opts.breakline && block && block.tagName === 'DIV') {\n\n            if (this._isPlainHtml(parsedInput.html)) {\n                return this.insertNode(parsedInput.nodes, 'end');\n            }\n\n            parsedInput.html = (clean !== false) ? this.cleaner.paragraphize(parsedInput.html) : parsedInput.html;\n\n\n            fragment = this.utils.createFragment(parsedInput.html);\n\n            var range = this.selection.getRange();\n            if (range && !this.selection.isCollapsed()) {\n                range.deleteContents();\n            }\n\n            this.utils.splitNode(current, fragment);\n            this.caret.setEnd(fragment.last);\n\n            return this._sendNodes(fragment.nodes);\n        }\n        // text inserting\n        else if (isInsertedText)\n        {\n            if (!isText && this.opts.markup !== 'br' && this._hasBlocksAndImages(parsedInput.nodes))\n            {\n                parsedInput.html = (clean !== false) ? this.cleaner.paragraphize(parsedInput.html) : parsedInput.html;\n\n                fragment = this.utils.createFragment(parsedInput.html);\n\n                this.utils.splitNode(current, fragment);\n                this.caret.setEnd(fragment.last);\n                return this._sendNodes(fragment.nodes);\n            }\n\n            parsedInput.html = (clean !== false) ? parsedInput.html.replace(/\\n/g, '<br>') : parsedInput.html;\n\n            fragment = this.utils.createFragment(parsedInput.html);\n\n            return this.insertNode(fragment.nodes, 'end');\n        }\n        // uncollapsed\n        else if (!isCollapsed && !isFigure)\n        {\n            if (this._isPlainHtml(parsedInput.html))\n            {\n                return this.insertNode(parsedInput.nodes, 'end');\n            }\n\n            parsedInput.html = (clean !== false) ? this.cleaner.paragraphize(parsedInput.html) : parsedInput.html;\n            fragment = this.utils.createFragment(parsedInput.html);\n\n            return this.insertNode(fragment, 'end');\n        }\n        // to inline tag\n        else if (dataCurrent.isInline() && !this._isPlainHtml(parsedInput.html))\n        {\n            return this._insertToInline(current, parsedInput);\n        }\n        // to blockquote or dt, dd\n        else if (dataCurrent.isBlockquote() || dataCurrent.isDl())\n        {\n            except = this.opts.inlineTags;\n            except.concat(['br']);\n\n            parsedInput.html = (clean !== false) ? this.cleaner.replaceBlocksToBr(parsedInput.html) : parsedInput.html;\n            parsedInput.html = (clean !== false) ? this.cleaner.removeTagsExcept(parsedInput.html, except) : parsedInput.html;\n\n            fragment = this.utils.createFragment(parsedInput.html);\n\n            return this.insertNode(fragment, 'end');\n        }\n        // to p\n        else if (dataCurrent.isParagraph())\n        {\n            if (this._isPlainHtml(parsedInput.html))\n            {\n                return this.insertNode(parsedInput.nodes, 'end');\n            }\n\n            parsedInput.html = (clean !== false) ? this.cleaner.paragraphize(parsedInput.html) : parsedInput.html;\n\n            fragment = this.utils.createFragment(parsedInput.html);\n\n            this.utils.splitNode(current, fragment);\n            this.caret.setEnd(fragment.last);\n\n            return this._sendNodes(fragment.nodes);\n        }\n        // to li\n        else if (dataCurrent.isList())\n        {\n            except = this.opts.inlineTags;\n            except = except.concat(['br', 'li', 'ul', 'ol', 'img']);\n\n            parsedInput.html = (clean !== false) ? this.cleaner.replaceBlocksToBr(parsedInput.html) : parsedInput.html;\n            parsedInput.html = (clean !== false) ? this.cleaner.removeTagsExcept(parsedInput.html, except) : parsedInput.html;\n            parsedInput.html = (clean !== false) ? this.cleaner.removeBrAtEnd(parsedInput.html) : parsedInput.html;\n\n            fragment = this.utils.createFragment(parsedInput.html);\n            parsedInput.nodes = fragment.nodes;\n\n            if (this._containsTags(parsedInput.html, ['ul', 'ol', 'li']))\n            {\n                var element = this.selection.getElement(current);\n                if (element && element.tagName === 'LI' && this.caret.isStart(element))\n                {\n                    parsedInput.nodes = $R.dom(fragment.nodes).unwrap('ul, ol').getAll();\n                    $R.dom(element).before(parsedInput.nodes);\n\n                    var lastNode = parsedInput.nodes[parsedInput.nodes.length-1];\n                    this.caret.setEnd(lastNode);\n\n                    return this._sendNodes(parsedInput.nodes);\n                }\n                else if (this._isPlainHtml(parsedInput.html))\n                {\n                    return this.insertNode(fragment, 'end');\n                }\n                else\n                {\n                    fragment = this._buildList(parsedInput, element, fragment);\n\n                    this.utils.splitNode(current, fragment, true);\n                    this.caret.setEnd(fragment.last);\n\n                    return this._sendNodes(fragment.nodes);\n                }\n            }\n        }\n\n        // other cases\n        return this.insertNode(parsedInput.nodes, 'end');\n    },\n\n    // private\n    _insertToAllSelected: function(parsedInput)\n    {\n        var insertedHtml = this.set(parsedInput.html);\n        var dataInserted = this.utils.parseHtml(insertedHtml);\n\n        return this._sendNodes(dataInserted.nodes);\n    },\n    _insertToEmptyEditor: function(html)\n    {\n        html = this.cleaner.paragraphize(html);\n\n        var fragment = this.utils.createFragment(html);\n        var $editor = this.editor.getElement();\n\n        $editor.html('');\n        $editor.append(fragment.frag);\n\n        this.caret.setEnd(fragment.last);\n\n        return this._sendNodes(fragment.nodes);\n    },\n    _insertToInline: function(current, parsedInput)\n    {\n        var fragment = this.utils.createFragment(parsedInput.html);\n        this.utils.splitNode(current, fragment, false, true);\n        this.caret.setEnd(fragment.last);\n\n        return this._sendNodes(fragment.nodes);\n    },\n    _insertToCode: function(parsedInput, current, clean)\n    {\n        parsedInput.html = (clean !== false) ? this.cleaner.encodeHtml(parsedInput.html) : parsedInput.html;\n        parsedInput.html = (clean !== false) ? this.cleaner.removeNl(parsedInput.html) : parsedInput.html;\n\n        var fragment = this.utils.createFragment(parsedInput.html);\n        var nodes = this.insertNode(fragment, 'end');\n\n        this.utils.normalizeTextNodes(current);\n\n        return nodes;\n    },\n    _insertToPre: function(parsedInput, clean)\n    {\n        parsedInput.html = (clean !== false) ? this.cleaner.encodeHtml(parsedInput.html) : parsedInput.html;\n\n        var fragment = this.utils.createFragment(parsedInput.html);\n\n        return this.insertNode(fragment, 'end');\n    },\n    _insertToWidget: function(current, dataCurrent, html)\n    {\n        html = (this._isComponentSpan(html)) ? html : this.cleaner.paragraphize(html);\n\n        var fragment = this.utils.createFragment(html);\n        var component = dataCurrent.getComponent();\n        var $component = $R.dom(component);\n\n        $component.after(fragment.frag);\n        $component.remove();\n\n        this.caret.setEnd(fragment.last);\n\n        return this._sendNodes(fragment.nodes);\n    },\n    _insertFragment: function(fragment)\n    {\n        var range = this.selection.getRange();\n        if (range)\n        {\n            if (this.selection.isCollapsed())\n            {\n                var startNode = range.startContainer;\n                if (startNode.nodeType !== 3 && startNode.tagName === 'BR')\n                {\n                    this.caret.setAfter(startNode);\n                    startNode.parentNode.removeChild(startNode);\n                }\n            }\n            else\n            {\n                range.deleteContents();\n            }\n\n            range.insertNode(fragment.frag);\n        }\n    },\n    _sendNodes: function(nodes)\n    {\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var el = nodes[i];\n            var type = (el.nodeType !== 3 && typeof el.getAttribute === 'function') ? el.getAttribute('data-redactor-type') : false;\n            if (type)\n            {\n                this.app.broadcast(type + '.inserted', this.component.build(el));\n            }\n        }\n\n        if (this.detector.isIe())\n        {\n            this.editor.getElement().find('[data-redactor-type=table]').attr('contenteditable', true);\n        }\n\n        // callback\n        this.app.broadcast('inserted', nodes);\n\n        // widget's scripts\n        this.component.executeScripts();\n\n        return nodes;\n    },\n    _setCaret: function(caret, fragment)\n    {\n        var isLastInline = this._isLastInline(fragment);\n\n        if (caret)\n        {\n            caret = (isLastInline && caret === 'end') ? 'after' : caret;\n            this.caret['set' + this.utils.ucfirst(caret)](fragment.last);\n        }\n        else if (caret !== false)\n        {\n            if (isLastInline) this.caret.setAfter(fragment.last);\n        }\n    },\n    _isLastInline: function(fragment)\n    {\n        if (fragment.last)\n        {\n            var data = this.inspector.parse(fragment.last);\n\n            return data.isInline();\n        }\n\n        return false;\n    },\n    _getCleanedInput: function(parsedInput, dataCurrent, clean)\n    {\n        var isPreformatted = (dataCurrent.isCode() || dataCurrent.isPre());\n\n        parsedInput.html = parsedInput.html.replace(/&nbsp;/g, ' ');\n        parsedInput.html = (!isPreformatted && clean !== false) ? this.cleaner.input(parsedInput.html) : parsedInput.html;\n        parsedInput = (!isPreformatted && clean !== false) ? this.utils.parseHtml(parsedInput.html) : parsedInput;\n\n        return parsedInput;\n    },\n    _getContainer: function(nodes)\n    {\n        return $R.dom(this.utils.createTmpContainer(nodes));\n    },\n    _buildList: function(parsedInput, list, fragment)\n    {\n        var nodes = parsedInput.nodes;\n        var first = nodes[0];\n\n        if (first && first.nodeType !== 3 && first.tagName === 'li')\n        {\n            var $parent = $R.dom(list);\n            var parentListTag = $parent.get().tagName.toLowerCase();\n            var $list = $R.dom('<' + parentListTag + ' />');\n            $list.append(fragment.nodes);\n\n            return this.utils.createFragment($list.get().outerHTML);\n        }\n\n        return fragment;\n    },\n    _containsTags: function(html, tags)\n    {\n        return (this._getContainer(html).find(tags.join(',')).length !== 0);\n    },\n    _collapseSelection: function()\n    {\n        //if (this.app.isAirToolbar()) this.selection.collapseToEnd();\n    },\n    _hasFigureOrTable: function(nodes)\n    {\n        return (this._getContainer(nodes).find('figure, table').length !== 0);\n    },\n    _hasBlocks: function(nodes)\n    {\n        return (this._getContainer(nodes).find(this.opts.blockTags.join(',')).length !== 0);\n    },\n    _hasBlocksAndImages: function(nodes)\n    {\n        return (this._getContainer(nodes).find(this.opts.blockTags.join(',') + ',img').length !== 0);\n    },\n    _isPlainHtml: function(html)\n    {\n        return (this._getContainer(html).find(this.opts.blockTags.join(',') + ', img').length === 0);\n    },\n    _isFigure: function(html)\n    {\n        if (this._isHtmlString(html))\n        {\n            return ($R.dom(html).closest('figure').length !== 0);\n        }\n    },\n    _isComponentSpan: function(html)\n    {\n        if (this._isHtmlString(html))\n        {\n            return ($R.dom(html).closest('span.redactor-component').length !== 0);\n        }\n    },\n    _isHtmlString: function(html)\n    {\n        return !(typeof html === 'string' && !/^\\s*<(\\w+|!)[^>]*>/.test(html));\n    }\n});\n$R.add('service', 'block', {\n    init: function(app) {\n        this.app = app;\n        this.tags = ['p', 'div', 'blockquote', 'pre', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6'];\n    },\n    // format\n    format: function(args) {\n\n        // params\n        this.params = {\n            args: false\n        };\n\n        // type of applying styles and attributes\n        this.params.type = (args.type) ? args.type : 'set'; // add, remove, toggle\n\n        // tag\n        this.params.tag = (typeof args === 'string') ? args : (args.tag || this.opts.markup);\n        this.params.tag = this.params.tag.toLowerCase();\n\n        // args\n        this.params.args = {\n            'class': args['class'] || false,\n            'style': args['style'] || false,\n            'attr': args['attr'] || false\n        };\n\n        if (!args['class'] && !args['style'] && !args['attr']) {\n            this.params.args = false;\n        }\n\n        // format\n        return this._format();\n    },\n\n    // funcs\n    add: function(args, tags, el) {\n        return this._apply('add', args, tags, true, el);\n    },\n    set: function(args, tags) {\n        return this._apply('set', args, tags);\n    },\n    toggle: function(args, tags) {\n        return this._apply('toggle', args, tags);\n    },\n    remove: function(args, tags) {\n        return this._apply('remove', args, tags);\n    },\n\n    // clear\n    clearFormat: function(tags) {\n        return this._clear(tags, 'all');\n    },\n    clearStyle: function(tags) {\n        return this._clear(tags, 'style');\n    },\n    clearClass: function(tags) {\n        return this._clear(tags, 'class');\n    },\n    clearAttr: function(tags) {\n        return this._clear(tags, 'attr');\n    },\n\n    // format\n    _format: function() {\n\n        var nodes = [];\n\n        // collapsed\n        this.collapsed = this.selection.isCollapsed();\n\n        // save selection\n        this.selection.save();\n\n        // blocks\n        var block = this.selection.getBlock();\n        var blocks = this._getBlocks();\n        var type = (this._isToggleFormatType(blocks)) ? 'toggle' : 'set';\n        var replacedTag = this._getReplacedTag(type);\n\n        nodes = this._replaceBlocks(blocks, replacedTag);\n\n        // apply args & clean\n        nodes = this._buildNodes(nodes);\n\n        // restore selection\n        this._restoreSelection(nodes);\n\n        return nodes;\n    },\n\n\n    // clear\n    _clear: function(tags, type, selection, nodes) {\n        // save selection\n        if (selection !== false) {\n\t\t    this.selection.save();\n\t\t}\n\n        // get elements\n        var $elements = this._getElements(tags, nodes);\n\n        // remove all format\n        if (type === 'all') {\n            this._removeAllAttr($elements, false);\n        }\n        // remove style\n        else if (type === 'style') {\n            $elements.removeAttr('style');\n            $elements.removeAttr('data-redactor-style-cache');\n        }\n        // remove class\n        else if (type === 'class') {\n            $elements.removeAttr('class');\n        }\n        // remove attrs\n        else if (type === 'attr') {\n            this._removeAllAttr($elements);\n        }\n\n        // get nodes\n        nodes = $elements.getAll();\n\n        // restore selection\n        if (selection !== false) {\n            this._restoreSelection(nodes);\n        }\n\n        return nodes;\n    },\n\n    // get\n    _getElements: function(tags, nodes) {\n        return (nodes) ? $R.dom(nodes) : $R.dom(this._getBlocks(tags));\n    },\n    _getBlocks: function(tags) {\n        var blocks = this.selection.getBlocks({ tags: tags || this.tags });\n        var finalBlocks = [];\n        for (var i = 0; i < blocks.length; i++) {\n            if (blocks[i].tagName === 'DIV' && !blocks[i].getAttribute('data-redactor-tag')) {\n                continue;\n            }\n            else {\n                finalBlocks.push(blocks[i]);\n            }\n        }\n\n        return finalBlocks;\n    },\n\n    _getReplacedTag: function(type) {\n        if (this.opts.breakline) {\n            return (type === 'toggle') ? 'div' : (this.params.tag === 'p') ? 'div' : this.params.tag;\n        }\n        else {\n            return (type === 'toggle') ? this.opts.markup : this.params.tag;\n        }\n    },\n\n    // is\n    _isStandardParagraph: function() {\n        return (!this.opts.breakline && this.opts.markup === 'p');\n    },\n    _isStandardDiv: function() {\n        return (!this.opts.breakline && this.opts.markup === 'div');\n    },\n    _isBreaklineBlock: function(block) {\n        return (block && block.tagName === 'DIV' && block.getAttribute('data-redactor-tag') === 'br');\n    },\n    _isToggleFormatType: function(blocks) {\n        var count = 0;\n        var len = blocks.length;\n        for (var i = 0; i < len; i++) {\n            if (blocks[i] && this.params.tag === blocks[i].tagName.toLowerCase()) count++;\n        }\n\n        return (count === len);\n    },\n    _isCurrentBlockOneAndEmpty: function(nodes) {\n        return (this.collapsed && nodes.length === 1 && this.utils.isEmpty(nodes[0]));\n    },\n\n    // build\n    _buildNodes: function(nodes) {\n        if (nodes.length > 0) {\n            // clean & appliyng styles and attributes\n            nodes = this._applyArgs(nodes, false);\n            nodes = this._combinePre(nodes);\n            nodes = this._cleanBlocks(nodes);\n        }\n\n        return nodes;\n    },\n\n    // replace\n    _replaceBlocks: function(blocks, replacedTag) {\n        var nodes = [];\n\n        for (var i = 0; i < blocks.length; i++) {\n            var $node = this.utils.replaceToTag(blocks[i], replacedTag);\n            nodes.push($node.get());\n        }\n\n        return nodes;\n    },\n\n    // combine\n    _combinePre: function(nodes) {\n        var combinedNodes = [];\n        for (var i = 0; i < nodes.length; i++) {\n            var next = nodes[i].nextElementSibling;\n            if (next && nodes[i].tagName === 'PRE' && next.tagName === 'PRE') {\n                var $current = $R.dom(nodes[i]);\n                var $next = $R.dom(next);\n                var newline = document.createTextNode('\\n');\n\n                $current.append(newline);\n                $current.append($next);\n                $next.unwrap('pre');\n            }\n\n            combinedNodes.push(nodes[i]);\n        }\n\n        return combinedNodes;\n    },\n\n    // clean\n    _cleanBlocks: function(nodes) {\n        var headings = ['h1', 'h2', 'h3', 'h4', 'h5', 'h6'];\n        var tags = this.opts.inlineTags;\n        for (var i = 0; i < nodes.length; i++) {\n            var tag = nodes[i].tagName.toLowerCase();\n            var $node = $R.dom(nodes[i]);\n\n            // remove all spans in headings\n            if (headings.indexOf(tag) !== - 1) {\n                $node.find('span').not('.redactor-component, .non-editable, .redactor-selection-marker').unwrap();\n            }\n            // remove all inlines in pre\n            else if (tag === 'pre') {\n                $node.find(tags.join(',')).not('.redactor-selection-marker').unwrap();\n            }\n\n\n            if (this.params.args === false && this.params.tag === 'p') {\n                $node.removeAttr('class');\n            }\n\n            // breakline attr\n            if (this.opts.breakline && tag === 'div') {\n                $node.attr('data-redactor-tag', 'br');\n            }\n            else {\n                $node.removeAttr('data-redactor-tag');\n            }\n\n            // normalize\n            this.utils.normalizeTextNodes(nodes[i]);\n        }\n\n        return nodes;\n    },\n    _cleanEmptyClass: function($elements) {\n        $elements.each(function(node) {\n            if (node.className === '') node.removeAttribute('class');\n        });\n    },\n    _cleanEmptyStyle: function($node) {\n         if (this.utils.removeEmptyAttr($node.get(), 'style')) {\n            $node.removeAttr('data-redactor-style-cache');\n        }\n        else {\n            $node.attr('data-redactor-style-cache', $node.attr('style'));\n        }\n    },\n\n    // apply\n    _apply: function(type, args, tags, selection, nodes) {\n        // save selection\n        if (selection !== false) {\n\t\t    this.selection.save();\n\t\t}\n\n        // get elements\n        var $elements = this._getElements(tags, nodes);\n\n        // class\n        if (args['class']) {\n            if (type === 'set') {\n                $elements.removeAttr('class');\n                $elements.addClass(args['class']);\n            }\n            else if (type === 'add') {\n                $elements.addClass(args['class']);\n            }\n            else if (type === 'toggle') {\n                $elements.toggleClass(args['class']);\n            }\n            else if (type === 'remove') {\n                $elements.removeClass(args['class']);\n            }\n\n            this._cleanEmptyClass($elements);\n        }\n\n        // attr\n        if (args['attr']) {\n            if (type === 'set') {\n                this._removeAllAttr($elements);\n                $elements.attr(args['attr']);\n            }\n            else if (type === 'add') {\n                $elements.attr(args['attr']);\n            }\n            else if (type === 'toggle') {\n                params = args['attr'];\n                $elements.each(function(node) {\n                    var $node = $R.dom(node);\n                    for (var key in params) {\n                        if ($node.attr(key)) $node.removeAttr(key);\n                        else $node.attr(key, params[key]);\n                    }\n                });\n            }\n            else if (type === 'remove') {\n                $elements.removeAttr(args['attr']);\n            }\n        }\n\n        // style\n        if (args['style']) {\n            if (type === 'set') {\n                $elements.removeAttr('style');\n                $elements.css(args['style']);\n                $elements.each(function(node) {\n                    var $node = $R.dom(node);\n                    $node.attr('data-redactor-style-cache', $node.attr('style'));\n                });\n            }\n            else if (type === 'add') {\n                var params = args['style'];\n                $elements.each(function(node) {\n                    var $node = $R.dom(node);\n                    $node.css(params);\n                    $node.attr('data-redactor-style-cache', $node.attr('style'));\n                    this._convertStyleQuotes($node);\n                }.bind(this));\n            }\n            else if (type === 'toggle') {\n                var params = args['style'];\n                $elements.each(function(node) {\n                    var $node = $R.dom(node);\n                    for (var key in params) {\n                        var newVal = params[key];\n                        var oldVal = $node.css(key);\n\n                        oldVal = (this.utils.isRgb(oldVal)) ? this.utils.rgb2hex(oldVal) : oldVal.replace(/\"/g, '');\n                        newVal = (this.utils.isRgb(newVal)) ? this.utils.rgb2hex(newVal) : newVal.replace(/\"/g, '');\n\n                        oldVal = this.utils.hex2long(oldVal);\n                        newVal = this.utils.hex2long(newVal);\n\n                        var compareNew = (typeof newVal === 'string') ? newVal.toLowerCase() : newVal;\n                        var compareOld = (typeof oldVal === 'string') ? oldVal.toLowerCase() : oldVal;\n\n                        if (compareNew === compareOld) $node.css(key, '');\n                        else $node.css(key, newVal);\n                    }\n\n                    this._convertStyleQuotes($node);\n                    this._cleanEmptyStyle($node);\n                }.bind(this));\n            }\n            else if (type === 'remove') {\n                var name = args['style'];\n                $elements.each(function(node) {\n                    var $node = $R.dom(node);\n                    $node.css(name, '');\n                    this._cleanEmptyStyle($node);\n                }.bind(this));\n            }\n        }\n\n        // get nodes\n        nodes = $elements.getAll();\n\n        // restore selection\n        if (selection !== false) {\n            this._restoreSelection(nodes);\n        }\n\n        return nodes;\n    },\n    _applyArgs: function(nodes) {\n        if (this.params.args) {\n            nodes = this._apply(this.params.type, this.params.args, false, false, nodes);\n        }\n        else {\n            nodes = this._clear(false, 'all', false, nodes);\n        }\n\n        return nodes;\n    },\n\n    // remove\n    _removeAllAttr: function($elements, keepStyleAndClass) {\n        $elements.each(function(node) {\n            var keepAttrs = ['data-redactor-tag', 'data-redactor-style-cache'];\n            if (keepStyleAndClass === false) {\n                keepAttrs.push('style');\n                keepAttrs.push('class');\n            }\n\n            for (var i = node.attributes.length; i--> 0;) {\n                var nodeAttr = node.attributes[i];\n                var name = nodeAttr.name;\n                if (keepAttrs.indexOf(name) === -1) {\n                    node.removeAttributeNode(nodeAttr);\n                }\n            }\n        });\n    },\n\n    // selection\n    _restoreSelection: function(nodes) {\n        if (this._isCurrentBlockOneAndEmpty(nodes)) {\n            this.caret.setStart(nodes[0]);\n        }\n        else {\n            setTimeout(function() { this.selection.restore(); }.bind(this), 1);\n        }\n    },\n\n    // convert\n    _convertStyleQuotes: function($node) {\n        var style = $node.attr('style');\n        if (style) $node.attr('style', style.replace(/\"/g, '\\''));\n    }\n});\n$R.add('service', 'inline', {\n    mixins: ['formatter'],\n    init: function(app)\n    {\n        this.app = app;\n\n        this.count = 0;\n    },\n    // public\n    format: function(args)\n    {\n        if (!this._isFormat()) return [];\n\n        // type of applying styles and attributes\n        this.type = (args.type) ? args.type : 'set'; // add, remove, toggle\n        // tag\n        this.tag = (typeof args === 'string') ? args : args.tag;\n        this.tag = this.tag.toLowerCase();\n        this.tag = this.arrangeTag(this.tag);\n\n        if (typeof args === 'string') this.args = false;\n        else this.buildArgs(args);\n\n        if (!this.detector.isIe())\n        {\n            this.editor.disableNonEditables();\n        }\n\n        // format\n        var nodes = (this.selection.isCollapsed()) ? this.formatCollapsed() : this.formatUncollapsed();\n\n        if (!this.detector.isIe())\n        {\n            this.editor.enableNonEditables();\n        }\n\n        return nodes;\n    },\n\n    // private\n    _isFormat: function()\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var isComponent = (data.isComponent() && !data.isComponentType('table') && !data.isFigcaption());\n\n        if (current === false && this.selection.isAll())\n        {\n            return true;\n        }\n        else if (!current || data.isPre() || data.isCode() || isComponent)\n        {\n            return false;\n        }\n\n        return true;\n    },\n    arrangeTag: function(tag)\n    {\n        var replaced = this.opts.replaceTags;\n        for (var key in replaced)\n        {\n            if (tag === key) tag = replaced[key];\n        }\n\n        return tag;\n    },\n    formatCollapsed: function()\n    {\n        var nodes = [];\n        var inline = this.selection.getInlineFirst();\n        var inlines = this.selection.getInlines({ all: true });\n        var $inline = $R.dom(inline);\n        var $parent, parent, $secondPart, extractedContent;\n\n        // 1) not inline\n        if (!inline)\n        {\n            nodes = this.insertInline(nodes);\n        }\n        else\n        {\n            var dataInline = this.inspector.parse(inline);\n            var isEmpty = this.utils.isEmptyHtml(inline.innerHTML);\n\n            // 2) inline is empty\n            if (isEmpty)\n            {\n                // 2.1) has same tag\n                if (inline.tagName.toLowerCase() === this.tag)\n                {\n                    // 2.1.1) has same args or hasn't args\n                    if (this.hasSameArgs(inline))\n                    {\n                        this.caret.setAfter(inline);\n                        $inline.remove();\n\n                        var el = this.selection.getElement();\n                        this.utils.normalizeTextNodes(el);\n                    }\n                    // 2.1.2) has different args and it is span tag\n                    else if (this.tag === 'span')\n                    {\n                        nodes = this.applyArgs([inline], false);\n                        this.caret.setStart(inline);\n                    }\n                    // 2.1.3) has different args and it is not span tag\n                    else\n                    {\n                       nodes = this.insertInline(nodes);\n                    }\n\n                }\n                // 2.2) has another tag\n                else\n                {\n                    // 2.2.1) has parent\n                    if (dataInline.hasParent([this.tag]))\n                    {\n                        $parent = $inline.closest(this.tag);\n                        parent = $parent.get();\n                        if (this.hasSameArgs(parent))\n                        {\n                            $parent.unwrap();\n                            this.caret.setStart(inline);\n                        }\n                        else\n                        {\n                            nodes = this.insertInline(nodes);\n                        }\n                    }\n                    // 2.2.2) hasn't parent\n                    else\n                    {\n                        nodes = this.insertInline(nodes);\n                    }\n                }\n            }\n            // 3) inline isn't empty\n            else\n            {\n                // 3.1) has same tag\n                if (inline.tagName.toLowerCase() === this.tag)\n                {\n                    // 3.1.1) has same args or hasn't args\n                    if (this.hasSameArgs(inline))\n                    {\n                        // insert break\n                        extractedContent = this.utils.extractHtmlFromCaret(inline);\n                        $secondPart = $R.dom('<' + this.tag + ' />');\n                        $secondPart = this.utils.cloneAttributes(inline, $secondPart);\n\n                        $inline.after($secondPart.append(extractedContent));\n\n                        if ($secondPart.html().trim() === '') {\n                            $secondPart.remove();\n                        }\n\n                        this.caret.setAfter(inline);\n                    }\n                    else\n                    {\n                        nodes = this.insertInline(nodes);\n                    }\n                }\n                // 3.2) has another tag\n                else\n                {\n                    // 3.2.1) has parent\n                    if (dataInline.hasParent([this.tag]))\n                    {\n                        $parent = $inline.closest(this.tag);\n                        parent = $parent.get();\n                        if (this.hasSameArgs(parent))\n                        {\n                            // insert break\n                            extractedContent = this.utils.extractHtmlFromCaret(parent, parent);\n                            $secondPart = $R.dom('<' + this.tag + ' />');\n                            $secondPart = this.utils.cloneAttributes(parent, $secondPart);\n\n                            var $breaked, $last;\n                            var z = 0;\n                            inlines = inlines.reverse();\n                            for (var i = 0; i < inlines.length; i++)\n                            {\n                                if (inlines[i] !== parent)\n                                {\n                                    $last = $R.dom('<' + inlines[i].tagName.toLowerCase() + '>');\n                                    if (z === 0)\n                                    {\n                                        $breaked = $last;\n                                    }\n                                    else\n                                    {\n                                        $breaked.append($last);\n                                    }\n\n                                    z++;\n                                }\n                            }\n\n                            $parent.after($secondPart.append(extractedContent));\n                            $parent.after($breaked);\n\n                            this.caret.setStart($last);\n                        }\n                        else\n                        {\n                            nodes = this.insertInline(nodes);\n                        }\n                    }\n                    // 3.2.2) hasn't parent\n                    else\n                    {\n                        nodes = this.insertInline(nodes);\n                    }\n                }\n            }\n        }\n\n        return nodes;\n    },\n    insertInline: function(nodes)\n    {\n        var node = document.createElement(this.tag);\n        nodes = this.insertion.insertNode(node, 'start');\n\n        return this.applyArgs(nodes, false);\n    },\n    hasSameArgs: function(inline)\n    {\n        if (inline.attributes.length === 0 && this.args === false)\n        {\n            return true;\n        }\n        else\n        {\n            var same = true;\n            if (this.args)\n            {\n                var count = 0;\n                for (var key in this.args)\n                {\n                    var $node = $R.dom(inline);\n                    var args = (this.args[key]);\n                    var value = this.utils.toParams(args);\n                    var nodeAttrValue = $node.attr(key);\n\n                    if (args)\n                    {\n                        if (key === 'style')\n                        {\n                            value = value.trim().replace(/;$/, '');\n\n                            var origRules = this.utils.styleToObj($node.attr('style'));\n                            var rules = value.split(';');\n                            var innerCount = 0;\n\n                            for (var i = 0; i < rules.length; i++)\n                            {\n                                var arr = rules[i].split(':');\n                                var ruleName = arr[0].trim();\n                                var ruleValue = arr[1].trim();\n\n                                if (ruleName.search(/color/) !== -1)\n                                {\n                                    var val = $node.css(ruleName);\n                                    if (val && (val === ruleValue || this.utils.rgb2hex(val) === ruleValue))\n                                    {\n                                        innerCount++;\n                                    }\n                                }\n                                else if ($node.css(ruleName) === ruleValue)\n                                {\n                                    innerCount++;\n                                }\n                            }\n\n                            if (innerCount === rules.length && Object.keys(origRules).length === rules.length)\n                            {\n                                count++;\n                            }\n                        }\n                        else\n                        {\n                            if (nodeAttrValue === value)\n                            {\n                                count++;\n                            }\n                        }\n                    }\n                    else\n                    {\n                        if (!nodeAttrValue || nodeAttrValue === '')\n                        {\n                            count++;\n                        }\n                    }\n                }\n\n                same = (count === Object.keys(this.args).length);\n            }\n\n            return same;\n        }\n    },\n    formatUncollapsed: function()\n    {\n        var inlines = this.selection.getInlines({ all: true, inside: true });\n\n        if (this.detector.isIe()) this.selection.saveMarkers();\n        else this.selection.save();\n\n        // convert del / u\n        this._convertTags('u');\n        this._convertTags('del');\n\n        // convert target tags\n        this._convertToStrike(inlines);\n\n        if (this.detector.isIe()) this.selection.restoreMarkers();\n        else this.selection.restore();\n\n        // apply strike\n        document.execCommand('strikethrough');\n\n        // clear decoration\n        this._clearDecoration();\n\n        this.selection.save();\n\n        // revert and set style\n        var nodes = this._revertToInlines();\n        nodes = this.applyArgs(nodes, false);\n\n        // unwrap if attributes was removed\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var node = nodes[i];\n            var tag = node.tagName.toLowerCase();\n            var len = node.attributes.length;\n\n            if (tag === this.tag && len === 0 && this.args)\n            {\n                $R.dom(node).unwrap();\n                nodes.splice(i, 1);\n            }\n        }\n\n        this.selection.restore();\n\n        // clear and normalize\n        this._clearEmptyStyle();\n        nodes = this._normalizeBlocks(nodes);\n\n        return nodes;\n    },\n    _convertTags: function(tag)\n    {\n        if (this.tag !== tag)\n        {\n            var $editor = this.editor.getElement();\n            $editor.find(tag).each(function(node)\n            {\n                var $el = this.utils.replaceToTag(node, 'span');\n                $el.addClass('redactor-convertable-' + tag);\n            }.bind(this));\n        }\n    },\n    _revertTags: function(tag)\n    {\n        var $editor = this.editor.getElement();\n\n        $editor.find('span.redactor-convertable-' + tag).each(function(node)\n        {\n            var $el = this.utils.replaceToTag(node, tag);\n            $el.removeClass('redactor-convertable-' + tag);\n            if (this.utils.removeEmptyAttr($el, 'class')) $el.removeAttr('class');\n\n        }.bind(this));\n    },\n    _convertToStrike: function(inlines)\n    {\n        var selected = this.selection.getText().replace(/[-[\\]/{}()*+?.\\\\^$|]/g, \"\\\\$&\");\n\n        for (var i = 0; i < inlines.length; i++)\n        {\n            var tag = this.arrangeTag(inlines[i].tagName.toLowerCase());\n            var inline = inlines[i];\n            var $inline = $R.dom(inline);\n            var hasSameArgs = this.hasSameArgs(inline);\n\n            if (tag === this.tag)\n            {\n\n                if (this.tag === 'span' && this._isTextSelected(inline, selected))\n                {\n                    $inline.addClass('redactor-convertable-apply');\n                }\n                else if (hasSameArgs && this.tag !== 'a')\n                {\n                    this._replaceToStrike($inline);\n                }\n                else if (this.tag === 'span')\n                {\n                    if (this.args && this.args.style) {\n                        for (var key in this.args.style) {\n                            $inline.css(key, '');\n                        }\n                    }\n\n                    if (this.utils.removeEmptyAttr($inline.get(), 'style')) {\n                        $inline.addClass('redactor-convertable-apply');\n                    }\n                    else {\n                        $inline.addClass('redactor-unconvertable-apply');\n                    }\n                }\n                else if (!hasSameArgs)\n                {\n                    $inline.addClass('redactor-convertable-apply');\n                }\n\n            }\n        }\n    },\n    _replaceToStrike: function($el)\n    {\n        $el.replaceWith(function()\n        {\n            return $R.dom('<strike>').append($el.contents());\n        });\n    },\n    _revertToInlines: function()\n    {\n        var nodes = [];\n        var $editor = this.editor.getElement();\n\n        if (this.tag !== 'u') $editor.find('u').unwrap();\n\n        $editor.find('.redactor-convertable-u').each(function(node)\n        {\n             nodes.push(node);\n\n        });\n\n        // span convertable\n        $editor.find('.redactor-convertable-apply').each(function(node)\n        {\n            var $node = $R.dom(node);\n            $node.find('strike').unwrap();\n\n            this._forceRemoveClass($node, 'redactor-convertable-apply');\n            nodes.push(node);\n\n        }.bind(this));\n\n        // span unconvertable\n        $editor.find('span.redactor-unconvertable-apply').each(function(node)\n        {\n            var $node = $R.dom(node);\n            this._forceRemoveClass($node, 'redactor-unconvertable-apply');\n\n        }.bind(this));\n\n        // strike\n        $editor.find('strike').each(function(node)\n        {\n            var $node = this.utils.replaceToTag(node, this.tag);\n            nodes.push($node.get());\n\n        }.bind(this));\n\n\n        this._revertTags('u');\n        this._revertTags('del');\n\n        return nodes;\n    },\n    _normalizeBlocks: function(nodes)\n    {\n        var tags = this.opts.inlineTags;\n        var blocks = this.selection.getBlocks();\n        if (blocks)\n        {\n            for (var i = 0; i < blocks.length; i++)\n            {\n                if (blocks[i].tagName === 'PRE')\n                {\n                    var $node = $R.dom(blocks[i]);\n                    $node.find(tags.join(',')).not('.redactor-selection-marker').each(function(inline)\n                    {\n                        if (nodes.indexOf(inline) !== -1)\n                        {\n                            nodes = this.utils.removeFromArrayByValue(nodes, inline);\n                        }\n\n                        $R.dom(inline).unwrap();\n                    }.bind(this));\n                }\n            }\n        }\n\n        return nodes;\n    },\n    _clearDecoration: function()\n    {\n        var $editor = this.editor.getElement();\n        $editor.find(this.opts.inlineTags.join(',')).each(function(node)\n        {\n            if (node.style.textDecoration === 'line-through' || node.style.textDecorationLine === 'line-through')\n            {\n                var $el = $R.dom(node);\n                $el.css('textDecorationLine', '');\n                $el.css('textDecoration', '');\n                $el.wrap('<strike>');\n            }\n        });\n    },\n    _clearEmptyStyle: function()\n    {\n        var inlines = this.getInlines();\n        for (var i = 0; i < inlines.length; i++)\n        {\n            this._clearEmptyStyleAttr(inlines[i]);\n\n            var childNodes = inlines[i].childNodes;\n            if (childNodes)\n            {\n                for (var z = 0; z < childNodes.length; z++)\n                {\n                    this._clearEmptyStyleAttr(childNodes[z]);\n                }\n            }\n        }\n    },\n    _clearEmptyStyleAttr: function(node)\n    {\n        if (node.nodeType !== 3 && this.utils.removeEmptyAttr(node, 'style'))\n        {\n            node.removeAttribute('style');\n            node.removeAttribute('data-redactor-style-cache');\n        }\n    },\n    _forceRemoveClass: function($node, classname)\n    {\n        $node.removeClass(classname);\n        if (this.utils.removeEmptyAttr($node, 'class')) $node.removeAttr('class');\n    },\n    _isTextSelected: function(node, selected)\n    {\n        var text = this.utils.removeInvisibleChars(node.textContent);\n\n        return (selected === text || selected.search(new RegExp('^' + this.utils.escapeRegExp(text) + '$')) !== -1);\n    },\n    getInlines: function(tags)\n    {\n        return (tags) ? this.selection.getInlines({ tags: tags, all: true }) : this.selection.getInlines({ all: true });\n    },\n    getElements: function(tags)\n    {\n        return $R.dom(this.getInlines(tags));\n    },\n    clearFormat: function()\n    {\n        this.selection.save();\n\n        var nodes = this.selection.getInlines({ all: true });\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var $el = $R.dom(nodes[i]);\n            var inline = this.selection.getInline(nodes[i]);\n            if (inline)\n            {\n                $el.unwrap();\n            }\n        }\n\n        this.selection.restore();\n    }\n});\n$R.add('service', 'autoparser', {\n    init: function(app)\n    {\n        this.app = app;\n        this.cleaner = this.app.cleaner;\n    },\n    observe: function()\n    {\n        var $editor = this.editor.getElement();\n        var $objects = $editor.find('.redactor-autoparser-object').each(function(node)\n        {\n           var $node = $R.dom(node);\n           $node.removeClass('redactor-autoparser-object');\n           if ($node.attr('class') === '') $node.removeAttr('class');\n        });\n\n        if ($objects.length > 0)\n        {\n            $objects.each(function(node)\n            {\n                var type;\n                var $object = false;\n                var tag = node.tagName;\n\n                if (tag === 'A') type = 'link';\n                else if (tag === 'IMG') type = 'image';\n                else if (tag === 'IFRAME') type = 'video';\n\n                if (type)\n                {\n                    $object = $R.create(type + '.component', this.app, node);\n                    this.app.broadcast(type + '.inserted', $object);\n                    this.app.broadcast('autoparse', type, $object);\n                }\n\n            }.bind(this));\n        }\n    },\n    format: function(e, key)\n    {\n        if (this._isKey(key))\n        {\n            this._format(key === this.keycodes.ENTER);\n        }\n    },\n    parse: function(html)\n    {\n        var tags = ['figure', 'html', 'form', 'pre', 'object', 'video', 'iframe', 'code', 'a', 'img'];\n        var stored = [];\n        var z = 0;\n\n        // store\n        var storedComments = [];\n        html = this.cleaner.storeComments(html, storedComments);\n\n        // encode\n        html = this.cleaner.encodeCode(html);\n\n        // converting entity\n        html = html.replace(/\\$/g, '&#36;');\n        html = html.replace(/&amp;/g, '&');\n\n        // store tags\n        for (var i = 0; i < tags.length; i++)\n        {\n            var reTags = (tags[i] === 'img') ? '<' + tags[i] + '[^>]*>' : '<' + tags[i] + '([\\\\w\\\\W]*?)</' + tags[i] + '>';\n            var matched = html.match(new RegExp(reTags, 'gi'));\n\n            if (matched !== null)\n            {\n                for (var y = 0; y < matched.length; y++)\n                {\n                    html = html.replace(matched[y], '#####replaceparse' + z + '#####');\n                    stored.push(matched[y]);\n                    z++;\n                }\n            }\n        }\n\n        // images\n        if (this.opts.autoparseImages && html.match(this.opts.regex.imageurl))\n        {\n            var imagesMatches = html.match(this.opts.regex.imageurl);\n            for (var i = 0; i < imagesMatches.length; i++)\n            {\n                html = html.replace(imagesMatches[i], '<img class=\"redactor-autoparser-object\" src=\"' + imagesMatches[i] + '\">');\n            }\n        }\n\n        // video\n        if (this.opts.autoparseVideo && (html.match(this.opts.regex.youtube) || html.match(this.opts.regex.vimeo)))\n        {\n            var iframeStart = '<iframe width=\"500\" height=\"281\" src=\"';\n            var iframeEnd = '\" frameborder=\"0\" allowfullscreen></iframe>';\n\n            var str, re;\n            var https = (this.opts.autoparseHttps) ? 'https:' : '';\n            if (html.match(this.opts.regex.youtube))\n            {\n                str = https + '//www.youtube.com/embed/$1';\n                re = this.opts.regex.youtube;\n            }\n            else if (html.match(this.opts.regex.vimeo))\n            {\n                str = https + '//player.vimeo.com/video/$2';\n                re = this.opts.regex.vimeo;\n            }\n\n            var $video = this.component.create('video', iframeStart + str + iframeEnd);\n\n            html = html.replace(re, $video.get().outerHTML);\n        }\n\n        // store tags\n        for (var i = 0; i < tags.length; i++)\n        {\n            var reTags = (tags[i] === 'img') ? '<' + tags[i] + '[^>]*>' : '<' + tags[i] + '([\\\\w\\\\W]*?)</' + tags[i] + '>';\n            var matched = html.match(new RegExp(reTags, 'gi'));\n\n            if (matched !== null)\n            {\n                for (var y = 0; y < matched.length; y++)\n                {\n                    html = html.replace(matched[y], '#####replaceparse' + z + '#####');\n                    stored.push(matched[y]);\n                    z++;\n                }\n            }\n        }\n\n        // links\n        if (this.opts.autoparseLinks && html.match(this.opts.regex.url))\n        {\n            html = this._formatLinks(html);\n        }\n\n        // restore\n        html = this._restoreReplaced(stored, html);\n\n        // repeat for nested tags\n        html = this._restoreReplaced(stored, html);\n\n        // restore comments\n        html = this.cleaner.restoreComments(html, storedComments);\n\n        return html;\n    },\n\n    // private\n    _isKey: function(key)\n    {\n        return (key === this.keycodes.ENTER || key === this.keycodes.SPACE);\n    },\n    _format: function(enter)\n    {\n        var parent = this.selection.getParent();\n        var $parent = $R.dom(parent);\n\n        var isNotFormatted = (parent && $parent.closest('figure, pre, code, img, a, iframe').length !== 0);\n        if (isNotFormatted || !this.selection.isCollapsed())\n        {\n            return;\n        }\n\n        // add split marker\n        var marker = this.utils.createInvisibleChar();\n        var range = this.selection.getRange();\n        range.insertNode(marker);\n\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var $current = $R.dom(current);\n\n        // remove split marker\n        marker.parentNode.removeChild(marker);\n\n        if (current && current.nodeType === 3)\n        {\n            var content = current.textContent;\n            var type;\n\n            // images\n            if (this.opts.autoparseImages && content.match(this._convertToRegExp(this.opts.regex.imageurl)))\n            {\n                var isList = data.isList();\n                var matches = content.match(this.opts.regex.imageurl);\n                var el = (isList) ? undefined : '<figure><img></figure>';\n\n                var $img = this.component.create('image', el);\n                $img.setSrc(matches[0]);\n                $img.addClass('redactor-autoparser-object');\n\n                content = content.replace(matches[0], $img.get().outerHTML);\n                type = 'image';\n            }\n            // video\n            else if (this.opts.autoparseVideo && (content.match(this._convertToRegExp(this.opts.regex.youtube)) || content.match(this._convertToRegExp(this.opts.regex.vimeo))))\n            {\n                var iframeStart = '<iframe width=\"500\" height=\"281\" src=\"';\n                var iframeEnd = '\" frameborder=\"0\" allowfullscreen></iframe>';\n                var str, re;\n\n                if (content.match(this.opts.regex.youtube))\n                {\n                    str = '//www.youtube.com/embed/$1';\n                    re = this.opts.regex.youtube;\n                }\n                else if (content.match(this.opts.regex.vimeo))\n                {\n                    str = '//player.vimeo.com/video/$2';\n                    re = this.opts.regex.vimeo;\n                }\n\n                var $video = this.component.create('video', iframeStart + str + iframeEnd);\n                $video.addClass('redactor-autoparser-object');\n\n                content = content.replace(re, $video.get().outerHTML);\n                type = 'video';\n            }\n            // links\n            else if (this.opts.autoparseLinks && content.match(this._convertToRegExp(this.opts.regex.url)))\n            {\n                content = this._formatLinks(content, enter);\n                type = 'link';\n            }\n\n            // replace\n            if (type)\n            {\n                if (enter)\n                {\n                    this.selection.save();\n                    $current.replaceWith(content);\n                    this.selection.restore();\n                }\n                else\n                {\n                    $current.replaceWith(content);\n                }\n\n                // object\n                var $editor = this.editor.getElement();\n                var $object = $editor.find('.redactor-autoparser-object').removeClass('redactor-autoparser-object');\n                $object = (type === 'link') ? $R.create('link.component', this.app, $object) : $object;\n\n                // caret\n                if (type === 'link')\n                {\n                    if (!enter) this.caret.setAfter($object);\n                    this.app.broadcast('link.inserted', $object);\n                }\n                else\n                {\n                    this.caret.setAfter($object);\n\n                    var $cloned = $object.clone();\n                    $object.remove();\n                    $object = this.insertion.insertHtml($cloned);\n                    $object = this.component.build($object);\n                }\n\n                // callback\n                this.app.broadcast('autoparse', type, $object);\n            }\n        }\n    },\n    _formatLinks: function(content) {\n        var target = (this.opts.pasteLinkTarget !== false) ? ' target=\"' + this.opts.pasteLinkTarget + '\"' : '';\n        var protocol = 'http';\n        var classstr = ' class=\"redactor-autoparser-object\"';\n        var self = this;\n\n        content = content.replace(this.opts.regex.aurl1, function(url) {\n            return '<a href=\"' + url + '\"' + target + classstr + '>' + self._subLinkText(url) + '</a>';\n        });\n\n        content = content.replace(this.opts.regex.aurl2, function(match, before, url) {\n            return before + '<a href=\"' + protocol + '://' + url + '\"' + target + classstr + '>' + self._subLinkText(url) + '</a>';\n        });\n\n        return content;\n    },\n    _subLinkText: function(text) {\n        text = (text.length > this.opts.linkSize) ? text.substring(0, this.opts.linkSize) + '...' : text;\n        text = (text.search('%') === -1) ? decodeURIComponent(text) : text;\n\n        return text;\n    },\n    _restoreReplaced: function(stored, html) {\n        for (var i = 0; i < stored.length; i++) {\n            html = html.replace('#####replaceparse' + i + '#####', stored[i]);\n        }\n\n        return html;\n    },\n    _convertToRegExp: function(str) {\n        return new RegExp(String(str).replace(/^\\//, '').replace(/\\/ig$/, '').replace(/\\/gi$/, '') + '$', 'gi');\n    }\n});\n$R.add('service', 'storage', {\n    init: function(app)\n    {\n        this.app = app;\n\n        // local\n        this.data = [];\n    },\n    // public\n    observeImages: function()\n    {\n        if (this.opts.imageObserve) {\n            var $editor = this.editor.getElement();\n            var $images = $editor.find('[data-image]');\n            $images.each(this._addImage.bind(this));\n        }\n    },\n    observeFiles: function()\n    {\n        var $editor = this.editor.getElement();\n        var $files = $editor.find('[data-file]');\n\n\t\t$files.each(this._addFile.bind(this));\n    },\n\tsetStatus: function(url, status)\n\t{\n\t\tthis.data[url].status = status;\n\t},\n    getChanges: function()\n    {\n        var $editor = this.editor.getElement();\n\n        // check status\n        for (var key in this.data)\n\t\t{\n\t\t\tvar data = this.data[key];\n\t\t\tvar $el = $editor.find('[data-' + data.type + '=\"' + data.id + '\"]');\n\n\t\t\tthis.setStatus(data.id, ($el.length === 0) ? false : true);\n\t\t}\n\n        return this.data;\n    },\n\tadd: function(type, node)\n\t{\n        var $node = $R.dom(node);\n        var id = $node.attr('data-' + type);\n\n        this.data[id] = { type: type, status: true, node: $node.get(), id: $node.attr('data-' + type) };\n\t},\n\n    // private\n    _addImage: function(node)\n    {\n        this.add('image', node);\n    },\n    _addFile: function(node)\n    {\n        this.add('file', node);\n    }\n});\n$R.add('service', 'utils', {\n    init: function(app)\n    {\n        this.app = app;\n    },\n    // empty\n    isEmpty: function(el)\n    {\n        var isEmpty = false;\n        el = $R.dom(el).get();\n        if (el)\n        {\n            isEmpty = (el.nodeType === 3) ? (el.textContent.trim().replace(/\\n/, '') === '') : (el.innerHTML === '');\n        }\n\n        return isEmpty;\n    },\n    isEmptyHtml: function(html, keepbr, keeplists)\n    {\n        html = this.removeInvisibleChars(html);\n        html = html.replace(/&nbsp;/gi, '');\n        html = html.replace(/<\\/?br\\s?\\/?>/g, ((keepbr) ? 'br' : ''));\n        html = html.replace(/\\s/g, '');\n        html = html.replace(/^<p>[^\\W\\w\\D\\d]*?<\\/p>$/i, '');\n        html = html.replace(/^<div>[^\\W\\w\\D\\d]*?<\\/div>$/i, '');\n\n        if (keeplists)\n        {\n            html = html.replace(/<ul(.*?[^>])>$/i, 'ul');\n            html = html.replace(/<ol(.*?[^>])>$/i, 'ol');\n        }\n\n        html = html.replace(/<hr(.*?[^>])>$/i, 'hr');\n        html = html.replace(/<iframe(.*?[^>])>$/i, 'iframe');\n        html = html.replace(/<source(.*?[^>])>$/i, 'source');\n\n        // remove empty tags\n        html = html.replace(/<[^\\/>][^>]*><\\/[^>]+>/gi, '');\n        html = html.replace(/<[^\\/>][^>]*><\\/[^>]+>/gi, '');\n\n        // trim\n        html = html.trim();\n\n        return html === '';\n    },\n    trimSpaces: function(html)\n    {\n        return html = this.removeInvisibleChars(html.trim());\n    },\n\n    // invisible chars\n    createInvisibleChar: function()\n    {\n        return document.createTextNode(this.opts.markerChar);\n    },\n    searchInvisibleChars: function(str)\n    {\n        return str.search(/^\\uFEFF$/g);\n    },\n    removeInvisibleChars: function(html)\n    {\n        return html.replace(/\\uFEFF/g, '');\n    },\n    trimInvisibleChars: function(direction)\n    {\n        if (!this.selection.isCollapsed()) return;\n\n        var current = this.selection.getCurrent();\n        var side = (direction === 'left') ? this.selection.getTextBeforeCaret() : this.selection.getTextAfterCaret();\n        var isSpace = (current && current.nodeType === 3 && this.searchInvisibleChars(side) === 0);\n\n        if (isSpace)\n        {\n            if (direction === 'left')\n            {\n                $R.dom(current).replaceWith(current.textContent.trim());\n            }\n            else\n            {\n                var offset = this.offset.get();\n                this.offset.set({ start: offset.start + 1, end: offset.end + 1 });\n            }\n        }\n    },\n\n    // wrapper\n    buildWrapper: function(html)\n    {\n        return $R.dom('<div>').html(html);\n    },\n    getWrapperHtml: function($wrapper)\n    {\n        var html = $wrapper.html();\n        $wrapper.remove();\n\n        return html;\n    },\n\n    // fragment\n    createTmpContainer: function(html)\n    {\n        var $div = $R.dom('<div>');\n\n        if (typeof html === 'string')\n        {\n            $div.html(html);\n        }\n        else\n        {\n            $div.append($R.dom(html).clone(true));\n        }\n\n        return $div.get();\n    },\n    createFragment: function(html)\n    {\n        var el = this.createTmpContainer(html);\n        var frag = document.createDocumentFragment(), node, firstNode, lastNode;\n        var nodes = [];\n        var i = 0;\n        while ((node = el.firstChild))\n        {\n            i++;\n            var n = frag.appendChild(node);\n            if (i === 1) firstNode = n;\n\n            nodes.push(n);\n            lastNode = n;\n        }\n\n        return { frag: frag, first: firstNode, last: lastNode, nodes: nodes };\n    },\n    isFragment: function(obj)\n    {\n        return (typeof obj === 'object' && obj.frag);\n    },\n    parseHtml: function(html)\n    {\n        var div = this.createTmpContainer(html);\n\n        return { html: div.innerHTML, nodes: div.childNodes };\n    },\n\n    splitNode: function(current, nodes, isList, inline)\n    {\n        nodes = (this.isFragment(nodes)) ? nodes.frag : nodes;\n\n        var element;\n        if (inline)\n        {\n            element = (this.inspector.isInlineTag(current.tagName)) ? current : this.selection.getInline(current);\n        }\n        else\n        {\n            element = (this.inspector.isBlockTag(current.tagName)) ? current : this.selection.getBlock(current);\n        }\n\n        var $element = $R.dom(element);\n\n        // replace is empty\n        if (!inline && this.isEmptyHtml(element.innerHTML, true))\n        {\n            $element.after(nodes);\n            $element.remove();\n\n            return nodes;\n        }\n\n        var tag = $element.get().tagName.toLowerCase();\n        var isEnd = this.caret.isEnd(element);\n        var isStart = this.caret.isStart(element);\n\n        if (!isEnd && !isStart)\n        {\n            var extractedContent = this.extractHtmlFromCaret(inline);\n\n            var $secondPart = $R.dom('<' + tag + ' />');\n            $secondPart = this.cloneAttributes(element, $secondPart);\n\n            $element.after($secondPart.append(extractedContent));\n        }\n\n        if (isStart)\n        {\n            return $element.before(nodes);\n        }\n        else\n        {\n            if (isList)\n            {\n                return $element.append(nodes);\n            }\n            else\n            {\n                nodes = $element.after(nodes);\n\n                var html = $element.html();\n                html = this.removeInvisibleChars(html);\n                html = html.replace(/&nbsp;/gi, '');\n\n                if (html === '') $element.remove();\n\n                return nodes;\n            }\n        }\n    },\n    extractHtmlFromCaret: function(inline, element)\n    {\n        var range = this.selection.getRange();\n        if (range)\n        {\n            element = (element) ? element : ((inline) ? this.selection.getInline() : this.selection.getBlock());\n            if (element)\n            {\n                var clonedRange = range.cloneRange();\n                clonedRange.selectNodeContents(element);\n                clonedRange.setStart(range.endContainer, range.endOffset);\n\n                return clonedRange.extractContents();\n            }\n        }\n    },\n    createMarkup: function(el)\n    {\n        var markup = document.createElement(this.opts.markup);\n        if (this.opts.breakline) markup.setAttribute('data-redactor-tag', 'br');\n\n        var $el = $R.dom(el);\n\n        $el.after(markup);\n        this.caret.setStart(markup);\n    },\n    createMarkupBefore: function(el)\n    {\n        var markup = document.createElement(this.opts.markup);\n        if (this.opts.breakline) markup.setAttribute('data-redactor-tag', 'br');\n\n        var $el = $R.dom(el);\n\n        $el.before(markup);\n        this.caret.setEnd(markup);\n    },\n    getNode: function(el)\n    {\n        var node = $R.dom(el).get();\n        var editor = this.editor.getElement().get();\n\n        return (typeof el === 'undefined') ? editor : ((node) ? node : false);\n    },\n    findSiblings: function(node, type)\n    {\n        node = $R.dom(node).get();\n        type = (type === 'next') ? 'nextSibling' : 'previousSibling';\n\n        while (node = node[type])\n        {\n            if ((node.nodeType === 3 && node.textContent.trim() === '') || node.tagName === 'BR')\n            {\n                continue;\n            }\n\n            return node;\n        }\n\n        return false;\n    },\n    getElementsFromHtml: function(html, selector, exclude)\n    {\n        var div = document.createElement(\"div\");\n        div.innerHTML = html;\n\n        var elems = div.querySelectorAll(selector);\n\n        // array map polyfill\n        var mapping = function(callback, thisArg)\n        {\n            if (typeof this.length !== 'number') return;\n            if (typeof callback !== 'function') return;\n\n            var newArr = [];\n            if (typeof this == 'object')\n            {\n                for (var i = 0; i < this.length; i++)\n                {\n                    if (i in this) newArr[i] = callback.call(thisArg || this, this[i], i, this);\n                    else return;\n                }\n            }\n\n            return newArr;\n        };\n\n        return mapping.call(elems, function(el)\n        {\n            var type = el.getAttribute('data-redactor-type');\n            if (exclude && type && type === exclude) {}\n            else return el.outerHTML;\n        });\n    },\n\n    // childnodes\n    getChildNodes: function(el, recursive, elements)\n    {\n        el = (el && el.nodeType && el.nodeType === 11) ? el : $R.dom(el).get();\n\n        var nodes = el.childNodes;\n        var result = [];\n        if (nodes)\n        {\n            for (var i = 0; i < nodes.length; i++)\n            {\n                if (elements === true && nodes[i].nodeType === 3) continue;\n                else if (nodes[i].nodeType === 3 && this.isEmpty(nodes[i])) continue;\n\n                result.push(nodes[i]);\n\n                if (recursive !== false)\n                {\n                    var nestedNodes = this.getChildNodes(nodes[i], elements);\n                    if (nestedNodes.length > 0)\n                    {\n                        result = result.concat(nestedNodes);\n                    }\n                }\n            }\n        }\n\n        return result;\n    },\n    getChildElements: function(el)\n    {\n        return this.getChildNodes(el, true, true);\n    },\n    getFirstNode: function(el)\n    {\n        return this._getFirst(this.getChildNodes(el, false));\n    },\n    getLastNode: function(el)\n    {\n        return this._getLast(this.getChildNodes(el, false));\n    },\n    getFirstElement: function(el)\n    {\n        return this._getFirst(this.getChildNodes(el, false, true));\n    },\n    getLastElement: function(el)\n    {\n        return this._getLast(this.getChildNodes(el, false, true));\n    },\n\n    // replace\n    replaceToTag: function(node, tag)\n    {\n        var $node = $R.dom(node);\n        return $node.replaceWith(function(node)\n        {\n            var $replaced = $R.dom('<' + tag + '>').append($R.dom(node).contents());\n            if (node.attributes)\n            {\n                var attrs = node.attributes;\n                for (var i = 0; i < attrs.length; i++)\n                {\n                    $replaced.attr(attrs[i].nodeName, attrs[i].value);\n                }\n            }\n\n            return $replaced;\n\n        });\n    },\n\n    // string\n    ucfirst: function(str)\n    {\n        return str.charAt(0).toUpperCase() + str.slice(1);\n    },\n\n    // array\n    removeFromArrayByValue: function(arr, value)\n    {\n        var a = arguments, len = a.length, ax;\n        while (len > 1 && arr.length)\n        {\n            value = a[--len];\n            while ((ax= arr.indexOf(value)) !== -1)\n            {\n                arr.splice(ax, 1);\n            }\n        }\n\n        return arr;\n    },\n\n    // attributes\n    removeEmptyAttr: function(el, attr)\n    {\n        var $el = $R.dom(el);\n\n        if (typeof $el.attr(attr) === 'undefined' || $el.attr(attr) === null) return true;\n        else if ($el.attr(attr) === '')\n        {\n            $el.removeAttr(attr);\n            return true;\n        }\n\n        return false;\n    },\n    cloneAttributes: function(elFrom, elTo)\n    {\n        elFrom = $R.dom(elFrom).get();\n        elTo = $R.dom(elTo);\n\n        var attrs = elFrom.attributes;\n        var len = attrs.length;\n        while (len--)\n        {\n            var attr = attrs[len];\n            elTo.attr(attr.name, attr.value);\n        }\n\n        return elTo;\n    },\n\n    // object\n    toParams: function(obj)\n    {\n        if (typeof obj !== 'object') return obj;\n\n        var keys = Object.keys(obj);\n        if (!keys.length) return '';\n        var result = '';\n\n        for (var i = 0; i < keys.length; i++)\n        {\n            var key = keys[i];\n            result += key + ':' + obj[key] + ';';\n        }\n\n        return result;\n    },\n    styleToObj: function(str)\n    {\n        var obj = {};\n\n        if (str)\n        {\n            var style = str.replace(/;$/, '').split(';');\n            for (var i = 0; i < style.length; i++)\n            {\n                var rule = style[i].split(':');\n                obj[rule[0].trim()] = rule[1].trim();\n            }\n        }\n\n        return obj;\n    },\n    checkProperty: function(obj)\n    {\n        var args = (arguments[1] && Array.isArray(arguments[1])) ? arguments[1] : [].slice.call(arguments, 1);\n\n        for (var i = 0; i < args.length; i++)\n        {\n            if (!obj || (typeof obj[args[i]] === 'undefined'))\n            {\n                return false;\n            }\n\n            obj = obj[args[i]];\n        }\n\n        return obj;\n    },\n\n    // data\n    extendData: function(data, obj)\n    {\n        for (var key in obj)\n        {\n            if (key === 'elements')\n            {\n                var $elms = $R.dom(obj[key]);\n                $elms.each(function(node)\n                {\n                    var $node = $R.dom(node);\n                    if (node.tagName === 'FORM')\n                    {\n                        var serializedData = $node.serialize(true);\n                        for (var z in serializedData)\n                        {\n                            data = this._setData(data, z, serializedData[z]);\n                        }\n                    }\n                    else\n                    {\n                        var name = ($node.attr('name')) ? $node.attr('name') : $node.attr('id');\n                        data = this._setData(data, name, $node.val());\n                    }\n                }.bind(this));\n            }\n            else\n            {\n                data = this._setData(data, key, obj[key]);\n            }\n        }\n\n        return data;\n    },\n    _setData: function(data, name, value)\n    {\n        if (data instanceof FormData) data.append(name, value);\n        else data[name] = value;\n\n        return data;\n    },\n\n    // normalize\n    normalizeTextNodes: function(el)\n    {\n        el = $R.dom(el).get();\n        if (el) el.normalize();\n    },\n\n    // color\n    isRgb: function(str)\n    {\n        return (str.search(/^rgb/i) === 0);\n    },\n    rgb2hex: function(rgb)\n    {\n        rgb = rgb.match(/^rgba?[\\s+]?\\([\\s+]?(\\d+)[\\s+]?,[\\s+]?(\\d+)[\\s+]?,[\\s+]?(\\d+)[\\s+]?/i);\n\n        return (rgb && rgb.length === 4) ? \"#\" +\n        (\"0\" + parseInt(rgb[1],10).toString(16)).slice(-2) +\n        (\"0\" + parseInt(rgb[2],10).toString(16)).slice(-2) +\n        (\"0\" + parseInt(rgb[3],10).toString(16)).slice(-2) : '';\n    },\n    hex2long: function(val)\n    {\n        if (val.search(/^#/) !== -1 && val.length === 4)\n        {\n            val = '#' + val[1] + val[1] + val[2] + val[2] + val[3] + val[3];\n        }\n\n        return val;\n    },\n\n    // escape\n    escapeRegExp: function(s)\n    {\n        return s.replace(/[-\\/\\\\^$*~+?.()|[\\]{}]/g, '\\\\$&');\n    },\n\n    // random\n    getRandomId: function()\n    {\n        var id = '';\n        var possible = 'abcdefghijklmnopqrstuvwxyz0123456789';\n\n        for (var i = 0; i < 12; i++)\n        {\n            id += possible.charAt(Math.floor(Math.random() * possible.length));\n        }\n\n        return id;\n    },\n\n    // private\n    _getFirst: function(nodes)\n    {\n        return (nodes.length !== 0) ? nodes[0] : false;\n    },\n    _getLast: function(nodes)\n    {\n        return (nodes.length !== 0) ? nodes[nodes.length-1] : false;\n    }\n});\n$R.add('service', 'progress', {\n    init: function(app)\n    {\n        this.app = app;\n\n        // local\n        this.$box = null;\n        this.$bar = null;\n    },\n\n    // public\n    show: function()\n    {\n        if (!this._is()) this._build();\n        this.$box.show();\n    },\n    hide: function()\n    {\n        if (this._is())\n        {\n            this.animate.start(this.$box, 'fadeOut', this._destroy.bind(this));\n        }\n    },\n    update: function(value)\n    {\n        this.show();\n        this.$bar.css('width', value + '%');\n    },\n\n    // private\n    _is: function()\n    {\n        return (this.$box !== null);\n    },\n    _build: function()\n    {\n        this.$bar = $R.dom('<span />');\n        this.$box = $R.dom('<div id=\"redactor-progress\" />');\n\n        this.$box.append(this.$bar);\n        this.$body.append(this.$box);\n    },\n    _destroy: function()\n    {\n        if (this._is()) this.$box.remove();\n\n        this.$box = null;\n        this.$bar = null;\n    }\n});\n$R.add('module', 'starter', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.plugin = app.plugin;\n        this.module = app.module;\n    },\n    // messages\n    onstart: function()\n    {\n        var services = ['element', 'container', 'source', 'editor', 'statusbar', 'toolbar'];\n        var modules = ['element', 'container', 'source', 'editor', 'statusbar', 'contextbar', 'input'];\n\n        this._startStop('start', this.app, services);\n        this._startStop('start', this.module, modules);\n    },\n    onstop: function()\n    {\n        var modules = ['observer', 'element', 'container', 'source', 'editor', 'contextbar'];\n\n        this._startStop('stop', this.module, modules);\n    },\n    onenable: function()\n    {\n        var modules = ['observer', 'toolbar'];\n        var plugins = this.opts.plugins;\n\n        this._startStop('start', this.module, modules);\n        this._startStop('start', this.plugin, plugins);\n    },\n    ondisable: function()\n    {\n        var modules = ['observer', 'toolbar'];\n        var plugins = this.opts.plugins;\n\n        this._startStop('stop', this.module, modules);\n        this._startStop('stop', this.plugin, plugins);\n    },\n\n    // private\n    _startStop: function(type, obj, arr)\n    {\n        for (var i = 0; i < arr.length; i++)\n        {\n            if (typeof obj[arr[i]] !== 'undefined')\n            {\n                this.app.callInstanceMethod(obj[arr[i]], type);\n            }\n        }\n    }\n});\n$R.add('module', 'element', {\n    init: function(app)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.opts = app.opts;\n        this.namespace = app.namespace;\n        this.element = app.element;\n        this.rootOpts = $R.extend({}, true, $R.options, app.rootOpts);\n    },\n    // public\n    start: function()\n    {\n        this._build();\n        this._buildModes();\n        this._buildMarkup();\n    },\n    stop: function()\n    {\n        var $element = this.element.getElement();\n        $element.removeData(this.namespace + '-uuid');\n    },\n\n    // private\n    _build: function()\n    {\n        var $element = this.element.getElement();\n        $element.data(this.namespace + '-uuid', this.uuid);\n    },\n    _buildModes: function()\n    {\n        var type = this.element.getType();\n\n        if (type === 'inline') this._redefineOptions(this.opts.modes['inline']);\n        if (type === 'div') this._redefineOptions(this.opts.modes['original']);\n\n        if (type !== 'inline')\n        {\n            if (this._isRootOption('styles') && this.rootOpts.styles) this.opts.styles = true;\n            if (this._isRootOption('source') && !this.rootOpts.source) this.opts.showSource = false;\n        }\n    },\n    _buildMarkup: function()\n    {\n        var type = this.element.getType();\n\n        if (type === 'inline')\n        {\n            this.opts.emptyHtml = '';\n        }\n        else if (this.opts.breakline)\n        {\n            this.opts.markup = 'div';\n            this.opts.emptyHtml = '<div data-redactor-tag=\"br\">' + this.opts.markerChar + '</div>';\n        }\n        else\n        {\n            this.opts.emptyHtml = '<' + this.opts.markup + '></' + this.opts.markup + '>';\n        }\n    },\n    _redefineOptions: function(opts)\n    {\n        for (var key in opts)\n        {\n            this.opts[key] = opts[key];\n        }\n    },\n    _isRootOption: function()\n    {\n        return (typeof this.rootOpts['styles'] !== 'undefined');\n    }\n});\n$R.add('module', 'editor', {\n    init: function(app)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.opts = app.opts;\n        this.editor = app.editor;\n        this.source = app.source;\n        this.element = app.element;\n        this.component = app.component;\n        this.container = app.container;\n        this.inspector = app.inspector;\n        this.autoparser = app.autoparser;\n\n        // local\n        this.placeholder = false;\n        this.events = false;\n    },\n    // messages\n    onenable: function()\n    {\n        this.enable();\n    },\n    ondisable: function()\n    {\n        this.disable();\n    },\n    onenablefocus: function()\n    {\n        this._enableFocus();\n    },\n    oncontextmenu: function(e)\n    {\n        this.component.setOnEvent(e, true);\n    },\n    onclick: function(e)\n    {\n        this.component.setOnEvent(e);\n    },\n    onkeyup: function(e)\n    {\n        var data = this.inspector.parse(e.target);\n        if (!data.isComponent())\n        {\n            this.component.clearActive();\n        }\n    },\n    onenablereadonly: function()\n    {\n        this._enableReadOnly();\n    },\n    ondisablereadonly: function()\n    {\n        this._disableReadOnly();\n    },\n    onautoparseobserve: function()\n    {\n        this.autoparser.observe();\n    },\n    onplaceholder: {\n        build: function()\n        {\n            this._buildPlaceholder();\n        },\n        toggle: function()\n        {\n            this._togglePlacehodler();\n        }\n    },\n\n    // public\n    start: function()\n    {\n        this._build();\n        this._buildEvents();\n        this._buildOptions();\n        this._buildAccesibility();\n    },\n    stop: function()\n    {\n        var $editor = this.editor.getElement();\n        var $container = this.container.getElement();\n\n        var classesEditor = ['redactor-in', 'redactor-in-' + this.uuid, 'redactor-structure', 'redactor-placeholder', 'notranslate'];\n        if (this.opts.stylesClass !== '') {\n            classesEditor.push(this.opts.stylesClass);\n        }\n\n        var classesContainer = ['redactor-focus', 'redactor-blur', 'redactor-over', 'redactor-styles-on',\n                                'redactor-styles-off', 'redactor-toolbar-on', 'redactor-text-labeled-on', 'redactor-source-view'];\n\n        $editor.removeAttr('spellcheck');\n        $editor.removeAttr('dir');\n        $editor.removeAttr('contenteditable');\n        $editor.removeAttr('placeholder');\n        $editor.removeAttr('data-gramm_editor');\n        $editor.removeClass(classesEditor.join(' '));\n\n        $container.removeClass(classesContainer.join(' '));\n\n        this._destroyEvents();\n\n        if ($editor.get().classList.length === 0) $editor.removeAttr('class');\n    },\n    enable: function()\n    {\n        var $editor = this.editor.getElement();\n        var $container = this.container.getElement();\n\n        $editor.addClass('redactor-in redactor-in-' + this.uuid);\n        $editor.attr({ 'contenteditable': true });\n\n        if (this.opts.structure)\n        {\n            $editor.addClass('redactor-structure');\n        }\n\n        if (this.opts.toolbar && !this.opts.air && !this.opts.toolbarExternal)\n        {\n            $container.addClass('redactor-toolbar-on');\n        }\n\n        // prevent editing\n        this._disableBrowsersEditing();\n    },\n    disable: function()\n    {\n        var $editor = this.editor.getElement();\n        var $container = this.container.getElement();\n\n        $editor.removeClass('redactor-in redactor-in-' + this.uuid);\n        $editor.removeClass('redactor-structure');\n        $editor.removeAttr('contenteditable');\n\n        $container.addClass('redactor-toolbar-on');\n    },\n\n    // private\n    _build: function()\n    {\n        var $editor = this.editor.getElement();\n        var $element = this.element.getElement();\n        var $container = this.container.getElement();\n\n        $container.addClass('redactor-blur');\n\n        if (!this.opts.grammarly)\n        {\n            $editor.attr('data-gramm_editor', false);\n        }\n\n        if (this.opts.notranslate)\n        {\n            $editor.addClass('notranslate');\n        }\n\n        if (this.opts.styles)\n        {\n            $editor.addClass(this.opts.stylesClass);\n            $container.addClass('redactor-styles-on');\n        }\n        else\n        {\n            $container.addClass('redactor-styles-off');\n        }\n\n        if (this.opts.buttonsTextLabeled)\n        {\n            $container.addClass('redactor-text-labeled-on');\n        }\n\n        if (this.element.isType('textarea')) $element.before($editor);\n    },\n    _buildEvents: function()\n    {\n        this.events = $R.create('editor.events', this.app);\n    },\n    _buildOptions: function()\n    {\n        var $editor = this.editor.getElement();\n\n        $editor.attr('dir', this.opts.direction);\n\n        if (!this.opts.spellcheck) $editor.attr('spellcheck', false);\n        if (this.opts.tabindex) $editor.attr('tabindex', this.opts.tabindex);\n        if (this.opts.minHeight) $editor.css('min-height', this.opts.minHeight);\n        if (this.opts.maxHeight) $editor.css('max-height', this.opts.maxHeight);\n        if (this.opts.maxWidth) $editor.css({ 'max-width': this.opts.maxWidth, 'margin': 'auto' });\n    },\n    _buildAccesibility: function()\n    {\n        var $editor = this.editor.getElement();\n\n        $editor.attr({ 'aria-labelledby': 'redactor-voice-' + this.uuid, 'role': 'presentation' });\n    },\n    _buildPlaceholder: function()\n    {\n        this.placeholder = $R.create('editor.placeholder', this.app);\n    },\n    _enableFocus: function()\n    {\n        if (this.opts.showSource) this._enableFocusSource();\n        else this._enableFocusEditor();\n    },\n    _enableFocusSource: function()\n    {\n        var $source = this.source.getElement();\n\n        if (this.opts.focus)\n        {\n            $source.focus();\n            $source.get().setSelectionRange(0, 0);\n        }\n        else if (this.opts.focusEnd)\n        {\n            $source.focus();\n        }\n    },\n    _enableFocusEditor: function()\n    {\n        if (this.opts.focus)\n        {\n            setTimeout(this.editor.startFocus.bind(this.editor), 100);\n        }\n        else if (this.opts.focusEnd)\n        {\n            setTimeout(this.editor.endFocus.bind(this.editor), 100);\n        }\n    },\n    _togglePlacehodler: function()\n    {\n        if (this.placeholder) this.placeholder.toggle();\n    },\n    _disableBrowsersEditing: function()\n    {\n        try {\n            // FF fix\n            document.execCommand('enableObjectResizing', false, false);\n            document.execCommand('enableInlineTableEditing', false, false);\n            // IE prevent converting links\n            document.execCommand(\"AutoUrlDetect\", false, false);\n\n            // IE disable image resizing\n            var $editor = this.editor.getElement();\n            var el = $editor.get();\n            if (el.addEventListener) el.addEventListener('mscontrolselect', function(e) { e.preventDefault(); });\n            else el.attachEvent('oncontrolselect', function(e) { e.returnValue = false; });\n\n        } catch (e) {}\n    },\n    _destroyEvents: function()\n    {\n        if (this.events)\n        {\n            this.events.destroy();\n        }\n    },\n    _enableReadOnly: function()\n    {\n        var $editor = this.editor.getElement();\n\n        this._getEditables($editor).removeAttr('contenteditable');\n        $editor.removeAttr('contenteditable');\n        $editor.addClass('redactor-read-only');\n\n        if (this.events) this.events.destroy();\n    },\n    _disableReadOnly: function()\n    {\n        var $editor = this.editor.getElement();\n\n        this._getEditables($editor).attr({ 'contenteditable': true });\n        $editor.removeClass('redactor-read-only');\n        $editor.attr({ 'contenteditable': true });\n\n        this._buildEvents();\n    },\n    _getEditables: function($editor)\n    {\n        return $editor.find('figcaption, td, th');\n    }\n});\n$R.add('class', 'editor.placeholder', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.editor = app.editor;\n        this.element = app.element;\n\n        // build\n        this.build();\n    },\n    build: function()\n    {\n        var $element = this.element.getElement();\n        var $editor = this.editor.getElement();\n\n        if (this.opts.placeholder !== false || $element.attr('placeholder'))\n        {\n            var text = (this.opts.placeholder !== false) ? this.opts.placeholder : $element.attr('placeholder');\n            $editor.attr('placeholder', text);\n            this.toggle();\n        }\n    },\n    toggle: function()\n    {\n        return (this.editor.isEmpty(true)) ? this.show() : this.hide();\n    },\n    show: function()\n    {\n        var $editor = this.editor.getElement();\n        $editor.addClass('redactor-placeholder');\n    },\n    hide: function()\n    {\n        var $editor = this.editor.getElement();\n        $editor.removeClass('redactor-placeholder');\n    }\n});\n$R.add('class', 'editor.events', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.$doc = app.$doc;\n        this.uuid = app.uuid;\n        this.source = app.source;\n        this.editor = app.editor;\n        this.cleaner = app.cleaner;\n        this.container = app.container;\n        this.insertion = app.insertion;\n        this.inspector = app.inspector;\n        this.selection = app.selection;\n        this.component = app.component;\n\n        // local\n        this.blurNamespace = '.redactor-blur.' + this.uuid;\n        this.eventsList = ['paste', 'click', 'contextmenu', 'keydown', 'keyup', 'mouseup', 'touchstart',\n                           'cut', 'copy', 'dragenter', 'dragstart', 'drop', 'dragover', 'dragleave'];\n\n        // init\n        this._init();\n    },\n    destroy: function()\n    {\n        var $editor = this.editor.getElement();\n\n        $editor.off('.redactor-focus');\n        this.$doc.off('keyup' + this.blurNamespace + ' mousedown' + this.blurNamespace);\n\n        // all events\n        this._loop('off');\n    },\n    focus: function(e)\n    {\n        var $container = this.container.getElement();\n\n        if (this.editor.isPasting() || $container.hasClass('redactor-focus')) return;\n\n        $container.addClass('redactor-focus');\n        $container.removeClass('redactor-blur');\n\n        this.app.broadcast('observe', e);\n        this.app.broadcast('focus', e);\n\n        this.isFocused = true;\n        this.isBlured = false;\n    },\n    blur: function(e)\n    {\n        var $container = this.container.getElement();\n        var $target = $R.dom(e.target);\n        var targets = ['.redactor-in-' + this.uuid,  '.redactor-toolbar', '.redactor-dropdown',\n        '.redactor-context-toolbar', '.redactor-modal-box', '#redactor-image-resizer'];\n\n        this.app.broadcast('originalblur', e);\n        if (this.app.stopBlur) return;\n\n        if (!this.app.isStarted() || this.editor.isPasting()) return;\n        if ($target.closest(targets.join(',')).length !== 0) return;\n\n        if (!this.isBlured && !$container.hasClass('redactor-blur'))\n        {\n            $container.removeClass('redactor-focus');\n            $container.addClass('redactor-blur');\n            this.app.broadcast('blur', e);\n\n            this.isFocused = false;\n            this.isBlured = true;\n        }\n    },\n    cut: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n\n        this.app.broadcast('state', e);\n\n        if (this.component.isNonEditable(current))\n        {\n            this._passSelectionToClipboard(e, data, true);\n            e.preventDefault();\n        }\n    },\n    copy: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n\n        this.app.broadcast('state', e);\n\n        if (this.component.isNonEditable(current))\n        {\n            this._passSelectionToClipboard(e, data, false);\n            e.preventDefault();\n        }\n    },\n    drop: function(e)\n    {\n        e = e.originalEvent || e;\n        e.stopPropagation();\n        this._removeOverClass();\n\n        if (this.opts.dragUpload === false)\n        {\n            e.preventDefault();\n            return;\n        }\n\n\n        if (this.app.isDragComponentInside())\n        {\n            var $dragComponent = $R.dom(this.app.getDragComponentInside());\n            var $component = $dragComponent.clone(true);\n            this.insertion.insertToPoint(e, $component);\n\n            $dragComponent.remove();\n\n            this.app.setDragComponentInside(false);\n            this.app.broadcast('state', e);\n            this.app.broadcast('drop', e);\n            this.app.broadcast('image.observe', e);\n\n            e.preventDefault();\n\n            return;\n        }\n        else if (this.app.isDragInside() && this.opts.input)\n        {\n            this.insertion.insertPoint(e);\n\n            var dt = e.dataTransfer;\n            var html = dt.getData('text/html');\n\n            // clear selected\n            var range = this.selection.getRange();\n            if (range)\n            {\n                var blocks = this.selection.getBlocks();\n                range.deleteContents();\n\n                // remove empty blocks\n                for (var i = 0; i < blocks.length; i++)\n                {\n                    if (blocks[i].innerHTML === '') $R.dom(blocks[i]).remove();\n                }\n            }\n\n            // paste\n            $R.create('input.paste', this.app, e, true, html, true);\n\n            this.app.broadcast('state', e);\n            this.app.broadcast('drop', e);\n\n            this.app.setDragInside(false);\n            e.preventDefault();\n\n            return;\n        }\n\n        this.app.broadcast('state', e);\n        this.app.broadcast('paste', e, e.dataTransfer);\n        this.app.broadcast('drop', e);\n\n    },\n    dragenter: function(e)\n    {\n        e.preventDefault();\n    },\n    dragstart: function(e)\n    {\n        this.app.setDragComponentInside(false);\n        this.app.setDragInside(false);\n\n        var data = this.inspector.parse(e.target);\n        if (data.isComponent() && !data.isComponentEditable() && !data.isFigcaption())\n        {\n            this.app.setDragComponentInside(data.getComponent());\n        }\n        else if (this.selection.is() && !this.selection.isCollapsed())\n        {\n            // drag starts inside editor\n            this.app.setDragInside(true);\n            this._setDragData(e);\n        }\n\n        this.app.broadcast('dragstart', e);\n    },\n    dragover: function(e)\n    {\n        this.app.broadcast('dragover', e);\n    },\n    dragleave: function(e)\n    {\n        this.app.broadcast('dragleave', e);\n    },\n    paste: function(e)\n    {\n        this.app.broadcast('paste', e);\n    },\n    contextmenu: function(e)\n    {\n        // chrome crashes fix\n        //this.editor.disableNonEditables();\n\n        //setTimeout(function()\n        //{\n          //  this.editor.enableNonEditables();\n           // this.app.broadcast('contextmenu', e);\n\n        //}.bind(this), 0);\n    },\n    click: function(e)\n    {\n        // triple click selection\n        if (e.detail === 3)\n        {\n            e.preventDefault();\n\n            var block = this.selection.getBlock();\n            if (block) {\n                var range = document.createRange();\n                range.selectNodeContents(block);\n                this.selection.setRange(range)\n            }\n        }\n\n        // observe bottom click & start click & outside click\n        var $target = $R.dom(e.target);\n        if ($target.hasClass('redactor-in'))\n        {\n            var top = $target.offset().top;\n            var pad = parseFloat($target.css('padding-bottom'));\n            var height = $target.height();\n            var posHeight = top + height - pad*2;\n\n            if (posHeight < e.pageY)\n            {\n                this.app.broadcast('bottomclick', e);\n            }\n            else if ($target.hasClass('redactor-placeholder')) {\n                this.editor.startFocus(this.editor);\n            }\n        }\n\n        this.app.broadcast('state', e);\n        this.app.broadcast('click', e);\n    },\n    keydown: function(e)\n    {\n        this.app.broadcast('state', e);\n        var stop = this.app.broadcast('keydown', e);\n        if (stop === false)\n        {\n            return e.preventDefault();\n        }\n    },\n    keyup: function(e)\n    {\n        this.app.broadcast('keyup', e);\n    },\n    mouseup: function(e)\n    {\n        this.app.broadcast('observe', e);\n        this.app.broadcast('state', e);\n    },\n    touchstart: function(e)\n    {\n        this.app.broadcast('observe', e);\n        this.app.broadcast('state', e);\n    },\n\n    // private\n    _init: function()\n    {\n        var $editor = this.editor.getElement();\n\n        $editor.on('focus.redactor-focus click.redactor-focus', this.focus.bind(this));\n        this.$doc.on('keyup' + this.blurNamespace + ' mousedown' + this.blurNamespace, this.blur.bind(this));\n\n        // all events\n        this._loop('on');\n    },\n    _removeOverClass: function()\n    {\n        var $editor = this.editor.getElement();\n        $editor.removeClass('over');\n    },\n    _loop: function(func)\n    {\n        var $editor = this.editor.getElement();\n        for (var i = 0; i < this.eventsList.length; i++)\n        {\n            var event = this.eventsList[i] + '.redactor-events';\n            var method = this.eventsList[i];\n\n            $editor[func](event, this[method].bind(this));\n        }\n    },\n    _passAllToClipboard: function(e)\n    {\n        var clipboard = e.clipboardData;\n        var content = this.source.getCode();\n\n        clipboard.setData('text/html', content);\n        clipboard.setData('text/plain', content.toString().replace(/\\n$/, \"\"));\n    },\n    _passSelectionToClipboard: function(e, data, remove)\n    {\n        var clipboard = e.clipboardData;\n        var node = data.getComponent();\n        var $node = $R.dom(node);\n        var $cloned = $node.clone();\n\n        // clean\n        $cloned.find('.redactor-component-caret').remove();\n        $cloned.removeClass('redactor-component-active');\n        $cloned.removeAttr('contenteditable');\n        $cloned.removeAttr('tabindex');\n\n        // html\n        var content = $cloned.get().outerHTML;\n\n        if (remove) this.component.remove(node);\n\n        clipboard.setData('text/html', content);\n        clipboard.setData('text/plain', content.toString().replace(/\\n$/, \"\"));\n    },\n    _setDragData: function(e)\n    {\n        e = e.originalEvent || e;\n\n        var dt = e.dataTransfer;\n        dt.effectAllowed = 'move';\n        dt.setData('text/Html', this.selection.getHtml());\n    }\n});\n$R.add('module', 'container', {\n    init: function(app)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.opts = app.opts;\n        this.lang = app.lang;\n        this.element = app.element;\n        this.container = app.container;\n    },\n    // public\n    start: function()\n    {\n        this._build();\n        this._buildAccesibility();\n    },\n    stop: function()\n    {\n        var $element = this.element.getElement();\n        var $container = this.container.getElement();\n\n        $container.after($element);\n        $container.remove();\n        $element.show();\n    },\n\n    // private\n    _build: function()\n    {\n        var $element = this.element.getElement();\n        var $container = this.container.getElement();\n\n        $container.addClass('redactor-box');\n        $container.attr('dir', this.opts.direction);\n\n        if (this.element.isType('inline')) $container.addClass('redactor-inline');\n\n        $element.after($container);\n        $container.append($element);\n    },\n    _buildAccesibility: function()\n    {\n        var $container = this.container.getElement();\n        var $label = $R.dom('<span />');\n\n        $label.addClass('redactor-voice-label');\n        $label.attr({ 'id': 'redactor-voice-' + this.uuid, 'aria-hidden': false });\n        $label.html(this.lang.get('accessibility-help-label'));\n\n        $container.prepend($label);\n    }\n});\n$R.add('module', 'source', {\n    init: function(app)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.element = app.element;\n        this.source = app.source;\n        this.editor = app.editor;\n        this.toolbar = app.toolbar;\n        this.cleaner = app.cleaner;\n        this.component = app.component;\n        this.container = app.container;\n        this.autoparser = app.autoparser;\n        this.selection = app.selection;\n\n        // local\n        this.syncedHtml = '';\n    },\n    // messages\n    onstartcode: function()\n    {\n        var sourceContent = this.source.getStartedContent();\n        var $editor = this.editor.getElement();\n        var $source = this.source.getElement();\n\n        // autoparse\n        if (this.opts.autoparse && this.opts.autoparseStart)\n        {\n            sourceContent = this.autoparser.parse(sourceContent);\n        }\n\n        // started content\n        var startContent = this.cleaner.input(sourceContent, true, true);\n        var syncContent = this.cleaner.output(startContent);\n\n        // set content\n        $editor.html(startContent);\n        $source.val(syncContent);\n\n        this.syncedHtml = syncContent;\n        this.app.broadcast('placeholder.build');\n        this.app.broadcast('autoparseobserve');\n\n        // widget's scripts\n        this.component.executeScripts();\n    },\n    onstartcodeshow: function()\n    {\n        this.show();\n    },\n    ontrytosync: function()\n    {\n        this.sync();\n    },\n    onhardsync: function()\n    {\n        var $editor = this.editor.getElement();\n        var html = $editor.html();\n\n        html = this.app.broadcast('syncBefore', html);\n        html = this.cleaner.output(html);\n\n        this._syncing(html);\n    },\n\n    // public\n    start: function()\n    {\n        this._build();\n        this._buildClasses();\n    },\n    stop: function()\n    {\n        var $element = this.element.getElement();\n        var $source = this.source.getElement();\n\n        $element.removeClass('redactor-source redactor-source-open');\n        $source.off('input.redactor-source');\n        $source.removeAttr('data-gramm_editor');\n\n        if ($source.get().classList.length === 0) $source.removeAttr('class');\n        if (!this.source.isNameGenerated()) $element.removeAttr('name');\n        if (!this.element.isType('textarea')) $source.remove();\n\n    },\n    getCode: function()\n    {\n        return this.source.getCode();\n    },\n\n    // public\n    toggle: function()\n    {\n        if (!this.opts.source) return;\n\n        var $source = this.source.getElement();\n\n        return ($source.hasClass('redactor-source-open')) ? this.hide() : this.show();\n    },\n    show: function()\n    {\n        if (!this.opts.source) return;\n\n        var $editor = this.editor.getElement();\n        var $source = this.source.getElement();\n        var $container = this.container.getElement();\n\n        var html = $source.val();\n\n        if (this.app.isStarted()) html = this.app.broadcast('source.open', html);\n\n        // get height\n        var editorHeight = $editor.height();\n\n        $editor.hide();\n        $source.height(editorHeight);\n        $source.val(html.trim());\n        $source.show();\n        $source.addClass('redactor-source-open');\n        $source.on('input.redactor-source-events', this._onChangedSource.bind(this));\n        $source.on('keydown.redactor-source-events', this._onTabKey.bind(this));\n        $source.on('focus.redactor-source-events', this._onFocus.bind(this));\n\n        if (this.opts.source.hasOwnProperty('codemirror')) {\n            var opts = (typeof this.opts.source.codemirror === 'object') ? this.opts.source.codemirror : {};\n            var codemirrorSrc = (typeof this.opts.source.codemirrorSrc !== 'undefined') ? this.opts.source.codemirrorSrc : CodeMirror;\n            this.codemirror = codemirrorSrc.fromTextArea($source.get(), opts);\n            this.codemirror.setSize(null, editorHeight);\n            this.codemirror.on('change', function(cm, changeObj){ cm.save() });\n            this.codemirror.on('change', this._onChangedSource.bind(this));\n        }\n        else {\n            $container.addClass('redactor-source-view');\n        }\n\n        // buttons\n        setTimeout(function()\n        {\n            this._disableButtons();\n            this._setActiveSourceButton();\n\n        }.bind(this), 100);\n\n        if (this.app.isStarted()) this.app.broadcast('source.opened');\n    },\n    hide: function()\n    {\n        if (!this.opts.source) return;\n\n        var $editor = this.editor.getElement();\n        var $source = this.source.getElement();\n        var $container = this.container.getElement();\n\n        var html = $source.val();\n        if (this.opts.source.hasOwnProperty('codemirror')) {\n            html = this.codemirror.getValue();\n            this.codemirror.toTextArea();\n        }\n\n\n        // clean\n        html = this.cleaner.input(html, true);\n        html = (this.utils.isEmptyHtml(html)) ? this.opts.emptyHtml : html;\n        html = this.app.broadcast('source.close', html);\n\n        // buttons\n        this._enableButtons();\n        this._setInactiveSourceButton();\n\n        $source.hide();\n        $source.removeClass('redactor-source-open');\n        $source.off('.redactor-source-events');\n        $editor.show();\n        $editor.html(html);\n\n        $container.removeClass('redactor-source-view');\n\n        setTimeout(function()\n        {\n            this.editor.startFocus();\n\n            // widget's scripts\n            this.component.executeScripts();\n\n        }.bind(this), 0);\n\n        this.app.broadcast('source.closed');\n    },\n    sync: function()\n    {\n        var self = this;\n        var $editor = this.editor.getElement();\n        var html = $editor.html();\n\n        html = this.app.broadcast('syncBefore', html);\n        html = this.cleaner.output(html);\n\n        if (this._isSync(html))\n        {\n            if (this.timeout) clearTimeout(this.timeout);\n            this.timeout = setTimeout(function() { self._syncing(html); }, 200);\n        }\n    },\n\n    // private\n    _build: function()\n    {\n        var $source = this.source.getElement();\n        var $element = this.element.getElement();\n\n        $source.hide();\n\n        if (!this.opts.grammarly)\n        {\n            $source.attr('data-gramm_editor', false);\n        }\n\n        if (!this.element.isType('textarea'))\n        {\n            $element.after($source);\n        }\n    },\n    _buildClasses: function()\n    {\n        var $source = this.source.getElement();\n\n        $source.addClass('redactor-source');\n    },\n    _syncing: function(html)\n    {\n        html = this.app.broadcast('syncing', html);\n\n        var $source = this.source.getElement();\n        $source.val(html);\n\n        this.app.broadcast('synced', html);\n        this.app.broadcast('changed', html);\n    },\n    _isSync: function(html)\n    {\n        if (this.syncedHtml !== html)\n        {\n            this.syncedHtml = html;\n            return true;\n        }\n\n        return false;\n    },\n    _onChangedSource: function()\n    {\n        var $source = this.source.getElement();\n        var html = $source.val();\n\n        this.app.broadcast('changed', html);\n        this.app.broadcast('source.changed', html);\n    },\n    _onTabKey: function(e)\n    {\n        if (e.keyCode !== 9) return true;\n\n        e.preventDefault();\n\n        var $source = this.source.getElement();\n        var el = $source.get();\n        var start = el.selectionStart;\n\n        $source.val($source.val().substring(0, start) + \"    \" + $source.val().substring(el.selectionEnd));\n        el.selectionStart = el.selectionEnd = start + 4;\n    },\n    _onFocus: function()\n    {\n        this.app.broadcast('sourcefocus');\n    },\n    _disableButtons: function()\n    {\n        this.toolbar.disableButtons();\n    },\n    _enableButtons: function()\n    {\n        this.toolbar.enableButtons();\n    },\n    _setActiveSourceButton: function()\n    {\n        var $btn = this.toolbar.getButton('html');\n        $btn.enable();\n        $btn.setActive();\n    },\n    _setInactiveSourceButton: function()\n    {\n        var $btn = this.toolbar.getButton('html');\n        $btn.setInactive();\n    }\n});\n$R.add('module', 'observer', {\n    init: function(app)\n    {\n        this.app = app;\n        this.editor = app.editor;\n\n        // local\n        this.observerUnit = false;\n    },\n    // public\n    start: function()\n    {\n        if (window.MutationObserver)\n        {\n            var $editor = this.editor.getElement();\n            var el = $editor.get();\n            this.observerUnit = this._build(el);\n            this.observerUnit.observe(el, {\n                 attributes: true,\n                 subtree: true,\n                 childList: true,\n                 characterData: true,\n                 characterDataOldValue: true\n            });\n        }\n    },\n    stop: function()\n    {\n        if (this.observerUnit) this.observerUnit.disconnect();\n    },\n\n    // private\n    _build: function(el)\n    {\n        var self = this;\n        return new MutationObserver(function(mutations)\n        {\n            self._observe(mutations[mutations.length-1], el);\n        });\n    },\n    _observe: function(mutation, el)\n    {\n        if (this.app.isReadOnly() || (mutation.type === 'attributes' && mutation.target === el))\n        {\n            return;\n        }\n\n        this.app.broadcast('observe');\n        this.app.broadcast('trytosync');\n        this.app.broadcast('placeholder.toggle');\n    }\n});\n$R.add('module', 'clicktoedit', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.source = app.source;\n        this.editor = app.editor;\n        this.container = app.container;\n        this.selection = app.selection;\n    },\n    // messages\n    onstartclicktoedit: function()\n    {\n        this.start();\n    },\n    onenablereadonly: function()\n    {\n        if (!this.opts.clickToEdit) return;\n        if (!this._isEnabled()) this.stop();\n    },\n    ondisablereadonly: function()\n    {\n        if (!this.opts.clickToEdit) return;\n        if (!this._isEnabled()) this.start();\n    },\n    onstop: function()\n    {\n        this.stop();\n    },\n\n    // public\n    start: function()\n    {\n        this._build();\n    },\n    stop: function()\n    {\n        if (this.buttonSave) this.buttonSave.stop();\n        if (this.buttonCancel) this.buttonCancel.stop();\n\n        this._destroy();\n        this.app.broadcast('disable');\n    },\n    enable: function()\n    {\n        this.app.broadcast('clickStart');\n\n        var isEmpty = this.editor.isEmpty();\n        if (!isEmpty) this.selection.saveMarkers();\n\n        this._setFocus();\n        this._destroy();\n        this.app.broadcast('enable');\n        this.buttonSave.enable();\n        this.buttonCancel.enable();\n\n        if (!isEmpty) this.selection.restoreMarkers();\n        if (isEmpty) this.editor.focus();\n\n        var $container = this.container.getElement();\n        $container.addClass('redactor-clicktoedit-enabled');\n\n        this.source.rebuildStartedContent();\n\n        this.app.broadcast('startcode');\n        this.app.broadcast('image.observe');\n    },\n    save: function(e)\n    {\n        if (e) e.preventDefault();\n\n        var html = this.source.getCode();\n\n        this.app.broadcast('disable');\n        this.app.broadcast('clickSave', html);\n        this.app.broadcast('clickStop');\n        this.app.broadcast('toolbar.removeexternal');\n        this._build();\n    },\n    cancel: function(e)\n    {\n        if (e) e.preventDefault();\n\n        var html = this.saved;\n        var $editor = this.editor.getElement();\n        $editor.html(html);\n\n        this.saved = '';\n\n        this.app.broadcast('disable');\n        this.app.broadcast('clickCancel', html);\n        this.app.broadcast('clickStop');\n        this.app.broadcast('toolbar.removeexternal');\n        this._build();\n    },\n\n    // private\n    _build: function()\n    {\n        // buttons\n        this.buttonSave = $R.create('clicktoedit.button', 'save', this.app, this);\n        this.buttonCancel = $R.create('clicktoedit.button', 'cancel', this.app, this);\n\n        this.buttonSave.stop();\n        this.buttonCancel.stop();\n\n        var $editor = this.editor.getElement();\n        var $container = this.container.getElement();\n\n        $editor.on('click.redactor-click-to-edit mouseup.redactor-click-to-edit', this.enable.bind(this));\n        $container.addClass('redactor-over');\n        $container.removeClass('redactor-clicktoedit-enabled');\n    },\n    _isEnabled: function()\n    {\n        return this.container.getElement().hasClass('redactor-clicktoedit-enabled');\n    },\n    _destroy: function()\n    {\n        var $editor = this.editor.getElement();\n        var $container = this.container.getElement();\n\n        $editor.off('.redactor-click-to-edit');\n        $container.removeClass('redactor-over redactor-clicktoedit-enabled');\n    },\n    _setFocus: function()\n    {\n        this.saved = this.source.getCode();\n\n        this.buttonSave.start();\n        this.buttonCancel.start();\n    }\n});\n$R.add('class', 'clicktoedit.button', {\n    init: function(type, app, context)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.toolbar = app.toolbar;\n        this.context = context;\n\n        // local\n        this.type = type;\n        this.name = (type === 'save') ? 'clickToSave' : 'clickToCancel';\n        this.objected = false;\n        this.enabled = false;\n        this.namespace = '.redactor-click-to-edit';\n\n        // build\n        this._build();\n    },\n    enable: function()\n    {\n        if (!this.objected) return;\n\n        var data = this.opts[this.name];\n        data.api = 'module.clicktoedit.' + this.type;\n\n        this.toolbar.addButton(this.type, data);\n        this.enabled = true;\n    },\n    start: function()\n    {\n        if (this.objected) return;\n\n        this.$button.off(this.namespace);\n        this.$button.show();\n        this.$button.on('click' + this.namespace, this.context[this.type].bind(this.context));\n    },\n    stop: function()\n    {\n        if (this.objected || !this.enabled) return;\n\n        this.$button.hide();\n    },\n\n    // private\n    _build: function()\n    {\n        this.objected = (typeof this.opts[this.name] === 'object');\n\n        if (!this.objected)\n        {\n            this.$button = $R.dom(this.opts[this.name]);\n            this.enabled = true;\n        }\n    }\n});\n$R.add('module', 'statusbar', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.element = app.element;\n        this.statusbar = app.statusbar;\n        this.container = app.container;\n    },\n    // public\n    start: function()\n    {\n        if (!this.element.isType('inline'))\n        {\n            var $statusbar = this.statusbar.getElement();\n            var $container = this.container.getElement();\n\n            $statusbar.addClass('redactor-statusbar');\n            $container.append($statusbar);\n        }\n    }\n});\n$R.add('module', 'contextbar', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.uuid = app.uuid;\n        this.$win = app.$win;\n        this.$doc = app.$doc;\n        this.$body = app.$body;\n        this.editor = app.editor;\n        this.toolbar = app.toolbar;\n        this.detector = app.detector;\n\n        // local\n        this.$target = (this.toolbar.isTarget()) ? this.toolbar.getTargetElement() : this.$body;\n    },\n    // messages\n    onstop: function() {\n        this.stop();\n    },\n    onenablereadonly: function()\n    {\n        this.stop();\n    },\n    ondisablereadonly: function()\n    {\n        this.start();\n    },\n    oncontextbar: {\n        close: function()\n        {\n            this.close();\n        }\n    },\n\n    // public\n    start: function()\n    {\n        if (this.opts.toolbarContext)\n        {\n            var $editor = this.editor.getElement();\n\n            this._build();\n            $editor.on('click.redactor-context mouseup.redactor-context', this.open.bind(this));\n\n            if (this.opts.scrollTarget)\n            {\n                $R.dom(this.opts.scrollTarget).on('scroll.redactor-context', this.close.bind(this));\n            }\n            else if (this.opts.maxHeight !== false)\n            {\n                $editor.on('scroll.redactor-context', this.close.bind(this));\n            }\n        }\n    },\n    stop: function()\n    {\n        var $editor = this.editor.getElement();\n        $editor.off('.redactor-context');\n\n        this.$doc.off('.redactor-context');\n        this.$win.off('.redactor-context');\n\n        if (this.$contextbar) this.$contextbar.remove();\n        if (this.opts.scrollTarget)\n        {\n            $R.dom(this.opts.scrollTarget).off('.redactor-context');\n        }\n    },\n    is: function()\n    {\n        return (this.$contextbar && this.$contextbar.hasClass('open'));\n    },\n    set: function(e, node, buttons, position)\n    {\n        this.$contextbar.html('');\n        this.$el = $R.dom(node);\n\n        // buttons\n        for (var key in buttons)\n        {\n            var $btn = $R.create('contextbar.button', this.app, buttons[key]);\n            if ($btn.html() !== '')\n            {\n                this.$contextbar.append($btn);\n            }\n        }\n\n        // show\n        var pos = this._buildPosition(e, this.$el, position);\n\n        this.$contextbar.css(pos);\n        this.$contextbar.show();\n        this.$contextbar.addClass('open');\n        this.$doc.on('click.redactor-context mouseup.redactor-context', this.close.bind(this));\n        this.$win.on('resize.redactor-context', this.close.bind(this));\n    },\n    open: function(e)\n    {\n        setTimeout(function()\n        {\n            this.app.broadcast('contextbar', e, this);\n        }.bind(this), 0);\n    },\n    close: function(e)\n    {\n        if (!this.$contextbar) return;\n        if (e)\n        {\n            var $target = $R.dom(e.target);\n            if (this.$el && $target.closest(this.$el).length !== 0)\n            {\n                return;\n            }\n        }\n\n        this.$contextbar.hide();\n        this.$contextbar.removeClass('open');\n        this.$doc.off('.redactor.context');\n    },\n\n    // private\n    _build: function()\n    {\n        this.$contextbar = $R.dom('<div>');\n        this.$contextbar.attr('id', 'redactor-context-toolbar-' + this.uuid);\n        this.$contextbar.attr('dir', this.opts.direction);\n        this.$contextbar.addClass('redactor-context-toolbar');\n        this.$contextbar.hide();\n\n        this.$target.append(this.$contextbar);\n    },\n    _buildPosition: function(e, $el, position)\n    {\n        var top, left;\n        var isTarget = this.toolbar.isTarget();\n        var offset = (isTarget) ? $el.position() : $el.offset();\n\n        var width = $el.width();\n        var height = $el.height();\n\n        var barWidth = this.$contextbar.width();\n        var barHeight = this.$contextbar.height();\n        var docScrollTop = (isTarget) ? (this.$target.scrollTop() + this.$doc.scrollTop()) : this.$doc.scrollTop();\n\n        var targetOffset = this.$target.offset();\n        var leftFix = (isTarget) ? targetOffset.left : 0;\n        var topFix = (isTarget) ? targetOffset.top : 0;\n\n        if (!position)\n        {\n            top = (e.clientY + docScrollTop - barHeight);\n            left = (e.clientX - barWidth/2);\n        }\n        else if (position === 'top')\n        {\n            top = (offset.top - barHeight);\n            left = (offset.left + width/2 - barWidth/2);\n        }\n        else if (position === 'bottom')\n        {\n            top = (offset.top + height);\n            left = (offset.left + width/2 - barWidth/2);\n        }\n\n        if (left < 0) left = 0;\n\n        return { top: (top - topFix) + 'px', left: (left - leftFix) + 'px' };\n    }\n});\n$R.add('class', 'contextbar.button', {\n    mixins: ['dom'],\n    init: function(app, obj)\n    {\n        this.app = app;\n\n        // local\n        this.obj = obj;\n\n        // init\n        this._init();\n    },\n    // private\n    _init: function()\n    {\n        this.parse('<a>');\n\n        if (typeof this.obj.title !== 'string')\n        {\n            var url = this.obj.title.attr('href');\n            this.attr('href', url);\n\n            if (url.search(/^#/) === -1) {\n                this.attr('target', '_blank');\n            }\n\n            this.text(this.obj.html || url);\n        }\n        else\n        {\n            this.attr('href', '#');\n\n            this._buildTitle();\n            this._buildMessage();\n        }\n    },\n    _buildTitle: function()\n    {\n        this.html(this.obj.title);\n    },\n    _buildMessage: function()\n    {\n        if (typeof this.obj.message !== 'undefined' || typeof this.obj.api !== 'undefined')\n        {\n            this.on('click', this._toggle.bind(this));\n        }\n    },\n    _toggle: function(e)\n    {\n        e.preventDefault();\n\n        if (this.obj.message)\n        {\n            this.app.broadcast(this.obj.message, this.obj.args);\n        }\n        else if (this.obj.api)\n        {\n            this.app.api(this.obj.api, this.obj.args);\n        }\n    }\n});\n$R.add('module', 'toolbar', {\n    init: function(app)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.toolbar = app.toolbar;\n        this.detector = app.detector;\n\n        // local\n        this.buttons = [];\n        this.toolbarModule = false;\n    },\n    // messages\n    onsource: {\n        open: function()\n        {\n            if (!this.toolbar.isAir() && this.toolbar.isFixed())\n            {\n                this.toolbarModule.resetPosition();\n            }\n        },\n        opened: function()\n        {\n            if (this.toolbar.isAir() && this.toolbarModule)\n            {\n                this.toolbarModule.createSourceHelper();\n            }\n\n            // hide tooltips\n            setTimeout(function()\n            {\n                $R.dom('.re-button-tooltip-' + this.uuid).remove();\n            }.bind(this), 100)\n\n        },\n        close: function()\n        {\n            if (this.toolbar.isAir() && this.toolbarModule)\n            {\n                this.toolbarModule.destroySourceHelper();\n            }\n        },\n        closed: function()\n        {\n            if (this.toolbar.is() && this.opts.air)\n            {\n                this.toolbarModule.openSelected();\n            }\n        }\n    },\n    ontoolbar: {\n        removeexternal: function() {\n            if (!this.opts.air && this.opts.toolbarExternal && this.opts.clickToEdit) {\n                $R.dom(this.opts.toolbarExternal).html('');\n            }\n        }\n    },\n    onobserve: function()\n    {\n        if (this.toolbar.is())\n        {\n            this.toolbar.observe();\n        }\n    },\n    onfocus: function()\n    {\n        this._setExternalOnFocus();\n    },\n    onsourcefocus: function()\n    {\n        this._setExternalOnFocus();\n    },\n    onempty: function()\n    {\n        if (this.toolbar.isFixed())\n        {\n            this.toolbarModule.resetPosition();\n        }\n    },\n    onenablereadonly: function()\n    {\n        if (this.toolbar.isAir())\n        {\n            this.toolbarModule.close();\n        }\n    },\n\n    // public\n    start: function()\n    {\n        if (this.toolbar.is())\n        {\n            this._buildButtons();\n            this._initToolbar();\n            this._initButtons();\n        }\n    },\n    stop: function()\n    {\n        if (this.toolbarModule)\n        {\n            this.toolbarModule.stop();\n        }\n\n        // stop dropdowns & tooltips\n        $R.dom('.re-button-tooltip-' + this.uuid).remove();\n        $R.dom('.redactor-dropdown-' + this.uuid).remove();\n    },\n\n    // private\n    _buildButtons: function()\n    {\n        this.buttons = this.opts.buttons.concat();\n\n        this._buildImageButton();\n        this._buildFileButton();\n        this._buildSourceButton();\n        this._buildAdditionalButtons();\n        this._buildHiddenButtons();\n    },\n    _buildImageButton: function()\n    {\n        if (!this.opts.imageUpload && !this.opts.imageManagerJson) this.utils.removeFromArrayByValue(this.buttons, 'image');\n    },\n    _buildFileButton: function()\n    {\n        if (!this.opts.fileUpload) this.utils.removeFromArrayByValue(this.buttons, 'file');\n    },\n    _buildSourceButton: function()\n    {\n        if (!this.opts.source) this.utils.removeFromArrayByValue(this.buttons, 'html');\n    },\n    _buildAdditionalButtons: function()\n    {\n        // end\n        if (this.opts.buttonsAdd.length !== 0)\n        {\n            this.opts.buttonsAdd = this._removeExistButtons(this.opts.buttonsAdd);\n            this.buttons = this.buttons.concat(this.opts.buttonsAdd);\n        }\n\n        // beginning\n        if (this.opts.buttonsAddFirst.length !== 0)\n        {\n            this.opts.buttonsAddFirst = this._removeExistButtons(this.opts.buttonsAddFirst);\n            this.buttons.unshift(this.opts.buttonsAddFirst);\n        }\n\n        var index, btns;\n\n        // after\n        if (this.opts.buttonsAddAfter !== false)\n        {\n            index = this.buttons.indexOf(this.opts.buttonsAddAfter.after) + 1;\n            btns = this.opts.buttonsAddAfter.buttons;\n            for (var i = 0; i < btns.length; i++)\n            {\n                this.buttons.splice(index+i, 0, btns[i]);\n            }\n        }\n\n        // before\n        if (this.opts.buttonsAddBefore !== false)\n        {\n            index = this.buttons.indexOf(this.opts.buttonsAddBefore.before)+1;\n            btns = this.opts.buttonsAddBefore.buttons;\n            for (var i = 0; i < btns.length; i++)\n            {\n                this.buttons.splice(index-(1-i), 0, btns[i]);\n            }\n        }\n    },\n    _buildHiddenButtons: function()\n    {\n        if (this.opts.buttonsHide.length !== 0) {\n            var buttons = this.opts.buttonsHide;\n            for (var i = 0; i < buttons.length; i++) {\n                this.utils.removeFromArrayByValue(this.buttons, buttons[i]);\n            }\n        }\n\n        if (this.detector.isMobile() && this.opts.buttonsHideOnMobile.length !== 0) {\n            var buttons = this.opts.buttonsHideOnMobile;\n            for (var i = 0; i < buttons.length; i++) {\n                this.utils.removeFromArrayByValue(this.buttons, buttons[i]);\n            }\n        }\n    },\n    _removeExistButtons: function(buttons)\n    {\n        for (var i = 0; i < buttons.length; i++)\n        {\n            if (this.opts.buttons.indexOf(buttons[i]) !== -1)\n            {\n                this.utils.removeFromArrayByValue(buttons, buttons[i]);\n            }\n        }\n\n        return buttons;\n    },\n    _setExternalOnFocus: function()\n    {\n        if (!this.opts.air && this.opts.toolbarExternal)\n        {\n            this.toolbarModule.setExternal();\n        }\n    },\n    _initToolbar: function()\n    {\n        this.toolbarModule = (this.opts.air) ? $R.create('toolbar.air', this.app) : $R.create('toolbar.standard', this.app);\n    },\n    _initButtons: function()\n    {\n        this.toolbar.setButtons(this.buttons);\n\n        for (var i = 0; i < this.buttons.length; i++)\n        {\n            var name = this.buttons[i];\n            if ($R.buttons[name])\n            {\n                this.toolbar.addButton(name, $R.extend(true, {}, $R.buttons[name]), false, false, true);\n            }\n        }\n    }\n});\n$R.add('class', 'toolbar.air', {\n    init: function(app)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.$doc = app.$doc;\n        this.$win = app.$win;\n        this.utils = app.utils;\n        this.editor = app.editor;\n        this.animate = app.animate;\n        this.toolbar = app.toolbar;\n        this.container = app.container;\n        this.inspector = app.inspector;\n        this.selection = app.selection;\n\n        // local\n        this.clicks = 0;\n\n        // init\n        this._init();\n    },\n    // public\n    stop: function()\n    {\n        var $wrapper = this.toolbar.getWrapper();\n        $wrapper.remove();\n\n        var $editor = this.editor.getElement();\n        $editor.off('.redactor-air-trigger-' + this.uuid);\n\n        this.$doc.off('.redactor-air-' + this.uuid);\n        this.$doc.off('.redactor-air-trigger-' + this.uuid);\n\n        this.toolbar.stopObservers();\n    },\n    createSourceHelper: function()\n    {\n        this.$airHelper = $R.dom('<span>');\n        this.$airHelper.addClass('redactor-air-helper');\n        this.$airHelper.html('<i class=\"re-icon-html\"></i>');\n        this.$airHelper.on('click', function(e)\n        {\n            e.preventDefault();\n            this.app.api('module.source.hide');\n\n        }.bind(this));\n\n        var $container = this.container.getElement();\n        $container.append(this.$airHelper);\n    },\n    destroySourceHelper: function()\n    {\n        if (this.$airHelper) this.$airHelper.remove();\n    },\n    openSelected: function()\n    {\n        setTimeout(function()\n        {\n            if (this._isSelection()) this._open(false);\n\n        }.bind(this), 0);\n    },\n    close: function()\n    {\n        this.$doc.off('.redactor-air-' + this.uuid);\n\n        var $toolbar = this.toolbar.getElement();\n        $toolbar.removeClass('open');\n        $toolbar.hide();\n    },\n\n    // private\n    _init: function()\n    {\n        this.toolbar.create();\n\n        var $wrapper = this.toolbar.getWrapper();\n        var $toolbar = this.toolbar.getElement();\n        var $editor = this.editor.getElement();\n        var $container = this.container.getElement();\n\n        $wrapper.addClass('redactor-toolbar-wrapper-air');\n        $toolbar.addClass('redactor-air');\n        //$toolbar.addClass('redactor-animate-hide');\n        $toolbar.hide();\n\n        $wrapper.append($toolbar);\n        $container.prepend($wrapper);\n\n        // open selected\n        this.openSelected();\n\n        // events\n        this.$doc.on('mouseup.redactor-air-trigger-' + this.uuid, this._open.bind(this));\n        $editor.on('keyup.redactor-air-trigger-' + this.uuid, this._openCmd.bind(this));\n    },\n    _isSelection: function()\n    {\n        return (this.selection.is() && !this.selection.isCollapsed());\n    },\n    _isOpened: function()\n    {\n        var $toolbar = this.toolbar.getElement();\n\n        return $toolbar.hasClass('open');\n    },\n    _open: function(e)\n    {\n        var target = (e) ? e.target : false;\n        var $el = (e) ? $R.dom(e.target) : false;\n        var dataTarget = this.inspector.parse(target);\n        var isComponent = (dataTarget.isComponent() && !dataTarget.isComponentType('table'));\n        var isFigcaption = (dataTarget.isFigcaption());\n        var isModalTarget = ($el && $el.closest('.redactor-modal').length !== 0);\n        var isButtonCall = (e && $el.closest('.re-button').length !== 0);\n        var isDropdownCall = (e && $el.closest('.redactor-dropdown').length !== 0);\n\n        if (isDropdownCall || isButtonCall || isModalTarget || isFigcaption || isComponent || this.toolbar.isContextBar() || !this._isSelection())\n        {\n            return;\n        }\n\n        var pos = this.selection.getPosition();\n\n        setTimeout(function()\n        {\n            if (this.app.isReadOnly()) return;\n            if (this._isSelection()) this._doOpen(pos);\n\n        }.bind(this), 1);\n\n    },\n    _openCmd: function()\n    {\n        if (this.selection.isAll())\n        {\n            var $toolbar = this.toolbar.getElement();\n            var pos = this.selection.getPosition();\n\n            pos.top = (pos.top < 20) ? 0 : pos.top - $toolbar.height();\n            pos.height = 0;\n\n            this._doOpen(pos);\n        }\n    },\n    _doOpen: function(pos)\n    {\n        var $wrapper = this.toolbar.getWrapper();\n        var $toolbar = this.toolbar.getElement();\n        var $container = this.container.getElement();\n        var containerOffset = $container.offset();\n        var leftFix = 0;\n        var winWidth = this.$win.width();\n        var toolbarWidth = $toolbar.width();\n\n        if (winWidth < (pos.left + toolbarWidth))\n        {\n            var selPos = this.selection.getPosition();\n            leftFix = toolbarWidth - selPos.width;\n        }\n\n        $wrapper.css({\n            left: (pos.left - containerOffset.left - leftFix) + 'px',\n            top: (pos.top - containerOffset.top + pos.height + this.$doc.scrollTop()) + 'px'\n        });\n\n        this.app.broadcast('airOpen');\n        $toolbar.addClass('open');\n        $toolbar.show();\n\n        this.$doc.on('click.redactor-air-' + this.uuid, this._close.bind(this));\n        this.$doc.on('keydown.redactor-air-' + this.uuid, this._close.bind(this));\n        this.app.broadcast('airOpened');\n    },\n    _close: function(e)\n    {\n        var $el = (e) ? $R.dom(e.target) : false;\n        var isDropdownCall = (e && $el.closest('[data-dropdown], .redactor-dropdown-not-close').length !== 0);\n        var isButtonCall = (!isDropdownCall && e && $el.closest('.re-button').length !== 0);\n\n        if (!isButtonCall && (isDropdownCall || !this._isOpened()))\n        {\n            return;\n        }\n\n        // close\n        this.app.broadcast('airClose');\n\n        this.close();\n        this.app.broadcast('airClosed');\n    }\n});\n$R.add('class', 'toolbar.fixed', {\n    init: function(app)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.opts = app.opts;\n        this.$doc = app.$doc;\n        this.$win = app.$win;\n        this.editor = app.editor;\n        this.toolbar = app.toolbar;\n        this.detector = app.detector;\n        this.container = app.container;\n\n        // init\n        this._init();\n    },\n    // public\n    stop: function()\n    {\n        this.$fixedTarget.off('.redactor-toolbar-' + this.uuid);\n        this.$win.off('.redactor-toolbar-' + this.uuid);\n    },\n    reset: function()\n    {\n        var $toolbar = this.toolbar.getElement();\n        var $wrapper = this.toolbar.getWrapper();\n\n        $wrapper.css('height', '');\n        $toolbar.removeClass('redactor-toolbar-fixed');\n        $toolbar.css({ position: '', top: '', left: '', width: '' });\n\n        var dropdown = this.toolbar.getDropdown();\n        if (dropdown) dropdown.updatePosition();\n    },\n\n    // private\n    _init: function()\n    {\n        this.$fixedTarget = (this.toolbar.isTarget()) ? this.toolbar.getTargetElement() : this.$win;\n        this._doFixed();\n\n        if (this.toolbar.isTarget())\n        {\n            this.$win.on('scroll.redactor-toolbar-' + this.uuid, this._doFixed.bind(this));\n            this.$win.on('resize.redactor-toolbar-' + this.uuid, this._doFixed.bind(this));\n        }\n\n        this.$fixedTarget.on('scroll.redactor-toolbar-' + this.uuid, this._doFixed.bind(this));\n        this.$fixedTarget.on('resize.redactor-toolbar-' + this.uuid, this._doFixed.bind(this));\n    },\n    _doFixed: function()\n    {\n        var $editor = this.editor.getElement();\n        var $container = this.container.getElement();\n        var $toolbar = this.toolbar.getElement();\n        var $wrapper = this.toolbar.getWrapper();\n\n        if (this.editor.isSourceMode())\n        {\n            return;\n        }\n\n        var $targets = $container.parents().filter(function(node)\n        {\n            return (getComputedStyle(node, null).display === 'none') ? node : false;\n        });\n\n        // has hidden parent\n        if ($targets.length !== 0) return;\n\n        var isHeight = ($editor.height() < 100);\n        var isEmpty = this.editor.isEmpty();\n\n        if (isHeight || isEmpty) {\n            this.reset();\n            return;\n        }\n\n        if (this.editor.isSourceMode()) {\n            return;\n        }\n\n        var toolbarHeight = $toolbar.height();\n        var toleranceEnd = 60;\n        var containerOffset = (this.toolbar.isTarget()) ? $container.position() : $container.offset();\n        var boxOffset = containerOffset.top;\n        var boxEnd = boxOffset + $container.height() - toleranceEnd;\n        var scrollOffset = this.$fixedTarget.scrollTop() + this.opts.toolbarFixedTopOffset;\n        var top = (!this.toolbar.isTarget()) ? 0 : this.$fixedTarget.offset().top - this.$win.scrollTop();\n        if (this.toolbar.isTarget() && this.$fixedTarget.css('position') === 'fixed') {\n            var bs = (this.$fixedTarget.hasClass('modal') && this.$fixedTarget.hasClass('fade'));\n            var bsFix = (bs) ? $container.closest('.modal-dialog').position().top : 0;\n            top = this.$fixedTarget.scrollTop() - bsFix;\n        }\n\n\n        if (scrollOffset > boxOffset && scrollOffset < boxEnd)\n        {\n            var position = (this.detector.isDesktop()) ? 'fixed' : 'absolute';\n            top = (this.detector.isDesktop()) ? top : (scrollOffset - boxOffset);\n\n            if (this.detector.isMobile())\n            {\n                if (this.fixedScrollTimeout)\n                {\n                    clearTimeout(this.fixedScrollTimeout);\n                }\n\n                $toolbar.hide();\n                this.fixedScrollTimeout = setTimeout(function()\n                {\n                    $toolbar.show();\n                }, 250);\n            }\n\n            $wrapper.height(toolbarHeight);\n            $toolbar.addClass('redactor-toolbar-fixed');\n\n            if ($container.hasClass('redactor-box-fullscreen'))\n            {\n                $toolbar.css({\n                    position: position,\n                    top: '0px',\n                    width: $container.width() + 'px'\n                });\n            }\n            else\n            {\n                $toolbar.css({\n                    position: position,\n                    top: (top + this.opts.toolbarFixedTopOffset) + 'px',\n                    width: $container.width() + 'px'\n                });\n            }\n\n            var dropdown = this.toolbar.getDropdown();\n            if (dropdown) dropdown.updatePosition();\n\n            this.app.broadcast('toolbar.fixed');\n        }\n        else\n        {\n            this.reset();\n            this.app.broadcast('toolbar.unfixed');\n        }\n    }\n});\n$R.add('class', 'toolbar.standard', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.uuid = app.uuid;\n        this.$body = app.$body;\n        this.toolbar = app.toolbar;\n        this.container = app.container;\n\n        // local\n        this.isExternalMultiple = false;\n        this.toolbarFixed = false;\n\n        // init\n        this._init();\n    },\n    // public\n    stop: function()\n    {\n        var $wrapper = this.toolbar.getWrapper();\n        $wrapper.remove();\n\n        if (this.toolbarFixed) this.toolbarFixed.stop();\n        if (this.opts.toolbarExternal) this._findToolbars();\n\n        this.toolbar.stopObservers();\n        this.$body.find('.re-button-tooltip-' + this.uuid).remove();\n    },\n    setExternal: function()\n    {\n        this._findToolbars();\n        if (this.isExternalMultiple)\n        {\n            this.$toolbars.hide();\n            var $current = this.$external.find('.redactor-toolbar-external-' + this.uuid);\n            $current.show();\n        }\n    },\n    resetPosition: function()\n    {\n        if (this.toolbarFixed) this.toolbarFixed.reset();\n    },\n\n    // private\n    _init: function()\n    {\n        this._build();\n\n        if (this.opts.toolbarExternal)\n        {\n            this._buildExternal();\n        }\n        else\n        {\n            this._buildFixed();\n\n            var $toolbar = this.toolbar.getElement();\n            $toolbar.show();\n        }\n    },\n    _build: function()\n    {\n        this.toolbar.create();\n\n        var $wrapper = this.toolbar.getWrapper();\n        var $toolbar = this.toolbar.getElement();\n\n        $wrapper.addClass('redactor-toolbar-wrapper');\n        $toolbar.addClass('redactor-toolbar');\n        $toolbar.hide();\n        $wrapper.append($toolbar);\n\n        if (!this.opts.toolbarExternal)\n        {\n            var $container = this.container.getElement();\n            $container.prepend($wrapper);\n        }\n    },\n    _buildExternal: function()\n    {\n        this._initExternal();\n        this._findToolbars();\n\n        if (this.isExternalMultiple)\n        {\n            this._hideToolbarsExceptFirst();\n        }\n        else\n        {\n            var $toolbar = this.toolbar.getElement();\n            $toolbar.show();\n        }\n    },\n    _buildFixed: function()\n    {\n        if (this.opts.toolbarFixed)\n        {\n            this.toolbarFixed = $R.create('toolbar.fixed', this.app);\n        }\n    },\n    _initExternal: function()\n    {\n        var $toolbar = this.toolbar.getElement();\n        var $wrapper = this.toolbar.getElement();\n\n        $toolbar.addClass('redactor-toolbar-external redactor-toolbar-external-' + this.uuid);\n\n        this.$external = $R.dom(this.opts.toolbarExternal);\n        this.$external.append($wrapper);\n\n    },\n    _findToolbars: function()\n    {\n        this.$toolbars = this.$external.find('.redactor-toolbar-external');\n        this.isExternalMultiple = (this.$toolbars.length > 1);\n    },\n    _hideToolbarsExceptFirst: function()\n    {\n        this.$toolbars.hide();\n        var $first = this.$toolbars.first();\n        $first.show();\n    }\n});\n$R.add('module', 'line', {\n    init: function(app)\n    {\n        this.app = app;\n        this.lang = app.lang;\n        this.component = app.component;\n        this.inspector = app.inspector;\n        this.insertion = app.insertion;\n    },\n    // messages\n    oncontextbar: function(e, contextbar)\n    {\n        var data = this.inspector.parse(e.target);\n        if (data.isComponentType('line'))\n        {\n            var node = data.getComponent();\n            var buttons = {\n                \"remove\": {\n                    title: this.lang.get('delete'),\n                    api: 'module.line.remove',\n                    args: node\n                }\n            };\n\n            contextbar.set(e, node, buttons, 'bottom');\n        }\n\n    },\n\n    // public\n    insert: function()\n    {\n        var line = this.component.create('line');\n        this.insertion.insertRaw(line);\n    },\n    remove: function(node)\n    {\n        this.component.remove(node);\n    }\n});\n$R.add('class', 'line.component', {\n    mixins: ['dom', 'component'],\n    init: function(app, el)\n    {\n        this.app = app;\n\n        // init\n        return (el && el.cmnt !== undefined) ? el : this._init(el);\n    },\n    // private\n    _init: function(el)\n    {\n        var wrapper, element;\n        if (typeof el !== 'undefined')\n        {\n            var $node = $R.dom(el);\n            var node = $node.get();\n\n            if (node.tagName === 'HR') element = node;\n            else if (node.tagName === 'FIGURE')\n            {\n                wrapper = node;\n                element = $node.find('hr').get();\n            }\n        }\n\n        this._buildWrapper(wrapper);\n        this._buildElement(element);\n        this._initWrapper();\n    },\n    _buildElement: function(node)\n    {\n        if (node)\n        {\n            this.$element = $R.dom(node);\n        }\n        else\n        {\n            this.$element = $R.dom('<hr>');\n            this.append(this.$element);\n        }\n    },\n    _buildWrapper: function(node)\n    {\n        node = node || '<figure>';\n\n        this.parse(node);\n    },\n    _initWrapper: function()\n    {\n        this.addClass('redactor-component');\n        this.attr({\n            'data-redactor-type': 'line',\n            'tabindex': '-1',\n            'contenteditable': false\n        });\n    }\n});\n$R.add('module', 'link', {\n    modals: {\n        'link':\n            '<form action=\"\"> \\\n                <div class=\"form-item\"> \\\n                    <label for=\"modal-link-url\">URL <span class=\"req\">*</span></label> \\\n                    <input type=\"text\" id=\"modal-link-url\" name=\"url\"> \\\n                </div> \\\n                <div class=\"form-item\"> \\\n                    <label for=\"modal-link-text\">## text ##</label> \\\n                    <input type=\"text\" id=\"modal-link-text\" name=\"text\"> \\\n                </div> \\\n                <div class=\"form-item form-item-title\"> \\\n                    <label for=\"modal-link-title\">## title ##</label> \\\n                    <input type=\"text\" id=\"modal-link-title\" name=\"title\"> \\\n                </div> \\\n                <div class=\"form-item form-item-target\"> \\\n                    <label class=\"checkbox\"> \\\n                        <input type=\"checkbox\" name=\"target\"> ## link-in-new-tab ## \\\n                    </label> \\\n                </div> \\\n            </form>'\n    },\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.lang = app.lang;\n        this.caret = app.caret;\n        this.utils = app.utils;\n        this.inline = app.inline;\n        this.editor = app.editor;\n        this.inspector = app.inspector;\n        this.insertion = app.insertion;\n        this.selection = app.selection;\n\n        // local\n        this.isCurrentLink = false;\n        this.currentText = false;\n    },\n    // messages\n    onmodal: {\n        link: {\n            open: function($modal, $form)\n            {\n                this._setFormData($form, $modal);\n            },\n            opened: function($modal, $form)\n            {\n                this._setFormFocus($form);\n            },\n            update: function($modal, $form)\n            {\n                var data = $form.getData();\n                if (this._validateData($form, data))\n                {\n                    this._update(data);\n                }\n            },\n            insert: function($modal, $form)\n            {\n                var data = $form.getData();\n                if (this._validateData($form, data))\n                {\n                    this._insert(data);\n                }\n            },\n            unlink: function()\n            {\n                this._unlink();\n            }\n        }\n    },\n    onbutton: {\n        link: {\n            observe: function(button)\n            {\n                this._observeButton(button);\n            }\n        }\n    },\n    ondropdown: {\n        link: {\n            observe: function(dropdown)\n            {\n                this._observeUnlink(dropdown);\n                this._observeEdit(dropdown);\n            }\n        }\n    },\n    oncontextbar: function(e, contextbar)\n    {\n        var current = this._getCurrent();\n        var data = this.inspector.parse(current);\n        if (data.isLink() || data.isFile())\n        {\n            var node = (data.isFile()) ? data.getFile() : data.getLink();\n            var $el = $R.dom(node);\n\n            var $point = $R.dom('<a>');\n            var url = $el.attr('href');\n\n            $point.text(this._truncateText(url));\n            $point.attr('href', url);\n            $point.attr('target', '_blank');\n\n            var buttons = {\n                \"link\": {\n                    title: $point,\n                    html: this._truncateText(url)\n                },\n                \"edit\": {\n                    title: this.lang.get('edit'),\n                    api: 'module.link.open'\n                },\n                \"unlink\": {\n                    title: this.lang.get('unlink'),\n                    api: 'module.link.unlink'\n                }\n            };\n\n            contextbar.set(e, node, buttons, 'bottom');\n        }\n    },\n\n    // public\n    open: function()\n    {\n        this.$link = this._buildCurrent();\n        this.app.api('module.modal.build', this._getModalData());\n    },\n    insert: function(data)\n    {\n        this._insert(data);\n    },\n    update: function(data)\n    {\n        this._update(data);\n    },\n    unlink: function()\n    {\n        this._unlink();\n    },\n\n    // private\n    _observeButton: function(button)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n\n        if (data.isPre() || data.isCode())\n        {\n            button.disable();\n        }\n        else\n        {\n            button.enable();\n        }\n    },\n    _observeUnlink: function(dropdown)\n    {\n        var $item = dropdown.getItem('unlink');\n        var links = this._getLinks();\n\n        if (links.length === 0) $item.disable();\n        else                    $item.enable();\n    },\n    _observeEdit: function(dropdown)\n    {\n        var current = this._getCurrent();\n        var $item = dropdown.getItem('link');\n\n        var data = this.inspector.parse(current);\n        var title = (data.isLink() || data.isFile()) ? this.lang.get('link-edit') : this.lang.get('link-insert');\n\n        $item.setTitle(title);\n    },\n    _unlink: function()\n    {\n        this.app.api('module.modal.close');\n\n        var elms = [];\n        var nodes = this._getLinks();\n\n        this.selection.save();\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var $link = $R.create('link.component', this.app, nodes[i]);\n            elms.push(this.selection.getElement(nodes[i]));\n\n            $link.unwrap();\n\n            // callback\n            this.app.broadcast('link.deleted', $link);\n        }\n        this.selection.restore();\n\n        // normalize\n        for (var i = 0; i < elms.length; i++)\n        {\n            var el = (elms[i]) ? elms[i] : this.editor.getElement();\n            this.utils.normalizeTextNodes(el);\n        }\n\n        this._resetCurrent();\n    },\n    _update: function(data)\n    {\n        this.app.api('module.modal.close');\n\n        var nodes = this._getLinks();\n        this._setLinkData(nodes, data, 'updated');\n        this._resetCurrent();\n\n        // callback\n        this.app.broadcast('link.changed', nodes);\n    },\n    _insert: function(data)\n    {\n        this.app.api('module.modal.close');\n\n        var links = this._getLinks();\n\n        if (!this._insertSingle(links, data))\n        {\n            this._removeInSelection(links);\n            this._insertMultiple(data);\n        }\n\n        this._resetCurrent();\n    },\n    _removeInSelection: function(links)\n    {\n        this.selection.save();\n        for (var i = 0; i < links.length; i++)\n        {\n            var $link = $R.create('link.component', this.app, links[i]);\n            var $clonedLink = $link.clone();\n            $link.unwrap();\n\n            // callback\n            this.app.broadcast('link.deleted', $clonedLink);\n        }\n        this.selection.restore();\n    },\n    _insertMultiple: function(data)\n    {\n        var range = this.selection.getRange();\n        if (range && this._isCurrentTextChanged(data))\n        {\n            this._deleteContents(range);\n        }\n\n        var nodes = this.inline.format({ tag: 'a' });\n\n        this._setLinkData(nodes, data, 'inserted');\n    },\n    _insertSingle: function(links, data)\n    {\n        var inline = this.selection.getInline();\n        if (links.length === 1 && ((links[0].textContext === this.selection.getText()) || (inline && inline.tagName === 'A')))\n        {\n            var $link = $R.create('link.component', this.app, links[0]);\n\n            $link.setData(data);\n            this.caret.setAfter($link);\n\n            // callback\n            this.app.broadcast('link.inserted', $link);\n\n            return true;\n        }\n\n        return false;\n    },\n    _setLinkData: function(nodes, data, type)\n    {\n        data.text = (data.text.trim() === '') ? this._truncateText(data.url) : data.text;\n\n        var isTextChanged = (!this.currentText || this.currentText !== data.text);\n\n        this.selection.save();\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var $link = $R.create('link.component', this.app, nodes[i]);\n            var linkData = {};\n\n            if (data.text && isTextChanged) linkData.text = data.text;\n            if (data.url) linkData.url = data.url;\n            if (data.title !== undefined) linkData.title = data.title;\n            if (data.target !== undefined) linkData.target = data.target;\n\n            $link.setData(linkData);\n\n            // callback\n            this.app.broadcast('link.' + type, $link);\n        }\n\n        setTimeout(this.selection.restore.bind(this.selection), 0);\n    },\n    _deleteContents: function(range)\n    {\n        var html = this.selection.getHtml();\n        var parsed = this.utils.parseHtml(html);\n        var first = parsed.nodes[0];\n\n        if (first && first.nodeType !== 3)\n        {\n            var tag = first.tagName.toLowerCase();\n            var container = document.createElement(tag);\n\n            this.insertion.insertNode(container, 'start');\n        }\n        else\n        {\n            range.deleteContents();\n        }\n    },\n    _getModalData: function()\n    {\n        var commands;\n        if (this._isLink())\n        {\n           commands = {\n                update: { title: this.lang.get('save') },\n                unlink: { title: this.lang.get('unlink'), type: 'danger' },\n                cancel: { title: this.lang.get('cancel') }\n            };\n        }\n        else\n        {\n            commands = {\n                insert: { title: this.lang.get('insert') },\n                cancel: { title: this.lang.get('cancel') }\n            };\n        }\n\n        var modalData = {\n            name: 'link',\n            title: (this._isLink()) ? this.lang.get('link-edit') : this.lang.get('link-insert'),\n            handle: (this._isLink()) ? 'update' : 'insert',\n            commands: commands\n        };\n\n\n        return modalData;\n    },\n    _isLink: function()\n    {\n        return this.currentLink;\n    },\n    _isCurrentTextChanged: function(data)\n    {\n        return (this.currentText && this.currentText !== data.text);\n    },\n    _buildCurrent: function()\n    {\n        var current = this._getCurrent();\n        var data = this.inspector.parse(current);\n        var $link;\n\n        if (data.isLink() || data.isFile())\n        {\n            this.currentLink = true;\n\n            $link = (data.isFile()) ? data.getFile() : data.getLink();\n            $link = $R.create('link.component', this.app, $link);\n        }\n        else\n        {\n            this.currentLink = false;\n\n            $link = $R.create('link.component', this.app);\n            var linkData = {\n                text: this.selection.getText()\n            };\n\n            $link.setData(linkData);\n        }\n\n        return $link;\n    },\n    _getCurrent: function()\n    {\n        return this.selection.getInlinesAllSelected({ tags: ['a'] })[0];\n    },\n    _getLinks: function()\n    {\n        var links = this.selection.getInlines({ all: true, tags: ['a'] });\n        var arr = [];\n        for (var i = 0; i < links.length; i++)\n        {\n            var data = this.inspector.parse(links[i]);\n            if (data.isLink() || data.isFile())\n            {\n                arr.push(links[i]);\n            }\n        }\n\n        return arr;\n    },\n    _resetCurrent: function()\n    {\n        this.isCurrentLink = false;\n        this.currentText = false;\n    },\n    _truncateText: function(url)\n    {\n        return (url && url.length > this.opts.linkSize) ? url.substring(0, this.opts.linkSize) + '...' : url;\n    },\n    _validateData: function($form, data)\n    {\n        return (data.url.trim() === '') ? $form.setError('url') : true;\n    },\n    _setFormFocus: function($form)\n    {\n        $form.getField('url').focus();\n    },\n    _setFormData: function($form, $modal)\n    {\n        var linkData = this.$link.getData();\n        var data = {\n            url: linkData.url,\n            text: linkData.text,\n            title: linkData.title,\n            target: (this.opts.linkTarget || linkData.target)\n        };\n\n        if (!this.opts.linkNewTab) $modal.find('.form-item-target').hide();\n        if (!this.opts.linkTitle) $modal.find('.form-item-title').hide();\n\n        $form.setData(data);\n        this.currentText = $form.getField('text').val();\n    }\n});\n$R.add('class', 'link.component', {\n    mixins: ['dom', 'component'],\n    init: function(app, el)\n    {\n        this.app = app;\n        this.opts = app.opts;\n\n        // local\n        this.reUrl = /^(?:(?:(?:https?|ftp):)?\\/\\/)?(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))(?::\\d{2,5})?(?:[/?#]\\S*)?$/i;\n\n        // init\n        return (el && el.cmnt !== undefined) ? el :  this._init(el);\n    },\n\n    // public\n    setData: function(data)\n    {\n        for (var name in data)\n        {\n            this._set(name, data[name]);\n        }\n    },\n    getData: function()\n    {\n        var names = ['url', 'text', 'target', 'title'];\n        var data = {};\n\n        for (var i = 0; i < names.length; i++)\n        {\n            data[names[i]] = this._get(names[i]);\n        }\n\n        return data;\n    },\n\n    // private\n    _init: function(el)\n    {\n        var $el = $R.dom(el);\n        if (el === undefined)\n        {\n            this.parse('<a>');\n        }\n        else\n        {\n            this.parse($el);\n        }\n    },\n    _set: function(name, value)\n    {\n        this['_set_' + name](value);\n    },\n    _get: function(name)\n    {\n        return this['_get_' + name]();\n    },\n    _get_target: function()\n    {\n        return (this.attr('target')) ? this.attr('target') : false;\n    },\n    _get_url: function()\n    {\n        return this.attr('href');\n    },\n    _get_title: function()\n    {\n        return this.attr('title');\n    },\n    _get_text: function()\n    {\n        return this._getContext().text();\n    },\n    _getContext: function()\n    {\n        return this._findDeepestChild(this).element;\n    },\n    _set_target: function(target)\n    {\n        if (target === false) this.removeAttr('target');\n        else if (target)\n        {\n            this.attr('target', (target === true) ? '_blank' : target);\n        }\n    },\n    _set_text: function(text)\n    {\n        text = this._escapeHtml(text);\n        this._getContext().html(text);\n    },\n    _set_title: function(title)\n    {\n        if (!title || title === '') this.removeAttr('title');\n        else this.attr('title', title);\n    },\n    _set_url: function(url)\n    {\n        if (this.opts.linkValidation)\n        {\n            url = this._cleanUrl(url);\n\n            if (this._isMailto(url))\n            {\n                url = 'mailto:' + url.replace('mailto:', '');\n            }\n            else if (this._isUrl(url) && url.search(/^(ftp|https?)/i) === -1)\n            {\n                url = 'http://' + url.replace(/(ftp|https?):\\/\\//i, '');\n            }\n        }\n\n        this.attr('href', url);\n    },\n    _isMailto: function(url)\n    {\n        return (url.search('@') !== -1 && /(ftp|https?):\\/\\//i.test(url) === false);\n    },\n    _isUrl: function(url)\n    {\n        return this.reUrl.test(url);\n    },\n    _cleanUrl: function(url)\n    {\n        url = this._escapeHtml(url);\n\n        return url.trim().replace(/[^\\W\\w\\D\\d+&\\'@#/%?=~_|!:,.;\\(\\)]/gi, '');\n    },\n    _escapeHtml: function(html) {\n        return html.replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\").replace(/\"/g, \"&quot;\").replace(/'/g, \"&#039;\");\n    },\n    _findDeepestChild: function(parent)\n    {\n        var result = {depth: 0, element: parent };\n\n        parent.children().each(function(node)\n        {\n            var child = $R.dom(node);\n\n            if (node.outerHTML !== parent.html())\n            {\n                return;\n            }\n            else\n            {\n                var childResult = this._findDeepestChild(child);\n                if (childResult.depth + 1 > result.depth)\n                {\n                    result = {\n                        depth: 1 + childResult.depth,\n                        element: childResult.element\n                    };\n                }\n            }\n        }.bind(this));\n\n        return result;\n    }\n});\n$R.add('module', 'modal', {\n    init: function(app)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.lang = app.lang;\n        this.$doc = app.$doc;\n        this.$win = app.$win;\n        this.$body = app.$body;\n        this.utils = app.utils;\n        this.editor = app.editor;\n        this.animate = app.animate;\n        this.detector = app.detector;\n        this.selection = app.selection;\n\n        // local\n        this.$box = false;\n        this.$modal = false;\n        this.selectionMarkers = false;\n\n        // defaults\n        this.defaults = {\n            name: false,\n            url: false,\n            title: false,\n            width: '600px',\n            height: false,\n            handle: false,\n            commands: false\n        };\n    },\n    // public\n    build: function(data)\n    {\n        this._open(data);\n    },\n    close: function()\n    {\n        this._close();\n    },\n    onstop: function() {\n        this.$body.find('#redactor-modal-' + this.uuid).remove();\n        this.$body.find('#redactor-overlay-' + this.uuid).remove();\n    },\n    stop: function()\n    {\n        if (this.$box)\n        {\n            this.$box.remove();\n            this.$box = false;\n            this.$modal = false;\n        }\n\n        if (this.$overlay) {\n            this.$overlay.remove();\n        }\n\n        this.$doc.off('.redactor.modal');\n        this.$win.off('.redactor.modal');\n    },\n    resize: function()\n    {\n        this.$modal.setWidth(this.p.width);\n        this.$modal.updatePosition();\n    },\n\n    // private\n    _isOpened: function()\n    {\n        return (this.$modal && this.$modal.hasClass('open'));\n    },\n    _open: function(data)\n    {\n        this._buildDefaults(data);\n\n        if (this.p.url) this._openUrl();\n        else this._openTemplate();\n    },\n    _openUrl: function()\n    {\n        $R.ajax.post({\n            url: this.p.url,\n            success: this._doOpen.bind(this)\n        });\n    },\n    _openTemplate: function()\n    {\n        if (typeof $R.modals[this.p.name] !== 'undefined')\n        {\n            var template = this.lang.parse($R.modals[this.p.name]);\n            this._doOpen(template);\n        }\n    },\n    _doOpen: function(template)\n    {\n        this.stop();\n\n        if (this.selection.isCollapsed())\n        {\n            this.selection.save();\n            this.selectionMarkers = false;\n        }\n        else\n        {\n            this.selection.saveMarkers();\n            this.selectionMarkers = true;\n        }\n\n        if (!this.detector.isDesktop())\n        {\n            document.activeElement.blur();\n        }\n\n        this._createModal(template);\n\n        this._buildModalBox();\n        this._buildOverlay();\n        this._buildModal();\n        this._buildModalForm();\n        this._buildModalCommands();\n\n        this._broadcast('open');\n\n        this.$modal.updatePosition();\n        this._buildModalTabs();\n\n        this.animate.start(this.$box, 'fadeIn', this._opened.bind(this));\n        this.animate.start(this.$overlay, 'fadeIn');\n\n    },\n    _opened: function()\n    {\n        this.$modal.addClass('open');\n        this.$box.on('mousedown.redactor.modal', this._close.bind(this));\n        this.$doc.on('keyup.redactor.modal', this._handleEscape.bind(this));\n        this.$win.on('resize.redactor.modal', this.resize.bind(this));\n        this.$modal.getBody().find('input[type=text],input[type=url],input[type=email]').on('keydown.redactor.modal', this._handleEnter.bind(this));\n\n        // fix bootstrap modal focus\n        if (window.jQuery) window.jQuery(document).off('focusin.modal');\n\n        this._broadcast('opened');\n    },\n    _close: function(e)\n    {\n        if (!this.$box || !this._isOpened()) return;\n\n        if (e)\n        {\n            if (!this._needToClose(e.target))\n            {\n                return;\n            }\n\n            e.stopPropagation();\n            e.preventDefault();\n        }\n\n        if (this.selectionMarkers) this.selection.restoreMarkers();\n        else this.selection.restore();\n\n\n        this.selectionMarkers = false;\n\n        this._broadcast('close');\n\n        this.animate.start(this.$box, 'fadeOut', this._closed.bind(this));\n        this.animate.start(this.$overlay, 'fadeOut');\n    },\n    _closed: function()\n    {\n        this.$modal.removeClass('open');\n        this.$box.off('.redactor.modal');\n        this.$doc.off('.redactor.modal');\n        this.$win.off('.redactor.modal');\n\n        this._broadcast('closed');\n    },\n    _createModal: function(template)\n    {\n        this.$modal = $R.create('modal.element', this.app, template);\n    },\n    _broadcast: function(message)\n    {\n        this.app.broadcast('modal.' + message, this.$modal, this.$modalForm);\n        this.app.broadcast('modal.' + this.p.name + '.' + message, this.$modal, this.$modalForm);\n    },\n    _buildDefaults: function(data)\n    {\n         this.p = $R.extend({}, this.defaults, data);\n    },\n    _buildModalBox: function()\n    {\n        this.$box = $R.dom('<div>');\n        this.$box.attr('id', 'redactor-modal-' + this.uuid);\n        this.$box.addClass('redactor-modal-box redactor-animate-hide');\n        this.$box.html('');\n        this.$body.append(this.$box);\n    },\n    _buildOverlay: function()\n    {\n        this.$overlay = $R.dom('#redactor-overlay-' + this.uuid);\n        if (this.$overlay.length === 0)\n        {\n            this.$overlay = $R.dom('<div>');\n            this.$overlay.attr('id', 'redactor-overlay-' + this.uuid);\n            this.$overlay.addClass('redactor-overlay redactor-animate-hide');\n            this.$body.prepend(this.$overlay);\n        }\n    },\n    _buildModal: function()\n    {\n        this.$box.append(this.$modal);\n\n        this.$modal.setTitle(this.p.title);\n        this.$modal.setHeight(this.p.height);\n        this.$modal.setWidth(this.p.width);\n    },\n    _buildModalCommands: function()\n    {\n        if (this.p.commands)\n        {\n            var commands = this.p.commands;\n            var $footer = this.$modal.getFooter();\n            for (var key in commands)\n            {\n                var $btn = $R.dom('<button>');\n\n                $btn.html(commands[key].title);\n                $btn.attr('data-command', key);\n\n                // cancel\n                if (key === 'cancel')\n                {\n                    $btn.attr('data-action', 'close');\n                    $btn.addClass('redactor-button-unstyled');\n                }\n\n                // danger\n                if (typeof commands[key].type !== 'undefined' && commands[key].type === 'danger')\n                {\n                    $btn.addClass('redactor-button-danger');\n                }\n\n                $btn.on('click', this._handleCommand.bind(this));\n\n                $footer.append($btn);\n            }\n        }\n    },\n    _buildModalTabs: function()\n    {\n        var $body = this.$modal.getBody();\n        var $tabs = $body.find('.redactor-modal-tab');\n        var $box = $body.find('.redactor-modal-tabs');\n\n\n        if ($tabs.length > 1)\n        {\n            $box = ($box.length === 0) ? $R.dom('<div>') : $box.html('');\n            $box.addClass('redactor-modal-tabs');\n\n            $tabs.each(function(node, i)\n            {\n                var $node = $R.dom(node);\n                var $item = $R.dom('<a>');\n                $item.attr('href', '#');\n                $item.attr('rel', i);\n                $item.text($node.attr('data-title'));\n                $item.on('click', this._showTab.bind(this));\n\n                if (i === 0)\n                {\n                    $item.addClass('active');\n                }\n\n                $box.append($item);\n\n            }.bind(this));\n\n            $body.prepend($box);\n        }\n\n        if ($tabs.length === 1) {\n            $tabs.show();\n        }\n    },\n    _buildModalForm: function()\n    {\n        this.$modalForm = $R.create('modal.form', this.app, this.$modal.getForm());\n    },\n    _showTab: function(e)\n    {\n        e.preventDefault();\n\n        var $el = $R.dom(e.target);\n        var index = $el.attr('rel');\n        var $body = this.$modal.getBody();\n        var $tabs = $body.find('.redactor-modal-tab');\n\n        $tabs.hide();\n        $tabs.eq(index).show();\n\n        $body.find('.redactor-modal-tabs a').removeClass('active');\n        $el.addClass('active');\n\n    },\n    _needToClose: function(el)\n    {\n        var $target = $R.dom(el);\n        if ($target.attr('data-action') === 'close' || this.$modal.isCloseNode(el) || $target.closest('.redactor-modal').length === 0)\n        {\n            return true;\n        }\n\n        return false;\n    },\n    _handleCommand: function(e)\n    {\n        var $btn = $R.dom(e.target).closest('button');\n        var command = $btn.attr('data-command');\n\n        if (command !== 'cancel') e.preventDefault();\n\n        this._broadcast(command);\n    },\n    _handleEnter: function(e)\n    {\n        if (e.which === 13)\n        {\n            if (this.p.handle)\n            {\n                e.preventDefault();\n                this._broadcast(this.p.handle);\n            }\n        }\n    },\n    _handleEscape: function(e)\n    {\n        if (e.which === 27) this._close();\n    }\n});\n$R.add('class', 'modal.element', {\n    mixins: ['dom'],\n    init: function(app, template)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.$win = app.$win;\n\n        // init\n        this._init(template);\n    },\n\n    // get\n    getForm: function()\n    {\n        return this.find('form');\n    },\n    getHeader: function()\n    {\n        return this.$modalHeader;\n    },\n    getBody: function()\n    {\n        return this.$modalBody;\n    },\n    getFooter: function()\n    {\n        return this.$modalFooter;\n    },\n\n    // set\n    setTitle: function(title)\n    {\n        if (title) this.$modalHeader.html(title);\n    },\n    setWidth: function(width)\n    {\n        width = (parseInt(width) >= this.$win.width()) ? '96%' : width;\n\n        this.css('max-width', width);\n    },\n    setHeight: function(height)\n    {\n        if (height !== false) this.$modalBody.css('height', height);\n    },\n\n    // update\n    updatePosition: function()\n    {\n        var width = this.width();\n        this.css({ 'left': '50%', 'margin-left': '-' + (width/2) + 'px' });\n\n        var windowHeight = this.$win.height();\n        var height = this.height();\n        var marginTop = (windowHeight/2 - height/2);\n\n        if (height < windowHeight && marginTop !== 0)\n        {\n            this.css('margin-top', marginTop + 'px');\n        }\n    },\n\n    // is\n    isCloseNode: function(el)\n    {\n        return (el === this.$modalClose.get());\n    },\n\n    // private\n    _init: function(template)\n    {\n        this._build();\n        this._buildClose();\n        this._buildHeader();\n        this._buildBody();\n        this._buildFooter();\n        this._buildTemplate(template);\n    },\n    _build: function()\n    {\n        this.parse('<div>');\n        this.addClass('redactor-modal');\n        this.attr('dir', this.opts.direction);\n    },\n    _buildClose: function()\n    {\n        this.$modalClose = $R.dom('<span>');\n        this.$modalClose.addClass('redactor-close');\n\n        this.append(this.$modalClose);\n    },\n    _buildHeader: function()\n    {\n        this.$modalHeader = $R.dom('<div>');\n        this.$modalHeader.addClass('redactor-modal-header');\n\n        this.append(this.$modalHeader);\n    },\n    _buildBody: function()\n    {\n        this.$modalBody = $R.dom('<div>');\n        this.$modalBody.addClass('redactor-modal-body');\n\n        this.append(this.$modalBody);\n    },\n    _buildFooter: function()\n    {\n        this.$modalFooter = $R.dom('<div>');\n        this.$modalFooter.addClass('redactor-modal-footer');\n\n        this.append(this.$modalFooter);\n    },\n    _buildTemplate: function(template)\n    {\n        this.$modalBody.html(template);\n    }\n});\n$R.add('class', 'modal.form', {\n    mixins: ['dom'],\n    init: function(app, element)\n    {\n        this.app = app;\n\n        // build\n        this.build(element);\n    },\n\n    // public\n    build: function(element)\n    {\n        this.parse(element);\n    },\n    getData: function()\n    {\n        var data = {};\n        this.find('[name]').each(function(node)\n        {\n            var $node = $R.dom(node);\n            data[$node.attr('name')] = $node.val();\n        });\n\n        return data;\n    },\n    setData: function(data)\n    {\n        this.find('[name]').each(function(node)\n        {\n            var $node = $R.dom(node);\n            var name = $node.attr('name');\n            if (data.hasOwnProperty(name))\n            {\n                if (node.type && node.type === 'checkbox') node.checked = data[name];\n                else $node.val(data[name]);\n            }\n        });\n    },\n    getField: function(name)\n    {\n        return this.find('[name=' + name + ']');\n    },\n    setError: function(name)\n    {\n        var $el = this.getField(name);\n\n        $el.addClass('error');\n        $el.one(this._getFieldEventName($el.get()), this._clearError);\n\n        return false;\n    },\n\n    // private\n    _clearError: function()\n    {\n        return $R.dom(this).removeClass('error');\n    },\n    _getFieldEventName: function(el)\n    {\n        return (el.tagName === 'SELECT' || el.type === 'checkbox' || el.type === 'radio') ? 'change' : 'keyup';\n    }\n});\n$R.add('module', 'block', {\n    init: function(app)\n    {\n        this.app = app;\n        this.block = app.block;\n    },\n    // public\n    format: function(args)\n    {\n        var nodes = this.block.format(args);\n\n        // callback\n        this.app.broadcast('format', 'block', nodes);\n    },\n    clearformat: function()\n    {\n        this.block.clearFormat();\n    },\n    clearstyle: function()\n    {\n        this.block.clearStyle();\n    },\n    clearclass: function()\n    {\n        this.block.clearClass();\n    },\n    clearattr: function()\n    {\n        this.block.clearAttr();\n    },\n    add: function(args, tags)\n    {\n        this.block.add(args, tags);\n    },\n    toggle: function(args, tags)\n    {\n        this.block.toggle(args, tags);\n    },\n    set: function(args, tags)\n    {\n        this.block.set(args, tags);\n    },\n    remove: function(args, tags)\n    {\n        this.block.remove(args, tags);\n    }\n});\n$R.add('module', 'inline', {\n    init: function(app)\n    {\n        this.app = app;\n        this.inline = app.inline;\n    },\n    format: function(args)\n    {\n        var nodes = this.inline.format(args);\n\n        // callback\n        this.app.broadcast('format', 'inline', nodes);\n    },\n    clearformat: function()\n    {\n        this.inline.clearFormat();\n    },\n    clearstyle: function()\n    {\n        this.inline.clearStyle();\n    },\n    clearclass: function()\n    {\n        this.inline.clearClass();\n    },\n    clearattr: function()\n    {\n        this.inline.clearAttr();\n    },\n    add: function(args, tags)\n    {\n        this.inline.add(args, tags);\n    },\n    toggle: function(args, tags)\n    {\n        this.inline.toggle(args, tags);\n    },\n    set: function(args, tags)\n    {\n        this.inline.set(args, tags);\n    },\n    remove: function(args, tags)\n    {\n        this.inline.remove(args, tags);\n    }\n});\n$R.add('module', 'autosave', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.source = app.source;\n    },\n    // messages\n    onsynced: function()\n    {\n        if (this.opts.autosave)\n        {\n            this._send();\n        }\n    },\n\n    // private\n    _send: function()\n    {\n        var name = (this.opts.autosaveName) ? this.opts.autosaveName : this.source.getName();\n\n        var data = {};\n        data[name] = this.source.getCode();\n        data = this.utils.extendData(data, this.opts.autosaveData);\n        $R.ajax.request(this.opts.autosaveMethod, {\n            url: this.opts.autosave,\n            data: data,\n            success: function(response)\n            {\n                this._complete(response, name, data);\n            }.bind(this)\n        });\n    },\n    _complete: function(response, name, data)\n    {\n        var callback = (response && response.error) ? 'autosaveError' : 'autosave';\n        this.app.broadcast(callback, name, data, response);\n    }\n});\n$R.add('module', 'input', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.editor = app.editor;\n        this.keycodes = app.keycodes;\n        this.element = app.element;\n        this.selection = app.selection;\n        this.insertion = app.insertion;\n        this.inspector = app.inspector;\n        this.autoparser = app.autoparser;\n\n        // local\n        this.lastShiftKey = false;\n    },\n    // messages\n    onpaste: function(e, dataTransfer)\n    {\n        if (!this.opts.input) return;\n\n        return $R.create('input.paste', this.app, e, dataTransfer);\n    },\n    onkeydown: function(e)\n    {\n        if (!this.opts.input) return;\n\n        // key\n        var key = e.which;\n\n        // shortcuts\n        var shortcut = $R.create('input.shortcut', this.app, e);\n        if (shortcut.is()) return;\n\n        // select all\n        if ((e.ctrlKey || e.metaKey) && !e.altKey && key === 65)\n        {\n            e.preventDefault();\n            return this._selectAll();\n        }\n\n        // set empty if all selected\n        var keys = [this.keycodes.ENTER, this.keycodes.SPACE, this.keycodes.BACKSPACE, this.keycodes.DELETE];\n        var arrowKeys = [this.keycodes.UP, this.keycodes.DOWN, this.keycodes.LEFT, this.keycodes.RIGHT];\n        var isKeys = (keys.indexOf(key) !== -1);\n        var isArrowKeys = (arrowKeys.indexOf(key) !== -1);\n        var isXKey = ((e.ctrlKey || e.metaKey) && key === 88); // x\n        var isAlphaKeys = ((!e.ctrlKey && !e.metaKey) && ((key >= 48 && key <= 57) || (key >= 65 && key <= 90)));\n\n        if (this.selection.isAll() && isArrowKeys && (isXKey || (!e.ctrlKey && !e.metaKey && !e.altKey && !e.shiftKey)))\n        {\n            if (isXKey)\n            {\n                this.editor.disableNonEditables();\n                this.app.broadcast('empty');\n                return;\n            }\n\n            if (this._isArrowKey(key)) return true;\n            if (isKeys) e.preventDefault();\n\n            if (this.element.isType('inline'))\n            {\n                var $editor = this.editor.getElement();\n                $editor.html('');\n\n                this.editor.startFocus();\n            }\n            else\n            {\n                this.insertion.set(this.opts.emptyHtml);\n            }\n\n            if (isKeys) return;\n            else this.app.broadcast('empty');\n        }\n\n        // autoparse\n        if (this.opts.autoparse)\n        {\n            this.autoparser.format(e, key);\n        }\n\n        // a-z, 0-9 - non editable\n        if (isAlphaKeys)\n        {\n            // has non-editable\n            if (this.selection.hasNonEditable())\n            {\n                e.preventDefault();\n                return;\n            }\n        }\n\n        // enter, shift/ctrl + enter\n        if (key === this.keycodes.ENTER)\n        {\n            return $R.create('input.enter', this.app, e, key);\n        }\n        // cmd + [\n        else if (e.metaKey && key === 219)\n        {\n            e.preventDefault();\n            this.app.api('module.list.outdent');\n            return;\n        }\n        // tab or cmd + ]\n        else if (key === this.keycodes.TAB || (e.metaKey && key === 221))\n        {\n            return $R.create('input.tab', this.app, e, key);\n        }\n        // space\n        else if (key === this.keycodes.SPACE)\n        {\n            return $R.create('input.space', this.app, e, key, this.lastShiftKey);\n        }\n        // backspace or delete\n        else if (this._isDeleteKey(key))\n        {\n            return $R.create('input.delete', this.app, e, key);\n        }\n        else if (this._isArrowKey(key))\n        {\n            return $R.create('input.arrow', this.app, e, key);\n        }\n    },\n    onkeyup: function(e)\n    {\n        if (!this.opts.input) return;\n\n        // key\n        var key = e.which;\n\n        // shift key\n        this.lastShiftKey = e.shiftKey;\n\n        // hide context toolbar\n        this.app.broadcast('contextbar.close');\n\n        // shortcode\n        var shortcode = $R.create('input.shortcode', this.app, e, key);\n        if (shortcode.is()) return;\n\n        // is empty\n        if (key === this.keycodes.BACKSPACE)\n        {\n            var $editor = this.editor.getElement();\n            var html = this.utils.trimSpaces($editor.html());\n            html = html.replace(/<br\\s?\\/?>/g, '');\n            html = html.replace(/<div><\\/div>/, '');\n\n            if (html === '')\n            {\n                e.preventDefault();\n                this.editor.setEmpty();\n                this.editor.startFocus();\n                return;\n            }\n        }\n\n        if (this.editor.isEmpty())\n        {\n            this.app.broadcast('empty');\n        }\n    },\n\n    // public\n    start: function()\n    {\n        // extend shortcuts\n        if (this.opts.shortcutsAdd)\n        {\n            this.opts.shortcuts = $R.extend({}, true, this.opts.shortcuts, this.opts.shortcutsAdd);\n        }\n    },\n\n    // private\n    _selectAll: function()\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var el;\n\n        if (data.isComponentType('table'))\n        {\n            el = data.getTable();\n            this.selection.setAll(el);\n            return;\n        }\n        else if (data.isComponentType('code'))\n        {\n            el = data.getComponentCodeElement();\n            this.selection.setAll(el);\n            return;\n        }\n\n        this.selection.setAll();\n    },\n    _isArrowKey: function(key)\n    {\n        return ([this.keycodes.UP, this.keycodes.DOWN, this.keycodes.RIGHT, this.keycodes.LEFT].indexOf(key) !== -1);\n    },\n    _isDeleteKey: function(key)\n    {\n        return (key === this.keycodes.BACKSPACE || key === this.keycodes.DELETE);\n    }\n});\n$R.add('class', 'input.arrow', {\n    init: function(app, e, key)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.caret = app.caret;\n        this.offset = app.offset;\n        this.marker = app.marker;\n        this.editor = app.editor;\n        this.keycodes = app.keycodes;\n        this.component = app.component;\n        this.inspector = app.inspector;\n        this.selection = app.selection;\n\n        // local\n        this.key = key;\n\n        // init\n        this._init(e);\n    },\n    // private\n    _init: function(e)\n    {\n        if (this._isRightLeftKey() && this._isExitVariable(e)) return;\n\n        if (this._isRightDownKey())\n        {\n            if (this._isExitOnDownRight(e)) return;\n            if (this._selectComponent(e, 'End', 'next')) return;\n        }\n\n        if (this._isLeftUpKey())\n        {\n            if (this._isExitOnUpLeft(e)) return;\n            if (this._selectComponent(e, 'Start', 'prev')) return;\n        }\n\n        if (this.key === this.keycodes.LEFT) this.utils.trimInvisibleChars('left');\n        else if (this.key === this.keycodes.RIGHT) this.utils.trimInvisibleChars('right');\n\n    },\n    _isRightDownKey: function()\n    {\n        return ([this.keycodes.DOWN, this.keycodes.RIGHT].indexOf(this.key) !== -1);\n    },\n    _isLeftUpKey: function()\n    {\n        return ([this.keycodes.UP, this.keycodes.LEFT].indexOf(this.key) !== -1);\n    },\n    _isRightLeftKey: function()\n    {\n        return ([this.keycodes.RIGHT, this.keycodes.LEFT].indexOf(this.key) !== -1);\n    },\n    _isExitVariable: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var component = data.getComponent();\n        if (data.isComponentType('variable') && data.isComponentActive())\n        {\n            e.preventDefault();\n            var func = (this.key === this.keycodes.LEFT) ? 'setBefore' : 'setAfter';\n            this.caret[func](component);\n            return;\n        }\n    },\n    _isExitOnUpLeft: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var block = this.selection.getBlock(current);\n        var data = this.inspector.parse(current);\n        var prev = block.previousElementSibling;\n        var isStart = this.caret.isStart(block);\n\n        // prev table\n        if (isStart && prev && prev.tagName === 'TABLE')\n        {\n            e.preventDefault();\n            this.caret.setEnd(prev);\n            return true;\n        }\n        // figcaption\n        else if (data.isFigcaption())\n        {\n            block = data.getFigcaption();\n            isStart = this.caret.isStart(block);\n\n            var $component = $R.dom(block).closest('.redactor-component');\n            if (isStart && $component.length !== 0)\n            {\n                e.preventDefault();\n                this.caret.setEnd($component);\n                return true;\n            }\n        }\n        // exit table\n        else if (data.isTable() && isStart)\n        {\n            e.preventDefault();\n            this.caret.setEnd(block.previousElementSibling);\n            return true;\n        }\n        // component\n        else if (!data.isComponentEditable() && data.isComponent() && !data.isComponentType('variable'))\n        {\n            var component = data.getComponent();\n            if (!component.previousElementSibling)\n            {\n                e.preventDefault();\n                this.component.clearActive();\n\n                return this._exitPrevElement(e, data.getComponent());\n            }\n            else if (component.previousElementSibling)\n            {\n                e.preventDefault();\n                this.component.clearActive();\n                this.caret.setEnd(component.previousElementSibling);\n                return true;\n            }\n        }\n    },\n    _isExitOnDownRight: function(e)\n    {\n        var $editor = this.editor.getElement();\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var isEndEditor = this.caret.isEnd();\n        var block, isEnd;\n\n        // table\n        if (data.isTable())\n        {\n            block = data.getTable();\n            isEnd = this.caret.isEnd(block);\n\n            if (isEnd || isEndEditor)\n            {\n                return this._exitNextElement(e, data.getComponent());\n            }\n        }\n        // figcaption\n        else if (data.isFigcaption())\n        {\n            block = data.getFigcaption();\n            isEnd = this.caret.isEnd(block);\n\n            if (isEnd || isEndEditor)\n            {\n                return this._exitNextElement(e, data.getComponent());\n            }\n        }\n        // figure/code\n        else if (data.isComponentType('code'))\n        {\n            var component = data.getComponent();\n            var pre = $R.dom(data.getComponentCodeElement()).closest('pre');\n\n            isEnd = this.caret.isEnd(block);\n\n            var isNext = (pre && pre.get().nextElementSibling);\n            if (isEnd && !isNext)\n            {\n                return this._exitNextElement(e, component);\n            }\n        }\n        // pre & blockquote & dl\n        else if (data.isPre() || data.isBlockquote() || data.isDl())\n        {\n            if (isEndEditor)\n            {\n                if (data.isPre()) return this._exitNextElement(e, data.getPre());\n                else if (data.isBlockquote()) return this._exitNextElement(e, data.getBlockquote());\n                else if (data.isDl()) return this._exitNextElement(e, data.getDl());\n            }\n        }\n        // li\n        else if (data.isList())\n        {\n            var $list = $R.dom(current).parents('ul, ol', $editor).last();\n            isEnd = this.caret.isEnd($list);\n\n            if (isEnd || isEndEditor)\n            {\n                return this._exitNextElement(e, $list.get());\n            }\n        }\n        // component\n        else if (data.isComponent() && !data.isComponentType('variable') && data.getTag() !== 'span')\n        {\n            this.component.clearActive();\n            return this._exitNextElement(e, data.getComponent());\n        }\n    },\n    _exitPrevElement: function(e, node)\n    {\n        e.preventDefault();\n\n        if (node.previousElementSibling) this.caret.setEnd(node.previousElementSibling);\n        else this.utils.createMarkupBefore(node);\n\n        return true;\n    },\n    _exitNextElement: function(e, node)\n    {\n        e.preventDefault();\n\n        if (node.nextElementSibling) this.caret.setStart(node.nextElementSibling);\n        else this.utils.createMarkup(node);\n\n        return true;\n    },\n    _selectComponent: function(e, caret, type)\n    {\n        var current = this.selection.getCurrent();\n        var block = this.selection.getBlock(current);\n        var sibling = this.utils.findSiblings(current, type);\n        var siblingBlock = this.utils.findSiblings(block, type);\n\n        if (sibling && this.caret['is' + caret](current))\n        {\n            this._selectComponentItem(e, sibling, caret);\n        }\n        else if (siblingBlock && this.caret['is' + caret](block))\n        {\n            this._selectComponentItem(e, siblingBlock, caret);\n        }\n    },\n    _selectComponentItem: function(e, item, caret)\n    {\n        if (this.component.isNonEditable(item))\n        {\n            e.preventDefault();\n            this.caret['set' + caret](item);\n            return true;\n        }\n    }\n});\n$R.add('class', 'input.delete', {\n    init: function(app, e, key)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.caret = app.caret;\n        this.utils = app.utils;\n        this.editor = app.editor;\n        this.marker = app.marker;\n        this.keycodes = app.keycodes;\n        this.component = app.component;\n        this.inspector = app.inspector;\n        this.selection = app.selection;\n        this.insertion = app.insertion;\n\n        // local\n        this.key = key;\n\n        // init\n        this._init(e);\n    },\n    // private\n    _init: function(e)\n    {\n        if (this._removeActiveComponent(e)) return;\n        if (this._removeAllSelectedTable(e)) return;\n\n        // is empty\n        if (this.key === this.keycodes.BACKSPACE)\n        {\n            var $editor = this.editor.getElement();\n            var html = this.utils.trimSpaces($editor.html());\n\n            if (html === this.opts.emptyHtml)\n            {\n                e.preventDefault();\n                return;\n            }\n        }\n\n        // variable or non editable prev/next or selection\n        if (this._detectVariableOrNonEditable() || this.selection.hasNonEditable())\n        {\n            e.preventDefault();\n            return;\n        }\n\n        // all selected\n        if (this.selection.isAll())\n        {\n            e.preventDefault();\n            this.insertion.set(this.opts.emptyHtml);\n            return;\n        }\n\n        // collapsed\n        if (this.selection.isCollapsed())\n        {\n            // next / prev\n            if (this.key === this.keycodes.BACKSPACE) this._traverseBackspace(e);\n            else if (this.key === this.keycodes.DELETE) this._traverseDelete(e);\n        }\n\n        if (this.key === this.keycodes.BACKSPACE) this.utils.trimInvisibleChars('left');\n\n        this._removeUnwantedStyles();\n        this._removeEmptySpans();\n        this._removeSpanTagsInHeadings();\n        this._removeInlineTagsInPre();\n    },\n    _detectVariableOrNonEditable: function()\n    {\n        var block = this.selection.getBlock();\n        var isBlockStart = this.caret.isStart(block);\n        var isBlockEnd = this.caret.isEnd(block);\n        var el;\n\n        // backspace\n        if (this.key === this.keycodes.BACKSPACE && isBlockStart)\n        {\n            el = block.previousSibling;\n            if (this._isNonEditable(el)) return true;\n        }\n        // delete\n        else if (this.key === this.keycodes.DELETE && isBlockEnd)\n        {\n            el = block.nextSibling;\n            if (this._isNonEditable(el)) return true;\n        }\n\n        var current = this.selection.getCurrent();\n        var isCurrentStart = this.caret.isStart(current);\n        var isCurrentEnd = this.caret.isEnd(current);\n        var isCurrentStartSpace = (this.selection.getTextBeforeCaret().trim() === '');\n        var isCurrentEndSpace = (this.selection.getTextAfterCaret().trim() === '');\n\n        // backspace\n        if (this.key === this.keycodes.BACKSPACE && isCurrentStart && !isCurrentStartSpace)\n        {\n            el = current.previousSibling;\n            if (this._isVariable(el))\n            {\n                this.caret.setEnd(el);\n                return true;\n            }\n            else if (this._isNonEditable(el)) return true;\n        }\n        // delete\n        else if (this.key === this.keycodes.DELETE && isCurrentEnd && !isCurrentEndSpace)\n        {\n            el = current.nextSibling;\n            if (this._isVariable(el))\n            {\n                this.caret.setStart(el);\n                return true;\n            }\n            else if (this._isNonEditable(el)) return true;\n        }\n    },\n    _isVariable: function(node)\n    {\n        return ($R.dom(node).closest('[data-redactor-type=\"variable\"]').length !== 0);\n    },\n    _isNonEditable: function(node)\n    {\n        return ($R.dom(node).closest('.non-editable').length !== 0);\n    },\n    _getBlock: function()\n    {\n        var $editor = this.editor.getElement();\n        var block = this.selection.getBlock();\n        var data = this.inspector.parse(block);\n\n        block = (data.isList()) ? $R.dom(block).parents('ul, ol', $editor).last().get() : block;\n        block = (data.isDl()) ? data.getDl() : block;\n        block = (data.isTable()) ? data.getTable() : block;\n\n        return block;\n    },\n    _traverseDelete: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var block, isEnd, $next;\n\n        // figcaption\n        if (data.isFigcaption())\n        {\n            block = data.getFigcaption();\n            isEnd = this.caret.isEnd(block);\n\n            if (isEnd)\n            {\n                e.preventDefault();\n                return;\n            }\n        }\n        // figure/code\n        else if (data.isComponentType('code'))\n        {\n            block = data.getComponent();\n            isEnd = this.caret.isEnd(block);\n\n            if (isEnd)\n            {\n                e.preventDefault();\n                return;\n            }\n        }\n\n\n        // next\n        block = this._getBlock();\n        var next = this.utils.findSiblings(block, 'next');\n        if (!next) return;\n\n        isEnd = this.caret.isEnd(block);\n        var dataNext = this.inspector.parse(next);\n        var isNextBlock = (next.tagName === 'P' || next.tagName === 'DIV');\n\n        // table\n        if (isEnd && dataNext.isComponentType('table'))\n        {\n            e.preventDefault();\n            this.caret.setStart(next);\n            return;\n        }\n        // figure/code\n        else if (isEnd && dataNext.isComponentEditable())\n        {\n            e.preventDefault();\n            this.component.remove(next, false);\n            return;\n        }\n        // component\n        else if (isEnd && dataNext.isComponent())\n        {\n            e.preventDefault();\n\n            // select component\n            this.caret.setStart(next);\n\n            // remove current if empty\n            if (this.utils.isEmptyHtml(block.innerHTML))\n            {\n                $R.dom(block).remove();\n            }\n\n            return;\n        }\n        // combine list\n        else if (isEnd && dataNext.isList())\n        {\n            var $currentList = $R.dom(block);\n            $next = $R.dom(next);\n\n            // current list\n            if (data.isList())\n            {\n                e.preventDefault();\n\n                $currentList.append($next);\n                $next.unwrap();\n\n                return;\n            }\n            else\n            {\n                var $first = $next.children('li').first();\n                var $lists = $first.find('ul, ol');\n\n                if ($lists.length !== 0)\n                {\n                    e.preventDefault();\n\n                    $next.prepend($lists);\n                    $lists.unwrap();\n\n                    $currentList.append($first);\n                    $first.unwrap();\n\n                    return;\n                }\n            }\n        }\n        // block\n        else if (isEnd && !data.isList() && !data.isTable() && isNextBlock && !this.utils.isEmptyHtml(block.innerHTML))\n        {\n            e.preventDefault();\n\n            var $current = $R.dom(block);\n            $next = $R.dom(next);\n\n            $current.append($next);\n            $next.unwrap();\n\n            return;\n        }\n    },\n    _traverseBackspace: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var block, isStart, $prev, $currentList;\n\n        // figcaption\n        if (data.isFigcaption())\n        {\n            block = data.getFigcaption();\n            isStart = this.caret.isStart(block);\n\n            if (isStart)\n            {\n                e.preventDefault();\n                return;\n            }\n        }\n        // figure/code\n        else if (data.isComponentType('code'))\n        {\n            block = data.getComponent();\n            isStart = this.caret.isStart(block);\n\n            if (isStart && block.previousElementSibling)\n            {\n                e.preventDefault();\n                this.caret.setEnd(block.previousElementSibling);\n                return true;\n            }\n        }\n\n        // prev\n        block = this._getBlock();\n        var prev = this.utils.findSiblings(block, 'prev');\n\n        if (!prev)\n        {\n            setTimeout(this._replaceBlock.bind(this), 1);\n            return;\n        }\n\n        isStart = this.caret.isStart(block);\n        var dataPrev = this.inspector.parse(prev);\n        var isPrevBlock = (prev.tagName === 'P' || prev.tagName === 'DIV');\n\n        // figure/code\n        if (isStart && dataPrev.isComponentType('code'))\n        {\n            e.preventDefault();\n            this.component.remove(prev, false);\n            return;\n        }\n        // table\n        else if (isStart && dataPrev.isComponentType('table'))\n        {\n            e.preventDefault();\n            this.caret.setEnd(prev);\n            return;\n        }\n        // component\n        else if (isStart && dataPrev.isComponent())\n        {\n            e.preventDefault();\n\n            // select component\n            this.caret.setStart(prev);\n\n\n            // remove current if empty\n            if (this.utils.isEmptyHtml(block.innerHTML))\n            {\n                $R.dom(block).remove();\n            }\n\n            return;\n        }\n        // lists\n        else if (isStart && data.isList())\n        {\n            e.preventDefault();\n\n            $currentList = $R.dom(block);\n            $prev = $R.dom(prev);\n\n            if (dataPrev.isList())\n            {\n                $currentList.children('li').first().prepend(this.marker.build('start'));\n                $prev.append($currentList);\n                $currentList.unwrap();\n\n                this.selection.restoreMarkers();\n            }\n            else\n            {\n                var $first = $currentList.children('li').first();\n                var first = $first.get();\n                var $lists = $first.find('ul, ol');\n\n                var $newnode = this.utils.replaceToTag(first, this.opts.markup);\n                if (this.opts.breakline) $newnode.attr('data-redactor-tag', 'br');\n                $currentList.before($newnode);\n                this.caret.setStart($newnode);\n\n                if ($lists.length !== 0)\n                {\n                    $currentList.prepend($lists);\n                    $lists.unwrap();\n                }\n            }\n\n            return;\n        }\n        // block\n        else if (isStart && isPrevBlock)\n        {\n            e.preventDefault();\n\n            if (this.utils.isEmpty(prev)) {\n                $prev = $R.dom(prev);\n                $prev.remove();\n                return;\n            }\n\n            var textNode = this.utils.createInvisibleChar();\n            var $current = $R.dom(block);\n            $prev = $R.dom(prev);\n\n            this.caret.setEnd($prev);\n\n            $current.prepend(textNode);\n            $prev.append($current.contents());\n            $current.remove();\n\n            return;\n        }\n\n    },\n    _replaceBlock: function()\n    {\n        var block = this.selection.getBlock();\n        var $block = $R.dom(block);\n\n        if (this.opts.markup === 'p' && block && this._isNeedToReplaceBlock(block))\n        {\n            var markup = document.createElement(this.opts.markup);\n\n            $block.replaceWith(markup);\n            this.caret.setStart(markup);\n        }\n\n        if (this.opts.breakline && block && block.tagName === 'DIV')\n        {\n            $block.attr('data-redactor-tag', 'br');\n        }\n    },\n    _isNeedToReplaceBlock: function(block)\n    {\n        return (block.tagName === 'DIV' && this.utils.isEmptyHtml(block.innerHTML));\n    },\n    _removeActiveComponent: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var component = data.getComponent();\n        if (data.isComponent() && this.component.isActive(component))\n        {\n            e.preventDefault();\n            this.component.remove(component);\n            return true;\n        }\n    },\n    _removeAllSelectedTable: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var table = data.getTable();\n        if (table && this.selection.isAll(table))\n        {\n            e.preventDefault();\n            this.component.remove(table);\n            return true;\n        }\n    },\n    _removeUnwantedStyles: function()\n    {\n        var $editor = this.editor.getElement();\n\n        setTimeout(function()\n        {\n            var $tags = $editor.find('*[style]');\n            $tags.not('img, figure, figcaption, iframe, [data-redactor-style-cache], [data-redactor-span]').removeAttr('style');\n\n        }, 0);\n    },\n    _removeEmptySpans: function()\n    {\n        var $editor = this.editor.getElement();\n\n        setTimeout(function()\n        {\n            $editor.find('span').each(function(node)\n            {\n                if (node.attributes.length === 0)\n                {\n                    $R.dom(node).replaceWith(node.childNodes);\n                }\n            });\n\n        }, 0);\n    },\n    _removeSpanTagsInHeadings: function()\n    {\n        var $editor = this.editor.getElement();\n\n        setTimeout(function()\n        {\n            $editor.find('h1, h2, h3, h4, h5, h6').each(function(node)\n            {\n                var $node = $R.dom(node);\n                if ($node.closest('figure').length === 0)\n                {\n                    $node.find('span').not('.redactor-component, .non-editable, .redactor-selection-marker, [data-redactor-style-cache], [data-redactor-span]').unwrap();\n                }\n            });\n\n        }, 1);\n    },\n    _removeInlineTagsInPre: function()\n    {\n        var $editor = this.editor.getElement();\n        var tags = this.opts.inlineTags;\n\n        setTimeout(function()\n        {\n            $editor.find('pre').each(function(node)\n            {\n                var $node = $R.dom(node);\n                if ($node.closest('figure').length === 0)\n                {\n                    $node.find(tags.join(',')).not('code, .redactor-selection-marker').unwrap();\n                }\n            });\n\n        }, 1);\n    }\n});\n$R.add('class', 'input.enter', {\n    init: function(app, e)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.caret = app.caret;\n        this.editor = app.editor;\n        this.keycodes = app.keycodes;\n        this.detector = app.detector;\n        this.insertion = app.insertion;\n        this.selection = app.selection;\n        this.inspector = app.inspector;\n\n        // init\n        this._init(e);\n    },\n    // private\n    _init: function(e)\n    {\n        // turn off\n        if (!this.opts.enterKey) return this._disable(e);\n\n        // callback\n        var stop = this.app.broadcast('enter', e);\n        if (stop === false) return e.preventDefault();\n\n        // has non-editable\n        if (this.selection.hasNonEditable())\n        {\n            e.preventDefault();\n            return;\n        }\n\n        // shift enter\n        if (e.ctrlKey || e.shiftKey) {\n            return this._insertBreak(e);\n        }\n\n        // enter & exit\n        if (this._isExit(e)) return;\n\n        // traverse\n        this._traverse(e);\n    },\n    _disable: function(e)\n    {\n        e.preventDefault();\n        var range = this.selection.getRange();\n        if (range && !range.collapsed) range.deleteContents();\n    },\n    _insertBreak: function(e)\n    {\n        e.preventDefault();\n\n        var current = this.selection.getCurrent();\n        var block = this.selection.getBlock();\n        var data = this.inspector.parse(current);\n\n        if (data.isHeading() && this.caret.isStart(block)) {\n            var $block = $R.dom(block);\n            var $newBlock = $block.clone().html('');\n            $block.before($newBlock);\n            this.caret.setStart($block);\n        }\n        else if ((data.isComponent() && !data.isComponentEditable()) || data.isCode()) return;\n        else if (data.isPre()) this.insertion.insertNewline();\n        else this.insertion.insertBreakLine();\n    },\n    _isExit: function(e)\n    {\n        var $editor = this.editor.getElement();\n        var block = this.selection.getBlock();\n        var data = this.inspector.parse(block);\n        var isEnd = this.caret.isEnd(block);\n        var current = this.selection.getCurrent();\n        var prev = current.previousSibling;\n\n        // blockquote\n        if (data.isBlockquote())\n        {\n            var isParagraphExit = (isEnd && this._isExitableBlock(block, 'P'));\n            var isBreaklineExit = (isEnd && this._isExitableDblBreak(prev));\n\n            if (isParagraphExit || isBreaklineExit)\n            {\n                return this._exitFromElement(e, ((isBreaklineExit) ? prev : block), data.getBlockquote());\n            }\n        }\n        // pre\n        else if (!data.isComponentType('code') && data.isPre())\n        {\n            if (isEnd)\n            {\n                var html = block.innerHTML;\n                html = this.utils.removeInvisibleChars(html);\n                if (html.match(/(\\n\\n\\n)$/) !== null)\n                {\n                    $R.dom(prev.previousSibling.previousSibling).remove();\n                    return this._exitFromElement(e, prev, block);\n                }\n            }\n        }\n        // dl\n        else if (data.isDl())\n        {\n            if (isEnd && this._isExitableBlock(block, 'DT'))\n            {\n                return this._exitFromElement(e, block, data.getDl());\n            }\n        }\n        // li\n        else if (data.isList())\n        {\n            var list = $R.dom(current).parents('ul, ol', $editor).last();\n\n            isEnd = this.caret.isEnd(list);\n            if (isEnd && this._isExitableBlock(block, 'LI'))\n            {\n                return this._exitFromElement(e, block, list);\n            }\n        }\n        else if (data.isComponent() && data.isComponentActive() && !data.isFigcaption() && !data.isComponentEditable())\n        {\n            return this._exitFromElement(e, false, data.getComponent());\n        }\n    },\n    _isExitableDblBreak: function(prev)\n    {\n        var next = (prev) ? prev.nextSibling : false;\n        if (next)\n        {\n            var text = this.utils.removeInvisibleChars(next.textContent);\n\n            return (next.nodeType === 3 && text.trim() === '');\n        }\n    },\n    _isExitableBlock: function(block, tag)\n    {\n        return (block && block.tagName === tag && this.utils.isEmptyHtml(block.innerHTML));\n    },\n    _exitFromElement: function(e, prev, el)\n    {\n        e.preventDefault();\n        if (prev) $R.dom(prev).remove();\n        this.utils.createMarkup(el);\n\n        return true;\n    },\n    _exitNextElement: function(e, node)\n    {\n        e.preventDefault();\n\n        if (node.nextSibling) this.caret.setStart(node.nextSibling);\n        else this.utils.createMarkup(node);\n\n        return true;\n    },\n    _traverse: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var isText = this.selection.isText();\n        var block = this.selection.getBlock();\n        var data = this.inspector.parse(current);\n        var blockTag = (block) ? block.tagName.toLowerCase() : false;\n        var $variable = $R.dom(current).closest('[data-redactor-type=variable]');\n        // variable parent\n        if ($variable.length !== 0) {\n            this.caret.setAfter($variable);\n        }\n\n        // pre\n        if (data.isPre())\n        {\n            e.preventDefault();\n            return this.insertion.insertNewline();\n        }\n        // blockquote\n        else if (data.isBlockquote())\n        {\n            block = this.selection.getBlock(current);\n            if (block && block.tagName === 'BLOCKQUOTE')\n            {\n                e.preventDefault();\n                return this.insertion.insertBreakLine();\n            }\n        }\n        // figcaption\n        else if (data.isFigcaption())\n        {\n            block = data.getFigcaption();\n            var isEnd = this.caret.isEnd(block);\n            var isEndEditor = this.caret.isEnd();\n            if (isEnd || isEndEditor)\n            {\n                return this._exitNextElement(e, data.getComponent());\n            }\n            else\n            {\n                e.preventDefault();\n                return;\n            }\n        }\n        // dl\n        else if (data.isDl())\n        {\n            e.preventDefault();\n            return this._traverseDl(current);\n        }\n        // breakline\n        else if (this.opts.breakline && blockTag === 'div') {\n            setTimeout(this._replaceBlock.bind(this), 1);\n            return;\n        }\n        // text\n        else if (isText)\n        {\n            e.preventDefault();\n            return this.insertion.insertBreakLine();\n        }\n        // list\n        else if (data.isList()) {\n            return;\n        }\n        // div / p\n        else\n        {\n            var delay = (!this.detector.isDesktop()) ? 1 : 50;\n            setTimeout(this._replaceBlock.bind(this), delay);\n            return;\n        }\n\n    },\n    _traverseDl: function(current)\n    {\n        var block = this.selection.getBlock(current);\n        var data = this.inspector.parse(block);\n        var tag = data.getTag();\n        var $el = $R.dom(block);\n        var next = $el.get().nextSibling || false;\n        var $next = $R.dom(next);\n        var nextDd = (next && $next.is('dd'));\n        var nextDt = (next && $next.is('dt'));\n        var isEnd = this.caret.isEnd(block);\n\n        if (tag === 'dt' && !nextDd && isEnd)\n        {\n            var dd = document.createElement('dd');\n            $el.after(dd);\n\n            this.caret.setStart(dd);\n            return;\n        }\n        else if (tag === 'dd' && !nextDt && isEnd)\n        {\n            var dt = document.createElement('dt');\n            $el.after(dt);\n\n            this.caret.setStart(dt);\n            return;\n        }\n\n        return this.insertion.insertBreakLine();\n    },\n    _replaceBlock: function()\n    {\n        var block = this.selection.getBlock();\n        var $block = $R.dom(block);\n\n        if (this.opts.markup === 'p' && block && this._isNeedToReplaceBlock(block))\n        {\n            var markup = document.createElement(this.opts.markup);\n            $block.replaceWith(markup);\n            this.caret.setStart(markup);\n        }\n        else\n        {\n            if (block)\n            {\n                if (this.utils.isEmptyHtml(block.innerHTML))\n                {\n                    this._clearBlock($block, block);\n                }\n                else\n                {\n                    var first = this.utils.getFirstNode(block);\n                    if (first && first.tagName === 'BR')\n                    {\n                        $R.dom(first).remove();\n                        this.caret.setStart(block);\n                    }\n                }\n            }\n        }\n\n        // remove id\n        $block.removeAttr('id');\n\n        if (block && this._isNeedToCleanBlockStyle(block) && this.opts.cleanOnEnter)\n        {\n            $block.removeAttr('class style');\n        }\n\n        if (this.opts.breakline && block && block.tagName === 'DIV')\n        {\n            //$block.append(document.createElement('br'));\n            //$block.attr('data-redactor-tag', 'br');\n        }\n    },\n    _clearBlock: function($block, block)\n    {\n        if (block.tagName === 'DIV') {\n            $block.find('br').remove();\n        }\n\n        if (this.opts.cleanInlineOnEnter || block.innerHTML === '<br>')\n        {\n            $block.html('');\n        }\n\n        this.caret.setStart(block);\n    },\n    _isNeedToReplaceBlock: function(block)\n    {\n        return (block.tagName === 'DIV' && this.utils.isEmptyHtml(block.innerHTML));\n    },\n    _isNeedToCleanBlockStyle: function(block)\n    {\n        return (block.tagName === 'P' && this.utils.isEmptyHtml(block.innerHTML));\n    }\n});\n$R.add('class', 'input.paste', {\n    init: function(app, e, dataTransfer, html, point)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.editor = app.editor;\n        this.cleaner = app.cleaner;\n        this.container = app.container;\n        this.inspector = app.inspector;\n        this.insertion = app.insertion;\n        this.selection = app.selection;\n        this.autoparser = app.autoparser;\n\n        // local\n        this.pasteHtml = html;\n        this.pointInserted = point;\n        this.dataTransfer = dataTransfer;\n\n        // init\n        this._init(e);\n    },\n    // private\n    _init: function(e)\n    {\n        var clipboard = this.dataTransfer || e.clipboardData;\n        var current = this.selection.getCurrent();\n        var dataCurrent = this.inspector.parse(current);\n\n        this.dropPasted = this.dataTransfer;\n        //this.isRawCode = (this.dropPasted) ? (dataCurrent.isPre() || dataCurrent.isCode()) : this._isPlainText(clipboard);\n        this.isRawCode = (dataCurrent.isPre() || dataCurrent.isCode());\n\n        this.editor.enablePasting();\n        this.editor.saveScroll();\n\n        if (!this.dropPasted)\n        {\n            this.selection.saveMarkers();\n        }\n\n        if (this.isRawCode || !clipboard)\n        {\n\n            var text;\n            if (!this.isRawCode && !clipboard && window.clipboardData)\n            {\n                text = window.clipboardData.getData(\"text\");\n            }\n            else\n            {\n                text = clipboard.getData(\"text/plain\");\n            }\n\n            e.preventDefault();\n            this._insert(e, text);\n            return;\n        }\n        else if (this.pasteHtml)\n        {\n            e.preventDefault();\n            this._insert(e, this.pasteHtml);\n        }\n        else\n        {\n            // html / text\n            var url = clipboard.getData('URL');\n            var html = (this._isPlainText(clipboard)) ? this.cleaner.encodeEntities(clipboard.getData(\"text/plain\")) : clipboard.getData(\"text/html\");\n\n            // safari anchor links\n            html = (!url || url === '') ? html : url;\n\n            // file\n            if (clipboard.files !== null && clipboard.files.length > 0 && html === '')\n            {\n                var files = [];\n                for (var i = 0; i < clipboard.files.length; i++)\n                {\n                    var file = clipboard.files[i] || clipboard.items[i].getAsFile();\n                    if (file) files.push(file);\n                }\n\n                if (files.length > 0)\n                {\n                    e.preventDefault();\n                    this._insertFiles(e, files);\n                    return;\n                }\n            }\n\n\n            e.preventDefault();\n            this._insert(e, html);\n        }\n    },\n    _isPlainText: function(clipboard)\n    {\n        var text = clipboard.getData(\"text/plain\");\n        var html = clipboard.getData(\"text/html\");\n\n        if (text && html)\n        {\n            var element = document.createElement(\"div\");\n            element.innerHTML = html;\n\n            if (element.textContent === text)\n            {\n                return !element.querySelector(\":not(meta)\");\n            }\n        }\n        else\n        {\n            return (text !== null);\n        }\n    },\n    _restoreSelection: function()\n    {\n        this.editor.restoreScroll();\n        this.editor.disablePasting();\n        if (!this.dropPasted)\n        {\n            this.selection.restoreMarkers();\n        }\n    },\n    _insert: function(e, html)\n    {\n        // pasteBefore callback\n        var returned = this.app.broadcast('pasteBefore', html);\n        html = (returned === undefined) ? html : returned;\n\n        // clean\n        html = html.trim();\n        html = (this.isRawCode) ? html : this.cleaner.paste(html);\n        html = html.trim();\n        html = (this.isRawCode) ? this.cleaner.encodePhpCode(html) : html;\n\n        // paste callback\n        returned = this.app.broadcast('pasting', html);\n        html = (returned === undefined) ? html : returned;\n\n        this._restoreSelection();\n\n        // stop input\n        if (!this.opts.input) return;\n\n        this.app.broadcast('state', false);\n\n        // insert\n        var nodes = [];\n        if (this.isRawCode) {\n            html = html.replace('&lt;?php', '<?php');\n\n            var textNode = document.createTextNode(html);\n            nodes = this.insertion.insertNode(textNode, 'after');\n\n            this.app.broadcast('pasted', nodes);\n        }\n        else {\n\n            // autoparse\n            if (this.opts.autoparse && this.opts.autoparsePaste)\n            {\n                html = this.autoparser.parse(html);\n            }\n\n            nodes = (this.dropPasted) ? this.insertion.insertToPoint(e, html, this.pointInserted) : this.insertion.insertHtml(html);\n\n            // pasted callback\n            this.app.broadcast('pasted', nodes);\n            this.app.broadcast('autoparseobserve');\n        }\n\n    },\n    _insertFiles: function(e, files)\n    {\n        this._restoreSelection();\n\n        // drop or clipboard\n        var isImage = (this.opts.imageTypes.indexOf(files[0].type) !== -1);\n        var isClipboard = (typeof this.dropPasted === 'undefined');\n\n        if (isImage) this.app.broadcast('dropimage', e, files, isClipboard);\n        else this.app.broadcast('dropfile', e, files, isClipboard);\n    }\n});\n$R.add('class', 'input.shortcode', {\n    init: function(app, e, key)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.marker = app.marker;\n        this.keycodes = app.keycodes;\n        this.selection = app.selection;\n\n        // local\n        this.worked = false;\n\n        // init\n        if (key === this.keycodes.SPACE) this._init();\n    },\n    // public\n    is: function()\n    {\n        return this.worked;\n    },\n    // private\n    _init: function()\n    {\n        var current = this.selection.getCurrent();\n        if (current && current.nodeType === 3)\n        {\n            var text = this.utils.removeInvisibleChars(current.textContent);\n            var shortcodes = this.opts.shortcodes;\n            for (var name in shortcodes)\n            {\n                var re = new RegExp('^' + this.utils.escapeRegExp(name));\n                var match = text.match(re);\n                if (match !== null)\n                {\n                    if (typeof shortcodes[name].format !== 'undefined')\n                    {\n                        return this._format(shortcodes[name].format, current, re);\n                    }\n                }\n            }\n        }\n    },\n    _format: function(tag, current, re)\n    {\n        var marker = this.marker.insert('start');\n        current = marker.previousSibling;\n\n        var text = current.textContent;\n        text = this.utils.trimSpaces(text);\n        text = text.replace(re, '');\n        current.textContent = text;\n\n        var api = (tag === 'ul' || tag === 'ol') ? 'module.list.toggle' : 'module.block.format';\n\n        this.app.api(api, tag);\n        this.selection.restoreMarkers();\n\n        this.worked = true;\n    }\n});\n$R.add('class', 'input.shortcut', {\n    init: function(app, e)\n    {\n        this.app = app;\n        this.opts = app.opts;\n\n        // local\n        this.worked = false;\n\n        // based on https://github.com/jeresig/jquery.hotkeys\n        this.hotkeys = {\n            8: \"backspace\", 9: \"tab\", 10: \"return\", 13: \"return\", 16: \"shift\", 17: \"ctrl\", 18: \"alt\", 19: \"pause\",\n            20: \"capslock\", 27: \"esc\", 32: \"space\", 33: \"pageup\", 34: \"pagedown\", 35: \"end\", 36: \"home\",\n            37: \"left\", 38: \"up\", 39: \"right\", 40: \"down\", 45: \"insert\", 46: \"del\", 59: \";\", 61: \"=\",\n            96: \"0\", 97: \"1\", 98: \"2\", 99: \"3\", 100: \"4\", 101: \"5\", 102: \"6\", 103: \"7\",\n            104: \"8\", 105: \"9\", 106: \"*\", 107: \"+\", 109: \"-\", 110: \".\", 111 : \"/\",\n            112: \"f1\", 113: \"f2\", 114: \"f3\", 115: \"f4\", 116: \"f5\", 117: \"f6\", 118: \"f7\", 119: \"f8\",\n            120: \"f9\", 121: \"f10\", 122: \"f11\", 123: \"f12\", 144: \"numlock\", 145: \"scroll\", 173: \"-\", 186: \";\", 187: \"=\",\n            188: \",\", 189: \"-\", 190: \".\", 191: \"/\", 192: \"`\", 219: \"[\", 220: \"\\\\\", 221: \"]\", 222: \"'\"\n        };\n\n        this.hotkeysShiftNums = {\n            \"`\": \"~\", \"1\": \"!\", \"2\": \"@\", \"3\": \"#\", \"4\": \"$\", \"5\": \"%\", \"6\": \"^\", \"7\": \"&\",\n            \"8\": \"*\", \"9\": \"(\", \"0\": \")\", \"-\": \"_\", \"=\": \"+\", \";\": \": \", \"'\": \"\\\"\", \",\": \"<\",\n            \".\": \">\",  \"/\": \"?\",  \"\\\\\": \"|\"\n        };\n\n        // init\n        this._init(e);\n    },\n    // public\n    is: function()\n    {\n        return this.worked;\n    },\n    // private\n    _init: function(e)\n    {\n        // disable browser's hot keys for bold and italic if shortcuts off\n        if (this.opts.shortcuts === false)\n        {\n            if ((e.ctrlKey || e.metaKey) && (e.which === 66 || e.which === 73)) e.preventDefault();\n            return;\n        }\n\n        // build\n        for (var key in this.opts.shortcuts)\n        {\n            this._build(e, key, this.opts.shortcuts[key]);\n        }\n    },\n    _build: function(e, str, command)\n    {\n        var keys = str.split(',');\n        var len = keys.length;\n        for (var i = 0; i < len; i++)\n        {\n            if (typeof keys[i] === 'string')\n            {\n                this._handler(e, keys[i].trim(), command);\n            }\n        }\n    },\n    _handler: function(e, keys, command)\n    {\n        keys = keys.toLowerCase().split(\" \");\n\n        var special = this.hotkeys[e.keyCode];\n        var character = String.fromCharCode(e.which).toLowerCase();\n        var modif = \"\", possible = {};\n        var cmdKeys = [\"meta\", \"ctrl\", \"alt\", \"shift\"];\n\n        for (var i = 0; i < cmdKeys.length; i++)\n        {\n            var specialKey = cmdKeys[i];\n            if (e[specialKey + 'Key'] && special !== specialKey)\n            {\n                modif += specialKey + '+';\n            }\n        }\n\n        if (special) possible[modif + special] = true;\n        if (character)\n        {\n            possible[modif + character] = true;\n            possible[modif + this.hotkeysShiftNums[character]] = true;\n\n            // \"$\" can be triggered as \"Shift+4\" or \"Shift+$\" or just \"$\"\n            if (modif === \"shift+\")\n            {\n                possible[this.hotkeysShiftNums[character]] = true;\n            }\n        }\n\n        var len = keys.length;\n        for (var i = 0; i < len; i++)\n        {\n            if (possible[keys[i]])\n            {\n\n                e.preventDefault();\n                this.worked = true;\n\n                if (command.message)\n                {\n                    this.app.broadcast(command.message, command.args);\n                    this.app.broadcast('buffer.trigger');\n                }\n                else if (command.api)\n                {\n                    this.app.api(command.api, command.args);\n                    this.app.broadcast('buffer.trigger');\n                }\n\n                return;\n            }\n        }\n    }\n});\n$R.add('class', 'input.space', {\n    init: function(app, e, key, lastShiftKey)\n    {\n        this.app = app;\n        this.keycodes = app.keycodes;\n        this.insertion = app.insertion;\n        this.selection = app.selection;\n\n        // local\n        this.key = key;\n        this.lastShiftKey = lastShiftKey;\n\n        // init\n        this._init(e);\n    },\n    // private\n    _init: function(e)\n    {\n        // has non-editable\n        if (this.selection.hasNonEditable())\n        {\n            e.preventDefault();\n            return;\n        }\n\n        // shift/ctrl + space\n        if (!this.lastShiftKey && this.key === this.keycodes.SPACE && (e.ctrlKey || e.shiftKey) && !e.metaKey)\n        {\n            e.preventDefault();\n            this.insertion.insertChar('&nbsp;');\n            return;\n        }\n    }\n});\n$R.add('class', 'input.tab', {\n    init: function(app, e)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.inspector = app.inspector;\n        this.insertion = app.insertion;\n        this.selection = app.selection;\n\n        // init\n        this._init(e);\n    },\n    // private\n    _init: function(e)\n    {\n        // turn off tab\n        if (!this.opts.tabKey) return;\n\n        // callback\n        var stop = this.app.broadcast('tab', e);\n        if (stop === false) return e.preventDefault();\n\n        // traverse\n        this._traverse(e);\n    },\n    _traverse: function(e)\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n\n        // hard tab\n        if (!data.isComponent() && e.shiftKey)\n        {\n            return this._insertHardTab(e, 4);\n        }\n\n        // list\n        if (data.isList())\n        {\n            e.preventDefault();\n            return this.app.api('module.list.indent');\n        }\n        // pre\n        if (data.isPre() || (data.isComponentType('code') && !data.isFigcaption()))\n        {\n            return this._tabCode(e);\n        }\n\n        // tab as spaces\n        if (this.opts.tabAsSpaces !== false)\n        {\n            return this._insertHardTab(e, this.opts.tabAsSpaces);\n        }\n    },\n    _insertHardTab: function(e, num)\n    {\n        e.preventDefault();\n        var node = document.createTextNode(Array(num + 1).join('\\u00a0'));\n        return this.insertion.insertNode(node, 'end');\n    },\n    _tabCode: function(e)\n    {\n        e.preventDefault();\n\n        var node = (this.opts.preSpaces) ? document.createTextNode(Array(this.opts.preSpaces + 1).join('\\u00a0')) : document.createTextNode('\\t');\n\n        return this.insertion.insertNode(node, 'end');\n    }\n});\n$R.add('module', 'upload', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.lang = app.lang;\n        this.utils = app.utils;\n        this.editor = app.editor;\n        this.progress = app.progress;\n\n        // local\n        this.defaults = {\n            event: false,\n            element: false,\n            name: false,\n            files: false,\n            url: false,\n            data: false,\n            paramName: false\n        };\n    },\n    // public\n    build: function(options)\n    {\n        this.p = $R.extend(this.defaults, options);\n        this.$el = $R.dom(this.p.element);\n\n        if (this.$el.get().tagName === 'INPUT') this._buildInput();\n        else                                    this._buildBox();\n    },\n    send: function(options)\n    {\n        this.p = $R.extend(this.defaults, options);\n        this.$uploadbox = this.editor.getElement();\n        this._send(this.p.event, this.p.files);\n    },\n    complete: function(response, e)\n    {\n        this._complete(response, e);\n    },\n\n    // private\n    _buildInput: function()\n    {\n        this.box = false;\n        this.prefix = '';\n\n        this.$uploadbox = $R.dom('<div class=\"upload-redactor-box\" />');\n\n        this.$el.hide();\n        this.$el.after(this.$uploadbox);\n\n        if (this.opts.multipleUpload) this.$el.attr('multiple', 'multiple');\n        else this.$el.removeAttr('multiple');\n\n        if (this.p.name !== 'file')\n        {\n            this.$el.attr('accept', 'image/*');\n        }\n\n        this._buildPlaceholder();\n        this._buildEvents();\n    },\n    _buildBox: function()\n    {\n        this.box = true;\n        this.prefix = 'box-';\n\n        this.$uploadbox = this.$el;\n        this.$uploadbox.attr('ondragstart', 'return false;');\n\n        // events\n        this.$uploadbox.on('drop.redactor.upload', this._onDropBox.bind(this));\n        this.$uploadbox.on('dragover.redactor.upload', this._onDragOver.bind(this));\n        this.$uploadbox.on('dragleave.redactor.upload', this._onDragLeave.bind(this));\n    },\n    _buildPlaceholder: function()\n    {\n        this.$placeholder = $R.dom('<div class=\"upload-redactor-placeholder\" />');\n        this.$placeholder.html(this.lang.get('upload-label'));\n        this.$uploadbox.append(this.$placeholder);\n    },\n    _buildEvents: function()\n    {\n        this.$el.on('change.redactor.upload', this._onChange.bind(this));\n        this.$uploadbox.on('click.redactor.upload', this._onClick.bind(this));\n        this.$uploadbox.on('drop.redactor.upload', this._onDrop.bind(this));\n        this.$uploadbox.on('dragover.redactor.upload', this._onDragOver.bind(this));\n        this.$uploadbox.on('dragleave.redactor.upload', this._onDragLeave.bind(this));\n    },\n    _onClick: function(e)\n    {\n        e.preventDefault();\n        this.$el.click();\n    },\n    _onChange: function(e)\n    {\n        this._send(e, this.$el.get().files);\n    },\n    _onDrop: function(e)\n    {\n        e.preventDefault();\n\n        this._clear();\n        this._setStatusDrop();\n        this._send(e);\n    },\n    _onDragOver: function(e)\n    {\n        e.preventDefault();\n        this._setStatusHover();\n\n        return false;\n    },\n    _onDragLeave: function(e)\n    {\n        e.preventDefault();\n        this._removeStatusHover();\n\n        return false;\n    },\n    _onDropBox: function(e)\n    {\n        e.preventDefault();\n\n        this._clear();\n        this._setStatusDrop();\n        this._send(e);\n    },\n    _removeStatusHover: function()\n    {\n        this.$uploadbox.removeClass('upload-redactor-' + this.prefix + 'hover');\n    },\n    _setStatusDrop: function()\n    {\n        this.$uploadbox.addClass('upload-redactor-' + this.prefix + 'drop');\n    },\n    _setStatusHover: function()\n    {\n        this.$uploadbox.addClass('upload-redactor-' + this.prefix + 'hover');\n    },\n    _setStatusError: function()\n    {\n        this.$uploadbox.addClass('upload-redactor-' + this.prefix + 'error');\n    },\n    _setStatusSuccess: function()\n    {\n        this.$uploadbox.addClass('upload-redactor-' + this.prefix + 'success');\n    },\n    _clear: function()\n    {\n        var classes = ['drop', 'hover', 'error', 'success'];\n        for (var i = 0; i < classes.length; i++)\n        {\n            this.$uploadbox.removeClass('upload-redactor-' + this.prefix + classes[i]);\n        }\n\n        this.$uploadbox.removeAttr('ondragstart');\n    },\n    _send: function(e, files)\n    {\n        e = e.originalEvent || e;\n\n        files = (files) ? files : e.dataTransfer.files;\n\n        var data = new FormData();\n        var name = this._getUploadParam();\n\n        data = this._buildData(name, files, data);\n        data = this.utils.extendData(data, this.p.data);\n\n        var stop = this.app.broadcast('upload.start', e, data, files);\n        if (stop !== false)\n        {\n            this._sendData(data, files, e);\n        }\n    },\n    _sendData: function(data, files, e)\n    {\n        this.progress.show();\n        if (typeof this.p.url === 'function')\n        {\n            var res = this.p.url(data, files, e, this);\n            if (!(res instanceof Promise))\n            {\n                this._complete(res, e);\n            }\n        }\n        else\n        {\n            $R.ajax.post({\n                url: this.p.url,\n                data: data,\n                before: function(xhr)\n                {\n                    return this.app.broadcast('upload.beforeSend', xhr);\n\n                }.bind(this),\n                success: function(response)\n                {\n                    this._complete(response, e);\n                }.bind(this),\n                error: function(response, xhr, status)\n                {\n                    this._complete(response, e, status);\n                }.bind(this)\n            });\n        }\n    },\n    _getUploadParam: function()\n    {\n        return (this.p.paramName) ? this.p.paramName : 'file';\n    },\n    _buildData: function(name, files, data)\n    {\n        if (files.length === 1)\n        {\n            data.append(name + '[]', files[0]);\n        }\n        else if (files.length > 1 && this.opts.multipleUpload !== false)\n        {\n            for (var i = 0; i < files.length; i++)\n            {\n                data.append(name + '[]', files[i]);\n            }\n        }\n\n        return data;\n    },\n    _complete: function(response, e, status)\n    {\n        this._clear();\n        this.progress.hide();\n\n        if (response && response.error)\n        {\n            this._setStatusError();\n\n            this.app.broadcast('upload.' + this.p.name + '.error', response, e, status);\n            this.app.broadcast('upload.error', response, status);\n        }\n        else\n        {\n            this._setStatusSuccess();\n\n            this.app.broadcast('upload.' + this.p.name + '.complete', response, e);\n            this.app.broadcast('upload.complete', response);\n\n            setTimeout(this._clear.bind(this), 500);\n        }\n    }\n});\n$R.add('class', 'code.component', {\n    mixins: ['dom', 'component'],\n    init: function(app, el)\n    {\n        this.app = app;\n\n        // init\n        return (el && el.cmnt !== undefined) ? el : this._init(el);\n    },\n\n    // private\n   _init: function(el)\n    {\n        var $pre;\n        if (typeof el !== 'undefined')\n        {\n            var $node = $R.dom(el);\n            var $wrapper = $node.closest('figure');\n            if ($wrapper.length !== 0)\n            {\n                this.parse($wrapper);\n            }\n            else\n            {\n                this.parse('<figure>');\n                this.append(el);\n            }\n\n            $pre = this.find('pre code, pre').last();\n        }\n        else\n        {\n            $pre = $R.dom('<pre>');\n\n            this.parse('<figure>');\n            this.append($pre);\n        }\n\n        this._initElement($pre);\n        this._initWrapper();\n    },\n    _initElement: function($pre)\n    {\n        $pre.attr({\n            'tabindex': '-1',\n            'contenteditable': true\n        });\n    },\n    _initWrapper: function()\n    {\n        this.addClass('redactor-component');\n        this.attr({\n            'data-redactor-type': 'code',\n            'tabindex': '-1',\n            'contenteditable': false\n        });\n    }\n});\n$R.add('module', 'form', {\n    init: function(app)\n    {\n        this.app = app;\n        this.lang = app.lang;\n        this.component = app.component;\n        this.inspector = app.inspector;\n    },\n    // messages\n    onform: {\n        remove: function(node)\n        {\n            this._remove(node);\n        }\n    },\n    oncontextbar: function(e, contextbar)\n    {\n        var data = this.inspector.parse(e.target);\n        if (data.isComponentType('form'))\n        {\n            var node = data.getComponent();\n            var buttons = {\n                \"remove\": {\n                    title: this.lang.get('delete'),\n                    api: 'module.form.remove',\n                    args: node\n                }\n            };\n\n            contextbar.set(e, node, buttons, 'top');\n        }\n\n    },\n\n    // private\n    _remove: function(node)\n    {\n        this.component.remove(node);\n    }\n});\n$R.add('class', 'form.component', {\n    mixins: ['dom', 'component'],\n    init: function(app, el)\n    {\n        this.app = app;\n        this.utils = app.utils;\n\n        // init\n        return (el && el.cmnt !== undefined) ? el : this._init(el);\n    },\n    // private\n    _init: function(el)\n    {\n        if (typeof el !== 'undefined')\n        {\n            var $node = $R.dom(el);\n            var $wrapper = $node.closest('form');\n            if ($wrapper.length !== 0)\n            {\n                var $figure = this.utils.replaceToTag(el, 'figure');\n                this.parse($figure);\n            }\n            else\n            {\n                this.parse('<figure>');\n                this.append(el);\n            }\n        }\n        else\n        {\n            this.parse('<figure>');\n        }\n\n        this._initWrapper();\n    },\n    _initWrapper: function()\n    {\n        this.addClass('redactor-component');\n        this.attr({\n            'data-redactor-type': 'form',\n            'tabindex': '-1',\n            'contenteditable': false\n        });\n    }\n});\n$R.add('module', 'image', {\n    modals: {\n        'image':\n            '<div class=\"redactor-modal-tab redactor-modal-tab-upload\" data-title=\"## upload ##\"><form action=\"\"> \\\n                <input type=\"file\" name=\"file\"> \\\n            </form></div>',\n        'imageedit':\n            '<div class=\"redactor-modal-group\"> \\\n                <div id=\"redactor-modal-image-preview\" class=\"redactor-modal-side\"></div> \\\n                <form action=\"\" class=\"redactor-modal-area\"> \\\n                    <div class=\"form-item\"> \\\n                        <label for=\"modal-image-title\"> ## title ##</label> \\\n                        <input type=\"text\" id=\"modal-image-title\" name=\"title\" /> \\\n                    </div> \\\n                    <div class=\"form-item form-item-caption\"> \\\n                        <label for=\"modal-image-caption\">## caption ##</label> \\\n                        <input type=\"text\" id=\"modal-image-caption\" name=\"caption\" aria-label=\"## caption ##\" /> \\\n                    </div> \\\n                    <div class=\"form-item form-item-align\"> \\\n                        <label>## image-position ##</label> \\\n                        <select name=\"align\" aria-label=\"## image-position ##\"> \\\n                            <option value=\"none\">## none ##</option> \\\n                            <option value=\"left\">## left ##</option> \\\n                            <option value=\"center\">## center ##</option> \\\n                            <option value=\"right\">## right ##</option> \\\n                        </select> \\\n                    </div> \\\n                    <div class=\"form-item form-item-link\"> \\\n                        <label for=\"modal-image-url\">## link ##</label> \\\n                        <input type=\"text\" id=\"modal-image-url\" name=\"url\" aria-label=\"## link ##\" /> \\\n                    </div> \\\n                    <div class=\"form-item form-item-link\"> \\\n                        <label class=\"checkbox\"><input type=\"checkbox\" name=\"target\" aria-label=\"## link-in-new-tab ##\"> ## link-in-new-tab ##</label> \\\n                    </div> \\\n                </form> \\\n            </div>'\n    },\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.lang = app.lang;\n        this.caret = app.caret;\n        this.utils = app.utils;\n        this.editor = app.editor;\n        this.storage = app.storage;\n        this.component = app.component;\n        this.inspector = app.inspector;\n        this.insertion = app.insertion;\n        this.selection = app.selection;\n\n        // local\n        this.justResized = false;\n    },\n    // messages\n    oninsert: function()\n    {\n        this._observeImages();\n    },\n    onstarted: function()\n    {\n        // storage observe\n        this.storage.observeImages();\n\n        // resize\n        if (this.opts.imageResizable)\n        {\n            this.resizer = $R.create('image.resize', this.app);\n        }\n\n        // observe\n        this._observeImages();\n    },\n    ondropimage: function(e, files, clipboard)\n    {\n        if (!this.opts.imageUpload) return;\n\n        var options = {\n            url: this.opts.imageUpload,\n            event: (clipboard) ? false : e,\n            files: files,\n            name: 'imagedrop',\n            data: this.opts.imageData,\n            paramName: this.opts.imageUploadParam\n        };\n\n        this.app.api('module.upload.send', options);\n    },\n    onstop: function()\n    {\n        if (this.resizer) this.resizer.stop();\n    },\n    onbottomclick: function()\n    {\n        this.insertion.insertToEnd(this.editor.getLastNode(), 'image');\n    },\n    onimageresizer: {\n        stop: function()\n        {\n            if (this.resizer) this.resizer.hide();\n        }\n    },\n    onsource: {\n        open: function()\n        {\n            if (this.resizer) this.resizer.hide();\n        },\n        closed: function()\n        {\n            this._observeImages();\n            if (this.resizer) this.resizer.rebuild();\n        }\n    },\n    onupload: {\n        complete: function()\n        {\n            this._observeImages();\n        },\n        image: {\n            complete: function(response)\n            {\n                this._insert(response);\n                this.app.broadcast('state', false);\n            },\n            error: function(response)\n            {\n                this._uploadError(response);\n            }\n        },\n        imageedit: {\n            complete: function(response)\n            {\n                this._change(response);\n            },\n            error: function(response)\n            {\n                this._uploadError(response);\n            }\n        },\n        imagedrop: {\n            complete: function(response, e)\n            {\n                this._insert(response, e);\n            },\n            error: function(response)\n            {\n                this._uploadError(response);\n            }\n        },\n        imagereplace: {\n            complete: function(response)\n            {\n                this._change(response, false);\n            },\n            error: function(response)\n            {\n                this._uploadError(response);\n            }\n        }\n    },\n    onmodal: {\n        image: {\n            open: function($modal, $form)\n            {\n                this._setUpload($modal, $form);\n            }\n        },\n        imageedit: {\n            open: function($modal, $form)\n            {\n                this._setFormData($modal, $form);\n            },\n            opened: function($modal, $form)\n            {\n                this._setFormFocus($form);\n            },\n            remove: function()\n            {\n                this._remove(this.$image);\n            },\n            save: function($modal, $form)\n            {\n                this._save($modal, $form);\n            }\n        }\n    },\n    onimage: {\n        observe: function()\n        {\n            this._observeImages();\n        },\n        resized: function()\n        {\n            this.justResized = true;\n        }\n    },\n    oncontextbar: function(e, contextbar)\n    {\n        if (this.justResized)\n        {\n            this.justResized = false;\n            return;\n        }\n\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var $img = $R.dom(current).closest('img');\n\n        if ((!data.isFigcaption() && data.isComponentType('image')) || $img.length !== 0)\n        {\n            var node = ($img.length !== 0) ? $img.get() : data.getComponent();\n            var buttons = {\n                \"edit\": {\n                    title: this.lang.get('edit'),\n                    api: 'module.image.open'\n                },\n                \"remove\": {\n                    title: this.lang.get('delete'),\n                    api: 'module.image.remove',\n                    args: node\n                }\n            };\n\n            contextbar.set(e, node, buttons);\n        }\n    },\n\n    // public\n    open: function()\n    {\n        this.$image = this._getCurrent();\n        this.app.api('module.modal.build', this._getModalData());\n    },\n    insert: function(data)\n    {\n        this._insert(data);\n    },\n    remove: function(node)\n    {\n        this._remove(node);\n    },\n\n    // private\n    _getModalData: function()\n    {\n        var modalData;\n        if (this._isImage() && this.opts.imageEditable)\n        {\n            modalData = {\n                name: 'imageedit',\n                width: '800px',\n                title: this.lang.get('edit'),\n                handle: 'save',\n                commands: {\n                    save: { title: this.lang.get('save') },\n                    remove: { title: this.lang.get('delete'), type: 'danger' },\n                    cancel: { title: this.lang.get('cancel') }\n                }\n            };\n        }\n        else\n        {\n            modalData = {\n                name: 'image',\n                title: this.lang.get('image')\n            };\n        }\n\n        return modalData;\n    },\n    _isImage: function()\n    {\n        return this.$image;\n    },\n    _getCurrent: function()\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var $img = $R.dom(current).closest('img');\n\n        if ($img.length !== 0) {\n            return this.component.create('image', $img);\n        }\n        else {\n            return (data.isComponentType('image') && data.isComponentActive()) ? this.component.create('image', data.getComponent()) : false;\n        }\n    },\n    _insert: function(response, e)\n    {\n        this.app.api('module.modal.close');\n\n        if (Array.isArray(response))\n        {\n            var obj = {};\n            for (var i = 0; i < response.length; i++)\n            {\n                obj = $R.extend(obj, response[i]);\n            }\n\n            response = obj;\n        }\n        else if (typeof response === 'string')\n        {\n            response = { \"file\": { url: response }};\n        }\n\n        if (typeof response === 'object')\n        {\n\n            var multiple = 0;\n            for (var key in response)\n            {\n                if (typeof response[key] === 'object') multiple++;\n            }\n\n            if (multiple > 1)\n            {\n                this._insertMultiple(response, e);\n            }\n            else\n            {\n                this._insertSingle(response, e);\n            }\n        }\n    },\n    _insertSingle: function(response, e)\n    {\n        for (var key in response)\n        {\n            if (typeof response[key] === 'object')\n            {\n                var $img = this._createImageAndStore(response[key]);\n                var inserted = (e) ? this.insertion.insertToPoint(e, $img, false, false) : this.insertion.insertHtml($img, false);\n\n                this._removeSpaceBeforeFigure(inserted[0]);\n\n                // set is active\n                this.component.setActive(inserted[0]);\n                this.app.broadcast('image.uploaded', inserted[0], response);\n            }\n        }\n    },\n    _insertMultiple: function(response, e)\n    {\n        var z = 0;\n        var inserted = [];\n        var last;\n        for (var key in response)\n        {\n            if (typeof response[key] === 'object')\n            {\n                z++;\n\n                var $img = this._createImageAndStore(response[key]);\n\n                if (z === 1)\n                {\n                    inserted = (e) ? this.insertion.insertToPoint(e, $img, false, false) : this.insertion.insertHtml($img, false);\n                }\n                else\n                {\n                    var $inserted = $R.dom(inserted[0]);\n                    $inserted.after($img);\n                    inserted = [$img.get()];\n\n                    this.app.broadcast('image.inserted', $img);\n                }\n\n                last = inserted[0];\n\n                this._removeSpaceBeforeFigure(inserted[0]);\n                this.app.broadcast('image.uploaded', inserted[0], response);\n            }\n        }\n\n        // set last is active\n        this.component.setActive(last);\n    },\n    _createImageAndStore: function(item)\n    {\n        var $img = this.component.create('image');\n\n        $img.addClass('redactor-uploaded-figure');\n        $img.setData({\n            src: item.url,\n            id: (item.id) ? item.id : this.utils.getRandomId()\n        });\n\n        // add to storage\n        this.storage.add('image', $img.getElement());\n\n        return $img;\n    },\n    _removeSpaceBeforeFigure: function(img)\n    {\n        if (!img) return;\n\n        var prev = img.previousSibling;\n        var next = img.nextSibling;\n        var $prev = $R.dom(prev);\n        var $next = $R.dom(next);\n\n        if (this.opts.breakline) {\n            if (next && $next.attr('data-redactor-tag') === 'br') {\n                $next.find('br').first().remove();\n            }\n            if (prev && $prev.attr('data-redactor-tag') === 'br') {\n                $prev.find('br').last().remove();\n            }\n        }\n\n        if (prev)\n        {\n            this._removeInvisibleSpace(prev);\n            this._removeInvisibleSpace(prev.previousSibling);\n        }\n    },\n    _removeInvisibleSpace: function(el)\n    {\n        if (el && el.nodeType === 3 && this.utils.searchInvisibleChars(el.textContent) !== -1)\n        {\n            el.parentNode.removeChild(el);\n        }\n    },\n    _save: function($modal, $form)\n    {\n        var data = $form.getData();\n        var imageData = {\n            title: data.title\n        };\n\n        if (this.opts.imageLink) imageData.link = { url: data.url, target: data.target };\n        if (this.opts.imageCaption) imageData.caption = data.caption;\n        if (this.opts.imagePosition) imageData.align = data.align;\n\n        this.$image.setData(imageData);\n        if (this.resizer) this.resizer.rebuild();\n\n        this.app.broadcast('image.changed', this.$image);\n        this.app.api('module.modal.close');\n    },\n    _change: function(response, modal)\n    {\n        if (typeof response === 'string')\n        {\n            response = { \"file\": { url: response }};\n        }\n\n        if (typeof response === 'object')\n        {\n            var $img;\n            for (var key in response)\n            {\n                if (typeof response[key] === 'object')\n                {\n                    $img = $R.dom('<img>');\n                    $img.attr('src', response[key].url);\n\n                    this.$image.changeImage(response[key]);\n\n                    this.app.broadcast('image.changed', this.$image, response);\n                    this.app.broadcast('image.uploaded', this.$image, response);\n\n                    this.app.broadcast('hardsync');\n\n                    break;\n                }\n            }\n\n            if (modal !== false)\n            {\n                $img.on('load', function() { this.$previewBox.html($img); }.bind(this));\n            }\n        }\n    },\n    _uploadError: function(response)\n    {\n        this.app.broadcast('image.uploadError', response);\n    },\n    _remove: function(node)\n    {\n        this.app.api('module.modal.close');\n        this.component.remove(node);\n    },\n    _observeImages: function()\n    {\n        var $editor = this.editor.getElement();\n        var self = this;\n        $editor.find('img').each(function(node)\n        {\n            var $node = $R.dom(node);\n\n            $node.off('.drop-to-replace');\n            $node.on('dragover.drop-to-replace dragenter.drop-to-replace', function(e)\n            {\n                e.preventDefault();\n                return;\n            });\n\n            $node.on('drop.drop-to-replace', function(e)\n            {\n                if (!self.app.isDragComponentInside())\n                {\n                    return self._setReplaceUpload(e, $node);\n                }\n            });\n        });\n    },\n    _setFormData: function($modal, $form)\n    {\n        this._buildPreview($modal);\n        this._buildPreviewUpload();\n\n        var imageData = this.$image.getData();\n        var data = {\n            title: imageData.title\n        };\n\n        // caption\n        if (this.opts.imageCaption) data.caption = imageData.caption;\n        else $modal.find('.form-item-caption').hide();\n\n        // position\n        if (this.opts.imagePosition) data.align = imageData.align;\n        else $modal.find('.form-item-align').hide();\n\n        // link\n        if (this.opts.imageLink)\n        {\n            if (imageData.link)\n            {\n                data.url = imageData.link.url;\n                if (imageData.link.target) data.target = true;\n            }\n        }\n        else $modal.find('.form-item-link').hide();\n\n        $form.setData(data);\n    },\n    _setFormFocus: function($form)\n    {\n        $form.getField('title').focus();\n    },\n    _setReplaceUpload: function(e, $node)\n    {\n        e = e.originalEvent || e;\n        e.stopPropagation();\n        e.preventDefault();\n\n        if (!this.opts.imageUpload) return;\n\n        this.$image = this.component.create('image', $node);\n\n        var options = {\n            url: this.opts.imageUpload,\n            files: e.dataTransfer.files,\n            name: 'imagereplace',\n            data: this.opts.imageData,\n            paramName: this.opts.imageUploadParam\n        };\n\n        this.app.api('module.upload.send', options);\n\n        return;\n    },\n    _setUpload: function($modal, $form)\n    {\n        if (!this.opts.imageUpload) {\n            var $body = $modal.getBody();\n            var $tab = $body.find('.redactor-modal-tab-upload');\n            $tab.remove();\n        }\n\n        var options = {\n            url: this.opts.imageUpload,\n            element: $form.getField('file'),\n            name: 'image',\n            data: this.opts.imageData,\n            paramName: this.opts.imageUploadParam\n        };\n\n        this.app.api('module.upload.build', options);\n    },\n    _buildPreview: function($modal)\n    {\n        this.$preview = $modal.find('#redactor-modal-image-preview');\n\n        var imageData = this.$image.getData();\n        var $previewImg = $R.dom('<img>');\n        $previewImg.attr('src', imageData.src);\n\n        this.$previewBox = $R.dom('<div>');\n        this.$previewBox.append($previewImg);\n\n        this.$preview.html('');\n        this.$preview.append(this.$previewBox);\n    },\n    _buildPreviewUpload: function()\n    {\n        if (!this.opts.imageUpload) return;\n\n        var $desc = $R.dom('<div class=\"desc\">');\n        $desc.html(this.lang.get('upload-change-label'));\n\n        this.$preview.append($desc);\n\n        var options = {\n            url: this.opts.imageUpload,\n            element: this.$previewBox,\n            name: 'imageedit',\n            data: this.opts.imageData,\n            paramName: this.opts.imageUploadParam\n        };\n\n        this.app.api('module.upload.build', options);\n    }\n});\n$R.add('class', 'image.component', {\n    mixins: ['dom', 'component'],\n    init: function(app, el)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.selection = app.selection;\n\n        // init\n        return (el && el.cmnt !== undefined) ? el : this._init(el);\n    },\n    setData: function(data)\n    {\n        for (var name in data)\n        {\n            this._set(name, data[name]);\n        }\n    },\n    getData: function()\n    {\n        var names = ['src', 'title', 'caption', 'align', 'link', 'id'];\n        var data = {};\n\n        for (var i = 0; i < names.length; i++)\n        {\n            data[names[i]] = this._get(names[i]);\n        }\n\n        return data;\n    },\n    getElement: function()\n    {\n        return this.$element;\n    },\n    changeImage: function(data)\n    {\n        this.$element.attr('src', data.url);\n    },\n\n\n    // private\n    _init: function(el)\n    {\n        var $el = $R.dom(el);\n        var $figure = $el.closest('figure');\n\n        if (el === undefined)\n        {\n            this.$element = $R.dom('<img>');\n            this.parse('<figure>');\n            this.append(this.$element);\n        }\n        else if ($figure.length === 0)\n        {\n            this.parse('<figure>');\n            this.$element = $el;\n            this.$element.wrap(this);\n        }\n        else\n        {\n            this.parse($figure);\n            this.$element = this.find('img');\n        }\n\n        this._initWrapper();\n    },\n    _set: function(name, value)\n    {\n        this['_set_' + name](value);\n    },\n    _get: function(name)\n    {\n        return this['_get_' + name]();\n    },\n    _set_src: function(src)\n    {\n       this.$element.attr('src', src);\n    },\n    _set_id: function(id)\n    {\n        if (this.opts.imageObserve) {\n            this.$element.attr('data-image', id);\n        }\n    },\n    _set_title: function(title)\n    {\n        title = title.trim().replace(/(<([^>]+)>)/ig,\"\");\n\n        if (title === '')\n        {\n            this.$element.removeAttr('alt');\n        }\n        else\n        {\n            this.$element.attr('alt', title);\n        }\n\n    },\n    _set_caption: function(caption)\n    {\n        var $figcaption = this.find('figcaption');\n        if ($figcaption.length === 0)\n        {\n            $figcaption = $R.dom('<figcaption>');\n            $figcaption.attr('contenteditable', 'true');\n\n            this.append($figcaption);\n        }\n\n        if (caption === '') $figcaption.remove();\n        else $figcaption.html(caption);\n\n        return $figcaption;\n    },\n    _set_align: function(align)\n    {\n        var imageFloat = '';\n        var imageMargin = '';\n        var textAlign = '';\n        var $el = this;\n        var $img = this.find('img');\n        var $figcaption = this.find('figcaption');\n\n        if (typeof this.opts.imagePosition === 'object')\n        {\n            var positions = this.opts.imagePosition;\n            for (var key in positions)\n            {\n                $el.removeClass(positions[key]);\n            }\n\n            var alignClass = (typeof positions[align] !== 'undefined') ? positions[align] : false;\n            if (alignClass)\n            {\n                $el.addClass(alignClass);\n            }\n        }\n        else\n        {\n            var width = $img.width();\n\n            switch (align)\n            {\n\n                case 'left':\n                    imageFloat = 'left';\n                    imageMargin = this.opts.imageFloatMargin;\n                break;\n                case 'right':\n                    imageFloat = 'right';\n                    imageMargin = this.opts.imageFloatMargin;\n                break;\n                case 'center':\n                    textAlign = 'center';\n                    imageMargin = 'auto';\n                break;\n            }\n\n            $el.css({ 'float': imageFloat, width: width + 'px', maxWidth: width + 'px', 'margin-left': imageMargin, 'margin-right': imageMargin, 'text-align': textAlign });\n            $el.attr('rel', $el.attr('style'));\n\n            if (align === 'none') {\n                $el.css('max-width', '');\n                $el.css('width', '');\n            }\n\n            if (align === 'center')\n            {\n                $el.css('max-width', '');\n                $el.css('width', '');\n                $figcaption.css('text-align', 'center');\n            }\n            else\n            {\n                $figcaption.css('text-align', '');\n            }\n        }\n    },\n    _set_link: function(data)\n    {\n        var $link = this._findLink();\n        if (data.url === '')\n        {\n            if ($link) $link.unwrap();\n\n            return;\n        }\n\n        if (!$link)\n        {\n            $link = $R.dom('<a>');\n            this.$element.wrap($link);\n        }\n\n        $link.attr('href', data.url);\n\n        if (data.target) $link.attr('target', (data.target === true) ? '_blank' : data.target);\n        else $link.removeAttr('target');\n\n        return $link;\n    },\n    _get_src: function()\n    {\n        return this.$element.attr('src');\n    },\n    _get_id: function()\n    {\n        return this.$element.attr('data-image');\n    },\n    _get_title: function()\n    {\n        var alt = this.$element.attr('alt');\n\n        return (alt) ? alt : '';\n    },\n    _get_caption: function()\n    {\n        var $figcaption = this.find('figcaption');\n\n        if ($figcaption.length === 0)\n        {\n            return '';\n        }\n        else\n        {\n            return $figcaption.html();\n        }\n    },\n    _get_align: function()\n    {\n        var align = '';\n        if (typeof this.opts.imagePosition === 'object')\n        {\n            align = 'none';\n            var positions = this.opts.imagePosition;\n            for (var key in positions)\n            {\n                if (this.hasClass(positions[key]))\n                {\n                    align = key;\n                    break;\n                }\n            }\n        }\n        else\n        {\n            align = (this.css('text-align') === 'center') ? 'center' : this.css('float');\n        }\n\n        return align;\n    },\n    _get_link: function()\n    {\n        var $link = this._findLink();\n        if ($link)\n        {\n            var target = ($link.attr('target')) ? true : false;\n\n            return {\n                url: $link.attr('href'),\n                target: target\n            };\n        }\n    },\n    _initWrapper: function()\n    {\n        this.addClass('redactor-component');\n        this.attr({\n            'data-redactor-type': 'image',\n            'tabindex': '-1',\n            'contenteditable': false\n        });\n    },\n    _findLink: function()\n    {\n        var $link = this.find('a').filter(function(node)\n        {\n            return ($R.dom(node).closest('figcaption').length === 0);\n        });\n\n        if ($link.length !== 0)\n        {\n            return $link;\n        }\n\n        return false;\n    }\n});\n$R.add('class', 'image.resize', {\n    init: function(app)\n    {\n        this.app = app;\n        this.$doc = app.$doc;\n        this.$win = app.$win;\n        this.$body = app.$body;\n        this.editor = app.editor;\n        this.toolbar = app.toolbar;\n        this.inspector = app.inspector;\n\n        // init\n        this.$target = (this.toolbar.isTarget()) ? this.toolbar.getTargetElement() : this.$body;\n        this._init();\n    },\n    // public\n    rebuild: function()\n    {\n        this._setResizerPosition();\n    },\n    hide: function()\n    {\n        this.$target.find('#redactor-image-resizer').remove();\n    },\n    stop: function()\n    {\n        var $editor = this.editor.getElement();\n        $editor.off('.redactor.image-resize');\n\n        this.$doc.off('.redactor.image-resize');\n        this.$win.off('resize.redactor.image-resize');\n        this.hide();\n    },\n\n    // private\n    _init: function()\n    {\n        var $editor = this.editor.getElement();\n        $editor.on('click.redactor.image-resize', this._build.bind(this));\n\n        this.$win.on('resize.redactor.image-resize', this._setResizerPosition.bind(this));\n    },\n    _build: function(e)\n    {\n        this.$target.find('#redactor-image-resizer').remove();\n\n        if (this.app.isReadOnly()) return;\n\n        var data = this.inspector.parse(e.target);\n        var $editor = this.editor.getElement();\n\n        if (data.isComponentType('image'))\n        {\n            this.$resizableBox = $editor;\n            this.$resizableImage = $R.dom(data.getImageElement());\n\n            this.$resizer = $R.dom('<span>');\n            this.$resizer.attr('id', 'redactor-image-resizer');\n\n            this.$target.append(this.$resizer);\n\n            this._setResizerPosition();\n            this.$resizer.on('mousedown touchstart', this._set.bind(this));\n        }\n    },\n    _setResizerPosition: function()\n    {\n        if (this.$resizer)\n        {\n            var isTarget = this.toolbar.isTarget();\n            var targetOffset = this.$target.offset();\n            var offsetFix = 7;\n            var topOffset = (isTarget) ? (offsetFix - targetOffset.top + this.$target.scrollTop()) : offsetFix;\n            var leftOffset = (isTarget) ? (offsetFix - targetOffset.left) : offsetFix;\n            var pos = this.$resizableImage.offset();\n            var width = this.$resizableImage.width();\n            var height = this.$resizableImage.height();\n            var resizerWidth =  this.$resizer.width();\n            var resizerHeight =  this.$resizer.height();\n\n            this.$resizer.css({ top: Math.round(pos.top + height - resizerHeight + topOffset) + 'px', left: Math.round(pos.left + width - resizerWidth + leftOffset) + 'px' });\n        }\n    },\n    _set: function(e)\n    {\n        e.preventDefault();\n\n        this.resizeHandle = {\n            x : e.pageX,\n            y : e.pageY,\n            el : this.$resizableImage,\n            $figure: this.$resizableImage.closest('figure'),\n            ratio: this.$resizableImage.width() / this.$resizableImage.height(),\n            h: this.$resizableImage.height()\n        };\n\n        e = e.originalEvent || e;\n\n        if (e.targetTouches)\n        {\n             this.resizeHandle.x = e.targetTouches[0].pageX;\n             this.resizeHandle.y = e.targetTouches[0].pageY;\n        }\n\n        this.app.broadcast('contextbar.close');\n        this.app.broadcast('image.resize', this.$resizableImage);\n        this._start();\n    },\n    _start: function()\n    {\n        this.$doc.on('mousemove.redactor.image-resize touchmove.redactor.image-resize', this._move.bind(this));\n        this.$doc.on('mouseup.redactor.image-resize touchend.redactor.image-resize', this._stop.bind(this));\n    },\n    _stop: function()\n    {\n        this.$doc.off('.redactor.image-resize');\n        this.app.broadcast('image.resized', this.$resizableImage);\n    },\n    _move: function(e)\n    {\n        e.preventDefault();\n\n        e = e.originalEvent || e;\n\n        var height = this.resizeHandle.h;\n\n        if (e.targetTouches) height += (e.targetTouches[0].pageY -  this.resizeHandle.y);\n        else height += (e.pageY -  this.resizeHandle.y);\n\n        var width = height * this.resizeHandle.ratio;\n\n        width = Math.round(width);\n        height = Math.round(height);\n\n        if (height < 20 || width < 100) return;\n        if (this._getResizableBoxWidth() <= width) return;\n\n        if (this.resizeHandle.$figure.length !== 0 && this.resizeHandle.$figure.css('max-width') !== '') {\n            this.resizeHandle.$figure.css({ width: width + 'px' , 'max-width': width + 'px' });\n        }\n\n        this.resizeHandle.el.attr({ width: width, height: height });\n        this.resizeHandle.el.width(width);\n        this.resizeHandle.el.css('max-width', width + 'px');\n        this.resizeHandle.el.height(height);\n        this._setResizerPosition();\n    },\n    _getResizableBoxWidth: function()\n    {\n        var width = this.$resizableBox.width();\n        return width - parseInt(this.$resizableBox.css('padding-left')) - parseInt(this.$resizableBox.css('padding-right'));\n    }\n});\n$R.add('module', 'file', {\n    modals: {\n        'file':\n            '<div class=\"redactor-modal-tab\" data-title=\"## upload ##\"><form action=\"\"> \\\n                <div class=\"form-item form-item-title\"> \\\n                    <label for=\"modal-file-title\"> ## filename ## <span class=\"desc\">(## optional ##)</span></label> \\\n                    <input type=\"text\" id=\"modal-file-title\" name=\"title\" /> \\\n                </div> \\\n                <input type=\"file\" name=\"file\"> \\\n            </form></div>'\n    },\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.lang = app.lang;\n        this.caret = app.caret;\n        this.utils = app.utils;\n        this.storage = app.storage;\n        this.component = app.component;\n        this.inspector = app.inspector;\n        this.insertion = app.insertion;\n        this.selection = app.selection;\n    },\n    // messages\n    onstarted: function()\n    {\n        // storage observe\n        this.storage.observeFiles();\n    },\n    ondropfile: function(e, files, clipboard)\n    {\n        if (!this.opts.fileUpload) return;\n\n        var options = {\n            url: this.opts.fileUpload,\n            event: (clipboard) ? false : e,\n            files: files,\n            name: 'filedrop',\n            data: this.opts.fileData\n        };\n\n        this.app.api('module.upload.send', options);\n    },\n    onmodal: {\n        file: {\n            open: function($modal, $form)\n            {\n                this._setFormData($modal, $form);\n                this._setUpload($form);\n            },\n            opened: function($modal, $form)\n            {\n                this._setFormFocus($form);\n\n                this.$form = $form;\n            }\n        }\n    },\n    onupload: {\n        file: {\n            complete: function(response)\n            {\n                this._insert(response);\n            },\n            error: function(response)\n            {\n                this._uploadError(response);\n            }\n        },\n        filedrop: {\n            complete: function(response, e)\n            {\n                this._insert(response, e);\n            },\n            error: function(response)\n            {\n                this._uploadError(response);\n            }\n        }\n    },\n\n    // public\n    open: function()\n    {\n        this._open();\n    },\n    insert: function(data)\n    {\n        this._insert(data);\n    },\n    remove: function(node)\n    {\n        this._remove(node);\n    },\n\n    // private\n    _open: function()\n    {\n        this.app.api('module.modal.build', this._getModalData());\n    },\n    _getModalData: function()\n    {\n        var modalData = {\n            name: 'file',\n            title: this.lang.get('file')\n        };\n\n        return modalData;\n    },\n    _insert: function(response, e)\n    {\n        this.app.api('module.modal.close');\n        if (typeof response !== 'object') return;\n\n        if (Array.isArray(response))\n        {\n            var obj = {};\n            for (var i = 0; i < response.length; i++)\n            {\n                obj = $R.extend(obj, response[i]);\n            }\n\n            response = obj;\n        }\n\n        var multiple = (Object.keys(response).length  > 1);\n\n        if (multiple)\n        {\n            this._insertMultiple(response, e);\n        }\n        else\n        {\n            this._insertSingle(response, e);\n        }\n\n        this.$form = false;\n    },\n    _insertSingle: function(response, e)\n    {\n        var inserted = [];\n        for (var key in response)\n        {\n            var $file = this._createFileAndStore(response[key]);\n\n            if (this.opts.fileAttachment)\n            {\n                inserted = this._insertAsAttachment($file);\n            }\n            else\n            {\n                inserted = (e) ? this.insertion.insertToPoint(e, $file) : this.insertion.insertRaw($file);\n            }\n\n            this.app.broadcast('file.uploaded', inserted[0], response);\n        }\n    },\n    _insertMultiple: function(response, e)\n    {\n        var z = 0;\n        var inserted = [];\n        var $last;\n        for (var key in response)\n        {\n            z++;\n\n            var $file = this._createFileAndStore(response[key]);\n\n            if (this.opts.fileAttachment)\n            {\n                inserted = this._insertAsAttachment($file, response);\n            }\n            else\n            {\n                if (z === 1)\n                {\n                    inserted = (e) ? this.insertion.insertToPoint(e, $file) : this.insertion.insertRaw($file);\n                }\n                else\n                {\n                    var $inserted = $R.dom(inserted[0]);\n                    $inserted.after($file).after(' ');\n                    inserted = [$file.get()];\n\n                    this.app.broadcast('file.inserted', $file);\n                }\n            }\n\n            $last = $file;\n            this.app.broadcast('file.uploaded', inserted[0], response);\n        }\n\n        // set caret after last\n        if (!this.opts.fileAttachment)\n        {\n            this.caret.setAfter($last);\n        }\n    },\n    _insertAsAttachment: function($file, response)\n    {\n        var $box = $R.dom(this.opts.fileAttachment);\n        var $wrapper = $file.wrapAttachment();\n        $box.append($wrapper);\n\n        var inserted = [$wrapper.get()];\n        this.app.broadcast('file.appended', inserted[0], response);\n\n        return inserted;\n    },\n    _createFileAndStore: function(item)\n    {\n        var modalFormData = (this.$form) ? this.$form.getData() : false;\n        var name = (item.name) ? item.name : item.url;\n        var title = (!this.opts.fileAttachment && modalFormData && modalFormData.title !== '') ? modalFormData.title : this._truncateUrl(name);\n\n        var $file = this.component.create('file');\n        $file.attr('href', item.url);\n        $file.attr('data-file', (item.id) ? item.id : this.utils.getRandomId());\n        $file.attr('data-name', item.name);\n        $file.html(title);\n\n        // add to storage\n        this.storage.add('file', $file);\n\n        return $file;\n    },\n    _remove: function(node)\n    {\n        this.selection.save();\n\n        var $file = this.component.create('file', node);\n        var stop = this.app.broadcast('file.delete', $file);\n        if (stop !== false)\n        {\n            $file.unwrap();\n\n            this.selection.restore();\n\n            // callback\n            this.app.broadcast('file.deleted', $file);\n        }\n        else\n        {\n            this.selection.restore();\n        }\n    },\n    _truncateUrl: function(url)\n    {\n        return (url.search(/^http/) !== -1 && url.length > 20) ? url.substring(0, 20) + '...' : url;\n    },\n    _setUpload: function($form)\n    {\n        var options = {\n            url: this.opts.fileUpload,\n            element: $form.getField('file'),\n            name: 'file',\n            data: this.opts.fileData,\n            paramName: this.opts.fileUploadParam\n        };\n\n        this.app.api('module.upload.build', options);\n    },\n    _setFormData: function($modal, $form)\n    {\n        if (this.opts.fileAttachment)\n        {\n            $modal.find('.form-item-title').hide();\n        }\n        else\n        {\n            $form.setData({ title: this.selection.getText() });\n        }\n    },\n    _setFormFocus: function($form)\n    {\n        $form.getField('title').focus();\n    },\n    _uploadError: function(response)\n    {\n        this.app.broadcast('file.uploadError', response);\n    }\n});\n$R.add('class', 'file.component', {\n    mixins: ['dom', 'component'],\n    init: function(app, el)\n    {\n        this.app = app;\n        this.opts = app.opts;\n\n        // init\n        return (el && el.cmnt !== undefined) ? el : this._init(el);\n    },\n    wrapAttachment: function()\n    {\n        this.$wrapper = $R.dom('<span class=\"redactor-file-item\">');\n        this.$remover = $R.dom('<span class=\"redactor-file-remover\">');\n        this.$remover.html('&times;');\n        this.$remover.on('click', this.removeAttachment.bind(this));\n\n        this.$wrapper.append(this);\n        this.$wrapper.append(this.$remover);\n\n        return this.$wrapper;\n    },\n    removeAttachment: function(e)\n    {\n        e.preventDefault();\n\n        var stop = this.app.broadcast('file.delete', this, this.$wrapper);\n        if (stop !== false)\n        {\n            this.$wrapper.remove();\n            this.app.broadcast('file.deleted', this);\n            this.app.broadcast('file.removeAttachment', this);\n        }\n    },\n\n    // private\n    _init: function(el)\n    {\n        if (el === undefined)\n        {\n            this.parse('<a>');\n        }\n        else\n        {\n            var $a = $R.dom(el).closest('a');\n            this.parse($a);\n        }\n    }\n});\n$R.add('module', 'buffer', {\n    init: function(app)\n    {\n        this.app = app;\n        this.opts = app.opts;\n        this.editor = app.editor;\n        this.offset = app.offset;\n        this.keycodes = app.keycodes;\n        this.selection = app.selection;\n\n        // local\n        this.state = false;\n        this.passed = false;\n        this.keyPressed = false;\n        this.undoStorage = [];\n        this.redoStorage = [];\n    },\n    // messages\n    onkeydown: function(e)\n    {\n        this._listen(e);\n    },\n    onsyncing: function()\n    {\n        if (!this.keyPressed)\n        {\n            this.trigger();\n        }\n\n        this.keyPressed = false;\n    },\n    onbuffer: {\n        trigger: function()\n        {\n            this.trigger();\n        }\n    },\n    onstate: function(e, html, offset)\n    {\n        if ((e && (e.ctrlKey || e.metaKey)) || (e && (this._isUndo(e) || this._isRedo(e))))\n        {\n            return;\n        }\n\n        this.passed = false;\n        this._saveState(html, offset);\n\n        if (e === false) {\n            this._setUndo();\n        }\n    },\n    onenable: function()\n    {\n        this.clear();\n    },\n\n    // public\n    clear: function()\n    {\n        this.state = false;\n        this.undoStorage = [];\n        this.redoStorage = [];\n    },\n    undo: function()\n    {\n        this._getUndo();\n    },\n    redo: function()\n    {\n        this._getRedo();\n    },\n    trigger: function()\n    {\n        if (this.state && this.passed === false) this._setUndo();\n    },\n\n    // private\n    _saveState: function(html, offset)\n    {\n        var $editor = this.editor.getElement();\n\n        this.state = {\n            html: html || $editor.html(),\n            offset: offset || this.offset.get()\n        };\n    },\n    _listen: function(e)\n    {\n        var key = e.which;\n        var ctrl = e.ctrlKey || e.metaKey;\n        var cmd = ctrl || e.shiftKey || e.altKey;\n        var keys = [this.keycodes.SPACE, this.keycodes.ENTER, this.keycodes.BACKSPACE, this.keycodes.DELETE, this.keycodes.TAB,\n                    this.keycodes.LEFT, this.keycodes.RIGHT, this.keycodes.UP, this.keycodes.DOWN];\n        // undo\n        if (this._isUndo(e)) // z key\n        {\n            e.preventDefault();\n            this.undo();\n            return;\n        }\n        // redo\n        else if (this._isRedo(e))\n        {\n            e.preventDefault();\n            this.redo();\n            return;\n        }\n        // spec keys\n        else if (!ctrl && keys.indexOf(key) !== -1)\n        {\n            cmd = true;\n            this.trigger();\n        }\n        // cut & copy\n        else if (ctrl && (key === 88 || key === 67))\n        {\n            cmd = true;\n            this.trigger();\n        }\n\n\n        // empty buffer\n        if (!cmd && !this._hasUndo())\n        {\n            this.trigger();\n        }\n\n        this.keyPressed = true;\n    },\n    _isUndo: function(e)\n    {\n        var key = e.which;\n        var ctrl = e.ctrlKey || e.metaKey;\n\n        return (ctrl && key === 90 && !e.shiftKey && !e.altKey);\n    },\n    _isRedo: function(e)\n    {\n        var key = e.which;\n        var ctrl = e.ctrlKey || e.metaKey;\n\n        return (ctrl && ((key === 90 && e.shiftKey) || (key === 89 && !e.shiftKey)) && !e.altKey);\n    },\n    _setUndo: function()\n    {\n        var last = this.undoStorage[this.undoStorage.length-1];\n        if (typeof last === 'undefined' || last[0] !== this.state.html)\n        {\n            this.undoStorage.push([this.state.html, this.state.offset]);\n            this._removeOverStorage();\n        }\n    },\n    _setRedo: function()\n    {\n        var $editor = this.editor.getElement();\n        var offset = this.offset.get();\n        var html = $editor.html();\n\n        this.redoStorage.push([html, offset]);\n        this.redoStorage = this.redoStorage.slice(0, this.opts.bufferLimit);\n    },\n    _getUndo: function()\n    {\n        if (!this._hasUndo()) return;\n\n        this.passed = true;\n\n        var $editor = this.editor.getElement();\n        var buffer = this.undoStorage.pop();\n\n        this._setRedo();\n\n        $editor.html(buffer[0]);\n        this.offset.set(buffer[1]);\n        this._saveState(buffer[0], buffer[1]);\n\n        this.app.broadcast('undo', buffer[0], buffer[1]);\n\n    },\n    _getRedo: function()\n    {\n        if (!this._hasRedo()) return;\n\n        this.passed = true;\n\n        var $editor = this.editor.getElement();\n        var buffer = this.redoStorage.pop();\n\n        this._setUndo();\n        $editor.html(buffer[0]);\n        this.offset.set(buffer[1]);\n        this._saveState(buffer[0], buffer[1]);\n\n        this.app.broadcast('redo', buffer[0], buffer[1]);\n    },\n    _removeOverStorage: function()\n    {\n        if (this.undoStorage.length > this.opts.bufferLimit)\n        {\n            this.undoStorage = this.undoStorage.slice(0, (this.undoStorage.length - this.opts.bufferLimit));\n        }\n    },\n    _hasUndo: function()\n    {\n        return (this.undoStorage.length !== 0);\n    },\n    _hasRedo: function()\n    {\n        return (this.redoStorage.length !== 0);\n    }\n});\n$R.add('module', 'list', {\n    init: function(app)\n    {\n        this.app = app;\n        this.uuid = app.uuid;\n        this.opts = app.opts;\n        this.utils = app.utils;\n        this.block = app.block;\n        this.editor = app.editor;\n        this.toolbar = app.toolbar;\n        this.inspector = app.inspector;\n        this.selection = app.selection;\n    },\n    // messages\n    onbutton: {\n        list: {\n            observe: function(button)\n            {\n                this._observeButton(button);\n            }\n        }\n    },\n    ondropdown: {\n        list: {\n            observe: function(dropdown)\n            {\n                this._observeDropdown(dropdown);\n            }\n        }\n    },\n\n    // public\n    toggle: function(type)\n    {\n        var nodes = this._getBlocks();\n        var block = this.selection.getBlock();\n        var $list = $R.dom(block).parents('ul, ol',  this.editor.getElement()).last();\n        if (nodes.length === 0 && $list.length !== 0)\n        {\n            nodes = [$list.get()];\n        }\n\n        if (block && (block.tagName === 'TD' || block.tagName === 'TH'))\n        {\n            nodes = this.block.format('div');\n        }\n\n        this.selection.saveMarkers();\n\n        nodes = (nodes.length !== 0 && this._isUnformat(type, nodes)) ? this._unformat(type, nodes) : this._format(type, nodes);\n\n        this.selection.restoreMarkers();\n\n        return nodes;\n    },\n    indent: function()\n    {\n        var isCollapsed = this.selection.isCollapsed();\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var item = (data.isList()) ? data.getListItem() : false;\n        var $item = $R.dom(item);\n        var $prev = $item.prevElement();\n        var prev = $prev.get();\n        var isIndent = (isCollapsed && item && prev && prev.tagName === 'LI');\n\n        if (isIndent)\n        {\n            this.selection.saveMarkers();\n\n            $prev = $R.dom(prev);\n            var $prevChild = $prev.children('ul, ol');\n            var $list = $item.closest('ul, ol');\n\n            if ($prevChild.length !== 0)\n            {\n                $prevChild.append($item);\n            }\n            else\n            {\n                var listTag = $list.get().tagName.toLowerCase();\n                var $newList = $R.dom('<' + listTag + '>');\n\n                $newList.append($item);\n                $prev.append($newList);\n            }\n\n            this.selection.restoreMarkers();\n\n            // empty list item\n            if (this.utils.isEmptyHtml($item.html())) {\n                this.app.caret.setStart($item);\n            }\n        }\n    },\n    outdent: function()\n    {\n        var isCollapsed = this.selection.isCollapsed();\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var item = (data.isList()) ? data.getListItem() : false;\n        var $item = $R.dom(item);\n\n        if (isCollapsed && item)\n        {\n\n            var $listItem = $item.parent();\n            var $liItem = $listItem.closest('li', '.redactor-in-' + this.uuid);\n            var $prev = $item.prevElement();\n            var $next = $item.nextElement();\n            var prev = $prev.get();\n            var next = $next.get();\n            var nextItems, nextList, $newList, $nextList;\n            var isTop = (prev === false);\n            var isMiddle = (prev !== false && next !== false);\n            var isBottom = (!isTop && next === false);\n\n            this.selection.saveMarkers();\n\n            // out\n            if ($liItem.length !== 0)\n            {\n                if (isMiddle)\n                {\n                    nextItems = this._getAllNext($item.get());\n                    $newList = $R.dom('<' + $listItem.get().tagName.toLowerCase() + '>');\n\n                    for (var i = 0; i < nextItems.length; i++)\n                    {\n                        $newList.append(nextItems[i]);\n                    }\n\n                    $liItem.after($item);\n                    $item.append($newList);\n                }\n                else\n                {\n                    $liItem.after($item);\n\n                    if ($listItem.children().length === 0)\n                    {\n                        $listItem.remove();\n                    }\n                    else\n                    {\n                        if (isTop) $item.append($listItem);\n                    }\n                }\n            }\n            // unformat\n            else\n            {\n                var $container =  this._createUnformatContainer($item);\n                var $childList = $container.find('ul, ol').first();\n\n                if (isTop) $listItem.before($container);\n                else if (isBottom) $listItem.after($container);\n                else if (isMiddle)\n                {\n                    $newList = $R.dom('<' + $listItem.get().tagName.toLowerCase() + '>');\n                    nextItems = this._getAllNext($item.get());\n\n                    for (var i = 0; i < nextItems.length; i++)\n                    {\n                        $newList.append(nextItems[i]);\n                    }\n\n                    $listItem.after($container);\n                    $container.after($newList);\n                }\n\n                if ($childList.length !== 0)\n                {\n                    $nextList = $container.nextElement();\n                    nextList = $nextList.get();\n                    if (nextList && nextList.tagName === $listItem.get().tagName)\n                    {\n                        $R.dom(nextList).prepend($childList);\n                        $childList.unwrap();\n                    }\n                    else\n                    {\n                        $container.after($childList);\n                    }\n                }\n\n                $item.remove();\n            }\n\n            this.selection.restoreMarkers();\n        }\n    },\n\n    // private\n    _getAllNext: function(next)\n    {\n        var nodes = [];\n\n        while (next)\n        {\n            var $next = $R.dom(next).nextElement();\n            next = $next.get();\n\n            if (next) nodes.push(next);\n            else return nodes;\n        }\n\n        return nodes;\n    },\n    _isUnformat: function(type, nodes)\n    {\n        var countLists = 0;\n        for (var i = 0; i < nodes.length; i++)\n        {\n            if (nodes[i].nodeType !== 3)\n            {\n                var tag = nodes[i].tagName.toLowerCase();\n                if (tag === type || tag === 'figure')\n                {\n                    countLists++;\n                }\n            }\n        }\n\n        return (countLists === nodes.length);\n    },\n    _format: function(type, nodes)\n    {\n        var tags = ['p', 'div', 'blockquote', 'pre', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'ul', 'ol'];\n        var blocks = this._uniteBlocks(nodes, tags);\n        var lists = [];\n\n        for (var key in blocks)\n        {\n            var items = blocks[key];\n            var $list = this._createList(type, blocks[key]);\n\n            for (var i = 0; i < items.length; i++)\n            {\n                var $item;\n\n                // lists\n                if (items[i].nodeType !== 3 && (items[i].tagName === 'UL' || items[i].tagName === 'OL'))\n                {\n                    var $oldList = $R.dom(items[i]);\n\n                    $item = $oldList.contents();\n                    $list.append($item);\n\n                    // old is empty\n                    if (this.utils.isEmpty($oldList)) $oldList.remove();\n                }\n                // other blocks or texts\n                else\n                {\n                    $item = this._createListItem(items[i]);\n                    var last = $item.get().lastChild;\n                    if (last && last.tagName === 'BR') {\n                        $R.dom(last).remove();\n                    }\n\n                    this.utils.normalizeTextNodes($item);\n                    $list.append($item);\n                }\n            }\n\n            lists.push($list.get());\n        }\n\n        return lists;\n    },\n    _uniteBlocks: function(nodes, tags)\n    {\n        var z = 0;\n        var blocks = { 0: [] };\n        var lastcell = false;\n        for (var i = 0; i < nodes.length; i++)\n        {\n            var $node = $R.dom(nodes[i]);\n            var $cell = $node.closest('th, td');\n\n            if ($cell.length !== 0)\n            {\n                if ($cell.get() !== lastcell)\n                {\n                    // create block\n                    z++;\n                    blocks[z] = [];\n                }\n\n                if (this._isUniteBlock(nodes[i], tags))\n                {\n                    blocks[z].push(nodes[i]);\n                }\n            }\n            else\n            {\n                if (this._isUniteBlock(nodes[i], tags))\n                {\n                    blocks[z].push(nodes[i]);\n                }\n                else\n                {\n                    // create block\n                    z++;\n                    blocks[z] = [];\n                }\n            }\n\n            lastcell = $cell.get();\n        }\n\n        return blocks;\n    },\n    _isUniteBlock: function(node, tags)\n    {\n        return (node.nodeType === 3 || tags.indexOf(node.tagName.toLowerCase()) !== -1);\n    },\n    _createList: function(type, blocks)\n    {\n        var last = blocks[blocks.length-1];\n        var $last = $R.dom(last);\n        var $list = $R.dom('<' + type + '>');\n        $last.after($list);\n\n        return $list;\n    },\n    _createListItem: function(item)\n    {\n        var $item = $R.dom('<li>');\n        if (item.nodeType === 3)\n        {\n            $item.append(item);\n        }\n        else\n        {\n            var $el = $R.dom(item);\n            $item.append($el.contents());\n            $el.remove();\n        }\n\n        return $item;\n    },\n    _unformat: function(type, nodes)\n    {\n        if (nodes.length === 1)\n        {\n            // one list\n            var $list = $R.dom(nodes[0]);\n            var $items = $list.find('li');\n\n            var selectedItems = this.selection.getNodes({ tags: ['li'] });\n            var block = this.selection.getBlock();\n            var $li = $R.dom(block).closest('li');\n            if (selectedItems.length === 0 && $li.length !== 0)\n            {\n                selectedItems = [$li.get()];\n            }\n\n\n            // 1) entire\n            if (selectedItems.length === $items.length)\n            {\n                return this._unformatEntire(nodes[0]);\n            }\n\n            var pos = this._getItemsPosition($items, selectedItems);\n\n            // 2) top\n            if (pos === 'Top')\n            {\n                return this._unformatAtSide('before', selectedItems, $list);\n            }\n\n            // 3) bottom\n            else if (pos === 'Bottom')\n            {\n                selectedItems.reverse();\n                return this._unformatAtSide('after', selectedItems, $list);\n            }\n\n            // 4) middle\n            else if (pos === 'Middle')\n            {\n                var $last = $R.dom(selectedItems[selectedItems.length-1]);\n\n                var ci = false;\n\n                var $parent = false;\n                var $secondList = $R.dom('<' + $list.get().tagName.toLowerCase() + '>');\n                $items.each(function(node)\n                {\n                    if (ci)\n                    {\n                        var $node = $R.dom(node);\n                        if ($node.closest('.redactor-split-item').length === 0 && ($parent === false || $node.closest($parent).length === 0))\n                        {\n                            $node.addClass('redactor-split-item');\n                        }\n\n                        $parent = $node;\n                    }\n\n                    if (node === $last.get())\n                    {\n                        ci = true;\n                    }\n                });\n\n                $items.filter('.redactor-split-item').each(function(node)\n                {\n                    var $node = $R.dom(node);\n                    $node.removeClass('redactor-split-item');\n                    $secondList.append(node);\n                });\n\n                $list.after($secondList);\n\n                selectedItems.reverse();\n                for (var i = 0; i < selectedItems.length; i++)\n                {\n                    var $item = $R.dom(selectedItems[i]);\n                    var $container = this._createUnformatContainer($item);\n\n                    $list.after($container);\n                    $container.find('ul, ol').remove();\n                    $item.remove();\n                }\n\n\n                return;\n            }\n\n        }\n        else\n        {\n            // unformat all\n            for (var i = 0; i < nodes.length; i++)\n            {\n                if (nodes[i].nodeType !== 3 && nodes[i].tagName.toLowerCase() === type)\n                {\n                    this._unformatEntire(nodes[i]);\n                }\n            }\n        }\n    },\n    _unformatEntire: function(list)\n    {\n        var $list = $R.dom(list);\n        var $items = $list.find('li');\n        $items.each(function(node)\n        {\n            var $item = $R.dom(node);\n            var $container = this._createUnformatContainer($item);\n\n            $item.remove();\n            $list.before($container);\n\n        }.bind(this));\n\n        $list.remove();\n    },\n    _unformatAtSide: function(type, selectedItems, $list)\n    {\n        for (var i = 0; i < selectedItems.length; i++)\n        {\n            var $item = $R.dom(selectedItems[i]);\n            var $container = this._createUnformatContainer($item);\n\n            $list[type]($container);\n\n            var $innerLists = $container.find('ul, ol').first();\n            $item.append($innerLists);\n\n            $innerLists.each(function(node)\n            {\n                var $node = $R.dom(node);\n                var $parent = $node.closest('li');\n\n                if ($parent.get() === selectedItems[i])\n                {\n                    $node.unwrap();\n                    $parent.addClass('r-unwrapped');\n                }\n\n            });\n\n            if (this.utils.isEmptyHtml($item.html())) $item.remove();\n        }\n\n        // clear empty\n        $list.find('.r-unwrapped').each(function(node)\n        {\n            var $node = $R.dom(node);\n            if ($node.html().trim() === '') $node.remove();\n            else $node.removeClass('r-unwrapped');\n        });\n    },\n    _getItemsPosition: function($items, selectedItems)\n    {\n        var pos = 'Middle';\n\n        var sFirst = selectedItems[0];\n        var sLast = selectedItems[selectedItems.length-1];\n\n        var first = $items.first().get();\n        var last = $items.last().get();\n\n        if (first === sFirst && last !== sLast)\n        {\n            pos = 'Top';\n        }\n        else if (first !== sFirst && last === sLast)\n        {\n            pos = 'Bottom';\n        }\n\n        return pos;\n    },\n    _createUnformatContainer: function($item)\n    {\n        var $container = $R.dom('<' + this.opts.markup + '>');\n        if (this.opts.breakline) $container.attr('data-redactor-tag', 'br');\n\n        $container.append($item.contents());\n\n        return $container;\n    },\n    _getBlocks: function()\n    {\n        return this.selection.getBlocks({ first: true });\n    },\n    _observeButton: function()\n    {\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var isDisabled = (data.isPre() || data.isCode() || data.isFigcaption());\n\n        this._observeButtonsList(isDisabled, ['lists', 'ul', 'ol', 'outdent', 'indent']);\n\n        var itemOutdent = this.toolbar.getButton('outdent');\n        var itemIndent = this.toolbar.getButton('indent');\n\n        this._observeIndent(itemIndent, itemOutdent);\n    },\n    _observeDropdown: function(dropdown)\n    {\n        var itemOutdent = dropdown.getItem('outdent');\n        var itemIndent = dropdown.getItem('indent');\n\n        this._observeIndent(itemIndent, itemOutdent);\n    },\n    _observeIndent: function(itemIndent, itemOutdent)\n    {\n        var isCollapsed = this.selection.isCollapsed();\n        var current = this.selection.getCurrent();\n        var data = this.inspector.parse(current);\n        var item = (data.isList()) ? data.getListItem() : false;\n        var $item = $R.dom(item);\n        var $prev = $item.prevElement();\n        var prev = $prev.get();\n        var isIndent = (isCollapsed && item && prev && prev.tagName === 'LI');\n\n        if (itemOutdent)\n        {\n            if (item && isCollapsed) itemOutdent.enable();\n            else itemOutdent.disable();\n        }\n\n        if (itemIndent)\n        {\n            if (item && isIndent) itemIndent.enable();\n            else itemIndent.disable();\n        }\n    },\n    _observeButtonsList: function(param, buttons)\n    {\n        for (var i = 0; i < buttons.length; i++)\n        {\n            var button = this.toolbar.getButton(buttons[i]);\n            if (button)\n            {\n                if (param) button.disable();\n                else button.enable();\n            }\n        }\n    }\n});\n$R.add('class', 'video.component', {\n    mixins: ['dom', 'component'],\n    init: function(app, el)\n    {\n        this.app = app;\n\n        // init\n        return (el && el.cmnt !== undefined) ? el : this._init(el);\n    },\n\n    // private\n    _init: function(el)\n    {\n        if (typeof el !== 'undefined')\n        {\n            var $node = $R.dom(el);\n            var $wrapper = $node.closest('figure');\n            if ($wrapper.length !== 0)\n            {\n                this.parse($wrapper);\n            }\n            else\n            {\n                this.parse('<figure>');\n                this.append(el);\n            }\n        }\n        else\n        {\n            this.parse('<figure>');\n        }\n\n\n        this._initWrapper();\n    },\n    _initWrapper: function()\n    {\n        this.addClass('redactor-component');\n        this.attr({\n            'data-redactor-type': 'video',\n            'tabindex': '-1',\n            'contenteditable': false\n        });\n    }\n});\n\n$R.add('class', 'widget.component', {\n    mixins: ['dom', 'component'],\n    init: function(app, el)\n    {\n        this.app = app;\n\n        // init\n        return (el && el.cmnt !== undefined) ? el : this._init(el);\n    },\n    getData: function()\n    {\n        return {\n            html: this._getHtml()\n        };\n    },\n\n    // private\n    _init: function(el)\n    {\n        if (typeof el !== 'undefined')\n        {\n            var $node = $R.dom(el);\n            var $figure = $node.closest('figure');\n            if ($figure.length !== 0)\n            {\n                this.parse($figure);\n            }\n            else\n            {\n                this.parse('<figure>');\n                this.html(el);\n            }\n        }\n        else\n        {\n            this.parse('<figure>');\n        }\n\n\n        this._initWrapper();\n    },\n    _getHtml: function()\n    {\n        var $wrapper = $R.dom('<div>');\n        $wrapper.html(this.html());\n        $wrapper.find('.redactor-component-caret').remove();\n\n        return $wrapper.html();\n    },\n    _initWrapper: function()\n    {\n        this.addClass('redactor-component');\n        this.attr({\n            'data-redactor-type': 'widget',\n            'tabindex': '-1',\n            'contenteditable': false\n        });\n    }\n});\n\n    var Redactor = $R;\n    window.Redactor = window.$R = $R;\n\n    // Data attribute load\n    window.addEventListener('load', function()\n    {\n        $R('[data-redactor]');\n    });\n\n    // Export for webpack\n    if (typeof module === 'object' && module.exports) {\n        module.exports = Redactor;\n        module.exports.Redactor = Redactor;\n    }\n}());\n"]}